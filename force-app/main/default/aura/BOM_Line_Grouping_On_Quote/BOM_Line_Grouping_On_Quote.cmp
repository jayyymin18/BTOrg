<aura:component implements="force:hasRecordId,flexipage:availableForRecordHome" controller="BOM_Line_Grouping_On_Quote" access="global">

    <lightning:workspaceAPI aura:id="workspace"/>
    <aura:attribute name="recordId" type="string" />
    <aura:attribute name="groupFieldList" type="List" />
    <aura:attribute name="QuoteLineWrapper" type="Object" />
    <aura:attribute name="page" type="integer" description="Use for store page Number" />
    <aura:attribute name="totalColumn" type="integer" />
    <aura:attribute name="secondGrouping" type="Boolean" default="false" />
    <aura:attribute name="thirdGrouping" type="Boolean" default="false" />
    <aura:attribute name="forthGrouping" type="Boolean" default="false" />
    <aura:attribute name="Spinner" type="boolean" default="false" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <div class="mainDiv">

        <aura:if isTrue="{!v.Spinner}">
            <div aura:id="spinnerId" class="slds-spinner_container">
                <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                    <span class="slds-assistive-text">Loading</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                    <div class="custom-loading-text">
                        <b>Processing, Please Wait</b>
                    </div>
                </div>
            </div>
        </aura:if>

        <table class="slds-table">
            <tbody>
                <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                    <tr>
                        <td class="groupHeader" colspan="{!v.totalColumn+4}">
                            <aura:if isTrue="{!group1.groupName != undefined}">
                                {!group1.groupName}
                                <aura:set attribute="else">
                                    No Grouping
                                </aura:set>
                            </aura:if>
                        </td>
                    </tr>
                    <aura:if isTrue="{!v.secondGrouping}">
                        <aura:iteration items="{!group1.quoteLineList}" var="group2">
                            <tr>
                                <td class="groupHeader" style="width: 30px;"> </td>
                                <td class="groupHeader" colspan="{!v.totalColumn+3}">
                                    <aura:if isTrue="{!group2.groupName != undefined}">
                                        {!group2.groupName}
                                        <aura:set attribute="else">
                                            No Grouping
                                        </aura:set>
                                    </aura:if>
                                </td>
                            </tr>

                            <aura:if isTrue="{!v.thirdGrouping}">
                                <aura:iteration items="{!group2.quoteLineList}" var="group3">
                                    <tr>
                                        <td class="groupHeader" style="width: 30px;"> </td>
                                        <td class="groupHeader" style="width: 30px;"> </td>
                                        <td class="groupHeader" colspan="{!v.totalColumn+2}">
                                            <aura:if isTrue="{!group3.groupName != undefined}">
                                                {!group3.groupName}
                                                <aura:set attribute="else">
                                                    No Grouping
                                                </aura:set>
                                            </aura:if>
                                        </td>
                                    </tr>

                                    <aura:if isTrue="{!v.forthGrouping}">
                                        <aura:iteration items="{!group3.quoteLineList}" var="group4">
                                            <tr>
                                                <td class="groupHeader" style="width: 30px;"> </td>
                                                <td class="groupHeader" style="width: 30px;"> </td>
                                                <td class="groupHeader" style="width: 30px;"> </td>
                                                <td class="groupHeader" colspan="{!v.totalColumn+1}">
                                                    <aura:if isTrue="{!group4.groupName != undefined}">
                                                        {!group4.groupName}
                                                        <aura:set attribute="else">
                                                            No Grouping
                                                        </aura:set>
                                                    </aura:if>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                                    <th class="tableHeader">
                                                        {!col.label}
                                                    </th>
                                                </aura:iteration>
                                            </tr>
                                            <aura:iteration items="{!group4.quoteLineList}" var="quoteItem">
                                                <tr>
                                                    <td style="width: 30px;"> </td>
                                                    <td style="width: 30px;"> </td>
                                                    <td style="width: 30px;"> </td>
                                                    <td style="width: 30px;"> </td>
                                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                        <td>
                                                            <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                </aura:if>
                        
                                                                <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" maximumFractionDigits="2"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                        
                                                                <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if> 
                        
                                                                <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}" >
                                                                    
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                        
                                                                <aura:set attribute="else">
                                                                    {!fildData.fieldValue}
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                            </aura:iteration>
                                        </aura:iteration>

                                        <aura:set attribute="else">
                                            <tr>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <th class="tableHeader" style="width: 30px;"></th>
                                                <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                                    <th class="tableHeader">
                                                        {!col.label}
                                                    </th>
                                                </aura:iteration>
                                            </tr>
                                            <aura:iteration items="{!group3.quoteLineList}" var="quoteItem">
                                                <tr>
                                                    <td style="width: 30px;"> </td>
                                                    <td style="width: 30px;"> </td>
                                                    <td style="width: 30px;"> </td>
                                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                        <td>
                                                            <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">
                        
                                                                <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                </aura:if>

                                                                <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" maximumFractionDigits="2"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                        
                                                                <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if> 
                        
                                                                <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}" >
                                                                    
                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2"/>
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2"/>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                        
                                                                <aura:set attribute="else">
                                                                    {!fildData.fieldValue}
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                            </aura:iteration>
                                        </aura:set>
                                    </aura:if>
                                </aura:iteration>

                                <aura:set attribute="else">
                                    <tr>
                                        <th class="tableHeader" style="width: 30px;"></th>
                                        <th class="tableHeader" style="width: 30px;"></th>
                                        <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                            <th class="tableHeader">
                                                {!col.label}
                                            </th>
                                        </aura:iteration>
                                    </tr>
                                    <aura:iteration items="{!group2.quoteLineList}" var="quoteItem">
                                        <tr>
                                            <td style="width: 30px;"> </td>
                                            <td style="width: 30px;"> </td>
                                            <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                <td>
                                                    <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                        || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">
                
                                                        <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                            <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                        </aura:if>
                                                        
                                                        <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2"/>
                                                                <aura:set attribute="else">
                                                                    <lightning:formattedNumber value="0" maximumFractionDigits="2"/>
                                                                </aura:set>
                                                            </aura:if>
                                                        </aura:if>
                
                                                        <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code"/>
                                                                <aura:set attribute="else">
                                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code"/>
                                                                </aura:set>
                                                            </aura:if>
                                                        </aura:if> 
                
                                                        <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                        fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}" >
                                                            
                                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2"/>
                                                                <aura:set attribute="else">
                                                                    <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2"/>
                                                                </aura:set>
                                                            </aura:if>
                                                        </aura:if>
                
                                                        <aura:set attribute="else">
                                                            {!fildData.fieldValue}
                                                        </aura:set>
                                                    </aura:if>
                                                </td>
                                            </aura:iteration>
                                        </tr>
                                    </aura:iteration>
                                </aura:set>
                            </aura:if>
                        </aura:iteration>

                        <aura:set attribute="else">
                            <tr>
                                <th class="tableHeader" style="width: 30px;"></th>
                                <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                    <th class="tableHeader">
                                        {!col.label}
                                    </th>
                                </aura:iteration>
                            </tr>
                            <aura:iteration items="{!group1.quoteLineList}" var="quoteItem">
                                <tr>
                                    <td style="width: 30px;"> </td>
                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                        <td>
                                            <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">
        
                                                <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                </aura:if>
                                                
                                                <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2"/>
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" maximumFractionDigits="2"/>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if>
        
                                                <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code"/>
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code"/>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if> 
        
                                                <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}" >
                                                    
                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2"/>
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2"/>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if>
        
                                                <aura:set attribute="else">
                                                    {!fildData.fieldValue}
                                                </aura:set>
                                            </aura:if>
                                        </td>
                                    </aura:iteration>
                                </tr>
                            </aura:iteration>
                        </aura:set>
                    </aura:if>
                    
                </aura:iteration>
            </tbody>
        </table>
    </div>

</aura:component>