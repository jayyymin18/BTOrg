/*!
 *
 * Bryntum Gantt 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).bryntum=e.bryntum||{},e.bryntum.gantt={}))}(this,(function(e){"use strict";const t="gantt",[n,r]=[self,self],{undefined:i}=n;var s;class o{static supportsPointerEvents=Boolean(r.PointerEvent||r.MSPointerEvent);static supportsPointerEventConstructor="undefined"!=typeof PointerEvent;static PointerEventConstructor=r.PointerEvent||r.CustomEvent;static isPhone=null===(s=r.matchMedia)||void 0===s?void 0:s.call(r,"(max-height:414px) or (max-width:414px)").matches;static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isMobile=Boolean(t.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||"number"==typeof r.orientation),n._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),n._safariVersion=n.getVersion(t,/Version\/(.*).Safari/),n._isAndroid=Boolean(t.match(/Android/g))}static get supportsOverflowClip(){if(null==this._supportsOverflowClip){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip="clip"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow"),e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,t){const n=e.match(t);return n?parseFloat(n[1]):0}static get isTouchDevice(){return this._isTouchDevice===i&&(this._isTouchDevice=r.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===i&&(this._isHoverableDevice=r.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return void 0!==n}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===i)try{this._supportsRandomUUID=Boolean(r.crypto.randomUUID().length>0)}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,n=document.location.search){const r=new RegExp(`[?&]${e}=?([^&]*)`),i=n.match(r);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return""}static download(e,t){const n=document.createElement("a");n.download=e,n.href=t||e,n.style.cssText="display:none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static downloadBlob(e,t){const n=r.URL.createObjectURL(e);this.download(t,n),r.URL.revokeObjectURL(n)}static get queryString(){var e;const t=new URL(r.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}static copyToClipboard(e){let t=!0;const n=document.createElement("textarea");n.value=e,n.style.height=n.style.width=0,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t=!1}return n.remove(),t}static isBryntumOnline(e){var t;return e=Array.isArray(e)?e:[e],Boolean(/^(www\.)?bryntum\.com/.test(r.location.host)||(null===(t=e)||void 0===t?void 0:t.some((e=>null!=this.queryString[e]))))}static get isCSP(){const{bryntum:e,document:t}=r;return null==e.CSP&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}}o.isBrowserEnv&&o.cacheFlags(),o._$name="BrowserHelper";const{hasOwnProperty:a,toString:l}=Object.prototype,{isFrozen:c}=Object,d=/\s*<\s*/,u=/\s*>\s*/,h={},g={},m=Object.freeze({});class p{static assign(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)e[r]=n[r];return e}static assignIf(e,...t){for(let n,r,s=0;s<t.length;s++)if(n=t[s],n)for(r in n)r in e&&e[r]!==i||(e[r]=n[r]);return e}static blend(e,t,n){n=n||h,e=e||{};const{clone:r=p.clone,merge:i=p.blend}=n;if(Array.isArray(t)){if(t.length>1)return t.forEach((t=>{e=p.blend(e,t,n)})),e;t=t[0]}if(t){let s,o,a;for(o in t)a=t[o],a&&p.isObject(a)&&(s=e[o],n.key=o,s&&p.isObject(s)?(c(s)&&(e[o]=s=r(s,n)),a=i(s,a,n)):a=c(a)?a:r(a,n)),e[o]=a}return e}static clone(e,t){let n,r=e;if(e&&"object"==typeof e){if(t&&"object"==typeof t&&t&&(t=null),p.isObject(e))if(e.skipClone)r=e;else for(n in r={},e)r[n]=p.clone(e[n]);else if(Array.isArray(e))for(r=[],n=e.length;n-- >0;)r[n]=p.clone(e[n]);else p.isDate(e)?r=new Date(e.getTime()):t&&(r=t(e))}return r}static createTruthyKeys(e){const t=$.split(e),n=t&&{};if(t)for(const e of t)e&&(n[e]=!0);return n}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||m)[t]),e)}static getPathDefault(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=r.length-1;return r.reduce(((e,t,r)=>(n&&!(t in e)&&(e[t]=r===i?n:{}),(e||m)[t])),e)}static hasPath(e,t){return t.split(".").every((t=>!(!e||!(t in e))&&(e=e[t],!0)))}static getTruthyKeys(e){const t=[];for(const n in e)e[n]&&t.push(n);return t}static getTruthyValues(e){const t=[];for(const n in e)e[n]&&t.push(e[n]);return t}static isClass(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}static isDate(e){return Boolean(null==e?void 0:e.getUTCDate)&&"date"===p.typeOf(e)}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=null==e?void 0:e.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&"object"==typeof e)}static isInstantiated(e){return!!e&&("object"==typeof e&&!p.isObject(e))}static merge(e,...t){return p.blend(e,t)}static mergeItems(e,t,n){let r,i,s,o,a,l,c;n=n||h;const{merge:g=p.blend}=n;if(e=e||{},Array.isArray(t))t.forEach((t=>{e=p.mergeItems(e,t,n)}));else if(t)for(a in t)if(c=t[a],r=null,a.includes(">")?([a,r]=a.split(u),i=0):a.includes("<")&&([r,a]=a.split(d),i=1),a in e)c&&e[a]&&g&&(n.key=a,c=g(e[a],c,n)),e[a]=c;else if(r){if(!o){o=new Map,s=0;for(const t in e)o.set(t,s++)}if(s=o.get(r),e[a]=c,null==s&&i)s=o.size;else{l=l||[],s=(s||0)+i;for(const e of o){const[t,n]=e;s<=n&&(l&&(l[o.size-n-1]=t),o.set(t,n+1))}if(l)for(;l.length;){const t=l.pop(),n=e[t];delete e[t],e[t]=n}}o.set(a,s)}else{var m;e[a]=c,null===(m=o)||void 0===m||m.set(a,o.size)}return e}static setPath(e,t,n){return t.split(".").reduce(((e,t,r,i)=>r===i.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,n;return null===e?n="null":e!=e?n="nan":(n=typeof e,"object"===n?e.isBase?n="instance":Array.isArray(e)?n="array":(n=g[t=l.call(e)])||(g[t]=n=t.slice(8,-1).toLowerCase()):"function"===n&&e.isBase&&(n="class")),n}}let f,v,y,b;Object.defineProperty(p,"hasOwn",{value:Object.hasOwn||((e,t)=>a.call(e,t))}),p._$name="Objects";const C=/([a-z])([A-Z])/g,S=/[\n\r]/g,D=/[.*+?^${}()|[\]\\]/g,w=/[&<]/,E=/(^[^a-z]+[^\w]+)/gi,x=/\s+/,R=/^[^a-z]+|[^\w:.-]+/gi,T=(e,t)=>v[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),M=(e,t)=>f[t],k=(e,t,n)=>`${t}-${n.toLowerCase()}`,I=(e,t,n)=>`${t} ${n.toLowerCase()}`,A=e=>e?`_x${[...e].map((e=>e.charCodeAt(0).toString(16))).join("")}`:"__blank__",F={},P={},O=[],L=function(e,t){if(t&&"object"==typeof t){for(;O.length&&O[O.length-1]!==this;)O.pop();if(O.includes(t))return"[Circular]";O.push(t)}return t};class ${static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=F[e];return t||(F[e]=e.replace(C,k))}static separate(e){const t=P[e];return t||(P[e]=this.capitalize(e.replace(C,I)))}static createId(e){return String(e).replace(E,A)}static makeValidDomId(e,t=""){return null==e?null:String(e).replace(R,t)}static escapeRegExp(e,t){let n=e.replace(D,"\\$&");return t!==i&&(n=new RegExp(n,t)),n}static decodeHtml(e){return e&&String(e).replace(b,T)}static encodeHtml(e=""){return e&&String(e).replace(y,M)}static encodeHtmlBR(e){var t;return null===(t=$.encodeHtml(e))||void 0===t?void 0:t.replace(S,"<br>")}static isHtml(e){return"string"==typeof e&&w.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);f=e,v=t.reduce(((t,n)=>(t[e[n]]=n,t)),{}),y=new RegExp(`([${t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")}])`,"g"),b=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,n=null){let r=null;try{"circular"===t&&(O.length=0,t=L),r=JSON.stringify(e,t,n)}catch{}return r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=x){let n=e;return"string"==typeof n&&(n=e.trim(),n=n?n.split(t):[]),n}static xss(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+$.encodeHtml(t[r]);return n.join("")}static xssBR(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+$.encodeHtmlBR(t[r]);return n.join("")}static toJavaScriptValue(e,t){const n=p.typeOf(e);if("boolean"===n||"string"===n||"number"===n||null===e)return $.safeJsonStringify(e);if(e===r)return"window";if("date"===n)return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if("array"===n)return`[${e.map((e=>$.toJavaScriptValue(e,t)))}]`;if("object"===n||"instance"===n)return this.toJavaScriptString(e,t);if("function"===n){let t=e.toString();return t.match(/^async (\w+?)\(/)?t=t.replace(/^async (\w+?)\(/,"async function("):!t.startsWith("async(")&&t.match(/^(\w+?)\(/)&&(t=t.replace(/^(\w+?)\(/,"function(")),t}return"class"===n?e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name:void 0}static toJavaScriptString(e,t={}){const n=t.level??0;return"{\n"+Object.keys(e).map((r=>" ".repeat(2*(n+1))+(r.match(/[- *]/)?`"${r}"`:r)+`: ${$.toJavaScriptValue(e[r],{...t,level:n+1})}`)).join(",\n")+"\n"+" ".repeat(2*n)+"}"}static encodeAttributeSelector(e,t){return`[${e}="${String(t).replace(/["\\]/g,"\\$&")}"]`}static fakeNodeUUIDIndex=0;static generateUUID(){var e;return o.supportsRandomUUID?r.crypto.randomUUID():null!==(e=r.crypto)&&void 0!==e&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^r.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))):`${Date.now()}-${++$.fakeNodeUUIDIndex}`}}$.initHtmlEntities(),$._$name="StringHelper";class _{static setVersion(e,n){e=e.toLowerCase(),j[e]={version:n,isNewerThan:e=>_.semanticCompareVersion(e,n,"<"),isOlderThan:e=>_.semanticCompareVersion(e,n,">")};let i="";i=t;const s=`${i}.${e}${n.replace(/\./g,"-")}`;if(o.isBrowserEnv&&!r.bryntum.silenceBundleException)if(!0===r.bryntum[s]){if(!this.isTestEnv){let t=i||e;"core"===t&&(t="grid");let n=$.capitalize(t);throw"schedulerpro"===t&&(n="SchedulerPro"),new Error(`The Bryntum ${n} bundle was loaded multiple times by the application.\n\nCommon reasons you are getting this error includes:\n\n* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)\n* Imports point to both sources and bundle\n* Imports do not use the shortest relative path, JS treats them as different files\n* Cache busters differ between imports, JS treats ${t}.module.js?1 and ${t}.module.js?2 as different files\n* Imports missing file type, verify they all end in .js\n\nSee https://bryntum.com/products/${t}/docs/guide/${n}/gettingstarted/es6bundle#troubleshooting for more information\n\n`)}r.BUNDLE_EXCEPTION=!0}else r.bryntum[s]=!0}static getVersion(e){if(e=e.toLowerCase(),!j[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return j[e].version}static semanticCompareVersion(e,t,n="="){t=t||"";const r=(e=e||"").split(/[-.]/),i=t.split(/[-.]/),s=n.includes("<"),o=(e,t)=>{const n=["rc","beta","alpha"],r=e.map((e=>{if(n.includes(e))return-n.indexOf(e)-2;const t=Number.parseInt(e);return Number.isNaN(t)?-n.length:t}));for(;r.length<t;)r.push(-1);return r},a=()=>{const e=Math.max(r.length,i.length),t=o(r,e),n=o(i,e);for(let r=0;r<e;r++)if(t[r]!==n[r])return s?t[r]<n[r]:t[r]>n[r];return!0};switch(n){case"=":return e===t;case"<=":case">=":return e===t||a();case"<":case">":return e!==t&&a()}return!1}static checkVersion(e,t,n){return _.semanticCompareVersion(j.getVersion(e),t,n)}static deprecate(e,t,n){if(!j.checkVersion(e,t,"<"))throw new Error(`Deprecated API use. ${n}`);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${n}`)}static get isTestEnv(){var e;const t=Boolean(null===(e=r.bryntum)||void 0===e?void 0:e.isTestEnv);try{var n,i;return t||Boolean(null===(n=r.parent)||void 0===n||null===(i=n.bryntum)||void 0===i?void 0:i.isTestEnv)}catch(e){return t}}static get isDebug(){return!1}}const j=_;o.isBrowserEnv&&(j.isTestEnv&&(o._isHoverableDevice=!0),r.bryntum=Object.assign(r.bryntum||{},{getVersion:j.getVersion.bind(j),checkVersion:j.checkVersion.bind(j),deprecate:j.deprecate.bind(j),license:"bb7e76cc-6e34-11ec-a6ac-d094663d5c88"})),_._$name="VersionHelper";const B={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class V{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,n,e.prototype),!0}static internalOverrideAll(e,t,n){Reflect.ownKeys(n).forEach((r=>{if(t.includes(r)&&!B[r]){const t=Object.getOwnPropertyDescriptor(n,r);let i=e,s=null;for(;!s&&i;)s=Object.getOwnPropertyDescriptor(i,r),s||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,r,t,s)}}))}static internalOverride(e,t,n,r){(e._overridden=e._overridden||{})[t]=e[t],r.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:n.get}):e[t]=n.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!_[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!_[t.product].isOlderThan(t.minVersion))}}V._$name="Override";class H{static clean(e){return e.reduce(((e,t)=>(null===t||t===i||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static from(e,t,n){const r=[];if(e)for(const i of e)t&&!t(i)||r.push(n?n(i):i);return r}static remove(e,...t){let n,r,i=!1;t=t[0]instanceof Set?[...t[0]]:t;for(let s=0;s<t.length;s++)r=t[s],-1!==(n=e.indexOf(r))&&(e.splice(n,1),i=!0);return i}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const i=t.length;let s,o;return r<i&&(s=r>0?n(t[r-1],e):0,o=r<i-1?n(e,t[r]):0,s<1&&o<1)?r:this.binarySearch(t,e,n)}static findLast(e,t,n){for(let{length:r}=e,i=r-1;i>=0;i--)if(t.call(n,e[i],i,e))return e[i]}static binarySearch(e,t,n=0,r=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(n instanceof Function?(i=n,n=0):r instanceof Function&&(i=r,r=s),--r;n<=r;)o=n+r>>1,a=i(t,e[o]),a>=0?n=o+1:a<0&&(r=o-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);n&&n(i,t),r.push(i)}return r}static populate(e,t,n=!1){const r=[];for(let i=0;i<e;i++)r.push(t(i+(n?1:0)));return r}static include(e,...t){for(const n of t)e.includes(n)||e.push(n)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,n,r):(e[i<0?e.length+i:i]=n,!0)}})}static delta(e,t,n=!1){if(!t)return n?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],i=[],s=new Set,o=new Set(t);for(let t=0;t<e.length;t++){const n=e[t];o.has(n)?s.add(n):r.push(n)}for(let e=0;e<t.length;e++){const n=t[e];s.has(n)||i.push(n)}return n?{toAdd:r,toRemove:i,toKeep:s}:{onlyInA:r,onlyInB:i,inBoth:[...s]}}static asArray(e){return null==e?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,n=H.identity){const r="string"==typeof t?e=>null==e?void 0:e[t]:t,i="string"==typeof n?e=>null==e?void 0:e[n]:n;return e.reduce(((e,t)=>(e[r(t)]=i(t),e)),{})}static aggregate(e,t,n,r,i={}){const s=e.length,o=e[0].length,a=[];i.targetArray=a,i.arrays=e;for(let e=0;e<o;e++)i.entryIndex=e,a.push(r(e,i));for(let r=0;r<s;r++){const s=e[r];i.rowIndex=r;for(let e=0;e<o;e++){i.entryIndex=e;const o=t(s[e],i);a[e]=n(a[e],o,r,e,i)}}return a}static groupBy(e,t){const n="string"==typeof t?e=>null==e?void 0:e[t]:t;return e.reduce(((e,t)=>{const r=n(t);return(e[r]=e[r]||[]).push(t),e}),{})}}H._$name="ArrayHelper";class N{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static yield(){return Promise.resolve()}}N._$name="AsyncHelper";const{defineProperty:z,getOwnPropertyDescriptor:W}=Reflect,{hasOwnProperty:U,toString:G}=Object.prototype,Y=Symbol("instanceProperties"),q=Symbol("configuring"),K=Symbol("lazyConfigValues"),X=G.call(new Date),Z=/\s+/,J=(e,t)=>(e[t]=1,e);class Q{static get(e,t){const{cache:n}=this,r=n[e]||(n[e]=new Q(e));let i,s=r;return t&&(i=Q.makeCacheKey(e,t),(s=i&&n[i])||(s=r.extend(t),i&&(n[i]=s))),s}constructor(e){const t=this,n=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=n,t.changer="change"+n,t.initializing="initializing"+n,t.updater="update"+n}get descriptor(){let e=this._descriptor;return e&&U.call(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&U.call(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:n,merge:r}=e,{equalityMethods:i}=Q;return"string"==typeof n&&(n.endsWith("[]")?t.equal=Q.makeArrayEquals(i[n.substr(0,n.length-2)]):t.equal=i[n]),"string"==typeof r&&(t.merge=Q.mergeMethods[r]),t}define(e){const t=W(e,this.name);let n=this.descriptor;t&&t.get&&(n=Object.assign({},n),n.get=t.get),z(e,this.name,n)}defineInitter(e,t){const{name:n}=this,r=e[Y];let i,s;r[n]||!(s=W(e,n))||"value"in s||(r[n]=s),z(e,n,this.initDescriptor),this.lazy&&(i=e[K]||(e[K]=new Map),i.set(n,t))}static makeArrayEquals(e){return(t,n)=>{let r,i=t&&n&&t.length===(r=n.length);if(i&&Array.isArray(t)&&Array.isArray(n))if(e)for(;i&&r-- >0;)i=e(t[r],n[r]);else for(;i&&r-- >0;)i=t[r]===n[r];else i=e?e(t,n):t===n;return i}}static makeCacheKey(e,t){const n=Object.keys(t).sort();for(let e,r,i,s=n.length;s-- >0;)if(i=t[e=n[s]],null==i&&!1===i)n.splice(s,1);else{if(r=typeof i,"function"===r)return null;"string"===r?n[s]=`${e}:"${i}"`:"number"===r&&(n[s]=`${e}:${i}`)}return n.length?`${e}>${n.join("|")}`:e}makeDescriptor(){const e=this,{base:t,field:n,changer:r,updater:s,name:o}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){var e;return null===(e=this.configObserver)||void 0===e||e.get(o,this),this[n]},set(t){const a=this;let l,c,d=a[n];if("string"==typeof t){let e=t;var u;if(t.startsWith("up."))e=null===(u=a.owner)||void 0===u?void 0:u.resolveProperty(t.substr(3));else t.startsWith("this.")&&(e=a.resolveProperty(t.substr(5)));e!==i&&"function"!=typeof e&&(t=e)}var h;(a[r]&&(l=(c=a[r](t,d))===i,l||(t=c,d=a[n])),l||(e.equal===te?d===t:e.equal(d,t)))||(a[n]=t,l=!0,null===(h=a[s])||void 0===h||h.call(a,t,d));!l||a.isDestroyed||a.onConfigChange.$nullFn||a.onConfigChange({name:o,value:t,was:d,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this;return e.removeInitter(r),r[t]=!0,r[n]=r[q][n],r[t]=!1,r.configDone[n]=!0,r[n]},set(t){e.removeInitter(this),this.configDone[n]=!0,this[n]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this,i=r[K].get(n);return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[n]=i,r[t]=!1),r[n]},set(t){e.removeInitter(this),this[n]=t}}}removeInitter(e){const{name:t}=this,n=e[Y][t],r=e[K];n?z(e,t,n):delete e[t],null!=r&&r.delete(t)&&!r.size&&delete e[K]}setDefault(e,t){z(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&p.isObject(e)){if(t.isBase)return t.setConfig(e);p.isObject(t)&&(e=p.merge(p.clone(t),e))}return e}}const{prototype:ee}=Q,{equal:te}=ee;Q.symbols={configuring:q,instanceProperties:Y,lazyConfigs:K},Q.cache=Object.create(null),Q.equalityMethods={array:Q.makeArrayEquals(),date:(e,t)=>e===t||!(!e||!t||G.call(e)!==X||G.call(t)!==X)&&e.getTime()===t.getTime(),strict:Q.equal=te},Q.mergeMethods={distinct(e,t){let n=t?t.slice():[];if(null!=e)if(p.isObject(e))if(t===i)n=e;else{let t,r;for(t in e)r=n.indexOf(t),e[t]?r<0&&n.push(t):r>-1&&n.splice(r,1)}else Array.isArray(e)?e.forEach((e=>!n.includes(e)&&n.push(e))):n.includes(e)||n.push(e);return n},merge:Q.merge=ee.merge,classList(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(Z)}return Array.isArray(e)&&(e=e.reduce(J,{})),Q.merge(e,t)},objects:(e,t)=>!0===e?t||{}:Q.merge(e,t),replace:e=>e,items:(e,t,n,r)=>r?p.mergeItems(t,e,{merge:(e,t)=>ee.merge(t,e)}):ee.merge(e,t)},Object.assign(ee,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Q._$name="Config";class ne{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){let n=this[e];var r;e in this||(n=null===(r=this.super)||void 0===r?void 0:r.getInherited(e,t),(n||t)&&(this[e]=n=Object.create(n||null)));return n}}const{getPrototypeOf:re}=Object,{hasOwn:ie}=p,{defineProperty:se}=Reflect,oe=Symbol("classMetaData"),ae=Symbol("mixinTag"),le=Symbol("originalConfig"),ce=Q.symbols.configuring,de=Q.symbols.instanceProperties,ue=Q.symbols.lazyConfigs,he={merge:"replace",simple:!0},ge=()=>{},me=e=>new ne(e),pe={},fe=Object.freeze({}),ve=Object.freeze([]);class ye{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,n=t.constructor;t.$meta.class!==n&&n.$meta,t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return new this((e=e.filter((e=>e))).length>1?this.mergeConfigs(...e):e[0])}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=e=>{null!=e&&e.destroy?e.destroy():Array.isArray(e)&&e.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=ge,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[le],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return ie(this,"$name")&&this.$name||ie(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,n=ve){const{handler:r,thisObj:i}=this.resolveCallback(e,"this"===t?this:t)||fe;return null==r?void 0:r.apply(i,n)}resolveProperty(e){let t=this;for(;t;){if(p.hasPath(t,e))return p.getPath(t,e);t=t.owner}return i}resolveCallback(e,t=this,n=!0){var r;if(null!==(r=e)&&void 0!==r&&r.substring){if(e.endsWith("?")&&(n=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!(t&&t instanceof Object))return;e=t[e]}if("function"==typeof e)return{handler:e,thisObj:t};if(n)throw new Error(`No method named ${e} on ${t.$$name||"thisObj object"}`)}bindCallback(e,t=this){if(e){const{handler:n,thisObj:r}=this.resolveCallback(e,t);if(n)return n.bind(r)}}delay(e,t,n=e.name||e){e=this.setTimeout?e:e.bind(this);return(this.setTimeout?this:r)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t,n)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let n=0;n<t.length;++n)null!=e[t[n].field]&&(e[t[n].name]=null)}destroyProperties(...e){const t=this;let n;for(n of e){var r,i,s;if(n in t&&(!t[ce]||!t[ce][n]))null===(r=t[n])||void 0===r||null===(i=(s=r).destroy)||void 0===i||i.call(s),delete t[n]}}configure(e={}){const t=this,n=t.$meta,{beforeConfigure:r}=e,i=n.configs,s=t.getDefaultConfiguration();let o,a,l;for(a in t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)l=e[a],o=i[a],s[a]=o?o.merge(l,s[a],null,n):l;r&&(delete s.beforeConfigure,r(t,s)),t.setConfig(t[le]=s,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){const n=this,r=n[ce],i=r?n.configDone:n.configDone={},s=n.$meta.configs,o=n[ue];let a,l;for(l in n[de]={},n[ce]=r?Object.setPrototypeOf(Object.assign({},e),r):e,e)null!=e[l]||ie(e,l)?(a=s[l]||Q.get(l),null!=o&&o.has(l)||a.defineInitter(n,e[l]),t||(i[l]=!1)):i[l]=!0;for(l in t&&n.startConfigure(e),e){var c;i[l]||t&&null!==(c=s[l])&&void 0!==c&&c.lazy||(n[l]=e[l])}return r?n[ce]=r:delete n[ce],t&&n.finishConfigure(e),n}hasConfig(e){var t;const n=this,r=n[ce];return Boolean(null!=n["_"+e]||null!=(null===(t=n[ue])||void 0===t?void 0:t.get(e))||!n.configDone[e]&&r&&(null!=r[e]||ie(r,e)))}peekConfig(e){const t=this,n=t[ue],r=t[ce];if(null!=n&&n.has(e))return n.get(e);if(r&&e in r){if(t.configDone[e])return t[e];if(null!=r[e]||ie(r,e))return r[e]}}triggerConfig(e){const t=this,{configDone:n}=t,r=t[ue],i=t[ce],s=null!=r&&r.has(e)||i&&(null!=i[e]||ie(i,e))?!n[e]:null;return s&&t.getConfig(e),s}triggerConfigs(e){const t=this,n=t.$meta.configs,r=t[ue],i=r?[...r.keys()].filter((t=>n[t].lazy===e)):ve;for(const e of i)t.triggerConfig(e);return i.length?i:null}onConfigChange(){}get config(){const e={},t=this[le];for(const n in t)e[n]=t[n];return e}static processConfigValue(e,t){if(e===r)return r;if(Array.isArray(e))return e.map((e=>ye.processConfigValue(e,t)));if(e instanceof ye){if(t.visited.has(e))return;return e.getCurrentConfig(t)}if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(p.isObject(e)){const n={};for(const r in e)"owner"!==r&&(n[r]=ye.processConfigValue(e[r],t));return n}return e}getConfigValue(e,t){var n;const r=this,i=r[ue];return null!==(n=r.$meta.configs[e])&&void 0!==n&&n.lazy?null!=i&&i.has(e)?ye.processConfigValue(i.get(e),t):void 0:ye.processConfigValue(r[e],t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,n="all"===e.configs?t.config:p.clone(t.initialConfig),r=e.visited||(e.visited=new Set),s=e.depth||(e.depth=0),o={};if(r.has(t))return i;r.add(t),this.preProcessCurrentConfigs(n);for(const r in n){const n=t.getConfigValue(r,{...e,depth:s+1});n!==i&&(o[r]=n)}return o}getConfigString(e={}){return $.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);o.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[oe];return ie(e,oe)||(e[oe]=t=me(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const n=this.$meta.configs,r=p.clone(e)||{};let i,s,o,a;for(s=0;s<t.length;++s)if(i=t[s],i)for(o in i)a=i[o],n[o]?a=n[o].merge(a,r[o]):r[o]&&a&&(a=Q.merge(a,r[o])),r[o]=a;return r}static mixin(...e){let t,n=this;for(t=0;t<e.length;++t){const r=e[t],i=r[ae]||(r[ae]=Symbol("mixinTag"));n[i]||(n=r(n),n[i]=!0,ie(n,"onClassMixedIn")&&n.onClassMixedIn())}return n}static setupClass(e){var t;const n=e.class,r=re(n).$meta,i=n.$$name,s=r.names,o=n.prototype;if(se(o,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([...r.hierarchy,n]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:r.properties,nullify:null===(t=r.nullify)||void 0===t?void 0:t.slice()}),s!==e.names){const e=`is${i}`,t=t=>{ie(t,e)||se(t,e,{get:()=>!0})};t(o),t(n)}for(let t,r,i=0;i<e.declarables.length;++i)t=e.declarables[i],ie(n,t)&&(r=pe[t]||(pe[t]=`setup${$.capitalize(t)}`),n[r](n,e))}static setupConfigs(e,t,n){const r=e.config,s=e.configs,o=e.class,a=e.super;let l,c,d,u,h,g,{nullify:m}=e;for(const f in t)h=t[f],n?(l=s[f])?h=l.merge(h,r[f],e,a):l=Q.get(f,he):(c=d=u=i,h&&"object"==typeof h&&"$config"in h&&(d=h.$config,d&&!p.isObject(d)&&(d=p.createTruthyKeys(d)),u="default"in h,c=u?h.default:c,h=h.value),(l=s[f])?(g=l.nullify,d&&(l=l.extend(d)),h=l.merge(h,r[f],e,a)):(l=Q.get(f,d),l.define(o.prototype),u=!(l.field in o.prototype),g=!1),u&&l.setDefault(o,c),l.nullify&&!g&&(m||(m=e.nullify||(e.nullify=[]))).push(l)),h&&(p.isObject(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),s[f]=l,r[f]=h}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const n=e.declarable;let r,i,s=t.declarables;for(i=0;i<n.length;++i)s.includes(n[i])||(r||(t.declarables=r=s=s.slice()),s.push(n[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?ye.fork(e.config):Object.create(e.config);if(_.isTestEnv&&o.isBrowserEnv&&t.testConfig&&r.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static fork(e){let t,n,r=e;if(e&&p.isObject(e)&&!Object.isFrozen(e))for(t in r=Object.create(e),e)n=e[t],n&&(p.isObject(n)?r[t]=ye.fork(n):Array.isArray(n)&&(r[t]=n.slice()));return r}getProperties(){const e=this.$meta.properties,t={};for(let n=0;n<e.length;n++)Object.assign(t,e[n].properties);return t}static get superclass(){return re(this)}classHierarchy(e){const t=this.$meta.hierarchy,n=e?t.indexOf(e):0;return n>0?t.slice(n):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){var t;let n=this.$detachers;if(n=null===(t=n)||void 0===t?void 0:t[e],n)for(;n.length;)n.pop()()}trackDetacher(e,t){const n=this.$detachers||(this.$detachers={});(n[e]||(n[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const n in t){const r=t[n];for(let t=r.length;t-- >0;)r[t].eventer===e&&r.splice(t,1)}}}const be=ye.prototype;be.onConfigChange.$nullFn=ge.$nullFn=!0,ye[oe]=be.$meta=me({class:ye,config:Object.freeze({}),configs:Object.create(null),declarables:ye.declarable,forkConfigs:!1,hierarchy:Object.freeze([ye]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(be,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),ye.emptyFn=ge,_.setVersion("core","5.6.2"),ye._$name="Base";const Ce=/^(\w+)=(.*)$/;class Se{static DEFAULT_FETCH_OPTIONS={};static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t){let n;if(t=p.merge({},Se.DEFAULT_FETCH_OPTIONS,t),"undefined"!=typeof AbortController&&(n=t.abortController=new AbortController,t.signal=n.signal),"credentials"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);if(n.length){let r=!1;if(t.headers&&!0===t.addQueryParamsToBody){let e;switch(new Headers(t.headers).get("Content-Type")){case"application/x-www-form-urlencoded":e=URLSearchParams;break;case"multipart/form-data":e=FormData}if(e){const i=t.body||(t.body=new e);i instanceof e&&(n.forEach((([e,t])=>i.set(e,t))),r=!0)}}r||(e+=(e.includes("?")?"&":"?")+n.map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"))}}const r=new Promise(((n,i)=>{fetch(e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,n(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):n(e)})).catch((e=>{e.stack=r.stack,i(e)}))}));return r.stack=(new Error).stack,r.abort=function(){var e;null===(e=n)||void 0===e||e.abort()},r}static mockUrl(e,t){const n=this;(n.mockAjaxMap||(n.mockAjaxMap={}))[e]=t,Se.originalFetch||(Se.originalFetch=Se.fetch,Se.fetch=n.mockAjaxFetch.bind(n))}static async mockAjaxFetch(e,t){const n=e.split("?");let r=this.mockAjaxMap[n[0]],i=null;if(r){"function"==typeof r&&(r=await r(n[0],n[1]&&function(e){const t={},n=e.split("&");for(const e of n){const[n,r,i]=Ce.exec(e),s=decodeURIComponent(r),o=decodeURIComponent(i);if(n){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(o)):t[s]=o}}return t}(n[1]),t));try{i=(null==t?void 0:t.parseJson)&&JSON.parse(r.responseText)}catch(e){i=null,r.error=e}return r=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(r.responseText)})),json:()=>new Promise((e=>{e(i)}))},r),new Promise((function(e,t){r.synchronous?e(r):setTimeout((function(){e(r)}),"delay"in r?r.delay:100)}))}return Se.originalFetch(e,t)}}Se._$name="AjaxHelper";const De=/,\s*/,we=Symbol("decompiled"),Ee=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,xe=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,Re=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Te}=Object.prototype;class Me{static after(e,t,n,r,s){const o="string"==typeof n,a=!1!==(null==s?void 0:s.return),l=(...t)=>{const s=l.$nextHook.call(e,...t),c=null!=r&&r.isDestroyed?i:a?o?r[n](s,...t):n.call(r,s,...t):o?r[n](...t):n.call(r,...t);return c===i?s:c};return Me.hookMethod(e,t,l)}static before(e,t,n,r){const i="string"==typeof n,s=(...t)=>{const o=null!=r&&r.isDestroyed?0:i?r[n](...t):n.call(r,...t);return!1===o?o:s.$nextHook.call(e,...t)};return Me.hookMethod(e,t,s)}static curry(e){return function t(...n){return n.length>=e.length?e.apply(this,n):function(...e){return t.apply(this,n.concat(e))}}}static bindAll(e){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,n){return function(...r){const i=n||this;return!1!==t.call(i,...r)&&e.call(i,...r)}}static createSequence(e,t,n){return(...r)=>{const s=e.call(n,...r),o=t.call(n,...r);return o===i?s:o}}static createThrottled(e,t,n,r,i){let s,o,a=-Number.MAX_VALUE;const l=()=>{o=0,a=performance.now(),s.push.apply(s,r),e.apply(n,s)},c=function(...e){const c=performance.now()-a;s=e,c>=t?(clearTimeout(o),l()):(o||(o=setTimeout(l,t-c)),i&&(s.push.apply(s,r),i.apply(n,s)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,t,n,r){let i,s;const o=()=>{s=0,a.isPending=!1,i.push.apply(i,r),e.apply(n,i)},a=function(...e){i=e,s&&clearTimeout(s),a.isPending=!0,s=setTimeout(o,t)};return a.cancel=()=>{a.isPending=!1,clearTimeout(s)},a}static decompile(e){if(!(we in e)){var t,n;const r=e.toString();let i,s,o,a,l,c=Ee.exec(r);c?(i=[c[2]],s=c[3]):(c=xe.exec(r))?(l=c[2].trim(),i=l?l.split(De):[],s=c[3]):(c=Re.exec(r))&&(o=c[2],l=c[3].trim(),i=l?l.split(De):[],s=c[4]),s=null===(t=s)||void 0===t?void 0:t.trim(),e[we]=a=c&&{args:i,async:Boolean(c[1]),body:null!==(n=s)&&void 0!==n&&n.startsWith("{")?s.substring(1,s.length-1).trim():s},o&&(a.name=o)}return e[we]}static hookMethod(e,t,n){return n.$nextHook=e[t],e[t]=n,()=>{if(Te.call(e,t)){let s,o=e[t];var r;if(o===n)(null===(r=Object.getPrototypeOf(e))||void 0===r?void 0:r[t])===n.$nextHook?delete e[t]:e[t]=n.$nextHook;else for(;s=null===(i=o)||void 0===i?void 0:i.$nextHook;o=s){var i;if(s===n){o.$nextHook=n.$nextHook;break}}}}}static noThrow(e,t,n){const r=e[t];e[t]=(...t)=>{try{return r.apply(e,t)}catch(e){return null==n?void 0:n(e)}}}static returnTrue(){return!0}static animate(e,t,n,i="linear"){let s=!1;const o=new Promise((o=>{const a=performance.now(),l=()=>{const c=Math.min((performance.now()-a)/e,1),d=n&&n.setTimeout?n:r;s||!1===t.call(n,this.easingFunctions[i](c))&&o(),s||1===c?d.requestAnimationFrame((()=>o())):d.requestAnimationFrame(l)};l()}));return o.cancel=()=>(s=!0,o.cancelled=!0,!1),o}}const ke=.5,Ie=1.70158,Ae=7.5625,Fe=1.525,Pe=2/2.75,Oe=2.25/2.75,Le=1/2.75,$e=1.5/2.75,_e=2.5/2.75,je=2.625/2.75,Be=.75,Ve=.9375,He=.984375;Me.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=ke)<1?ke*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=ke)<1?ke*Math.pow(e,3):ke*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=ke)<1?ke*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=ke)<1?ke*Math.pow(e,5):ke*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=ke)<1?ke*Math.pow(2,10*(e-1)):ke*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=ke)<1?-.5*(Math.sqrt(1-e*e)-1):ke*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<Le?Ae*e*e:e<Pe?Ae*(e-=$e)*e+Be:e<_e?Ae*(e-=Oe)*e+Ve:Ae*(e-=je)*e+He,easeInBack:e=>e*e*((Ie+1)*e-Ie),easeOutBack:e=>(e-=1)*e*((Ie+1)*e+Ie)+1,easeInOutBack:e=>{let t=1.70158;return(e/=ke)<1?ke*(e*e*((1+(t*=Fe))*e-t)):ke*((e-=2)*e*((1+(t*=Fe))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=ke)<1?ke*(e*e*((1+(t*=Fe))*e-t)):ke*((e-=2)*e*((1+(t*=Fe))*e+t)+2)},swingFrom:e=>e*e*((Ie+1)*e-Ie),swingTo:e=>(e-=1)*e*((Ie+1)*e+Ie)+1,bounce:e=>e<Le?Ae*e*e:e<Pe?Ae*(e-=$e)*e+Be:e<_e?Ae*(e-=Oe)*e+Ve:Ae*(e-=je)*e+He,bouncePast:e=>e<Le?Ae*e*e:e<Pe?2-(Ae*(e-=$e)*e+Be):e<_e?2-(Ae*(e-=Oe)*e+Ve):2-(Ae*(e-=je)*e+He),easeFromTo:e=>(e/=ke)<1?ke*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Me._$name="FunctionHelper";const{isArray:Ne}=Array,{hasOwnProperty:ze}=Object.prototype,We={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},Ue=(e,t)=>t.prio-e.prio;var Ge=e=>class t extends(e||ye){eventsSuspended=null;static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const n=t.getInherited("deprecatedEvents"),r=e.deprecatedEvents;for(const e in r)n[e.toLowerCase()]=n[e]=r[e]}static get configurable(){return{listeners:{value:null,$config:{merge(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[Ne(t)?"apply":"call"](e,t)}return e}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){var n;(this.configuredListeners=null===(n=e)||void 0===n?void 0:n.listeners)&&delete(e=p.assign({},e)).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(e){super.setupClass(e),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}addListener(e,t,n){if(Ne(e)){for(let n=0,{length:r}=e;n<r;n++)this.addListener(e[n],t);return}const s=this,o=s.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return s.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:n});{t=e.thisObj=e.thisObj!==i?e.thisObj:t;for(const n in e)if(!We[n]&&null!=e[n]){const l=n.toLowerCase(),c=null==o?void 0:o[l],d=s.eventListeners||(s.eventListeners={}),u=H.asArray(e[n]);if(c){const{product:e,invalidAsOfVersion:t,message:n}=c;_.deprecate(e,t,n)}for(const o of u){var a;const c=o.expires||e.expires,u={fn:"object"==typeof o?o.fn:o,thisObj:o.thisObj!==i?o.thisObj:t,args:o.args||e.args,prio:o.prio!==i?o.prio:e.prio!==i?e.prio:0,once:o.once!==i?o.once:e.once!==i&&e.once,buffer:o.buffer||e.buffer,throttle:o.throttle||e.throttle,$internal:e.$internal,catchAll:"catchAll"===n};if(c){const{alt:i}=c,o=i?c.delay:c,a=e.name||n,d=()=>{s.un(l,u),i&&!u.called&&s.callback(i,t)};s.isDelayable?s.setTimeout({fn:d,name:a,cancelOutstanding:!0,delay:o}):r.setTimeout(d,o)}let h=d[l]||(d[l]=[]);h.$firing&&(d[l]=h=h.slice()),h.splice(H.findInsertionIndex(u,h,Ue,h.length),0,u),!s.onListen.$nullFn&&h.length<2&&s.onListen(l),null===(a=s.afterAddListener)||void 0===a||a.call(s,l,u)}}e.relayAll&&s.relayAll(e.relayAll),t&&t!==s&&s.attachAutoDetacher(e,t);const n=!1!==e.detachable,c=e.name,d=e.expires||n||c?()=>{s.isDestroyed||s.removeListener(e,t)}:null;var l;if(d)if(d.eventer=s,d.listenerName=c,c&&null!==(l=t)&&void 0!==l&&l.trackDetacher&&t.trackDetacher(c,d),e.expires&&s.delay(d,isNaN(e.expires)?e.expires.delay:e.expires,c),n)return d}}on(e,t,n){return this.addListener(e,t,n)}ion(e){return e.$internal=!0,this.on(e)}un(...e){this.removeListener(...e)}updateInternalListeners(e,t){null==t||t.detach(),e&&(e.detach=this.ion(e))}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring){if(Array.isArray(e))for(let t=0,n=e[0],{length:r}=e;t<r;n=e[++t])"thisObj"in n||(e[t]=p.assign({thisObj:this},n));else e&&!("thisObj"in e)&&(e=p.assign({thisObj:this},e));return e}this.getConfig("internalListeners"),e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,n){const r=this;if("string"==typeof e)return r.removeListener({[e]:t},n);Object.entries(e).forEach((([e,n])=>{if(!We[e]&&null!=n){e=e.toLowerCase();const{eventListeners:s}=r,o=r.findListener(e,n,t);if(o>=0){var i;let t=s[e];null===(i=r.afterRemoveListener)||void 0===i||i.call(r,e,t[o]),t.length>1?(t.$firing&&(s[e]=t=t.slice()),t.splice(o,1)):(delete s[e],r.onUnlisten.$nullFn||r.onUnlisten(e))}}})),e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)}findListener(e,t,n){var r;const i=null===(r=this.eventListeners)||void 0===r?void 0:r[e],s=t.fn||t,o=t.thisObj||n;if(i)for(let e,t=0,{length:n}=i;t<n;t++)if(e=i[t],e.fn===s&&e.thisObj===o)return t;return-1}hasListener(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:r}=this;e.ion({beforeDestroy:({source:t})=>{if(t===e){r.filter((t=>t.through===e)).forEach((e=>H.remove(r,e)))}}}),r.push({through:e,prefix:t,transformCase:n})}removeAllListeners(e=!0){const t=this.eventListeners;let n,r;for(const a in t){const l=t[a];for(n=l.length;n-- >0;){const t=l[n];var i,s,o;if(!t.$internal||!e)this.removeListener(a,t),r=t.thisObj,null===(i=r)||void 0===i||null===(s=(o=i).untrackDetachers)||void 0===s||s.call(o,this)}}}relayEvents(e,t,n=""){const r={detachable:!0,thisObj:this};return t.forEach((e=>{r[e]=(t,...r)=>this.trigger(n+e,t,...r)})),e.on(r)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:e,target:t,oldDestructor:n}=this;for(let n=0;n<e.length;n++){const{dispatcher:r,config:i}=e[n];r.isDestroyed||r.removeListener(i,t)}n.call(t)}attachAutoDetacher(e,t){const n=e.thisObj||t,r="doDestroy"in n?"doDestroy":"destroy";if(r in n){let{$autoDetachers:t}=n;t||(n.$autoDetachers=t=[]),n.$oldDestructor||(n.$oldDestructor=n[r],n[r]=this.destructorInterceptor.bind({autoDetachers:t,oldDestructor:n.$oldDestructor,target:n})),t.push({config:e,dispatcher:this})}else n[r]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj;t.$oldDestructor&&!t.isDestroying&&(H.remove(t.$autoDetachers,t.$autoDetachers.find((t=>t.config===e&&t.dispatcher===this))),t.$autoDetachers.length||(t["doDestroy"in t?"doDestroy":"destroy"]=t.$oldDestructor,t.$oldDestructor=null))}once(e,t){return this.on({[e]:()=>this.callback(t),once:!0})}await(e,t={checkLog:!0,resetLog:!0,args:null}){const n=this;!1===t&&(t={checkLog:!1});const{args:r}=t;return new Promise((i=>{var s;if(t.checkLog&&null!==(s=n._triggered)&&void 0!==s&&s[e]&&(i(),t.resetLog&&n.clearLog(e)),r){const s=n.on({[e]:(...o)=>{("function"==typeof r?r(...o):Object.keys(r).every((e=>e in o[0]&&o[0][e]===r[e])))&&(i(...o),t.resetLog&&n.clearLog(e),s())},prio:-1e4})}else n.on({[e]:(...r)=>{i(...r),t.resetLog&&n.clearLog(e)},prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}trigger(e,t){var n,r,i,s,o;const a=this,l=e.toLowerCase(),{eventsSuspended:c,relayAllTargets:d,callOnFunctions:u}=a;let h,g,m=null===(n=a.eventListeners)||void 0===n?void 0:n[l];if(a._triggered||(a._triggered={}),a._triggered[e]=!0,c)return c.shouldQueue&&c.queue.push(arguments),!0;if(null!==(r=a.eventListeners)&&void 0!==r&&r.catchall&&((m=m?m.slice():[]).push(...a.eventListeners.catchall),m.sort(Ue)),!m&&!d&&!u)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=a:t=Object.setPrototypeOf({source:a},t)):t={source:a},t.type!==l&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>l}):t.type=l),t.eventName=e,!("bubbles"in t)&&null!==(i=a.bubbleEvents)&&void 0!==i&&i[e]&&(t.bubbles=a.bubbleEvents[e]),u){const n="on"+$.capitalize(e);if(n in a){var f;const e=!a[n]||a.callback(a[n],a,[t]);let r;if(p.isPromise(e)?(h||(h=[])).push(e):r=!1===e||r,!a.isDestroyed&&ze.call(a,n)&&(null===(f=a.pluginFunctionChain)||void 0===f||!f[n])){const e=Object.getPrototypeOf(a);if(n in e){const i=e[n].call(a,t);if(p.isPromise(i)?(h||(h=[])).push(i):r=!1===i||r,a.isDestroyed)return}}if(r)return!1}}if(m){let e=0,n=!1;for(m.$firing=!0;e<m.length&&!a.isDestroyed&&!n;e++){const r=m[e];if(!1===g&&!r.$internal)continue;let i,s=r.thisObj;if(!s||!s.isDestroyed){if(r.called=!0,r.once&&a.removeListener(l,r),"string"==typeof r.fn){if(s&&(i=s[r.fn]),!i){const e=a.resolveCallback(r.fn);i=e.handler,s=e.thisObj}}else i=r.fn;if(r.buffer){if(!r.bufferFn){const e=Number(r.buffer);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for buffer, got "${e}" (expected a Number)`);r.bufferFn=Me.createBuffered(i,e,s,r.args)}i=r.bufferFn}if(r.throttle){const e=Number(r.throttle);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for throttle, got "${e}" (expected a Number)`);r.throttledFn||(r.throttledFn=Me.createThrottled(i,e,s,r.args)),i=r.throttledFn}const e=i.call(s||a,...r.args||[],t);!1!==g&&(g=e),r.$internal&&!1===e&&(n=!0),p.isPromise(e)&&(e.$internal=r.$internal,(h||(h=[])).push(e))}}if(m.$firing=!1,n)return!1}return null==d||d.forEach((n=>{let r=e;if(n.transformCase&&(r=$.capitalize(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1})),t.bubbles&&a.owner&&!a.owner.isDestroyed?a.owner.trigger(e,t):(h=null===(s=h)||void 0===s?void 0:s.filter((e=>!1!==g||e.$internal)),null!==(o=h)&&void 0!==o&&o.length?new Promise((e=>{Promise.all(h).then((t=>{const n=!t.some((e=>!1===e));e(n)}))})):!1!==g)}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};const Ye="undefined"!=typeof self?self:void 0!==r?r:null;class qe{static skipLocaleIntegrityCheck=!1;static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((n=>{"object"==typeof e[n]?t[n]={...t[n],...e[n]}:t[n]=e[n]}))})),t}static trimLocale(e,t){const n=(t,n)=>{e[t]&&(n?e[t][n]&&delete e[t][n]:delete e[t])};Object.keys(t).forEach((e=>{Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((t=>n(e,t))):n(e)}))}static normalizeLocale(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if("string"==typeof e){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;let n={};if(t.name||t.locale)n=Object.assign({localeName:t.name},t.locale),t.desc&&(n.localeDesc=t.desc),t.code&&(n.localeCode=t.code),t.path&&(n.localePath=t.path);else{if(!t.localeName)throw new Error('"config" parameter doesn\'t have "localeName" property');n=Object.assign({},t)}for(const e of["name","desc","code","path"])n[e]&&delete n[e];if(!n.localeName)throw new Error("Locale name can not be empty");return n}static get locales(){return Ye.bryntum.locales||{}}static set locales(e){Ye.bryntum.locales=e}static get localeName(){return Ye.bryntum.locale||"En"}static set localeName(e){Ye.bryntum.locale=e||qe.localeName}static get locale(){return qe.localeName&&this.locales[qe.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,t){const{locales:n}=Ye.bryntum,r=qe.normalizeLocale(e,t),{localeName:i}=r;return n[i]&&!0!==t?n[i]=this.mergeLocales(n[i]||{},r||{}):n[i]=r,n[i]}}Ye.bryntum=Ye.bryntum||{},Ye.bryntum.locales=Ye.bryntum.locales||{},qe._$name="LocaleHelper";class Ke extends(Ge(ye)){static get defaultConfig(){return{throwOnMissingLocale:_.isTestEnv}}construct(...e){const t=this;if(super.construct(...e),o.isBrowserEnv){var n;const e=document.querySelector("script[data-default-locale]");e?t.applyLocale(e.dataset.defaultLocale):null!==(n=t.locale)&&void 0!==n&&n.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return qe.locales}set locales(e){qe.locales=e}set locale(e){this.applyLocale(e)}get locale(){return qe.locale}registerLocale(e,t){_.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),qe.publishLocale(e,t)}extendLocale(e,t){_.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const n=qe.publishLocale(e,t);return this.applyLocale(n,!0)}applyLocale(e,t,n=!1){const r=this;let i;if("string"==typeof e)if("object"!=typeof t){if(i=r.locales[e],!i){if(n)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else i=qe.publishLocale(e,t);else i=qe.publishLocale(e);if(r.locale.localeName&&r.locale.localeName===i.localeName&&!0!==t)return r.locale;qe.localeName=i.localeName;const s=()=>{r.trigger("locale",i)};return i.localePath?new Promise(((e,t)=>{r.loadLocale(i.localePath).then((t=>{t.text().then((t=>{new Function(t)(),o.isBrowserEnv&&(i=r.locales[i.localeName],i&&delete i.localePath),s(),e(i)}))})).catch((e=>t(e)))})):(s(),i)}loadLocale(e){return Se.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const Xe=new Ke,Ze=Object.getPrototypeOf(Object),Je=/L{.*?}/g,Qe=/L{(.*?)}/g,et=/((.*?)\.)?(.+)/g,tt=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),nt=Object.freeze(Object.create(null));var rt=e=>class t extends(e||ye){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,n;return"string"==typeof e?e:e===Ze?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(n=e.prototype)||void 0===n?void 0:n.name)}static parseLocaleString(e){var t;const n=[];let r;if(null!==(t=e)&&void 0!==t&&t.includes("L{"))for(e=e.replace(/{(\d+)}/gm,"[[$1]]"),Qe.lastIndex=0;null!=(r=Qe.exec(e));){et.lastIndex=0;const e=et.exec(r[1]);n.push({match:tt(r[0]),localeKey:tt(e[3]),localeClass:e[2]})}return n.length>0?n:[{match:e,localeKey:e,localeClass:i}]}construct(e={},...t){super.construct(e,...t),Xe.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var n,r,s;const o=this,a=p.getPath(o,e),l=(null===(n=o.$meta.configs[e])||void 0===n?void 0:n.localeKey)||(null===(r=o.fieldMap)||void 0===r||null===(s=r[e])||void 0===s?void 0:s.defaultValue);let c;return l?(c=t.localize(l,o,o.localeClass||o),c&&!(e in(o.initialConfig||nt))&&p.setPath(o.isColumn?o.data:o,e,c)):"string"==typeof a&&(o.originalLocales=o.originalLocales||{},c=p.getPath(o.originalLocales,e),c===i&&(p.setPath(o.originalLocales,e,a),c=a),c&&p.setPath(o,e,c=o.optionalL(c,o))),c||a}updateLocalization(){var e,t;!1!==this.localizable&&(null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this),null===(t=this.trigger)||void 0===t||t.call(this,"localized"))}static getTranslation(e,n,r){const i=Xe.locale;let s,o,a=null;if(i)for(const{match:l,localeKey:c,localeClass:d}of this.parseLocaleString(e)){const u=t=>{var s;const o=null===(s=i[t])||void 0===s?void 0:s[c];return o&&(a="function"==typeof o?null!=n?o(n):o:"object"==typeof o||e===l?o:(a||e).replace(l,o),"string"==typeof o&&o.includes("L{")&&(a=this.getTranslation(o,n,r))),o};let h=!1;for(o=r;o&&(s=t.clsName(o))&&!(h=u(s))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!h&&d&&u(d)}return a}static localize(e,n=i,...r){var s;0===(null===(s=r)||void 0===s?void 0:s.length)&&(r=[this]);let o=null;return r.some((r=>(o=t.getTranslation(e,n,r),null!=o))),o}static L(e,n=i,...r){var s;0===(null===(s=r)||void 0===s?void 0:s.length)&&(r=[this]);const o=this.localize(e,n,...r);if(null==o&&Xe.throwOnMissingLocale&&e.includes("L{"))throw new Error(`Localization is not found for '${e}' in '${r.map((e=>t.clsName(e))).join(", ")}'. ${Xe.locale.localeName?`Locale : ${Xe.locale.localeName}`:""}`);return o??e}L(e,n){const{localeClass:r,constructor:i}=this;return r&&t.clsName(r)!==t.clsName(i)?t.L(e,n,r,i):t.L(e,n,i)}static optionalL(e,n=i,...r){var s;const o=Xe.throwOnMissingLocale;Xe.throwOnMissingLocale=o&&Je.test(e),0===(null===(s=r)||void 0===s?void 0:s.length)&&(r=[this]);const a=t.L(e,n,...r);return Xe.throwOnMissingLocale=o,a}optionalL(e,t=this,n=!1){const r=Xe.throwOnMissingLocale;Xe.throwOnMissingLocale=r&&Je.test(e)&&!n;const i=this.L(e,t);return Xe.throwOnMissingLocale=r,i}get localeManager(){return Xe}get localeHelper(){return qe}};qe.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week",None:"None"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater or equals",isLessThanOrEqualTo:"less or equals",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select property",selectAnOperator:"Select operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectValue:"Select value",selectOneOrMoreValues:"Select value(s)",enterAValue:"Enter value",enterANumber:"Enter number",selectADate:"Select date",selectATime:"Select time"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t}}});const{toString:it}=Object.prototype,st=it.call(new Date),ot=new Date,at=36e5,lt=(e,t)=>isNaN(e)||null==e?t:e,ct=/([ES]){([^}]+)}/g,dt=e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t},ut=(e,t,n)=>(St[e]||(St[e]=new Intl.DateTimeFormat(vt,t))).format(n),ht=(e,t,n,r=!1)=>{let i=ut(e,t,n);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),r&&(i=i.replace(/:00/,""))),i},gt=e=>e>=0?e:e+7,mt=/([^\w])(S+)/gm,pt=(e,t)=>t+"SSS",ft=/[:.\-/\s]/;let vt="en-US",yt=dt,bt={},Ct={},St={},Dt={};const wt=e=>{const t=Et[e];if(!t)throw new Error("Only international formats should be used here");if(Ct[e]!==i)return Ct[e];const n=new Intl.DateTimeFormat(vt,t).formatToParts(new Date(2001,1,2,3,4,5,6)).map((e=>{const n=e.type,r=t[n];return"literal"===n?e.value.replace(/,/g,""):"day"===n?"numeric"===r?"D":"DD":"month"===n?"short"===r?"MMM":"long"===r?"MMMM":"numeric"===r?"M":"MM":"year"===n?"numeric"===r?"YYYY":"YY":void 0})).join("");return Ct[e]=n},Et={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},xt={M:e=>e.getMonth()+1,Mo:e=>yt(xt.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>ut("MMM",{month:"short"},e),MMMM:e=>ut("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>yt(xt.Q(e).toString()),D:e=>e.getDate(),Do:e=>yt(xt.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/Pt.day.millisecond),DDDo:e=>yt(xt.DDD(e).toString()),DDDD:e=>xt.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>yt(e.getDay().toString()),d1:e=>ut("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>xt.ddd(e).substring(0,2),ddd:e=>ut("ddd",{weekday:"short"},e),dddd:e=>ut("dddd",{weekday:"long"},e),u:e=>{const t=(St.u||(St.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}))).formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const t=(St.uu||(St.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))).formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>Gt.getWeekNumber(e)[1],Wo:e=>yt(xt.W(e).toString()),WW:e=>xt.W(e).toString().padStart(2,"0"),Wp:e=>`${Gt.localize("L{Week}")} ${xt.W(e)}`,WWp:e=>`${Gt.localize("L{Week}")} ${xt.WW(e)}`,Wp0:e=>`${Gt.localize("L{Week}")[0]}${xt.W(e)}`,WWp0:e=>`${Gt.localize("L{Week}")[0]}${xt.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>(e.getFullYear()%100).toString().padStart(2,"0"),YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>xt.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>xt.k(e).toString().padStart(2,"0"),K:e=>ht("K",{hour:"numeric"},e),KK:e=>ht("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>xt.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>xt.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>ut("z",{timeZoneName:"short"},e),zz:e=>ut("zz",{timeZoneName:"long"},e),Z:e=>Yt.getGMTOffset(e),LT:e=>ht("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>ht("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>ht("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>ut("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>ut("l",Et.l,e),LL:e=>ut("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>ut("ll",Et.ll,e),LLL:e=>ut("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>ut("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>ut("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>ut("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},Rt=`^(?:${Object.keys(xt).sort(((e,t)=>t.length-e.length)).join("|")})`,Tt=()=>({}),Mt=e=>(e=>Ht.test(e))(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},kt={YYYY:e=>{const t=parseInt(e);return{year:t>=1e3&&t<=9999?t:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const t=(e||"").toLowerCase();for(const[e,n]of Object.entries(Gt._monthShortNamesIndex))if(t.startsWith(e))return{month:n.value}},MMMM:e=>{const t=(e||"").toLowerCase();for(const[e,n]of Object.entries(Gt._monthNamesIndex))if(t.startsWith(e))return{month:n.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:Tt,DDDo:Tt,DDDD:Tt,d:Tt,do:Tt,d1:Tt,dd:Tt,ddd:Tt,dddd:Tt,Q:Tt,Qo:Tt,W:Tt,Wo:Tt,WW:Tt,e:Tt,E:Tt,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:Mt,SS:Mt,SSS:Mt,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>wt("l")},ll:{type:"dynamic",parser:()=>wt("ll")},Z:e=>{if(!e||!Nt.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const n=Nt.exec(e);if(n){t=("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},It=Object.keys(kt).sort(((e,t)=>t.length-e.length)),At=new RegExp(`(${It.join("|")})`),Ft=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),Pt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Ot={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},Lt=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,$t=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,_t=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],jt=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],Bt=["decade","year","month","week","day","hour","minute","second","millisecond"],Vt=["milliseconds","seconds","minutes","hours","date","month","year"],Ht=/^[0-9]+$/,Nt=/([+-])(\d\d):*(\d\d)*$/,zt={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Wt={round:(e,t=1)=>Math.round(e/t)*t,floor:(e,t=1)=>Math.floor(e/t)*t,ceil:(e,t=1)=>Math.ceil(e/t)*t},Ut={};class Gt extends(rt()){static MS_PER_DAY=864e5;static get $name(){return"DateHelper"}static set defaultFormat(e){Yt._defaultFormat=e}static get defaultFormat(){return Yt._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(At),n=[];return 1===t.length||Ft.test(e)?[]:(t.reduce(((t,r,i,s)=>{if(0!==i||""!==r)if(At.test(r)){const o=(this.localize("L{parsers}")||{})[r]||kt[r];if("Z"===r&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const a="function"==typeof o||"string"==typeof o?o:o.parser();if("string"==typeof a){const e=Yt.buildParser(a),r=e.pop();delete r.last,n.push(...e),t=r}else t.pattern=r,t.fn=a}else t.splitter=r,n.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&n.push(t);return t}),{}),n[n.length-1].last=!0,n)}static makeKey(e){if(10===e.length)return e;e.getTime&&(e=e.getTime());const t=Ut[Math.trunc(e/at)];if(t)return t;ot.setTime(e);const n=ot.getMonth()+1,r=ot.getDate();return Ut[Math.trunc(e/at)]=`${ot.getFullYear()}-${n<10?"0"+n:n}-${r<10?"0"+r:r}`}static parseKey(e){return Yt.parse(e,"YYYY-MM-DD")}static parse(e,t=Yt.defaultParseFormat,n=!1){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(mt,pt);let i,s=Dt[t];if(s||(s=Dt[t]=Yt.buildParser(t)),e.includes(" ")&&(e=e.replace(/\s/g," ")),s.reduce(((e,t)=>{if(!t.last){let s,o,a;if("T"===t.splitter&&-1===e.indexOf("T"))s=e.indexOf(" ");else{var i;const r=e.indexOf("+");let{splitter:o}=t;!n&&ft.test(o)&&(o=ft),s=""!==t.splitter?e.search("string"==typeof o?$.escapeRegExp(o):o):(null===(i=t.pattern)||void 0===i?void 0:i.length)||-1,r>-1&&s>r&&(s=-1)}if(-1===s||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(o=e,a=""):(o=t[0],a=`${t[1]}${t[2]}`)}else o=e.substring(0,s)||e,a=e.substring(s+t.splitter.length);if(t.fn){const e=t.fn(o);e?Object.assign(r,e):a=o+a}return a}Object.assign(r,t.fn(e))}),e),r.year&&!r.date&&(r.date=1),r.date>31||r.month>12)return null;const o=Yt.create(r,n);return o?i=o:n||(i=new Date(e)),i}static create(e,t=!1){const n={...e};let r=isNaN(n.year)||t&&(isNaN(n.month)||isNaN(n.date)),i=!1;if(!r){let e=!0;Vt.forEach((t=>{t in n&&!isNaN(n[t])||(n[t]=0),e=e&&null===n[t]})),r=e}if(r)return null;if("am"===n.amPm?n.hours=n.hours%12:"pm"===n.amPm&&(n.hours=n.hours%12+12),"timeZone"in n&&(i=!0,n.minutes-=n.timeZone),t&&(null==n.year||null==n.month||null==n.date))return null;const s=[lt(n.year,2020),lt(n.month,0),lt(n.date,1),n.hours,n.minutes,n.seconds,n.milliseconds];return i?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=Yt.defaultFormat){if(!e||isNaN(e))return null;let n=bt[t],r="";if(!n){n=bt[t]=[];for(let e=0;e<t.length;e++){const r=t.slice(e).match(Rt),i=null==r?void 0:r[0];if(i){const t=(this.localize("L{formats}")||{})[i]||xt[i];n.push(t),e+=i.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach((t=>{r+="string"==typeof t?t:t(e)})),r}static formatRange(e,t){return t.replace(ct,((t,n,r)=>Gt.format(e["S"===n?0:1],r)))}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),Yt.as("millisecond",e,t)}static asMonths(e){const t=Yt.as("ms",Yt.daysInMonth(e),"day"),n=(e.valueOf()-Yt.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+n}static monthsToDate(e){const t=Math.floor(e),n=e-t,r=new Date(0,t),i=Yt.as("ms",Yt.daysInMonth(r),"days");return r.setTime(r.getTime()+n*i),r}static formatDelta(e,t){let n,r;"boolean"==typeof t?n=t:t&&(n=t.abbrev);const i=this.getDelta(e,t),s=[],o=(null==t?void 0:t.separator)||(n?"":" ");for(r in i)s.push(`${i[r]}${o}${r}`);return!1===(null==t?void 0:t.asString)?s:s.join(", ")}static getDelta(e,t){let n,r,i,s,o,a,l;"boolean"==typeof t?n=t:t&&(n=t.abbrev,s=Yt.normalizeUnit(t.precision),a=t.maxUnit,l=!n&&t.ignoreLocale);const c={},d=n?Yt.getShortNameOfUnit:Yt.getLocalizedNameOfUnit,u=a?Bt.slice(Bt.indexOf(a)):Bt;for(o of u)if(r=Yt.as(o,e),i=s===o,r=Math[i?"round":"floor"](r),(r||i&&!c.length)&&(c[l?o:d.call(Yt,o,1!==r)]=r,e-=Yt.as("ms",r,o)),i||!e)break;return c}static as(e,t,n="ms"){return"string"==typeof t&&(t=Yt.parseDuration(t)),"object"==typeof t&&(n=t.unit,t=t.magnitude),e===n||(e=Yt.normalizeUnit(e))===(n=Yt.normalizeUnit(n))?t:zt[n]>zt[e]?t*Math.abs(Pt[n][e]):t/Math.abs(Pt[e][n])}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return Yt.format(Yt.getTime(13,0,0),e).includes("13")}static add(e,t,n="ms",r=!0){let i;if(i="string"==typeof e?Yt.parse(e):r?new Date(e.getTime()):e,"string"==typeof t){const e=Gt.parseDuration(t);t=e.magnitude,n=e.unit}else t&&"object"==typeof t&&(n=t.unit,t=t.magnitude);if(!n||0===t)return i;switch(n=Yt.normalizeUnit(n)){case"millisecond":i.setTime(i.getTime()+t);break;case"second":i.setTime(i.getTime()+1e3*t);break;case"minute":i.setTime(i.getTime()+6e4*t);break;case"hour":i.setTime(i.getTime()+36e5*t);break;case"day":t%1==0?(i.setDate(i.getDate()+t),23===i.getHours()&&0===e.getHours()&&i.setHours(i.getHours()+1)):i.setTime(i.getTime()+864e5*t);break;case"week":i.setDate(i.getDate()+7*t);break;case"month":{let e=i.getDate();e>28&&(e=Math.min(e,Yt.getLastDateOfMonth(Yt.add(Yt.getFirstDateOfMonth(i),t,"month")).getDate())),i.setDate(e),i.setMonth(i.getMonth()+t);break}case"quarter":Yt.add(i,3*t,"month",!1);break;case"year":i.setFullYear(i.getFullYear()+t);break;case"decade":i.setFullYear(i.getFullYear()+10*t)}return i}static diff(e,t,n="ms",r=!0){if(n=Yt.normalizeUnit(n),!e||!t)return 0;let i;switch(n){case"year":i=Yt.diff(e,t,"month")/12;break;case"quarter":i=Yt.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth()),0===i&&r&&(i=Yt.diff(e,t,"day",r)/Yt.daysInMonth(e));break;case"week":i=Yt.diff(e,t,"day")/7;break;case"day":{const n=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*n*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return r?i:Math.round(i)}static startOf(e,t="day",n=!0,r=Yt.weekStartDay){if(!e)return null;switch(t=Yt.normalizeUnit(t),n&&(e=Yt.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth(3*(Yt.get(e,"quarter")-1),1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const t=e.getDay()-r;return e.setDate(e.getDate()-t),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let n=Yt.clearTime(e);return t&&n<e&&(n=Yt.add(n,1,"d")),n}static getTimeOfDay(e,t="ms"){const n=e.getHours()*Pt.hour.millisecond+e.getMinutes()*Pt.minute.millisecond+e.getSeconds()*Pt.second.millisecond+e.getMilliseconds();return"ms"===t?n:Yt.as(t,n,"ms")}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(Yt.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort(((e,t)=>zt[e[0]]-zt[t[0]])).forEach((([t,n])=>{Yt.set(e,t,n)}));return e}static setDateToMidday(e,t=!0){return Yt.set(Yt.clearTime(e,t),"hour",12)}static constrain(e,t,n){return null!=t&&(e=Yt.max(e,t)),null==n?e:Yt.min(e,n)}static getTime(e,t=0,n=0,r=0){return e instanceof Date&&(r=e.getMilliseconds(),n=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,n,r)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static get isDSTEnabled(){const e=(new Date).getFullYear(),t=new Date(e,0,1),n=new Date(e,6,1);return t.getTimezoneOffset()!==n.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(n.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e&&t&&e.getTime()===t.getTime():Yt.startOf(e,n)-Yt.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=Yt.startOf(e,n),t=Yt.startOf(t,n)),e<t?-1:e>t?1:0}static clamp(e,t,n){if(!isNaN(e))return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),new Date(e)}static isSameDate(e,t){return 0===Yt.compare(e,t,"d")}static isSameTime(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}static isStartOf(e,t){return Yt.isEqual(e,Yt.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return Yt.betweenLesser(e,n,r)||Yt.betweenLesser(n,e,t)}static compareUnits(e,t){return Math.sign(zt[Yt.normalizeUnit(e)]-zt[Yt.normalizeUnit(t)])}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get weekStartDay(){return null==Yt._weekStartDay&&(Yt._weekStartDay=this.localize("L{weekStartDay}")||0),Yt._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,t){switch(Yt.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return xt.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),n=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",n)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r+1)-new Date(t,n,r);return this.as("hour",i)}static getNormalizedUnitDuration(e,t){let n;switch(t){case"month":n=Yt.asMilliseconds(Yt.daysInMonth(e),"day");break;case"year":n=Yt.asMilliseconds(Yt.daysInYear(e),"day");break;case"day":n=Yt.asMilliseconds(Yt.hoursInDay(e),"hour");break;default:n=Yt.asMilliseconds(t)}return n}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=Yt.weekStartDay){if("week"===t){const t=Yt.clone(e),i=t.getDay();return Yt.startOf(t,"day",!1),Yt.add(t,r-i+7*(n-(r<=i?0:1)),"day",!1),t.getDay()!==r&&Yt.add(t,1,"hour"),t}return Yt.startOf(Yt.add(e,n,t),t,!1)}static isValidDate(e){return Yt.isDate(e)&&!isNaN(e)}static isDate(e){return e&&it.call(e)===st}static getStartOfNextDay(e,t=!1,n=!1){let r=Yt.add(n?e:Yt.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){const n=Yt.add(Yt.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();r=Yt.add(r,i-n,"minute")}return r}static getEndOfPreviousDay(e,t=!1){const n=t?e:Yt.clearTime(e,!0);return n-e?n:Yt.add(n,-1,"day")}static getWeekDescription(e,t=e){const n=e.getMonth()===t.getMonth()?Gt.format(e,"MMMM"):`${Gt.format(e,"MMM")} - ${Gt.format(t,"MMM")}`,r=Gt.getWeekNumber(e);return`${r[1]}, ${n} ${r[0]}`}static getWeekNumber(e,t=Gt.weekStartDay){const n=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),11,31),i=gt(n.getDay()-t),s=gt(r.getDay()-t),o=(a=e,l=n,Math.floor((a.getTime()-l.getTime()-(a.getTimezoneOffset()-l.getTimezoneOffset())*Pt.minute.millisecond)/Pt.day.millisecond)+1);var a,l;let c;if(c=i<4?Math.floor((o+i-1)/7)+1:Math.floor((o+i-1)/7),c){let t=e.getFullYear();return 53===c&&s<3&&(t++,c=1),[t,c]}const d=Gt.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,d]}static formatCount(e,t){return t=Yt.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,n=!1){return(e=Yt.normalizeUnit(e))===(t=Yt.normalizeUnit(t))?1:Pt[e]&&Pt[e][t]&&(n||Pt[e][t]>0)?1/Yt.as(t,1,e):Pt[t]&&Pt[t][e]&&(n||Pt[t][e]>0)?Yt.as(e,1,t):-1}static getShortNameOfUnit(e){return e=Yt.parseTimeUnit(e),Yt.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const n=e.charAt(0)===e.charAt(0).toUpperCase();return e=Yt.normalizeUnit(e),e=Yt.parseTimeUnit(e),e=Yt.unitLookup[e][t?"plural":"single"],n&&(e=$.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||_t.includes(t)?t:Ot[e]||Ot[t]}static getUnitByName(e){return Yt.normalizeUnit(e)||Yt.normalizeUnit(Yt.parseTimeUnit(e))}static getDurationInUnit(e,t,n,r){return Yt.diff(e,t,n,r)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){return _t[zt[Yt.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return _t[zt[Yt.normalizeUnit(e)]+1]||null}static round(e,t,n,r){return Yt.snap("round",e,t,n,r)}static floor(e,t,n,r){return Yt.snap("floor",e,t,n,r)}static ceil(e,t,n,r){return Yt.snap("ceil",e,t,n,r)}static snap(e,t,n,r,i=Yt.weekStartDay){const s=Wt[e];if("string"==typeof n&&(n=Yt.parseDuration(n)),p.isObject(n)){const o=n.magnitude||n.increment;switch(n.unit){case"week":if(!r){const e=t.getDay();r=Yt.add(Yt.clearTime(t),e>=i?i-e:-(e-i+7),"day")}return Yt[e](t,7*o+" days",r);case"month":{let e;return t=Yt.asMonths(t),e=r?(r=Yt.asMonths(r))+s(t-r,o):s(t,o),Yt.monthsToDate(e)}case"quarter":return Yt[e](t,3*o+" months",r);case"year":return Yt[e](t,12*o+" months",r);case"decade":return Yt[e](t,10*o+" years",r)}n=Yt.as("ms",o,n.unit)}const o=1e3*t.getTimezoneOffset()*60;if(r){const e=1e3*r.getTimezoneOffset()*60,i=t-r+e-o,a=new Date(r.getTime()+s(i,n)),l=e-1e3*a.getTimezoneOffset()*60;return l&&Yt.add(a,-l,"ms",!1),new Date(a)}return new Date(s(t.valueOf()-o,n)+o)}static parseDuration(e,t=!0,n){var r;const i=(t?Lt:$t).exec(e);if(null==e||!i)return null;const s=(e=>{const t=parseFloat(e);return isNaN(t)?null:t})(null===(r=i[1])||void 0===r?void 0:r.replace(",",".")),o=Yt.parseTimeUnit(i[2])||n;return o?{magnitude:s,unit:o}:null}static parseTimeUnit(e){const t=null==e?null:Yt.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<_t.length;e++)if(t[e+1])return _t[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=Yt._dayNames||[],n=Yt._dayShortNames||[];t.length=0,n.length=0;for(let r=2;r<9;r++)e.setDate(r),t.push(Yt.format(e,"dddd")),n.push(Yt.format(e,"ddd"));Yt._dayNames=t,Yt._dayShortNames=n}static getDayNames(){return Yt._dayNames}static getDayName(e){return Yt._dayNames[e]}static getDayShortNames(){return Yt._dayShortNames}static getDayShortName(e){return Yt._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=Yt._monthNames||[],n=Yt._monthShortNames||[],r={},i={};t.length=0,n.length=0;for(let s=0;s<12;s++){e.setMonth(s);const o=Yt.format(e,"MMMM");t.push(o);const a=Yt.format(e,"MMM");n.push(a),r[o.toLowerCase()]={name:o,value:s},i[a.toLowerCase()]={name:a,value:s}}Yt._monthNames=t,Yt._monthShortNames=n,Yt._monthNamesIndex=r,Yt._monthShortNamesIndex=i}static getMonthShortNames(){return Yt._monthShortNames}static getMonthShortName(e){return Yt._monthShortNames[e]}static getMonthNames(){return Yt._monthNames}static getMonthName(e){return Yt._monthNames[e]}static set locale(e){vt=e,St={},bt={},Ct={}}static get locale(){return vt}static setupDurationRegEx(e=[],t=[]){const n=this,r={};let i="";for(let s=0;s<t.length;s++){const o=t[s],a=e[s];a.canonicalUnitName=_t[s],r[a.single]=r[a.single.toUpperCase()]=r[a.canonicalUnitName]=r[a.canonicalUnitName.toUpperCase()]=a,i+=(s?"|":"")+"(";for(let e=0;e<o.length;e++)i+=`${o[e]}|`;if(vt=n.localize("L{locale}")||"en-US","en-US"!==vt){const e=jt[s];for(let t=0;t<e.length;t++)i+=`${e[t]}|`}i+=`${a.single}|${a.plural}|${a.canonicalUnitName}|${a.canonicalUnitName}s)`}n.unitLookup=r,n.durationRegEx=new RegExp(`^(?:${i})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],n=e.unitNames=e.localize("L{unitNames}");"unitNames"!==n&&(vt=e.localize("L{locale}")||"en-US",yt="en-US"===vt?dt:e.localize("L{ordinalSuffix}")||yt,bt={},Ct={},Dt={},St={},Yt._weekStartDay=null,Yt.setupDurationRegEx(n,t),Yt.fillDayNames(),Yt.fillMonthNames())}}const Yt=Gt;Yt.useIntlFormat=ut,Xe.ion({locale:"applyLocale",prio:1e3,thisObj:Yt}),Xe.locale&&Yt.applyLocale(),Gt._$name="DateHelper";const{hasOwn:qt}=p,Kt="1.01"===1.005.toFixed(2)?null:function(e,t){const n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)};class Xt extends p{static transformArrayToNamedObject(e,t="ref"){const n={};return e.forEach(((e,r)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:r;n[i]=e})),n}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((n=>{const r=e[n];return r[t]=n,r}))}static isEqual(e,t,n=!1){if(null===e&&null!==t||e===i&&t!==i||null===t&&null!==e||t===i&&e!==i)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const r=typeof e;if(r===typeof t){switch(r){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,r)=>Zt.isEqual(e,t[r],n)));case"object"===r&&e.constructor.prototype===t.constructor.prototype:return n?Zt.isDeeplyEqual(e,t,n):$.safeJsonStringify(e,"circular")===$.safeJsonStringify(t,"circular")}}return String(e)===String(t)}static isDeeplyEqual(e,t,n={}){if(e===t)return!0;if(!e||!t)return!1;const r=Zt.keys(e,n.ignore),i=Zt.keys(t,n.ignore);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++){const o=r[s],a=i[s];if(o!==a)return!1;const l=e[o],c=t[a];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(n.evaluate){const r=n.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===r)return!1;if(!0===r)continue}if(!Zt.isEqual(l,c,n))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?Gt.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?Gt.isAfter(e,t):e>t}static fork(e){let t,n,r;if(e&&e.constructor===Object)for(n in t=Object.setPrototypeOf({},e),e)r=e[n],r&&(r.constructor===Object?t[n]=Zt.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static copyProperties(e,t,n){let r,i;for(i=0;i<n.length;i++)r=n[i],r in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,n){if(t)for(const r of n)!(r in e)&&r in t&&(e[r]=t[r]);return e}static entries(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push([i,e[i]]);return n}static fromEntries(e,t){if(t=t||{},e)for(let n=0;n<e.length;++n)t[e[n][0]]=e[n][1];return t}static keys(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(o,s):o),++s)}return r}static values(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(e[o],s):e[o]),++s)}return r}static pathExists(e,t){return t.split(".").every((t=>!(!e||!(t in e))&&(e=e[t],!0)))}static pathifyKeys(e,t){const n={};for(const r in e)if(qt(e,r)){const i=null==t?void 0:t[r],s="object"===(null==i?void 0:i.type)||(null==i?void 0:i.complexMapping)||!Boolean(t);if(s&&Array.isArray(e[r]))n[r]=e[r].slice();else if(s&&e[r]instanceof Object){const t=this.pathifyKeys(e[r]);for(const e in t)n[`${r}.${e}`]=t[e]}else n[r]=e[r]}return n}static deletePath(e,t){t.split(".").reduce(((e,t,n,r)=>{if(null==e)return null;if(qt(e,t)){if(n!==r.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){const n=p.typeOf(e),r=p.typeOf(t),s="string"==typeof e;if(n!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return!(s&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!s||e&&"null"!==e)&&null;case"undefined":return!(!s||e&&"undefined"!==e)&&i;case"date":return s&&isNaN(e)?Gt.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,n,r,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=t=>{a.set.call(e,t),r&&r.call(e,a.get.call(e))}:s.set=r,a.get?s.get=()=>{let t=a.get.call(e);return n&&(t=n.call(e,t)),t}:s.get=n):(s.set=n=>{e[`_${t}`]=n,r&&r.call(e,n)},s.get=()=>{let r=e[`_${t}`];return n&&(r=n.call(e,r)),r}),Object.defineProperty(e,t,s)}static hookProperty(e,t,n){const r=Xt.getPropertyDescriptor(n.prototype,"value"),i=Xt.getPropertyDescriptor(e,t),s=`_${t}`,o=class{get value(){return i?i.get.call(this):this[s]}set value(e){i?i.set.call(this,e):this[s]=e}},a=Xt.getPropertyDescriptor(o.prototype,"value");return Object.setPrototypeOf(n.prototype,o.prototype),Object.defineProperty(e,t,{configurable:!0,get:r.get||a.get,set:r.set||a.set}),()=>delete e[t]}static getPropertyDescriptor(e,t){let n=null;for(let r=e;r&&!n&&!qt(r,"isBase");r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,t);return n}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([n,r])=>{t?r===i&&delete e[n]:null==r&&delete e[n]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,n){const r=p.typeOf(e);if(null!=e&&r!==t)throw new Error(`Incorrect type "${r}" for ${n}, expected "${t}"`)}static assertObject(e,t){Zt.assertType(e,"object",t)}static assertInstance(e,t){Zt.assertType(e,"instance",t)}static assertClass(e,t){Zt.assertType(e,"class",t)}static assertFunction(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t){const n=Number(e);if("number"!=typeof e||isNaN(n))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){Zt.assertType(e,"boolean",t)}static assertString(e,t){Zt.assertType(e,"string",t)}static assertArray(e,t){Zt.assertType(e,"array",t)}static toFixed(e,t){return Kt?Kt(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const n=10**t;return Math.round(e*n)/n}static getMapPath(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===r.length,s=r[0],o=e.has(s)?e.get(s):e.set(s,i?n:{}).get(s);return i?o:Zt.getPathDefault(o,r.slice(1),n)}}const Zt=Xt;let Jt;Xt._$name="ObjectHelper";const Qt=["border-top-width","border-right-width","border-bottom-width","border-left-width"],en=["margin-top","margin-right","margin-bottom","margin-left"],tn=["padding-top","padding-right","padding-bottom","padding-left"],nn="border-top-width",rn="border-right-width",sn="border-bottom-width",on="border-left-width",an="padding-top",ln="padding-right",cn="padding-bottom",dn="padding-left",un=/^([trblc])(\d*)-([trblc])(\d*)$/i,hn=/^([trblc])(\d*)$/i,gn=["top","right","bottom","left"],mn={t:0,r:1,b:2,l:3},pn=["b-t","l-r","t-b","r-l"],fn={bt:1,tb:1,lr:2,rl:2},vn=Object.freeze([0,0]),yn=["width","height"],bn=(e,t=e,n=e,r=t)=>Array.isArray(e)?bn.apply(null,e):[e,t,n,r],Cn=Object.freeze([]);function Sn(e,t){const n=un.exec(e),r=n[1],i=n[3],s=parseInt(n[2]||50),o=parseInt(n[4]||50),a=!t||1&mn[r]?s:100-s,l=!t||1&mn[i]?o:100-o;return{myAlignmentPoint:r+a,myEdge:r,myOffset:a,targetAlignmentPoint:i+l,targetEdge:i,targetOffset:l,startZone:mn[i],edgeAligned:fn[r+i]}}function Dn(e){return`${gn[(mn[e.myEdge]+2)%4][0]}${e.myOffset}-${gn[(mn[e.targetEdge]+2)%4][0]}${e.targetOffset}`}class wn{isRectangle=!0;static from(e,t,n){var s,a;if("string"==typeof e?e=document.querySelector(e):(null===(s=e)||void 0===s?void 0:s.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),"string"==typeof t&&(t=document.querySelector(t)),null==e||e.isRectangle)return e;if(e=e.element||e,n===i&&"boolean"==typeof t&&(n=t,t=null),null===(a=t)||void 0===a||!a.isRectangle)if(t){let{scrollLeft:e,scrollTop:n}=t;o.isSafari&&t===document.body&&(e=n=0),t=wn.from(t).translate(-e,-n)}else Jt||(Jt=new wn(0,0,0,0)),t=Jt;const l=e===document||e===r,c=e===document.body&&0===document.body.offsetHeight,d=c&&e.getBoundingClientRect(),u=c?new wn(d.left,d.top,d.width,document.body.parentElement.scrollHeight):l?new wn(0,0,r.innerWidth,r.innerHeight):e.getBoundingClientRect(),h=n||l?[0,0]:[r.pageXOffset,r.pageYOffset];return new wn(u.left+h[0]-t.x,u.top+h[1]-t.y,u.width,u.height)}static fromScreen(e,t){return wn.from(e,t,!0)}static inner(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Br.getStyleValue(e,Qt);r.x+=parseFloat(t[on]),r.y+=parseFloat(t[nn]),r.right-=parseFloat(t[rn]),r.bottom-=parseFloat(t[sn])}return r}static content(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Br.getStyleValue(e,Qt),n=Br.getStyleValue(e,tn);r.x+=parseFloat(t[on])+parseFloat(n[dn]),r.y+=parseFloat(t[nn])+parseFloat(n[an]),r.right-=parseFloat(t[rn])+parseFloat(n[ln]),r.bottom-=parseFloat(t[sn])+parseFloat(n[cn])}return r}static client(e,t,n=!1,r){const i=this.content(e,t,n),s=Br.scrollBarWidth,o=r?[...e.children].filter((e=>"sticky"===Br.getStyleValue(e,"position"))):Cn;let a;s&&!e.classList.contains("b-hide-scroll")&&(e.scrollHeight>e.clientHeight&&"hidden"!==Br.getStyleValue(e,"overflow-y")&&(a=parseFloat(Br.getStyleValue(e,"padding-right")),i.right+=a-Math.max(a,s)),e.scrollWidth>e.clientWidth&&"hidden"!==Br.getStyleValue(e,"overflow-x")&&(a=parseFloat(Br.getStyleValue(e,"padding-bottom")),i.bottom+=a-Math.max(a,s)));for(let e=0,{length:t}=o;e<t;e++){const t=o[e],n=this.fromScreen(t);0===parseFloat(Br.getStyleValue(t,"left"))?i.x+=n.width:0===parseFloat(Br.getStyleValue(t,"right"))?i.right-=n.width:0===parseFloat(Br.getStyleValue(t,"top"))?i.y+=n.height:0===parseFloat(Br.getStyleValue(t,"bottom"))&&(i.bottom-=n.height)}return i}static outer(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Br.getStyleValue(e,en);r.x-=parseFloat(t["margin-left"]),r.y-=parseFloat(t["margin-top"]),r.right+=parseFloat(t["margin-right"]),r.bottom+=parseFloat(t["margin-bottom"])}return r}static union(...e){let t,{x:n,y:r,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new wn(n,r,i-n,s-r)}roundPx(e=r.devicePixelRatio||1){const t=this;return t._x=Br.roundPx(t._x,e),t._y=Br.roundPx(t._y,e),t._width=Br.roundPx(t._width,e),t._height=Br.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,n,r){Xt.assertNumber(e,"Rectangle.x"),Xt.assertNumber(t,"Rectangle.y"),Xt.assertNumber(n,"Rectangle.width"),Xt.assertNumber(r,"Rectangle.height");const i=this;n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),i._x=e,i._y=t,i._width=n,i._height=r}clone(){const e=this,t=new wn(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return!!e.isRectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1,n=!1){const r=this,i=Math.max(r.y,e.y),s=Math.min(r.right,e.right),o=Math.min(r.bottom,e.bottom),a=Math.max(r.x,e.x);return!!(n?o>=i&&s>=a:o>i&&s>a)&&(!!t||new wn(a,i,s-a,o-i))}equals(e,t=!1){const n=t?e=>Math.round(e):e=>e;return e.isRectangle&&n(e.x)===n(this.x)&&n(e.y)===n(this.y)&&n(e.width)===n(this.width)&&n(e.height)===n(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){const e=new En(this.x+this.width/2,this.y+this.height/2,0,0);return e.target=this.target,e}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,n,r){const i=this;return i.x+=e,i.y+=t,i.width+=n,i.height+=r,i}inflate(e,t=e,n=e,r=t){return Array.isArray(e)&&([e,t,n,r]=bn(e)),this.adjust(-r,-e,t,n)}deflate(e,t=e,n=e,r=t){return Array.isArray(e)&&([e,t,n,r]=bn(e)),this.adjust(r,e,-t,-n)}constrainTo(e,t){const n=this,r=n.height,i=n.y,s=n.minWidth||n.width,o=n.minHeight||n.height;if(n.height>=e.height){if(t&&o>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&s>e.width)return n.y=i,n.height=r,!1;n._x=e.x,n.width=e.width}return n.translate.apply(n,n.constrainVector=[Math.min(e.right-n.right,0),Math.min(e.bottom-n.bottom,0)]),n.translate(Math.max(e.x-n.x,0),Math.max(e.y-n.y,0)),n}alignTo(e){let t,n,i,s,o=this.clone(),{target:a,constrainTo:l,constrainPadding:c}=e;if(a&&!a.isRectangle&&(a=wn.from(a.element?a.element:a)),l){if(!l.isRectangle){s=l===r||l===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!s;l=wn.from(l.element?l.element:l,null,t)}c&&(c=bn(c),c[0]=Math.min(c[0],a.top),c[1]=Math.min(c[1],l.right-a.right),c[2]=Math.min(c[2],l.bottom-a.bottom),c[3]=Math.min(c[3],a.left),l=l.deflate.apply(l.clone(),c))}const d=this,u=null==(x=e.offset)?vn:"number"==typeof x?[x,x]:x,{align:h,axisLock:g,anchorSize:m,anchorPosition:p,matchSize:f,position:v,rtl:y}=e,b=Sn(h,y),C=l&&l.clone(),S=[],D=[{zone:n=b.startZone,align:h}],w=f&&yn[1&b.startZone],E=d[w];var x;if(w&&g?o[w]=a[w]:!b.edgeAligned&&f&&(o.width=a.width,o.height=a.height),l&&o.constrainTo(l),l&&null!=b.startZone)if(g)D.push({zone:n=(n+2)%4,align:Dn(b)}),"flexible"===g&&(D.push({zone:n=(b.startZone+1)%4,align:pn[n]}),D.push({zone:n=(n+2)%4,align:pn[n]}));else for(let e=1;e<4;e++)D.push({zone:n=(n+1)%4,align:pn[n]});if(p){const e=1&b.startZone?"y":"x";t={[e]:p[e],edge:gn[(b.startZone+2)%4]}}if(C&&a&&(C.adjust(-a.width,-a.height,a.width,a.height),a.constrainTo(C)),o.minWidth=d.minWidth,o.minHeight=d.minHeight,v)o.moveTo(v.x,v.y),o.translate.apply(o,u),l&&o.constrainTo(l);else{const e="c"===b.myEdge||"c"===b.targetEdge,n=m&&!e?[m[1]+u[0],m[1]+u[1]]:u,r=a.getAlignmentPoint(b.targetAlignmentPoint,n),c=o.getAlignmentPoint(b.myAlignmentPoint);o.translate(r[0]-c[0],r[1]-c[1]);let h=o.intersect(a,!0);if(h)l&&o.constrainTo(l),i=b.startZone,o.translate(...n);else if(l&&!l.contains(o)){const e=o.clone(),r=[];let c,u;t=null,S[0]=c=l.clone(),c.bottom=a.y-n[1],S[1]=c=l.clone(),c.x=a.right+n[0],S[2]=c=l.clone(),c.y=a.bottom+n[1],S[3]=c=l.clone(),c.right=a.x-n[0];for(let e=0;e<D.length;e++){if(w&&2==e&&(o[w]=E),c=S[i=D[e].zone],o=o.alignTo({target:a,offsets:n,align:D[e].align}),o.constrainTo(c,!0)&&(r.push({result:o,zone:i}),!u||o.width<d.width||o.height<d.height)){o.align=D[e].align;break}if(!u||c.area>u.area){const e=o.clone();switch(i){case 0:e.moveTo(null,c.bottom-e.height);break;case 1:e.moveTo(c.left);break;case 2:e.moveTo(null,c.top);break;case 3:e.moveTo(c.right-e.width)}u={area:c.area,result:e,zone:i}}}r.length?(r.length>1&&!g&&r.sort(((t,n)=>Math.sqrt((e.x-t.result.x)**2+(e.y-t.result.y)**2)-Math.sqrt((e.x-n.result.x)**2+(e.y-n.result.y)**2))),o=r[0].result,i=r[0].zone):(o=u.result,i=u.zone,s&&o.constrainTo(l))}else i=b.startZone;if(o.zone=i,o.overlap=h=o.intersect(a,!0),m&&!h){if(!t){const e=1&i,n=e?"y":"x",r=e?"bottom":"right",s=Math.max(a[n],o[n]);let l=s+(Math.min(a[r],o[r])-s)/2-m[0]/2;const c=l+m[0];c>o[r]&&(l-=c-o[r]),l<o[n]&&(l+=o[n]-l),t={[n]:l-o[n],edge:gn[(i+2)%4]}}o.anchor=t}}return o}getAlignmentPoint(e,t=vn){const n=this,r=hn.exec(e),i=r[1].toLowerCase(),s=Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(i){case"t":return[n.x+n.width*s,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*s];case"b":return[n.x+n.width*s,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*s];case"c":return[n.x+n.width/2,n.y+n.height/2]}}highlight(){const e=this,t=Br.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return Br.highlight(t).then((()=>t.remove()))}visualize(e,t){const n=this,r=Xt.merge({style:{left:`${n.x}px`,top:`${n.y}px`,width:`${n.width}px`,height:`${n.height}px`,pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999}}},e);return t?r:Br.createElement(r)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}}class En extends wn{static from(e){const t=e.changedTouches,n=t?t[0].screenX:e.screenX,r=t?t[0].screenY:e.pageY;return new this.constructor(n,r)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}wn._$name="Rectangle";const xn=Symbol("value"),Rn=Symbol("length");class Tn{static change(e,t,n,r="string"){n=Tn.normalize(n,"object");const i=Tn.normalize(e,"array").filter((e=>!n[e]));if(t){t=Tn.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return Tn.normalize(i,r)}static from(e,t){return e&&(e.isDomClassList?t=t??!0:(t=t??(p.isObject(e)&&!p.isEmpty(e)),e=new Tn(e)),e.value||t||(e=null)),e||(t?new Tn:null)}static normalize(e,t="string"){const n=typeof(e=e||""),r="array"===t,i=!r&&!("object"===t);let s,o,a,l="string"===n;var c;"object"===n&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",l=!0):null!==(c=e)&&void 0!==c&&c.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter((t=>e.get(t))):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=p.getTruthyKeys(e)));for(l&&(e=[...new Set($.split(e))]),o=e.length;o-- >0;)s=e[o],s.length?s.includes(" ")&&e.splice(o,1,...$.split(s)):e.splice(o,1);if(r)a=e;else if(i)a=e.join(" ");else for(a=Object.create(null),o=0;o<e.length;++o)a[e[o]]=!0;return a}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Tn(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=Tn.normalize(e,"array"),n=t.length;if(this.length===n){for(let e=0;e<n;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){let e,t=this[xn];return null==t&&(e=p.getTruthyKeys(this),this[Rn]=e.length,this[xn]=t=e.join(" ")),t}set value(e){const t=this,n=Object.keys(t),r=n.length;for(let e=0;e<r;e++)delete t[n[e]];e?t.process(1,[e]):delete t[xn]}get values(){return p.getTruthyKeys(this)}get length(){return this.value?this[Rn]:0}process(e,t){for(let n,r,i=0;i<t.length;i++)if(t[i])if(n=t[i],n.isDomClassList||p.isObject(n))for(r in n)this[r]=e?n[r]:!n[r];else for(n=Tn.normalize(t[i],"array"),r=0;r<n.length;++r)this[n[r]]=e;return delete this[xn],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[xn]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,n=Tn.from(t);n.add(this),t.value=n.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=Boolean(!this[e])){if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[xn],!0}split(){return p.getTruthyKeys(this)}forEach(e){return p.getTruthyKeys(this).forEach(e)}}Tn.prototype[xn]=null,Tn._$name="DomClassList";const Mn=e=>e.floating,kn={touchend:1,pointerup:1},In={Meta:1,Control:1,Alt:1},An=new class extends(ye.mixin(Ge)){suspendFocusEvents(){Hn=!0}resumeFocusEvents(){Hn=!1}setupFocusListenersOnce(e,t){e&&!An.observedElements.has(e)&&(An.setupFocusListeners(e,t),An.observedElements.add(e))}detachFocusListeners(e){e.$globalEventsDetacher&&(e.$globalEventsDetacher(),e.$globalEventsDetacher=null,An.observedElements.delete(e))}setupFocusListeners(e=document,t,n=!1){var i;const s={element:e,touchstart(e){if(Pn||1!==e.changedTouches.length)Pn=null;else if(Pn=e.changedTouches[0],!o.isAndroid){const n=({clientX:e,clientY:t,type:n})=>{(kn[n]||Math.max(Math.abs(e-Pn.clientX),Math.abs(t-Pn.clientY))>5)&&(On=null,r(),clearTimeout(i))},r=t.on({element:document,touchmove:n,touchend:n,pointermove:n,pointerup:n,capture:!0}),i=setTimeout((()=>{On=Pn.identifier,r(),e.target.dispatchEvent(new MouseEvent("contextmenu",t.copyEvent({},e)))}),t.longPressTime)}},touchend:{handler:e=>{Pn&&(e.changedTouches[0].identifier===On?(e.stopImmediatePropagation(),!1!==e.cancelable&&e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===Pn.identifier&&An.trigger("globaltap",{event:e}),Pn=null)},passive:!1},mousedown:{handler:e=>{Ln="mouse",Pn||An.trigger("globaltap",{event:e}),_n=e;const t=e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;!$n&&t?$n=new KeyboardEvent("keydown",{key:e.ctrlKey?"Control":e.shiftKey?"Shift":e.altKey?"Alt":"Meta",ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}):$n&&!t&&($n=null)},passive:!1},mouseup(){_n=null},pointerdown:{passive:!1,handler:t=>{var n;jn=t,Br.usingKeyboard=!1,null===(n=e.classList)||void 0===n||n.remove("b-using-keyboard"),e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&Br.removeClsGlobally(e,"b-using-keyboard")}},pointerup:{passive:!1,handler:e=>{var t;(null===(t=jn)||void 0===t?void 0:t.pointerId)===e.pointerId&&(jn=null)}},keydown(t){if(Ln="key",$n=t,Bn=t.target,!In[t.key])if(Br.usingKeyboard=!0,e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(const t of e.children)t.matches(".b-outer")&&t.classList.add("b-using-keyboard");else e.classList.add("b-using-keyboard")},mouseenter(e){Bn=e.target},keypress(){Ln="key"},keyup(){$n=null},focusin(e){var t,n;const{Widget:r}=An;if(null!==(t=e.target)&&void 0!==t&&t.shadowRoot||null!==(n=e.target)&&void 0!==n&&n._shadowRoot)return;if(r.resetFloatRootScroll(),Hn)return;const i=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,s=e.target||document.body,o=r.fromElement(i),a=r.fromElement(s),l=Br.getCommonAncestor(o,a),c=!!(i&&4&s.compareDocumentPosition(i)),d=r.query(Fn);let u=null;if(u=s&&s!==document.body?Br.getActiveElement(s):Br.getActiveElement(document),d&&!d._isRevertingFocus&&(!a||!d.owns(a)&&!(4&d.element.compareDocumentPosition(a.element)&&a.up(Mn))))return d.focus();let h=Nn("focusout",i,e.target,o,a,c);for(let t,n=o;n&&n!==l;n=t)if(t=n.owner,!n.isDestroying&&n.onFocusOut&&(n.onFocusOut(h),e.target&&u!==Br.getActiveElement(e.target)))return;if(l&&e.target===l.element)!l.isDestroying&&Br.getActiveElement(l)===s&&l.focusElement&&l.focusElement!==l.element&&(l.element.contains(u)&&!l.focusDescendant||l.setTimeout((()=>{var e;return null===(e=l.focus)||void 0===e?void 0:e.call(l)}),0));else{h=Nn("focusin",s,i,o,a,c);for(let e=a;e&&e!==l;e=e.owner){var g,m;if(!e.isDestroying)null===(g=(m=e).onFocusIn)||void 0===g||g.call(m,h)}}const p=Br.getCommonAncestor((null==i?void 0:i.nodeType)===Element.ELEMENT_NODE?i:null,s)||s.parentNode;p&&(h=Nn("focusmove",s,i,o,a,c,{bubbles:!0}),p.dispatchEvent(h))},focusout(e){if(!(Hn||e.relatedTarget&&An.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;s.focusin({target:t,relatedTarget:e.target}),$n=_n=null}},blur:{element:r,handler(e){e.target===r&&($n=null,_n=null)}},capture:!0,passive:!0};n&&(null===(i=Vn)||void 0===i||i()),Vn=this.detachEvents=e.$globalEventsDetacher=t.on(s)}get lastInteractionType(){return Ln}get shiftKeyDown(){var e;return null===(e=$n)||void 0===e?void 0:e.shiftKey}get ctrlKeyDown(){var e,t;return(null===(e=$n)||void 0===e?void 0:e.ctrlKey)||(null===(t=$n)||void 0===t?void 0:t.metaKey)}get altKeyDown(){var e;return null===(e=$n)||void 0===e?void 0:e.altKey}get currentOverElement(){return Bn}isKeyDown(e){var t;return e?(null===(t=$n)||void 0===t?void 0:t.key)===e||!0===$n[(null==e?void 0:e.toLowerCase())+"Key"]:Boolean($n)}isMouseDown(e=0){var t;return(null===(t=_n)||void 0===t?void 0:t.button)===e}get currentMouseDown(){return _n}get currentPointerDown(){return jn}get currentTouch(){return Pn}get currentKeyDown(){return $n}},Fn=e=>e.isVisible&&e.isTopModal;An.observedElements=new Set;let Pn,On,Ln,$n,_n,jn,Bn,Vn,Hn=!1;function Nn(e,t,n,r,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"_target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>n}),a.fromWidget=r,a.toWidget=i,a.backwards=s,a}const zn=["clientX","clientY","pageX","pageY","screenX","screenY"],Wn={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},Un=!0,Gn={configurable:Un,value:!0},Yn={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},qn={Control:"ctrl",Alt:"alt",Shift:"shift"},Kn=/^(ctrl|shift|alt|meta)$/,Xn=["altKey","bubbles","button","buttons","cancelBubble","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"];class Zn{static eventNameMap={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseenter:"MouseEnter",mouseleave:"MouseLeave",mousemove:"MouseMove",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"};static normalizeEvent(e){return Xt.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],zn)}static copyEvent(e,t){return Xt.copyProperties(e,t,Xn)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const n=Jn.getXY(e),r=Jn.getXY(t);return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))}static getPagePoint(e){return new En(e.pageX,e.pageY)}static getClientPoint(e){return new En(e.clientX,e.clientY)}static addListener(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:n},r):Object.assign({element:e},t):e,Jn.on(r)}static on(e){const t=e.element,n=e.thisObj,r=[];for(const n in e)if(!Wn[n]){let i=e[n];"object"!=typeof i&&(i={handler:i});const s=i.element||t;r.push(Jn.addElementListener(s,n,i,e))}const i=()=>{for(let e,t=0;t<r.length;t++)e=r[t],Jn.removeEventListener(e[0],e[1],e[2]);r.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=Me.createInterceptor(n.doDestroy,i,n)),i}static addElementListener(e,t,n,s){const o=Jn.createHandler(e,t,n,s),{spec:a}=o,l=n.expires||s.expires,c=null!=a.capture||null!=a.passive?{capture:a.capture,passive:a.passive}:i;if(e.addEventListener(t,o,c),l){const i=n.thisObj||s.thisObj,a=null!=i&&i.isDelayable?i:r,{alt:c}=l,d=c?l.delay:l,{spec:u}=o;u.expires=l,u.timerId=a["number"==typeof d?"setTimeout":"requestAnimationFrame"]((()=>{u.timerId=null,Jn.removeEventListener(e,t,o),c&&!o.called&&("string"==typeof c?i[c]:c).call(i)}),d,`listener-timer-${performance.now()}`)}return[e,t,o,c]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var t,n,r;if(e.fixed)return e;const{type:i,target:s}=e;if((null!=s&&s.shadowRoot||null!=s&&null!==(t=s.getRootNode)&&void 0!==t&&null!==(n=t.call(s))&&void 0!==n&&n.host)&&e.composedPath){const t=this.getComposedPathTarget(e),n=s;Object.defineProperty(e,"target",{value:t,configurable:Un}),Object.defineProperty(e,"originalTarget",{value:n,configurable:Un})}if(Object.defineProperty(e,"fixed",Gn),i.startsWith("key")){const t=Yn[e.key];t&&Object.defineProperty(e,"key",{value:t,configurable:Un})," "!==e.key||e.code||Object.defineProperty(e,"code",{value:"Space",configurable:Un})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",Gn),s&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(o.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(o.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-top-width")))})),(null==s?void 0:s.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const t=Br.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:t,configurable:Un})}if((null==s?void 0:s.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"target",{value:t,configurable:Un})}if((null===(r=e.relatedTarget)||void 0===r?void 0:r.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:t,configurable:Un})}return i.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,n,i){const s=n.delay||i.delay,o=n.throttled||i.throttled,a=n.block||i.block,l="once"in n?n.once:i.once,c="capture"in n?n.capture:i.capture,d="passive"in n?n.passive:i.passive,u="delegate"in n?n.delegate:i.delegate,h=n.handler,g=n.expires,m=n.thisObj||i.thisObj,{rtlSource:p=m}=m||{};let f=(e,...t)=>{Jn.playingDemo&&e.isTrusted||null!=m&&m.isDestroyed||(e=Jn.fixEvent(e,null==p?void 0:p.rtl),f.called=!0,("string"==typeof h?m[h]:h).call(m,e,...t),delete e.target,delete e.relatedTarget,delete e.originalarget,delete e.key,delete e.code,delete e.ctrlKey,delete e.fixed)};if(a){const e=f;let t,n;f=(r,...i)=>{const s=performance.now();(!t||r.target!==n||s-t>a)&&(n=r.target,t=s,e(r,...i))}}if(null!=s){const e=f,t=null!=m&&m.setTimeout?m:r;f=(...n)=>{t.setTimeout((()=>{e(...n)}),s)}}if(null!=o){let e,t=o;o.buffer&&(e=e=>o.alt.call(Jn,Jn.fixEvent(e,null==p?void 0:p.rtl)),t=o.buffer),f=null!=m&&m.isDelayable?m.throttle(f,{delay:t,throttled:e}):Me.createThrottled(f,t,m,null,e)}if(l){const n=f;f=(...r)=>{Jn.removeEventListener(e,t,f),n(...r)}}if(u){const e=f;f=(t,...n)=>{var r;const i=(null===(r=(t=Jn.fixEvent(t,null==p?void 0:p.rtl)).target.closest)||void 0===r?void 0:r.call)&&t.target.closest(u);i&&(Object.defineProperty(t,"currentTarget",{get:()=>i,configurable:!0}),e(t,...n))}}return n.thisObj&&!1!==n.autoDetach&&(m.doDestroy=Me.createInterceptor(m.doDestroy,(()=>Jn.removeEventListener(e,t,f)),m)),f.spec={delay:s,throttled:o,block:a,once:l,thisObj:m,capture:c,expires:g,passive:d,delegate:u},f}static removeEventListener(e,t,n){const{expires:i,timerId:s,thisObj:o,capture:a}=n.spec;if(null!=i&&i.alt&&s){(null!=o&&o.isDelayable?o:r)["number"==typeof i.delay?"clearTimeout":"cancelAnimationFrame"](s)}e.removeEventListener(t,n,a)}static onTransitionEnd({element:e,animationName:t,property:n,handler:i,mode:s=(t?"animation":"transition"),duration:o=Br[`get${"transition"===s?"Property":""}${$.capitalize(s)}Duration`](e,n),thisObj:a=r,args:l=[],timerSource:c,runOnDestroy:d}){let u;c=c||(a.isDelayable?a:r);const h=[e,n,...l],g=()=>{m(),a.isDestroyed||(a.callback?a.callback(i,a,h):i.apply(a,h))},m=Jn.on({element:e,[`${s}end`]({animationName:r,propertyName:i,target:s}){if(s===e&&(i===n||null!=r&&r.match(t))){var o,a;if(u)null===(o=(a=c).clearTimeout)||void 0===o||o.call(a,u),u=null;g()}}});return null!=o&&(u=c.setTimeout(g,o+50,"onTransitionEnd",d)),m}static async waitForTransitionEnd(e){return new Promise((t=>{e.handler=t,Zn.onTransitionEnd(e)}))}static createDblClickWrapper(e,t,n){let r,i,s;return()=>{i||(i=Jn.on({element:e,touchstart:e=>{r=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===r){e.preventDefault(),clearTimeout(s),r=i=null;const o=wn.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-o.x,l=e.changedTouches[0].pageY-o.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperties(d,{target:{value:e.target},offsetX:{value:a},offsetY:{value:l}}),"string"==typeof t&&(t=n[t]),t.call(n,d)}},once:!0}),s=setTimeout((()=>{i(),r=i=null}),Jn.dblClickTime))}}static toSpecialKey(e,t=(o.isMac?"metaKey":"ctrlKey")){let n=!1;return!0===e?n=t:"string"==typeof e&&(e=e.toLowerCase()).match(Kn)&&(n=`${e}Key`),n}static specialKeyFromEventKey(e){return qn[e]||"no-special-key"}}const Jn=Zn;Jn.longPressTime=700,Jn.dblClickTime=300,o.isTouchDevice&&Jn.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),Zn._$name="EventHelper";const Qn={align:"t0-t0"},er=Node.ELEMENT_NODE,tr=Node.TEXT_NODE,{isObject:nr}=Xt,rr=/[+-]?\d*\.?\d+[eE]?-?\d*/g,ir=rr.source,sr=new RegExp(`matrix\\((?:${ir}),\\s?(?:${ir}),\\s?(?:${ir}),\\s?(?:${ir}),\\s?(${ir}),\\s?(${ir})`),or=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),ar=new RegExp(`(?:${sr.source})|(?:${or.source})`),lr=new RegExp(`translate(3d|X)?\\((${ir})px(?:,\\s?(${ir})px)?`),cr=new RegExp(`translate(3d|Y)?\\((${ir})px(?:,\\s?(${ir})px)?`),dr=/\s+/,ur=/\s*;\s*/,hr=/\s*:\s*/,gr=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,mr={elementData:"",for:"htmlFor",retainElement:""},pr={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},fr={length:1,parentRule:1,style:1},vr={INPUT:1,TEXTAREA:1},yr={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},br=r,Cr=document,Sr=Object.freeze({}),Dr=Array.prototype.slice,wr=Promise.resolve(),Er=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],xr=e=>e._hidden,Rr=(e,t,n)=>"children"===n.key?Xt.mergeItems(e,t,n):Xt.blend(e,t,n),Tr=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},Mr=e=>e&&(e===Cr.body||Boolean(e.offsetParent)||(e.ownerDocument.defaultView&&"offsetParent"in e&&"fixed"!==Br.getStyleValue(e,"position")?e.offsetParent:Mr(e.parentNode))),kr=e=>e instanceof Node?e:"string"==typeof e?Vr.createElementFromTemplate(e):Vr.createElement(e),Ir=Object.create(null),Ar=(e,t)=>{const n=Ir[e]||[$.hyphenate(e),t];return Ir[e]||(Ir[n[0]]=Ir[e]=n),n},Fr=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach((e=>Ar(e,!0)));let Pr,Or,Lr,$r=null,_r=0,jr=null;class Br{static async slideIn(e,t=1){const n="b-slide-in-"+(t>0?"next":"previous"),{classList:r,parentNode:{classList:i}}=e;i.add(".b-sliding-child-element"),r.add(n),await Zn.waitForTransitionEnd({element:e,animationName:Fr}),r.remove(n),i.remove(".b-sliding-child-element")}static isFocusable(e,t=!1){if(!t&&(!Vr.isVisible(e)||Vr.Widget.fromElement(e,xr)))return!1;const n=e.nodeName;return yr[n]||("A"===n||"LINK"===n)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isEditable(e){return e.isContentEditable||vr[e.nodeName]}static isInView(e,t=!1,n){if(!Mr(e))return!1;const i=(null==n?void 0:n.positioned)&&"fixed"!==Br.getStyleValue(n.element,"position"),s=wn.from(r),o=t?"contains":"intersect",a=i&&n.element.offsetParent,l=i&&wn.from(a);if(s.height=Cr.scrollingElement.scrollHeight,e===Cr.body)return s;const c=this.getViewportIntersection(e,s,o);return c&&i&&c.translate(Cr.scrollingElement.scrollLeft,Cr.scrollingElement.scrollTop),i&&c?c.translate(-l.x+a.scrollLeft,-l.y+a.scrollTop):c}static getViewportIntersection(e,t,n){const{parentNode:r}=e,{parentElement:i}=r.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=i.ownerDocument.defaultView.getComputedStyle(i),o="visible"!==s.overflowX||"visible"!==s.overflowY,a=(l=e).ownerSVGElement?l.ownerSVGElement.parentNode:l.offsetParent;var l;let c=wn.from(e,null,!0);for(let r=o?e.parentNode:a;c&&r!==Cr.documentElement;r=r.parentNode){r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.host&&(r=r.host.parentNode);const e=r===Cr.body,i=r.ownerDocument.defaultView.getComputedStyle(r);if("contents"!==i.display&&(e||"visible"!==i.overflow)){c=(e?t:wn.client(r,null,!0,!0))[n](c,!1,!0)}}return c}static isVisible(e){const t=e.ownerDocument;for(;e;e=(n=e).parentNode||n.host){if(e===t)return!0;if(e.nodeType===e.ELEMENT_NODE&&!Tr(e))return!1}var n;return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return Xt.blend(e,t,{merge:Rr})}static normalizeChildren(e,t,n){var r;let i,s,o,a,l,c=null==e?void 0:e.children;if(null!=e&&null!==(r=e.syncOptions)&&void 0!==r&&r.ignoreRefs&&(n=!0),c&&!(e instanceof Node))if(Array.isArray(c))for(s=0;s<c.length;++s)Vr.normalizeChildren(c[s],t,n);else for(o in a=c,e.children=c=[],a){var d;i=a[o],null!==(d=i)&&void 0!==d&&d.isWidget&&(i=i.element),l=!o.startsWith("$")&&!Vr.isElement(i),l&&(null==t||t(o,!n)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:l&&"string"!=typeof i&&(i.reference=o),Vr.normalizeChildren(i,t,n)),c.push(i))}return e}static roundPx(e,t=r.devicePixelRatio||1){const n=1/t;return Math.round(e/n)*n}static floorPx(e,t=r.devicePixelRatio||1){const n=1/t;return Math.floor(e*n)/n}static isCustomElement(e){return Boolean(null==e?void 0:e.shadowRoot)}static elementFromPoint(e,t){let n=document.elementFromPoint(e,t);return Vr.isCustomElement(n)&&(n=n.shadowRoot.elementFromPoint(e,t)||n),n}static childFromPoint(e,t,n,r=e){const i=null==n?t:new wn(t,n,0,0);let s=null;return Array.from(e.children).reverse().some((e=>{if(wn.from(e,r).contains(i))return s=e.children.length&&Vr.childFromPoint(e,i,null,r)||e,!0})),s}static unitize(e,t,n="px"){const[r,i]=Ar(e);return null!=t&&(t=String(t),t=i&&gr.test(t)?t+n:t),[r,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){var t,n;null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element);let r=((null===(n=e)||void 0===n?void 0:n.getRootNode())||document).activeElement;for(;null!==(i=r)&&void 0!==i&&i.shadowRoot;){var i;r=r.shadowRoot.activeElement}return r}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e),{nodeType:r}=n;return r===Node.DOCUMENT_NODE?n.body:r===Node.DOCUMENT_FRAGMENT_NODE?n:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t,n;const r=null===(t=(n=e).getRootNode)||void 0===t?void 0:t.call(n);if(null!=r&&r.body)return null==r?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||"ShadowRoot"===e.constructor.name}static getId(e){return e.id||(e.id="b-element-"+ ++_r)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!(null!==(n=(r=e)[e.isWidget?"owns":"contains"])&&void 0!==n&&n.call(r,t)||e===t);){var n,r,i;e=null!==(i=e.owner)&&void 0!==i&&i.isWidget&&e.owner!==e?e.owner:e.parentNode}return e}static getElement(e){return e instanceof Element?e:Cr.querySelector(e)}static setAttributes(e,t){const n=Vr.getElement(e);if(n&&t)for(const e in t)null==t[e]?n.removeAttribute(e):n.setAttribute(e,t[e])}static setLength(e,t,n){return n=1===arguments.length?"number"==typeof e?`${e}px`:e??"":(e=Vr.getElement(e)).style[t]="number"==typeof n?`${n}px`:n??""}static percentify(e,t=2){const n=Math.pow(10,t);return null==e||""===e||isNaN(e)?"":Math.round(e*n)/n+"%"}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return null!=Vr.getChild(e,t)}static children(e,t){return(">"===t[0]||t.startsWith("# "))&&("#"===t[0]&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){return e?e.matches&&e.matches(t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const n=Vr.getRootElement(e),r=Vr.getRootElement(t);return r&&n!==r&&r.host?Vr.isDescendant(n,r.host):e.contains(t)}static getEventElement(e,t="target"){return!e||Vr.isElement(e)?e:e[t]}static isElement(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&Vr.isNode(e)}static isReactElement(e){return(null==e?void 0:e.$$typeof)===Symbol.for("react.element")}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!nr(e)}static forEachSelector(e,t,n){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");Vr.children(e,t).forEach(n)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){Vr.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>Vr.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static up(e,t){return _.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(t)}static getAncestor(e,t,n=null){let r,i=!1,s=e;for(t=H.asArray(t);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(n&&s===n)break;r=s}return i?r||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return $.makeValidDomId(e,t)}static createElement(e={},t){var n,r,i;let s,o,a,l,c,d,u,h,g,m,p,f=t;if("boolean"==typeof f)throw new Error("Clean up");t&&(c=t.ignoreRefs,g=t.refOwner,m=t.refs,f=t.returnAll,p=t.syncIdField,c&&(a=!0,c="children"!==c)),"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const v=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:y,html:b,reference:C,syncOptions:S,text:D}=e;if(S&&(p=S.syncIdField||p,l=S.ignoreRefs,l&&(a=!0,c="children"!==l,t={...t,ignoreRefs:!0})),c&&(g=null),s=e.ns?Cr.createElementNS(e.ns,e.tag||"svg"):Cr.createElement(e.tag||"div"),null!=D?Vr.setInnerText(s,D):null!=b&&(b instanceof DocumentFragment?s.appendChild(b):s.innerHTML=b),e.tooltip&&Vr.Widget.attachTooltip(s,e.tooltip),e.style&&Vr.applyStyle(s,e.style),y)for(u in y)h=y[u],null!=h&&(s.dataset[u]=h);v&&this.addChild(v,s,e.nextSibling),g&&(s.$refOwnerId=g.id),C&&!c&&(g?(s.$reference=C,g.attachRef(C,s,e)):(m||((t=Object.assign({},t)).refs=m={}),m[C]=s,s.setAttribute("data-reference",C)));const w=e.className||e.class,E=Object.keys(e);for(w&&s.setAttribute("class",Tn.normalize(w)),o=0;o<E.length;++o)u=E[o],h=e[u],null!=(d=mr[u])?s[d||u]=h:!pr[u]&&u&&null!=h&&s.setAttribute(u,h);e["aria-hidden"]||e.role||e.tabIndex||Br.isFocusable(s,!0)||s.htmlFor||s.setAttribute("role","presentation"),null===(n=t)||void 0===n||null===(r=n.callback)||void 0===r||r.call(n,{action:"newElement",domConfig:e,targetElement:s,syncId:g?C:t.syncIdField&&(null===(i=e.dataset)||void 0===i?void 0:i[t.syncIdField])}),!0===f?t.returnAll=f=[s]:Array.isArray(f)&&f.push(s),e.children&&(p&&(s.syncIdMap={}),e.children.forEach((n=>{if(n)if("string"==typeof n){const e=document.createTextNode(n);g&&(e.$refOwnerId=g.id),s.appendChild(e)}else if(isNaN(n.nodeType)){var r,i;n.parent=s,!n.ns&&e.ns&&(n.ns=e.ns);const o=Vr.createElement(n,{...t,ignoreRefs:(null===(r=e.syncOptions)||void 0===r?void 0:r.ignoreRef)??a}),l=null===(i=n.dataset)||void 0===i?void 0:i[p];null!=l&&(s.syncIdMap[l]=o),delete n.parent}else s.appendChild(n)}))),s.lastDomConfig=e;const x=m||f||s;return e.replaceElement&&e.replaceElement.replaceWith(x),x}static createElementFromTemplate(e,t=Sr){const{array:n,raw:r,fragment:i}=t;let s;if(Vr.supportsTemplate){if((Pr||(Pr=Cr.createElement("template"))).innerHTML=e,s=Pr.content,i)return s.cloneNode(!0)}else if(s=(Or||(Or=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s.childNodes;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}return s=r?s.childNodes:s.children,1!==s.length||n?Dr.call(s):s[0]}static triggerMouseEvent(e,t="contextmenu"){const n=(this.isInView(e)||wn.from(e)).center,r=new MouseEvent(t,{clientX:n.x,clientY:n.y,bubbles:!0});e.dispatchEvent(r)}static insertFirst(e,t){return t&&t.nodeType!==er&&t.tag&&(t=Vr.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,n){return t&&t.nodeType!==er&&t.tag&&(t=Vr.createElement(t)),n?e.insertBefore(t,n):Vr.insertFirst(e,t)}static insertAt(e,t,n){const r=Array.from(e.children);if(n>=r.length)return Vr.append(e,t);const i=r[n];return Vr.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>kr(e)))),e.append)e.append(...t);else{const n=document.createDocumentFragment();t.forEach((function(e){n.appendChild(e)})),e.appendChild(n)}return t}return e.appendChild(kr(t))}static getTranslateX(e){const t=e.style.transform;let n=lr.exec(t);return n?parseFloat(n[2]):(n=ar.exec(t)||ar.exec(Vr.getStyleValue(e,"transform")),n?parseFloat(n[1]||n[3]):0)}static getTranslateY(e){const t=e.style.transform;let n=cr.exec(t);if(n){const e=parseFloat(n["Y"===n[1]?2:3]);return isNaN(e)?0:e}return n=ar.exec(t)||ar.exec(Vr.getStyleValue(e,"transform")),n?parseFloat(n[2]||n[4]):0}static getTranslateXY(e){return[Vr.getTranslateX(e),Vr.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[Vr.getOffsetX(e,t),Vr.getOffsetY(e,t)]}static focusWithoutScrolling(e){if(!o.isSafari)e.focus({preventScroll:!0});else{const t=Vr.getParents(e).map((e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})));e.focus(),setTimeout((()=>function(e){e.forEach((({element:e,scrollLeft:t,scrollTop:n})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==n&&(e.scrollTop=n)}))}(t)),0)}}static getPageX(e){return e.getBoundingClientRect().left+br.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+br.pageYOffset}static getExtremalSizePX(e,t){const n=$.hyphenate(t),r=n.split("-")[1];let i=Vr.getStyleValue(e,n);return i=/%/.test(i)?e.parentElement?parseInt(Vr.getStyleValue(e.parentElement,r),10):NaN:parseInt(i,10),i}static setScale(e,t,n=t){const r=Vr.getStyleValue(e,"transform").split(/,\s*/);r.length>1?(r[0].startsWith("matrix3d")?(r[0]=`matrix3d(${t}`,r[5]=n):(r[0]=`matrix(${t}`,r[3]=n),e.style.transform=r.join(",")):e.style.transform=`scale(${t}, ${n})`}static setTranslateX(e,t){const n=Vr.getStyleValue(e,"transform").split(/,\s*/);t=Vr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?12:4]=t,e.style.transform=n.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const n=Vr.getStyleValue(e,"transform").split(/,\s*/);t=Vr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?13:5]=t,e.style.transform=n.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){Vr.setLength(e,"top",t)}static setLeft(e,t){Vr.setLength(e,"left",t)}static setTopLeft(e,t,n){Vr.setLength(e,"top",t),Vr.setLength(e,"left",n)}static setRect(e,{x:t,y:n,width:r,height:i}){Vr.setTopLeft(e,n,t),Vr.setLength(e,"width",r),Vr.setLength(e,"height",i)}static setTranslateXY(e,t,n){if(null==t)return Vr.setTranslateY(e,n);if(null==n)return Vr.setTranslateX(e,t);t=Vr.roundPx(t),n=Vr.roundPx(n);const r=Vr.getStyleValue(e,"transform").split(/,\s*/),i=r[0].startsWith("matrix3d");r.length>1?(r[i?12:4]=t,r[i?13:5]=n,e.style.transform=r.join(",")+")"):e.style.transform=`translate(${t}px, ${n}px)`}static addTranslateX(e,t){Vr.setTranslateX(e,Vr.getTranslateX(e)+t)}static addTranslateY(e,t){Vr.setTranslateY(e,Vr.getTranslateY(e)+t)}static addLeft(e,t){Vr.setLeft(e,Vr.getOffsetX(e)+t)}static addTop(e,t){Vr.setTop(e,Vr.getOffsetY(e)+t)}static alignTo(e,t,n=Qn,r){t=t instanceof wn?t:wn.from(t,!0);const i=Vr.getTranslateXY(e),s=wn.from(e,!0);r&&(s.roundPx(),t.roundPx());const o=s.alignTo(Object.assign(n,{target:t}));Vr.setTranslateXY(e,i[0]+o.x-s.x,i[1]+o.y-s.y)}static getStyleValue(e,t,n,r){const i=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){const e={};for(const n of t)e[n]=i.getPropertyValue($.hyphenate(n));return e}return i.getPropertyValue($.hyphenate(t))}static getEdgeSize(e,t,n){const r="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])n&&!n.includes(s[0])||(i[s]=parseFloat(i.raw[s]=Vr.getStyleValue(e,`${t}-${s}${r}`)));return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}static parseStyle(e){if("string"==typeof e){const t=e.split(ur);e={};for(let n=0,{length:r}=t;n<r;n++){const r=t[n].split(hr);e[r[0]]=r[1]}}return e||{}}static applyStyle(e,t,n=!1){if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){let r,i;for(r in n&&(e.style.cssText=""),t.style&&"string"!=typeof t.style&&(t=Xt.assign({},t,t.style)),t)fr[r]||([r,i]=Vr.unitize(r,t[r]),null==i?e.style.removeProperty(r):e.style.setProperty(r,i));"string"==typeof t.style&&(e.style.cssText+=t.style)}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const n in e)fr[n]||(t+=`${$.hyphenate(n)}:${e[n]};`);return t}static addClasses(e,t){_.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...t)}static removeClasses(e,t){_.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...t)}static toggleClasses(e,t,n=null){t=H.asArray(t),!0===n?e.classList.add(...t):!1===n?e.classList.remove(...t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,n,i=r,s=t){n>0&&(e.classList.add(t),i.setTimeout({fn:t=>e.classList.remove(t),delay:n,name:s,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const n=r.getComputedStyle(e),i=n.transitionProperty.split(", "),s=n.transitionDuration.split(", "),o=i.indexOf($.hyphenate(t));let a;return-1!==o&&(a=1e3*parseFloat(s[o])),a}static getAnimationDuration(e){return 1e3*parseFloat(Vr.getStyleValue(e,"animation-duration"))}static highlight(e,t=r){return e instanceof wn?e.highlight():new Promise((n=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),n()}),1e3)}),0)}))}static get scrollBarWidth(){if(null===$r){const e=Lr||(Lr=Vr.createElement({parent:Cr.documentElement,className:"b-scrollbar-measure-element",style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==Cr.documentElement&&Cr.documentElement.appendChild(e),$r=e.offsetWidth}return $r}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){$r=null}static measureText(e,t,n=!1,r=i){const s=Vr.getMeasureElement(t,r);s[n?"innerHTML":"innerText"]=e;const o=s.clientWidth;return s.className="",o}static measureSize(e,t,n=!0){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=Vr.getMeasureElement(t);r.innerHTML="",r.style.width=Vr.setLength(e);const i=n?r.offsetWidth:r.getBoundingClientRect().width;return r.style.width=r.className="",i}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=Cr.body){const n=br.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||Vr.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return Er.forEach((e=>{r.style[e]!==n[e]&&(r.style[e]=n[e])})),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}static stripTags(e){return(Vr.$domParser||(Vr.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=Vr.createElementFromTemplate(e)}return Vr.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(Vr.syncAttributes(e,t),Vr.syncContent(e,t),Vr.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},n=[];for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,n.push(e)}}return{attributes:t,names:n}}static syncAttributes(e,t){const{attributes:n,names:r}=Vr.getSyncAttributes(e),{attributes:i,names:s}=Vr.getSyncAttributes(t),o=r.includes("dataset"),a=r.filter((e=>!s.includes(e))),l=s.filter((e=>!(r.includes(e)||o&&e.startsWith("data-")))),c=r.filter((e=>s.includes(e)));if(a.length>0)for(let e=0;e<a.length;e++){const r=a[e];"style"===r?Vr.applyStyle(t,n.style,!0):"dataset"===r?Object.assign(t.dataset,n.dataset):t.setAttribute(r,n[r])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const r=c[e];if("style"===r)Vr.applyStyle(t,n.style,!0);else if("dataset"===r)Object.assign(t.dataset,n.dataset);else if("class"!==r||!n.class.isDomClassList&&"object"!=typeof n.class)i[r]!==n[r]&&t.setAttribute(r,n[r]);else{let e;e=n.class.isDomClassList?n.class:new Tn(n.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===Vr.getChildElementCount(e)&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:n}=e;(null==n?void 0:n.nodeType)===Element.TEXT_NODE?n.data=t:e.textContent=t}static syncChildren(e,t){const n=this,r=Dr.call(e.childNodes),i=Dr.call(t.childNodes);for(;r.length;){const e=r.shift(),s=i.shift();if(e&&e.nodeType!==tr&&e.nodeType!==er)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(s&&s.nodeType!==tr&&s.nodeType!==er)throw new Error(`Target node type ${s.nodeType} not supported by DomHelper.sync()`);if(s)if(e.nodeType===s.nodeType)e.nodeType===tr?s.data=e.data:e.tagName===s.tagName?n.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==tr||s.nodeType!==er){const t=e.parentElement||e;throw new Error(`Currently no support for transforming nodeType.\n${t.outerHTML}`)}t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const{classList:n}=e,r="string"==typeof t,i=r?t.split(dr):Tn.normalize(t,"array"),s=i.length;let o,a=n.length!==s;for(o=0;!a&&o<s;o++)a=!n.contains(i[o]);return a&&(e.className=r?t:i.join(" ")),a}static updateClassList(e,t){const{classList:n}=e;let r,i,s=!1;for(r in t)i=Boolean(t[r]),n.contains(r)!==i&&(n[i?"add":"remove"](r),s=!0);return s}static setTheme(e,t){e=e.toLowerCase();const{head:n}=document,r=Vr.getThemeInfo(t).name.toLowerCase();let i=n.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(r===e)return wr;Vr.removeEachSelector(n,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const o={theme:e,prev:r};function a(t,n,a){const l=Br.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:t.href.replace(r,e),nextSibling:t});l.addEventListener("load",(()=>{delete l.dataset.loading,jr=null,++s===i.length&&(i.forEach((e=>e.remove())),An.trigger("theme",o),n(o))})),l.addEventListener("error",(e=>{delete l.dataset.loading,a(e)}))}if(i.length)return new Promise(((e,t)=>{i.forEach(((n,r)=>{a(n,e,t,i.length)}))}));{const e=n.querySelector("#bryntum-theme:not([data-loading])")||n.querySelector(`[href*="${r}.css"]:not([data-loading])`);if(null==e||!e.href.includes(`${r}.css`))throw new Error(`Theme link for ${r} not found`);return i=[e],new Promise(((t,n)=>a(e,t,n)))}}static get themeInfo(){return Br.getThemeInfo()}static getThemeInfo(e){if(!jr){const t=Vr.createElement({parent:document.body,className:"b-theme-info"}),n=Vr.getStyleValue(t,"content",!1,":before");if(n)try{jr=JSON.parse(n.replace(/^["']|["']$|\\/g,""))}catch(e){jr=null}jr=jr||(e?{name:e}:null),t.remove()}return jr}static async transition({element:e,selector:t="[data-dom-transition]",duration:n,action:i,thisObj:s=this,addTransition:o={},removeTransition:a={}}){const l=new Set,c=Array.from(e.querySelectorAll(t)),d=new Map(c.map((t=>{let n=0,r=t.parentElement;for(;r&&r!==e;)n++,r=r.parentElement;t.$depth=n,t.scrollHeight>t.offsetHeight&&"auto"===getComputedStyle(t).overflow&&(t.$scrollTop=t.scrollTop,l.add(t));const{parentElement:i}=t,s=wn.from(t,e),o=wn.from(t,i),a=getComputedStyle(i),c=parseFloat(a.borderLeftWidth);return c&&(s.left-=c,o.left-=c),[t.id,{element:t,globalBounds:s,localBounds:o,depth:n,parentElement:i}]})));i.call(s);const u=Array.from(e.querySelectorAll(t)),h=new Map(u.map((t=>{const n=wn.from(t,e),i=wn.from(t,t.parentElement),s=r.getComputedStyle(t.parentElement),o=parseFloat(s.borderLeftWidth);return o&&(n.left-=o,i.left-=o),[t.id,{element:t,globalBounds:n,localBounds:i}]}))),g=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[t,n]of d){const r=h.get(t);if(r){const{element:t}=r,{style:i,parentElement:s}=t,o=parseInt(Vr.getStyleValue(t,"zIndex")),{globalBounds:a,localBounds:c,depth:d,parentElement:u}=n,h=u!==s;let m;Xt.copyProperties(t.$initial={parentElement:s},i,g),h?(r.bounds=r.globalBounds,m=a,e.appendChild(t)):(r.bounds=r.localBounds,m=c,u.appendChild(t));let p="hidden";l.has(t)&&(t.$scrollPlaceholder=Vr.createElement({parent:t,style:{height:t.scrollHeight}}),p="auto");const f={position:"absolute",top:`${m.top}px`,left:`${m.left}px`,width:`${m.width}px`,height:`${m.height}px`,minWidth:0,minHeight:0,margin:0,zIndex:d+(o||0),overflow:p};"preserve-padding"!==t.dataset.domTransition&&(f.padding=0),Object.assign(i,f),r.processed=!0}else{const{element:e,localBounds:r,depth:i,parentElement:s}=n;e.$initial={removed:!0},Object.assign(e.style,{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${r.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:i,overflow:"hidden"}),s.appendChild(e),h.set(t,{element:e,bounds:r,removed:!0,processed:!0}),u.push(e)}}for(const[,e]of h)if(!e.processed){const{element:t}=e,{style:n,parentElement:r}=t,i=e.bounds=e.localBounds;t.classList.add("b-dom-transition-adding"),Xt.copyProperties(t.$initial={parentElement:r},n,g),Object.assign(n,{position:"absolute",top:o.top?0:`${i.top}px`,left:o.left?0:`${i.left}px`,width:o.width?0:`${i.width}px`,height:o.height?0:`${i.height}px`,opacity:o.opacity?0:null,zIndex:r.$depth+1,overflow:"hidden"})}for(const e of l)e.scrollTop=e.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:e,bounds:t,removed:n}]of h)n?Object.assign(e.style,{top:a.top?0:`${t.top}px`,left:a.left?0:`${t.left}px`,width:a.width?0:`${t.width}px`,height:a.height?0:`${t.height}px`,opacity:a.opacity?0:e.$initial.opacity}):Object.assign(e.style,{top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,opacity:e.$initial.opacity});await N.sleep(n),e.classList.remove("b-dom-transition");for(const e of u)e.$initial&&(e.$initial.removed?e.remove():(Xt.copyProperties(e.style,e.$initial,g),e.$scrollPlaceholder&&(e.$scrollPlaceholder.remove(),delete e.$scrollPlaceholder),e.classList.remove("b-dom-transition-adding"),e.$initial.parentElement.appendChild(e)));for(const e of l)e.scrollTop=e.$scrollTop,delete e.$scrollTop}static async loadScript(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)}))}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb|lab|lch|oklab|oklch)/.test(e)}static createColorStyle(e){return null!=e&&e.length?this.isNamedColor(e)?`var(--cal-color-${e})`:e:""}static get NodeFilter(){return NodeFilter}static addChild(e,t,n){e.insertBefore(t,n)}static cloneStylesIntoShadowRoot(e,t){return new Promise(((n,r)=>{t&&e.querySelectorAll('style, link[rel="stylesheet"]').forEach((e=>e.remove()));const i=document.querySelectorAll('link[rel="stylesheet"]');let s=0;i.forEach((t=>{const o=t.cloneNode();o.addEventListener("load",(()=>{s+=1,s===i.length&&n()})),o.addEventListener("error",(e=>{r(o.href)})),e.appendChild(o)})),document.querySelectorAll("style").forEach((t=>{const n=t.cloneNode();n.innerText=t.innerText,e.appendChild(n)})),i.length||n()}))}}const Vr=Br;let Hr;const Nr=()=>Vr.isTouchEvent=!1,zr=()=>{Vr.isTouchEvent=!0,clearTimeout(Hr),Hr=setTimeout(Nr,400)};if(Cr.addEventListener("touchstart",zr,!0),Cr.addEventListener("touchend",zr,!0),Vr.canonicalStyles=Ir,Vr.supportsTemplate="content"in Cr.createElement("template"),Vr.elementPropKey="$bryntum",Vr.numberRe=rr,!("children"in Node.prototype)){const e=e=>e.nodeType===e.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1}),br.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let t=this;if(!Cr.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===t.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),r.addEventListener("resize",(()=>$r=null)),Br._$name="DomHelper";const Wr={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3,SHOW_ALL:4294967295,SHOW_ELEMENT:1,SHOW_ATTRIBUTE:2,SHOW_TEXT:4,SHOW_CDATA_SECTION:8,SHOW_ENTITY_REFERENCE:16,SHOW_ENTITY:32,SHOW_PROCESSING_INSTRUCTION:64,SHOW_COMMENT:128,SHOW_DOCUMENT:256,SHOW_DOCUMENT_TYPE:512,SHOW_DOCUMENT_FRAGMENT:1024,SHOW_NOTATION:2048},Ur=Object.create||function(e){function t(){}return t.prototype=e,new t},Gr={first:"firstChild",last:"lastChild",next:"firstChild",previous:"lastChild"},Yr={next:"nextSibling",previous:"previousSibling"},qr=Gr.toString,Kr=function(e,t){return qr.call(e).toLowerCase()==="[object "+t.toLowerCase()+"]"},Xr=function(e,t){return 1<<t.nodeType-1&e.whatToShow?null===e.filter?Wr.FILTER_ACCEPT:e.filter.acceptNode(t):Wr.FILTER_SKIP},Zr=function(e,t){let n,r,i,s,o;for(r=e.currentNode[Gr[t]];null!==r;){if(s=Xr(e,r),s===Wr.FILTER_ACCEPT)return e.currentNode=r,r;if(s!==Wr.FILTER_SKIP||(n=r[Gr[t]],null===n))for(;null!==r;){if(o=r[Gr[t]],null!==o){r=o;break}if(i=r.parentNode,null===i||i===e.root||i===e.currentNode)return null;r=i}else r=n}return null},Jr=function(e,t){let n,r,i;if(n=e.currentNode,n===e.root)return null;for(;;){for(i=n[Yr[t]];null!==i;){if(n=i,r=Xr(e,n),r===Wr.FILTER_ACCEPT)return e.currentNode=n,n;i=n[Gr[t]],r===Wr.FILTER_REJECT&&(i=n[Yr[t]])}if(n=n.parentNode,null===n||n===e.root)return null;if(Xr(e,n)===Wr.FILTER_ACCEPT)return null}},Qr=function(e,t){if(e===t)return null;if(null!==e.nextSibling)return e.nextSibling;for(;null!==e.parentNode;){if((e=e.parentNode)===t)return null;if(null!==e.nextSibling)return e.nextSibling}return null};class ei{constructor(e,t,n){const r=this;let i=!1;if(!e||!e.nodeType)throw new Error("DOMException: NOT_SUPPORTED_ERR");r.root=e,r.whatToShow=Number(t)||0,r.currentNode=e,Kr(n,"function")?(r.filter=Ur(Wr),r.filter.acceptNode=function(e){if(i)throw new Error("DOMException: INVALID_STATE_ERR");i=!0;const t=n(e);return i=!1,t}):r.filter=null}parentNode(){let e=this.currentNode;for(;null!==e&&e!==this.root;)if(e=e.parentNode,null!==e&&Xr(this,e)===Wr.FILTER_ACCEPT)return this.currentNode=e,e;return null}firstChild(){return Zr(this,"first")}lastChild(){return Zr(this,"last")}previousSibling(){return Jr(this,"previous")}nextSibling(){return Jr(this,"next")}previousNode(){let e,t,n;for(e=this.currentNode;e!==this.root;){for(n=e.previousSibling;null!==n;){for(e=n,t=Xr(this,e);t!==Wr.FILTER_REJECT&&null!==e.lastChild;)e=e.lastChild,t=Xr(this,e);if(t===Wr.FILTER_ACCEPT)return this.currentNode=e,e;n=e.previousSibling}if(e===this.root||null===e.parentNode)return null;if(e=e.parentNode,Xr(this,e)===Wr.FILTER_ACCEPT)return this.currentNode=e,e}return null}nextNode(){let e,t,n;for(e=this.currentNode,t=Wr.FILTER_ACCEPT;;){for(;t!==Wr.FILTER_REJECT&&null!==e.firstChild;)if(e=e.firstChild,t=Xr(this,e),t===Wr.FILTER_ACCEPT)return this.currentNode=e,e;if(n=Qr(e,this.root),null===n)return null;if(e=n,t=Xr(this,e),t===Wr.FILTER_ACCEPT)return this.currentNode=e,e}}}function ti(e,t,n){return t=t===i?Wr.SHOW_ALL:t,n&&Kr(n.acceptNode,"function")?n=n.acceptNode:Kr(n,"function")||(n=null),new ei(e,t,n)}const ni=[],ri={},ii=Array.prototype.slice;let si;function oi(e){let t;if(1===e.nodeType){t=document.createElement(e.tagName),Br.syncAttributes(e,t);ai(e.childNodes).forEach((e=>t.appendChild(e)))}return 3===e.nodeType&&(t=document.createTextNode(e.wholeText)),t}function ai(e){if(e instanceof Node)return oi(e);{const t=[];for(let n=0,r=e.length;n<r;n++)t.push(oi(e[n]));return t}}Br.supportsTemplate=!1;V.apply(class{static get target(){return{class:Br}}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return(null==n?void 0:n.body)||(null==n?void 0:n.firstChild)||n||e.ownerDocument.body}static getChildElementCount(e){return e.children.length}static isValidFloatRootParent(e){return e.isConnected&&!e.parentElement}static createElementFromTemplate(e,t=ri){const{array:n,raw:r,fragment:i}=t;let s;if(s=(si||(si=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s?s.childNodes:ni;s=document.createDocumentFragment();for(let t=0,n=e.length;t<n;t++)s.appendChild(ai(e[t]));return s}return s=r?s.childNodes:s.children,s=1!==s.length||n?ii.call(s):s[0],ai(s)}static isDOMEvent(e){return e&&"stopImmediatePropagation"in e}static get NodeFilter(){return Wr}static addChild(e,t,n){e===document.body||e===document.documentElement?e.appendChild(t):this._overridden.addChild.call(this,e,t,n)}});const li=Node.prototype.contains;Node.prototype.contains=function(e){return e===this||li.apply(this,arguments)};V.apply(class{static get target(){return{class:o}}static get supportsPointerEvents(){return"onpointerdown"in HTMLElement.prototype}}),Object.defineProperty(o,"queryString",{get(){if(r.location.href){var e;const t=new URL(r.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}return{}}});const{defineProperty:ci}=Reflect;let di;di=o.isBrowserEnv?r.performance:{now:()=>(new Date).getTime()};let ui=null;if(_.isTestEnv){const e=r.bryntum||(r.bryntum={});ui=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty:(e=!1)=>ui.timeouts.size+ui.animationFrames.size+ui.idleCallbacks.size+(e?ui.intervals.size:0)===0,getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:n=!1}){const r=[],i=["timeouts","animationFrames","idleCallbacks"];n&&i.push("intervals");for(const n of i){const i=ui[n];for(const[,n]of i.entries())e.includes(n.name)||Number.isInteger(n.delay)&&!(n.delay<t)||r.push(n)}return r}}}const hi=(e,t,n,r)=>{const i="string"==typeof t,s=(null==r?void 0:r.appendArgs)||[],o=()=>{n.timerId=null,n.lastCallTime=di.now();const r=n.args;n.args=null,i?e[t](...r,...s):t.call(e,...r,...s),n.called=!0,++n.calls};return r&&(e=r.thisObj||e),n.lastCallTime=-9e9,n.calls=0,n.invoker=o,o.wrapFn=n,o},gi=(e,t,n="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[n](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[n](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.resume=e=>{const n=t.suspended;t.suspended=e||n<1?0:n-1},t.suspend=()=>{++t.suspended},t.immediate=!1,t.suspended=0,t.timerId=null,ci(t,"isPending",{get:()=>null!==t.timerId}),t);var mi=e=>class extends(e||ye){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const e=this;super.doDestroy(),e.timeoutIds&&(e.timeoutIds.forEach(((e,t)=>{var n;"function"==typeof e&&e(),clearTimeout(t),null===(n=ui)||void 0===n||n.timeouts.delete(t)})),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach(((e,t)=>clearTimeout(t))),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach((e=>{var t;clearInterval(e),null===(t=ui)||void 0===t||t.intervals.delete(e)})),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach((e=>{var t;cancelAnimationFrame(e),null===(t=ui)||void 0===t||t.animationFrames.delete(e)})),e.animationFrameIds=null),e.idleCallbackIds&&(e.idleCallbackIds.forEach((e=>{var t;cancelIdleCallback(e),null===(t=ui)||void 0===t||t.idleCallbacks.delete(e)})),e.idleCallbackIds=null)}hasTimeout(e){var t;return Boolean(null===(t=this.timeoutMap)||void 0===t?void 0:t.has(e))}setTimeout({fn:e,delay:t,name:n,runOnDestroy:r,cancelOutstanding:i,args:s}){var o;(arguments.length>1||"function"==typeof arguments[0])&&([e,t,n,r]=arguments),"string"==typeof e?n=e:n||(n=e.name||e),i&&this.clearTimeout(n);const a=this,l=a.timeoutIds||(a.timeoutIds=new Map),c=a.timeoutMap||(a.timeoutMap=new Map),d=setTimeout((()=>{var t;"string"==typeof e&&(e=a[n]),null==l||l.delete(d),null==c||c.delete(n),null===(t=ui)||void 0===t||t.timeouts.delete(d),e.apply(a,s)}),t);return l.set(d,!r||e),null===(o=ui)||void 0===o||o.timeouts.set(d,{fn:e,delay:t,name:n}),n&&c.set(n,d),d}clearTimeout(e){var t,n;let r=e;if("string"==typeof r){if(!this.timeoutMap)return;r=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(r),null===(t=this.timeoutIds)||void 0===t||t.delete(r),null===(n=ui)||void 0===n||n.timeouts.delete(r)}clearInterval(e){var t,n;clearInterval(e),null===(t=this.intervalIds)||void 0===t||t.delete(e),null===(n=ui)||void 0===n||n.intervals.delete(e)}setInterval(e,t,n){var r;const i=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(i),null===(r=ui)||void 0===r||r.intervals.set(i,{fn:e,delay:t,name:n}),i}requestAnimationFrame(e,t=[],n=this){var r;const i=this.animationFrameIds||(this.animationFrameIds=new Set),s=requestAnimationFrame((()=>{var r;null===(r=ui)||void 0===r||r.animationFrames.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=ui)||void 0===r||r.animationFrames.set(s,{fn:e,extraArgs:t,thisObj:n}),s}requestIdleCallback(e,t=[],n=this){var r;const i=this.idleCallbackIds||(this.idleCallbackIds=new Set),s=requestIdleCallback((()=>{var r;null===(r=ui)||void 0===r||r.idleCallbacks.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=ui)||void 0===r||r.idleCallbacks.set(s,{fn:e,extraArgs:t,thisObj:n}),s}createOnFrame(e,t=[],n=this,r){let i;const s=(...s)=>{null!=i&&r&&(this.cancelAnimationFrame(i),i=null),null==i&&(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=n[e]),i=null,s.push(...t),e.apply(n,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){var t,n;cancelAnimationFrame(e),null===(t=this.animationFrameIds)||void 0===t||t.delete(e),null===(n=ui)||void 0===n||n.animationFrames.delete(e)}cancelIdleCallback(e){var t,n;cancelIdleCallback(e),null===(t=this.idleCallbackIds)||void 0===t||t.delete(e),null===(n=ui)||void 0===n||n.idleCallbacks.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let n=t;t&&"number"!=typeof t?n=t.delay:t=null;const r=(...e)=>{if(r.suspended)return;const{delay:t}=r;r.cancel(),r.called=!1,r.args=e,r.immediate||!t?i():r.timerId=this.setTimeout(i,t)},i=hi(this,e,r,t);return r.delay=n,gi(this,r)}raf(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||(r.cancelOutstanding&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestAnimationFrame(i)))},i=hi(this,e,r,t);return r.cancelOutstanding=n,gi(this,r,"cancelAnimationFrame")}idle(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||(r.cancelOutstanding&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestIdleCallback(i)))},i=hi(this,e,r,t);return r.cancelOutstanding=n,this.setTimeout((()=>this.idleCallbackIds.delete(r.timerId)&&r.now()),100),gi(this,r,"cancelIdleCallback")}throttle(e,t){let n,r=t;t&&"number"!=typeof t?(r=t.delay,n=t.throttled):t=null;const i=this,s=(...e)=>{if(s.suspended)return;const{delay:t}=s,r=di.now()-s.lastCallTime;s.args=e,s.immediate||r>=t?(i.clearTimeout(s.timerId),o()):(s.isPending||(s.timerId=i.setTimeout(o,t-r),s.called=!1),n&&(n.wrapFn.args=e,n()))},o=hi(i,e,s,t);return s.delay=r,n&&(n=hi(i,n,(()=>{}),t)),gi(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const n=e.static,r=t||this.prototype;n&&delete e.static;for(const t in e){let n=e[t];const i=t+"Now",s=typeof n;r[i]||(r[i]=r[t]),"number"===s?n={type:"buffer",delay:n}:"string"===s&&(n={type:n}),ci(r,t,{get(){const e=this[n.type](((...e)=>{this[i](...e)}),n);return ci(this,t,{value:e}),e}})}}get widgetClass(){}};class pi extends(ye.mixin(mi)){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;null===(e=this.mousedownRemover)||void 0===e||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,t,n;const r=this;null===(e=r.activeElement)||void 0===e||e.classList.remove(r.pressedCls),r.activeElement=null,null===(t=r.acceleration)||void 0===t||t.cancel(),r.activeListenerRemover=null===(n=r.activeListenerRemover)||void 0===n?void 0:n.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}updateElement(e){var t;null===(t=this.mousedownRemover)||void 0===t||t.call(this),this.mousedownRemover=Zn.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,n=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),n&&(t.activeElement=n,t.triggerEvent=e,n.classList.add(t.pressedCls),t.activeListenerRemover=Zn.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Me.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}pi._$name="ClickRepeater";V.apply(class{static get target(){return{class:pi}}onMouseDown(e){this._overridden.onMouseDown.apply(this,arguments),this.eventTarget=e.target}fireClick(){var e;const t=this;null===(e=t.eventTarget)||void 0===e||e.dispatchEvent(new MouseEvent("click",Zn.copyEvent({},t.triggerEvent))),t.repeatTimer=t.setTimeout(t.fireClick,t.interval)}});class fi extends(ye.mixin(Ge,rt)){static $name="InstancePlugin";static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:t}=this;t.keyMap=t.mergeKeyMaps(t.keyMap,e,$.uncapitalize(this.constructor.$name))}static initPlugins(e,...t){const n=e.plugins||(e.plugins={});for(const r of t)n[r.$$name]=new r(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let n,[r,i]=e;1===e.length?Xt.isObject(r)&&(i=r,r=i.client):(i=Xt.assign({},i),delete i.client),t.client=r,super.construct(i),t.applyPluginConfig(r),n=t.clientListeners,n&&(n=Xt.assign({},n),n.thisObj=t,r.ion(n))}applyPluginConfig(e){const t=this,n=t.pluginConfig||t.constructor.pluginConfig;if(n){const{assign:r,chain:i,after:s,before:o,override:a}=n;r&&t.applyAssign(e,r),(i||s)&&t.applyChain(e,i||s),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,n=!0){if(Array.isArray(t))for(const r of t)this.chain(e,r,r,n);else for(const r in t)this.chain(e,r,t[r],n)}applyOverride(e,t){const n=this;n.overridden||(n.overridden={}),t.forEach((t=>{if(!n[t])throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${n.$$name}#${t} does not exist`);"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)}))}assign(e,t){const n=this,r=function(e,t){const n=Xt.getPropertyDescriptor(e,t);return n&&(n.get||n.set)?n:null}(n,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}chain(e,t,n,r=!0){let i=0;"object"==typeof t&&(t=t.fn),"object"==typeof n&&(i=n.prio||0,n=n.fn);const s=this,o=e.pluginFunctionChain||(e.pluginFunctionChain={}),a=s[n]&&s[n].bind(s),l=s.functionChainRunner;if(!a)throw new Error(`Trying to chain fn ${e.$$name}#${n}, but plugin fn ${s.$$name}#${n} does not exist`);if(!o[t]){let n=e[t];n&&(n=n.bind(e),n.$this=e,n.$prio=0),o[t]=n?[n]:[],e[t]=(...e)=>l(o[t],e)}a.$this=s,a.$prio=i,o[t][r?"push":"unshift"](a),o[t].$sorted=!1}functionChainRunner(e,t){let n,r,i;for(e.$sorted||(e.sort(((e,t)=>t.$prio-e.$prio)),e.$sorted=!0),r=0;r<e.length&&(n=e[r],n.$this.isDestroyed||(i=n(...t),!1!==i));r++);return i}doDisable(e){const t=this,{constructor:n}=t,r="featureClass"in n?n.featureClass:`b-${n.$$name.toLowerCase()}`,i=$.uncapitalize(n.$$name);var s,o,a,l;r&&(null===(s=t.client)||void 0===s||null===(o=s._element)||void 0===o||o.classList[e?"remove":"add"](r));t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"),null===(a=(l=t.client).syncSplits)||void 0===a||a.call(l,(t=>{const n=t.features[i];n&&(n.disabled=e)})))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}}fi._$name="InstancePlugin";var vi=e=>class extends(e||ye){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),fi.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){fi.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){var t;return"function"==typeof e&&(e=e.$$name),null===(t=this.plugins)||void 0===t?void 0:t[e]}get widgetClass(){}};class yi{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,t){}}yi._$name="StateStorage";const bi=()=>Object.create(null),Ci=(e,t=0)=>{const n=[],r=localStorage.length;for(let i,s=0;s<r;++s)i=localStorage.key(s),i.startsWith(e)&&n.push(i.slice(t));return n},Si=new yi,Di={local:class extends yi{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=bi(),t=this.keys;for(const n of t)e[n]=this.getItem(n);return e}get keys(){return Ci(this.prefix,this.prefix.length)}clear(){const e=Ci(this.prefix);for(const t of e)localStorage.removeItem(t)}getItem(e){const t=localStorage.getItem(this.prefix+e);return null===t?t:JSON.parse(t)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,t){return localStorage.setItem(this.prefix+e,JSON.stringify(t))}},memory:class extends yi{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return Xt.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=bi()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,t){this._data[e]=t}}};class wi extends(ye.mixin(mi,Ge)){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){null==e?e=Ei:(("string"==typeof e||Xt.isClass(e)||e instanceof yi)&&(e={storage:e}),Xt.isObject(e)&&(e=new wi(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(e)for(const t in e)this.setValue(t,e[t]);else this.clear()}clear(){return this.storage.clear(),this}changeStorage(e){if(null==e)e=Si;else{if("string"==typeof e){if(!Di[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(Di).join('", "')}")`);e=Di[e]}Xt.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,n=null==t?void 0:t.length,r=[],i=[];if(e.pendingSaves=null,n){for(let e,s,o,a=0;a<n;++a)[s,e]=t[a],!s.isDestroying&&s.isSaveStatePending&&(o=s.saveState({...e,immediate:!0}),o&&(r.push(o),i.push(s)));r.length&&e.trigger("save",{stateIds:r,saved:i})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const n=this,{storage:r}=n,i=n.getValue(e);return null!=t?(r.setItem(e,t),n.trigger("set",{key:e,value:t,was:i})):null!==i&&(r.removeItem(e),n.trigger("remove",{key:e,was:i})),n}}const Ei=new wi({storage:Si});wi._instance=Ei,wi._$name="StateProvider";const xi=/boolean|number|string/;var Ri=e=>class extends(e||ye){static $name="State";static configurable={stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null};static prototypeProperties={statefulLoaded:!1,statefulSuspended:0};afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(e){this._state=e,e&&this.applyState(e)}updateStatefulEvents(e){const t=this,n={name:"statefulEvents",thisObj:t};if(t.detachListeners(n.name),e&&("string"==typeof e?e=$.split(e):Array.isArray(e)||(e=Xt.getTruthyKeys(e)),e.length)){var r;for(const t of e)n[t]="onStatefulEvent";null===(r=t.ion)||void 0===r||r.call(t,n)}}get statefulId(){const e=this,{responsiveState:t}=e;let n=e.stateId;return null==n&&!1===e.hasGeneratedId&&!1!==e.stateful&&(n=e.id),n&&t&&(n=`${n}[${t}]`),n}get statefulness(){const{stateful:e}=this;return Array.isArray(e)?Xt.createTruthyKeys(e):e}get stateProvider(){return this._stateProvider||wi.instance}applyState(e){(e=this.pruneState(e))&&this.setConfig(e)}getState(){const e=this,{initialConfig:t,statefulness:n,isConstructing:r}=e,{configs:i}=e.$meta,s=r?Object.setPrototypeOf(t,e.$meta.config):e;let o,a,l=null;if(n)for(o in l={},n)if(n[o]){var c;if(a=s[o],null!==(c=a)&&void 0!==c&&c.isStateful)a=a.state;else if(!r&&(Xt.isDate(a)&&(a=Gt.format(a,"YYYY-MM-DDTHH:mm:ssZ")),i[o].equal(a,null==t?void 0:t[o])||!xi.test(typeof a)))continue;l[o]=a}return l}loadState(e,t){"boolean"==typeof e&&(t=e,e=null);const n=this,{statefulLoaded:r}=n;if(n.isStatefulActive&&(t||!r)){const t=n.loadStatefulData(e||(e=n.statefulId));!r&&e&&(n.defaultState=n.state,n.statefulLoaded=!0),t&&(n.state=t)}}loadStatefulData(e){var t;return(e=this.isStatefulActive?e||this.statefulId:null)&&(null===(t=this.stateProvider)||void 0===t?void 0:t.getValue(e))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(e=!1){this.statefulSuspended=e?0:Math.max(this.statefulSuspended-1,0)}saveState(e){e="string"==typeof e?{id:e}:e||{};const t=this,{stateProvider:n}=t,r=e.id||t.isStatefulActive&&t.statefulId;if(r&&n)return e.immediate?(t.isSaveStatePending=!1,n.setValue(r,t.state)):t.isSaveStatePending||(t.isSaveStatePending=!0,n.saveStateful(t,e)),r}suspendStateful(){++this.statefulSuspended}onConfigChange({name:e,value:t,was:n,config:r}){if(super.onConfigChange({name:e,value:t,was:n,config:r}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:t}=this;(Array.isArray(t)?t.includes(e):null==t?void 0:t[e])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(e){const{statefulness:t}=this;if(t){const n={};for(const r in e)t[r]&&(n[r]=e[r]);e=n}return e}get widgetClass(){}};const Ti=Xt.getPathDefault(r,"bryntum.idCounts",Object.create(null)),Mi={string:1,number:1};var ki=e=>class extends(e||ye){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:n}=e;n.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:()=>n})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}updateId(e,t){const n=this,r=n.constructor;t&&r.unregisterInstance(n,t),n.hasGeneratedId&&!1===r.identifiable.registerGeneratedId||r.registerInstance(n,e)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(e="generatedId"){return e+(Ti[e]=(Ti[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:n}=this.identifiable;if(t in n&&!this.disableThrow)throw new Error("Id "+t+" already in use");n[t]=e}static unregisterInstance(e,t=e.id){const{idMap:n}=this.identifiable;Mi[typeof e]?delete n[e]:n[t]===e&&delete n[t]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}};const Ii=Symbol("STM_PROP"),Ai={parentIndex:1};var Fi=e=>class extends(e||ye){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(e){this.stm||(this.stm=e.stm)}unjoinStore(e,t=!1){var n;this.stm===e.stm&&(this.stm=null),null===(n=super.unjoinStore)||void 0===n||n.call(this,e,t)}get stm(){return this[Ii]}set stm(e){this[Ii]=e}beforeChronoFieldSet(e,t){var n;const r=this;return r.inSetting||null===(n=r.stm)||void 0===n||!n.enabled||Ai[e]||r.constructor.nonPersistableFields[e]||!r.getFieldDefinition(e)?null:{[e]:{value:t,oldValue:r[e]}}}afterChronoFieldSet(e,t,n){n&&this.afterSet(e,t,!1,!1,n,!0)}shouldRecordFieldChange(e,t,n){const r=this.firstStore;return!(this.constructor.nonPersistableFields[e]||null==t&&null==n||t===n||t instanceof Date&&n instanceof Date&&t.getTime()===n.getTime()||"id"===e||"$PhantomId"===e||"parentId"===e&&r&&r.oldIdMap[t]===r.getById(n))}afterSet(e,t,n,r,i,s){const{stm:o}=this,a=this.constructor.nonPersistableFields;if(null!=o&&o.isBase&&o.enabled&&!Ai[e]&&!a[e]&&i){let e;const[t,n]=Object.keys(i).reduce(((t,n)=>{const{value:r,oldValue:s}=i[n];return this.shouldRecordFieldChange(n,s,r)&&(e=!0,t[0][n]=r,t[1][n]=s),t}),[{},{}]);e&&o.onModelUpdate(this,t,n,s)}}beforeInsertChild(e){var t;const n=(null===(t=super.beforeInsertChild)||void 0===t?void 0:t.call(this,e))||[],{stm:r}=this;return null!=r&&r.enabled&&n.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:i}),e)),new Map)),n}afterInsertChild(e,t,n,r){var i;const{stm:s}=this;if(null!=s&&s.enabled){const t=n.pop();r&&s.onModelInsertChild(this,e,r,t)}null===(i=super.afterInsertChild)||void 0===i||i.call(this,e,t,n,r)}beforeRemoveChild(e,t){const n=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],{stm:r}=this;return null!=r&&r.enabled&&!t&&n.push(e.reduce(((e,t)=>(e.set(t,{parentIndex:t.parentIndex,orderedParentIndex:t.orderedParentIndex}),e)),new Map)),n}afterRemoveChild(e,t,n){var r;const{stm:i}=this;if(null!=i&&i.enabled&&!n){const n=t.pop();e&&e.length&&i.onModelRemoveChild(this,e,n)}null===(r=super.afterRemoveChild)||void 0===r||r.call(this,e,t,n)}};const Pi={includeFilteredOutRecords:!1},Oi=e=>("boolean"==typeof(e=e||!1)&&(e={includeFilteredOutRecords:e}),e||Pi);var Li=e=>class extends(e||ye){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}constructor(...e){super(...e),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:n,constructor:r}=this,i=t[0];if(!0===e)return!!n||[];if(e){const t=(e=H.asArray(e)).length,n=[];for(let s,o=0;o<t;o++)s=e[o],s=s.isModel?s:i?i.createRecord(s,!1,!0):new r(s,null,null,!0),s=i?i.processRecord(s):s,n.push(s);if(!0===this.children&&i){const e=i.createSorterFn(i.sorters);n.sort(e)}return n}}processChildren(e=this.stores){const t=this,{meta:n}=t;t.inProcessChildren=!0;const r=t.ingestChildren(t.data[t.constructor.childrenField],e);if(r){const{convertEmptyParentToLeaf:e}=t.constructor;if(!0===e||e.onLoad?r.length:Array.isArray(r)){if(n.isLeaf=!1,!0===t.children)t.children=[];else if(0===r.length)return void(t.children=r);t.insertChild(r)}else!0===r?(n.isLeaf=!1,t.children=!0):t.isRoot||(n.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)}t.inProcessChildren=!1}ancestorsExpanded(e=this.firstStore){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e=this.firstStore){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const{children:n}=this;return!n||!Array.isArray(n)||e&&!this.isExpanded(t)?0:n.reduce(((t,n)=>t+n.getDescendantCount(e)),n.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(e=!1){const{[e?"unfilteredChildren":"children"]:t}=this;return t&&!0!==t?t.reduce(((t,n)=>(t.push(n),t.push.apply(t,e?n.allUnfilteredChildren:n.allChildren),t)),[]):[]}get firstChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[0]||null}get lastChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get previousOrderedSibling(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.orderedChildren[this.orderedParentIndex-1])??null}get nextOrderedSibling(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.orderedChildren[this.orderedParentIndex+1])??null}get root(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:n}=t,r=null===e?t.firstStore.rootNode:t.firstStore.getById(e);r!==n&&(n||r)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:r?r.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(e){let t;return t=e.includeFilteredOutRecords?this.unfilteredChildren||this.children:e.useOrderedTree?this.orderedChildren:this.children,t}traverse(e,t,n){n=Oi(n);const r=this,i=r.getChildren(n);t||e.call(r,r);for(let t=0,r=null==i?void 0:i.length;t<r;t++)i[t].traverse(e,!1,n)}traverseBefore(e,t,n){n=Oi(n);const r=this,i=r.getChildren(n);for(let t=0,r=null==i?void 0:i.length;t<r;t++)i[t].traverse(e,!1,n);t||e.call(r,r)}traverseWhile(e,t,n){n=Oi(n);const r=this;let i=t||!1!==e.call(r,r);if(i){const t=r.getChildren(n);null!=t&&t.length&&(i=t.every((t=>t.traverseWhile(e,!1,n))))}return i}bubble(e,t=!1){let n=this;for(t||e.call(n,n);n.parent;)n=n.parent,e.call(n,n)}bubbleWhile(e,t=!1){let n=this,r=!0;for(t||(r=e.call(n,n));r&&n.parent;)n=n.parent,r=e.call(n,n);return r}contains(e,t=!1){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e),t)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(t=e,e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1,n={}){return this.insertChild(e,null,t,n)}insertChild(e,t=null,n=!1,r={}){var i,s,o,a;const l=this,c=Array.isArray(e);var d;(e=H.asArray(e),"number"==typeof t)&&(t=(null===(d=l.children)||void 0===d?void 0:d[t])??null);if(!n&&!l.stores.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:l}))))return null;e=l.ingestChildren(e);const u=(null===(i=t)||void 0===i?void 0:i.parentIndex)??(null===(s=l.children)||void 0===s?void 0:s.length)??0,h=null===(o=l.beforeInsertChild)||void 0===o?void 0:o.call(l,e),g=l.internalAppendInsert(e,t,n,r);return g.length&&l.convertToParent(n),null===(a=l.afterInsertChild)||void 0===a||a.call(l,u,e,h,g),c||!g?g:g[0]}convertToParent(e=!1){const t=this,n=t.isLeaf;t.meta.isLeaf=!1,t.children||(t.children=[]),!n||t.root.isLoading||e||t.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(e,t=this.stores){t.forEach((t=>{t.trigger("update",{record:this,records:[this],changes:e}),t.trigger("change",{action:"update",record:this,records:[this],changes:e})}))}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,n,r){const i=this,{stores:s,root:o,children:a}=i,{firstStore:l}=o,{parentIdField:c}=i.constructor,d=i.id;let u,h,g,m,p,f;if(!o.isLoading&&l)for(f={},p=[],g=0;g<e.length;g++){const t=e[g];f[t.id]=t.root===o,p[g]=t.parentIndex}if(t&&t.parent!==i&&(t=null),a){const n=t?t.parentIndex:a.length;if(a[h=n]===e[0]||a[h=n-1]===e[0])for(u=!0,g=0;u&&g<e.length;g++)e[g]!==a[h+g]&&(u=!1)}if(u)return e;for(g=0;g<e.length;g++){var v;const t=e[g],s=t.parent;if(l&&!o.isLoading&&t.traverse((e=>{e.root===o&&(f[e.id]=!0)})),!1===(null==s?void 0:s.removeChild(t,null===(v=f)||void 0===v?void 0:v[t.id],n,{isInserting:!0,...r})))m||(e=e.slice(),m=!0),e.splice(g--,1);else{t.parent=i,t.data[c]=d;const{meta:e}=t;e.modified[c]!==d||s||(e.oldParentId=d),s&&(e.oldParentId=s.id)}}if(e.length){Array.isArray(a)||(i.children=[]),Array.isArray(i.orderedChildren)||(i.orderedChildren=[]);const o=i.addToChildren(t,e,r);s.forEach((t=>{t.isChained||(e.forEach((e=>{e.joinStore(t)})),t.onNodeAddChild(i,e,o,f,n),e.forEach(((e,r)=>{if(null!=e.meta.oldParentId&&!i.inProcessChildren&&!i.isLoading){const s={[c]:d,[i.getDataSource("parentIndex")]:e.parentIndex},o={},{modified:a,oldParentId:l}=e.meta,u=p[r];if(delete e.meta.oldParentId,i.id!==l&&(o[c]={value:d,oldValue:l}),e.parentIndex!==u&&(o.parentIndex={value:e.parentIndex,oldValue:u}),a[c]===i.id?Reflect.deleteProperty(a,c):c in a||(a[c]=l),f[e.id]){const e=t.getById(l);e.isLeaf&&!n&&e.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[t])}e.afterChange(s,o)}e.traverse((e=>{e.ignoreBag||e.isLinked||t.updateModifiedBagForRecord(e)}))})))}))}return e}removeChild(e,t=!1,n=!1,r={}){var i,s;const o=this,a=[],l=o.isLeaf,{children:c,stores:d}=o;if(e=(e=H.asArray(e)).filter((e=>e.parent===o)),!n)for(const n of d)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:o,records:e,isMove:t}))return!1;const u=null===(i=o.beforeRemoveChild)||void 0===i?void 0:i.call(o,e,t);for(const i of e){const{parentIdField:e}=i.constructor,{modified:s}=i.meta,l=i.parent?i.parent.id:null;e in s||i.isLinked||(s[e]=l);const c=o.removeFromChildren(i,r);d.forEach((e=>{if(!e.isChained){const{isRemoving:r}=e;e.isRemoving=!0,a.push(...e.onNodeRemoveChild(o,[i],c,{isMove:t,silent:n})),e.isRemoving=r}})),t||(i.parent=i.parentIndex=i.unfilteredIndex=i.nextSibling=i.previousSibling=null,i.data[e]=null)}return 0===(o.unfilteredChildren||c).length&&o.constructor.convertEmptyParentToLeaf.onRemove&&!o.isRoot&&(o.meta.isLeaf=!0),o.isLeaf===l||n||t||o.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),null===(s=o.afterRemoveChild)||void 0===s||s.call(o,e,u,t),a}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}replaceChildren(e){return this.clearChildren(),this.data[this.constructor.childrenField]=e,this.processChildren(),this.children}clearChildren(e=!1){const t=this,{stores:n}=t,r=t.unfilteredChildren||t.children;t.children=[],t.orderedChildren=[],r&&!0!==r&&(n.forEach((n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){var e;const t=this,{stores:n}=t,r=null===(e=t.children)||void 0===e?void 0:e.slice();if(t.isRoot&&r){for(const e of n)if(!e.isChained&&!1===e.trigger("beforeRemove",{parent:t,records:r,isMove:!1,removingAll:!0}))return!1;t.children.length=0,t.unfilteredChildren&&(t.unfilteredChildren.length=0),n.forEach((e=>{r.forEach((t=>{t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t,n=!1){let r=null;for(let s=0;s<e.length;s++){const o=e[s],a=o[t];"parentIndex"===t||"orderedParentIndex"===t?a===i||n?o.setData(t,s):a!==s&&o.set(t,s,!0):o[t]=s,"parentIndex"===t&&(o.previousSibling=r,r&&(r.nextSibling=o),s===e.length-1&&(o.nextSibling=null),r=o)}}addToChildren(e,t,n={}){const r=this,s=[[r.children,"parentIndex",e],[r.unfilteredChildren,"unfilteredIndex",e],[r.orderedChildren,"orderedParentIndex",(null==n?void 0:n.orderedBeforeNode)===i?(null==n?void 0:n.orderedParentIndex)!==i?r.orderedChildren[null==n?void 0:n.orderedParentIndex]:e:null==n?void 0:n.orderedBeforeNode]];for(const e of s){const[i,s,a]=e;if(i){var o;const l=a?"orderedParentIndex"===s?i.indexOf(a):a[s]:i.length;e.push(l),i.splice(l,0,...t),null!=n&&null!==(o=n[s])&&void 0!==o&&o.skip||r.updateChildrenIndices(i,s)}}return s[0][3]}removeFromChildren(e,t){const n=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const i of n){const[n,s]=i;if(n){const o=n.indexOf(e);var r;if(i.push(o),o>-1)n.splice(o,1),null!=t&&null!==(r=t[s])&&void 0!==r&&r.skip||this.updateChildrenIndices(n,s)}}return n[0][2]}sortOrderedChildren(e=!0,t=!1){const n=[];return this.isLeaf||(this.orderedChildren.sort(((e,r)=>{if(t){const t=(e.meta.modified.orderedParentIndex??e.orderedParentIndex)-(r.meta.modified.orderedParentIndex??r.orderedParentIndex);return 0!==t&&(n.push(e),n.push(r)),t}return e.orderedParentIndex-r.orderedParentIndex})),e&&this.orderedChildren.forEach((r=>{n.push(...r.sortOrderedChildren(e,t))})),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(n)}sortVisibleChildren(e=!0,t){const n=this;n.isLeaf||(n.children.sort(t),e&&n.orderedChildren.forEach((n=>n.sortVisibleChildren(e,t))),n.updateChildrenIndices(n.children,"parentIndex",!0))}sortUnfilteredChildren(e=!0,t){const n=this;!n.isLeaf&&n.unfilteredChildren&&(n.unfilteredChildren.sort(t),e&&n.orderedChildren.forEach((n=>n.sortUnfilteredChildren(e,t))),n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0))}unjoinStore(e,t=!1){var n;const r=this;r.unfilteredChildren&&(r.children=r.unfilteredChildren.slice(),r.unfilteredChildren=null),null===(n=super.unjoinStore)||void 0===n||n.call(this,e,t)}};const $i={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},_i={get(e,t){return"proxyMeta"===t?this.proxyMeta:"constructor"===t?e.constructor:"setData"===t?this.setDataOverride:"set"===t?this.setOverride:$i[t]?this.proxyMeta.data[t]:Reflect.get(e,t,this.proxyRecord)},set(e,t,n){return $i[t]?this.proxyMeta.data[t]=n:e[t]=n,!0},setDataOverride(e,t){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.setData(e,t)},setOverride(e,t,...n){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.set(e,t,...n)}};var ji=e=>class extends(e||ye){static $name="ModelLink";static isModel=!0;link(){if(this.isLinked)return this.$original.link();const e=this,t={..._i,proxyMeta:{originalRecord:e,data:{id:`${e.id}_link_${$.generateUUID()}`,stores:[]}}},n=new Proxy(e,t);return t.proxyRecord=n,(e.meta.linkedRecords||(e.meta.linkedRecords=[])).push(n),n}get isLinked(){var e;return Boolean(null===(e=this.proxyMeta)||void 0===e?void 0:e.originalRecord)}get hasLinks(){return Boolean(!this.proxyMeta&&this.$links.length)}removeLink(e,t=null,n=!1){if(e.hasLinks)for(const r of e.$links.slice())t?H.include(t,r):r.remove(n);else e.isLinked&&H.remove(e.$original.$links,e)}beforeRemove(e){this.removeLink(this,e)}removeChild(e,t,n,r){if(null==r||!r.isInserting){e=H.asArray(e);for(const t of e)this.removeLink(t,null,n)}return super.removeChild(e,t,n,r)}get $originalId(){return this.$original.id}get $links(){return this.meta.linkedRecords??[]}};const{defineProperty:Bi}=Reflect,Vi=Symbol("owner"),Hi=/[\s,]+/;var Ni=e=>class extends(e||ye){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(e,t,n=r.__BRYNTUM_EXAMPLE){const{factoryable:i}=this.initClass(),{caseless:s,registry:o}=i,a=$.split(e,Hi);for(let e,r,l=0;l<a.length;++l){if(r=a[l],e=s?r.toLowerCase():r,!n&&e in o)throw new Error(`Type "${r}" already registered with ${i.class.name} factory`);o[r]=o[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,n){const{factoryable:r}=this,{caseless:i,registry:s}=r,o=s[i?t.toLowerCase():t];return!!o&&(n?e instanceof o:e.constructor===o)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const n=t.super.class;let{factoryable:r}=e;r={caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type",...r},r.class=e,r.registry=Object.create(null),r.extends&&!Array.isArray(r.extends)&&(r.extends=[r.extends]),Bi(e,"factoryable",{get:()=>r})}static setupType(e,t){const{type:n}=e;e.register(n,e,t.replaceType),Bi(e.prototype,"type",{value:n})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,n){const r=this,{factoryable:i}=r,{typeKey:s}=i;let o,a,l,c,d,u,h,g,m,p=n;if(n&&!Xt.isClass(n)&&(p=null,h=typeof n,"function"===h?u=n:"string"===h?p=n:Xt.isObject(n)?(o=n.cleanup,a=n.defaults,c=n.owner,u=n.setup,p=n.type,g=n.transform):c=n),g&&(t="string"==typeof g?c[g](t):g(t)),m=t,"string"==typeof m)t={};else if(t){if(!0===t&&(t={}),!Xt.isObject(t)){var f;if(c&&t!==e&&(null==e?void 0:e[Vi])===c)"string"==typeof o?c[o](e):null===(f=o)||void 0===f||f(e),e.destroy();return t}m=t[s]}if(m=m&&r.resolveType(m),e){if(t&&(!m||e.constructor===m))return s in t&&delete(t=Xt.assign({},t))[s],e.setConfig(t),e;var v;if(c&&e[Vi]===c)"string"==typeof o?c[o](e):null===(v=o)||void 0===v||v(e),e.destroy()}if(t){if(a){if(!(l=m)){if(!(l=a[s]||p||i.defaultType))throw new Error(`No default mergeType defined for ${i.class.name} factory`);l=r.resolveType(l)}l&&(t=l.mergeConfigs(a,t))}if(u){if(d="string"==typeof u?c[u](t,m,a):u(t,m,a),null===d)return d;t=d||t}if(!m){if(!(m=t[s]||p||i.defaultType))throw new Error(`No default type defined for ${i.class.name} factory`);m=r.resolveType(m)}a&&!l&&(t=m.mergeConfigs(a,t)),s in t&&delete(t=Xt.assign({},t))[s],t=new m(t),c&&(t[Vi]=c)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:n}=this,r=n.extends;let i,s=n.registry[n.caseless?e.toLowerCase():e];for(i=0;!s&&r&&i<r.length;++i)s=r[i].resolveType(e,!0);if(!s&&!t)throw new Error(`Invalid type name "${e}" passed to ${n.class.name} factory`);return s}};const{getOwnPropertyDescriptor:zi}=Reflect;class Wi extends(ye.mixin(Ni)){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:i,persist:!0,readOnly:!1,internal:!1,useProp:null}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,n)=>t.compare(null==e?void 0:e[t.name],null==n?void 0:n[t.name]))}defineAccessor(e,t){const{name:n,dataSource:r}=this;!t&&n in e&&e.$meta.hierarchy.some((e=>{var t;return!1===(null===(t=zi(e.prototype,n))||void 0===t?void 0:t.enumerable)}))||Reflect.defineProperty(e,n,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(n,r)}:function(){return this.batching&&n in this.meta.batchChanges?this.meta.batchChanges[n]:r in this.data?this.data[r]:this.data[n]},set(e){const t=this.$meta.fields.map[n];t&&t.readOnly||this.set(n,e)}})}isEqual(e,t){return Xt.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}}Wi._$name="DataField";class Ui extends Wi{static $name="ArrayDataField";static type="array";isEqual(e,t){return e===t}getAt(e,t){return e.get(this.name)[t]}}Ui.initClass(),Ui._$name="ArrayDataField";class Gi extends Wi{static $name="BooleanDataField";static type="boolean";static alias="bool";static get prototypeProperties(){return{nullValue:!1}}isEqual(e,t){return null==e&&null==t||super.isEqual(e,t)}convert(e){var t;return null==e?this.nullable?e:this.nullValue:"false"!==(null===(t=e.toLowerCase)||void 0===t?void 0:t.call(e))&&Boolean(e)}}Gi.initClass(),Gi._$name="BooleanDataField";class Yi extends Wi{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return null==e?this.nullable||(e=this.nullValue):"now"===e?e=new Date:e instanceof Date||(e=Gt.parse(e,this.format||Gt.defaultParseFormat))&&!isNaN(e)||(e=i),e}serialize(e){return e instanceof Date&&(e=Gt.format(e,this.format||Gt.defaultFormat)),e}printValue(e){return Gt.format(e,this.format||Gt.defaultFormat)}}Yi.initClass(),Yi._$name="DateDataField";class qi extends Wi{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}}qi.initClass(),qi._$name="StringDataField";class Ki extends qi{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,t){return 0===Gt.compareUnits(e,t)}}Ki.initClass(),Ki._$name="DurationUnitDataField";class Xi extends Wi{static $name="IntegerDataField";static type="integer";static alias="int";static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}Xi.initClass(),Xi._$name="IntegerDataField";class Zi extends Wi{static get $name(){return"ModelDataField"}static get type(){return"model"}static configurable={modelClass:null};static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}}Zi.initClass(),Zi._$name="ModelDataField";class Ji extends Wi{static $name="NumberDataField";static type="number";static alias="float";static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,t){return isNaN(Number(e))&&isNaN(Number(t))||super.isEqual(e,t)}convert(e){if(null==e)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}Ji.initClass(),Ji._$name="NumberDataField";class Qi extends Wi{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}}Qi.initClass(),Qi._$name="ObjectDataField";class es extends Wi{static $name="StoreDataField";static type="store";init(e,t){var n;const r=this,i=`${r.name}Store`,s={skipStack:!0,syncDataOnLoad:!0};if(r.store&&Xt.assign(s,r.store),r.modelClass&&(s.modelClass=r.modelClass),null===(n=t[`init${$.capitalize(i)}`])||void 0===n||n.call(t,s),!s.storeClass&&!r.storeClass)throw new Error(`Field '${r.name}' with type 'store' must have a storeClass configured`);const o=t.meta[i]=new(s.storeClass||r.storeClass)(s);r.complexMapping?Xt.setPath(e,r.dataSource,o):e[r.dataSource]=o,o.verifyNoGeneratedIds=!1,o.usesId=!o.count||!o.every((e=>e.hasGeneratedId)),o.$currentValue=r.getValue(o),o.ion({change:({action:e})=>{const n=r.getValue(o);if(!o.$isSettingStoreFieldData){const i=o.$preserveCurrentDataset;o.$preserveCurrentDataset=r.subStore&&("update"===e||"remove"===e||"add"===e),r.$isUpdatingRecord=!0,t.set(r.name,n),r.$isUpdatingRecord=!1,o.$preserveCurrentDataset=i}o.$currentValue=n}})}set(e,t,n){var r;const i=this,s=`${i.name}Store`,{[s]:o}=n.meta;if(!o)return n.meta.initableValues.set(i,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(null===(r=n[`process${$.capitalize(s)}Data`])||void 0===r?void 0:r.call(n,e,n))??e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every((e=>e.hasGeneratedId)))}serialize(e,t){const n=t.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(n):n.$currentValue}getValue(e){return e.allRecords.map((t=>{const n=t.persistableData;return e.usesId||delete n.id,n}))}isEqual(e,t){if(null==e&&null==t)return!0;if(null==e&&null!=t||null!=e&&null==t)return!1;if(e.isStore&&t.isStore)return Xt.isDeeplyEqual(e.$currentValue,t.$currentValue);if(e.isStore&&t.isStore||!e.isStore&&!t.isStore)return Xt.isEqual(e,t,!0);{const r=(e.isStore?e:t).modelClass,s=r.$meta.fields.defs,o=e.isStore?e.$currentValue:t.$currentValue,a=e.isStore?t:e;if(o.length!==a.length)return!1;for(let e=0;e<s.length;e++){const t=s[e];if(t.persist)for(let e=0;e<o.length;e++){const s=o[e][t.dataSource],l=a[e][t.dataSource];if(s!==i&&l===i){if(t.dataSource===r.idField&&("string"==typeof(n=s)&&n.startsWith("_generated")))continue;if(t.defaultValue!==i&&Xt.isEqual(t.defaultValue,s,!0))continue}if(!Xt.isEqual(s,l,!0))return!1}}return!0}var n}getOldValue(e){const t=e.meta[`${this.name}Store`];return t?Xt.clone(t.$currentValue):null}getAt(e,t){const n=e.meta[`${this.name}Store`];return null==n?void 0:n.getAt(t)}}es.initClass(),es._$name="StoreDataField";const ts=new RegExp(/^(.*?)\.(.*)/),ns=/(.*)\[(.*)]\.?(.*)/,{defineProperty:rs}=Reflect,{hasOwn:is}=Xt,ss=i,os={children:1,data:1,meta:1},as=["name","title","text","label","description"],ls={boolean:1,number:1,date:1,object:1},cs={parentId:1,$PhantomId:2,id:3};class ds extends(ye.mixin(Fi,Li,ji)){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0},{name:"groupParent",persist:!1,internal:!0}]}static relations=null;static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(null==e?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,n=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[n--]=t.parentIndex+1;return e}construct(e={},t=null,n=null,r=!1,s=!1,o=!1){var a;const l=this,c=H.asArray(t)??[],{constructor:d,fieldMap:u}=l;let h=null;if(t=c[0],l.meta={modified:{},...d.metaConfig,...n},d.applyConfigs){h={},l.useRawData&&l.useRawData.enabled||(e={...e});const t=l.getDefaultConfiguration();if(d.autoExposeFields)for(const n in t)n in e&&(e[n]!==i&&(h[n]=e[n]),delete e[n]);else for(const n in e)n in d.fieldMap||(e[n]===i?h[n]=t[n]:h[n]=e[n],delete e[n])}if(super.construct(h),r||d.exposeProperties(e,o),!is(d,"idFieldProcessed")){let e=l.meta.idField;e||(d._assignedIdField?e=d.idField:t&&(e=t.idField)),e&&e!==u.id.dataSource&&d.addField({name:"id",dataSource:e,internal:!0}),d._idField=u.id.dataSource,d.idFieldProcessed=!0}l._internalId=ds._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=d.processData(e,!1,t,l,s),(null===(a=l.meta.initableValues)||void 0===a?void 0:a.size)&&l.assignInitables(),null==l.id&&l.setData("id",l.generateId(t)),l.data[d.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const t=this;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,t.stores.forEach((n=>{n.onIsCreatingToggle(t,e)})))}get isCreating(){return Boolean(this.meta.isCreating)}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,n=0,{length:r}=t;n<r;n++){const r=t[n],{name:i}=r;if("id"!==i&&!r.isEqual(this.getValue(i),e.getValue(i)))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:ss},this.data),this.stores[0],null,!0)}static processData(e,t=!1,n,r,i){const{fieldMap:s,fieldDataSourceMap:o,defaultValues:a}=this,{useRawData:l={enabled:!1}}=n||{},c=i||l.enabled?e:Xt.clone(e);let d;if(!(t=t||l.disableDefaultValue||i))for(d in a){const e=o[d];let t=a[d];Array.isArray(t)&&(t=t.slice()),null!=e&&e.complexMapping?Xt.getPath(c,d)===ss&&Xt.setPath(c,d,t):c[d]===ss&&(c[d]=t)}if(!l.disableTypeConversion&&!i)for(d in s){const n=s[d],{name:i,dataSource:o}=n,a=o!==i,u=n.complexMapping,h=a&&(u?Xt.pathExists(e,o):o in e),g=i in e&&(!a||!h),m=!l.disableTypeConversion&&n.convert;if((g||m)&&(!t||g||h)){const t=g?c[i]:u?Xt.getPath(c,o):c[o],s=m?n.convert(t,e,r):t;u?Xt.setPath(c,o,s):c[o]=s,a&&delete c[i]}}return this.$meta.fields.initable.length&&this.initInitables(r,c),c}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){const n=is(e,"fields")&&e.fields,r=t.super.fields,i=t.fields={defs:(null==r?void 0:r.defs.slice())??[],exposedData:!1,defaults:r?{...r.defaults}:{},exposed:Object.create((null==r?void 0:r.exposed)??null),ordinals:Object.create((null==r?void 0:r.ordinals)??null),map:Object.create((null==r?void 0:r.map)??null),sources:Object.create((null==r?void 0:r.sources)??null)};is(e,"defaults")&&Object.assign(i.defaults,e.defaults),is(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),i.exposed[e.idField]=!0),null!=n&&n.length&&n.map(e.addField,e),i.initable=i.defs.filter((e=>e.init)),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const n=this,r=n.$meta.fields,i=t?"exposed":"map";if(e&&n.autoExposeFields&&!r.exposedData){let t,s,o;for(t in e)r[i][t]||t===n.childrenField||(o=Xt.typeOf(e[t]),s={name:t,dataSource:t,fromData:!0},ls[o]&&(s.type=o),n.addField(s));r.exposedData=!0}n.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),n=t.$meta.fields,{ordinals:r}=n,i=n.exposed,{name:s}=e,o=n.map[s],a=e.dataSource||(e.dataSource=s);let l,c;if(!o||e.type&&e.type!==o.type)l=Wi.create(e),l.definedBy=o?o.definedBy:t,l.ordinal=o?o.ordinal:r[s]=n.defs.length;else for(c in l=Object.create(o),e)"type"!==c&&(l[c]=e[c]);return l.owner=t,n.defs[l.ordinal]=l,n.map[s]=l,n.sources[a]||(n.sources[a]=l),a.includes(".")&&(l.complexMapping=!0),l.complexMapping?i[a.split(".")[0]]=!0:i[a]=!0,"defaultValue"in l&&(n.defaults[a]=l.defaultValue),os[s]||l.defineAccessor(t.prototype),t._nonPersistableFields=null,t._alwaysWriteFields=null,l}static removeField(e){const t=this.initClass(),n=t.$meta.fields,r=n.map[e],{ordinals:i}=n,s=i[e];if(r){n.defs.splice(s,1),delete i[e],delete n.defaults[e],delete n.exposed[e],delete n.map[e],delete n.sources[r.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;if(!is(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const t in e.relations){const n=e.relations[t];n.relationName=t,e.exposedRelations.push(n),Reflect.ownKeys(e.prototype).includes(t)||rs(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(e){this.setForeign(t,e,n)}})}}}static initInitables(e,t){const n=e.meta.initableValues=new Map;for(const r of this.$meta.fields.initable){const s=Xt.getPath(t,r.dataSource);s!==i&&n.set(r,s),!r.lazy&&r.init(t,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,n]of e)!1!==t.set(n,this.data,this)&&e.delete(t)}static get autoExposeFields(){return!0}static fieldSorter(e,t){return(cs[e]||100)-(cs[t]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){const t=this.fieldMap[e];if(!t)if(e.includes("[")){const[,t,,r]=e.match(ns),i=t.includes(".")?this.getFieldDefinition(t):this.fieldMap[t];var n;if(null!=i&&i.isStoreDataField)return null===(n=i.modelClass)||void 0===n?void 0:n.getFieldDefinition(r)}else if(e.includes(".")){const[t,n]=e.split(".",2),i=this.fieldMap[t];var r;if(i.isModelDataField&&i.modelClass)return null===(r=i.modelClass)||void 0===r?void 0:r.getFieldDefinition(n)}return t}static getFieldDataSource(e){var t;return(null===(t=this.getFieldDefinition(e))||void 0===t?void 0:t.dataSource)||e}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t,n){const r=this.fieldMap[e];return null!=r&&r.convert?r.convert(t,this.data,n):t}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach((t=>{var n;t.modelRelations||t.initRelations();const r=[];null===(n=t.modelRelations)||void 0===n||n.forEach((t=>{r.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,r)}))}initRelation(e){const t=this,n=t.get(e.foreignKey),r=n!==ss&&"string"!=typeof e.foreignStore&&e.foreignStore.getById(n);return(t.meta.relationCache||(t.meta.relationCache={}))[e.relationName]=r||(null!=n?{id:n,placeHolder:!0}:null),r}removeRelation(e){const{relationName:t,foreignKey:n,nullFieldOnRemove:r}=e;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],r&&this.setData(n,null))}getForeign(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}setForeign(e,t,n){const r=ds.asId(t);return this.set(n.foreignKey,r)}getRelationConfig(e){var t,n;return null===(t=this.firstStore)||void 0===t||null===(n=t.modelRelations)||void 0===n?void 0:n.find((t=>t.foreignKey===e))}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:t in this.data?this.data[t]:this.data[e]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:Xt.getPath(this.data,t)}get(e){if(!e)return;const t=this,n=t.fieldMap[e];if(!n){if(e.includes("[")){const[,n,r,i]=e.match(ns),s=t.fieldMap[n];if(null!=s&&s.getAt){t._thisIsAUsedExpression(t[n]);const e=s.getAt(t,r);return e&&i?e.isModel?e.getValue(i):e[i]:e}return null}if(e.includes("."))return Xt.hasPath(t.data,e)?t.complexGet(e,e):Xt.getPath(t,e)}return null!=n&&n.complexMapping?t.complexGet(e,n.dataSource):t.flatGet(e,(null==n?void 0:n.dataSource)||e)}getValue(e){if(e)return e in this?this[e]:this.get(e)}setValue(e,t){e in this?this[e]=t:this.set(e,t)}setData(e,t){const{data:n,fieldMap:r}=this;if("string"==typeof e){const i=r[e],s=(null==i?void 0:i.dataSource)??e;null!=i&&i.set?i.set(t,this.data,this):null!=i&&i.complexMapping?Xt.setPath(n,s,t):n[s]=t}else{const i=Object.keys(e);for(let s=0;s<i.length;s++){const o=i[s],a=r[o],l=(null==a?void 0:a.dataSource)??o;null!=a&&a.set?a.set(t,this.data,this):l&&(null!=a&&a.complexMapping?Xt.setPath(n,l,e[o]):n[l]=e[o])}}}getData(e){const t=this.fieldMap[e],n=(null==t?void 0:t.dataSource)??e;if(n)return null!=t&&t.complexMapping?Xt.getPath(this.data,n):this.data[n]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const n={id:{value:e,oldValue:t}};this.afterChange(n,n)}}set(e,t,n=!1,r=!1,i=!1,s=!1,o=!0){const a=this;if(a.isBatchUpdating)return a.inBatchSet(e,t,n||a.$silenceBatch),null;{var l;const c=a.inSet(e,t,n,r,i,s,o);return null===(l=a.afterSet)||void 0===l||l.call(a,e,t,n,r,c),c}}fieldToKeys(e,t){return"string"!=typeof e?Xt.assign({},e):{[e]:t}}inBatchSet(e,t,n){const r=this,{meta:i,constructor:s,fieldMap:o}=r,a={};let l,c=!1;if("string"!=typeof e?Object.keys(r.fieldToKeys(e,t)).forEach((n=>{l=o[n]||Xt,t=s.processField(n,e[n],r),l.isEqual(i.batchChanges[n],t)||(a[n]={value:t,oldValue:r.get(n)},i.batchChanges[n]=t,c=!0)})):(l=o[e]||Xt,l.isEqual(i.batchChanges[e],t)||(a[e]={value:t,oldValue:r.get(e)},i.batchChanges[e]=t,c=!0)),c&&(r.generation++,!n)){const e={action:"update",record:r,records:[r],changes:a};r.stores.forEach((t=>{t.trigger("batchedUpdate",{...e})})),r.forEachLinked(((t,n)=>t.trigger("batchedUpdate",{...e,record:n,records:[n]})))}}inSet(e,t,n,r,s=!1,o=!1,a=!0){const l=this,{data:c,meta:d,fieldMap:u,constructor:h}=l,{prototype:g,childrenField:m,relations:p}=h,f={},v=l.fieldToKeys(e,t),y=Object.keys(v).sort(h.fieldSorter);let b=!1;if(!n&&a&&!l.triggerBeforeUpdate(v))return null;l.inSetting=!0;for(let e=0;e<y.length;e++){const t=y[e];if(t===m)continue;if(t.includes("[")){const[,e,n,r]=t.match(ns),i=l.fieldMap[e];if(null!=i&&i.getAt){const e=i.getAt(l,n);e.isModel?e.set(r,v[t]):Xt.setPath(e,r,v[t]);continue}}const n=t.includes(".");if(p&&n){const[,e,n]=t.match(ts);if(p[e]){l[e].set(n,v[t]);continue}}const a=u[t],S=a||Xt,D=null==a?void 0:a.readOnly,w=(null==a?void 0:a.dataSource)??t,E=!s&&!a&&t in g||(null==a?void 0:a.useProp),x=E?l[w]:null!=a&&a.complexMapping||n?Xt.getPath(c,w):c[w],R=h.processField(t,v[t],l),T=v[t]={value:R},M=l.getRelationConfig(t),k=(e,t)=>S.isEqual(e,t)||null==e&&null==t;var C;if(!(D||k(x,R)||o&&R===i))l.generation++,T.oldValue=(null==a||null===(C=a.getOldValue)||void 0===C?void 0:C.call(a,l))??x,b=!0,t in d.modified&&k(d.modified[t],R)?(Reflect.deleteProperty(d.modified,t),l.isReverting&&(l.data[w]=R)):l.ignoreBag||(t in d.modified||l.storeFieldChange(t,x),T.oldValue===ss&&Reflect.deleteProperty(T,"oldValue")),f[t]=T,l.applyValue(E,w,R,s,a),M&&!r&&(l.initRelation(M),l.stores.forEach((e=>e.cacheRelatedRecord(l,R,M.relationName,T.oldValue))))}return b&&l.afterChange(v,f,n,r,s),l.inSetting=!1,b?f:null}applyValue(e,t,n,r,i){var s,o,a;const l=this;var c;if(((null===(s=i)||void 0===s?void 0:s.dataSource)||t)===l.constructor.idField&&(l.$isPhantom=!1),((null===(o=i)||void 0===o?void 0:o.dataSource)||t)===l.constructor.parentIdField)(null===(c=l.parent)||void 0===c||!c.isRoot||null!=n&&l.firstStore.getById(n))&&(l.firstStore.getById(n)||l.firstStore.rootNode).insertChild(l,null,!1,{orderedParentIndex:{skip:!0}});else if(e){var d;l[(null===(d=i)||void 0===d?void 0:d.name)||t]=n}else if(null!==(a=i)&&void 0!==a&&a.set)i.set(n,l.data,l);else{var u;let e=null===(u=i)||void 0===u?void 0:u.complexMapping;if(!i&&t.includes(".")){var h,g;const n=t.split(".")[0];e=(null===(h=i=l.constructor.fieldMap[n])||void 0===h?void 0:h.complexMapping)||"object"===(null===(g=i)||void 0===g?void 0:g.type)}e?Xt.setPath(l.data,t,n):l.data[t]=n}}afterChange(e,t,n,r,i){for(const s of this.stores)s.onModelChange(this,e,t,n,r,i);this.forEachLinked(((s,o)=>s.onModelChange(o,e,t,n,r,i)))}forEachLinked(e){for(const t of this.$links)for(const n of t.stores)e(n,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!Xt.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,n=(null==t?void 0:t.name)||e;let r;return t&&!t.persist||(r=this.getValue(n),null!=t&&t.serialize&&(r=t.serialize(r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((r=>{const i=e.getFieldPersistentValue(r);i!==ss&&(t[r]=i,n=!0)})),n?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&Xt.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,n={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((i=>{var s,o;let a=t[i],l=null===(s=a)||void 0===s?void 0:s.dataSource;if(i.includes(".")){const e=i.match(ts)[1];a=t[e],l=i}if(null!==(o=a)&&void 0!==o&&o.persist){const t=e.getFieldPersistentValue(i);t!==ss&&(Xt.setPath(n,l,t),r=!0)}})),r?n:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,t=this.modificationData;return e.forEach((e=>{t[this.getFieldDefinition(e).dataSource]=this.getFieldPersistentValue(e)})),t}get persistableData(){const e=this,t={};return e.fields.forEach((n=>{const r=e.getFieldPersistentValue(n);r!==ss&&(null!=n&&n.complexMapping?Xt.setPath(t,n.dataSource,r):t[n.dataSource]=r)})),t}get dataByFieldName(){const{data:e}=this;return this.fields.reduce(((t,n)=>(Xt.hasPath(e,n.dataSource)&&(t[n.name]=e[n.dataSource]),t)),{})}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0,n=null){const r=this,{meta:i}=r;if(n)for(const e in n)delete i.modified[e];else i.modified={};const s=Xt.isEmpty(i.modified);i.committing=!1,t&&r.stores.forEach((t=>{if(s&&t.modified.remove(r),t.added.remove(r),e){const e=t.collectDescendants(r).all;t.added.remove(e),s&&t.modified.remove(e)}}))}storeFieldChange(e,t){this.meta.modified[e]=t}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,ss,e),this.isReverting=!1}setByDataSource(e){const{fieldDataSourceMap:t}=this.constructor,n=Xt.pathifyKeys(e,t),r={};for(const e in n){const i=t[e];r[(null==i?void 0:i.name)??e]=n[e]}return this.set(r)}applyChangeset(e,t="$PhantomId",n=!0){const r=this,i=r.constructor,{idField:s,fieldDataSourceMap:o}=i,a=Xt.pathifyKeys(e,o),l=Xt.pathifyKeys(r.modificationData),c={},d=t in e&&!(s in e);!d&&t in a&&delete a[t];for(const e in a){const t=o[e],r=(null==t?void 0:t.name)??e;(n||((null==t?void 0:t.name)===s?d:a[e]===l[e]))&&(c[r]=a[e])}const u=r.set(c);return r.clearChanges(!1,!0,n?null:c),u?Object.entries(u).reduce(((e,[t,n])=>(e[t]=n.value,e)),{}):{}}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId||Boolean(this.$isPhantom)}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${$.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return null!=e&&e.isModel?e.id:Xt.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return $.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,n=this.persistableData;return(t||e)&&(n[this.constructor.childrenField]=(t||e).map((e=>e.toJSON()))),n}toString(){const e=this,t=as.find((t=>t in e.constructor.fieldMap)),n=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return $.safeJsonStringify(n)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t,n;return null===(t=this.meta)||void 0===t||null===(n=t.batchChanges)||void 0===n?void 0:n[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1,n=!0){const r=this,{parentIdField:s}=r.constructor;if(r.batching&&(r.batching--,r.$silenceBatch&&r.$silenceBatch--,!(r.batching>0||Xt.isEmpty(r.meta.batchChanges)))){let{batchChanges:o}=r.meta;r.meta.batchChanges=null,o[s]&&(o={...o},r.parentId=o[s],delete o[s]),r.set(o,ss,e,!1,t,i,n)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:t}=e.meta,n={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(t).forEach((([t,r])=>{n[t]={oldValue:r,value:e[t]}}));const r={action:"update",record:e,records:[e],changes:n};e.stores.forEach((e=>{e.trigger("batchedUpdate",{...r})})),e.forEachLinked(((e,t)=>{e.trigger("batchedUpdate",{...r,record:t,records:[t]})}))}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!(null!==(t=this.stores)&&void 0!==t&&t.some((t=>!1===t.trigger("beforeUpdate",{record:this,changes:e}))))}copy(e=null,t){const n=this,r=Xt.clone(n.data),s=n.constructor.idField,o=Xt.isObject(t)?t.deep:t;let a;if(e&&"object"==typeof e?(a=e[s],Object.assign(r,e)):a=e,o&&n.children?r.children=n.children.map((e=>e.copy(i,t))):(delete r.children,delete r.expanded),n.$meta.fields.initable.length>0){const e=n.toJSON();for(const t of n.$meta.fields.initable)r[t.name]=e[t.name]}!1!==e&&(r[s]=a||n.generateId(n.firstStore));const l=new n.constructor(r,null,null,!1,!0);return l.originalInternalId=n.internalId,l}copyData(e,t,n){const r={};e.allFields.forEach((({name:n})=>{n!==e.constructor.idField&&(r[n]=t?e.get(n):e.getValue(n))})),this.set(r,null,n)}remove(e=!1){const t=this,{parent:n,stores:r}=t;if(n)n.removeChild(t);else if(r.length&&!t.isSpecialRow){r.slice().forEach((n=>n.remove(t,e,!1,!0)))}}beforeRemove(e,t){return super.beforeRemove(e,t)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){const t=this,{stores:n}=t;if(!n.includes(e)){var r;const{unjoinedStores:i}=t;super.joinStore(e),e.register(t),n.push(e),i.includes(e)&&i.splice(i.indexOf(e),1),t.isLoaded&&t.children.forEach((t=>t.joinStore(e))),t.initRelations(),!e.tree||t.isRoot||null!==(r=e.stm)&&void 0!==r&&r.isRestoring||(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,t=!1){const n=this,{stores:r,unjoinedStores:i}=n;var s,o,a;r.includes(e)&&(e.isDestroying||(e.unregister(n),i.push(e)),null===(s=n.unfilteredChildren||n.children)||void 0===s||null===(o=s.forEach)||void 0===o||o.call(s,(n=>n.unjoinStore(e,t))),r.splice(r.indexOf(e),1),null===(a=super.unjoinStore)||void 0===a||a.call(this,e,t),e.uncacheRelatedRecord(n))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){var t;const{meta:n}=this,r=e.id||e;return(null===(t=n.map)||void 0===t?void 0:t[r])||this.setInstanceMeta(r,{})}setInstanceMeta(e,t){const{meta:n}=this,r=e.id||e;return n.map||(n.map={}),n.map[r]=t}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return Boolean(null===(e=this.meta)||void 0===e?void 0:e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((t=>{t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach((t=>{t.alwaysWrite&&e._alwaysWriteFields.push(t.name)}))),e._alwaysWriteFields}get domId(){return"string"==typeof this.id?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta;return`class ${t[t.length-2]} extends ${t[t.length-3]} { static fields = ${$.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:t,children:n}=this,{defaultValues:r,applyConfigs:i}=this.constructor,s=i?super.getCurrentConfig(e):{};if(s){for(const n of this.fields)if(n.persist){const i=Xt.getPath(t,n.dataSource);n.isEqual(i,r[n.name])||Xt.setPath(s,n.dataSource,ye.processConfigValue(i,e))}if(n)if(Array.isArray(n)){s.children=[];for(const t of n)s.children.push(t.getCurrentConfig(e))}else s.children=n;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}}ds._idField="id",ds._internalIdCounter=1,ds._assignedIdField=!1,ds.exposeProperties(),ds._$name="Model";class us{constructor(e,t){"number"==typeof e||null===e?(this._magnitude=e,this._unit=t):("string"==typeof e&&Object.assign(this,Gt.parseDuration(e)),"object"==typeof e&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=Gt.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&Boolean(Gt.normalizeUnit(this._unit))}get milliseconds(){return this.isValid?Math.round(Gt.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e)&&null!=this._magnitude&&null!=e._magnitude&&this.milliseconds===e.milliseconds}toString(e){const t=this,n=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${Gt[n](t._unit,1!==t._magnitude)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}diff(e){return new us({unit:this.unit,magnitude:Gt.as(this.unit,this.milliseconds-e.milliseconds)})}}us._$name="Duration";const hs=(e,t)=>null==e?void 0:e[t],gs=/^is(this|next|last)(week|month|year)$/i,ms=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"];class ps extends(ye.mixin(ki)){static $name="CollectionFilter";static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"!==e.type||null==e.value||Array.isArray(e.value)?"duration"!==e.type||null==e.value||Array.isArray(e.value)||(e.value=new us(e.value)):e.value=new Date(e.value):Gt.isDate(e.value)||Array.isArray(e.value)&&e.value.every(Gt.isDate)?e.type="date":e.value instanceof us&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=ps.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||ps.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var t;const n=this;n.isConfiguring||null===(t=n.owner)||void 0===t||!t.onFilterChanged||n.owner.isConfiguring||n.owner.onFilterChanged(n,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let n;return n=e.isModel?e.getValue(t.property):t._propertyItems.length>1?t._propertyItems.reduce(hs,e):e[t.property],t[t.operator](t.convert(n))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&"string"==typeof e[0])?t._filterValue=e.map((e=>t.convert(e))):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?t._filterValue=e.map((e=>null==e?void 0:e.toLowerCase())):t.caseSensitive||"string"!=typeof e?t._filterValue=t.convert(e):t._filterValue=e.toLowerCase(),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":"string"==typeof e.filterValue?"*":"="}convert(e){var t;"sameTime"===this.operator||"string"==typeof this.filterValue&&e instanceof Date||("sameDay"===this.operator&&(e=Gt.clearTime(e)),e=(null===(t=e)||void 0===t?void 0:t.valueOf())??e);return e=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return 0===this.filterValue.length||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return 0===this.filterValue.length||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return Gt.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return Xt.isEqual(e,this.filterValue)}"!="(e){return!Xt.isEqual(e,this.filterValue)}">"(e){return Xt.isMoreThan(e,this.filterValue)}">="(e){return Xt.isMoreThan(e,this.filterValue)||Xt.isEqual(e,this.filterValue)}"<"(e){return Xt.isLessThan(e,this.filterValue)}"<="(e){return Xt.isLessThan(e,this.filterValue)||Xt.isEqual(e,this.filterValue)}"*"(e){return Xt.isPartial(e,this.filterValue)}between(e){const[t,n]=this._filterValue;return(Xt.isMoreThan(e,t)||Xt.isEqual(e,t))&&(Xt.isLessThan(e,n)||Xt.isEqual(e,n))}notBetween(e){return!this.between(e)}empty(e){return e===i||null===e||0===String(e).length}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return!0===e}isFalse(e){return!1===e}setRelativeDateValues(){this._filterValue=ps.getRelativeDateRange(this._operator).map((e=>e.valueOf()))}static getRelativeDateRange(e,t=new Date){let n,r,i,s,o,a,l;switch(e){case"isYearToDate":return[Gt.floor(t,"1 year"),t];case"isToday":return n=Gt.floor(t,"1 day"),[n,Gt.add(n,1,"day")];case"isYesterday":return n=Gt.floor(t,"1 day"),[Gt.add(n,-1,"day"),n];case"isTomorrow":return r=Gt.getStartOfNextDay(t),[r,Gt.add(r,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(i=e.toLowerCase().match(gs),!i)throw new Error(`Unrecognized relative date expression: ${e}`);return[,a,l]=i,s=`1 ${l}`,o=Gt.floor(t,s),"next"===a?o=Gt.add(o,1,l):"last"===a&&(o=Gt.add(o,-1,l)),[o,Gt.add(o,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return Me.returnTrue;for(const t of e)"date"===t.type&&ms.includes(t._operator)&&t.setRelativeDateValues();return function(t){let n=!0;for(const r of e)if(r.disabled||(n=r.filter(t)),!n)break;return n}}}ps._$name="CollectionFilter";const fs=Xt.getPathDefault(r,"bryntum.idCounts",Object.create(null));class vs{static generateId(e="generatedId"){return e+(fs[e]=(fs[e]||0)+1)}}vs._$name="IdHelper";class ys extends ye{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||vs.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:n,property:r,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[r],t=t[r],n&&(e=n(e),t=n(t)),i&&null!=e&&null!=t&&"string"==typeof e){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const n=e.isCollection?e.values:e,r=n.length;return(e,i)=>{let s,o;for(o=0;o<r;++o)if(s=n[o].sortFn(e,i),s)return s;return t?t(e,i):0}}}ys._$name="CollectionSorter";const bs=()=>0,Cs=(e,t)=>t-e,Ss=Symbol("filteredIndicesProperty"),Ds=Object.freeze([]),ws=Object.freeze({action:"sort",added:Ds,removed:Ds,replaced:Ds}),Es=Object.freeze({action:"filter",added:Ds,removed:Ds,replaced:Ds}),xs={string:1,number:1};function Rs(e,t,n,r){if(!1!==t.unique)t.set(n,e),r&&t.count++;else{let r=t.get(n);r||(r=new Set,t.set(n,r)),r.add(e)}}function Ts(e,t,n,r,i=!1){for(let s=0;s<e.length;s++){const o=e[s];for(let e=0;e<r;e++){const r=n[e],s=o[r],a=t[r];Rs(o,a,s,!i&&a.onDuplicate)}}}class Ms extends(ye.mixin(Ge)){_sortFunction=null;_addedValues=null;static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null===(e=t._sorters)||void 0===e||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:n}=this;return t&&(e=e.map(t),n=n.map(t)),H.delta(e,n).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:n=!1,isNewDataset:r=!1}){const s=this;let o,a;if(s.isFiltered&&!r){Boolean(t)?e&&(o=s._values,s._values=e.slice()):(t=e.slice(),e=null),a=s._filteredValues,s._filteredValues=t.slice()}else o=s._values,s._values=e.slice(),t=null,s.isFiltered&&r&&s.autoFilter?(s._filterFunction=null,s._filteredValues=s._values.filter(s.filterFunction)):s._filteredValues&&(s._filteredValues.length=0);s._indicesInvalid=!0,s._addedValues=i,s.generation++,n||s.trigger("change",{action:"replaceValues",replacedValues:o,replacedFilteredValues:a,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}reduce(e,t=!1,n=[]){return(this.isFiltered&&!t?this._filteredValues:this._values).reduce(e,n)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,t=!0){const n=this,{_values:r}=n,i=[];return n.forEach((s=>{const o=e.get(s.id,!0);if(o){const e=n.indexOf(s,!0),t=r[e];r[e]=o,n.removeFromIndices(t),n.addToIndices(o)}else t&&i.push(s)})),i.length&&n.remove(i),n.isFiltered&&(n._filteredValues=n._values.filter(n.filterFunction)),i}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=H.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const n=this,{_values:r}=n,i=n.indexOf(e[0],!0);if(1===e.length&&r[i+1]===t)return;n.suspendEvents(),n.remove(e),n.resumeEvents();const s=t?n.indexOf(t,!0):r.length;if(-1===s)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice(s,0,...e),n._indicesInvalid=1,n.trigger("change",{action:"move",items:e,from:i,to:s}),s}splice(e=0,t,...n){var r;const i=this,s=i.idProperty,o=i._values,a={},l=[],c=[],d=i.totalCount;let u,h;if(1===(null===(r=n)||void 0===r?void 0:r.length)&&Array.isArray(n[0])&&(n=n[0]),!1!==i.trigger("beforeSplice",{index:e,toRemove:t,toAdd:n})){if(n)if(d&&n.length){const e=i.indices[s];u=[];for(let t=0;t<n.length;t++){const r=n[t],i=r[s],l=e.get(i),d=l?o.indexOf(l):-1;a[i]=!0,-1!==d?o[d]!==r&&(c.push([o[d],r]),o[d]=r):u.push(r)}}else u=n;if(t){if("number"==typeof t){t=Math.min(t,o.length-e);for(let n=e;t;--t){a[o[n][s]]?(e++,n++):(l.push(o[n]),o.splice(n,1),h=!0)}}else{let e,n=0===u.length;const r=(t=H.asArray(t)).reduce(((t,r)=>{const s="number"==typeof r,o=s?r:i.indexOf(r,!0);return n&&(null!=e&&o!==e+1||s)&&(n=!1),o>=0&&o<d&&t.push(o),e=o,t}),[]).sort(Cs);if(n)r.length&&(l.push.apply(l,t),o.splice(r[r.length-1],r.length),h=!0);else for(let e=0;e<r.length;e++){const t=r[e];if(-1!==t){a[o[t][s]]||(l.unshift(o[t]),o.splice(t,1),h=!0)}}}l.length&&!i._indicesInvalid&&l.forEach(i.removeFromIndices,i)}if(u.length){o.splice(Math.min(e,o.length),0,...u),h=!0,i._indicesInvalid||u.forEach(i.addToIndices,i),i._addedValues||(i._addedValues=new Set);for(const e of u)i._addedValues.add(e)}if(l.length&&i._addedValues)for(const e of l)i._addedValues.delete(e);c.length&&!i._indicesInvalid&&c.forEach((e=>{i.removeFromIndices(e[0]),i.addToIndices(e[1])})),h||c.length?(i.isSorted?i.onSortersChanged():i.isFiltered&&(i.autoFilter?i.onFiltersChanged({action:"splice",oldCount:1}):i._filteredValues.splice(Math.min(e,i._filteredValues.length),0,...u)),i.generation++,i.trigger("change",{action:"splice",removed:l,added:u,replaced:c,oldCount:d})):i.trigger("noChange",{index:e,toRemove:t,toAdd:n})}}changeId(e,t){const n=this,{idProperty:r}=n,i=xs[typeof e]?e:e[r],s=n.get(i);if(s){const o=n.get(t);if(o&&s!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);n.removeIndexEntry(e,r,i),n.addIndexEntry(e,r,t),s[r]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,n=!1){return this.findItem(e,t,this.isFiltered&&n)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Ms({values:H.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof ys?e:new ys(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",ws)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=ys.generateSortFunction(this.sorters.values):this._sortFunction=bs),this._sortFunction}get filters(){return this._filters||(this._filters=new Ms({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof ps?e:new ps(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:n}){const r=this,i=n||"clear"===e&&t.length?r._filteredValues:r._values;r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction),r._indicesInvalid=!0;const{toAdd:s,toRemove:o}=H.delta(r._filteredValues,i,!0);r.trigger("change",{...Es,added:s,removed:o})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=ps.generateFiltersFunction(this.filters.values):this._filterFunction=Me.returnTrue),this._filterFunction}changeExtraKeys(e){return H.asArray(e).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,n=!1){const r=this.findItem(e,t,n);if(!r)return-1;return(this.isFiltered&&!n?this._filteredValues:this._values).indexOf(r)}findItem(e,t,n=!1){const r=this,{isFiltered:i}=r,s=i&&!n?r.indices[Ss][e]:r.indices[e];if(s){const e=s.get(t)??("string"==typeof t&&t.length&&!isNaN(t)&&s.get(Number(t))||null);if(null!=e)return e}else{const s=i&&!n?r._filteredValues:r._values,o=s.length;for(let n=0;n<o;n++){const r=s[n];if(r[e]==t)return r}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some((e=>e.dependentOn))}indexOf(e,t=!1){return this.findIndex(this.idProperty,xs[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some((e=>this.includes(e))):Boolean(this.findItem(this.idProperty,xs[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,n=e._indices||(e._indices={}),r=Object.keys(n),i=r.length,s=e._values;let o,a=!1;t&&(o=n[Ss]={});for(let e=0;e<i;e++){const i=n[r[e]];if(i.clear(),i.onDuplicate&&(i.count=0,a=!0),t){let t=o[r[e]];t?t.clear():(t=o[r[e]]=new Map,t.unique=i.unique)}}if(Ts(s,n,r,i),a)for(let e=0;e<i;e++){const t=n[r[e]];if(t.onDuplicate&&t.count>t.size){const n=new Set;for(let i=0;i<s.length;i++){const o=s[i],a=o[r[e]];n.has(a)&&t.onDuplicate(o,a,t),n.add(a)}}}t&&Ts(e._filteredValues,o,r,i,!0),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[Ss][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,n){this.getIndices(t).forEach((t=>function(e,t,n){!1!==t.unique?t.delete(n):t.has(n)&&(t.get(n).delete(e),t.get(n).size||t.delete(n))}(e,t,n)))}addIndexEntry(e,t,n){this.getIndices(t).forEach((t=>Rs(e,t,n)))}onItemMutation(e,t){const n=this;!n._indicesInvalid&&Object.keys(n.indices).length>1&&Object.keys(t).forEach((r=>{if(n.indices[r]){const{value:i,oldValue:s}=t[r];n.removeIndexEntry(e,r,s),n.addIndexEntry(e,r,i)}if(n.hasCompositeIndex){const s=Object.values(n.indices).find((e=>{var t;return null===(t=e.dependentOn)||void 0===t?void 0:t[r]}));if(s){const r={};for(const n in s.dependentOn){var i;r[n]=(null===(i=t[n])||void 0===i?void 0:i.oldValue)||e[n]}const o=e.buildIndexKey(r);n.removeIndexEntry(e,s.property,o),n.addIndexEntry(e,s.property,e[s.property])}}}))}}Ms._$name="Collection";const ks=new WeakMap,Is=e=>{if(e&&"object"==typeof e){let t=ks.get(e);t===i&&(t=Symbol("bscik"),ks.set(e,t)),e=t}return e};class As{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[Is(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:n,idMap:r,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=xs[typeof s]?s:Is(s[i]),l=r[a];null==l?(r[a]=s,n.add(s),t.generation++):l!==s&&(r[a]=s,n.delete(l),n.add(s))}}at(e){let t,n;for(t of(e<0&&(e+=this.count),this.items))if(!e--){n=t;break}return n}remove(e){e=H.asArray(e);const{items:t,idMap:n,idProperty:r}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=xs[typeof i]?i:Is(i[r]),a=n[o];null!=a&&(t.delete(a),delete n[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t,n=0;for(t of this.items)e(t)&&++n;return n}changeId(e,t){const n=this,{idMap:r,idProperty:i}=n,s=xs[typeof e]?e:Is(e[i]),o=n.get(s);if(o){const e=n.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete r[s],r[t]=o}}filter(e,t){const{items:n}=this,r=[];let i=0;return n.forEach((s=>{e.call(t,s,i++,n)&&r.push(s)})),r}includes(e){const t=xs[typeof e]?e:Is(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:n}=this,r=new Array(n.size);let i=0;return n.forEach((s=>{r[i]=e.call(t,s,i++,n)})),r}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let n,r;for(n of(t<0&&(t+=this.countOf(e)),this.items))if(e(n)&&!t--){r=n;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let n,r=-1;for(n of this.items)if((!t||t(n))&&(++r,n===e))return r;return-1}get values(){return[...this.items]}set values(e){e=H.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}As._$name="Bag";class Fs extends As{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}}Fs._$name="StoreBag";var Ps=e=>class extends(e||ye){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(e,t=!1){const n=this,{storage:r}=n;if(0===(e=H.asArray(e).reduce(((e,t)=>((t=n.getById(t))&&e.push(t),e)),[])).length)return e;if(!n.tree&&!t&&!1===n.trigger("beforeRemove",{records:e}))return[];if(n.isRemoving=!0,n.isGrouped){const t=r.count,i=[],s=new Set;for(const t of e){const e=t.groupParent.get(n.id);e.meta.collapsed&&i.push(t),H.remove(e.groupChildren,t),H.remove(e.unfilteredGroupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)e.groupChildren.length>0&&n.onModelChange(e,{},{});i.length&&r.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}else if(n.tree){const s=[],o=e.length>1,a=e[0],l=o?i:r.indexOf(a),c=e.reduce(((e,t)=>{const{parent:n}=t;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e}),{}),d=Array.from(Object.values(c));if(!t&&!1===n.trigger("beforeRemove",{records:e,isMove:!1,parent:o?i:a.parent}))return n.isRemoving=!1,[];n.suspendAutoCommit(),d.sort(((e,t)=>t[0].childLevel-e[0].childLevel));for(const[e,t]of d)s.push(...e.removeChild(t,!1,!0));return t||(n.trigger("remove",{parent:o?i:a.parent,index:l,isChild:!0,allRecords:s,isMove:!1,records:e}),n.trigger("change",{action:"remove",records:e})),n.resumeAutoCommit(),n.isRemoving=!1,e}if(0===e.length)return n.isRemoving=!1,e;for(const t of e)t.beforeRemove(e);return t&&n.suspendEvents(),r.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,e}clear(e=!1){var t,n;const r=this,{storage:i}=r;if(r.storage.totalCount||null!==(t=r.rootNode)&&void 0!==t&&null!==(n=t.unfilteredChildren)&&void 0!==n&&n.length){if(!e&&!1===r.trigger("beforeRemove",{records:i.allValues,removingAll:!0}))return null;if(r.rootNode)r.isChained||r.rootNode.clearChildren(e);else if(e){const e=r.registeredRecords;for(let t,n=e.length-1;n>=0;n--)t=e[n],t&&!t.isDestroyed&&t.unjoinStore(r)}e&&(r.removed.clear(),i.suspendEvents()),i.clear(),e&&i.resumeEvents(),r.added.clear(),r.modified.clear()}}removeAll(e=!1){const t=this,n=t.storage;let r;if(t.isRemoving=!0,e){n.suspendEvents();const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)n=e[r],!n||n.isDestroyed||n.isRoot||n.unjoinStore(t)}return r=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&n.resumeEvents(),t.isRemoving=!1,r}add(e,t=!1,n={}){var r;const i=this,{storage:s}=i;if(null===(r=e=H.asArray(e))||void 0===r||!r.length)return;if(i.tree=i.tree||Boolean(i.autoTree&&e[0].children),i.tree){const r=new Map,s=i.modelClass.getFieldDataSource("parentIndex"),{parentIdField:o}=i.modelClass,a=[];return e.forEach((e=>{const t=e[o];r.has(t)||r.set(t,{append:[],insert:[]});const n=r.get(t);!e.isModel&&s in e?n.insert.push(e):n.append.push(e)})),r.forEach((({append:e,insert:r},o)=>{const l=null==o?i.rootNode:i.getById(o);if(!l)throw new Error(`Parent node with id ${o} not found, cannot add children.`);if(e.length&&a.push(...l.appendChild(e,t,n)),r.length)for(const e of r)a.push(l.insertChild(e,e[s],t,n))})),i.isFiltered&&i.reapplyFilterOnAdd&&i.filter({silent:!0}),i.reapplySortersOnAdd&&!i.isSyncingDataOnLoad&&i.sort(),a}if(!t&&!1===i.trigger("beforeAdd",{records:e}))return null;if(i.tree=i.tree||Boolean(i.autoTree&&e[0].children),i.tree)return i.rootNode.appendChild(e);const o=i.processRecords(e);return t&&i.suspendEvents(),i.addingClean=n.clean,s.add(o),i.addingClean=!1,t&&i.resumeEvents(),i.autoCommit&&i.doAutoCommit(),o}processRecords(e,t){return e.map((e=>{const n=this.processRecord(e.isModel?e:this.createRecord(e));return null==t||t.call(this,n),n}))}insert(e,t,n=!1){const r=this,i=r.storage,s=r.getAt(e),o=i.values,a=[];if(t=H.asArray(t),r.tree){var l;const i=r.rootNode;return i.insertChild(t,null===(l=i.children)||void 0===l?void 0:l[e],n)}if(!n&&!1===r.trigger("beforeAdd",{records:t}))return null;let c,d,u;if(o[d=e]===t[0]||o[d=e-1]===t[0])for(c=!0,u=0;c&&u<t.length;u++)t[u]!==o[d+u]&&(c=!1);if(c)return null;const h=r.processRecords(t,(t=>{const n=i.indexOf(t);t.children&&t.children.length&&r.autoTree&&(r.tree=!0),n>-1&&(n<e&&s&&e--,a.push(n)),t.meta.previousIndex=n}));return r.suspendEvents(),r.storage.remove(a),r.resumeEvents(),n&&r.suspendEvents(),i.splice(e,0,...h),n&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),h}move(e,t){this.isTree?t.parent.insertChild(e,t):this.storage.move(e,t)}setMultiple(e,t,n){const r=this,i=[],s=[];r.forEach((r=>{e(r)&&(s.push(r.set(t,n,!0)),i.push(r))})),r.trigger("updateMultiple",{records:i,all:r.records.length===i.length}),r.trigger("change",{action:"updatemultiple",records:i,all:r.records.length===i.length}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}setAll(e,t){const n=this,r=[];n.forEach((n=>{r.push(n.set(e,t,!0))})),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}acceptChanges(){const e=this;e.added.forEach((e=>e.clearChanges(!0,!1))),e.modified.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}revertChanges(){const e=this,{changes:t}=e;if(t){const n={action:"clearchanges",changes:t};e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((e=>e.revertChanges(!0))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",n),e.trigger("refresh",n)}}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},Os=e=>class extends(e||ye){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(e){const t=this,{changes:n}=e;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map((e=>e.id))),n.modified&&n.modified.forEach((e=>{const n=t.getById(e.id);null==n||n.set(e.modifications)})))}applyChangeset(e,t=null,n="$PhantomId",r=!0,i=!1){const s=this,{added:o,updated:a,modified:l,removed:c}=(null==t?void 0:t(e,s))??e,d=a??l??[],u=s.modelClass.getFieldDataSource("id"),h=s.modelClass.getFieldDataSource("parentId"),g=i?new Map:null,m=[],p=[];let f=!1,v=[];if(s.trigger("startApplyChangeset"),s._groupVisibleRecordIds=[],s.isGrouped&&s.forEach((e=>{s._groupVisibleRecordIds.push(e.id)})),(null==o?void 0:o.length)>0){const e=[],t=[];for(const r of o)s.getById(r[n])||s.getById(Xt.getPath(r,u))?e.push(r):t.push(r);d.unshift.apply(d,e);const r=s.reapplySortersOnAdd;s.reapplySortersOnAdd=!1;const i=s.add(t,!1,{orderedParentIndex:{skip:!0}})??[];if(m.push(...i),s.reapplySortersOnAdd=r,s.tree)for(const e of i){const{parent:t}=e;if(t.isRoot){f=!0,v=[t];break}!t.isRoot&&v.every((e=>!e.contains(t)))&&v.push(t)}for(const e of i)null==g||g.set(e.id,e.data),e.clearChanges()}if((null==d?void 0:d.length)>0)for(const e of d){const t=e[n],i=Xt.getPath(e,u),o=Xt.getPath(e,h),a=s.getById(t)??s.getById(i);if(a){var y;const t=null!=o&&(null===(y=s.getById(o))||void 0===y?void 0:y.isLeaf),l=a.applyChangeset(e,n,r);t&&s.toggleCollapse(a.parent,!1),s.tree&&!f&&v.every((e=>!e.contains(a)))&&(a.parent.isRoot?(f=!0,v=[a.parent]):v.push(a.parent)),null==g||g.set(i,l),p.push(a)}}if((null==c?void 0:c.length)>0&&s.applyRemovals(c),"changes"===s.applyChangesetFilterSortTarget){const e=s.filterChangeset(m,p);v.push(...e)}if(s.afterChangesetApplied(v),s.tree&&s.isSorted&&s.reapplySortersOnAdd&&(null!=o&&o.length||null!=d&&d.length)){const e=new Set;v.forEach((t=>{e.has(t)||(e.add(t),t.sortVisibleChildren(!1,s.sorterFn),t.sortUnfilteredChildren(!1,s.sorterFn))})),s.storage.replaceValues({values:s.collectDescendants(s.rootNode).visible,silent:!0}),s.afterPerformSort(!1)}return s._groupVisibleRecordIds=null,s.trigger("endApplyChangeset"),g}afterChangesetApplied(e){const t=new Set;e.forEach((e=>{t.has(e)||e.traverse((e=>{t.has(e)||(t.add(e),e.sortOrderedChildren(!1,!1),e.children&&e.updateChildrenIndices(e.children,"parentIndex",!0),e.unfilteredChildren&&e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0))}))}))}applyRemovals(e){const t=this,{removed:n}=t,r=t.modelClass.idField,i=[];for(const t of e){const e=Xt.getPath(t,r);if(n.includes(e)){const t=n.get(e);t.clearChanges(!1,!0,null),t.$isPhantom=!0,n.remove(e)}else i.push(e)}t.remove(i);for(const e of i)n.remove(e)}filterChangeset(e,t){const n=this,{isFiltered:r,tree:s,isGrouped:o,filtersFunction:a}=n,l=n.isSorted?n.createSorterFn(n.sorters):i,{allValues:c,addedValues:d,isSorted:u}=n.storage,h=null!=l||u?l??n.storage.sortFunction:null,g=new Set;if(!r)return[];let m,p=!1;if(o&&(m=n.groupers,n.clearGroupers(!0)),s){const r=new Set(t.filter(a));for(const t of e.filter(a))r.add(t);r.forEach((e=>e.bubble((e=>r.add(e))))),r.delete(n.rootNode);const i=H.groupBy(Array.from(r).filter((e=>{var t,n;return!(null!==(t=e.parent)&&void 0!==t&&null!==(n=t.children)&&void 0!==n&&n.includes(e))})),"parentId");for(const e of Object.values(i)){const{parent:t}=e[0];t.unfilteredChildren&&(t.children.push(...e),g.add(t))}}else if(h&&!o){const{filteredValues:e}=n.storage,r=d?e.findLastIndex((e=>!d.has(e)))+1:e.length,i=e.slice(0,r),s=new Set(t.filter(a));for(const t of e)s.has(t)&&s.delete(t);for(const e of s)i.push(e);i.sort(h),e.splice(0,r,...i),p=!0}else{const e=t.filter((e=>a(e)&&!n.storage.includes(e)));e.length>0&&(n.includeInSubset(c,n.storage.filteredValues,e),p=!0)}const f=new Set(e.filter((e=>!a(e))));if(f.size>0){if(s)for(const e of f)H.remove(e.parent.children,e),g.add(e.parent);else H.remove(n.storage.filteredValues,f);p=!0}return m&&(n.group(m[0],null,!1,!0,!0),p=!0),s&&g.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):p&&(n._idMap=null,n.trigger("refresh")),[...g]}includeInSubset(e,t,n){const r=new Set(n);let i=0,s=0,o=0===r.size;for(;s<e.length&&!o;){const n=t[i];let a=e[s];for(;n!==a;)r.has(a)&&(t.splice(i,0,a),i++,r.delete(a),o=0===r.size),a=e[++s];r.has(n)&&r.delete(n),i<t.length&&i++}return t}},Ls=e=>class extends(e||ye){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?n.add(new ps({filterBy:t[1]})):n.add(new ps("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?n.add(...e.map((e=>e instanceof ps?e:new ps(e)))):e.isCollection?n.add(...e.values):n.add(new ps({filterBy:e}));n.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new Ms({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:n}=e;if(!e._filtersFunction)if(t.count){const r=ps.generateFiltersFunction(t);e._filtersFunction=e=>n&&e.isSpecialRow?e.groupChildren.some(r):r(e)}else e._filtersFunction=Me.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some((e=>!e.disabled))}traverseFilter(e){const t=this,n=!e.isRoot&&t.filtersFunction(e),r=e.unfilteredChildren||e.children;return r&&r.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t.traverseFilter(e))),t.isSorted&&e.children.sort(t.sorterFn),e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0),e.updateChildrenIndices(e.children,"parentIndex",!0),n||Boolean(e.children.length)):n}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.orderedChildren.slice(),e.unfilteredChildren=null),e.children&&(t.isSorted&&e.children.sort(t.sorterFn),e.children.forEach((e=>t.traverseClearFilter(e))),e.updateChildrenIndices(e.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){const n=this;if((e=e instanceof ps?e:new ps(e)).owner=n,n.filters.add(e),!t){if(n.remoteFilter)return n.filter().then((()=>e));n.filter()}return e}filter(e){const t=this;let n,r=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e||e.filters)&&(r=e.silent,e.replace&&t.clearFilters(0===e.filters.length),n=e.internal,i=typeof(e=e.filters)),e){const r=t.isFiltered;if(t.isConfiguring=!0,Array.isArray(e))e.forEach((e=>t.addFilter(e,!0)),t);else if("function"===i){const r=new ps(e);r.internal=n,t.addFilter(r,!0)}else"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0);if(t.isConfiguring=!1,!t.isFiltered&&!r)return null}}t.filtersFunction=null;const i=t.performFilter(r);return t._idMap=null,i}performFilter(e){const t=this,{storage:n,filters:r,rootNode:i}=t,s=t.count;let o,a;if(t.trigger("beforeFilter",{filters:r}),t.tree){const e=n.values;t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i);const r=t.collectDescendants(i).visible;n.replaceValues({values:r,silent:!0});const s=H.delta(r,e,!0);o=s.toAdd,a=s.toRemove}else n.ion({change({removed:e,added:t}){a=e,o=t},once:!0}),t.isFiltered?(t.isGrouped&&t.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:t.filtersFunction}),t.isGrouped&&t.excludeCollapsed()):n.filters.clear();t.afterPerformFilter(e||t.isRemoteDataLoading?null:{action:"filter",filters:r,oldCount:s,added:o,removed:a,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){return this.filter(e)}removeFilter(e,t=!1){const n=this,r=e instanceof ps?e:n.filters.get(e);if(r){if(n.filters.remove(r),n._filtersFunction=null,!t){if(n.remoteFilter)return n.filter().then((()=>r));n.filter()}return r}}clearFilters(e=!0){if(this.filters.remove(this.filters.values.filter((e=>!e.internal))),e)return this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}doDestroy(){var e;null===(e=this._filters)||void 0===e||e.destroy(),super.doDestroy()}};const $s={add:1,replace:1},_s=({_groupValue:e},{_groupValue:t})=>e<t?-1:e>t?1:0;var js=e=>class extends(e||ye){static $name="StoreGroup";static configurable={groupers:null,useGroupFooters:!1,startGroupsCollapsed:null};static get properties(){return{collapsedGroups:new Set}}construct(e){super.construct(e),this.ion({change:"onDataChanged",thisObj:this})}get GroupRow(){return this._GroupRowClass||(this._GroupRowClass=class extends this.modelClass{static isSpecialRow=!0;static fields=[{name:"_groupValue"}];get isCollapsed(){return this.meta.collapsed}})}updateGroupers(e){this.setGroupers(e)}setGroupers(e,t=null){const n=this,{storage:r}=n;let i;return null!=e&&e.length?n._groupers=e:n.groupers&&(delete n._groupers,n.includeCollapsed(),r.replaceValues({values:n.removeHeadersAndFooters(r._values),filteredValues:r.isFiltered?n.removeHeadersAndFooters(r._filteredValues):null,silent:!0}),i=n.group(null,null,null,!1,null==t?void 0:t.silent)),n._idMap=null,i}get unfilteredGroupRecords(){const e=this;if(e.isGrouped){var t;const{generation:n}=e.storage;(null===(t=e._unfilteredGroupRecords)||void 0===t?void 0:t.generation)!==n&&(e._unfilteredGroupRecords=e.storage.allValues.filter((e=>e.isSpecialRow)),e._unfilteredGroupRecords.generation=n)}return e._unfilteredGroupRecords||[]}getGroupHeaderForRecord(e,t=!1){if(this.isGrouped)return e?e.meta.groupRowFor?e:e.groupParent.get(this.id):this.groupRecords.last}includeCollapsed(){for(const e of this.collapsedGroups)this.expand(this.getById(e),!1)}excludeCollapsed(){for(const e of this.collapsedGroups)this.collapse(this.getById(e))}onDataChange({source:e,action:t,removed:n}){var r;const i=this,{groupers:s}=i;s&&(s.length?("splice"===t&&null!=n&&n.length||"move"===t)&&e.replaceValues({...i.prepareGroupRecords(),silent:!0}):e.replaceValues({values:i.removeHeadersAndFooters(e._values),filteredValues:e.isFiltered?i.removeHeadersAndFooters(e._filteredValues):null,silent:!0})),null===(r=super.onDataChange)||void 0===r||r.call(this,...arguments)}move(e,t){const n=this;if(n.isGrouped&&!n.tree){var r,i;let s=t;if(null!==(r=t)&&void 0!==r&&r.isSpecialRow&&(s=n.getPrev(t,!1,!1),!s))return;const o=n.getGroupHeaderForRecord(s),a=n.groupers[0].field,l=o.meta.groupRowFor,{reapplyFilterOnUpdate:c}=n;if(n.reapplyFilterOnUpdate=!1,n.beginBatch(),e.forEach((e=>e.setValue(a,l))),n.endBatch(),n.reapplyFilterOnUpdate=c,n.isFiltered&&null!==(i=t)&&void 0!==i&&i.isSpecialRow){const{unfilteredGroupRecords:e}=n,r=e.indexOf(o);t=e[r+1]}}super.move(e,t)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,this.collapsedGroups.add(e.id),this.trigger("toggleGroup",{groupRecord:e,collapse:!0}),!0)}expand(e,t=!0){return!(null==e||!e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,t&&this.collapsedGroups.delete(e.id),t&&this.trigger("toggleGroup",{groupRecord:e,collapse:!1}),!0)}removeHeadersAndFooters(e){return e.filter((e=>{var t;return e.unfilteredGroupChildren&&(e.groupChildren.length=e.unfilteredGroupChildren.length=e.meta.childCount=0),!(e.isSpecialRow||e.isLinked&&null!==(t=e.groupParent)&&void 0!==t&&t.get(this.id))||(this.unregister(e),!1)}))}prepareGroupRecords(){var e;const t=this,{GroupRow:n,isFiltered:r,reapplyFilterOnUpdate:s,groupRecords:o}=t,a=t.groupers[0],l=!1!==a.ascending?1:-1,{field:c,fn:d=_s}=a,u="function"==typeof c,h=c===t.modelClass.idField,g=new Ms,m=t._groupVisibleRecordIds||[],p=e=>{const n=!r||t.filtersFunction(e);return s?n:n||m.includes(e.id)},f=Boolean(t.startGroupsCollapsed&&!(null!=o&&o.count));null==o||o.forEach((e=>{e.isCollapsed&&t.includeGroupRecords(e)}));const v=t.removeHeadersAndFooters(t.storage._values);if(t.sorters.length&&v.sort(t.sorterFn),r&&(t.filtersFunction=null),v.forEach((e=>{const r=e,s=u?c(e):e[c],a=H.asArray(s==i?"__novalue__":s),l=Array.isArray(a)&&!a.length,d=l?1:a.length;for(let i=0;i<d;i++){const s=l?[]:a[i],d=`group-header-${"number"==typeof s?s:$.createId(s)}`;let u=g.get(d);if(u||(u=(null==o?void 0:o.get(d))||new n({[t.modelClass.idField]:d,[h?"":c]:s,_groupValue:s},t,{collapsed:f,specialRow:!0,groupRowFor:s,groupField:c,emptyArray:l}),g.add(u),u.meta.childCount=0,u.groupChildren=[],u.unfilteredGroupChildren=[],u.stores=[t]),t.register(u),i>0){const n=r.groupLinks||(r.groupLinks=[]);(e=n[s]||(n[s]=r.link())).stores=[t],t.register(e)}e.groupParent||e.setData("groupParent",new Map),e.groupParent.set(t.id,u),p(e)&&(u.groupChildren.push(e),u.meta.childCount++),u.unfilteredGroupChildren.push(e)}})),g._values.sort(((e,t)=>d(e,t)*l)),t.useGroupFooters)for(let e=0,r=g.count;e<r;e++){const i=g.values[e],s=i.meta.groupRowFor,o=`group-footer-${"number"==typeof s?s:$.createId(s)}`,a=t.getById(o)||new n({[t.modelClass.idField]:o,[h?"":c]:s,_groupValue:s},t,{specialRow:!0,groupFooterFor:s,groupRecord:i});a.stores=[t],t.register(a),a.groupChildren=i.groupChildren,g.splice(++e,0,a),r++,i.groupChildren.push(a),i.unfilteredGroupChildren.push(a),i.meta.childCount++}t._idMap=null;const y={values:g.reduce(((e,t)=>(t.isGroupFooter||(e.push(t),t.meta.collapsed||e.push(...t.unfilteredGroupChildren)),e)),!1,[])};return r&&(y.filteredValues=y.values.filter(p)),null===(e=t.groupRecords)||void 0===e||e.forEach((e=>{g.includes(e)||e.destroy()})),t.groupRecords=g,y}get isGrouped(){var e;return Boolean(null===(e=this.groupers)||void 0===e?void 0:e.length)}group(e,t,n=!1,r=!0,i=!1){const s=this;let o,a;if(e&&"object"==typeof e&&(t=e.ascending,a=e.fn,e=e.field),n)s.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")});else if(e){var l,c;if(null==t)t=(null===(l=s.groupInfo)||void 0===l?void 0:l.field)!==e||(null===(c=s.groupInfo)||void 0===c?void 0:c.fn)!==a||!s.groupInfo.ascending;s.groupInfo=o={field:e,ascending:t,fn:a,complexMapping:e.includes(".")},s.groupers=[s.groupInfo]}if(o){const{prototype:t}=s.modelClass;o.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return Xt.getPath(this,e)}})}if(!1!==r){if(s.remoteSort&&!s.isRemoteDataLoading)return s.sort(null,null,!1,!0).then((()=>s.onAfterGrouping(i)));s.sort(null,null,!1,!0)}s.onAfterGrouping(i)}onAfterGrouping(e){if(e)return;const t=this,n=t.groupers||[];t.trigger("group",{isGrouped:t.isGrouped,groupers:n,records:t.storage.values}),t.trigger("refresh",{action:"group",isGrouped:t.isGrouped,groupers:n,records:t.storage.values})}addGrouper(e,t=!0){return this.group(e,t,!0)}removeGrouper(e){const t=this,{groupers:n}=t;if(!n)return;const r=n.findIndex((t=>t.field===e));return r>-1?(n.splice(r,1),n.length?t.group():t.clearGroupers()):void 0}clearGroupers(e=!1){return this.setGroupers(null,{silent:e})}isRecordInGroup(e,t){var n;if(!this.isGrouped)return null;const r=null===(n=this.groupers[0])||void 0===n?void 0:n.field;return e.getValue(r)===t&&!e.isSpecialRow}isInCollapsedGroup(e){const t=e.groupParent.get(this.id);return null==t?void 0:t.meta.collapsed}getGroupRecords(e){return this.isGrouped?this.storage.values.filter((t=>this.isRecordInGroup(t,e))):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&$s[t]||e&&this.groupers.some((t=>t.field in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const n=this,r=n.indexOf(e),i=n.allIndexOf(e),{id:s,storage:o}=n,{_filteredValues:a,_values:l}=o,{meta:c,groupChildren:d,unfilteredGroupChildren:u}=e;-1===i||c.collapsed&&!t||!c.collapsed&&t||(u.forEach((e=>e.instanceMeta(s).hiddenByCollapse=!t)),t?(a&&a.splice(r+1,0,...d.filter((e=>!n.isAvailable(e)))),o._values.splice(i+1,0,...u.filter((e=>!n.isAvailable(e))))):(a&&a.splice(r+1,d.length),l.splice(i+1,u.length)),o._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((e,n)=>(n.isSpecialRow&&(t&&!n.isGroupFooter&&e.push(n),n.isGroupHeader&&e.push.apply(e,n.groupChildren)),e)),[])}},Bs=e=>class extends(e||ye){static get configurable(){return{objectify:null}}initProxy(){if(!r.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];if("$store"===t)return e;let n=e.getById(t);return n||isNaN(parseInt(t))||(n=e.getAt(parseInt(t))),n},set:(e,t,n)=>(t in e||e.isDestroying||"_triggered"===t?e[t]=n:e.add({[e.modelClass.idField]:t,...n}),!0),deleteProperty:(e,t)=>e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length),has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=$.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},Vs=e=>class extends(e||ye){static $name="StoreRelation";initRelations(e){const t=this,n=t.modelClass.exposedRelations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{var t;return null===(t=e.storeDetacher)||void 0===t?void 0:t.call(e)})),t.modelRelations&&0!==t.modelRelations.length&&!e||!n||(t.modelRelations=[],null==n||n.forEach((n=>{const r={...n},{foreignStore:i,relationName:s,relatedCollectionName:o}=r,a="string"==typeof i?t[i]:i;if(r.dependentStore=t,t.modelRelations.push(r),a){r.foreignStoreProperty=r.foreignStore,r.foreignStore=a;const n=a.dependentStoreConfigs;if(n.has(t)){const i=n.get(t);if(e){const e=i.find((e=>e.relationName===s));e&&H.remove(i,e)}i.push(r)}else n.set(t,[r]);o&&a.initRelationCollection(r,t),a.count>0&&a.updateDependentStores("dataset",a.records)}})))}initRelationCollection(e,t){const n=this,r=e.relatedCollectionName;(n.collectionStores||(n.collectionStores={}))[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.count>0&&n.initModelRelationCollection(r,n.allRecords)}initModelRelationCollection(e,t){const n=this;t.forEach((t=>{t.traverse((t=>{const r=e in t?`$related${$.capitalize(e)}`:e;Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){null==t||t.forEach((t=>{const{config:n}=t,r=t.related?t.related.id:e.getValue(n.foreignKey);r!==i&&this.cacheRelatedRecord(e,r,n.relationName,r)}))}getRelationCollection(e,t){var n;const r=ds.asId(t);return(null===(n=this.relationCache[e])||void 0===n?void 0:n[r])||[]}getCollection(e,t){var n;const{config:r,store:i}=this.collectionStores[t];return(null===(n=i.relationCache[r.relationName])||void 0===n?void 0:n[e.id])||[]}setCollection(e,t,n){const{config:r,store:i}=this.collectionStores[t],s=((i.relationCache[r.relationName]||(i.relationCache[r.relationName]={}))[e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach((e=>{n.includes(e)||(e[r.foreignKey]=null,i.remove(e),a.push(e))})),n.forEach((t=>{t.isModel instanceof ds?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[r.foreignKey]=e.id})),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,n,r=null){const i=this,s=i.relationCache[n]||(i.relationCache[n]={});null!==r&&i.uncacheRelatedRecord(e,n,r),null!=t&&H.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,n=null){const r=this;function i(t,n){const i=r.relationCache[t],s=null==i?void 0:i[n];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[n]}}null!=n?i(t,n):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>i(e,null==t?void 0:t.id)))}updateDependentStores(e,t){this.dependentStoreConfigs.forEach((n=>{n.forEach((n=>{const{dependentStore:r,relatedCollectionName:i,relationName:s,foreignKey:o}=n,a=r.relationCache[s];return"dataset"===e?(i&&this.initModelRelationCollection(i,t),void r.forEach((e=>{const t=e.initRelation(n);t&&r.cacheRelatedRecord(e,t.id,s,t.id)}))):"removeall"===e?(r.forEach((e=>e.removeRelation(n))),void delete r.relationCache[s]):("replace"===e&&(t=t.map((e=>e[1]))),"add"!==e&&"replace"!==e||i&&this.initModelRelationCollection(i,t),void("add"!==e&&"replace"!==e&&"remove"!==e||t.forEach((t=>{const i=null==a?void 0:a[t.id];switch(e){case"remove":i&&i.forEach((e=>e.removeRelation(n)));break;case"add":case"replace":r.forEach((e=>{e.getValue(o)==t.id&&(e.initRelation(n),r.cacheRelatedRecord(e,t.id,s))}))}}))))}))}))}updateDependentRecordIds(e,t){var n;null===(n=this.dependentStoreConfigs)||void 0===n||n.forEach((n=>{n.forEach((n=>{var r;const{dependentStore:i,relationName:s,foreignKey:o}=n,a=i.relationCache[s],l=null==a||null===(r=a[e])||void 0===r?void 0:r.slice();null==l||l.forEach((n=>{i.cacheRelatedRecord(n,t,s,e),n.set(o,t,!1,!0)}))}))}))}},Hs=e=>class extends(e||ye){static get $name(){return"StoreSum"}sum(e,t=this.storage.values){return t?t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const r=Number(n.getValue(e));return isNaN(r)?t:t+r}),0):0}min(e,t=this.storage.values){return null!=t&&t.length?t.reduce(((t,n)=>{const r=n.getValue(e);return"number"===typeof(null==r?void 0:r.valueOf())&&r<t&&(t=r),t}),t[0].getValue(e)):0}max(e,t=this.storage.values){return null!=t&&t.length?t.reduce(((t,n)=>{const r=n.getValue(e);return"number"===typeof(null==r?void 0:r.valueOf())&&r>t&&(t=r),t}),t[0].getValue(e)):0}average(e,t=this.storage.values){if(null==t||!t.length)return 0;let n=0;const r=t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const i=parseFloat(r.getValue(e));return isNaN(i)?t:(n++,t+i)}),0);return n>0?r/n:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const Ns=(e,t)=>String(e).toLowerCase().includes(t),zs={string:Ns,number:Ns,boolean:Ns,date:(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:String(e.getMonth()+1).includes(t)||String(e.getDate()).includes(t)||String(e.getFullYear()).includes(t),object:(e,t)=>e===t,undefined:(e,t)=>e===t};var Ws=e=>class extends(e||ye){static get $name(){return"StoreSearch"}search(e,t=null,n,r){const i=this.isTree&&!r?this.rootNode.allChildren:this.getAllDataRecords(r),s=i.length,o=[];if(null==e)return[];let a,l,c,d,u,h;for("string"==typeof e&&(e=e.toLowerCase()),a=0;a<s;a++){c=i[a],l=0;for(const r of t||c.fieldNames){var g;d=c.getValue(r),u=d instanceof Date?"date":typeof d;const t=null==n?void 0:n[l];t&&(d=t(d),u="string"),h=zs[u],d&&null!==(g=h)&&void 0!==g&&g(d,e)&&o.push({index:a,data:c,field:r,id:c.id}),l++}}return o}findByField(e,t,n=!1,r=!1){const i=this.getAllDataRecords(r),s=i.length,o=new Set,a=[];let l,c,d;for(null!=t&&(t=String(t).toLowerCase()),l=0;l<s;l++)if(c=i[l],d=c.getValue(e),!n||!o.has(d)){const e=d instanceof Date?"date":typeof d;(null==t&&d===t||""===t&&""===d||t&&(0,zs[e])(d,t))&&(a.push({id:c.id,index:l,data:c}),n&&o.add(d))}return a}find(e,t=!1){return this.getAllDataRecords(t).find(e)}findRecord(e,t,n=!1){const r=n=>Xt.isEqual(n[e],t);return this.isTree?this.query(r,n)[0]:this.getAllDataRecords(n).find(r)}query(e,t=!1){if(this.isTree){const n=[];return this.traverse((t=>{e(t)&&n.push(t)}),i,i,t),n}return this.getAllDataRecords(t).filter(e)}some(e,t=!1){return this.getAllDataRecords(t).some(e)}},Us=e=>class extends(e||ye){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}changeSorters(e){return e.map((e=>this.normalizeSorterConfig(e,!0)))}updateReapplySortersOnAdd(e){this.storage.autoSort=e}sort(e,t,n=!1,r=!1){const i=this,s=i.allRecords,o=i.sorters?i.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const r=i.normalizeSorterConfig(e,t);n?(a=i.getCurrentSorterByField(r.field),a?(l=a.ascending,a.ascending=r.ascending):i.sorters.push(r)):i.sorters=[r]}return r||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:o})?i.performSort(r):(i.sorters=o,null!==l&&(a.ascending=l),null)}normalizeSorterConfig(e,t){const n=this,r={ascending:t};if("object"==typeof e?(Xt.assign(r,e),e.fn&&(delete r.fn,r.sortFn=e.fn),r.ascending=e.ascending??t):"function"==typeof e?r.sortFn=e:r.field=e,null==r.ascending){const e=n.getCurrentSorterByField(r.field);r.ascending=!e||!e.ascending}if(null==r.sortFn){var i,s;const e=null===(i=n.modelClass)||void 0===i||null===(s=i.$meta.fields.map[r.field])||void 0===s?void 0:s.compareItems;e&&(r.sortFn=e)}return r}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){return this.sort(e,t,!0)}removeSorter(e){const t=this.sorters.findIndex((t=>t.field===e||t.sortFn===e));if(t>-1)return this.sorters.splice(t,1),this.sort()}clearSorters(e=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(i,i,i,e)}createSorterFn(e){const t=this.useLocaleSort;return(n,r)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:o,ascending:a=!0,useLocaleSort:l=t}=s,c=s.fn||s.sortFn,d=a?1:-1;if(c){const e=c.call(s,n,r);if(0===e)continue;if(null!==e)return e*d}const u=n.isModel?n.getValue(o):n[o],h=r.isModel?r.getValue(o):r[o];if(u!==h){if(null==u)return-d;if(null==h)return d;if(l&&"string"==typeof u){if(!0===l)return String(u).localeCompare(h)*d;if("string"==typeof l)return String(u).localeCompare(h,l)*d;if("object"==typeof l)return String(u).localeCompare(h,l.locale,l)*d}if(u>h)return d;if(u<h)return-d}}return 0}}get sorterFn(){return this.createSorterFn(this.remoteSort?[{field:"_remoteSortIndex"}]:this.sorters)}performSort(e){const t=this,{rootNode:n,storage:r,sorterFn:i}=t;t.tree?(!t.isChained&&n.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(i),e.updateChildrenIndices(e.children,"parentIndex",!0))})),r.replaceValues({values:t.collectDescendants(n).visible,silent:!0})):t.isGrouped?r.replaceValues({...t.prepareGroupRecords(),silent:!0}):r.replaceValues({values:r.values.sort(i),silent:!0}),t.afterPerformSort(e||t.isRemoteDataLoading)}afterPerformSort(e){if(e)return;const t=this;t._idMap=null;const n={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",n),t.trigger("refresh",n)}};const Gs=()=>!0;var Ys=e=>class extends(e||ye){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,chainSuspended:0}}static get properties(){return{chainedStores:null}}construct(e){super.construct(e);const t=this,{masterStore:n}=t,r=t.syncOrder?"sort":"";n&&(t.methodNamesToRelay.forEach((e=>t[e]=(...n)=>t.relayToMaster(e,n))),t.removeAll=(...e)=>{n.remove(t.getRange(),...e)},n.ion({changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,[r]:t.onMasterDataChanged,prio:1,thisObj:t}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(t),t.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||Gs}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:n}=e;let r=[];if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(!e.isChainSuspended){if(t.isGrouped&&t.isFiltered?t.forEach((e=>r.push(e)),t,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):r=t.allRecords.filter((t=>!t.isSpecialRow&&e.chainedFilterFn(t))),n&&(e.idRegister={},e.internalIdRegister={},r.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);r=e.doIncludeExclude(t,!0)}e.isFillingFromMaster=!0,e.data=r,e.isFillingFromMaster=!1}}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,$handled:n,isMove:r}){var i;this.$masterEventhandled?this.$masterEventhandled=!1:r&&"remove"===e||("update"!==e||null!==(i=this.chainedFields)&&void 0!==i&&i.some((e=>e in t)))&&this.fillFromMaster()}makeChained(e=Gs,t,n){if(this.isChained){const t=e;e=e=>t(e)&&this.chainedFilterFn(e)}return new((null==n?void 0:n.storeClass)||this.constructor)({storeId:i,id:`${this.id}-chained-${$.generateUUID()}`,...n||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:e,chainedFields:t})}chain(){return this.makeChained(...arguments)}doDestroy(){var e;null===(e=this.chainedStores)||void 0===e||e.forEach((e=>e.destroy())),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(e=!1){this.chainSuspended&&!--this.chainSuspended&&e&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},qs=e=>class extends(e||ye){static get $name(){return"StoreState"}getState(){const{sorters:e,groupers:t,filters:n}=this,r={};return null!=e&&e.length&&(r.sorters=e.map((e=>{const t=Xt.cleanupProperties(Xt.clone(e));return delete t.fn,delete t.sortFn,t}))),null!=t&&t.length&&(r.groupers=t.map((e=>{const t=Xt.cleanupProperties(Xt.clone(e));return delete t.fn,t}))),null!=n&&n.values.length&&(r.filters=n.values.map((e=>{const t=Xt.cleanupProperties(Xt.clone(e.config));return t.value=e.value,t.caseSensitive&&delete t.caseSensitive,t}))),r}applyState(e){const t=this,{sorters:n=[],groupers:r=[],filters:i=[]}=e,{sortParamName:s,filterParamName:o}=t;t.sorters=n.filter((e=>e.field||e.sortFn&&!s)),t.groupers=r.slice(),t.sort(),t.filters=i.filter((e=>e.property||e.filterBy&&!o)),t.filter()}};const Ks=e=>String(e).padStart(6,"0");class Xs{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e??"")}get value(){return this._value}static from(e){return null==e||e instanceof Xs?e:new Xs(e)}static pad(e){return e instanceof Xs?e.valueOf():Xs.split(e).map(Ks).join(".")}static split(e){let t,n;if(e||0===e)switch(typeof e){case"object":e=String(e);case"string":for(n=e.split("."),t=n.length;t-- >0;)n[t]=parseInt(n[t],10);break;case"number":n=[e]}return n||[]}static compare(e,t){return e===t?0:e&&t?(e=Xs.pad(e))<(t=Xs.pad(t))?-1:t<e?1:0:e?1:t?-1:0}append(e){const t=this.value;return Xs.from(t?`${t}.${e}`:e)}isEqual(e){return!Xs.compare(this,e)}match(e){let t=!1;if(e){const n=this.value,r="*"===e[0],i=e.endsWith("*"),s=e.length;t=r===i?n.indexOf(r?e.substr(1,s-2):e)>-1:r?n.endsWith(e.substr(1)):n.startsWith(e.substr(0,s-1))}return t}toString(){return this.value}toJSON(){return this.toString()}valueOf(){return this._padded??(this._padded=Xs.pad(this.value))}}Xs._$name="Wbs";const Zs=Object.freeze([]),Js=Symbol("StopBranch");var Qs=e=>class extends(e||ye){static $name="StoreTree";static StopBranch=Js;get StopBranch(){return Js}static configurable={transformFlatData:null,fireRemoveEventForMoveAction:_.checkVersion("core","6.0","<")};get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse((e=>{e.isLeaf&&t.push(e)})),t):(e.allRecords.forEach((e=>{e.isLeaf&&t.push(e),e.traverse((e=>{e.isLeaf&&t.push(e)}),!0)})),t)}async loadChildren(e){}onNodeAddChild(e,t,n,r,s=!1){const o=this,a=e===o.rootNode&&e.isLoading,{storage:l}=o,{previousSibling:c}=t[0];let d;const{visible:u,all:h}=o.collectDescendants(t,i,i,{inCollapsedBranch:!(e.isExpanded(o)&&e.ancestorsExpanded(o)),applyFilter:o.isFiltered&&o.reapplyFilterOnAdd});if(!a&&h.length)for(const e of h)o.modified.includes(e)||r[e.id]||(o.removed.includes(e)?o.removed.remove(e):e.isLinked||o.added.add(e));var g;if(a&&o.rootVisible&&(u.unshift(e),h.unshift(e)),u.length?(d=0!==n&&c?l.indexOf(c)+c.getDescendantCount(!0,o):l.indexOf(e),l.suspendEvents(),o.storage.splice(++d,0,u),l.resumeEvents(),o._idMap=null):o._allRecords=null,o.updateDependentStores("add",t),a&&u.length){if(o.sorters.length&&o.sort(null,null,!1,!0),null===(g=o.afterLoadData)||void 0===g||g.call(o),!s){const e={action:"dataset",data:o._data,records:u};o.trigger("refresh",e),o.trigger("change",e)}}else if(!s){const n={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:h,index:d};if(o.trigger("add",n),o.trigger("change",n),Object.values(r).some((e=>e))){const n={newParent:e,records:t.filter((e=>r[e.id])),oldParents:t.map((e=>o.getById(e.meta.oldParentId)))};o.trigger("move",n)}}}onNodeRemoveChild(e,t,n,r={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,o=[],a=[],{isMove:l,silent:c,unfiltered:d}=r,u=d&&i.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(i.collectDescendants(h,o,a,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unjoinStore(i);for(const e of a)e.stores.includes(i)&&e.unjoinStore(i),i.added.includes(e)?i.added.remove(e):e.isLinked||i.removed.add(e);i.modified.remove(a)}if(o.length?(n=s.indexOf(o[0]))>-1&&(s.suspendEvents(),s.splice(n,o.length),s.resumeEvents(),i._idMap=null):(n=-1,i._allRecords=null),!c&&(i.fireRemoveEventForMoveAction||!l)){const r={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:n};i.trigger("remove",r),i.trigger("change",r)}return a}collectDescendants(e,t=[],n=[],r={}){const i=this,{inCollapsedBranch:s=!1,unfiltered:o=!1,applyFilter:a=!1}=r,l=Array.isArray(e)?e:i.getChildren(e,o)??[];if(a)return{visible:l.flatMap((e=>this.collectVisibleNodeDescendantsFiltered(e))),all:l.flatMap((e=>e.allChildren))};for(let e,r=0,a=l.length;r<a;r++)e=l[r],s||t.push(e),n.push(e),i.collectDescendants(e,t,n,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:o});return{visible:t,all:n}}collectVisibleNodeDescendantsFiltered(e){const t=e.unfilteredChildren||e.children;if(!t||0===t.length||!e.isLeaf&&!e.isExpanded(this))return this.filtersFunction(e)?[e]:[];const n=t.flatMap((e=>this.collectVisibleNodeDescendantsFiltered(e)));return n.length||this.filtersFunction(e)?[e,...n]:[]}getChildren(e,t=!1){const n=this,r=(t||n.isChained)&&e.unfilteredChildren||e.children;return null!=r&&r.length?n.isChained?r.filter(n.chainedFilterFn).sort(n.sorterFn):r:Zs}internalToggleTreeSubRecords(e,t){const n=this,{storage:r}=n,i=r.indexOf(e),s=n.doIncludeExclude(n.getChildren(e),t);if(n.isFiltered&&t&&e.unfilteredChildren&&n.updateChildrenHiddenState(e),s.length&&!1!==i){if(r.suspendEvents(),t){r.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};n.trigger("add",e),n.trigger("change",e)}else{r.splice(i+1,s.length);const e={action:"remove",isCollapse:!0,records:s,index:i+1};n.trigger("remove",e),n.trigger("change",e)}r.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(e){var t;null===(t=e.unfilteredChildren)||void 0===t||t.forEach((e=>{e.instanceMeta(this.id).hidden=!1,e.isLeaf||this.updateChildrenHiddenState(e)}))}doIncludeExclude(e,t,n=[]){const r=this,i=(null==e?void 0:e.length)||0;for(let s=0;s<i;s++){const i=e[s];if(!r.isChained||r.chainedFilterFn(i)){const e=i.instanceMeta(r.id);!t&&e.hidden||n.push(i),e.hidden=!t,i.isExpanded(r)&&r.doIncludeExclude(r.getChildren(i),t,n)}}return n}async toggleCollapse(e,t){const n=this,r=n.getById(e),s=r.instanceMeta(n);if(t===i&&(t=!s.collapsed),!s.isLoadingChildren&&!r.isLeaf&&r.isExpanded(n)===t){if(n.trigger("beforeToggleNode",{record:r,collapse:t}),s.collapsed=t,s.collapsed)return n.onNodeCollapse(r),!0;{n.onNodeExpand(r);let e=!0;if(!r.isLoaded){s.isLoadingChildren=!0;try{await n.loadChildren(r)}catch(t){s.collapsed=!0,e=!1,n.trigger("loadChildrenException",{record:r,exception:t})}finally{s.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}transformToTree(e){const{parentIdField:t,idField:n,childrenField:r}=this.modelClass,i=new Map,s=new Set,o=[];for(const t of e){const e=t[n];null!=e&&i.set(e,t)}const a=e=>{const t=Object.assign({},e);return t[r]=[],i.set(t[n],t),s.add(e[n]),t};for(let l of e){const e=l[n];l=s.has(e)?i.get(e):a(l);const c=l[t];if(null!=c){let e=i.get(c);e&&(e[r]||(e=a(e)),e[r].push(l))}else l[r]?o.push(l):null!=l[n]?o.push(a(l)):o.push(l)}return i.forEach((e=>{var t,n;null===(t=(n=e[r]).sort)||void 0===t||t.call(n,((e,t)=>e.parentIndex-t.parentIndex))})),o}treeify(e,t,n=!1){const{length:r}=e,s=[],o=[],a={};let l,c;for(l=0;l<r;l++){let t=e[l];t=t.field||t,e[l].call||(e[l]=e=>e[t],e[l].fieldName=t),s[l]=new Map}this.rootNode.traverse((t=>{if(c=[],t.isLeaf){for(l=0;l<r;l++){var n,i;const r=(null===(n=c[(null===(i=c)||void 0===i?void 0:i.length)-1])||void 0===n?void 0:n.path)||"",o=s[l],a=H.asArray(e[l](t))||[],d=[];if(a[0]===Js)break;for(let n=0,{length:i}=a;n<i;n++){const i=a[n],s=`${r+(null!=i&&i.isModel?i.id:i)}/`,c=$.makeValidDomId(`generated_${s}`,"_"),u=e[l].fieldName,h=o.get(c)||o.set(c,{id:c,key:i,path:s,expanded:!0,readOnly:!0,children:[],generatedParent:!0,field:u,firstGroupChild:t}).get(c);d.push(h)}c.forEach((e=>{d.forEach((t=>{e.children.includes(t)||e.children.push(t)}))})),c=d}c.length?c.forEach(((e,n)=>e.children.push(n?t.link():t))):o.push(t)}}),!0),(t||n)&&s.forEach((e=>e.forEach(((e,r,i)=>{null==t||t(e),n&&(e=this.createRecord(e),i.set(r,e))})))),a.children=[...s[0].values(),...o];const d=t=>{t.children&&(t.children.sort(((t,n)=>{if(t.isLeaf===n.isLeaf){if(t.isLeaf){let i;for(let s=0;!i&&s<r;s++){const r=e[s](t),o=e[s](n);if(r===Js||o===Js)return t.isLeaf<n.isLeaf?-1:t.isLeaf>n.isLeaf?1:0;i=r<o?-1:o>r?1:0}return i}return"string"==typeof t.key&&"string"==typeof n.key?t.key.localeCompare(n.key,i,{numeric:!0}):t.key<n.key?-1:t.key>n.key?1:0}return t.isLeaf<n.isLeaf?-1:t.isLeaf>n.isLeaf?1:0})),t.children.forEach(d))};return d(a),a}treeifyFlatData(e){const{childrenField:t,parentIdField:n}=this.modelClass;let r=!1,i=!0;for(const s of e){if(s.isModel||Array.isArray(s[t])){i=!1;break}null!=s[n]&&(r=!0)}return i&&r&&(e=this.transformToTree(e)),e}async indent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{let n=Boolean(t.previousSibling);for(;n&&!t.isRoot;)n=!e.includes(t.parent),t=t.parent;return n}))).length&&!1!==t.trigger("beforeIndent",{records:e})){e.sort(((e,t)=>Xs.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const n of e){const e=n.previousSibling;e.appendChild(n),t.toggleCollapse(e,!1)}t.endBatch(),t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e})}}async outdent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{const{parent:n}=t;let r=n&&!n.isRoot;for(;r&&!t.isRoot;)r=!e.includes(n),t=t.parent;return r}))).length&&!1!==t.trigger("beforeOutdent",{records:e})){e.sort(((e,t)=>Xs.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const n of e){const{parent:e}=n,r=e.children.slice(e.children.indexOf(n)+1);e.parent.insertChild(n,e.nextSibling),n.appendChild(r),t.toggleCollapse(n,!1)}t.endBatch(),t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e})}}};class eo{static preWalk(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s.slice().reverse())}static preWalkWithParent(e,t,n){const r=[{node:e,parent:null}];for(;r.length;){const{parent:e,node:i}=r.pop();n(e,i);const s=t(i);Array.isArray(s)&&r.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s)}static postWalk(e,t,n){const r=new Map,i=[e];let s,o;for(;i.length;)s=i[i.length-1],r.has(s)?(n(s),i.pop()):(o=t(s),o&&i.push(...o.slice().reverse()),r.set(s,s))}static prePostWalk(e,t,n,r){const i=new Map,s=[e];let o,a;for(;s.length;)o=s[s.length-1],i.has(o)?(r(o),s.pop()):(n(o),a=t(o),a&&s.push(...a.slice().reverse()),i.set(o,o))}}eo._$name="WalkHelper";var to=e=>class extends(e||ye){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null}}syncDataset(e){var t;const n=this,{storage:r}=n,s=null===(t=n.shouldSyncDataset)||void 0===t?void 0:t.call(n,{data:e});if(!1===s)return;n.trigger("startApplyChangeset"),n.isSyncingDataOnLoad=!0;const{toAdd:o,toRemove:a,toMove:l,updated:c,ids:d}=n.tree?n.syncTreeDataset(e,s):n.syncFlatDataset(e,s);let{threshold:u}=n.syncDataOnLoad,h=!1;if(u&&("string"==typeof u&&(u=parseInt(u,10)/100*n.count),h=o.length+a.length+l.length+c.length>u),n.tree){if(o.length){n.add(o,h).forEach((e=>e.clearParentId()))}if(l.length)for(const{parent:e,node:t,index:r}of l){n.getById(e.id).insertChild(t,r)}n.remove(a,h)}else h&&n.suspendEvents(),n.remove(a),n.add(o),h&&n.resumeEvents();u&&!h&&c.forEach((({record:e,toSet:t,wasSet:r})=>n.onModelChange(e,t,r))),n.acceptChanges();const g={added:o,removed:a,updated:c,thresholdSurpassed:h};if(n.isFiltered&&!n.remoteFilter&&n.filter({silent:n.isRemoteDataLoading}),n.isGrouped)n.group(null,null,!1,!0,n.isRemoteDataLoading);else if(n.isSorted)n.remoteSort?r.replaceValues({values:r.values.sort(n.createSorterFn(n.sorters)),silent:!0}):n.sort();else if(n.tree){let e=!1,t=0;eo.preWalk(n.rootNode,(t=>Array.isArray(t.children)&&!e?t.children:null),(n=>{n.id!==d[t++]&&(e=!0)})),e&&(n.sort(((e,t)=>d.indexOf(e.id)-d.indexOf(t.id)),i,i,!0),n.clearSorters(!0),!h&&n.afterPerformSort())}else r.values.some(((e,t)=>e.id!==d[t]))&&(r.replaceValues({values:r.values.sort(((e,t)=>d.indexOf(e.id)-d.indexOf(t.id))),silent:!0}),!h&&n.afterPerformSort());h&&n.trigger("refresh",{action:"batch",data:e,records:r.values,syncInfo:g}),n.isSyncingDataOnLoad=!1,n.trigger("endApplyChangeset"),n.trigger("loadSync",g)}syncFlatDataset(e,t){if(!e)return{toRemove:this.records};const n=this,{idField:r,allFields:i}=n.modelClass,s=[],o=[],a=[],l={},c=[],d=Array.isArray(t),{threshold:u,keepMissingValues:h}=n.syncDataOnLoad;let g=0;if(e.forEach((e=>{const s=(e=e.isModel?e.data:e)[r],m=n.getById(s);var p;if(!d||t.includes(s))if(m){if(!1!==(null===(p=n.shouldSyncRecord)||void 0===p?void 0:p.call(n,{record:m,data:e}))){var f,v;if(null===(f=n.beforeSyncRecord)||void 0===f||f.call(n,{record:m,data:e}),!1===h)for(const t of i)!(t.dataSource in e)&&t.dataSource in m.data&&(e[t.dataSource]=t.defaultValue);const t=m.set(e,null,Boolean(u));t&&a.push({record:m,wasSet:t,toSet:e}),null===(v=n.afterSyncRecord)||void 0===v||v.call(n,{record:m,data:e})}}else o.push(n.processRecord(n.createRecord(e)));m&&g++,l[s]=1,c.push(s)})),g<n.allRecords.filter((e=>!e.isSpecialRow)).length)if(t)for(const e of t)l[e]||s.push(n.getById(e));else n.forEach((e=>{l[e.id]||s.push(e)}),n,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0});return{toAdd:o,toRemove:s,toMove:[],updated:a,ids:c}}syncTreeDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:n,parentIdField:r,childrenField:s,allFields:o}=t.modelClass,{keepMissingValues:a,threshold:l}=t.syncDataOnLoad,c=[],d=[],u=[],h=[],g=new Set,m=[];return t.transformFlatData&&(e=t.treeifyFlatData(e)),eo.preWalkWithParent({isRoot:!0,id:t.rootNode.id,children:e},(e=>e.children),((e,c)=>{if(e){const{id:f,node:v}=t.resolveSyncNode(c);var p;if(v){if(!1!==(null===(p=t.shouldSyncRecord)||void 0===p?void 0:p.call(t,{record:v,data:c}))){let r;const i=v.children;if(!0!==i&&!0===c[s]&&(v.clearChildren(),v.data[s]=v.children=!0,delete c[s],t.toggleCollapse(v,!0),r=!0),v.parent.id!==e[n]&&u.push({node:v,parent:e,index:e[s].indexOf(c)}),!1===a)for(const e of o)"parentId"!==e.name&&!(e.dataSource in c)&&e.dataSource in v.data&&(c[e.dataSource]=e.defaultValue);"boolean"==typeof c.expanded&&this.toggleCollapse(v,!c.expanded);const d=v.set(c,null,Boolean(l));d?h.push({record:v,wasSet:d,toSet:c}):r&&v.signalNodeChanged({[s]:{value:!0,oldValue:i}})}}else c[r]=e[n],d.push({...c,...Array.isArray(c[s])?{children:[]}:i});g.add(v),m.push(f)}})),g.length!==e.length&&t.traverse((e=>{g.has(e)||c.push(e)})),{toAdd:d,toRemove:c,toMove:u,updated:h,ids:m}}resolveSyncNode(e){const t=e[this.modelClass.idField];return{id:t,node:this.getById(t)}}};const no=Symbol("STM_PROP");var ro=e=>class extends(e||ye){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[no]}set stm(e){const t=this;var n;t.stm!==e&&(null!==(n=t.stm)&&void 0!==n&&n.hasStore(t)&&t.stm.removeStore(t),t[no]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1,n={}){let r;const{stm:i}=this;var s;!this.tree&&null!=i&&i.enabled?(r=super.add(e,t),null!==(s=r)&&void 0!==s&&s.length&&i.onStoreModelAdd(this,r,t)):r=super.add(e,t,n);return r}insert(e,t,n=!1){let r;const{stm:s}=this;if(!this.tree&&null!=s&&s.enabled){var o;const a=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const n=t instanceof ds?this.indexOf(t):i;return n!==i&&-1!==n&&e.set(t,n),e}),new Map);r=super.insert(e,t),null!==(o=r)&&void 0!==o&&o.length&&(e=this.indexOf(r[0]),s.onStoreModelInsert(this,e,r,a,n))}else r=super.insert(e,t,n);return r}remove(e,t=!1,n){let r;const{stm:s}=this;if(!this.tree&&null!=s&&s.enabled){var o;const a=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>!!e)).reduce(((e,t)=>{const n=this.indexOf(t);return n!==i&&-1!==n&&e.set(t,n),e}),new Map);r=super.remove(e,t,n),null!==(o=r)&&void 0!==o&&o.length&&s.onStoreModelRemove(this,r,a,t)}else r=super.remove(e,t,n);return r}removeAll(e){const{stm:t}=this;let n;if(null!=t&&t.enabled){const{tree:r,rootNode:i,allRecords:s}=this,o=s.length,a=r?i.children.slice():s.slice();n=super.removeAll(e),o&&0===this.count&&t.onStoreRemoveAll(this,a,e)}else n=super.removeAll(e);return n}beforeApplyChangeset(){const{stm:e,crudManager:t}=this;let n=!1,r=null;return null!=t&&t.applyingChangeset||null==e||!e.enabled||(n=!0,e.isRecording&&(r=e.stash()),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),{shouldResume:n,transactionId:r}}applyChangeset(e,t,n,r,i){const{shouldResume:s,transactionId:o}=this.beforeApplyChangeset(),a=super.applyChangeset(e,t,n,r,i);return this.afterApplyChangeset(s,o),a}afterApplyChangeset(e,t){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash(t)}}};const io={splice:1,clear:1},so={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},oo=(e,t)=>("boolean"==typeof(t=t||!1)&&(t={includeFilteredOutRecords:t,includeCollapsedGroupRecords:!1}),t||so);class ao extends(ye.mixin(mi,ki,Ge,vi,Ri,Ls,Os,Ps,Vs,Hs,Ws,Us,js,Ys,qs,Qs,ro,to,Bs)){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map,addingClean:!1}}static get configurable(){return{id:!0,modelClass:ds,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null,storeClass:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new Fs,removed:new Fs,modified:new Fs,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=Xt.assign({id:e.storeId},e)),super.construct(e),this.initRelations()}static from(e,t={},n=null){return e&&!e.isStore&&("string"==typeof e?e=ao.getStore(e):(Array.isArray(e)?(n&&(e=e.map((e=>e.isModel?e:n(e)))),e=Xt.assign({},t,{data:e})):e=Xt.assign({},t,e),e=new ao(e))),e}doDestroy(){var e,t,n;const r=this,i=r.registeredRecords;null===(e=r.stm)||void 0===e||null===(t=e.removeStore)||void 0===t||t.call(e,r);for(let e,t=i.length-1;t>=0;t--){var s;e=i[t],null!==(s=e)&&void 0!==s&&s.isDestroyed||e.unjoinStore(r)}var o;(null===(n=r._storage)||void 0===n||n.destroy(),r.isChained)||(null===(o=r.rootNode)||void 0===o||o.destroy());super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){if(this.resumeEvents()){const{values:e}=this.storage;this.trigger("refresh",{action:"batch",data:e,records:e})}}set storage(e){const t=this;null!=e&&e.isCollection?t._storage=e:t._storage=new Ms(e),t._storage.autoFilter=t.reapplyFilterOnAdd,t._storage.autoSort=t.reapplySortersOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.ion({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const t=this;if((null===(e=t._allRecords)||void 0===e?void 0:e.generation)!==t.storage.generation){if(t.isTree){const e=t.collectDescendants(t.rootNode,i,i,{unfiltered:!0}).all;t.rootVisible&&e.unshift(t.rootNode),t._allRecords=e}else t._allRecords=t.isGrouped?t.collectGroupRecords():t.storage.allValues;t._allRecords.generation=t.storage.generation}return t._allRecords}getAllDataRecords(e){const t=this;return t.tree?e?t.allRecords:t.rootNode.allChildren:t.isGrouped?t.collectGroupRecords(e,!1):e?t.storage.allValues:t.storage.values}onIsCreatingToggle(e,t){const n=this,r=e.isPersistable&&!t;n.added[r?"add":"remove"](e),r&&(n.trigger("addConfirmed",{record:e}),n.autoCommit&&n.doAutoCommit())}joinRecordsToStore(e){const{allCount:t}=this;for(let n=0;n<e.length;n++){const r=e[n];r.setData("parentIndex",t+n-e.length),r.joinStore(this)}}onDataChange({source:e,action:t,added:n,removed:r,replaced:i,oldCount:s,items:o,from:a,to:l}){const c=this,d=io[t],u=d&&(null==n?void 0:n.length),h=d&&(null==r?void 0:r.length);let g,m;if(c._idMap=null,u&&c.joinRecordsToStore(n),null==i||i.forEach((([e,t])=>{e.unjoinStore(c,!0),t.joinStore(c)})),super.onDataChange(...arguments),!c.isTree){if(u){for(const e of n)c.removed.includes(e)?c.removed.remove(e):c.addingClean||e.isLinked||c.added.add(e);g=!c.remoteFilter&&c.isFiltered&&c.reapplyFilterOnAdd,g&&c.filter({silent:!0}),m=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,m&&c.sort(null,null,!1,!0)}if(h){for(const e of r)e.cancelBatch(),e.unjoinStore(c),c.added.includes(e)?c.added.remove(e):e._undoingInsertion||e.isCreating||e.isLinked||c.removed.add(e);c.modified.remove(r),g=!c.remoteFilter&&c.isFiltered,g&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(u){c.updateDependentStores("add",n);const t=n.reduce(((e,t)=>{const{previousIndex:n}=t.meta;return n>-1&&n<e&&(e=n),e}),n[0].meta.previousIndex),r={records:n,index:e.indexOf(n[0],!e.autoFilter)};t>-1&&(r.oldIndex=t),c.trigger("add",r),c.trigger("change",Object.assign({action:"add"},r)),g&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),m&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}r.length&&(c.updateDependentStores("remove",r),c.trigger("remove",{records:r}),c.trigger("change",{action:"remove",records:r})),i.length&&(c.updateDependentStores("replace",i),c.trigger("replace",{records:i,all:c.records.length===i.length}),c.trigger("change",{action:"replace",replaced:i,all:c.records.length===i.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const e=Math.min(a,l),n=Math.min(c.storage.allValues.length-1,Math.max(a,l));for(let t=c.storage.allValues,r=e;r<=n;r++)t[r].setData("parentIndex",r);c.trigger("move",{record:o[0],records:o,from:a,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:t,record:o[0],records:o,from:a,to:l});break}}}onDataReplaced(e,t){var n;const r=this,{storage:i}=r,s=i.allValues,o=Boolean(r.sorters.length>0);for(let e=0;e<s.length;e++)s[e].joinStore(r);if(!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.remoteSort?r.isGrouped&&i.replaceValues({...r.prepareGroupRecords(),silent:!0}):(r.isGrouped&&r.group(null,null,!1,!o,!0),o&&r.sort(null,null,!1,!0)),!r.useRawData.disableDuplicateIdCheck){const{idMap:e}=r;if(Object.keys(e).length<i.values.length){const t=[];throw i.values.forEach((n=>e[n.id]?delete e[n.id]:t.push(n))),new Error(`Id collision on ${t.map((e=>e.id))}`)}}const a={action:e,data:t,records:i.values};r.updateDependentStores(e,a.records),null===(n=r.afterLoadData)||void 0===n||n.call(r),r.isRemoteDataLoading||r.trigger("refresh",a),r.trigger("change",a)}onModelChange(e,t,n,r,i){const s=this,o={record:e,records:[e],changes:n,batch:null!=e.batching,fromRelationUpdate:i},a=!e.ignoreBag&&!e.isLinked&&s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,n),"id"in n){const{oldValue:n,value:r}=t.id;s.updateDependentRecordIds(n,r),s.onRecordIdChange({record:e,oldValue:n,value:r})}if(!r){if("id"in n){const{oldValue:n,value:r}=t.id;s.trigger("idChange",{store:s,record:e,oldValue:n,value:r})}s.onUpdateRecord(e,n),s.trigger("update",o),s.trigger("change",Object.assign({action:"update"},o))}s.autoCommit&&a&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let n=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||!e.isPartOfStore(t)||e.isRoot||(e.isPhantom?t.added.add(e):t.modified.add(e),n=!0):t.modified.remove(e),n}get idMap(){const e=this,t=!e._idMap,n=e._idMap||(e._idMap={});if(t){const t=e.storage.values;for(let e,r=0,i=0;r<t.length;r++)e=t[r],n[e.id]={index:r,visibleIndex:i,record:e},e.isSpecialRow||i++;if(e.isFiltered)for(let t=0,r=e.storage._values.length;t<r;t++){const r=e.storage._values[t];r.id in n?n[r.id].unfilteredIndex=t:n[r.id]={index:-1,unfilteredIndex:t,record:r}}}return n}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let n=e;if(null!=t&&t.length){class r extends e{static get fields(){return t}}n=r}else if(!this.preventSubClassingModel){class t extends e{}n=t}return n.initClass(),n}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,t){return super.changeId(!0!==e&&e,t)}updateId(e,t){const n=ao.getById(e);n&&ao.unregisterInstance(n),super.updateId(e,t)}generateAutoId(){return ao.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof ao)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let n;const r=e.map((e=>(e instanceof ds?n=e.constructor:"string"==typeof e&&(e={text:e}),e)));if(!n){class e extends ds{}n=e}e={autoCreated:!0,data:r,modelClass:n,allowNoId:!0},t||(t=ao)}return t?new t(e):void 0}static get stores(){return ao.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const n=this,r=n._rootNode;e!==r&&(r&&(n.clear(!0),n.removed.clear()),e instanceof ds?(e.instanceMeta(n).collapsed=!1,n._rootNode=e):n._rootNode=e=new n.modelClass(Object.assign({expanded:!0,[n.modelClass.idField]:`${n.id}-rootNode`},e),n,null,!0),n._tree=!0,e.isRoot=!0,e.joinStore(n),(null!==(t=e.children)&&void 0!==t&&t.length||n.rootVisible)&&(e.isLoading=!0,n.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),n.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){var t,n;const r=this,{idField:i,childrenField:s}=r.modelClass;if(r.transformFlatData&&(null===(t=e)||void 0===t?void 0:t.length)>0&&!Object.isExtensible(e[0])&&(r.useRawData=r.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=Xt.clone(e)),r.getConfig("plugins"),r.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=Xt.transformNamedObjectToArray(e,i)),r.tree=!r.isChained&&(r.tree||Boolean(r.autoTree&&(null===(n=e)||void 0===n?void 0:n.some((e=>e[s]))))),e&&(r.remoteSort||r.remoteFilter))for(let t=0;t<e.length;t++)e[t]._remoteSortIndex=t;if(r.syncDataOnLoad&&r._data)r.syncDataset(e);else{if(r._data=e,r.tree){r.transformFlatData&&(e=r.treeifyFlatData(e));const t=r.rootNode;if(t.isLoading=!0,r.clear(!0),t.appendChild(e),r.updateDependentStores("dataset",[t]),t.isLoading=!1,0===e.length){const e={action:"dataset",data:[],records:[]};r.trigger("refresh",e),r.trigger("change",e)}else r.isFiltered&&r.filter()}else r.loadData(e);r.added.clear(),r.removed.clear(),r.modified.clear()}}loadData(e,t="dataset"){const n=this,{storage:r,allowNoId:i}=n,s=n.modelClass.fieldMap.id.dataSource,o=n.find((e=>e.isCreating));o&&r.values.splice(n.records.indexOf(o),1);let a=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){if(!(e[0]instanceof ds)){n.modelClass.exposeProperties(e[0]);const t=e.length,o=new Array(t);for(let r=0;r<t;r++){var l,c,d;const t=e[r];if(!i&&null==t[s])throw new Error(`Id required but not found on row ${r}`);a&&null!==(l=t[s])&&void 0!==l&&null!==(c=(d=l).startsWith)&&void 0!==c&&c.call(d,"_generated")&&(console.warn(`Generated id found in data: ${t[s]}. Generated ids are temporary and should be replaced with real ids by the backend`),a=!1),o[r]=n.processRecord(n.createRecord(t,!0),!0),o[r].setData("parentIndex",r)}n.clear(!0),r.replaceValues({values:o,isNewDataset:!0,silent:!0})}else n.clear(!0),r.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});o&&!r.values.includes(o)&&r.values.push(o),n._data=e,n.onDataReplaced(t,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,t,n=!0){return(n?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,n=!1){return new this.modelClass(e,this,null,t,!1,n)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:n}){const r=this,i=r._idMap,{idRegister:s,oldIdMap:o}=r;if(r.storage._indicesInvalid=!0,o[t]=e,i&&!i[n]){const e=i[t];delete i[t],i[n]=e}r.added.changeId(t,n),r.removed.changeId(t,n),r.modified.changeId(t,n),delete s[t],s[n]=e,e.index=r.storage.indexOf(e)}onUpdateRecord(e,t){const n=this,{internalId:r}=t,{internalIdRegister:i}=n;r&&(this.storage._indicesInvalid=!0,delete i[r.oldValue],i[r.value]=e),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-((null===(e=this.groupRecords)||void 0===e?void 0:e.count)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const n=t.isTree&&t.idRegister[e.id];if(n&&n!==e)throw new Error(`Id collision on ${e.id}`)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(null!=e&&e.isModel){const t=e;return t.hasLinks&&!this.storage.allValues.includes(t)?t.$links.find((e=>this.storage.allValues.includes(e))):t}return this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[ds.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1,n=!1){if(null!=e&&e.isModel&&!e.stores.includes(this.$store||this)){const n=e.$links.find((e=>this.storage.allValues.includes(e)));return n?this.indexOf(n,t):-1}if(this.isTree)return(n?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const r=ds.asId(e);if(null==r)return-1;const i=this.idMap[r];return i?i[t?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1){const n=[],r={};let i;return this.forEach((t=>{if(!t.isSpecialRow&&!t.isRoot){i=t.getValue(e);const s=i instanceof Date?i.getTime():i;r[s]||(n.push(i),r[s]=1)}}),this,{includeCollapsedGroupRecords:!0,includeFilteredOutRecords:t}),n}getValueCount(e,t){let n=0;return this.forEach((r=>{Xt.isEqual(r.getValue(e),t)&&n++})),n}set json(e){"string"==typeof e&&(e=$.safeJsonParse(e)),this.data=e}get json(){return $.safeJsonStringify(this)}get formattedJSON(){return $.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map((e=>e.toJSON()))}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){const t=[];var n;this.tree?null===(n=this.rootNode.children)||void 0===n||n.forEach((n=>t.push(n.getCurrentConfig(e)))):this.forEach((n=>t.push(n.getCurrentConfig(e))));return t}getCurrentConfig(e){const t=super.getCurrentConfig(e),{state:n}=this;var r;t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,(null===(r=t.modelClass)||void 0===r?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,n&&Object.assign(t,n));return t}forEach(e,t=this,n){const r=this,i=(n,r)=>{if(!n.isRoot&&!n.isSpecialRow)return e.call(t,n,r)};if(n=oo(0,n),r.isTree)r.isChained&&(n={...n,sorterFn:r.sorterFn}),r.rootNode.traverseWhile(i,!1,n);else{const e=n.includeFilteredOutRecords?r.storage.allValues:r.storage.values;if(r.isGrouped&&n.includeCollapsedGroupRecords)for(let t=0;t<e.length;t++){const r=e[t],s=n.includeFilteredOutRecords?r.unfilteredGroupChildren:r.groupChildren;if(s&&!0===r.meta.collapsed)for(let e=0;e<s.length;e++){if(!1===i(s[e],e))return}else if(!1===i(r,t))return}else for(let t=0;t<e.length;t++)if(!1===i(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}flatMap(e,t=this){return this.storage.values.flatMap(e,t)}every(e,t=this,n){return this.storage[n?"allValues":"values"].every(e,t)}reduce(e,t=[],n=this){return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,n=t===this.rootNode,r){const i=this;if(r=oo(0,r),i.isTree){if("boolean"==typeof t&&(n=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverse(e,n,r)}else i.forEach((t=>t.traverse(e,!1,r)),i,r)}traverseWhile(e,t=this.rootNode,n=t===this.rootNode,r){const i=this;if(r=oo(0,r),i.isTree){if("boolean"==typeof t&&(n=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,n,r)}else for(const t of i.storage)if(!1===t.traverse(e,!1,r))break}getNext(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const o=i[s+1];return n&&o&&o.isSpecialRow?r.getNext(i[s+1],t,!0):o}getPrev(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(0===s){if(!t)return null;s=i.length}const o=i[s-1];return n&&o&&o.isSpecialRow&&s>0?r.getPrev(i[s-1],t,!0):o}getAdjacent(e,t=!0,n=!1,r=!1){return t?this.getNext(e,n,r):this.getPrev(e,n,r)}getNextLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(i>=n.length-1){if(!t)return null;i=-1}return n[i+1]}getPrevLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(0===i){if(!t)return null;i=n.length}return n[i-1]}getAdjacentLeaf(e,t=!0,n=!1){return t?this.getNextLeaf(e,n):this.getPrevLeaf(e,n)}}ao.initClass(),ao._$name="Store";const lo=(e,t)=>(Array.isArray(t[1])?t[1].forEach((n=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(n)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),co=Promise.resolve(),uo=e=>String(e).padStart(2,"0");class ho extends ao{static $name="AjaxStore";static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static configurable={params:null,pageSize:50};updatePageSize(e){const t=this;if(!this.isConfiguring){const n=t.currentPage=t.currentPage?Math.min(t.currentPage,Math.floor((t.allCount+e-1)/e)):1;e&&t.loadPage(n)}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch((()=>{}))}get isLoading(){return this._isLoading?2:!!this.loadTriggerPromise&&1}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...t){const n=e.includes("?"),r=Object.entries(Object.assign({},...t)).reduce(lo,[]).join("&");return r?(n?"&":"?")+r:""}async performSort(e){const t=this;if(t.remoteSort&&!t.isRemoteDataLoading){t.isRemoteDataLoading=!0;const n=await t.internalLoad({},"",(n=>{t.data=n.data,t.afterPerformSort(e)}));return t.isRemoteDataLoading=!1,n}super.performSort(e)}async performFilter(e){const t=this;if(t.remoteFilter){var n;null===(n=t.loadingPromise)||void 0===n||n.abort(),t.isRemoteDataLoading=!0;const r=t.count,{filters:i}=t;t.currentPage=1;const s=await t.internalLoad({},"",(n=>{t.data=n.data,n=e?null:{action:"filter",filters:i,oldCount:r,records:t.storage.values},t.afterPerformFilter(n),t.trigger("refresh",n)}));return t.isRemoteDataLoading=!1,s}super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:n,operator:r,value:i,caseSensitive:s}of e)t.push({field:n,operator:r,value:i,caseSensitive:s});return JSON.stringify(t,(function(e,t){return""===e?t:this[e]instanceof Date?`${(n=this[e]).getFullYear()}-${uo(n.getMonth()+1)}-${uo(n.getDate())}T${uo(n.getHours())}:${uo(n.getMinutes())}:${uo(n.getSeconds())}.${n.getMilliseconds()}`:t;var n}))}encodeSorterParams(e){return JSON.stringify(e.filter((e=>!e.sortFn)).map((e=>e)))}buildReadUrl(){const{readUrl:e}=this;if(this.restfulFilter&&this.filters.count){return(e.endsWith("/")?e:e+"/")+this.filters.first.value}return e}internalLoad(e,t,n,r=0){e=Xt.assign({},this.params,e);const i=this,s=i.buildReadUrl(),o={action:"read"+t,params:e,url:s};if(!s)throw new Error("No load url specified");if(!1===i.trigger("beforeLoad"+t,o))throw!1;return i.loadArgs=[s,o,e,t,n],!1===r?new Promise(((e,t)=>i.sendLoadRequest(e,t))):i.loadTriggerPromise||(i.loadTriggerPromise=new Promise(((e,t)=>{i.setTimeout({delay:r,fn:"sendLoadRequest",args:[e,t],cancelOutstanding:!0})})))}async sendLoadRequest(e,t){const n=this,[r,i,s,o,a]=n.loadArgs;if(n.loadTriggerPromise=null,r){if(n._isLoading=!0,n.trigger(`load${o}Start`,i),n.trigger("beforeRequest",i),n.filterParamName&&n.isFiltered&&(s[n.filterParamName]=n.encodeFilterParams(n.filters.values)),n.remoteSort&&n.isSorted&&(s[n.sortParamName]=n.encodeSorterParams(n.groupers?n.groupers.concat(n.sorters):n.sorters)),n.isPaged){if(!(n.pageParamName in s)&&!(n.pageStartParamName in s)){const e=Math.min(n.currentPage||1,n.allCount?n.lastPage:1/0);n.pageParamName?s[n.pageParamName]=e:s[n.pageStartParamName]=(e-1)*n.pageSize}s[n.pageSizeParamName]=n.pageSize}const r={headers:n.headers,parseJson:!0};n.useRestfulMethods&&(r.method=n.httpMethods.read,i.body&&(r.body=JSON.stringify(i.body)));try{const l=n.loadingPromise=Se.get(i.url+n.buildQueryString(i.url,s),Xt.assign(r,n.fetchOptions)),c=await l,d=c.parsedJson,u=Array.isArray(d),h=u||d&&!1!==Xt.getPath(d,n.responseSuccessProperty),g=u?null:Xt.getPath(d,n.responseTotalProperty);if(n.isDestroyed)return;if(n.loadingPromise=null,n._isLoading=!1,i.response=c,i.json=d,h){if(null!=g&&(n.remoteTotal=parseInt(g,10)),n.isPaged){if(!(n.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=n.pageParamName?s[n.pageParamName]:s[n.pageStartParamName]/n.pageSize+1;n.currentPage=Math.min(e,n.lastPage)}}i.data=u?d:Xt.getPath(d,n.responseDataProperty),await a(i),!n.isDestroyed&&n.trigger("load"+o,i),e(i)}else Object.assign(i,{exception:!0,exceptionType:"server",error:null==d?void 0:d.error}),!n.isDestroyed&&n.trigger("exception",i),t(i);!n.isDestroyed&&n.trigger("afterRequest",i)}catch(e){n._isLoading=!1,i.exception=!0,e instanceof Response?(i.exceptionType=e.ok?"server":"network",i.response=e,i.error=e.error):(i.exceptionType="server",i.error=e),!n.isDestroyed&&n.trigger("exception",i),t(i),!n.isDestroyed&&n.trigger("afterRequest",i)}}}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}),!1):this.immediatePromise}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const n=this,r=n.pageParamName?{[n.pageParamName]:e}:{[n.pageStartParamName]:(e-1)*n.pageSize};return r[n.pageSizeParamName]=n.pageSize,n.internalLoad(Xt.assign(r,t),"Page",(e=>{n.loadData(e.data,"pageLoad")}))}async nextPage(e){const t=this;return t.isPaged&&t.currentPage!==t.lastPage?t.loadPage(t.currentPage+1,e):co}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):co}async commit(){const e=this,{changes:t}=e,n=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear()),co;if(!1!==e.trigger("beforeCommit",{changes:t})){[...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),e.trigger("commitStart",{changes:t});const r={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(r);return i&&n.push(i),i=e.commitAdded(r),i&&n.push(i),i=e.commitModified(r),i&&n.push(i),n.length?(i=1===n.length?n[0]:Promise.all(n),e.commitPromise=new Promise(((n,s)=>{i.then((()=>{e.commitPromise=null,r.exception?(e.trigger("exception",r),s(r)):(e.trigger("commit",{changes:t}),n(r))})).catch((()=>{e.commitPromise=null,s(r)}))}))):(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear(),e.added.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),co)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e}))}commitAdded(e){const t=this,n=t.added,r={action:"create",params:t.params};return n.count&&t.createUrl?new Promise((i=>{const s=n.values.map((e=>e.persistableData));e.create=r,r.body={data:s},t.trigger("beforeRequest",r);let o=r.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0},l=t.createUrl+t.buildQueryString(t.createUrl,t.params);t.useRestfulMethods&&(a.method=t.httpMethods.create),Se.post(l,o,Xt.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n.values,a?o:Xt.getPath(o,t.responseDataProperty)),n.clear(),t.trigger("commitAdded"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,e.exceptionType=r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}commitModified(e){const t=this,{modified:n}=t.changes,r={action:"update",params:t.params},i=n.length&&t.updateUrl?new Promise((i=>{const s=n.map((e=>t.writeAllFields?e.persistableData:e.modificationDataToWrite)).filter((e=>!Xt.isEmpty(e)));if(0===s.length)return t.modified.clear(),n.forEach((e=>e.meta.committing=!1)),void i();e.update=r,r.body={data:s},t.trigger("beforeRequest",r);let o=r.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.update),Se.post(t.updateUrl+t.buildQueryString(t.updateUrl,t.params),o,Xt.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n,a?o:Xt.getPath(o,t.responseDataProperty),!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null;return!n.length&&t.modified.count&&t.modified.clear(),i}processReturnedData(e,t,n=!1){const r=this,i=r.modelClass,s=i.fieldMap.id.dataSource;t.forEach(((t,o)=>{const a=e[o];a.clearChanges(!0,!1),a.syncId(t[s]),Object.assign(e[o].data,i.processData(t,n,r,a))}))}commitRemoved(e){const t=this,n=t.removed,r={action:"delete",params:t.params};return n.count&&t.deleteUrl?new Promise((i=>{e.delete=r,r.body={ids:n.map((e=>e.id))},t.trigger("beforeRequest",r);let s=r.body;if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.delete),Se.post(t.deleteUrl+t.buildQueryString(t.deleteUrl,t.params),s,Xt.assign(o,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,a?(n.forEach((e=>e.meta.committing=!1)),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}get remoteSort(){return Boolean(this.sortParamName)}}ho._$name="AjaxStore";class go{static insertRule(e,t=document.head){const n=this.getStyleSheet(t),r=n.cssRules.length;if(n.insertRule(e,0),n.cssRules.length>r)return n.cssRules[0]}static findRule(e){let t;const n="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(r=>{if(t=Array.prototype.find.call(r.sheet.rules||r.sheet.cssRules,(t=>n?e(t):t.selectorText===e)),t)return!0})),t}static getStyleSheet(e=document.head){return e.$bryntumStylesheet||(e.$bryntumStylesheet=Br.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}static getCSSVersion(){return getComputedStyle(document.documentElement).getPropertyValue("--bryntum-version").replace(/[" ]/gm,"")}}go._$name="CSSHelper";const mo=Array.prototype.slice,po=Object.freeze([]),fo=Object.freeze({}),vo=/[&<]/,{getPrototypeOf:yo}=Object,{toString:bo}=Object.prototype,{isEqual:Co,isObject:So}=Xt,Do={parent:1,elementData:1,ns:1,syncOptions:1},wo=()=>({ignore:Do,refsFound:new Set}),Eo={class:1,className:1,classname:1},xo={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},Ro={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1,retainChildren:1};class To{static checkEquality(e,t,n,r){if(e===t)return!0;if(null==e)return null==t;if(!e||!t)return!1;const s=typeof e;if(s!==typeof t||xo[s])return!1;let o,a,l,c,d,u,h,g=n.equalityCache||(n.equalityCache=new Map),m=Boolean(r);if(g=g.get(e)||g.set(e,new Map).get(e),o=g.get(t),o===i){if(o=!0,yo(e)!==yo(t)||e instanceof Node)o=!1;else if(Array.isArray(e)){if(a=e.length,a!==t.length)o=!1;else for(;a-- >0;)if(!To.checkEquality(e[a],t[a],n,m)){o=!1;break}}else{var p;for(d in u=e.syncOptions,c=null===(p=u)||void 0===p?void 0:p.ignoreRefs,c&&(m=!0,r="children"!==c),l=n.ignore||fo,t)if(!(l[d]||d in e||r&&"reference"===d)){o=!1;break}if(o)if("[object Date]"===bo.call(t))o=e.getTime()===t.getTime();else if(Br.isReactElement(e)||Br.isReactElement(t))o=!1;else for(d in e)if(!(l[d]||r&&"reference"===d)){if(!(d in t)){o=!1;break}if(h=e[d],!To.checkEquality(h,t[d],n,m)){o=!1;break}}}var f;if(!r&&So(e)&&e.reference)null===(f=n.refsFound)||void 0===f||f.add(e.reference);g.set(t,o)}return o}static sync(e){const t=e,{refOwner:n}=e,r=null==n?void 0:n.byRef,i=wo();let s,o,a,l,c=e.affected;if("string"==typeof c&&(c=[c]),e={...e,checkEqualityOptions:i},n){if(n.byRef={},c)for(o in r)c.includes(o)||(n.byRef[o]=r[o]);e.refsWas=r}if(t.changed=To.performSync(e,e.targetElement),n)for(c||(c=Object.keys(r)),s=0;s<c.length;++s){var d,u;if(o=c[s],a=r[o],i.refsFound.has(o)||a.retainElement)n.byRef[o]=a;else l=a.lastDomConfig,null===(d=(u=a).blur)||void 0===d||d.call(u),a.remove(),n.detachRef(o,a,l)}return e.targetElement}static performSync(e,t){const{domConfig:n,callback:r}=e,{lastDomConfig:i}=t;return(e.configEquality||To.checkEquality)(n,i,e.checkEqualityOptions,e.ignoreRefs)?(null==r||r({action:"none",domConfig:n,targetElement:t}),!1):(n?(n.onlyChildren||(To.syncAttributes(n,t,e),To.syncContent(n,t)),n.keepChildren||To.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=null!=n&&n.onlyChildren&&i?{...i,children:n.children}:n,!0)}static syncDataset(e,t){const{lastDomConfig:n}=t,r=e===n,i=Object.keys(e.dataset),s=n&&n.dataset&&Object.keys(n.dataset),o=H.delta(i,s);let a,l,c,d;for(l=0;l<o.onlyInA.length;l++)a=o.onlyInA[l],d=e.dataset[a],null!=d&&t.setAttribute(`data-${$.hyphenate(a)}`,d);for(l=0;l<o.inBoth.length;l++)a=o.inBoth[l],d=e.dataset[a],(r||d!=n.dataset[a])&&(c=`data-${$.hyphenate(a)}`,null==d?t.removeAttribute(c):t.setAttribute(c,d));for(l=0;l<o.onlyInB.length;l++)t.removeAttribute(`data-${$.hyphenate(o.onlyInB[l])}`)}static addCls(e,t){const{lastDomConfig:n}=t;(e=Tn.normalize(e,"array")).forEach((e=>{t.classList.add(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)||(i.push(e),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)||r.push(e):r.isDomClassList?r.add(e):Xt.isObject(r)&&(r[e]=1)})(e,n)}))}static removeCls(e,t){const{lastDomConfig:n}=t;(e=Tn.normalize(e,"array")).forEach((e=>{t.classList.remove(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)&&r.splice(r.indexOf(e),1):r.isDomClassList?r.remove(e):Xt.isObject(r)&&delete r[e]})(e,n)}))}static syncClassList(e,t,n){let r,i,s,o,a,l,c=e.className||e.class,d=!1;if(n){for(i=Tn.normalize(t,"array"),c=Tn.normalize(c,"object"),l=Tn.normalize(n.className||n.class,"object"),a=[],s=0,o=i.length;s<o;++s)r=i[s],c[r]||!(r in l)?(l[r]=1,a.push(r)):d=!0;for(r in c)l[r]||(a.push(r),d=!0);if(!d)return;c=a.join(" ")}else c=Tn.normalize(c);t.setAttribute("class",c)}static getSyncAttributes(e){const t={},n=[];return e&&Object.keys(e).forEach((r=>{if(!Ro[r]){const i=r.toLowerCase();t[i]=e[r],n.push(i)}})),{attributes:t,names:n}}static syncAttributes(e,t,n){const{lastDomConfig:r}=t,i=e===r,s=To.getSyncAttributes(e),{attributes:o,names:a}=s,{attributes:l,names:c}=i?s:To.getSyncAttributes(r),{onlyInA:d,onlyInB:u,inBoth:h}=i?{onlyInA:po,onlyInB:po,inBoth:a}:H.delta(a,c);let g,m;for(m=0;m<d.length;m++){g=d[m];const n=o[g];"style"===g&&null!=n?Br.applyStyle(t,n,!0):"dataset"===g?To.syncDataset(e,t):Eo[g]?To.syncClassList(e,t):null!=n&&t.setAttribute(g,n)}for(m=0;m<u.length;m++)t.removeAttribute(u[m]);for(m=0;m<h.length;m++){g=h[m];const r=o[g],s=l[g];null==r?t.removeAttribute(g):"style"===g?n.strict?i?To.syncStyles(t,r):Co(r,s,!0)||To.syncStyles(t,r,s):!i&&Co(r,s,!0)||Br.applyStyle(t,r,!0):"dataset"===g?To.syncDataset(e,t):Eo[g]?To.syncClassList(e,t,n.strict&&t.lastDomConfig):(i||r!==s)&&t.setAttribute(g,r)}}static syncStyles(e,t,n){let r,i,s;if(n){if(r={},t=Br.parseStyle(t),n=Br.parseStyle(n),t)for(i in t)s=t[i],n[i]!==s&&(r[i]=s);for(i in n)i in t||(r[i]="")}else r=t;Br.applyStyle(e,r)}static syncContent(e,t){const{html:n,text:r}=e,i=r??n;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment)1===t.childNodes.length&&0===Br.getChildElementCount(t)&&1===i.childNodes.length&&0===Br.getChildElementCount(i)?Br.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i));else if(null!=n&&vo.test(n))t.innerHTML=String(n);else if(null!=i){var s;const{lastDomConfig:e}=t;null!=e&&null!==(s=e.children)&&void 0!==s&&s.length||null!=e&&e.html&&vo.test(t.lastDomConfig.html)?t.innerHTML=i:(Br.setInnerText(t,String(i)),t.didSetTextContent=!0)}}static insertTextNode(e,t,n,r,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),r&&(s.$refOwnerId=r.id),null==n||n({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,n,r,i,s,o){var a;const l=o.ns?document.createElementNS(o.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(l,n),To.performSync(o,l),null!=s&&(i[s]=l),e.role||e.tabIndex||e["aria-hidden"]||Br.isFocusable(l,!0)||l.htmlFor||l.setAttribute("role","presentation"),r&&(l.$refOwnerId=r.id,s&&(l.$reference=s,r.attachRef(s,l,e))),null===(a=o.callback)||void 0===a||a.call(o,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){let n,r,i,{domConfig:s,syncIdField:o,callback:a,releaseThreshold:l,configEquality:c,ns:d,refOwner:u,refsWas:h,strict:g,checkEqualityOptions:m,ignoreRefs:p}=e,f=null;const v=s.syncOptions||{};if(s.html??s.text)return;p=Boolean(v.ignoreRefs??p),p&&(u=h=null),"strict"in v&&(g=v.strict);const y=u?u.byRef:{},b=mo.call(s.children||[]),C=mo.call(t.childNodes),S=h||t.syncIdMap||{},D=t.releasedIdMap||{},w=e=>{for(;C.length&&C[0].parentNode!==t;)C.shift();return(e?C.shift():C[0])||null};o=v.syncIdField||o,g=v.strict||g,a=v.callback||a,c=v.configEquality||c,l="releaseThreshold"in v?v.releaseThreshold:l,o&&(t.syncIdMap=y);const E={checkEqualityOptions:m||wo(),ignoreRefs:p,refOwner:u,refsWas:h,strict:g,syncIdField:o,releaseThreshold:l,callback:a,configEquality:c};for(;b.length;){const l=b.shift();if(i=null,!l)continue;if(Br.isReactElement(l)){a({jsx:l,targetElement:t,domConfig:s});continue}if(Array.isArray(l)){this.syncChildren({...e,domConfig:{...e.domConfig,children:l}},t);continue}if(l instanceof Node){r=w(),l!==r&&t.insertBefore(l,r),n=C.indexOf(l),n>-1&&C.splice(n,1);continue}const c="string"==typeof l;if(E.domConfig=l,E.ns=l.ns||d,!c){if(u?i=l.reference:o&&l.dataset&&(i=l.dataset[o]),null!=i&&!l.unmatched){const e=S[i]||D[i];if(e){const{lastDomConfig:n}=e;if(e.retainElement);else if(To.performSync(E,e)){var x;null===(x=a)||void 0===x||x({action:"reuseOwnElement",domConfig:l,targetElement:e,lastDomConfig:n,syncId:i})}l.retainElement&&(e.retainElement=!0),y[i]=e,H.remove(C,e),delete D[i],e.isReleased=!1,r=w(),(e.parentNode!==t||g&&e.nextSibling!==r)&&t.insertBefore(e,r)}else g?To.insertElement(l,t,w(),u,y,i,E):(b.push(l),l.unmatched=!0);continue}l.unmatched&&delete l.unmatched}let h,m=null,p=null;for(;!p&&(h=w(!0));){if(u){if(h.$refOwnerId!==u.id)continue;if(h.$reference){if(!g)continue;m=h;break}p=h}else h.retainElement||(p=h);p||(f||(f=[])).push(h)}if(m||!p)c?To.insertTextNode(l,t,a,u,m):To.insertElement(l,t,m,u,y,i,E);else if(c||p.nodeType!==Node.ELEMENT_NODE||(l.tag||"div").toLowerCase()!==p.tagName.toLowerCase())if(c&&p.nodeType===Node.TEXT_NODE)p.data=l;else{var R,T;c?To.insertTextNode(l,t,a,u,p):To.insertElement(l,t,p,u,y,i,E),null===(R=(T=p).blur)||void 0===R||R.call(T),p.remove()}else{var M,k;const{lastDomConfig:e}=p,t=To.performSync(E,p);if(o&&null!=(null==e||null===(M=e.dataset)||void 0===M?void 0:M[o])){const t=e.dataset[o];delete D[t],delete S[t]}null!=i&&(y[i]=p),p.isReleased=!1,t&&(null===(k=a)||void 0===k||k({action:"reuseElement",domConfig:l,targetElement:p,lastDomConfig:e,syncId:i}))}}if(!(t.didSetTextContent&&1===C.length&&C[0].nodeType===Node.TEXT_NODE||s.retainChildren)){for(;r=w(!0);)u&&(r.$refOwnerId!==u.id||r.$reference)||(f||(f=[])).push(r);f&&To.syncChildrenCleanup(t,f,y,a,u,l,o)}}static syncChildrenCleanup(e,t,n,r,i,s,o){let a,l=0;for(const d of t){const{lastDomConfig:t}=d;var c;if(d.nodeType!==Element.TEXT_NODE)if(d.retainElement)o&&t&&(n[d.dataset[o]]=d);else if(!i&&o&&(null==s||l<s))d.isReleased||(d.className="b-released",d.isReleased=!0,null!=t&&t.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[o]]=d),null==r||r({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:d}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.class&&(t.class="b-released"),t.style&&(t.style=null))),l++;else null===(c=d.blur)||void 0===c||c.call(d),d.remove(),i&&(a=d.$reference,a&&i.detachRef(a,d,t)),e.releasedIdMap&&o&&null!=t&&t.dataset&&delete e.releasedIdMap[t.dataset[o]],null==r||r({action:"removeElement",domConfig:d.lastDomConfig,lastDomConfig:d.lastDomConfig,targetElement:d});else d.remove()}}static removeChild(e,t){if(e.contains(t)){const n=e.syncIdMap;if(n){const e=Object.values(n).indexOf(t);e>-1&&delete n[Object.keys(n)[e]]}e.removeChild(t)}}static addChild(e,t,n){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[n]=t}static getChild(e,t){const n=String(t).split(".");for(const t of n){var r,i;if(!(e=null===(r=e)||void 0===r||null===(i=r.syncIdMap)||void 0===i?void 0:i[t]))return null}return e}}To._$name="DomSync";class Mo{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let n=t+$.capitalize(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const n=["fullscreenchange","fullscreenerror"],r=e=>n.map((t=>e+$.capitalize(t)));this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return Boolean(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(null==e?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(){const e=this,{element:t}=e;if(t){if(!t.closest(".b-floatroot")){const n=Br.getRootElement(t),{floatRoot:r}=n;r&&(e._floatRoot=r,e._oldParent=r.parentElement,t.appendChild(r))}}else e._floatRoot&&e._oldParent.appendChild(e._floatRoot),e._oldParent=null,e._floatRoot=null}}Mo.init(),Mo._$name="Fullscreen";let ko=null;const Io=[],Ao=e=>{var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))};class Fo{static addResizeListener(e,t){const n=this;if(e!==document&&e!==r||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(r.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(r.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[r,i,s]=Br.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",n.onSizeMonitorScroll,!0),s.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[],n=[];for(const r of e)"childList"===r.type&&(t.push.apply(t,r.addedNodes),n.push.apply(n,r.removedNodes));const r=[...t.filter((e=>!n.includes(e))),...n.filter((e=>!t.includes(e)))];0!==r.length&&(r.length>0&&r.every(Ao)||i.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=r}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==r||(e=document.body);const n=e._bResizemonitor;let i=0;n&&n.handlers&&(H.remove(n.handlers,t),i=n.handlers.length),i||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,n=e._bResizemonitor,r=t.contentRect||e.getBoundingClientRect();if(Mr(e)&&(!n.rectangle||r.width!==n.rectangle.width||r.height!==n.rectangle.height)){const t=n.rectangle;n.rectangle=r;for(const i of n.handlers)i(e,t,r)}}}static onSizeMonitorScroll(e){var t;if(e.target.isConnected||null!==(t=document.body)&&void 0!==t&&t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,n=t.parentNode,r=n._bResizemonitor,i=n.getBoundingClientRect();r.rectangle&&i.width===r.rectangle.width&&i.height===r.rectangle.height||(Io.push([n,r.rectangle,i]),r.rectangle=i,ko||(ko=requestAnimationFrame(Fo.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();for(const e of n.handlers)e(t,r,n.rectangle)}static fireResizeEvents(){for(const e of Io)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);ko=null,Io.length=0}static removeGlobalListeners(){r.removeEventListener("resize",this.onWindowResize)}}Fo._$name="ResizeMonitor";const Po={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:o.supportsOverflowClip?"clip":"hidden"},Oo="b-widget-scroller",Lo={block:"nearest"},$o=Promise.resolve(),_o=e=>new Promise((t=>Zn.on({element:e===document.documentElement?r:e,scroll:t,once:!0}))),jo={x:1},Bo={auto:1,scroll:1},Vo={true:1,auto:1},Ho={overflowX:"auto",overflowY:"auto"};class No extends(mi(Ge(ye))){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null,propagateSync:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}syncOverflowState(){const e=this,{element:t}=e,{hasOverflowX:n,hasOverflowY:r}=e,i=e.hasOverflowX=t.scrollWidth>t.clientWidth,s=e.hasOverflowY=t.scrollHeight>t.clientHeight;if(n!==i||r!==s){const n=new Tn(t.classList,{"b-horizontal-overflow":i,"b-vertical-overflow":s});Br.syncClassList(t,n),e.isConfiguring||e.trigger("overflowChange",{x:i,y:s})}}hasOverflow(e="y"){const t=this,n=t[`overflow${e.toUpperCase()}`],r=t["overflow"+("y"===e?"x":"y")];if(!Br.scrollBarWidth||!Vo[n]||"hidden-scroll"===r){const n="y"===e?"Height":"Width";return t[`scroll${n}`]>t[`client${n}`]}return t[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:t}=this;if(t&&Br.scrollBarWidth){const n="y"===e,r=n?"Width":"Height",i=t[`client${r}`],s=parseInt(Br.getStyleValue(t,`border${n?"Left":"Top"}Width`))+parseInt(Br.getStyleValue(t,`border${n?"Right":"Bottom"}Width`)),o=t[`offset${r}`]-s-i;return Math.abs(o-Br.scrollBarWidth)<2}}addPartner(e,t=jo){const n=this;"string"==typeof t&&(t={[t]:1}),n.partners||(n.partners={}),n.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=n.x),t.y&&(e.y=n.y),e.isPartneredWith(n)||e.addPartner(n,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){e&&this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return Boolean(null===(t=this.partners)||void 0===t?void 0:t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach((e=>e.scroller.removePartner(this)))}async scrollIntoView(e,t=Lo){const n=this,{isRectangle:r}=e,i=r?e:wn.from(e),{xDelta:s,yDelta:o}=n.getDeltaTo(e,t),a=n.scrollBy(s,o,t);return(t.highlight||t.focus)&&a.then((()=>{var a;e=r?i.translate(-s,-o):(null===(a=t.elementAfterScroll)||void 0===a?void 0:a.call(t))??e,t.highlight&&(isNaN(t.highlight)?(n.widget||n).callback(t.highlight,null,[e]):Br.highlight(e,n)),t.focus&&Br.focusWithoutScrolling(e)})),a}static async scrollIntoView(e,t=Lo,n=!1){const r=wn.from(e),i="object"==typeof t?t.animate:t,s=No._globalScroller||(No._globalScroller=new No),o=[];s.rtlSource={rtl:n};let a,l=0,c=0;for(let n=e.parentNode;n.nodeType===Node.ELEMENT_NODE;n=n.parentNode){if(n===document.body&&n!==document.scrollingElement)continue;const e=n===document.scrollingElement?Ho:n.ownerDocument.defaultView.getComputedStyle(n);if(!1!==t.y&&Bo[e.overflowY]&&n.scrollHeight>n.clientHeight||!1!==t.x&&Bo[e.overflowX]&&n.scrollWidth>n.clientWidth){s.element=n,s.positionDirty=!0;const{xDelta:e,yDelta:i}=s.getDeltaTo(r,t);(e||i)&&(o.push({element:n,x:n.scrollLeft,y:n.scrollTop,xDelta:e,yDelta:i}),r.translate(-e,-i),l+=e,c+=i)}}if(o.length){const e=Math.abs(l),t=Math.abs(c);let r=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(r&&(e>10||t>10))Math.max(e,t)<50&&(r=Math.min(r,500)),a=s.scrollAnimation=Me.animate(r,(e=>{const t=1===e;for(const{element:r,x:i,y:a,xDelta:l,yDelta:c}of o)s.element=r,l&&(s.x=Math[n?"min":"max"](i+(t?l:Math.round(l*e)),0)),c&&(s.y=Math.max(a+(t?c:Math.round(c*e)),0))}),null,i.easing),a.then((()=>{s.scrollAnimation=null}));else{for(const{element:e,xDelta:t,yDelta:n}of o)e.scrollTop+=n,e.scrollLeft+=t;a=_o(o[o.length-1].element)}}else a=$o;return(t.highlight||t.focus)&&a.then((()=>{t.highlight&&(isNaN(t.highlight)?s.callback(t.highlight,null,[e]):Br.highlight(e,s)),t.focus&&e.focus()})),a}scrollBy(e=0,t=0,n=Lo){const r=this,i="object"==typeof n?n.animate:n,s=Math.abs(e),o=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:l,y:c}=r;let d=l,u=c;return Math.max(s,o)<50&&(a=Math.min(a,500)),r.scrollAnimation=Me.animate(a,(i=>{const s=1===i;if(e){var o;if(Math.abs(r.x-d)>1&&!n.force)return null===(o=r.scrollAnimation)||void 0===o?void 0:o.cancel();r.x=Math.max(l+(s?e:Math.round(e*i)),0)}if(t){var a;if(Math.abs(r.y-u)>1&&!n.force)return null===(a=r.scrollAnimation)||void 0===a?void 0:a.cancel();r.y=Math.max(c+(s?t:Math.round(t*i)),0)}d=r.x,u=r.y}),r,i.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then((()=>{r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)})),r.scrollAnimation}if(e||t){const n=r.x,i=r.y;if(Math.round(s)>=1&&(r.x+=e),Math.round(o)>=1&&(r.y+=t),r.x!==n||r.y!==i)return _o(r.element)}return $o}async scrollTo(e,t,n){const{x:r,y:i}=this,s=null==e?0:e-r,o=null==t?0:t-i;return this.scrollingToCenter=null==n?void 0:n.scrollingToCenter,this.scrollBy(s,o,n)}doDestroy(){var e;const t=this;var n;t._element&&(t._element.removeEventListener("scroll",t.scrollHandler),null===(n=t.wheelListenerRemover)||void 0===n||n.call(t));null===(e=t.scrollAnimation)||void 0===e||e.cancel(),Object.values(t.partners||{}).forEach((({scroller:e})=>e.removePartner(t))),super.doDestroy()}onElMutation(e){const t=this,[n,r]=Br.getTranslateXY(t.element);if(t._x!==-n||t.y!==-r){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onElResize(){const e=this,{widget:t}=e;null!=t&&t.isAnimating?-1===t.findListener("animationend","onElResize",e)&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const t=this,{_x:n,_y:r,element:i}=t;let s=0;"clip"===t.overflowX&&i.scrollLeft!==n&&(i.scrollLeft=n,++s),"clip"===t.overflowY&&i.scrollTop!==r&&(i.scrollTop=r,++s),2!==s&&(t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,i.classList.contains("b-scrolling")||i.classList.add("b-scrolling"),e.widget=t.widget,e.scrollingToCenter=t.scrollingToCenter,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.onScrollEnd(e)))}syncPartners(e,t=this.propagateSync){const n=this;n.partners&&Object.values(n.partners).forEach((({axes:r,scroller:i})=>{(i!==n.controllingPartner||e)&&i.sync(n,r)&&t&&i.syncPartners(e,t)}))}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.scrollingToCenter=!1,t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const n=this;if(!n.viewport)return{xDelta:0,yDelta:0};const{x:r,y:i,scrollWidth:s,scrollHeight:o,isRTL:a}=n,l=e instanceof wn?e:wn.from(e),c=t.block||"nearest",d=n.viewport,u=(e=>{let t,n,r,i;return e?"number"==typeof e?t=n=r=i=e:(t=e.top??0,n=e.bottom??0,r=e.start??0,i=e.end??0):t=n=r=i=0,{top:t,bottom:n,start:r,end:i}})(t.edgeOffset),h=d.width>=l.width+(u.start+u.end)?u:{start:0,end:0},g=d.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},m=new wn(a?d.right- -r-s:d.x-r,d.y-i,s,o),p=l.clone().adjust(-h.start,-g.top,h.end,g.bottom).constrainTo(m),f=p.clone(),v=n.isRTL?-1:1;let y=0,b=0;if("start"===c)f.moveTo(d.x+(n.isRTL?d.width-f.width:0),d.y),y=p.x-f.x,b=p.y-f.y;else if("end"===c)f.moveTo(d.x+(n.isRTL?0:d.width-f.width),d.bottom-f.height),y=p.x-f.x,b=p.y-f.y;else if("center"===c){const e=d.center;f.moveTo(e.x-f.width/2,e.y-f.height/2),y=y||p.x-f.x,b=b||p.y-f.y}else f.width>d.width?y=f.x-d.x:f.right>d.right?y=f.right-d.right:f.x<d.x&&(y=f.x-d.x),f.height>d.height?b=f.y-d.y:f.bottom>d.bottom?b=f.bottom-d.bottom:f.y<d.y&&(b=f.y-d.y);return y=v*Math.round(y),b=Math.round(b),!1!==t.constrainToScrollable&&(y=Math.max(Math.min(y,n.maxX-r),-r),b=Math.max(Math.min(b,n.maxY-i),-i)),{xDelta:!1===t.x?0:y,yDelta:!1===t.y?0:b}}get viewport(){return wn.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){const n=this;if(n===No._globalScroller)return n._element=e,void(n.positionDirty=!0);const r=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n)),i=n.resizeHandler||(n.resizeHandler=n.onElResize.bind(n));if(t){var s;if(n.translate)null===(s=n.mutationObserver)||void 0===s||s.disconnect();else t.removeEventListener("scroll",r),t.classList.remove(Oo),t.style.overflowX=t.style.overflowY="";Fo.removeResizeListener(t,i)}if(e){if(n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver(n.mutationHandler||(n.mutationHandler=n.onElMutation.bind(n)))),n._x=n._y=0,document.contains(e)){const[t,r]=Br.getTranslateXY(e);n._x=-t,n._y=-r}n.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",r),e.classList.add(Oo);Fo.addResizeListener(e,i),n.widget||(n.rtlSource={get rtl(){return"rtl"===Br.getStyleValue(e,"direction")}}),n.isRTL&&e.classList.add("b-rtl"),n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.syncOverflowState(),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y))}n.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=Br.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=Math.abs(t.scrollLeft),e._y=t.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.x*(this.isRTL?-1:1)}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e="string"==typeof e?this.element.querySelector(e):e,Fo.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const n=this,{element:r}=n;!r||null!==(t=n.widget)&&void 0!==t&&t.isConfiguring||(e=Math.round(e),n.trigger("scrollStart",{x:e}),n.translate?Br.setTranslateX(r,-e):r.scrollLeft=n.isRTL?-e:e),n.positionDirty=!0}sync(e,t){const n=this,{x:r,y:i}=t;let s=!1;return null!=r&&n.x!==e.x&&(n.controllingPartner=e,n.x=e.x,s=!0),null!=i&&n.y!==e.y&&(n.controllingPartner=e,n.y=e.y,s=!0),s}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=Br.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:n}=this;!t||null!=n&&n.isConfiguring||(this.trigger("scrollStart",{y:e}),this.translate?Br.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;if("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){Bo[s.overflowY]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")}i||(s.overflowX=Po[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}updateOverflowY(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;if("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){Bo[s.overflowX]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")}i||(s.overflowY=Po[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=Zn.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&"hidden-scroll"===this.overflowX?this.x+=e.deltaX:"hidden-scroll"===this.overflowY&&(this.y+=e.deltaY)}get scrollWidth(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollWidth)??0}set scrollWidth(e){const t=this,{element:n,isRTL:r}=t;let i=t.widthStretcher;i&&null==e?(i.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),i||(i=t.widthStretcher=Br.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),i.style.transform=`translateX(${(e-1)*(r?-1:1)}px)`,n&&!n.contains(i)&&n.insertBefore(i,n.firstElementChild)),!1!==t.propagate&&t.eachPartner((({scroller:t})=>{t.propagate=!1,t.scrollWidth=e,delete t.propagate})),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollHeight)??0}set scrollHeight(e){const t=this,n=t.stretcher||(t.stretcher=Br.createElement({className:"b-scroller-stretcher"}));n.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientWidth)||0}get clientHeight(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=vs.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}}No._$name="Scroller";class zo{constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}}zo._$name="Promissory";const{defineProperty:Wo}=Reflect;class Uo extends(ye.mixin(rt,Ge,mi,ki)){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let n,r,s=t.renderConfigs;if(s===i){for(r in s=null,n=t.configs,n)n[r].render&&(s||(s=new Set)).add(r);t.renderConfigs=e.prototype.$renderConfigs=s}return s}construct(...e){this.$iid=++Uo.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Uo.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){const n=this;return t&&t.remove(),e&&(e.id=n.id,e=Br.createElement(e,{refOwner:n})),e}updateId(e,t){const n=this;if(t){const r=n.element;r.id=e,n.fixRefOwnerId(r,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;const r=e.$reference;r&&(e.id=`${t}-${r}`);for(const r of e.childNodes)this.fixRefOwnerId(r,t,n)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,n){const r=this,i="_"+e,{listeners:s}=n;i in r||Wo(r,e,{get:()=>(r.refreshDom.flush(),r[i]),set(e){r[i]=e}}),t.id=`${r.id}-${e}`,r.byRef[e]=t,r[e]=t,s&&(n.listeners={on:s,un:Zn.on(Object.assign({element:t,thisObj:r},s))})}detachRef(e,t,n){n.listeners&&(n.listeners.un(),n.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,n=e.constructor;let r=t.renderConfigs||n.renderConfigs,i=e;if(!r){i=Object.create(e),r=new Set;for(const n in t.configs)Wo(i,n,{get:()=>(r.add(n),e[n])});i.renderDom=()=>e.renderDom.call(i),e.$renderConfigs=r}return Wo(e,"renderContext",{value:i}),i}refreshDom(){To.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){"draw"===e&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find((e=>e.classList.contains("b-drawable")));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=new IntersectionObserver((t=>{e.isDestroyed||t.forEach((t=>{t.isIntersecting&&e.onDraw({count:++e.drawCounter})}))})),e.intersector.observe(t)}}onDraw(e){this.trigger("draw",e)}}Uo.$idSeed=0,Object.assign(Uo.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Uo._$name="Renderable";class Go extends Uo{static $name="Mask";static type="mask";static configurable={autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1};static delayable={deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}};static counter=0;static masks=[];construct(e){if(e){let t,n=e.element;n&&(_.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=t=Object.assign({},e),delete t.element,t.target=n),n=e.target,"string"==typeof n&&(e=t=t||Object.assign({},e),t.target=e.owner[n])}super.construct(e);const t=this,{type:n}=t;t.target||(t.target=document.body),t.maskName=`mask${"string"==typeof n?n.trim():""}-${Go.counter++}`,t.show()}doDestroy(){const e=this,{element:t}=e;if("trial"===e.type)return!1;t&&(e.element=null,e.mode.endsWith("blur")&&Br.forEachChild(t,(t=>{t.classList.remove(`b-masked-${e.mode}`)})),e.target.classList.remove("b-masked"),e.target[e.maskName]=null,H.remove(Go.masks,e)),super.doDestroy()}get maskElement(){return this.element}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/t*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const n of e)"string"==typeof n?t.text=n:Xt.assign(t,n);return t}static mask(e,t=document.body){return Go.new({target:t},"string"!=typeof e?{...e}:{text:e})}static unmask(e=document.body){const t=this.getElementMasks(e);return t.length>0?t[t.length-1].close():null}static unmaskAll(e=document.body){return this.getElementMasks(e).forEach((e=>e.close()))}static getElementMasks(e){return this.masks.filter((t=>t.target===e))}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;null===(e=this.owner)||void 0===e||null===(t=e.syncMaskCover)||void 0===t||t.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),null==e||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}deferredClose(){var e;const{owner:t}=this;this.close().then((()=>{var e;null==t||null===(e=t.onMaskAutoClose)||void 0===e||e.call(t,this)})),null==t||null===(e=t.onMaskAutoClosing)||void 0===e||e.call(t,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:n,hiding:r,maskName:i}=e;r&&(r.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),n.classList.add("b-masked"),n[i]||(n[i]=e,n.appendChild(t)),H.include(Go.masks,e),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&Br.forEachChild(n,(n=>{n!==t&&n.classList.add(`b-masked-${e.mode}`)}))}hide(){const e=this,{target:t,element:n}=e;let{hiding:r}=e;if(!r){if(!e.shown)return Promise.resolve();e.hiding=r=new zo,e.shown=!1,n.classList.remove("b-visible"),n.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&Br.forEachChild(t,(t=>{t!==n&&t.classList.remove(`b-masked-${e.mode}`)})),r.promise=r.promise.then((()=>{e.hiding===r&&(e.hiding=null)})),e.setTimeout((()=>r.resolve()),500,"hide")}return r.promise}async close(){await this.hide(),this.destroy()}}Go._$name="Mask";var Yo=e=>class extends(e||ye){static $name="KeyMap";get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}static configurable={keyMap:{value:null,$config:{merge:"objects",nullify:!0}}};matchKeyMapEntry(e,t=this.keyMap){if(t&&!e.handled&&e.key!==i)return Xt.keys(t).find((t=>{const n=t.split("+"),r=n.includes("Alt"),i=n.includes("Shift"),s=n.includes("Ctrl");let o=n[n.length-1].toLowerCase();return"space"===o&&(o=" "),o===e.key.toLowerCase()&&(!e.altKey&&!r||e.altKey&&r)&&(!e.ctrlKey&&!s||e.ctrlKey&&s)&&(!e.shiftKey&&!i||e.shiftKey&&i)}))}performKeyMapAction(e){const{keyMap:t}=this;let n=!1;if(t&&!e.handled&&e.key!==i){const i=this.matchKeyMapEntry(e);if(t[i]){const s=H.asArray(t[i]);let o;e.fromKeyMap=!0;for(let t of s){if(o=!0,Xt.isObject(t)){if(!t.handler)continue;!1===t.preventDefault&&(o=!1),t=t.handler}if("string"==typeof t){var r;const{thisObj:s,handler:o}=this.resolveKeyMapAction(t);if(!1!==(null===(r=s.isActionAvailable)||void 0===r?void 0:r.call(s,{key:i,action:t,event:e,actionName:t.split(".").pop()}))&&!1!==o.call(s,e)){n=!0;break}}else if(!1!==t.call(this)){n=!0;break}}delete e.fromKeyMap,n&&(o&&e.preventDefault(),e.handled=!0)}}return n}resolveKeyMapAction(e){const{keyMapSubComponents:t}=this;if(e.startsWith("up.")||e.startsWith("this."))return this.resolveCallback(e);if(t&&e.includes(".")){const[n,r]=e.split(".");if(n&&r)return{thisObj:t[n],handler:t[n][r]}}return{thisObj:this,handler:this[e]}}updateKeyMap(e){var t;null===(t=this.keyMapDetacher)||void 0===t||t.call(this),Xt.isEmpty(e)||(this.keyMapDetacher=Zn.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(e){this.performKeyMapAction(e)}mergeKeyMaps(e,t,n=null){const r={};e&&Xt.assign(r,e);for(const i in t){if(!t[i])continue;const s=H.asArray(null==e?void 0:e[i]),o=[];if(null!=s&&s.length&&o.push(...s),null==s||!s.some((e=>{const t=e.handler?e.handler:e;return"string"==typeof t&&t.startsWith(n+".")}))){for(const e of H.asArray(t[i]))Xt.isObject(e)&&e.handler?o.push(Xt.assignIf({handler:(n?n+".":"")+e.handler},e)):"function"==typeof e?o.push(e):o.push((n?n+".":"")+e);o.sort(((e,t)=>{const n=(e.weight||0)-(t.weight||0);return 0===n&&null!=s&&s.length?s.indexOf(e)-s.indexOf(t):n}))}r[i]=o}return r}},qo=e=>class extends(e||ye){static $name="RTL";get widgetClass(){}static configurable={rtl:null};get isRTL(){return this.rtl}updateRtl(e){const{element:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}startConfigure(e){var t;if(null===(t=super.startConfigure)||void 0===t||t.call(this,arguments),!e.floating&&null==e.rtl){var n;const t=this,r=e.rootElement||e.forElement||(null===(n=t.parent)||void 0===n?void 0:n.contentElement)||(t.floating?t.floatRoot:t.changeElementRef(t.getRenderContext(e)[0]||e.adopt||document.body)),i=e.owner||e.parent||t.constructor.fromElement(r);e.rtl=i?i[i.isConfiguring?"peekConfig":"getConfig"]("rtl"):1===(null==r?void 0:r.nodeType)&&"rtl"===getComputedStyle(r).getPropertyValue("direction"),e.rtl&&(t.configDone.rtl=!1)}}render(...e){var t,n;(super.render&&super.render(...e),(o.isChrome&&o.chromeVersion<87||o.isFirefox&&o.firefoxVersion<66||o.isSafari&&o.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),"rtl"===getComputedStyle(this.element).direction||null!==(t=this.owner)&&void 0!==t&&t.rtl)&&(this.rtl=!0,null===(n=this.childItems)||void 0===n||n.forEach((e=>e.rtl=!0)))}};const Ko=Object.freeze({highlight:!1,onlyName:!1}),Xo=[],Zo="highlightExternalChange",Jo=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Qo=Symbol("renderConfigObserver"),ea={INPUT:1,TEXTAREA:1},ta=(e,t,n,r)=>{var i;let s=(null==n?void 0:n.listeners)||(null==n?void 0:n.internalListeners);if(s=(null===(i=s)||void 0===i?void 0:i.on)||s,s){const i=Zn.on(Xt.assign({element:t,thisObj:e},s));r?(e._refListeners||(e._refListeners=Object.create(null)))[r]=i:n.listeners={on:s,un:i}}},na=(e,t)=>e&&t&&t[Xt.keys(e)[0]]?Q.merge(e,t):e,ra=e=>{e.isVisible&&e.triggerPaint()},ia=/^:not\((.+)\)$/,sa=/absolute|fixed/i,oa=e=>null!=e.scale,{hasOwn:aa}=Xt,{defineProperty:la}=Reflect,ca=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),da=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],ua={configurable:!0,get:()=>!1},ha=/(?:L\{([^}.]+)\})/,ga=(e,t)=>"L{Tooltip."+t+"}",ma=/^([trblc])(\d*)-([trblc])(\d*)$/i,pa=(e,t)=>(ma.test(e)&&(e={align:e}),ma.test(t)&&(t={align:t}),Q.merge(e,t)),fa=/^[\w.]+$/,va={1:"maxHeight",2:"height",4:"maxWidth",8:"width"},ya=e=>!e.isRipple&&!e.closest((e=>e.isMessageDialog||e.isSharedTooltip));class ba extends(ye.mixin(rt,Ge,mi,ki,Ni,Yo,qo)){static mergeCls(e,t){return t&&e?e=new Tn(t).assign("string"==typeof e?new Tn(e):e):e&&!e.isDomClassList&&(e=new Tn(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:pa},value:"t-b"},centered:null,constrainTo:i,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:na},value:null},showAnimation:{$config:{merge:na},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:No,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50},maximizeOnMobile:null}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return ba._recomposeAsync}static set recomposeAsync(e){if(ba._recomposeAsync=e,null!=e){const{all:t}=ba;for(let n=0;n<t.length;++n)t[n].isComposable&&(t[n].recomposeAsync=e)}}isType(e,t){return ba.isType(this,e,t)}static setupRenderConfigs(e,t){const n=t.getInherited("renderConfigs"),{renderConfigs:r}=e;if(r){if(Array.isArray(r))for(const e of r)n[e]=!0;else Xt.assign(n,r);n[Qo]=null}}construct(e={},...t){const n=this,{domSyncCallback:i}=n;if(!r.bryntum.cssVersion){const e=r.bryntum.cssVersion=go.getCSSVersion(),t=_.getVersion("core");e&&e!==t&&console.warn(`CSS version ${e} doesn't match bundle version ${t}!\nMake sure you have imported css from the appropriate product version.`)}n.configureAriaDescription=e.ariaDescription,n._isAnimatingCounter=0,n.alignmentChanges=0,n.byRef=Object.create(null),n.onTargetResize=n.onTargetResize.bind(n),n.onFullscreenChange=n.onFullscreenChange.bind(n),n.domSyncCallback=i.$nullFn?null:i.bind(n),n._isUserAction=!1,super.construct(e,...t);const{recomposeAsync:s}=ba;null!=s&&null==n.recomposeAsync&&(n.recomposeAsync=s),n.finalizeInit()}startConfigure(e){super.startConfigure(e);const t=this,{adopt:n,element:r}=t;n&&(t.adoptElement(r,n,e.id),t.updateElement(t._element,r))}finalizeInit(){const e=this,t=e.insertBefore||e.appendTo||e.insertFirst||e.adopt;var n;t&&(e.owner||null!==(n=t.nodeType?t:document.getElementById(t))&&void 0!==n&&n.isConnected?e.render():(e.onFirstResizeAfterConnect=e.onFirstResizeAfterConnect.bind(e),Fo.addResizeListener(t,e.onFirstResizeAfterConnect)))}onFirstResizeAfterConnect(e){Fo.removeResizeListener(e,this.onFirstResizeAfterConnect),this.isDestroyed||this.rendered||this.render()}doDestroy(){var e;const t=this,{preExistingElements:n,element:r,adopt:i,_refListeners:s,_rootElement:o,eventRoot:a}=t;if(Mo.element===r&&Mo.exit(),s&&(Object.values(s,(e=>e())),t._refListeners=null),r){var l,c,d;const e=!t._tooltip&&o&&(null===(l=ba.Tooltip)||void 0===l?void 0:l.getSharedTooltip(o,a,!0));if((null==e?void 0:e.owner)===t&&(e.owner=null,e.hide()),t.onExitFullscreen(),t.clearTimeout(t.scrollListenerTimeout),t.clearTimeout(t.resizeListenerTimeout),t.removeTransientListeners(),t.floating||t.positioned?t.hide(!1):t.revertFocus(),Fo.removeResizeListener(r.parentElement,t.onParentElementResize),Fo.removeResizeListener(r,t.onElementResize),i){for(let e=Array.from(r.childNodes),i=0,{length:s}=e;i<s;i++){const r=e[i];n.includes(r)||r===t.floatRoot||r.remove()}r.className=t.adoptedElementClassName,r.style.cssText=t.adoptedElementCssText}null===(c=t.dragEventDetacher)||void 0===c||c.call(t),null===(d=t.dragOverEventDetacher)||void 0===d||d.call(t),t.dragGhost.remove()}null===(e=t.connectedObserver)||void 0===e||e.disconnect(),super.doDestroy(),a&&!Object.values(ba.identifiable.idMap).some(ya)&&An.detachFocusListeners(a),i||r.remove()}get assignValueDefaults(){return Ko}get valueName(){return this.name||this.ref||this.id}getValueName(e){return(e=e&&"object"==typeof e?e.onlyName:e)?this.name:this.valueName}assignFieldValue(e,t,n){const r=this,i=r.defaultBindProperty;i in r&&(r[i]=n)}assignValue(e,t=Ko){const n=this,r=n[Zo],i=n.getValueName(t);!i||e&&!(i in e)||(!1===t.highlight&&(n[Zo]=!1),n.assignFieldValue(e,i,e?e[i]:null),n[Zo]=r)}gatherValue(e){const t=this,n=t.defaultBindProperty;t.constructor!==ba&&n in t&&(e[t.name||t.ref||t.id]=t[n])}gatherValues(e){this.eachWidget((t=>t.gatherValue(e)),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&Xt.getTruthyKeys(e)}configureOverflowTwin(e){var t;const n=this;let r=Xt.clone(n.initialConfig);return delete r.id,r.hidden=!1,r.type=n.type,r._overflowTwinOrigin=n,r.disabled=n.disabled,"value"in n&&(r.value=n.value),null===(t=n.forwardTwinEvents)||void 0===t||t.forEach((e=>{delete r[`on${$.capitalize(e)}`]})),e&&(r="function"==typeof e?e(r)||r:Xt.assign(r,e)),r}createOverflowTwin(e){var t;const n=this,r=n.configureOverflowTwin(e),i=ba.create(r);return null===(t=n.forwardTwinEvents)||void 0===t||t.forEach((e=>{i.ion({[e]:e=>{n.overflowTwin===e.source&&(delete(e=Xt.assign({},e)).source,n.trigger(e.eventName,e))}})})),i}ensureOverflowTwin(e,t){let{overflowTwin:n}=this;return n||(this.overflowTwin=n=this.createOverflowTwin(e),null==t||t(n)),n}get isComposable(){return!this.compose.$nullFn}adoptElement(e,t,n){const r=this,i="string"==typeof t?document.getElementById(t):t,s=ba.fromElement(i);if(s&&s.adopt&&s!==r){("string"==typeof s.adopt?document.getElementById(s.adopt):s.adopt)===i&&s.destroy()}r.preExistingElements=Array.from(i.childNodes),r.adoptedElementClassName=i.className,r.adoptedElementCssText=i.style.cssText,i.id&&!n&&(r.id=e.id=i.id),Br.syncAttributes(e,i);for(let t=0,{length:n}=e.childNodes;t<n;t++)i.appendChild(e.childNodes[0]);delete r._contentRange,r._element=i;const o=e.lastDomConfig,a=null==o?void 0:o.listeners;var l;a&&r.isComposable&&(null===(l=a.un)||void 0===l||l.call(a),ta(r,i,o));i.lastDomConfig=o||i.lastDomConfig,i.$refOwnerId=r.id,r.scaleToFitWidth||r.getConfig("monitorResize")}addRefAccessor(e,t){const{prototype:n}=this.constructor;la(n,t,{writable:!0,value:null}),la(n,e,{get(){return this.recompose.flush(),this[t]},set(e){this[t]=e}})}attachRef(e,t,n){const r=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(i in r||r.addRefAccessor(e,i),ta(r,t,n,e)),r.byRef[e]=t,r[e]=t}detachRef(e,t,n){const r=this,i=r._refListeners;null!=i&&i[e]&&(i[e](),delete i[e]),r[e]=null,delete r.byRef[e]}afterRecompose(){}compose(){return{class:Tn.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:t}=e,n=t.hierarchy,r=t.renderConfigs||t.getInherited("renderConfigs");let i,s,o,a,{composers:l}=t,c=null;if(e.recompose.suspend(),!l){for(t.composers=l=[],o=n.indexOf(ba);o<n.length;++o)a=n[o].prototype,aa(a,"compose")&&l.push(a);aa(r,Qo)||(r[Qo]={get(e){r[e]=!0}})}for(e.configObserver=r[Qo],o=0;o<l.length;++o)i=l[o].compose.call(e,c),c=c?Br.merge(c,i):i;return aa(e,"compose")&&(i=e.compose)&&(i=i.call(e,c),Br.merge(c,i)),e.configObserver=null,Br.normalizeChildren(c,((t,n)=>{n&&(s="_"+t,s in e||e.addRefAccessor(t,s))}))}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,n=t.isComposable;return n&&(e=t.doCompose()),"string"==typeof e?e=Br.createElementFromTemplate(e):Xt.isObject(e)?(e=Br.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume(),n&&ta(t,e,e.lastDomConfig)):Br.isReactElement(t.peekConfig("html"))?e=document.createElement("div"):1!==e.nodeType&&(e=Br.createElementFromTemplate(t.template(t))),e.id=t.id,t.elementAttributes&&Br.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,{className:n}=e,{contentElement:r,contentElementCls:i,isComposable:s}=t,o=r!==e,a=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:t.widgetClassList;let c=(o||!s)&&t.uiClasses;if(n&&l.unshift(n),t._hidden&&l.push("b-hidden"),t._readOnly&&l.push("b-readonly"),Me.noThrow(e,"remove"),c?(null!=i&&i.value&&(c=c.slice(),c.push(i.value)),c=c.join(" ")):c=null==i?void 0:i.value,c&&(o?r.className+=" "+c:l.push(c)),!t.parent){const{defaultCls:e}=t,{outerCls:n}=ba;l.push(...e?n.filter((t=>!(t in e)||e[t])):n)}if(e.className=l.join(" "),a)for(let e,n=0;n<a.length;++n)e=a[n],t.attachRef(e.getAttribute("data-reference"),e),e.removeAttribute("data-reference");t.adopt||t.scaleToFitWidth||t.getConfig("monitorResize"),t.getConfig("role"),t.getConfig("ariaLabel"),t.getConfig("ariaDescription"),t._html&&t.getConfig("htmlMutationObserver"),t.trigger("elementCreated",{element:e})}updateAriaDescription(e){const{ariaElement:t}=this,n=`${this.id}-aria-desc-el`;if(e){const r=this._ariaDescEl||(this._ariaDescEl=Br.createElement({className:"b-aria-desc-element",id:n,parent:t}));r.innerText=e.match(ha)?this.L(e,this):e,t.setAttribute("aria-describedBy",r.id)}else t.getAttribute("aria-describedby")===n&&t.removeAttribute("aria-describedBy")}updateAriaLabel(e){Br.setAttributes(this.ariaElement,{"aria-label":null!=e&&e.match(ha)?this.L(e,this):e})}updateAriaHasPopup(e){Br.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("role",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("role")}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:Xt.getPath(this,e)}isCollapsified({collapsed:e,alt:t}){const{collapsify:n}=this,r=null==n;return t?"overlay"===n||r&&e:!1===n||"hide"===n||r&&!e}async recompose(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await Br.transition(Xt.assign({element:e.element,action(){To.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else To.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.resumeRecompose()}resumeRecompose(){this.recompose.resume()}changeElementRef(e){if("string"==typeof e){const t=e;if(!(e=document.getElementById(t)))throw new Error(`No element found with id '${t}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let n=t||e.appendTo,{insertFirst:r,insertBefore:s}=e;return r&&(n=r,s=n.firstChild),s&&(n||(n=s.parentElement)),[n,s||i]}render(e,t=!0){const n=this,{element:r}=n,[i,s]=n.getRenderContext(n,e);n.emptyCache(),n.syncElement&&n.currentElement?Br.sync(r,n.currentElement):(null==i||i.insertBefore(r,s),n.currentElement=r),ba.fromElement(r.parentElement)&&r.classList.remove(...ba.outerCls),super.render(i,t),n.rendered=!0,n.getConfig("role"),t&&(n.getConfig("contentRange"),n.triggerPaint()),n.setupFocusListeners()}template({tag:e,html:t,htmlCls:n,name:r}){var i;const s=this;"string"==typeof t&&fa.test(t)&&s.resolveCallback(t,s,!1)&&(t=s.callback(t,s,[s]));const o=null!==(i=t)&&void 0!==i&&i.call?t.call(s,s):t;return`<${e} class="${o?n:""}" ${r?`data-name="${r}"`:""}>${o||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&null!==(t=this.$meta.renderConfigs)&&void 0!==t&&t[e]&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return"style"===e?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return(null==e?void 0:e.depth)>0&&(t.type=this.type),t}get dataset(){return this.element.dataset}changeDataset(e){Xt.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=Br.createElement({html:" ",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...ba.outerCls)}get constrainTo(){var e;let t=this._constrainTo;if(t=t===i?r:(null===(e=t)||void 0===e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host||t.ownerDocument:t,this.positioned){const{offsetParent:e}=this.element;if(e&&"hidden"===Br.getStyleValue(e,"overflow"))t=wn.from(e).moveTo(0,0);else if(t&&!t.isRectangle){const n=t===document||t===r;t=wn.from(t,e),n&&t.translate(r.pageXOffset,r.pageYOffset)}}return t}updateCentered(e){const{element:t,_anchorElement:n}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top="",null==n||n.classList.add("b-hide-display"),t.classList.remove("b-anchored")):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,n=e._contentRange||(e._contentRange=new Range);return n.collapsed&&(n.setStart(t,e.contentRangeStartOffset||0),n.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),n}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;for(let{childNodes:r}=e,i=r.length;i-- >0;)this.fixRefOwnerId(r[i],t,n)}}get placement(){const{element:e}=this;let t,n,r;if(null!=e&&e.offsetParent&&!sa.test(Br.getStyleValue(e,"position"))){const s=e.nextElementSibling,o=e.previousElementSibling,a=!s&&o;var i;if(n=Br.getStyleValue(e.parentElement,"flex-direction"),n)n=n.startsWith("row")?"h":"v";else t=null===(i=s||o)||void 0===i?void 0:i.getBoundingClientRect(),r=t&&e.getBoundingClientRect(),n=t&&Math.abs(t.top-r.top)<Math.abs(t.left-r.left)?"h":"v";n+="h"===n?a?"r":"l":a?"b":"t"}return n}updateId(e,t){if(super.updateId(e,t),t){const{byRef:n,element:r}=this;for(const t in n)n[t].dataset&&(n[t].dataset.ownerCmp=e);r.id=e,this.fixRefOwnerId(r,e,t)}}get style(){const{element:e}=this;return(null==e?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&Br.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t,n;const i=this,{lastAlignSpec:s,element:a}=i,{offsetParent:l,style:c,classList:d}=a;if(s&&(s.monitorIntersection&&i.intersectionObserver.unobserve(s.target),isFinite(s.zone)&&a.classList.remove(da[s.zone])),!e)return i.removeTransientListeners(),void(i.anchor=i.lastAlignSpec=null);i.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||"Point"===e.$$name)&&(e={target:e}),i.releaseSizeConstraints();const{scrollable:u,constrainTo:h}=i,g=Br.measureSize(Br.getStyleValue(a,"minHeight"),a),m=Br.measureSize(Br.getStyleValue(a,"minWidth"),a),p=i.positioned&&"fixed"!==Br.getStyleValue(a,"position"),f=i.scale||1,v=e.target,y=e.domEvent||e.event||v,b=null!=v&&v.isRectangle?v:(null==v?void 0:v.element)||v,C=(null==b?void 0:b.nodeType)===Element.ELEMENT_NODE,S=(null==y||null===(t=y.target)||void 0===t?void 0:t.nodeType)===Element.ELEMENT_NODE,D=(e=e.realignTarget?e:Xt.assign({aligningToEvent:S,aligningToElement:C,constrainTo:h,align:"b-t",axisLock:i.axisLock,anchor:i.anchor},i.align,e)).minWidth||m,w=e.minHeight||g;if(i.lastAlignSpec=e,S)delete e.target,e.domEvent=y,e.anchoredTo=y.target,e.position=new En(y.clientX+1,y.clientY+1);else if(C&&(e.target=b,Mr(b instanceof SVGElement?b.closest("svg"):b))){if((e=Object.setPrototypeOf({},e)).target=i.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?wn.from(b,p?l:null,!p):Br.isInView(b,!1,i)),!e.target){const e=i.hide();return i.isDestroyed||(i.lastAlignSpec.targetOutOfView=!0),e}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),i.lastAlignSpec.anchoredTo=b}e.anchor&&(e.anchorSize=i.anchorSize,a.contains(i.anchorPathElement)||a.appendChild(i.anchorElement)),i.isAligning=!0,i.trigger("beforeAlign",e);const E=wn.from(a,p?l:null,!0),{width:x,height:R}=E;E.isAlignRectangle=!0,D&&(E.minWidth=D*f),w&&(E.minHeight=w*f),i.isAligning=!1,e.rtl=i.rtl,(e.align.includes("s")||e.align.includes("e"))&&(i.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const T=i.lastAlignSpec.result=E.alignTo(e);let{align:M,anchor:k,x:I,y:A,width:F,height:P,overlap:O}=T;if(i.lastAlignSpec.zone=T.zone,P!=R){const e=P<R;i.alignmentChanges=i.alignmentChanges|(e?1:2),c[i.alignedHeightStyle=va[3&i.alignmentChanges]]=P/f+"px",e&&!i._minHeight&&g&&(c.minHeight=Math.min(P,g)/f+"px"),u&&(u.overflowY=e)}if(F!=x){const e=F<x;i.alignmentChanges=i.alignmentChanges|(e?4:8),c[i.alignedWidthStyle=va[12&i.alignmentChanges]]=F/f+"px",e&&!i._minWidth&&m&&(c.minWidth=Math.min(F,m)/f+"px"),u&&(u.overflowX=e)}if(M&&i.alignmentChanges){const t=wn.from(a,p?l:null,!0);e.align=M;const n=i.lastAlignSpec.result=t.alignTo(e);k=n.anchor,I=n.x,A=n.y,F=n.width,P=n.height}if(i.centered||i.setXY(I,A),!T.overlap&&isFinite(T.zone)&&d.add(da[T.zone]),null!==(n=k)&&void 0!==n&&n.edge){var L;const{edge:e}=k,{anchorElement:t}=i,{style:n}=t,r=wn.from(a),s=[];"top"===e||"bottom"===e?(s[0]=k.x,s[1]="top"===e?1:r.height-1):(s[0]="left"===e?1:r.width-1,s[1]=k.y),n.display="none";let o=Br.childFromPoint(a,...s);if((null!==(L=o)&&void 0!==L&&L.matches(":focus")||o===An.currentOverElement)&&a.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(o=o.parentNode),o&&o!==document){let e=Br.getStyleValue(o,"background-color");for(;e.match(Jo)&&"absolute"!==Br.getStyleValue(o,"position")&&(o=o.parentNode,o!==document);)e=Br.getStyleValue(o,"background-color");e.match(Jo)?i.anchorPathElement.setAttribute("fill",i.defaultAnchorBackgroundColor):i.anchorPathElement.setAttribute("fill",e)}n.transform=n.display="",t.className=`b-anchor b-anchor-${e}`,k.x&&(k.x/=f),k.y&&(k.y/=f),Br.setTranslateXY(t,k.x,k.y),d.add("b-anchored")}else i._anchorElement&&(i.anchorElement.classList.add("b-hide-display"),d.remove("b-anchored"));if(!C){c.pointerEvents="none";const e=Br.elementFromPoint(I,A);i.owns(e)||(i.lastAlignSpec.anchoredTo=e),c.pointerEvents=""}if(("realign"===i.scrollAction&&C||"hide"===i.scrollAction)&&!i.documentScrollListener){if(i.clearTimeout(i.scrollListenerTimeout),e.monitorTargetMutation&&!i.targetObserver){(i.targetObserver||(i.targetObserver=new MutationObserver(i.onTargetParentMutation.bind(i)))).observe(Br.getRootElement(b),{childList:!0,attributes:!0,subtree:!0})}i.scrollListenerTimeout=i.setTimeout((()=>{var e,t;const n=null===(e=(t=C?b:i.lastAlignSpec.anchoredTo).getRootNode)||void 0===e?void 0:e.call(t);i.documentScrollListener=Zn.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:i}),null!=n&&n.mode&&(i.targetRootScrollListener=Zn.addListener(n,"scroll","doHideOrRealign",{capture:!0,thisObj:i}))}),"hide"===i.scrollAction?i.ignoreScrollDuration:0)}if(C&&(e.monitorResize&&!i.targetResizeListener&&(Fo.addResizeListener(b,i.onTargetResize),i.targetResizeListener=!0),e.monitorIntersection&&!(O||b.contains(a)||b.ownerSVGElement)&&i.intersectionObserver.observe(b)),!o.isAndroid&&!i.constrainListeners){const e=null!=h&&h.isRectangle?r:h;i.clearTimeout(i.resizeListenerTimeout),i.resizeListenerTimeout=i.setTimeout((()=>{i.constrainListeners=!0,Fo.addResizeListener(e||r,i.onAlignConstraintChange)}),i.ignoreScrollDuration)}}onTargetParentMutation(e){const{element:t,lastAlignSpec:n}=this;var r;null!=n&&n.aligningToElement&&(null!==(r=n.target)&&void 0!==r&&r.isConnected?e.some((({target:e})=>e.contains(n.target)&&!t.contains(e)))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:o.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:n}=e.targetRect,{width:r,height:i}=e.target.getBoundingClientRect();r===t&&i===n||this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,t,{height:n}){const{style:r}=this.contentElement,{overflowY:i}=r;this.setTimeout(this.realign,50),t&&n>t.height&&(r.overflowY="hidden",this.requestAnimationFrame((()=>r.overflowY=i)))}realign(){const e=this,{lastAlignSpec:t}=e;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){const n=t.target.contains(this.element),r=Br.isInView(t.target,!1,e);if(!(t.allowTargetOut||Mr(t.target)&&r))return e.hide(),void(e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0));t.realignTarget=n?null:r}Br.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(t)}}rectangle(e,t,n){return this.rectangleOf("element",e,t,n)}rectangleOf(e,t,n,r){var s;return"string"!=typeof t?(r=n,n=t,t=""):"border"===t&&(t=""),"boolean"==typeof n&&(r=n,n=i),"element"!==e&&n===i&&(n=this.element),n=null!==(s=n)&&void 0!==s&&s.isWidget?n.element:n,wn[t||"from"](this[e],n,r)}releaseSizeConstraints(){const e=this,{scrollable:t,element:n,alignmentChanges:r}=e,{style:i}=n;12&r&&(Br.setLength(n,e.alignedWidthStyle,e[`_last${$.capitalize(e.alignedWidthStyle)}`]||""),i.minWidth=e._minWidth||"",t&&(t.overflowY=t.config.overflowY)),3&r&&(Br.setLength(n,e.alignedHeightStyle,e[`_last${$.capitalize(e.alignedHeightStyle)}`]||""),i.minHeight=e._minHeight||"",t&&(t.overflowX=t.config.overflowX)),e.alignmentChanges=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null,n=document.createDocumentFragment();if(this.containsFocus){for(let r,i=e.nextSibling;i;i=r)r=i.nextSibling,t.contains(i)&&!this.owns(i)&&n.appendChild(i);t.insertBefore(n,e)}else t.appendChild(e)}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}handleReactElement(e){const t=this.closest((e=>e.reactComponent));null!=t&&t.reactComponent&&t.reactComponent.processWidgetContent({reactElement:e,widget:this,reactComponent:t.reactComponent})}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,n=null==e,{element:r,contentElement:i,htmlCls:s}=t;if(r||!Br.isReactElement(e)){if(r){t.updatingHtml=!0;const o=i===r&&t._anchorElement;s&&s.values.forEach((e=>r.classList[n?"remove":"add"](e))),o&&r.removeChild(o),e&&"object"==typeof e?Br.isReactElement(e)?t.handleReactElement(e):To.sync({domConfig:{...e,onlyChildren:!0},targetElement:t.contentElement}):t.contentElement.innerHTML=n?"":e,t.getConfig("htmlMutationObserver"),o&&r.appendChild(o),t.isComposable?t.recompose():(t.floating||t.positioned)&&(t.isAligning||t.realign())}}else t.whenVisible((()=>t.handleReactElement(e)))}changeHtmlMutationObserver(e,t){const n=this,{contentElement:r}=n;if(null==t||t.disconnect(),e){const t=new MutationObserver((()=>{n.updatingHtml?n.updatingHtml=!1:n._html=r.innerHTML}));return t.observe(r,e),t}}updateContent(e){const t=this,n=null==e,{element:r,htmlCls:i}=t;if(r){const{contentRange:s}=t;i&&i.values.forEach((e=>r.classList[n?"remove":"add"](e))),r.isConnected?(s.deleteContents(),n||s.insertNode(Br.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,!t.floating&&!t.positioned||t.isAligning||t.realign()}}onThemeChange(){var e;null!==(e=this.anchorElement)&&void 0!==e&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const n=parseFloat(Br.getStyleValue(e.element,"border-top-width")),r=Br.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,{className:s}=i,o=i.firstElementChild,a=e.anchorPathElement=o.lastElementChild,l=e._hidden;i.className="b-anchor b-anchor-top";let c=Br.getStyleValue(e.contentElement,"background-color");c.match(Jo)&&(c=Br.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,t=i.getBoundingClientRect();const[d,u]=t=e._anchorSize=[t.width,t.height];i.className=s,o.setAttribute("height",u+n),o.setAttribute("width",d),a.setAttribute("d",`M0,${u}L${d/2},0.5L${d},${u}`),n&&(a.setAttribute("stroke-width",n),a.setAttribute("stroke",r)),t[1]-=n,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=An.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating,n=`${e.id}-shadow-filter`;e._anchorElement=Br.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:n,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${n})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){const t=this,{element:n}=t;var r,i,s;e?(t.dragEventDetacher=Zn.addListener({element:n,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:t}),t.dragDetacher=Zn.on({element:n,mousedown(e){const{target:t}=e,r=ba.fromElement(t);(!e.target.closest(".b-field-inner")&&r===this||this.strips&&Object.values(this.strips).includes(r))&&n.setAttribute("draggable","true")},thisObj:t})):(null===(r=t.dragEventDetacher)||void 0===r||r.call(t),null===(i=t.dragOverEventDetacher)||void 0===i||i.call(t),null===(s=t.dragDetacher)||void 0===s||s.call(t))}onWidgetDragStart(e){var t;const n=this;if(!n.validateDragStartEvent(e))return;const{element:r,align:i,constrainTo:s}=n,a=n.positioned&&"fixed"!==Br.getStyleValue(r,"position"),l=a?r.parentElement:n.rootElement,c=wn.from(r,a?l:null),d=e.clientX,u=e.clientY,h=document.scrollingElement||document.body,[g,m]=a?Br.getOffsetXY(r,l):n.getXY(),p=null===(t=a?wn.content(l).moveTo(0,0):s&&(null!=s&&s.isRectangle?s:wn.from(s)))||void 0===t?void 0:t.deflate(i.constrainPadding||0),f={element:l,dragover:e=>{r.classList.remove("b-centered"),c.moveTo(g+e.clientX-d-(a?0:h.scrollLeft),m+e.clientY-u-(a?0:h.scrollTop)),p&&c.constrainTo(p),Br.setTranslateXY(r,c.x,c.y)}};o.isTouchDevice&&(f.touchmove=e=>e.preventDefault()),n.floatRoot.appendChild(n.dragGhost),n.setDragImage(e),e.dataTransfer.effectAllowed="none",n.dragOverEventDetacher=Zn.addListener(f),n.alignTo()}validateDragStartEvent(e){const{element:t}=this,n=Br.elementFromPoint(e.clientX,e.clientY),{handleSelector:r}=this.draggable;if(r){var i;const s=null===(i=ia.exec(r))||void 0===i?void 0:i[1];if(s){if(n.closest(`#${t.id} ${s}`))return e.preventDefault(),!1}else if(!n.closest(`#${t.id} ${r}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}setStyle(e,t){return Br.applyStyle(this.element,Xt.isObject(e)?e:{[e]:t}),this}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[Br.getPageX(this.element),Br.getPageY(this.element)]}setXY(e,t){const n=this,{element:r}=n;if(n.floating||n.positioned){if(null!=e&&(n._x=e),null!=t&&(n._y=t),"fixed"===Br.getStyleValue(r,"position")){const n=r.getBoundingClientRect(),[i,s]=Br.getTranslateXY(r),o=e-n.x,a=t-n.y;Br.setTranslateXY(r,i+o,s+a)}else Br.setTranslateXY(r,n._x||0,n._y||0);n.isConstructing?n.centered=!1:r.classList.remove("b-centered")}}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;Br.setLength(t.element,"width",e),t._lastWidth=e,t._oldWidth=t._width,t._width=null,t._flex=null,t.element.style.flex=""}clearWidthCache(){this._width=null}get maxWidth(){return Br.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){this._lastMaxWidth=e,Br.setLength(this.element,"maxWidth",e)}get minWidth(){return Br.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){Br.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){Br.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return Br.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){this._lastMaxHeight=e,Br.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return Br.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){Br.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:t,focusElement:n,ariaElement:r}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),e&&(this.revertFocus(),this._disabled!==e)||(t&&(t.classList[e?"add":"remove"]("b-disabled"),n&&(n.disabled=e),r&&r.setAttribute("aria-disabled",e)),this.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=Mo.request(e.floating?e.floatRoot:e.element);return Mo.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return Mo.exit()}onFullscreenChange(){Mo.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){Mo.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){const e=this;if(e._tooltip)return e._tooltip;{var t;const n=null===(t=ba.Tooltip)||void 0===t?void 0:t.getSharedTooltip(e.rootElement,e.eventRoot);if(n&&n.activeTarget===e._element&&n.isVisible)return n}}changeTooltip(e,t){const n=this,{element:r}=n;if(e){if(!n.preventTooltipOnTouch||!o.isTouchDevice){var i;if(e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:n.placeholder,textContent:!0}),!n.configureAriaDescription)n.ariaDescription=null!==(i=e.html)&&void 0!==i&&i.match(ha)?e.html.replace(ha,ga):e.html;if(!(null!=t&&t.isTooltip||e.newInstance))return r.dataset.btip=!0,void(n.tipConfig=e);e.type="tooltip",e.forElement||(e.forElement=r),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=ba.reconfigure(t,e,n),n.detachListeners("tooltipValueListener"),n.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:n})}}else if(t){if(null!=e||!t.isTooltip)return void(t.html=null);t.destroy()}else delete r.dataset.btip;return e}onTooltipValueChange({value:e,source:t}){this.ariaDescription="string"==typeof e?e:t.contentElement.innerText}get tooltipText(){const e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}get isVisible(){const e=this,{element:t}=e;let n;return Boolean(t&&!e._hidden&&!e.isDestroying&&t.isConnected&&(!e.requireSize||Mr(t))&&(!(n=e.containingWidget)||n.isVisible))}whenVisible(e,t=this,n,r=e.toString()){const i=this;var s;i.isVisible&&i.isPainted?(null===(s=i.toCallWhenVisible)||void 0===s||s.delete(r),i.callback(e,t,n)):(i.toCallWhenVisible||(i.toCallWhenVisible=new Map)).set(r,{callback:e,thisObj:t,args:n})}focus(){this.isFocusable&&Br.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:t=!0}={}){const n=this,{element:r,floating:i}=n,{style:s}=r,o=t&&n.showAnimation;let a,l,c=!n.isVisible;return c&&(c=n.trigger("beforeShow"),Xt.isPromise(c)&&(c=await c)),!1===c||n.internalBeforeShow&&!1===n.internalBeforeShow()?Promise.resolve():new Promise((t=>{if(n.cancelHideShowAnimation(),n.updateCentered(n._centered),i){const e=n.floatRoot;e.contains(r)||(n.rendered?e.appendChild(n.element):n.render(e,!1)),s.transform.includes("scale")&&(n.scale=null,s.transform=s.transformOrigin="");const t=n.closest(oa);if(t){const{scale:e}=t;n.scale=e,s.transform=`scale(${e})`,s.transformOrigin="0 0"}}if(n._hidden=!1,r.classList.remove("b-hidden"),i&&!Tr(r)&&(n.hide(!1),t()),n.onConfigChange({name:"hidden",value:!1,was:!0,config:n.$meta.configs.hidden}),o){a=Object.keys(o)[0],l=o[a];const e=n.currentAnimation={showing:!0,styleProp:a,resolve:t};n.isAnimating=!0,s.transition="none",s[a]=l.from,Br.getStyleValue(r,a),n.currentAnimation.detacher=Zn.onTransitionEnd({element:r,property:a,duration:ca(l.duration)+20,handler:()=>n.afterHideShowAnimate(e),thisObj:n}),s.transition=`${a} ${l.duration} ease ${l.delay}`,s[a]=l.to}n.afterShow(e,o?null:t)}))}async showBy(e,t,n){const r=this,i=Array.isArray(e);if(i||"number"==typeof e){const r=i?e:[e,t];e=Object.assign({target:new En(r[0]+1,r[1]+1),matchSize:!1,align:"t0-b0"},i?t:n)}if(r.requireSize=!0,!r.isVisible)return r.show({align:e});Br.addTemporaryClass(r.element,"b-realigning",300,r),r.alignTo(e)}async showByPoint(){return _.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,t){var n,r;const i=this;i.trigger("show"),i._configuredAnchorState=i.anchor,null===(n=i.owner)||void 0===n||null===(r=n.onChildShow)||void 0===r||r.call(n,i),i.triggerPaint(),(i.floating||i.positioned)&&(e?i.alignTo(e):i.centered?i.alignTo({target:i.constrainTo,align:"c-c"}):i.forElement&&i.alignTo(i.forElement)),null==t||t()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:t,toCallWhenVisible:n}=e,i=!e.isPainted;if(e.isVisible){if(i&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),Fo.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&t.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),t.firstChild),e.onConnectedCallback&&r.ResizeObserver&&(e.connectedObserver=new ResizeObserver((()=>{e.isElementConnected&&!t.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&t.isConnected&&(e.onConnectedCallback(!0,null==e.isElementConnected),e.isElementConnected=!0)})),e.connectedObserver.observe(t))),e.eachWidget(ra,!1),i&&(e.getConfig("tooltip"),!ba.Ripple&&ba.RippleClass&&(ba.Ripple=new ba.RippleClass({rootElement:e.rootElement})),r.DocsBrowser&&e.floating&&e.closest((e=>{var t;return null===(t=e.element)||void 0===t?void 0:t.closest(".fiddlePanelResult,.b-owned-by-fiddle")}))&&t.classList.add("b-owned-by-fiddle")),e.isPainted=!0,i&&e.triggerConfigs("paint"),e.onInternalPaint({firstPaint:i}),e.trigger("paint",{firstPaint:i}),null!=n&&n.size){for(const{callback:t,thisObj:r,args:i}of n.values())e.callback(t,r,i);n.clear()}i&&e.monitorResize&&!e.scaleToFitWidth&&Fo.onElementResize([{target:t}])}}onInternalPaint(){}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:n}=e;t&&(e.isAnimating=!1,n.classList.contains("b-hiding")&&(n.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),n.style.transition=n.style[t.styleProp]="",e.currentAnimation=null,e.trigger((t.showing?"show":"hide")+"AnimationEnd"))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",ua)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise((t=>{const n=this,{element:r,lastAlignSpec:i}=n,{style:s}=r,o=e&&n.hideAnimation;if(n.clearTimeout(n.scrollListenerTimeout),n.clearTimeout(n.resizeListenerTimeout),!n._hidden&&!1!==n.trigger("beforeHide",{animate:e})){if(n._hidden=!0,i&&(i.targetOutOfView=null,i.monitorIntersection&&(n.intersectionObserver.takeRecords(),n.intersectionObserver.unobserve(i.target))),n.onConfigChange({name:"hidden",value:!0,was:!1,config:n.$meta.configs.hidden}),!r)return void t();if(r.contains(Br.getActiveElement(r))&&n.revertFocus(!0),n.isDestroyed)return void t();if(n.cancelHideShowAnimation(),o){const e=Object.keys(o)[0],i=o[e];if(Number(getComputedStyle(n.element)[e])!==i.to){const o=n.currentAnimation={hiding:!0,styleProp:e,resolve:t};r.classList.add("b-hiding"),n.isAnimating=!0,n.currentAnimation.detacher=Zn.onTransitionEnd({element:r,property:e,duration:ca(i.duration)+20,handler:()=>n.afterHideShowAnimate(o),thisObj:n}),s[e]=i.from,Br.getStyleValue(r,e),s.transition=`${e} ${i.duration} ease ${i.delay}`,s[e]=i.to}else r.classList.add("b-hidden")}else r.classList.add("b-hidden");n.afterHide(!o&&t,o)}}))}doHideOrRealign({target:e,isTrusted:t}){const n=this,{lastAlignSpec:i,element:s}=n,o=null==i?void 0:i.anchoredTo,a=null==i?void 0:i.target,l=null==i?void 0:i.position,c=Br.getActiveElement(n);if(!t||!Mr(s)||e&&(s.contains(e)||e.nodeType===Element.ELEMENT_NODE&&n.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&s.contains(c)&&ea[c]&&r.innerHeight<document.body.offsetHeight))return;if(i.aligningToElement){const e=Br.isInView(a,!1,n);if(e&&e.equals(i.targetRect))return}const d="hide"===n.scrollAction&&n.getXY();if(n.realign(),!n.isDestroyed&&Tr(s)&&"hide"===n.scrollAction){const[t,r]=n.getXY(),s=t!==d[0]||r!==d[1];(null!=i&&i.aligningToEvent||(s||"Point"===(null==a?void 0:a.$$name)||l)&&(!o||!Mr(o)||e&&Br.isDescendant(e,o)))&&n.hide()}}afterHide(e=null,t=this.hideAnimation){var n,r;const i=this;i._anchor=i._configuredAnchorState,i.removeTransientListeners(),t||i.afterHideAnimation(),i.trigger("hide"),null===(n=i.owner)||void 0===n||null===(r=n.onChildHide)||void 0===r||r.call(n,i),e&&e()}removeTransientListeners(){var e,t;const n=this,{targetObserver:i,lastAlignSpec:s}=n;if(n.clearTimeout(n.resizeListenerTimeout),n.clearTimeout(n.scrollListenerTimeout),i&&(i.disconnect(),delete n.targetObserver),n.documentScrollListener=null===(e=n.documentScrollListener)||void 0===e?void 0:e.call(n),n.targetRootScrollListener=null===(t=n.targetRootScrollListener)||void 0===t?void 0:t.call(n),n.targetResizeListener&&(Fo.removeResizeListener(s.target,n.onTargetResize),n.targetResizeListener=!1),n.constrainListeners){var o;const e=null!==(o=s.constrainTo)&&void 0!==o&&o.isRectangle?r:s.constrainTo;Fo.removeResizeListener(e||r,n.onAlignConstraintChange),n.constrainListeners=!1}}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&e.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let n;return t.isConfiguring?(n=Boolean(e),t.element.classList[e?"add":"remove"]("b-hidden")):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),n}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){let e=this.parent;if(!e){var t,n;const r=(null===(t=this.forElement)||void 0===t?void 0:t.nodeType)===Element.ELEMENT_NODE?this.forElement:null===(n=this.element)||void 0===n?void 0:n.parentNode;e=(null==r?void 0:r.closest(".b-widget"))&&ba.fromElement(r)}return e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:n}=t,r=n?n.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return n?r[r.indexOf(t)+e]:ba.fromElement(r[r.indexOf(t.element)+e])}up(e,t,n){var r;const{owner:i}=this;return e?null==i||null===(r=i.closest)||void 0===r?void 0:r.call(i,e,t,n):i}closest(e,t,n){const r=typeof n,i="number"===r,s="string"===r;for(let r=this,o=1;r;r=r.owner,o++){if(ba.widgetMatches(r,e,t))return r;if(i&&o>=n)return;if(s&&ba.widgetMatches(r,n,t))return;if(r===n)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=ba.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}changeMaximizeOnMobile(e){const t=this;if(t.floating&&o.isMobile){const{initialConfig:n}=t;e?(t.centered=t.modal=!1,t.maximized=!0):(t.centered=n.modal,t.modal=n.centered,t.maximized=n.maximized)}}changeMonitorResize(e,t){const n=!this.scaleToFitWidth&&Boolean(e);if(n!==Boolean(t))return n}updateMonitorResize(e){const t=this;aa(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),Fo[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const n=this.childItems,r=(null==n?void 0:n.length)||0,i={};for(let s=0;s<r;s++){const r=n[s];if(i.down=t,!1===e(r,i))return!1;if(i.down&&r.eachWidget&&!1===r.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((n=>{e(n)&&t.push(n)})),t}query(e){let t=null;return this.eachWidget((n=>{if(e(n))return t=n,!1})),t}getWidgetByRef(e){var t,n;return e instanceof ba?e:(null==this||null===(t=this.widgetMap)||void 0===t?void 0:t[e])||(null==this||null===(n=this.owner)||void 0===n?void 0:n.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:n}=t;t.containsFocus=!0,t.focusInEvent=e,(t.floating||t.positioned)&&t.toFront(),n.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),n.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=Zn.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=Br.getActiveElement(e),n=e.contains(t)&&e.captureFocusItem(t);return(r,i)=>{if(n&&!e.isDestroying){(Br.getActiveElement(e)!==t||i)&&n(r)}}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():Br.focusWithoutScrolling(e))}}contains(e,t){const{element:n}=this;if(e&&n)return e.isWidget&&(e=e.element),n.contains(e)&&(!t||n!==e)}revertFocus(e){var t,n;const r=this,i=Br.getActiveElement(r);let s=null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget;(e||r.containsFocus&&(null===(n=s)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE&&r.element.contains(i))&&(s&&Br.isFocusable(s)||(s=r.getFocusRevertTarget()),r._isRevertingFocus=!0,s&&Br.isFocusable(s)?(s._isRevertingFocus=!0,Br.focusWithoutScrolling(s),s._isRevertingFocus=!1):null==i||i.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:n}=e,r=n&&n.backwards?1:-1;let i=n&&n.relatedTarget;const s=i&&ba.fromElement(i);if(t&&!t.isDestroyed&&(!i||!Br.isFocusable(i)||s&&!s.isFocusable)){var o;if(i=null,t.eachWidget){const n=[];if(t.eachWidget((t=>{(t===e||t.isFocusable)&&n.push(t)}),!1),n.length>1){const t=n.indexOf(e);i=n[t+r]||n[t-r]}}!i&&t.isFocusable&&(i=t),i=i?i.focusElement:null===(o=t.getFocusRevertTarget)||void 0===o?void 0:o.call(t)}return i}getStaticWidgetClasses(e,t){const n=new Tn,r=this.$meta.hierarchy;let i,s,o,a,l;for(s=r.indexOf(e);s<r.length;++s){var c;i=r[s],l=Reflect.getOwnPropertyDescriptor(i.prototype,"widgetClass"),null!==(c=l)&&void 0!==c&&c.get?a=l.get.call(this):(o=aa(i,"$$name")||aa(i,"$name")||aa(i,"_$name")?i.$$name:i.name,(o.length<3||o.includes("$"))&&console.warn(`Class "${o}" extending "${i.$name}" should have "$name" static getter with no less than 3 chars.`),a=`b-${o.toLowerCase()}`),a&&n.add(t?a+t:a)}return n}get rootUiClass(){return ba}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(ba),o.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:n,uiClasses:r}=e;let{staticClassList:i}=e;(n||t)&&(i=i.clone(),n&&i.assign(n),t&&i.assign(t));const s=i.values;return r&&s.push(...r),e.floating&&s.push("b-floating"),"hide"===e.collapsify&&s.push("b-collapsify-hide"),s}changeCls(e){return Tn.from(e)}updateCls(e,t){if(!this.isConfiguring&&!this.isComposable){const{element:n}=this;t&&Xt.getTruthyKeys(t).forEach((e=>n.classList.remove(e))),e.assignTo(n)}}changeContentElementCls(e){return Tn.from(e)}changeHtmlCls(e){return Tn.from(e)}changeDefaultCls(e){return Tn.from(e,!0)}changeUi(e){return Tn.from(e)}updateUi(e){var t;let n,r,i=null;if(e){const t=this.getStaticWidgetClasses(this.rootUiClass);for(r in e)if(e[r])for(n in t)t[n]&&((i||(i=new Tn))[`${n}-ui-${r}`]=1)}this._uiClasses=null===(t=i)||void 0===t?void 0:t.values,this._uiClassList=i}fromCache(e,t=!1,n=this.element){if(!n)return null;const r=this;return r.cache[e]||(r.cache[e]=t?Br.children(n,e):Br.down(n,e)),r.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){var n;if("trial"!==(null===(n=this.masked)||void 0===n?void 0:n.type)){if(!0!==e&&""!==e||(e=" "),t&&!t.isDestroyed)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=ba.resolveType("mask");(e=t.mergeConfigs(this.maskDefaults,e)).owner=this,e=t.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,n,r,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){const n=this,{element:r}=n,i=n._width??n._oldWidth,s=n._height,o=r.offsetWidth,a=r.offsetHeight;n.floating&&t&&n.onFloatingWidgetResize(...arguments),n.suspendResizeMonitor||i===o&&s===a||(n.onInternalResize(r,o,a,i,s),n.trigger("resize",{width:o,height:a,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,n){const r=this,{lastAlignSpec:i,constrainTo:s}=r;if(r.isVisible&&i&&i.target){const e=!t||n.height!==t.height,o=!t||n.width!==t.width,a=s&&!wn.from(s).contains(wn.from(r.element,null,!0));(e&&2!==i.zone||o&&1!==i.zone||a)&&r.requestAnimationFrame((()=>r.realign()))}}updateScale(){const e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const r=wn.client(n).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(r,1):r;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?`${n[0]}${t}`:n[0],isFinite(n[1])?`${n[1]}${t}`:n[2],isFinite(n[2])?`${n[2]}${t}`:n[3],isFinite(n[3])?`${n[3]}${t}`:n[4]]}get documentRoot(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.documentRoot)||this.element.getRootNode()}get eventRoot(){var e,t;return null!==(e=this.element)&&void 0!==e&&e.isConnected?Br.getRootElement(this.element):(null===(t=this.owner)||void 0===t?void 0:t.eventRoot)||this._rootElement}get rootElement(){const e=this;if(!e._rootElement){var t,n;let r=(null===(t=e.owner)||void 0===t?void 0:t.rootElement)||Br.getRootElement(e.forElement||(null!==(n=e.element)&&void 0!==n&&n.isConnected?e.element:e.getRenderContext()[0]||e.element));r||(r=document.body),e._rootElement=r}return e._rootElement}get floatRoot(){const{rootElement:e}=this;let{floatRoot:t}=e;if(t)e.contains(t)||e.appendChild(t);else{var n;const{outerCls:i}=ba,s=null===(n=Br.getThemeInfo(null,e))||void 0===n?void 0:n.name;if(!Br.isValidFloatRootParent(e))throw new Error("Attaching float root to wrong root");s&&i.push(`b-theme-${s.toLowerCase()}`),t=e.floatRoot=Br.createElement({className:`b-float-root ${i.join(" ")}`,parent:e}),Xo.push(t),o.isAndroid&&(t.style.height=`${screen.height}px`,Zn.on({element:r,orientationchange:()=>t.style.height=`${screen.height}px`,thisObj:this})),An.ion({theme:({theme:e,prev:n})=>{t.classList.add(`b-theme-${e.toLowerCase()}`),t.classList.remove(`b-theme-${n.toLowerCase()}`)}})}return t}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach((t=>{const n=parseInt(getComputedStyle(t).zIndex||0,10);n>e&&(e=n)})),e}static resetFloatRootScroll(){Xo.forEach((e=>e.scrollTop=e.scrollLeft=0))}static get floatRoots(){return Xo}static removeFloatRoot(e){Xo.splice(Xo.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=o;return t&&e.push(`b-${t}`),o.isTouchDevice&&e.push("b-touch-events"),o.isMobile&&e.push("b-mobile"),Br.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),o.isChrome?e.push("b-chrome"):o.isSafari?e.push("b-safari"):o.isFirefox&&e.push("b-firefox"),o.isPhone&&e.push("b-phone"),r.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:n}=t;t._isAnimatingCounter=Math.max(0,n+(e?1:-1)),0===n&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):1!==n||e||(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,t=!1){const{idMap:n}=ba.identifiable;for(const r in n)if(ba.widgetMatches(n[r],e,t))return n[r];return null}static queryAll(e,t=!1){const{idMap:n}=ba.identifiable,r=[];for(const i in n)ba.widgetMatches(n[i],e,t)&&r.push(n[i]);return r}static fromElement(e,t,n){const r=typeof t;e&&!e.nodeType&&(e=e.target),("number"===r||t&&t.nodeType===Element.ELEMENT_NODE)&&(n=t,t=null);let i,s,o,a=e,l=0;for("number"!=typeof n&&(i=n,n=Number.MAX_VALUE),"string"===r&&(t=t.toLowerCase());a&&a.nodeType===Element.ELEMENT_NODE&&l<n&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id,s){if(o=ba.getById(s),o){if(!t)return o;if("function"===r){if(t(o))return o}else if(ba.widgetMatches(o,t,!0))return o}l++}a=a.parentNode}return null}static fromSelector(e){const t=document.querySelector(e);return t?ba.fromElement(t):null}triggerFieldChange(e,t=!0){var n;t&&this.trigger("change",e),null===(n=this.eachAncestor)||void 0===n||n.call(this,(t=>{var n,r;if(null===(n=t.onFieldChange)||void 0===n||n.call(t,e),null!==(r=t.isolateFieldChange)&&void 0!==r&&r.call(t,this))return!1}))}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){An.setupFocusListenersOnce(this.eventRoot,Zn)}static widgetMatches(e,t,n){return"*"===t||("function"==typeof t?t(e):ba.isType(e,t,n))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),ba.create(Object.assign({forElement:e},t),"tooltip"),e}changeDock(e){return"start"===e?"left":"end"===e?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget((t=>{"rtl"in t.initialConfig||(t.rtl=e)}))}}const Ca=ba.prototype;["compose","domSyncCallback"].forEach((e=>Ca[e].$nullFn=!0)),ba.initClass(),ba.register("mask",Go),Br.Widget=ba,An.Widget=ba,Go.identifiable.idMap=ba.identifiable.idMap,Object.assign(r.bryntum||(r.bryntum={}),{get:ba.getById.bind(ba),query:ba.query,queryAll:ba.queryAll,fromElement:ba.fromElement,fromSelector:ba.fromSelector}),ba._$name="Widget";class Sa extends(ye.mixin(Ge,Ni)){static type="default";static configurable={owner:null,containerCls:"b-auto-container",itemCls:null};static factoryable={defaultType:"default"};get contentElement(){var e;return null===(e=this.owner)||void 0===e?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,itemCls:n}=e,{contentElement:r,items:i}=t,s=t.itemCls,o=null==i?void 0:i.length;if(o){t.textContent=!1;for(let e=0;e<o;e++){const o=i[e],{element:a}=o,{classList:l}=a;a.dataset.itemIndex=e,l.contains("b-outer")&&l.remove(...ba.outerCls),n&&l.add(n),s&&l.add(s),o.render(r,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:n}=e,{owner:r,itemCls:i}=t,{contentElement:s}=r,o=r.itemCls;s.contains(n)&&n.remove(),delete n.dataset.itemIndex,i&&n.classList.remove(i),o&&n.classList.remove(o),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:n,itemCls:r}=this,{contentElement:i}=n,s=n.itemCls;t.dataset.itemIndex=n.indexOfChild(e),n.textContent=!1,r&&t.classList.add(r),s&&t.classList.add(s),e.render(i,Boolean(n.isPainted)),this.syncChildCount()}insertChild(e,t){const n=this,{element:r}=e,{owner:i,itemCls:s}=n,{contentElement:o}=i,a=Br.getChild(o,`[data-item-index="${t}"]`),l=i.itemCls;i.textContent=!1,s&&r.classList.add(s),l&&r.classList.add(l),o.insertBefore(r,a),e.render(null,Boolean(i.isPainted)),n.fixChildIndices(),n.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){var e;const{owner:t}=this,{length:n}=t.items;null===(e=t.contentElement)||void 0===e||e.classList[1===n?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle({name:e,style:t,classes:n,map:r}){const i=this,s=`b-box-${e}-`,{contentElement:o}=i,a=i[e];let l=(null==r?void 0:r[a])||a;if(o){if(n){const{classList:e}=o;n.forEach((t=>{t!==l&&e.remove(s+t)})),n.includes(l)&&(e.add(s+l),l="")}o.style[t]=l}else i.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let n;if(t)for(e.pendingConfigs=null;n=t.pop();)e[e.$meta.configs[n].updater](e[n])}}Sa.initClass(),Sa._$name="Layout";let Da=0;const wa=e=>e.ripple;class Ea extends ba{static $name="Ripple";static type="ripple";static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}afterConstruct(){super.afterConstruct(),Zn.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const n=this;n.show();const r=Br.getStyleValue(n.circleElement,"animationName");n.hide(),null===(t=n.listenerDetacher)||void 0===t||t.call(n),r&&"none"!==r&&(n.listenerDetacher=Zn.on({mousedown:{element:n.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:n.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:n.circleElement,handler:"onAnimationEnd"},thisObj:n}),"mousedown"===e.type&&(n.onMousedown(e),An.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){Da=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-Da>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=ba.fromElement(e.target,wa);if(t){const n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){const i=Xt.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=Zn.getClientPoint(e),target:n=e.target,clip:r=n,radius:i=this.radius,color:s=this.color}){this.clip=r;const o=this,a=(r=wn.from(r,null,!0)).getDelta(t),l=o.rippleElement.style,c=o.circleElement,d=Br.getStyleValue(n,"border-radius");o.hide(),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${i}px`,o.element.style.borderRadius=d,c.setAttribute("r",i),c.setAttribute("fill",s),o.showBy({target:r,align:"c-c",matchSize:!0})}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}}ba.RippleClass=Ea,Ea._$name="Ripple";const xa=Object.freeze({}),{isArray:Ra}=Array,Ta=e=>e.weight,Ma=({weight:e},{weight:t})=>"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(e??Number.MAX_SAFE_INTEGER)-(t??Number.MAX_SAFE_INTEGER),ka=e=>e&&!e.hidden,Ia=["display","flex-direction"],Aa={default:1,box:1};class Fa extends ba{static $name="Container";static type="container";static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(Ra(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let t=!0;1===e.length&&(Ra(e[0])?e=e[0]:t=!1);const n=this,{_items:r}=n,i=[];for(let t=0;t<e.length;t++){const s=e[t];r.includes(s)&&(r.remove(s),n.layout.removeChild(s),i.push(s),n.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,n=t.ensureItems(),r=[];let i,s,o,a=!0;for(1===e.length&&(Ra(e[0])?e=e[0]:a=!1),s=0;s<e.length;s++){var l;i=e[s],i.isWidget?i.parent=t:i=t.createWidget(i),null!=(null===(l=i)||void 0===l?void 0:l.weight)?(o=H.findInsertionIndex(i,n.values,Ma),r.push(t.insert(i,o))):i&&(n.includes(i)||(n.add(i),t.onChildAdd(i),t.layout.appendChild(i),r.push(i)))}return a?r:r[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,t){const n=this,r=n.ensureItems();e instanceof ba?e.parent=n:e=n.createWidget(e),r.includes(t)&&(t=n.indexOfChild(t)),t=Math.min(t,r.count);const i=r.values;return i.splice(t,0,e),r.values=i,n.onChildAdd(e),n.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,t){const n=this,r=[],i=new As;return Ra(e)?n.processItemsArray(e,r):e&&n.processItemsObject(e,n.namedItems,r),r.some(Ta)&&r.sort(Ma),i.add(r),t&&t.forEach((e=>{n.remove(e),i.includes(e)||e._createdBy!==n||e.destroy()})),i}afterConstruct(){const{rtl:e}=this,{classList:t}=this.contentElement;t.toggle("b-rtl",!0===e),t.toggle("b-ltr",!1===e)}updateRtl(e){super.updateRtl(e);const{contentElement:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}updateItems(e,t){let n=0;e.forEach((e=>{this.onChildAdd(e),t&&!t.temporary&&this.layout.insertChild(e,n),++n})),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new As,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const n=e.length;let r,i;for(r=0;r<n;r++)i=e[r],i instanceof ba?(i.parent=this,i.element.classList.remove(...ba.outerCls)):i=this.createWidget(i),i&&((i.ref||i.id)&&this.addDescendant(i),t.push(i))}processItemsObject(e,t,n){let r,i;for(i in e)r=e[i],r&&(t&&i in t&&(r="object"==typeof r?Xt.merge(Xt.clone(t[i]),r):t[i]),r&&(r instanceof ba?r.parent=this:(r instanceof Object&&(r.ref=i),r=this.createWidget(r)),r&&(r.ref=i,this.addDescendant(r),n.push(r))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let t=this;t;t=t.parent)t.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var t;super.onChildHide(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var t;super.onChildShow(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const t=this,{items:n,hasItems:r}=t,i=n.filter(ka),{length:s}=i;if(t.visibleChildCount=s,t.hideWhenEmpty&&e){const e=Boolean(!s);Boolean(t._hidden)!==e&&(t.hidden=e)}n.forEach((e=>e.element.classList.remove("b-last-visible-child","b-first-visible-child"))),s&&(i[0].element.classList.add("b-first-visible-child"),i[s-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const{contentElement:e,flexColCls:t,flexRowCls:n}=this,r=new Tn(e.className),i=Br.getStyleValue(e,Ia);r[n]=r[t]=0,"flex"===i.display&&(r["row"===i["flex-direction"]?n:t]=1),Br.syncClassList(e,r)}addDescendant(e){const t=e.ref||e.id,n=this._widgetMap||(this._widgetMap={});n[t]||(n[t]=e)}onChildRemove(e){const t=this,n=e.ref||e.id;if(n)for(let r=t;r;r=r.parent)r.widgetMap[n]===e&&delete r.widgetMap[n];t.layout.onChildRemove(e),t.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?xa:null,e}updateRecord(e){var t;const n=this;null===(t=n.recordUpdateDetacher)||void 0===t||t.call(n),n.trigger("beforeSetRecord",{record:e}),n.setValues(e,{onlyName:n.strictRecordMapping,highlight:Boolean(n.$highlight)}),n.autoUpdateFields&&null!=e&&e.firstStore&&(n.recordUpdateDetacher=e.firstStore.ion({update:n.onRecordUpdated,thisObj:n}))}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord&&t){const{record:t,strictRecordMapping:n}=this,{name:r,ref:i,isValid:s=!0,value:o}=e,a=n?r:r||i;t&&a&&s&&(t.isModel?t.setValue(a,o):t[a]=o)}}getValues(e){const t={};return this.eachWidget(((n,r)=>{n.isolateFields?r.down=!1:!("name"in n)||e&&!e(n)||(t[n.name]=n.value)}),!0),t}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return Boolean(this.assigningValues)}get assigningValues(){var e;return this._assigningValues||(null===(e=this.parent)||void 0===e?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,t){super.assignValue(e,t),this.isolateFields||this.setValues(e,t)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,t=this.assignValueDefaults){this.assigningValues=t,this.eachWidget((n=>n.assignValue(e,t)),!1),this.assigningValues=!1}get hasNoChildren(){const e=this,{items:t,lazyItems:n}=e.initialConfig,r=t&&(Ra(t)?t:Xt.values(t)),i=n&&(Ra(n)?n:Xt.values(n)),s=e.isConfiguring?i||r:e.items;return!(null!=s&&s.filter(ka).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const t=this;if(!t.isComposable){const n=Boolean(e&&t.hasNoChildren),{classList:r}=t.contentElement;n!==r.contains("b-text-content")&&(r[n?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}}updateLayoutStyle(e){Br.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:e}=this.contentElement,{containerCls:t}=this.layout;e.add("b-content-element"),t&&e.add(t)}}onInternalPaint(){var e;null===(e=super.onInternalPaint)||void 0===e||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const t=this,{element:n,contentElement:r}=t;(e=new MutationObserver((e=>t.onContentElMutation(e)))).observe(r,{attributes:!0}),r!==n&&e.observe(n,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(e){Aa[this.layout.type]&&this.isVisible&&e.some((e=>this.contentElement.contains(e.target)))&&this.syncFlexDirection()}changeLayout(e,t){return Sa.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const n=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&("checkbox"===t&&o.isMobile&&ba.resolveType("slidetoggle",!0)&&(t=e.type="slidetoggle"),t=ba.resolveType(t,!0));for(let r=(e=(t||ba).mergeConfigs(n.defaults,e,{parent:n})).parent;r;r=r.parent)if(!1===r.processWidgetConfig(e))return null;return!1===n.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){const t=ba.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring&&e){const n=Object.entries(e);this.eachWidget((e=>{n.forEach((([n,r])=>{t&&e[n]!==t[n]||(e[n]=r)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>{var t;return e.isFocusable&&"close"!==e.ref&&!(null!==(t=e.ref)&&void 0!==t&&t.endsWith("collapse"))}));return e?e.focusElement:super.focusElement}doDestroy(){var e;null===(e=this._items)||void 0===e||e.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{t.isVisible&&"isValid"in t&&!t.isValid&&(e=!1)}),!0),e}}Fa.initClass(),Fa._$name="Container";const{assign:Pa}=Xt,Oa=()=>performance.now(),La={start:!1},$a=/^[.\d]+([^\d].*)?$/,_a=e=>{const t=e.$bryntum||(e.$bryntum={});return t.transitions||(t.transitions=Object.create(null))},ja=(e,t)=>{var n;"string"==typeof e&&(t=null===(n=$a.exec(e))||void 0===n?void 0:n[1],e=parseFloat(e));return e&&e*("s"===t||!t&&e<10?1e3:1)},Ba=e=>{const t=Xt.values(_a(e)).filter((e=>null==e.completed)).map((e=>e.toString()));e.style.transition=t.join(", ")},Va=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...e){super(...e),this.id=++Ha}start(){this.startTime=Oa()}get delay(){var e;return ja(this._delay??(null===(e=this.owner)||void 0===e?void 0:e.delay)??0,this.unit)}set delay(e){this._delay=e}get duration(){const{owner:e,unit:t}=this;return ja(this._duration??(e?e.duration:za.defaultDuration),t)}set duration(e){this._duration=e}get elapsed(){return Oa()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var e;return this._retain??(null===(e=this.owner)||void 0===e?void 0:e.retain)}set retain(e){this._retain=e}get timing(){var e;return this._timing??(null===(e=this.owner)||void 0===e?void 0:e.timing)}set timing(e){this._timing=e}get unit(){var e;return this._unit??(null===(e=this.owner)||void 0===e?void 0:e.unit)}set unit(e){this._unit=e}};let Ha=0;class Na extends(ye.mixin(Va)){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:n}=e;let{property:r}=e;[r,e.to]=Br.unitize(r,e.to),e.from=Br.unitize(r,e.from)[1],e.promissory=new zo,e.property=r;const i=n[r];n[r]=e;let{from:s}=e;i&&(e.from=i.to,s=null,i.destroy()),null===s&&(s=e.getCurrentStyleValue(),i||(e.from=s)),t.style[r]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return null===(e=this.promissory)||void 0===e?void 0:e.promise}get transitions(){return _a(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:n,promissory:r,property:i}=t;r&&(t.completed=e,t.promissory=null,r.resolve(e),n[i]===t?(delete n[i],e||(Ba(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return Br.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:n,from:r,property:i,_retain:s,_timing:o}=this;return new Na({element:n,property:i,retain:s,timing:o,duration:Math.round(Math.min(e,t)),reverting:this,to:r,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:n,element:r,property:i}=e;Zn.onTransitionEnd({element:r,property:i,duration:t+n+20,thisObj:e.owner,handler:()=>{var t;return null===(t=e.finish)||void 0===t?void 0:t.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:n,timing:r}=this;return`${n} ${t}ms ${r||"ease-in-out"}${e?` ${e}ms`:""}`}}Na.initClass();class za extends(ye.mixin(Va)){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){Xt.isObject(e)?Xt.entries(e).forEach((e=>za.register(...e))):(za.fx[e]=t,za[e]=t=>(Br.isElement(t)?t={element:t,[e]:{}}:delete(t={element:t.element,[e]:t})[e].element,za.run(t)))}static run(e){return new za(e).start()}constructor(e){var t;super(null);const n=this,r=[],i={};let s,o,a,l;if(Array.isArray(e))n.items=e;else for(a in e)(za.specialPropsRe.test(a)?n:i)[a]=e[a];Xt.keys(i).forEach((e=>{l=i[e],null!=l&&!1!==l&&l==l&&((o=za.fx[e])?(l=Pa(n.defaults,o(l,n,e)),l.owner=n,s=new za(l)):(l=Pa(n.defaults,"object"==typeof l?l:{to:l}),l.owner=n,l.property=e,s=new Na(l)),r.push(s))})),null===(t=n.items)||void 0===t||t.forEach((e=>{Xt.isInstantiated(e)?e.owner=n:((e=Pa(n.defaults,e)).owner=n,e=new za(e)),r.push(e)})),n.items=r,n.promise=(1===r.length?r[0].promise:Promise.all(r.map((e=>e.promise)))).then((e=>{var t;return null===(t=n.finish)||void 0===t||t.call(n,e),n.completed||!1}))}doDestroy(){this.items.forEach((e=>e.destroy())),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:n}=this;return e??(!t&&(!n||n.retain))}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,n;const r=this,{items:i}=r;for(Ba(r.element),r.completed="boolean"==typeof e?e:!e.some((e=>!e)),null===(t=r.prefinalize)||void 0===t||t.call(r,r.completed,r);i.length;)i.pop().destroy();null===(n=r.finalize)||void 0===n||n.call(r,r.completed,r)}revert(e){const t=this,{reverting:n}=t,r=!e||(e.start??!0);let i=t.defaults;return n&&(n.finalize&&(i.finalize=n.finalize),n.prefinalize&&(i.prefinalize=n.prefinalize),i.retain=n._retain),i=Pa(i,e,{items:t.items.map((e=>e.revert(La))),reverting:t}),i=new za(i),r&&i.start(),i}start(){const{element:e,items:t}=this;return super.start(),t.length&&(Ba(e),t.forEach((e=>e.start()))),this}}za.initClass().Transition=Na,za.specialPropsRe=new RegExp(`^(?:${Object.keys(za.prototypeProperties).concat(Object.keys(za.superclass.prototypeProperties)).map((e=>"_"===e[0]?e.substr(1):e)).join("|")})$`),za.defaultDuration=200,za.fx={},za.register({puff:e=>(!0===e?e={}:"object"!=typeof e?e={transform:`scale(${e})`}:e.scale&&((e=Xt.clone(e)).transform=`scale(${e.scale})`,delete e.scale),Pa({opacity:0,transform:"scale(8)"},e))}),za._$name="Animator";const Wa=/^(?:undefined|null|LEFT|RIGHT)$/,Ua={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Ga=e=>{const t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]};var Ya=e=>class extends(e||ye){static $name="Rotatable";static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:e}=this;return{class:{[`b-rotate-${(e||"").toLowerCase()}`]:e,"b-rotate-vertical":e}}}syncRotationToDock(e){if(Wa.test(String(this.rotate))){const[t,n]=Ga(e);this.rotate=n?this.invertRotate?Ua[t]:t:null}}get widgetClass(){return null}};class qa extends(ba.mixin(Ya)){static $name="Tool";static type="tool";static configurable={align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null};compose(){const{align:e,href:t}=this;return{tag:null!=t?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,t;if(null!==(e=this.parent)&&void 0!==e&&e.isPanel&&null!==(t=this.element)&&void 0!==t&&t.parentNode.matches(".b-panel-header"))return this.parent}changeAlign(e){return e}onInternalClick(e){const t=this,{handler:n,panel:r}=t,i={domEvent:e,tool:t};t.disabled||(t.trigger("click",i),t.isDestroyed||(t.trigger("action",i),t.isDestroyed||!1===(null==r?void 0:r.trigger("toolClick",i))||n&&t.callback(n,r,[e,r,t])))}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,t){var n;super.updateDisabled(e,t),e&&(null===(n=this.repeat)||void 0===n||n.cancel())}changeRepeat(e,t){return null==t||t.destroy(),e&&pi.new({element:this.element},e)}}qa.initClass(),qa._$name="Tool";const Ka=/right/i,Xa=e=>(e.collapsed||e.collapsing)&&"top"===e.owner.expandedHeaderDock&&e.owner.collapsible.direction.match(Ka)?"start":"end";class Za extends qa{static $name="CollapseTool";static type="collapsetool";static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:t}=this;return{class:{[`b-icon-collapse-${t}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return!0===e?Xa:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}}Za.initClass(),Za._$name="CollapseTool";const Ja=/^(?:UP|DOWN|LEFT|RIGHT)$/,Qa=/^(left|top)$/i,el={},tl=/^b-dock-(top|left|right|bottom)$/,nl="b-panel-collapse-revealer",rl=/^(?:left|right)$/i,il="b-collapse-unflex",{round:sl}=Math,ol=["up","down","left","right"].reduce(((e,t)=>(e[t.toUpperCase()]=e[t]=t,e)),{}),al={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},ll={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},cl={h:"w",w:"h"},dl={up:"top",right:"right",down:"bottom",left:"left"},ul={top:!1,right:!0,bottom:!1,left:!0},hl={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},gl={top:e=>`translate(0, -${sl(e.height||0)}px)`,bottom:e=>`translate(0, ${sl(e.height||0)}px)`,right:e=>`translate(${sl(e.width||0)}px, 0)`,left:e=>`translate(-${sl(e.width||0)}px, 0)`};let ml=0;class pl extends(ye.mixin(Ni)){static $name="PanelCollapser";static type="inline";static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var t;null===(t=this.collapsible)||void 0===t||t.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return"collapsing"===this.collapsingExpanding}get collapsingExpanding(){var e;const t=null===(e=this.currentOperation)||void 0===e?void 0:e.collapsing;return null==t?null:t?"collapsing":"expanding"}get currentDock(){var e,t,n;return(null===(e=this.panel)||void 0===e||null===(t=e.header)||void 0===t||null===(n=t.dock)||void 0===n?void 0:n.toLowerCase())??"top"}get expanding(){return"expanding"===this.collapsingExpanding}get collapseTool(){var e,t;return null===(e=this.panel)||void 0===e||null===(t=e.tools)||void 0===t?void 0:t.collapse}get collapseDim(){return rl.test(this.collapseDir)?"width":"height"}getCollapseDir(e){let{direction:t,panel:n}=this;if(!t||Ja.test(t)){const e=null==n?void 0:n.placement;var r;if(e)t=ll[e];else t=hl[(null==n||null===(r=n.header)||void 0===r?void 0:r.dock)||"top"]}return e?ol[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,t=e.hasHeader&&e.expandedHeaderDock;let n=dl[this.collapseDir],r=!1;return t&&((r=ul[n]!==ul[t])||(n=t)),[n,r]}get toolsConfig(){const{direction:e,tool:t}=this;return t&&{collapse:Xt.assign({direction:e.toLowerCase()},t)}}beforeCollapse(e){const{panel:t}=this,{element:n}=t;n.contains(Br.getActiveElement(n))&&t.revertFocus(!0)}changeTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={collapse:e}}collapse(e){var t,n;const r=this,{panel:i}=r,s={id:++ml,completed:!1,panel:i};let{currentOperation:o}=r;return e=e??!0,Xt.isObject(e)&&(s.collapsed=!0,Xt.assign(s,e),e=s.collapsed,delete s.collapsed),s.collapsing=e,s.previous=o??null,e!==r.collapsed?o?o.collapsing!==e&&(s.animation=o.animation.revert({finalize(){var e;null===(e=r.collapseFinalize)||void 0===e||e.call(r,s,!0)}}),s.collapsing=e,o=s):(s.animation=Xt.clone(("animation"in s?s:r).animation),!1!==r.beforeCollapse(s)&&(s.animation&&(s.animation.finalize=e=>{var t;return null===(t=r.collapseFinalize)||void 0===t?void 0:t.call(r,s,e)}),i.changingCollapse=!0,r[e?"collapseBegin":"expandBegin"](s),s.animation?o=s:(s.completed=!0,r[e?"collapseEnd":"expandEnd"](s)),i.changingCollapse=!1,s.animation||r.onComplete(e?"collapse":"expand"))):o&&o.collapsing!==e&&(r[e?"expandRevert":"collapseRevert"](s),s.animation=o.animation.revert({finalize(){var e;null===(e=r.collapseFinalize)||void 0===e||e.call(r,s,!1)}}),o=s),r.currentOperation=o,(null===(t=o)||void 0===t||null===(n=t.animation)||void 0===n?void 0:n.done())??Promise.resolve(e===r.collapsed)}collapseFinalize(e,t){const n=this,{currentOperation:r,panel:i}=n,s=i.collapsed?"expand":"collapse";r===e&&(n.currentOperation=null,e.completed=t,i.changingCollapse=!0,n[s+"End"](e),i.changingCollapse=!1,t&&n.onComplete(s))}applyHeaderDock(e,t=!0){const{currentDock:n,panel:r}=this,i=e?this.collapseDock:r.expandedHeaderDock;i!==n&&r.hasHeader&&(r.header={dock:i},t&&r.recompose.flush())}composeHeader(e){const{panel:t}=this,{class:n}=e,r=t.expandedHeaderDock||Object.keys(n).filter((e=>n[e]&&tl.test(e))).map((e=>tl.exec(e)[1][0]));return n[nl]=1,n[`b-collapsible-${r[0]}${this.collapseDir[0]}`]=1,e}composeTitle(e){return e.class[nl]=1,e}collapseBegin(e){var t;const n=this,{animation:r}=e,{collapseDim:i,collapseTool:s,panel:o}=n,{element:a,placement:l}=o,[c,d]=n.collapseInfo,u=null==s?void 0:s.element.classList,h=!l||"h"===l[0]&&"width"===i||"v"===l[0]&&"height"===i;n.configuredWidth=o._lastWidth,n.configuredHeight=o._lastHeight,n.transverseCollapse=d,n.applyHeaderDock(!0);const g=o.rectangle(),m=n.lockInnerSize().moveTo(0,0),p=m.clone(),f=al[c],v=null===(t=o.headerElement)||void 0===t?void 0:t.getBoundingClientRect(),y=sl((null==v?void 0:v[i])||0);a.classList.toggle(il,h),r?(p[f[0]]=p[f[1]],a.classList.add("b-collapsing"),null==u||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),o.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),r.element=a,r.retain=!0,r[i]={from:sl(g[i]),to:y},r.items=[{element:n.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${p})`}}],d&&r.items.push({element:o.headerElement,duration:r.duration,retain:!1,transform:{from:gl[c](v),to:"translate(0, 0)"}}),e.animation=za.run(r)):(a.style[i]=`${y}px`,s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(e){const t=this,{collapseTool:n}=t;t.panel.element.classList.remove("b-collapsing"),n&&(n.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}collapseRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.remove("b-collapsed")}expandBegin(e){const t=this,{animation:n}=e,{collapseDim:r,collapseTool:i,panel:s}=t,[o,a]=t.collapseInfo,{element:l}=s,c=l.classList,d=c.contains(il),u=s.rectangle();c.remove("b-collapsed","b-collapsing"),s.element.style[r]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);const h=s.rectangle(),g=t.lockInnerSize().moveTo(0,0),m=g.clone(),p=al[t.collapseDock];null==i||i.element.classList.remove("b-collapsed"),n&&(m[p[0]]=m[p[1]],c.add("b-collapsed","b-expanding"),d&&c.add(il),n.element=l,n[r]={from:sl(u[r]),to:sl(h[r])},n.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${g})`}}],a&&n.items.push({element:s.headerElement,duration:n.duration,retain:!1,transform:{from:"translate(0, 0)",to:gl[o](u)}}),e.animation=za.run(n))}expandEnd(e){const t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}expandRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const t=!0===e;return(t||null==e)&&(e=this.collapseDim[0],(t||"absolute"===Br.getStyleValue(this.panel.element,"position"))&&(e+=cl[e])),e||""}lockInnerSize(e=!0){const t=this,{innerElement:n,panel:r}=t,i=e?t.supportAxis:"",s=r.element,o=r.headerElement,a=e&&o&&wn.from(o,s),l=e&&wn.from(t.innerSizeElement,s),c=n.style;return o&&(o.style.minWidth=i.includes("w")?`${a.width}px`:"",o.style.minHeight=i.includes("h")?`${a.height}px`:""),c.width=e?`${l.width}px`:"",c.height=e?`${l.height}px`:"",n.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let t=!this.collapsing&&(!!this.expanding||!this.collapsed);e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}onComplete(e){var t;null===(t=this.panel)||void 0===t||t.trigger(e)}onHeaderClick({event:e}){0===e.button&&this.panel.collapsed&&e.target.classList.contains(nl)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:t}){const n=this,{panel:r}=n;"collapsed"===e?r.isPainted&&(n.collapsed=t):"header"!==e||r.changingCollapse||n.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){const{configuredHeight:t,configuredWidth:n,panel:r}=this;e=e??"wh",r.element.classList.remove(il),null!=n&&e.includes("w")&&(r.width=n),null!=t&&e.includes("h")&&(r.height=t)}splitHeaderItems({as:e,dock:t}=el){var n;return null===(n=this.panel)||void 0===n?void 0:n.splitHeaderItems({as:e,dock:t,alt:!0})}syncDirection(){const e=this,{direction:t}=e;t&&!Ja.test(t)||(e.direction=e.getCollapseDir())}changeCollapsed(e){return Boolean(e)}updateCollapsed(e){const{collapseTool:t,panel:n}=this;n&&(n.collapsed=e,n.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}updateDirection(e){const{collapseTool:t,panel:n}=this;t&&(t.direction=ol[e]),null!=n&&n.rendered&&n.recompose()}updatePanel(e){var t;const n=this;n.syncDirection(),null===(t=n.panelChangeDetacher)||void 0===t||t.call(n),n.panelChangeDetacher=e&&Me.after(e,"onConfigChange","onPanelConfigChange",n,{return:!1})}wrapCollapser(e,t){var n;const r=this,[i,s]=r.collapseInfo;if(!s)return[e,t];const{collapseDir:o,panel:a}=r,{expandedHeaderDock:l,header:c,uiClassList:d}=a,u=null===(n=a.tools)||void 0===n?void 0:n.recollapse,[h,g]=r.splitHeaderItems({as:"element",dock:i}),m=a.hasHeader?a.title||(null==c?void 0:c.title)||" ":null,p=m&&{tag:"header",class:new Tn({...d,[`b-dock-${l}`]:1,"b-panel-header":1,"b-panel-collapser-header":1},null==c?void 0:c.cls),children:[...h,{reference:"collapserTitleElement",html:m,class:{...d,[`b-align-${(null==c?void 0:c.titleAlign)||"start"}`]:1,"b-header-title":1}},...g]};return u&&(u.direction=o),["collapseWrapElement",{class:{...d,[`b-panel-collapser-header-${l}`]:1,[`b-panel-collapser-${o}`]:1,[`b-${ul[l]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1},children:Qa.test(l)?{collapserHeaderElement:p,[e]:t}:{[e]:t,collapserHeaderElement:p}}]}}pl.maps={clipByDock:al,dockByDirection:dl,dockIsHorz:ul},pl.initClass(),pl._$name="PanelCollapser";const fl=Symbol("pendingCreate");class vl extends ye{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:(t,n)=>e.get(n),set:(t,n,r)=>(e.set(n,r),!0),deleteProperty:(t,n)=>(e.set(n,null),!0)})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const n=this,{transform:r}=n,i=r?r(t,e):t,s=Xt.isInstantiated(i);n.instances[e]=fl,s||n.setDefaults(e,i),n.defineProp(e,!0),s&&n.set(e,i)}defineProp(e,t){const n=this,{object:r}=n;n.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get:()=>n.get(e),set:t=>n.set(e,t)})}flush(){const e=this;try{var t;e.updating=!0;for(const t in e.defaults)e.get(t);e.afterConfigureOwner=null===(t=e.afterConfigureOwner)||void 0===t?void 0:t.call(e)}finally{e.updating=!1}}get(e){const{defaults:t,instances:n}=this;return n[e]===fl&&this.set(e,fl),n[e]||t[e]&&null}set(e,t){const n=this,{cleanup:r,configName:i,defaults:s,factory:o,instances:a,owner:l,setup:c,transform:d,updating:u}=n,h=l&&i&&!u,g=a[e]===fl?null:a[e],m=o.reconfigure(g,t===fl?{}:t||null,{cleanup:r&&(t=>r(t,e)),defaults:s[e]||n.setDefaults(e,{}),owner:n.owner,setup:c&&((t,n,r)=>c(t,e,n,r)),transform:d&&(t=>d(t,e))});if(m!==g){const t=h&&{...a};var p;if(a[e]=m,m)n.defineProp(e),null===(p=n.created)||void 0===p||p.call(n,m,e);else delete n.object[e],delete a[e];h&&l.onConfigChange({name:i,config:l.$meta.configs[i],value:n.target,was:t})}}setDefaults(e,t){const{defaults:n,factory:r,inferType:i,instances:s,owner:o,ownerName:a}=this,{typeKey:l}=r.factoryable;return t=!0===t?{}:Xt.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),a&&(t[a]=o),t.beforeConfigure=t=>{s[e]=t},n[e]=t}update(e){const t=this,{owner:n}=t;let r,i;try{if(t.updating=!0,e)for(r in e)i=e[r],t.defaults[r]?t.set(r,i):i&&t.define(r,i);else for(r in t.instances)t.set(r,null)}finally{t.updating=!1}n&&(n.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=Me.before(n,"afterConfigure","flush",t)):t.flush())}}vl.initClass(),vl._$name="DynamicObject";const yl=[],bl={},Cl={align:1,weight:1};var Sl=e=>class extends(e||ba){static $name="Toolable";static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(e,t){return(e.weight||0)-(t.weight||0)}byWeightReverseSortFn(e,t){return(t.weight||0)-(e.weight||0)}gatherTools({align:e,alt:t,refs:n}=bl){const{collapsed:r,tools:i}=this,s={collapsed:r,alt:t};let o,a,l,c,d,u=[];for(a in i){var h,g,m;d=i[a],o=(null===(h=d)||void 0===h||null===(g=h.align)||void 0===g?void 0:g.align)??(null===(m=d)||void 0===m?void 0:m.align)??"end",o===e&&d.isCollapsified(s)&&u.push(d)}if(u.sort(this["end"===e?"byWeightReverseSortFn":"byWeightSortFn"]),n){const e="widget"===n,t={};for(l=0;l<u.length;++l)c=u[l],t[c.ref]=e?c:c.element;u=t}return u}getEndTools({alt:e,refs:t}=bl){return this.gatherTools({align:"end",alt:e,refs:t})}getStartTools({alt:e,refs:t}=bl){return this.gatherTools({align:"start",alt:e,refs:t})}get childItems(){return[...this.getStartTools(),...this._items||yl,...this.getEndTools()]}changeTools(e,t){const n=this,r=n.$tools||(n.$tools=new vl({configName:"tools",factory:ba,inferType:!1,owner:n,created(e){var t,i;e.innerItem=!1,null===(t=e.syncRotationToDock)||void 0===t||t.call(e,null===(i=n.header)||void 0===i?void 0:i.dock),Me.after(e,"onConfigChange",((e,{name:t})=>{Cl[t]&&n.onConfigChange({name:"tools",value:r.target})})),n.onChildAdd(e)},setup:(e,t)=>((e=Xt.merge({},n.toolDefaults["*"],n.toolDefaults[t],e)).parent=n,e.ref=t,e)}));if(r.update(e),!t)return r.target}get widgetClass(){}};const Dl=["b-hbox","b-vbox"],wl={name:"align",style:"alignItems"},El={name:"contentAlign",style:"alignContent"},xl={name:"direction",style:"flexDirection"},Rl={name:"justify",style:"justifyContent",classes:["stretch"]},Tl={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}};class Ml extends Sa{static $name="Box";static type="box";static alias="hbox";static configurable={containerCls:"b-box-container",itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null};get vertical(){return!1===this.horizontal}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(wl)}updateContentAlign(){this.syncConfigStyle(El)}updateDirection(){this.syncConfigStyle(xl)}updateHorizontal(){var e;const t=this,n=null===(e=t.contentElement)||void 0===e?void 0:e.classList,r=Number(t.vertical);n?(n.remove(Dl[1-r]),n.add(Dl[r])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle(Rl)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(Tl)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?`${e.vertical?"column":"row"}${t?"-reverse":""}`:null}}Ml.initClass(),Ml._$name="Box";class kl extends Ml{static $name="VBox";static type="vbox";static configurable={horizontal:!1}}kl.initClass(),kl._$name="VBox";var Il=e=>class extends(e||ye){static $name="Badge";static get configurable(){return{badge:null}}compose(){const{badge:e}=this;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}};const Al=/(?:^|\s)b-icon-/,Fl=/(?:^|\s)b-fa-/,Pl=Symbol("defaultToggleable"),Ol=["items","type","widgets","html","listeners"],Ll=Symbol("defaultListener");class $l extends(ba.mixin(Il,Ya)){static $name="Button";static type="button";static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,iconAlign:"start",behaviorType:"button",text:{value:null,$config:null,default:""},color:null,toggleable:Pl,pressed:!1,toggleGroup:null,supportsPressedClick:!1,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,t){var n,r,i;const s=this,{constructor:o}=s,a=super.updateElement(e,t),l=s.peekConfig("menu"),c=!!l&&(l.isWidget?l.role:(null===(n=o.resolveType(l.type))||void 0===n||null===(r=n.configurable)||void 0===r?void 0:r.role)||(null===(i=o.configurable.menuDefaults)||void 0===i?void 0:i.type)||"menu");return s.ariaHasPopup=c,a}compose(){const{color:e,href:t,icon:n,iconAlign:r,pressed:i,pressedIcon:s,target:o,text:a,toggleable:l,toggleGroup:c,menuIcon:d,behaviorType:u}=this,h=this.hasConfig("menu"),g=i&&s?s:n;return{tag:t?"a":"button",href:t,target:o,type:u,class:{[`b-icon-align-${r}`]:n,[e]:Boolean(e),"b-pressed":i&&l,"b-text":Boolean(a),"b-has-menu":h},[l&&!h?"aria-pressed":""]:i,dataset:{group:c},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(n||s)&&{"aria-hidden":!0,tag:"i",class:{...Tn.normalize(g,"object"),"b-icon":Al.test(g),"b-fa":Fl.test(g)}},label:a&&{tag:"label",for:this.id,text:a},menuIconElement:h&&d&&{tag:"i",class:{"b-icon":Al.test(d),"b-fa":Fl.test(d),"b-button-menu-icon":1,[d]:1}}}}}configureOverflowTwin(e){const t=this,n=super.configureOverflowTwin(e);return n.text||(n.text=t.text||t.tooltipText),n}onHide(){var e;null===(e=this._menu)||void 0===e||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),null===(t=this.menu)||void 0===t||t.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}changeToggleable(e){return e===Pl?this.toggleGroup||this.config.menu:e}changeMenu(e,t){const n=this,{element:r}=n;return e?(e.isWidget?(e.forElement=r,e.owner=n,e.constrainTo=n.rootElement):("object"!=typeof e||Ol.some((t=>t in e))||(e={lazyItems:e}),e=ba.reconfigure(t,e?Xt.merge({owner:n,constrainTo:n.rootElement,forElement:r},n.menuDefaults,e):null,n)),e.align.constrainPadding=10,n.detachListeners(Ll),e.ion({name:Ll,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):null==t||t.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;if(!t.toggleable||t.isConfiguring)return;const{menu:n}=t;e&&Br.forEachSelector(t.rootElement,`button[data-group=${t.toggleGroup}]`,(e=>{e!==t.element&&(ba.getById(e.id).pressed=!1)})),n&&(n.initialConfig.minWidth||(n.minWidth=t.width),n.align.minHeight=n._minHeight??100,n.align.minWidth=n._minWidth??100,n[e?"show":"hide"]()),t.trigger("toggle",{pressed:e,userAction:t._isUserAction})}onInternalMousedown(e){var t;null!==(t=this._menu)&&void 0!==t&&t.containsFocus&&this.pressed&&e.preventDefault()}onInternalClick(e){const t=this,n={event:e};if(!t.disabled){if(t._isUserAction=!0,t.toggleable){if(t.toggleGroup&&t.pressed&&!t.supportsPressedClick)return;if(t.toggleGroup&&t.pressed||t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),t.href||(e.preventDefault(),e.stopPropagation()),t._isUserAction=!1}}toggle(e=!this.pressed){!1!==this.trigger("beforeToggle",{pressed:e,userAction:this._isUserAction})&&(this.pressed=e)}}$l.initClass(),$l._$name="Button";const _l={refs:"element"},jl=e=>e.element.style.margin="",Bl=e=>e.isToolbar,Vl=e=>e[0]+(e[1].minifiable?0:9e9),Hl={hidden:!1,width:""},Nl={...Hl,flex:""},zl=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],Wl={delay:0,startRate:40,endRate:200,accelerateDuration:500},Ul={menu:1,pressed:1};class Gl extends(Fa.mixin(Sl)){static $name="Toolbar";static type="toolbar";static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,ariaLabel:"Show overflowing items",defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const t=e.filter((e=>"none"!==e.overflowable));return t.forEach(((e,n)=>t[n]=[n,e])),t.sort(((e,t)=>Vl(t)-Vl(e))),t}compose(){const e=this,{axisProps:t,dock:n}=e,r=e.getEndTools(_l),i=e.getStartTools(_l);return{class:{[`b-dock-${n}`]:1,[`b-${n}-toolbar`]:1,[`b-${t.box}`]:1},children:{...i,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...r}}}get axisProps(){return zl[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return null===(e=this.tools)||void 0===e?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return"string"==typeof e?e:null==e?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),null===(t=e.syncRotationToDock)||void 0===t||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){Me.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((e=>this.processAddedLeafItem(e)))}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){const t=this,{layout:n}=t,{vertical:r}=n;if(n.vertical=Ga(e)[1],!t.initialItems){r!==n.vertical&&t.updateOverflow(t.overflow);for(const n of t.childItems){var i;null===(i=n.syncRotationToDock)||void 0===i||i.call(n,e)}}}updateOverflow(e,t){var n;const r=this,{axisProps:i,contentElement:s,overflowType:o}=r,{flexDir:a}=i,l=null===(n=r.overflowMenuButton)||void 0===n?void 0:n._menu,c={};var d;if(l&&(e?null==l||l.removeAll():l.eachWidget((e=>{e._overflowTwinOrigin.overflowTwin=null}))),"menu"===t?c.overflowMenuButton=null:"scroll"===t&&(c.overflowScrollStart=c.overflowScrollEnd=null),"menu"===o)null===(d=r.scrollable)||void 0===d||d.destroy(),s.style.overflow=s.style.overflowX=s.style.overflowY="",c.overflowMenuButton={cls:{[`b-${a}-menu`]:1}};else if("scroll"===o){const t="object"==typeof e&&(null==e?void 0:e.repeat)||Wl;r.scrollable={[i.overflow]:"hidden-scroll",element:s,internalListeners:{scroll:"onContentScroll",thisObj:r}},c.overflowScrollStart={repeat:t,invertRotate:!0,cls:{[`b-${a}-start-scroller`]:1}},c.overflowScrollEnd={repeat:t,invertRotate:!0,cls:{[`b-${a}-end-scroller`]:1}}}r.tools=c,o?(s.classList.add("b-overflow"),r.monitorResize=!0,r.syncOverflowVisibility()):(s.classList.remove("b-overflow"),r.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:n,isVisible:r}=e,{clientSizeProp:i,edgeProp:s,sizeProp:o}=e.axisProps,{overflowMenuButton:a,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d=e.rtl&&e.layout.horizontal,u="menu"===t,h=()=>Math.ceil(n[i]+(!l||l.hidden?0:l.rectangle("outer")[o])+(!c||c.hidden?0:c.rectangle("outer")[o])),g=()=>{if(0===x.length)return 0;const e=x[x.length-1].rectangle(n);return Math.floor(d?n[i]-e.left:e[s])};let m,p,f,v,y,b,C,S,D,w,E,x;if(r&&t&&0!==e.items.length){if(e.inSyncOverflowVisibility=!0,null==a||a.hide(),e.eachWidget(((e,t)=>{C=e.minifiable,w=e.overflowable,w=C?w||C:w,e.floating?t.down=!1:(t.down=!w,e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e._toolbarMinified&&(e.minified=e._toolbarMinified=!1),e.isVisible&&(C&&(S||(S=[])).push(e),w&&(x||(x=[])).push(e))))})),x&&(m=h(),p=g()),x&&p>m)if(u){for(;p>m&&(y=null===(R=S)||void 0===R?void 0:R.pop());){var R;b=p,y._toolbarMinified=!0,y.minified=!0,p=g(),b-=p,(D||(D=[])).push([y,b])}if(p>m){for(f of(a.show(),m=h(),v=Gl.getEvictionList(x),v))p>m&&(y=f[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,x.splice(x.indexOf(y),1),(E||(E=[])).push(f),p=g());if(E){for(E.sort(((e,t)=>e[0]-t[0])).forEach(((e,t)=>E[t]=e[1]));null!==(T=D)&&void 0!==T&&T.length;){var T;[y,b]=D.pop(),p+b<=m&&!y._toolbarOverflow&&(p+=b,y.minified=y._toolbarMinified=!1)}e.syncOverflowMenuButton(E)}else a.hide()}}else c.show(),l.show(),e.syncScrollerState();else u||(null==c||c.hide(),null==l||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const n=this,{axisProps:r,overflowMenuButton:i}=n,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:r.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(n.addToMenu(s,e.filter((e=>n.overflowItemFilter(e)))),null!==(t=i._menu)&&void 0!==t&&t.isMenu){const e=i.menu,{toAdd:t,toRemove:n}=H.delta(s.items,e.items,1);if(e.remove(n),e.items.length)for(let n=t.length-1;n>=0;n--)e.insert(t[n],0);else e.add(t)}else i.menu=s}syncScrollerState(){const{axisProps:e,scrollable:t}=this,{overflowScrollStart:n,overflowScrollEnd:r}=this.tools,i=t[e.pos],s=t[e.max];n.disabled=!i,r.disabled=Math.abs(Math.ceil(i))>=Math.abs(s)}overflowItemFilter(e){const{filter:t}=this.overflow;return Boolean(t?t.call(this,e):Br.getChildElementCount(e.element))}addToMenu(e,t){const n=this.horizontal?Nl:Hl;for(const r of t){const t=r.ensureOverflowTwin(n,jl);e.items.push(t)}}onLeafItemConfigChange(e,{name:t,value:n}){const r=this,i=r.up(Bl),s=i.hasConfig("overflow"),{overflowTwin:o}=r;!s||null!=i&&i.inSyncOverflowVisibility||"hidden"===t&&n===r._toolbarOverflow||(o&&!Ul[t]&&(o[t]=n),null!=i&&i.isPainted&&"overflowMenuButton"!==r.ref&&(r.isTextField&&"value"===t&&(r.containsFocus||null!=o&&o.containsFocus)||i.syncOverflowVisibility()))}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}Gl.initClass(),Gl._$name="Toolbar";const Yl=e=>!e.classList.contains("b-focus-trap")&&Br.isFocusable(e)?Br.NodeFilter.FILTER_ACCEPT:Br.NodeFilter.FILTER_SKIP,ql=[],Kl={},Xl=[ql,ql],Zl=(e,t,n)=>{const{vertical:r}=e;return delete e.vertical,{...e,class:{...t,[`b-${r?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!n}}},Jl=(e,t,n=!1)=>{const r={vertical:n,children:e?[e]:[]};return t&&(r.tag=t),r},Ql=(e,t)=>{null!=e&&e.classList?null==e||e.classList.add(t):null!=e&&e.class&&("string"==typeof e.class&&(e.class={[e.class]:1}),e.class[t]=1)},ec={dock:1,hidden:1,weight:1},tc={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},nc={header:1,"pre-header":1};class rc extends(Fa.mixin(Ri,Sl)){static $name="Panel";static type="panel";static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,t){const n=super.updateElement(e,t);return this.titleElement&&Br.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),n}compose(){const e=this,{collapsible:t,focusable:n,hasItems:r,revealed:i,tools:s}=e,o=e.composeHeader(),a=(null==o?void 0:o.class["b-dock-left"])||(null==o?void 0:o.class["b-dock-right"]);let l=e.composeBody(),c="bodyWrapElement";return t&&([c,l]=t.wrapCollapser(c,l)),{tabIndex:r&&!1!==n||n?0:null,class:{[`b-panel-collapsible-${null==t?void 0:t.type}`]:t,[`b-panel-collapse-${null==t?void 0:t.collapseDir}`]:t,[`b-${a?"h":"v"}box`]:1,"b-panel-collapsible":t,"b-panel-has-header":o,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":i},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:o,[c]:l,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){var e,t;const n=this,{bodyCls:r,bodyConfig:i,bodyWrapTag:s,footer:o,uiClassList:a}=n,l=Xt.values(n.strips,((e,t)=>!tc[null==t?void 0:t.dock])).sort(n.byWeightSortFn),c={top:null,right:null,bottom:null,left:null};let d,u,h,g,m,p,f;for(o&&(h=o.dock||"bottom",l.unshift({dock:h,element:{tag:"footer",reference:"footerElement",html:"string"==typeof o?o:o.html,class:{...a,[`b-dock-${h}`]:1,[`${o.cls||""}`]:1}}})),r&&(i[m="className"]||(m="class"),i[m]=new Tn(i[m]).assign(r)),g=l.length;g-- >0;)d=l[g],[p,u]=tc[d.dock],f?f.vertical!==p&&(f=Jl(Zl(f,a),"",p)):f=Jl(i,s,p),f.children[u?"unshift":"push"](d.element),c[d.dock]=d;Ql(c.top,"b-innermost"),Ql(c.right,"b-innermost"),Ql(c.bottom,"b-innermost"),Ql(c.left,"b-innermost");const v=Zl(f||Jl(i,s),a,!0);return v.class[`${null===(e=n.layout)||void 0===e?void 0:e.containerCls}-panel`]=Boolean(null===(t=n.layout)||void 0===t?void 0:t.containerCls),v.class["b-panel-body-wrap"]=1,v.class[`b-${n.$$name.toLowerCase()}-body-wrap`]=1,v}get hasHeader(){if(!1===this.header)return!1;const{header:e,title:t,tools:n,parent:r}=this,i=this.maximizable||Object.values(n||{}).some((e=>!e.hidden));return e||!(null!=r&&r.suppressChildHeaders)&&(t||i)}get rootUiClass(){return rc}composeHeader(e){var t;const n=this;if(!n.hasHeader&&!e)return;const r=n.header||{},i=r.dock||"top",[s,o]=n.splitHeaderItems({as:"element",dock:i}),a=n.$meta.hierarchy,l=n.composeTitle(r),c=new Tn({[`b-dock-${i}`]:1,...n.uiClassList},r.cls);let d,u;for(d=a.indexOf(rc);d<a.length;++d)u=a[d].$$name,"Grid"!==u&&(c[`b-${u.toLowerCase()}-header`]=1);const h={tag:"header",class:c,children:[...s,l,...o]};return(null===(t=n.collapsible)||void 0===t?void 0:t.composeHeader(h))||h}composeTitle(e){var t;const n="string"==typeof e?e:this.title||e.title,r={reference:"titleElement",id:`${this.id}-panel-title`,html:n??" ",class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1,...this.uiClassList}};return Xt.isObject(n)&&(delete r.html,Xt.merge(r,n)),(null===(t=this.collapsible)||void 0===t?void 0:t.composeTitle(r))||r}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:n}=t;null===(e=t._headerClickDetacher)||void 0===e||e.call(t),t._headerClickDetacher=n&&Zn.on({element:n,click:e=>{var n;return null===(n=t.trigger)||void 0===n?void 0:n.call(t,"headerClick",{event:e})}})}onHeaderClick(e){var t;null===(t=this.collapsible)||void 0===t||t.onHeaderClick(e)}onInternalPaint(){var e;super.onInternalPaint(...arguments),null===(e=this.collapsible)||void 0===e||e.onPanelPaint(this)}splitHeaderItems({as:e,dock:t,alt:n}=Kl){const r=this,i="element"===e,{collapsed:s}=r,o=r.getEndTools({alt:n}),a=r.getStartTools({alt:n}),l=Xt.values(r.strips,((e,t)=>!nc[null==t?void 0:t.dock]&&t.isCollapsified({collapsed:s,alt:n})));let c,d,u,h=Xl;if(l.length+o.length+a.length){for(h=[d=[...a,...l.filter((e=>"pre-header"===e.dock)).sort(r.byWeightSortFn)],c=[...l.filter((e=>"header"===e.dock)).sort(r.byWeightReverseSortFn),...o]],u=0;u<d.length;++u){var g,m;t&&(null===(g=(m=d[u]).syncRotationToDock)||void 0===g||g.call(m,t)),i&&(d[u]=d[u].element)}for(u=0;u<c.length;++u){var p,f;t&&(null===(p=(f=c[u]).syncRotationToDock)||void 0===p||p.call(f,t)),i&&(c[u]=c[u].element)}}return h}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,n=Xt.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(rc,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return t&&(n.tag=t),!e.initializingElement&&e._element||(n.html=e.content||e._html),n}changeBodyCls(e){return Tn.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,n=Xt.values(t.strips,((e,t)=>!tc[null==t?void 0:t.dock])).sort(t.byWeightSortFn),[r,i]=t.splitHeaderItems(),[s,o]=(null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||Xl;return[...r,...s,...i,...o,...n.filter((e=>tc[e.dock][1])),...t._items||ql,...n.filter((e=>!tc[e.dock][1])).reverse()]}changeStrips(e,t){const n=this,r=n.$strips||(n.$strips=new vl({configName:"strips",factory:ba,inferType:!1,owner:n,created(e){var t;const{dock:i}=e;if(!nc[i]&&!tc[i])throw new Error(`Invalid dock value "${i}"; must be: top, left, right, bottom, header, or pre-header`);Me.after(e,"onConfigChange",((e,{name:t})=>{ec[t]&&n.onConfigChange({name:"strips",value:r.target})})),e.innerItem=!1,n.onChildAdd(e),e.parent=n,null===(t=e.layout)||void 0===t||t.renderChildren(),e.hasItems&&(n.hasItems=!0)},setup:(e,t)=>((e=Xt.merge(Xt.clone(n.stripDefaults["*"]),n.stripDefaults[t],e)).parent=n,e.ref=t,e),transform:e=>(Array.isArray(e)&&(e={items:e}),e||null)}));if(r.update(e),!t)return r.target}get collapsing(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsing}get collapsingExpanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsingExpanding}get expanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:n}=t;if(t.recompose.flush(),e=Boolean(e),!n||t.changingCollapse||!t.isPainted)return e;null==n||n.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const n=this;return n.getConfig("tools"),e&&(!0===e?e={}:"string"==typeof e&&(e={[tc[e]?"direction":"type"]:e})),pl.reconfigure(t,e,{owner:n,defaults:{panel:n},cleanup(){n.collapsed&&(t.collapse({animation:null,collapsed:!1}),n._collapsed=1)}})}updateCollapsible(e){const t=this,n=null==e?void 0:e.toolsConfig;t.tools={collapse:(null==n?void 0:n.collapse)||null,recollapse:(null==n?void 0:n.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),1===t.collapsed&&(t.collapsed=!0)}_collapse(e,t){var n;return!0!==t&&t!==i&&(!1===t?e.collapsed=!e.collapsed:"number"==typeof t?e.animation={duration:t}:null===t?e.animation=t:!0===t||("animation"in t?Xt.merge(e,t):e.animation=t)),null===(n=this.collapsible)||void 0===n?void 0:n.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e;return this._expandedHeaderDock??(null===(e=this.initialConfig.header)||void 0===e?void 0:e.dock)??"top"}set expandedHeaderDock(e){this._expandedHeaderDock=null==e?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=null==e?void 0:e.dock)}updateTrapFocus(e){var t;const n=this;n.element.classList[e?"add":"remove"]("b-focus-trapped"),n.focusTrapListener=null===(t=n.focusTrapListener)||void 0===t?void 0:t.call(n),e&&(n.focusTrapListener=Zn.on({element:n.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:n}),n.treeWalker||(n.treeWalker=this.setupTreeWalker(n.element,Br.NodeFilter.SHOW_ELEMENT,Yl)))}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}onFocusTrapped(e){const t=this,n=t.treeWalker;if(e.target===t.bottomFocusTrap)n.currentNode=t.topFocusTrap,n.nextNode();else{if(e.target!==t.topFocusTrap)return;n.currentNode=t.bottomFocusTrap,n.previousNode()}t.requestAnimationFrame((()=>n.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList;var n;e.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${(null===(n=e.header)||void 0===n?void 0:n.dock)||"top"}`);return e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}rc.initClass(),rc._$name="Panel";class ic extends rc{static $name="Popup";static type="popup";static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this,{forElement:t}=e;e.anchoredTo=t,e.initialAnchor=e.anchor,t&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),Zn.on({element:t,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),!e.autoShow||t&&!Br.isVisible(t)||(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments);const n=this;e&&n.headerElement&&Zn.on({element:n.headerElement,dblclick:n.onHeaderDblClick,thisObj:n})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.modal&&"destroy"===e.closeAction&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout((()=>e.element.classList.add("b-using-keyboard")),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){Br.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){const t=this;"Escape"===e.key&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}onDocumentMouseDown({event:e}){const t=this,{owner:n}=t,{target:r}=e;if("touchend"!==e.type&&null!=n&&n.isButton&&n._menu===t&&n.element.contains(r))return e.preventDefault(),!1;t.modal&&r===ic.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(r)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return Br.isVisible(ic.modalMask)&&this.element.previousElementSibling===ic.modalMask}onFocusIn(e){const t=Br.getActiveElement(this);super.onFocusIn(e),Br.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){r.visualViewport&&r.visualViewport.height<document.documentElement.clientHeight-1||this.modal||!this.autoClose||this.close(),super.onFocusOut(e)}onShow(){var e;const t=this;(t.autoClose||t.modal)&&t.addDocumentMouseDownListener(),t.focusOnToFront&&t.focus(),null===(e=super.onShow)||void 0===e||e.call(this),t.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=An.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:t,element:n}=e;if(n.setAttribute("aria-modal",Boolean(t)),t&&e.isVisible)"number"!=typeof e._x&&"number"!=typeof e._y&&(e.centered=!0,e.anchor=!1),e.modalMask.classList.remove("b-hide-display"),e.modalMask.classList.toggle("b-modal-transparent",Boolean(t.transparent)),n.classList.add("b-modal");else if(e.isPainted){n.classList.remove("b-modal");const t=e.floatRoot.querySelectorAll(".b-modal"),r=t.length?ic.fromElement(t[t.length-1],"popup"):null;r?r.syncModalMask():ic.modalMask.classList.add("b-hide-display")}}onHide(){var e,t;const n=this;null===(e=n.mouseDownRemover)||void 0===e||e.call(n),n.mouseDownRemover=null,null===(t=super.onHide)||void 0===t||t.call(this),n.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=ic;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=Br.createElement({className:"b-modal-mask b-hide-display"}),Zn.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}}ic.initClass(),ic._$name="Popup";const sc={left:!0,right:!0,top:!0,bottom:!0,transform:!0},oc={true:1,false:1},ac=Promise.resolve();class lc extends ic{static $name="Tooltip";static type="tooltip";static get configurable(){return{autoHide:!0,mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:null,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:null,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!1!==e.showOnHover,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=Zn.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;null===(e=this.pointerOverOutDetacher)||void 0===e||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&Br.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:n}=t;n&&Br.isTouchEvent&&e.pageX===n.pageX&&e.pageY===n.pageY&&t.activeTarget.contains(e.target)&&performance.now()-n.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,{target:n,relatedTarget:r}=e,{forElement:i,forSelector:s,activeTarget:o}=t;let a;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled||t.allowOver&&t.element.contains(n))){if(s){if(a=t.filterTarget(n),null!=o&&o.contains(n)&&o.contains(r)&&a===o)return;if(a&&(null==r?void 0:r.closest(s))===a)return}else{if(i.contains(r))return;a=i}a?t.handleForElementOver(e,a):o&&t.handleForElementOut()}}filterTarget(e){return e.closest(this.forSelector)}onTransitionEnd(e){const t=this,{currentOverElement:n}=lc;if(sc[e.propertyName]){var r;if(t.allowOver&&t.element.contains(n))return;null!==(r=t.activeTarget)&&void 0!==r&&r.contains(n)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const n=this,{activeTarget:r,hideOnDelegateChange:i,anchorToTarget:s}=n,o=t!==r,a=o&&i;if(!1===n.trigger("pointerOver",{event:e,target:t}))n.internalOnPointerOut(e);else{if(n.triggeredByEvent=e,n.hasTimeout("hide")&&(n.abortDelayedHide(),!o))return;if(!i&&n.element.classList.contains("b-hiding")&&n.cancelHideShowAnimation(),!n._hidden&&a&&n.hide(!1),n.activeTarget=t,n.isVisible){const e=n.updateContent();if(p.isPromise(e)&&!n.loadingMsg&&await e,!1===n.trigger("beforeShow"))return n.hide();n.alignTo({[s?"target":"position"]:s?t:"mouse",overlap:!(s&&n.anchor)}),n.trigger("show"),n.afterShowByTarget()}else n.delayShow(t)}}async delayShow(e){var t;const n=this;if(null!==(t=n.currentAnimation)&&void 0!==t&&t.showing&&n.cancelHideShowAnimation(),n.isVisible||n.hasTimeout("show"))n.isVisible&&n.showByTarget(e);else if(!n.hoverDelay||n.forSelector&&Date.now()-n.lastHidden<n.quickShowInterval){const t=n.updateContent();p.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}else n.addDocumentMouseDownListener(),n.listeningForMouseMove||n.anchorToTarget||(n.mouseMoveRemover=Zn.on({element:n.rootElement,mousemove:"onMouseMove",thisObj:n})),n.setTimeout((async()=>{if(n.activeTarget===e&&e.isConnected){const t=n.updateContent();p.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}}),n.triggeredByEvent&&"pointerover"!==n.triggeredByEvent.type?0:n.hoverDelay,"show")}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){const t=this,{element:n}=t;var r;(n.classList.toggle("b-allow-over",Boolean(e)),e)?t.allowOverlisteners=Zn.on({element:n,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t}):null===(r=t.allowOverlisteners)||void 0===r||r.call(t)}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return Boolean(Br.isReactElement(this._html)||""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${e}\n                </div>\n            `)}showByTarget(e){var t;const n=this,{anchorToTarget:r}=n;n.mouseMoveRemover=null===(t=n.mouseMoveRemover)||void 0===t?void 0:t.call(n),n.showBy({[r?"target":"position"]:r?e:"mouse",overlap:!(r&&n.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t}=e;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.element.parentNode&&e.toFront(),e.mouseMoveRemover||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=Zn.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||0!=e.configuredAllowOver&&e.childItems.some((e=>e.isVisible&&!e.disabled&&e.focusElement)),e.inAfterShow=!1}updateActiveTarget(e,t){e&&!this.isConfiguring&&this.trigger("overTarget",{newTarget:e,lastTarget:t})}internalOnPointerOut(e){var t;const n=this,r=e.relatedTarget;n.allowOver&&n.element.contains(r)||n.element.contains(e.target)&&null!==(t=n.activeTarget)&&void 0!==t&&t.contains(r)||n.activeTarget&&!n.activeTarget.contains(r)&&n.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;if(!1===e.trigger("pointerOut"))return e.activeTarget=null,!0;e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.isVisible&&(t.afterShowByTarget(),!t.forElement||t.transitionEndDetacher||t._hidden||(t.transitionEndDetacher=Zn.on({element:t.forElement,transitionend:"onTransitionEnd",thisObj:t})))}get hideDelay(){return!!this.autoHide&&this._hideDelay}hide(){const e=this;if(e.abortDelayedShow(),e._hidden)return ac;{var t,n;e.abortDelayedHide();const r=super.hide(...arguments);return e.lastHidden=Date.now(),e.activeTarget=null,null===(t=e.mouseMoveRemover)||void 0===t||t.call(e),e.mouseMoveRemover=null,null===(n=e.transitionEndDetacher)||void 0===n||n.call(e),e.transitionEndDetacher=null,r}}abortDelayedShow(){const e=this;var t,n,r;e.hasTimeout("show")&&(null===(t=e.mouseDownRemover)||void 0===t||t.call(e),e.mouseDownRemover=null,e.clearTimeout("show"),null===(n=e.mouseMoveRemover)||void 0===n||n.call(e),e.mouseMoveRemover=null,null===(r=e.transitionEndDetacher)||void 0===r||r.call(e),e.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;e.isConfiguring||e.isVisible||null==t||!t.targetOutOfView||(t.allowTargetOut||Br.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this,n=(t.mouseOffsetX||1)*(t.rtl?-1:1),i=t.mouseOffsetY||1,s=Math.max(Math.min(n,5),0),o=Math.max(Math.min(i,5),0);if(!t.isVisible)return;let a;t.anchorToTarget||"mouse"!==e.position||(a=new En(t.triggeredByEvent.pageX-r.scrollX,t.triggeredByEvent.pageY-r.scrollY),e.position=new En(a.x+(n||1)-(n<0?t.width:0),a.y+(i||1)-(i<0?t.height:0))),!e||t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),a&&t.lastAlignSpec.result.inflate(o,s).contains(a)&&(t.lastAlignSpec.position="mouse",t.mouseOffsetY=-i,t.mouseOffsetX=-n,t.realign(),t.mouseOffsetY=i,t.mouseOffsetX=n)}changeHtml(e){const t=this;return p.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((n=>{e.target===t.activeTarget&&(t.html=n)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const n=this;let r=""===e;r||(super.updateHtml(e,t),n.hasContent?(n.isVisible&&n.realign(),p.isPromise(e)||n.trigger("innerHtmlUpdate",{value:e})):r=!0),r&&n.hide()}onMouseMove(e){const t=this,{forElement:n,activeTarget:r}=t,i=t.hasTimeout("hide"),s=e.target;if(t.triggeredByEvent=e,!t._hidden){let o;const a=!(null==r?void 0:r.contains(s))&&t.forSelector&&r&&!i&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(s)),l=null!=n&&n.document?n.document.documentElement:n,c=l&&(l.contains?l.contains(s):16&l.compareDocumentPosition(s));if(a&&(o=t.handleForElementOut()),o||!i||c){if(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:r,event:e}]),!t.html))return void t.hide();t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onElementUserAction(e){this.internalOnPointerOver(e)}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t,n){var r,i;let s=null===(r=t.bryntum)||void 0===r||null===(i=r.tooltip)||void 0===i?void 0:i.get(lc);if(!s&&!n){var o;null!==(o=t.bryntum)&&void 0!==o&&o.tooltip||Xt.setPath(t,"bryntum.tooltip",new Map);const n=t.bryntum.tooltip;n.set(lc,!0),s=new lc({forElement:t,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isSharedTooltip:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"html"!==t&&(e[t]=e.resetCfg[t].was);e.resetCfg={};const n=ba.getById(t.id),r=(null==n?void 0:n.tipConfig)||e.gatherDataConfigs(t.dataset);if(n&&n.element!==t||!n&&t.matches(".b-widget")||null!=n&&n.disabled&&!n.showTooltipWhenDisabled)return!1;e.owner=n;for(const t in r)e.resetCfg[t]={set:r[t],was:e[t]},"listeners"===t?e.ion(r[t]):e[t]=r[t]},hide({source:e}){e.owner=null}},gatherDataConfigs(e){const t=this,n={};for(const r in e)if(r.startsWith("btip"))if(r.length>4){const i=$.uncapitalize(r.substr(4));if(i in t.getDefaultConfiguration()){const t=e[r];n[i]=oc[t]?"true"===t:isNaN(t)?t:parseInt(t,10)}}else n.html=e[r];return n},filterTarget(e){const t=e.closest(this.forSelector);if(t)return t;if(lc.showOverflow&&e.closest(".b-widget"))for(;(null===(n=e)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE;){var n;if("ellipsis"===Br.getStyleValue(e,"text-overflow")&&e.clientWidth<e.scrollWidth)return this.html=$.encodeHtml(e.textContent),e;e=e.parentNode}}}),Zn.on({element:t,mouseenter:e=>lc.currentOverElement=e.target,keydown:e=>lc.currentOverElement=e.target,capture:!0,thisObj:s}),n.set(lc,s)}return s}static encodeConfig(e){const t={};if("string"==typeof e)t.btip=e;else for(const n in e)t[`btip${"html"===n?"":$.capitalize(n)}`]=e[n];return t}}lc.initClass(),Object.defineProperty(ba,"tooltip",{get:()=>lc.getSharedTooltip(document.body,document.body)}),ba.Tooltip=lc,lc._$name="Tooltip";var cc=e=>class extends(e||ye){static $name="Labelable";static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return Boolean(this.label)}compose(){const{hasLabel:e,labelPosition:t}=this;return{class:{[`b-label-${t}`]:e,"b-has-label":e}}}changeLabel(e){return e||""}setupLabel(e){return Xt.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${e.align||"start"}`},e)}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${Br.setLength(e)}`,this.inputWrap.style.flexBasis=null==e?"":"auto")}get widgetClass(){}};class dc extends Fa{static $name="FieldContainer";static type="fieldcontainer";static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){return this.owner.inline??1===this.ensureItems().count}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}updateCollapsed(e){var t;this.collapser=null===(t=this.collapser)||void 0===t?void 0:t.destroy(),this.setCollapsedCls(e)}updateCollapser(e,t){t&&null==t.completed&&(t.reverting&&e||t.destroy()),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return null!=e&&e.collapsed}get collapsingExpanding(){return null!=this.collapser}get expanding(){const{collapser:e}=this;return null!=e&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,t){var n,r;null===(n=this.owner)||void 0===n||null===(r=n.element)||void 0===r||r.classList[t?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:t,syncableConfigs:n}=e;if(n){let r,i;for(r in n)i=n[r](t),e.eachWidget((e=>{e[r]=i}),!1)}t.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:t}=this;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}toggleCollapse(e,t){const n=this,{animation:r,collapser:i,inline:s}=n,{containerWrapElement:o}=n.owner,a=t=>{t&&(n.element.style.height="",n.togglingCollapse=!0,n.collapsed=e,n.collapser=null)};if(null==e&&(e=!n.collapsed),!1!==t&&null!==t&&(o&&n.isVisible?(!0===t?t={}:"number"==typeof t&&(t={duration:t}),t=r||t?Xt.merge({},r,t):null):t=null),t){if(i&&e!==i.collapsed)n.collapser=i.revert({finalize:a}),n.collapser.collapsed=e;else if(!i&&e!==n.collapsed){!e&&n.setCollapsedCls(!1);const{element:r}=n,{height:i}=r.getBoundingClientRect(),l=s?1:i;!e&&n.setCollapsedCls(!0),r.style.height=`${i}px`,n.collapser=za.run(Xt.merge({finalize:a,element:o,[s?"opacity":"height"]:{from:e?l:0,to:e?0:l}},t)),n.collapser.collapsed=e}}else n.togglingCollapse=!0,n.collapsed=e}}dc.initClass(),dc._$name="FieldContainer";const uc=(e,t)=>(e.weight||0)-(t.weight||0),hc=(e,t)=>(t.weight||0)-(e.weight||0),gc=[],mc={align:!0,weight:!0};class pc extends(ba.mixin(Il,cc)){static $name="Field";static type="field";static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,n;const r=this,{triggers:i}=r,s=r.isPainted&&pc.getSharedErrorTooltip(r.rootElement,!0);if(null===(e=r.inputListenerRemover)||void 0===e||e.call(r),null===(t=r.keyListenerRemover)||void 0===t||t.call(r),null===(n=r.container)||void 0===n||n.destroy(),super.doDestroy(),i)for(const e of Object.values(i))e.destroy();(null==s?void 0:s.field)===r&&s.hide()}get childItems(){const{container:e,triggers:t}=this,n=t?Object.values(t):[];return e?[...n,...e.childItems]:n}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,t){var n;let r=null===(n=e.bryntum)||void 0===n?void 0:n.errorTooltip;return r||t||(e.bryntum=e.bryntum||{},r=new lc({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const e=this,t=ba.fromElement(e.activeTarget);if(t){const n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}}),e.bryntum.errorTooltip=r),r}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}changeKeyMap(e){const t=this;let n={};e&&(t._fieldKeyMap?Xt.assign(n,t._fieldKeyMap):(t._fieldKeyMap=e,Xt.assign(n,e)));for(const e in t.triggers){var r;null!==(r=t.triggers[e])&&void 0!==r&&r.keyMap&&(n=t.mergeKeyMaps(n,t.triggers[e].keyMap,e))}return n}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=Xt.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return pc}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:n,label:r,labels:i,labelCls:s,readOnly:o,triggers:a}=e,l=Xt.values(a,((e,t)=>!t)),c=l.filter((e=>"start"===e.align)).sort(uc),d=l.filter((e=>"start"!==e.align)).sort(hc),u=e.setupLabel.bind(e),h=[...c.map((e=>e.element)),...n,...d.map((e=>e.element))];return{class:{"b-has-start-trigger":c.length,"b-no-input":!n.length,"b-readonly":o,"b-field-container":Boolean(t),"b-field-container-inline":null==t?void 0:t.inline},children:[...(i||gc).filter((e=>e&&"end"!==e.align)).map(u),r?u({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:r}):null,h.length?{class:"b-field-inner",reference:"inputWrap",children:h}:null,...(i||gc).filter((e=>"end"===(null==e?void 0:e.align))).map(u),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:gc]}}updateElement(e,t){var n;const r=this,i=r.initialConfig.value,{input:s}=r;super.updateElement(e,t),null!=i&&(r.value=i),r.syncEmpty(),r.updateInputReadOnly(r.inputReadOnly),r.syncInvalid();const o=s||r.focusElement;null===(n=r.keyListenerRemover)||void 0===n||n.call(r),r.keyListenerRemover=o&&Zn.on({element:o,thisObj:r,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:n,inputCls:r,inputType:i,name:s}=this,o=Xt.assign({reference:"input",tag:"input",type:i,name:s||n,id:`${n}-input`,retainElement:!0},t);r&&(o.class=r);for(let t,n,r=e.length;r-- >0;)t=e[r],n=this[t],null!=n&&(o[t]=n);return o}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch(r){var n;t=(null===(n=e.value)||void 0===n?void 0:n.length)||0,t=[t,t]}return t}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,n]=this.textSelection,r=this.input.value;return`${r.substr(0,t)}${e}${r.substr(n||t)}`}select(e,t){const n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;n.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:n,element:r}=this,i=null===(e=this.triggers)||void 0===e?void 0:e.clear,s=t&&n;r&&(i&&i[s?"hide":"show"](),r.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:n,hintHtml:r}=e,i=null==t?void 0:t.parentElement;if(t){let s=r||n;const o=e.hintElement||s&&(e.hintElement=Br.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof s&&(s=s({source:e,value:e.value})),o.firstChild[r?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:t}=e;if(e.updatingInvalid=!0,t){const{isValid:t,element:n,inputWrap:r}=e;if(n.classList[t?"remove":"add"]("b-invalid"),t){const t=e.constructor.getSharedErrorTooltip(e.rootElement,!0);null!=t&&t.isVisible&&t.field===e&&t.hide()}else{const t=e.errorTip;t&&(e.containsFocus||e.isVisible&&r.contains(lc.currentOverElement))&&(t.activeTarget===r&&t.isVisible?t.onBeforeShow():(t.activeTarget=r,t.showBy(r)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:n,inputListenerRemover:r}=t;n&&(n.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==r?void 0:r():r||(t.inputListenerRemover=Zn.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&Xt.assign({cls:"b-icon-remove",weight:1e3,key:"Shift+backspace",handler(){t._isUserAction=!0,t.clear(...arguments),t._isUserAction=!1}},e)||null}}changeTriggers(e,t){const n=this,r=n.$triggers||(n.$triggers=new vl({configName:"triggers",factory:pc.Trigger,inferType:!1,owner:n,created(e){Me.after(e,"onConfigChange",((e,{name:t})=>{mc[t]&&n.onConfigChange({name:"triggers",value:r.target})}))},setup(e,t){e.reference=e.ref=t,e.parent=n}}));if(!1===n.stepTriggers&&(e.back||e.forward)&&(delete(e=Xt.assign({},e)).back,delete e.forward),r.update(e),n.element&&(n.keyMap=n.keyMap),!t)return r.target}updateInputWidth(e){this.input.style.width=Br.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return null==e?void 0:e.validity}async setValue(e){this.value=e}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const n=this;n.isConfiguring||(n.syncRequired(),n.inputting||n.triggerChange()),n.inputting||(n._lastValue=e),n.syncInputFieldValue(),n.overflowTwin&&!n._overflowTwinSync&&(n._overflowTwinSync=!0,n.overflowTwin.value=e,n._overflowTwinSync=!1)}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:n,parent:r,inputValueAttr:i,inputValue:s}=t;if(n&&!t.inputting&&n[i]!==s&&(n[i]=s,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(n.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),r){const{assigningValues:t}=r;!0!==t&&!1!==(null==t?void 0:t.highlight)||(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const n=this,{value:r,_lastValue:i,isValid:s}=n;n.syncHint(),n.triggerFieldChange({value:r,oldValue:i,event:e,userAction:t,valid:s}),"change"===n.defaultAction&&n.trigger("action",{value:r,oldValue:i,event:e,userAction:t,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const n=this;n.validateOnInput||n.errorTip.hide(),n.inputting=!0,n.fetchInputValue(),n.inputting=!1,n.trigger("input",{value:n.value,event:e}),null===(t=n.changeOnKeyStroke)||void 0===t||t.call(n,e)}get needsInputSync(){return this.input[this.inputValueAttr]!==String(this.inputValue??"")}internalOnKeyEvent(e){const t=this,{value:n}=t;let r=!1;if("keydown"===e.type&&"Escape"===e.key&&!t.readOnly&&!t.disabled){const e=t.isValid,i="initialValue"in t?t.initialValue:t.valueOnFocus,s=t.hasChanged(i,n),{needsInputSync:o}=t;t.revertOnEscape&&(!e||s||o)&&(s&&(t.value=i),o&&t.syncInputFieldValue(!0),t.clearError(),r=(s||o)&&t.isValid||e!==t.validOnFocus)}t.isDestroyed||(r&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(e){const t=this,{value:n}=t;(n!==t.nullValue||t.input.value.length>0)&&(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.trigger("clear",{event:e}))}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;t.isConfiguring||t.focusing||!t.required||!t.isEmpty||null!==(e=t.parent)&&void 0!==e&&e.isSettingValues?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}setError(e,t,n){const r=this;if((r.errors||(r.errors={}))[r.optionalL(e)]=1,t||r.syncInvalid(),n){const t=()=>{r.clearError(e),n()},n=r.ion({keydown:t,focusOut:t})}}clearError(e,t){const n=this;n.errors&&(e?delete this.errors[this.optionalL(e)]:n.errors={}),t||n.syncInvalid()}getErrors(){const e=this;if(!e.isValid){var t;const n=e.validity,r=Xt.keys(n).find((e=>"valid"!==e&&"customError"!==e&&n[e])),i=e.errors&&Object.keys(e.errors);let s;if(s=null!=i&&i.length?i:n.customError?[e.input.validationMessage]:r?[e.L(r,{min:e.min,max:e.max})]:[e.L(e.invalidValueError)],(null===(t=s)||void 0===t?void 0:t.length)>0)return s}}createOverflowTwin(e){const t=this,n=super.createOverflowTwin(e);return n.ion({change({value:e}){t._overflowTwinSync=!0,t.value=e,t._overflowTwinSync=!1}}),n}get containerCollapsed(){var e;return null===(e=this.container)||void 0===e?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e)&&!("items"in e))&&(e={items:e});const n=this,r=e&&Xt.merge({owner:n,layout:"box"},n.containerDefaults),i=ba.reconfigure(t,e,{owner:n,defaults:r});if(!i||(i.autoLayout="box"===(null==r?void 0:r.layout),i!==t))return i;i.syncContainer()}onConfigChange(e){var t,n;super.onConfigChange(e),null!==(t=this.container)&&void 0!==t&&null!==(n=t.syncConfigTriggers)&&void 0!==n&&n[e.name]&&this.container.syncChildConfigs()}assignValue(e,t){const{container:n,containValues:r}=this,i=this.getValueName(t);n&&!1!==r?e&&"nested"===r?e&&i in e&&(e=Xt.clone(e[i]),super.assignValue({[i]:e&&!("value"in e)||e.value},t),e&&delete e.value,n.assignValue(e,t)):(super.assignValue(e,t),n.assignValue(e,t)):super.assignValue(e,t)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){const n=this,{container:r,containValues:i,valueName:s}=n,o=typeof i;t=t??s in e,r&&!1!==i&&("nested"===i?t&&(e[s]={value:e[s],...r.values}):(!0===i||null==i&&t||"string"===o&&n[i]||"function"===o&&i(n))&&r.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}}pc.Trigger=class extends ba{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:pc.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:i}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.key&&e.preventDefault(),!1!==n.trigger("trigger",{trigger:t})&&t.handler&&n.callback(t.handler,n,[e,t]))}onMousedown(e){const t=this.field;!("key"in e)&&Br.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),Br.getActiveElement(t.input)!==t.input&&t.focus()}},pc.SpinTrigger=class extends pc.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;null===(t=this.clickRepeater)||void 0===t||t.destroy(),this.clickRepeater=e?pi.new({element:this.element},e):null}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.target===t.upButton?n.doSpinUp(e.shiftKey):e.target===t.downButton&&n.doSpinDown(e.shiftKey))}},pc.Trigger.initClass(),pc.SpinTrigger.initClass(),ba.register(pc.Trigger,"trigger"),ba.register(pc.SpinTrigger,"spintrigger"),pc._$name="Field";class fc extends pc{static $name="TextField";static type="textfield";static alias="text";static get configurable(){return{nullValue:""}}construct(e){"hidden"===(null==e?void 0:e.inputType)&&(e.hidden=!0),super.construct(...arguments)}}fc.initClass(),fc._$name="TextField";class vc extends fc{static $name="PickerField";static type="pickerfield";static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;null===(e=this.globalTapListener)||void 0===e||e.call(this),super.doDestroy()}changeEditable(e){return o.isMobile&&!0!==this.initialConfig.editable&&(e=!1),e}updateAutoClose(e){!e&&_.deprecate("Core","6.0.0","PickerField.autoClose is no longer supported")}updateEditable(e){const t=this,{element:n,ariaElement:i,nonEditableClickTarget:s}=t,{expand:a}=t.triggers,l=r.matchMedia("(max-width: 410px)").matches;var c;(super.updateEditable(...arguments),n.classList.toggle("b-not-editable",!e),!1===e)?(o.isMobile&&l&&(null==a||a.hide()),i.removeAttribute("aria-autocomplete"),null===(c=t.globalTapListener)||void 0===c||c.call(t),Zn.on({element:s,click:e=>{const n=s.getRootNode().elementFromPoint(e.clientX,e.clientY);e.target===s&&n===s&&t.onTriggerClick(e)},thisObj:t})):(null==a||a.show(),i.setAttribute("aria-autocomplete","list"),t.globalTapListener=An.ion({globaltap:"showKeyboard",thisObj:t}))}get nonEditableClickTarget(){return this.input}updateElement(e,t){var n;const r=super.updateElement(e,t),i=this.peekConfig("picker"),s=!!i&&(i.isWidget?i.role:null===(n=this.constructor.resolveType(i.type))||void 0===n?void 0:n.$meta.config.role);return Br.setAttributes(this.ariaElement,{"aria-expanded":!1}),this.ariaHasPopup=s,r}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let n=!0;if("keydown"===e.type&&!t.disabled&&!e.shiftKey&&!e.ctrlKey)if(t.pickerVisible){const{picker:r}=t;"Escape"===e.key?(e.preventDefault(),e.stopImmediatePropagation(),t.hidePicker(),n=!1):r.onInternalKeyDown?r.onInternalKeyDown(e):"ArrowDown"===e.key&&r.focusable&&r.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));n&&super.internalOnKeyEvent(e)}onFocusIn(e){const t=this;super.onFocusIn(e),t.autoExpand&&(t.minChars=0,t.onTriggerClick(e),t.ignoreTriggerClick=!0,t.setTimeout((()=>t.ignoreTriggerClick=!1),100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;Br.isTouchEvent&&Br.getActiveElement(t)===t&&e.target===t&&(An.suspendFocusEvents(),t.blur(),t.focus(),An.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:n}=t;t.pickerHideShowListenersAdded||(n.ion({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),Br.setAttributes(t.ariaElement,{"aria-controls":n.id,"aria-expanded":!0}),n.autoClose=t.autoClose,n.show(),n.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=An.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=Zn.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const n=this;n.ariaElement.setAttribute("aria-expanded",!1),n.pickerVisible=!1,n.element.classList.remove("b-open"),n.trigger("togglePicker",{show:!1}),null===(e=n.pickerTapOutRemover)||void 0===e||e.call(n),null===(t=n.pickerKeyDownRemover)||void 0===t||t.call(n)}onPickerTapOut({event:e}){this.containsFocus||this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key&&!this.picker.trapFocus){const t=Br.getActiveElement(this.input),n=new KeyboardEvent("keydown",e);this.input.dispatchEvent(n),n.defaultPrevented&&e.preventDefault(),Br.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;Br.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}}vc._$name="PickerField";const yc=/>[ \t\r\n]+</g,bc=/\s\s+/g;class Cc{static tpl(e,...t){let n=0,r=t.map(((t,r)=>{let s=e[r];return Array.isArray(t)?s+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(t===i&&(t=""),s+="string"==typeof t?t.trim():t),n++,s})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(yc,"><").replace(bc," ").trim()}static docsTpl(e,...t){let n=0,r=t.map(((t,r)=>{let s=e[r];return Array.isArray(t)?s+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(t===i&&(t=""),s+="string"==typeof t?t.trim():t),n++,s})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(yc,"><").trim()}static repeat(e){return function(...t){return Cc.tpl(...t).repeat(e)}}static loop(e){}}Cc._$name="TemplateHelper";class Sc extends(ye.mixin(Ge,Ni)){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`),Br.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:t}=this;this._navigationEvent=t.navigationEvent=e,e&&Promise.resolve(1).then((()=>this.navigationEvent=null))}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const t=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${t}`}onKeyDown(e){const t=this,{ownerCmp:n,itemSelector:r,activeItem:i,itemsTabbable:s}=t,{target:o}=e,a=t.target.querySelector(r),l=(e.key||"").trim()||e.code,c=t.constructor.getComposedKeyName(e),d=o.matches(r)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.processEvent.call(n,e)),e&&!t.disabled&&a&&t.target.offsetParent&&d){if(!s){if(null==t.inlineFlow){const e=a.parentNode,n=Br.getStyleValue(a,"position"),r=Br.getStyleValue(a,"display"),i=Br.getStyleValue(a,"float");t.inlineFlow="absolute"===n||"inline"===r||"inline-block"===r||"left"===i||"right"===i||"flex"===Br.getStyleValue(e,"display")&&"row"===Br.getStyleValue(e,"flex-direction")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,i)switch(l){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;default:{var u;const r=null===(u=t.keys)||void 0===u?void 0:u[c];if(r&&!t.disabled){if(!1===t.callback(r,t.thisObj||n,[e]))return}else n.onInternalKeyDown&&n.onInternalKeyDown(e);if(Br.getActiveElement(o)!==o&&e.preventDefault(),s)return}}else{if(s)return;l!==t.nextKey&&l!==t.prevKey||(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==i&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:n,prevKey:r,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector(`${n}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(`${n}`):void 0}navigatePrevious(e){const t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}navigateNext(e){const t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const n=this.treeWalker;if(n.currentNode=t,n[e<0?"previousNode":"nextNode"](),n.currentNode!==this.activeItem)return n.currentNode}onTargetFocusIn(e){const t=this,{target:n,relatedTarget:r}=e,{owner:i,itemsTabbable:s,skipScrollIntoView:o,previousActiveItem:a}=t;if(!n.matches(".b-focus-trap"))if(n.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=n,t.skipScrollIntoView=o,t.activeItem&&s&&t.triggerNavigate(e);else if(n===t.target){var l;if((r?n.compareDocumentPosition(r):0)&Node.DOCUMENT_POSITION_CONTAINED_BY)null===(l=i.previousSibling)||void 0===l||l.focus();else t.activeItem=a&&t.target.contains(a)?a:0}}onTargetFocusOut(e){const t=this,{relatedTarget:n}=e;null!=n&&n.matches(".b-focus-trap")||n&&t.target.contains(n)&&n.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,n=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?n===t.activeItem&&t.triggerNavigate(e):!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):n&&(e.preventDefault(),Br.focusWithoutScrolling(n))}onTargetClick(e){var t;const n=this,{skipScrollIntoView:r}=n;n.skipNextClick||null!==(t=n.navigationEvent)&&void 0!==t&&t.ignoreNavigation?n.skipNextClick=!1:n.disabled||(n.skipScrollIntoView=!0,n.processEvent&&(e=n.processEvent.call(n.ownerCmp,e)),e&&(n.activeItem=e.target.closest(n.itemSelector),n.triggerNavigate(e)),n.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?Br.NodeFilter.FILTER_ACCEPT:Br.NodeFilter.FILTER_SKIP}changeActiveItem(e){return null!=e&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){const n=this,{ownerCmp:r}=n,i=t&&n.target.contains(t),s=e&&Br.isFocusable(e)&&e!==Br.getActiveElement(e);if(i&&(n.previousActiveItem=t),t&&(t.classList.remove(n.focusCls),t.removeAttribute("id")),null!=e){var o;if(n.skipScrollIntoView)s&&Br.focusWithoutScrolling(e);else null===(o=r.scrollable)||void 0===o||o.scrollIntoView(e,{block:"nearest",focus:s,silent:n.scrollSilently});if(e===t&&i)return;e.classList.add(n.focusCls),e.id=`${n.owner.id}-active-descendant`,n._activeItem=e}else n._activeItem=null,t===Br.getActiveElement(t)&&r.revertFocus()}updateTarget(e,t){const n=this,r={element:e,thisObj:n,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:n.itemSelector}};n.itemsTabbable||n.itemsFocusable||(r.click="onTargetClick"),Object.prototype.hasOwnProperty.call(n,"acceptNode")||(n.acceptNode=n.acceptNode.bind(n),n.acceptNode.acceptNode=n.acceptNode),Zn.on(r),n.treeWalker=n.setupTreeWalker(e,Br.NodeFilter.SHOW_ELEMENT,n.acceptNode),n.keyEventTarget||(n.keyEventTarget=e),(n.targetMutationMonitor=new MutationObserver(n.onTargetChildListChange.bind(n))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}onTargetChildListChange(){const e=this,{activeItem:t,datasetIdProperty:n}=e;var r;t&&(e.target.contains(t)?t.classList.contains(e.focusCls)||t.classList.add(e.focusCls):e.activeItem=e.target.querySelector(`${e.itemSelector}.${e.focusCls}[data-${$.hyphenate(n)}="${t.dataset[n]}"]`)||(null===(r=e.target.querySelector(`${e.itemSelector}.${e.focusCls}`))||void 0===r?void 0:r[t.dataset.index])||null)}changeKeyEventTarget(e){this._keyEventTarget=e,Zn.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var n;const r={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",r),null===(n=this.ownerCmp)||void 0===n||n.trigger("navigate",r)}}Sc._$name="Navigator";const Dc=document.createRange();class wc extends ba{static $name="List";static type="list";static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,collapsibleGroups:!1,selectAllItem:!1,itemTpl(e){let t=$.encodeHtml(e.getValue(this.displayField));return null!=t&&""!==t||(t="&nbsp;"),t},getItemStyle:null,getItemCls:null,groupHeaderTpl(e,t){let n=$.encodeHtml(t);return null!=n&&""!==n||(n="&nbsp;"),`${this.allowGroupSelect?this.itemIconTpl(e):""}${n}`},allowGroupSelect:!0,clearSelectionOnEmptySpaceClick:!1,selected:{$config:["nullify","lazy"],value:[]},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...t){var n;const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:i}=r,{classList:s}=i;r.multiSelect&&s.add("b-multiselect"),null!==(n=r.store)&&void 0!==n&&n.count?r.refresh():s.add("b-empty"),Zn.on({element:i,delegate:r.itemSelector,mouseover:"onMouseOver",thisObj:r}),Zn.on({element:i,click:"onClick",thisObj:r})}doDestroy(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),super.doDestroy()}onFocusIn(e){var t;this.restoreActiveItem(null===(t=e._target)||void 0===t?void 0:t.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,t=e.store.records.map(((t,n)=>e.itemWrapperTpl(t,n)));return e.multiSelect&&!1!==e.selectAllItem&&t.unshift(e.selectAllItemTpl()),Cc.tpl`${t}`}itemWrapperTpl(e,t){const{selected:n,getItemStyle:r,store:i}=this,s=r?`style="${this.callback(r,this,[e])}"`:"";if(i.isGrouped&&!e.isGroupHeader){if(e.groupParent.get(i.id).meta.collapsed)return""}return Cc.tpl`<li ${s} class="${this.getItemClasses(e,t)}" role="option" aria-selected="${n.includes(e)}" data-index="${t}" data-id="${$.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,t)}</li>`}itemContentTpl(e,t){if(e.isGroupHeader){let t=this.groupHeaderTpl(e,$.capitalize(e.meta.groupRowFor));if(this.collapsibleGroups){t+=`<button class="b-button b-tool b-icon b-icon-collapse-${e.meta.collapsed?"right":"down"} b-list-expander-icon" data-noselect></button>`}return t}return`${this.itemIconTpl(e,t)}${this.itemTpl(e,t)}`}itemIconTpl(e,t){return this.multiSelect?`<i class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-noselect data-select-all data-id="select-all">${this.itemIconTpl({})}<div>${this.L("selectAll")}</div></li>`}getItemClasses(e){var t;const n=this,{getItemCls:r}=n,i=null===(t=n._navigator)||void 0===t?void 0:t.activeItem,s=(null==i?void 0:i.dataset.id)==e.id,o="groupRowFor"in e.meta?"b-list-item-group-header":"",a=n.selected.includes(e)||e.isSpecialRow&&e.groupChildren.every((e=>n.selected.includes(e))),l=r?this.callback(r,this,[e]):"";return`${n.itemCls} ${e.cls||""} ${l} ${a?n.selectedCls:""} ${s?n.navigator.focusCls:""} ${o}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:n,record:r,changes:i}){const s=this,{selected:o}=s;switch(t){case"dataset":o.match(e.storage,!s._externallyOwnedSelection);break;case"remove":o.remove(n);break;case"clear":s.deselectAll();break;case"update":{const{id:e}=i;return e&&Br.setAttributes(s.contentElement.querySelector($.encodeAttributeSelector("data-id",e.oldValue)),{"data-id":e.value}),void s.refreshItem(r)}}s.refresh()}onStoreRefresh(){this._selected?this.refresh():this.getConfig("selected")}refresh(){const e=this;if(e.isVisible&&e.store){var t;const n=null===(t=e.navigator)||void 0===t?void 0:t.activeItem;e.paintListener=null;const r=Br.createElementFromTemplate(e.contentTpl(),{fragment:!0});e.clearItems().insertNode(r),n&&e.restoreActiveItem(n),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty"),e.updateSelectAllState()}else e.paintListener||(e.paintListener=e.ion({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),n=e.contentElement.lastChild;if(t){const n=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);Dc.setStartBefore(t),Dc.setEndAfter(n[n.length-1]),Dc.deleteContents()}else n?(Dc.setStartAfter(n),Dc.setEndAfter(n)):(Dc.setStart(e.contentElement,0),Dc.setEnd(e.contentElement,0));return Dc}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const n=this.store.indexOf(t),r=Br.createElementFromTemplate(this.itemWrapperTpl(t,n));Br.sync(r,e)}}}getItem(e){var t;if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null===(t=e)||void 0===t?void 0:t.id)&&(e=e.id),this.contentElement.querySelector($.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){var t;const n=this,r=ao.getStore(H.asArray(e));null!==(t=n.store)&&void 0!==t&&t.autoCreated?n.store.data=(null==r?void 0:r.records)||[]:n.store=r}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,t){const n=this,r={change:"onInternalSelectionChange",thisObj:n};if(null==t||t.un(r),e)if(e.isCollection)n._externallyOwnedSelection=!0,e.ion(r);else if(n._externallyOwnedSelection=!1,e=H.asArray(e).reduce(((e,t)=>((t=t.isModel?t:n.store.getById(t))&&e.push(t),e)),[]),t)t.splice(0,t.count,e),e=t,n.refresh();else{const t=e;(e=n._selected=new Ms({internalListeners:r})).add(t)}else null==t||t.destroy();return e}updateSelected(e){e&&this.refresh()}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}updateMultiSelect(e,t){!e&&t&&this.selected.count>1&&this.deselect(this.selected.allValues.slice(1))}get store(){return this.getConfig("items"),this._store}changeStore(e){const t=this;if(e instanceof ao||(Array.isArray(e)&&(e={data:e}),e=new ao(e)),t.detachListeners("store"),e){const n={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(n.beforeLoad="onBeforeStoreLoad",n.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),n.groupchange="onStoreRefresh"),e.ion(n)}return e}updateStore(e){null!=e&&e.records.length&&this.getConfig("selected"),this.refreshCount||this.refresh()}changeNavigator(e,t){const n=this,{element:r}=n;var i;r&&((null===(i=e=Sc.reconfigure(t,e?Sc.mergeConfigs({ownerCmp:n,disabled:n.disabled,target:r,keyEventTarget:r},e):null,n))||void 0===i?void 0:i.keyEventTarget)!==r||n.itemsTabbable||(r.tabIndex=0));return e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight;const n=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(t,!0),n}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const n=this,{navigator:r,lastAlignSpec:i}=n;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=n.getItem(e))&&!n.disabled&&(n.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}onMouseOver(e){const t=this,n=e.currentTarget;!Br.isTouchEvent&&n&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t?this.onItemClick(t,e):this.clearSelectionOnEmptySpaceClick&&this.deselectAll()}onSpaceKey(e){("INPUT"!==e.target.nodeName.toUpperCase()||e.target.readOnly)&&this.onEnterKey(e)}onEnterKey(e){const t=this.navigator.activeItem;t&&!this.disabled&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}onInternalKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":t.collapseItem();break;case"ArrowRight":t.expandItem();break;case" ":t.onSpaceKey(e);break;case"Enter":t.onEnterKey(e)}}collapseItem(){const{activeItem:e}=this.navigator;e&&this.toggleCollapse(this.getRecordFromElement(e),!0)}expandItem(){const{activeItem:e}=this.navigator;e&&this.toggleCollapse(this.getRecordFromElement(e),!1)}onItemClick(e,t){const n=this,{allowGroupSelect:r}=n,i=parseInt(e.dataset.index),s=n.store.getAt(i),o=null==s?void 0:s.isSpecialRow,a=e.contains(t.target.closest("[data-noselect]"));if(!n.disabled&&!1!==n.trigger("beforeItem",{item:e,record:s,index:i,event:t,userAction:!0})){if(n._isUserAction=!0,e.contains(t.target.closest("[data-select-all]")))n.onSelectAllClick(e,t);else{if(t.target.matches(".b-list-expander-icon"))return void n.toggleCollapse(s);if(s&&!a&&(!o||r)){var l;const{selected:i}=n,a=null===(l=s.groupParent)||void 0===l?void 0:l.get(n.store.id);if(n.multiSelect){let l=i.includes(s),c=s;if(n.toggleAllIfCtrlPressed&&t.ctrlKey?c=n.store.records:r&&o&&(l=!s.groupChildren.some((e=>!i.includes(e))),e.classList.toggle("b-selected",!l),c=s.groupChildren),i[l?"remove":"add"](c),!o&&a&&r){n.getItem(a).classList.toggle("b-selected",a.groupChildren.every((e=>i.includes(e))))}}else i.splice(0,i.count,s)}}n.isDestroyed||(n.lastClicked=s,n.trigger("item",{item:e,record:s,index:i,event:t,userAction:!0}),n._isUserAction=!1)}}onInternalSelectionChange({action:e,removed:t,added:n,replaced:r}){const i=this,{selectedCls:s,unselectedCls:o}=i;let a,l;if("clear"===e)for(l of i.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),o&&l.classList.remove(o);else if("replaceValues"!==e){for(a of t)l=i.getItem(a),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(a of n)l=i.getItem(a),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}i.selectAllItem&&i.updateSelectAllState(),i.trigger("selectionChange",{selected:i.selected.values})}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;null===(e=this.element.querySelector(".b-select-all-item"))||void 0===e||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:t}=this;return e.count&&(t.isFiltered?t.records.every((t=>e.includes(t))):t.count===e.count)}selectAll(e){const t=this;!t.multiSelect&&e||(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:t}=this,{modelClass:n}=t;e=H.asArray(e).reduce(((e,r)=>((r=t.getById(n.asId(r)))&&e.push(r),e)),[]),this.selected.add(e)}deselect(e){const{modelClass:t}=this.store;e=H.asArray(e).reduce(((e,n)=>((n=this.selected.get(t.asId(n)))&&e.push(n),e)),[]),this.selected.remove(e)}toggleCollapse(e,t){e.isGroupHeader&&(t=t===i?!e.meta.collapsed:t,this.store[t?"collapse":"expand"](e),this.refresh(),this.trigger("toggleGroup",{groupRecord:e,collapse:t}))}updateCollapsibleGroups(e,t){if(t&&!e){const{store:e}=this;e.groupRecords.forEach((t=>e.expand(t)))}this.refresh()}}wc.initClass(),wc.prototype.navigatorClass=Sc,wc._$name="List";class Ec extends wc{static $name="ChipView";static type="chipview";static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const n=this;return Cc.tpl`${n.iconTpl?this.iconTpl(e):""}
            ${n.itemTpl(e,t)}
            ${n.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const t=this;t.closable&&t.selected.count&&("Delete"===e.key||"Backspace"===e.key)?t.callback(t.closeHandler,t.owner,[t.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const t=this,n=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(n.dataset.index));t.closeHandler?t.callback(t.closeHandler,t.owner,[[e]]):t.store.remove(e)}else super.onClick(e)}}Ec.initClass(),Ec._$name="ChipView";const xc="L{Field.fieldRequired}",Rc="L{Field.validateFilter}",Tc=/[\w\s]/;class Mc extends vc{static $name="Combo";static type="combo";static alias="combobox,dropdown";static delayable={filterOnInput:0};static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:i,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;Xt.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:t}=this,n=super.childItems;return e&&n.push(e),t&&n.push(t),n}get innerElements(){var e;const t=null===(e=this._chipView)||void 0===e?void 0:e.element,{input:n,inputElement:r}=this;return t&&To.sync({targetElement:n,domConfig:r}),[t||r]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return!e||e instanceof ao||(e=new ao(ao.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const n=this;if(n.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:r}=n;return n.chipStore||(n.chipStore={}),kc.reconfigure(t,e,{defaults:{parent:n,insertBefore:r,store:n.chipStore,closable:!n.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:r}}})}null==t||t.destroy()}updateChipView(e){var t;const n=this;n._chipViewEventDetacher=null===(t=n._chipViewEventDetacher)||void 0===t?void 0:t.call(n),n.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(n.input),n._chipViewEventDetacher=Zn.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:n}))}updateMultiSelect(e,t){const n=this,{input:r,element:i}=n,s=!n.isConfiguring;let{value:o}=n;if(i.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:e}=n,{parentNode:t}=r,i=null==e?void 0:e.element;i&&i!==t&&(t.insertBefore(i,r),i.appendChild(r),n.chipView.refresh()),r.value="",s&&(o=H.asArray(o))}else{const e=n._chipView,{parentNode:t}=r,l=null==e?void 0:e.element;var a;if(l===t&&(l.parentNode.insertBefore(r,l),l.remove(),i.classList.remove("b-uses-chipview")),s&&"string"!=typeof o)o=null!==(a=o)&&void 0!==a&&a.length?o[0]:null}s&&(n.value=o)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return null!=e?e:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){var t;const n=this;if(null==e){if(n.store&&!n.store.isItemStore)return;e=[]}if(!n.buildItems||null!==(t=e)&&void 0!==t&&t.length||(e=n.buildItems()),e instanceof ao)return void(n.store=e);const r=n.displayField;let i,s,o=n.valueField;if(Array.isArray(e)?s=e.map((e=>{let t=e;return e instanceof ds?(i=e.constructor,o||(n.valueField=o=i.idField)):"string"==typeof e||"number"==typeof e?(o||(n.valueField=o=n.displayField),t={[o]:e,[r]:e}):(o||(n.valueField=o="value"),Array.isArray(e)&&(t={[o]:e[0],[r]:e[1]})),e.selected&&(n.value=t),t})):(o||(n.valueField=o="value"),s=[],Object.entries(e).forEach((([e,t])=>{s.push({[o]:e,[r]:t})}))),n.store)n.store.data=s;else{const e=o===r?{name:"value",dataSource:r}:o;if(!i){class t extends ds{static get idField(){return n.valueField}static set idField(e){super.idField=e}static get fields(){return[e,r]}}i=t}n.store=new ao({isItemStore:!0,data:s,idField:o,verifyNoGeneratedIds:!1,modelClass:i})}}get value(){const e=this,{valueCollection:t,valueField:n}=e;if(null==n)return e.multiSelect?t.values.slice():t.first;let r;return r=e.multiSelect?t.count?t.map((e=>e[n])):e._lastValue||[]:t.count?t.first[n]:e._lastValue,r}set value(e){super.value=e}get needsInputSync(){return!this.usesChipView&&!this.editable}changeValue(e,t){const n=this;if(e===t)return void n.syncInputFieldValue(!0);if(!n.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");var r;(n.triggerConfig("items"),n.inputting)||(null===(r=n._chipView)||void 0===r||r.selected.clear());n.store||(n.items=[]);const{valueField:i,displayField:s,store:o,valueCollection:a,_picker:l}=n,{storage:c}=o,d=n.hidePickerOnSelect??!n.multiSelect,u=n._isUserAction||(null==l?void 0:l._isUserAction)||d&&n.pickerVisible||!1;if(!n.remoteFilter&&o.isAjaxStore&&!o.count)return o.ion({load:()=>n.value=e,once:!0,thisObj:n}),void(n._lastValue=e);let h;if(null!=e){const r=Array.isArray(e),l=r?e.slice():[e];if(n.remoteFilter){if(null!=e){if(Xt.isObject(e)||e.isModel)n.store.data=[e],n.valueCollection.splice(0,n.valueCollection.count,n.store.first);else{const t=n.isConfiguring;n.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then((()=>{if(n.isDestroyed)return;const{isConfiguring:e}=n;n.isConfiguring=t,a.splice(0,a.count,o.allRecords),n.isConfiguring=e}))}return}}else o.isFiltered&&(n.primaryFilter.disabled=!0,o.filter());for(let e=0,t=l.length;e<t;e++){let n=l[e];if(n instanceof ds)c.includes(n,!0)||o.add(n);else{const r=Xt.isObject(n);r&&(n=n[o.modelClass.fieldMap[i].dataSource]),h=c.getBy(s,n)||c.getBy(i,n)||a.getBy(s,n)||a.getBy(i,n),h instanceof Set&&(h=[...h][0]),h?(r&&h.set(l[e]),l[e]=h):(l.splice(e,1),t--,e--)}}const d=!l.length,g=a.generation;a.splice(0,a.count,l),d&&(n._value=r&&0===e.length?null:e,n._lastValue=n._value),(d||a.generation===g)&&n.syncInputFieldValue(),n.syncEmpty(),d&&!n.isConfiguring&&n.triggerFieldChange({value:e,oldValue:t,userAction:u,valid:n.isValid})}else if(a.count)a.clear();else{const t=n._value;n._value=null,n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||n.triggerFieldChange({value:e,oldValue:t,userAction:u,valid:n.isValid})}n._lastValue=n._value}hasChanged(e,t){return this.multiSelect?!Xt.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){var t;this.usesChipView?null===(t=this.chipView)||void 0===t||t.refresh():super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return 0===this.valueCollection.count}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}get nonEditableClickTarget(){var e;return this.multiSelect&&(null===(e=this.chipView)||void 0===e?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new Ms({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):("function"==typeof e&&(e={filterBy:e}),e=new ps({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){const t=this,n=[],{valueCollection:r,keyStrokeFilterDelay:i,filterParamName:s}=t;if(Array.isArray(e))return void(t.items=e);let o;if(e){if(e.isStore){const r=e.filters.get("primary");t.remoteFilter&&(e.filterParamName=s),o=e.remoteFilter||e.restfulFilter,r?t.primaryFilter=r:n.push(t.primaryFilter)}else"string"==typeof e?e=ao.getStore(e):(e=new(e.readUrl?ho:ao)(e),t.destroyStore=!0),o=t.remoteFilter||e.restfulFilter,o&&s&&(e.filterParamName=s,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),n.push(t.primaryFilter);if(t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),t.filterSelected){const i=e=>!t.containsFocus||!r.includes(e);o?(e.storage.autoFilter=!0,e.storage.addFilter({id:`${t.id}-selected-filter`,filterBy:i})):(n.push(i),e.reapplyFilterOnAdd=!0)}r.addIndex({property:t.displayField,unique:!1}),r.addIndex({property:t.valueField,unique:!0}),n.forEach((t=>e.addFilter(t,!0))),t.keyStrokeFilterDelay=o?Math.max(300,i||0):i??10}return e}updateStore(e,t){const n=this,{_picker:r}=n;let i;n.destroyStore&&t&&t.destroy(),r&&(r.store=e),e.storage.addIndex({property:n.displayField,unique:!1}),e.storage.addIndex({property:n.valueField,unique:!0}),i={filter:"onStoreFilter"},n.displayValueRenderer&&((i||(i={})).change="onComboStoreChange"),n.detachListeners("store"),(null==e?void 0:e.storage)&&n.valueCollection.match(e.storage),n.syncInputFieldValue(),i&&(i.name="store",i.thisObj=n,e.ion(i))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort(((t,n)=>e.indexOf(t)-e.indexOf(n)))[0]:this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(Rc),e.syncInputFieldValue()),e.required&&!t&&e.setError(xc)}onTriggerClick(e){const t=this,n="key"in e;if(!(t.ignoreTriggerClick||t.remoteFilter&&t.filterOnEnter))if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled){var r;switch(null===(r=t.triggerAction)||void 0===r?void 0:r.toLowerCase()){case"all":t.doFilter(null,n);break;case"last":t.doFilter(t.lastQuery,n);break;default:t.doFilter(t.input.value,n)}}}internalOnInput(e){const t=this;t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}filterOnInput(e){const t=this,{value:n}="input"===e.type?e.target:t.input,r=n.length;t.inputting=!0,t.inlinePicker||r>=t.minChars&&(!t.filterOnEnter||"Enter"===e.key)?t.doFilter(n):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](Rc),t.hidePicker()),t.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,n=e._inputPadding||(e._inputPadding=Br.getEdgeSize(t,"padding","lr")),r=t.value||"",i=Br.measureText(r+"W",t,!1,e.element)+n.width;t.style.flex=`1 1 ${Math.ceil(i)}px`}}doFilter(e,t){var n;const r=this,{store:i,picker:s}=r,o=null==e||""===e;r.lastQuery=e,r.primaryFilter.setConfig({value:e,disabled:o}),r.remoteFilter&&i.clear(!0);const a=()=>{const{navigator:e,isVisible:t}=s;i.count?!o&&e&&(e.activeItem=0):r.remoteFilter||o||(e&&(e.activeItem=null),r.validateFilter&&r.setError(Rc)),t&&s.realign()};null===(n=r.filterPromise=i.filter())||void 0===n||n.then((()=>{r.filterPromise=null,a()})),r.inlinePicker||(null!=s&&s.isVisible?0===s.lastAlignSpec.zone&&s.realign():r.showPicker(t)),r.filterPromise||a()}onStoreFilter({source:e}){const t=this,n=t._picker,r=null==n?void 0:n.element.dataset,{count:i}=e;t.remoteFilter&&(i?n&&(n.navigator.activeItem=0):t.validateFilter&&t.setError(Rc),t.filterSelected&&t.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),n&&n.refresh())),r&&(t.createOnUnmatched&&!i&&null!=t.primaryFilter.value?r.addNewValue=t.L("L{addNewValue}")(t.primaryFilter.value):null==r||delete r.addNewValue)}onValueCollectionChange({source:e}){const t=this,{multiSelect:n,_picker:r}=t,i=t.hidePickerOnSelect??!n,s=n?e.values.slice():e.first,o=e.values.slice(),a=t._isUserAction||(null==r?void 0:r._isUserAction)||i&&t.pickerVisible||!1,l=t._value;if(i&&t.hidePicker(),!e.count&&t.required?t.setError(xc):(t.clearError(xc),t.clearError(Rc)),t.validateFilter&&s&&t.clearError(Rc),t.filterSelected){var c,d;const e=null==r?void 0:r.navigator,n=Number(null==e||null===(c=e.activeItem)||void 0===c||null===(d=c.dataset)||void 0===d?void 0:d.index);t.remoteFilter?(t.store.storage.onFiltersChanged({action:"splice",oldCount:1}),t._picker&&t._picker.refresh()):t.store.filter(),isNaN(n)||(e.activeItem=Math.min(r.store.count,n))}t._value=null,t._lastValue=null;const u=t.cacheCurrentValue(t.value);var h;(t.syncInputFieldValue(),t.syncEmpty(),t.isConfiguring)||(t.triggerFieldChange({value:u,oldValue:l,userAction:a,valid:t.isValid}),null===(h=t.trigger)||void 0===h||h.call(t,"select",{record:s,records:o,userAction:a}),"select"===t.defaultAction&&t.trigger("action",{value:u,record:s,records:o,userAction:a}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&(this.picker.hide(),this.syncInputFieldValue())}showPicker(){const e=this,{picker:t}=e;if(!e.readOnly&&!e.inlinePicker){var n;if(t.multiSelect=e.multiSelect,super.showPicker(...arguments),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem)if(e.multiSelect)t.restoreActiveItem((null===(n=t.navigator)||void 0===n?void 0:n.previousActiveItem)||e.selected||0,!0);else t.restoreActiveItem(e.selected||0,!0);e.input.focus()}}changePicker(e,t){if(e){var n;const r=this,s=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width),o=wc.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r[r.pickerAlignElement],align:{matchSize:null==s,anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)},[r.listItemTpl?"itemTpl":i]:r.listItemTpl,width:s,navigator:{keyEventTarget:r.input}},e);r.inlinePicker&&Object.assign(o,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:r.element}),(e=wc.reconfigure(t,e?o:null,r)).element.classList.add("b-combo-picker"),e.element.dataset.emptyText=r.emptyText?r.L(r.emptyText):r.L("L{noResults}"),e.ion({navigate:"onPickerNavigate",thisObj:r}),Zn.on({element:e.element,pointerdown:e=>r.onPickerNavigate({event:e}),thisObj:r})}else null==t||t.destroy();return e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const t=this,n=t.input[t.inputValueAttr],r=n.length,{key:i}=e,{primaryFilter:s,store:o,_picker:a,multiSelect:l}=t;if("keydown"===e.type&&null!=a&&a.isVisible&&a.navigator){const{activeItem:r}=a.navigator;if(r&&l&&i===t.multiValueSeparator)return t.input.value="",s.setConfig({value:"",disabled:!0}),o.filter(),a.onItemClick(r,e),a.hide(),void e.preventDefault();if(!r&&t.createOnUnmatched&&(l&&i===t.multiValueSeparator||"Enter"===i))return e.preventDefault(),void await t.addNewRecord(n)}var c;!t.editable&&t.pickerVisible&&("Backspace"===i&&null!==(c=s.value)&&void 0!==c&&c.length?(s.value=s.value.substring(0,s.value.length-1),t.store.filter(),a.restoreActiveItem(0)):"keypress"==e.type&&i.match(Tc)&&((!t.lastFilterKepressTime||e.timeStamp-t.lastFilterKepressTime>2e3)&&(s.value=""),s.setConfig({value:(s.value||"")+i,disabled:!1}),t.store.filter(),a.restoreActiveItem(0)),t.lastFilterKepressTime=e.timeStamp);super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===i&&t.filterOnEnter&&r>=t.minChars&&(e.stopPropagation(),t.filterOnInput.now(e))}async addNewRecord(e){const t=this,{store:n,_picker:r,valueCollection:i,multiSelect:s,primaryFilter:o}=t,a=n.remoteFilter&&n.autoCommit;t.filterPromise&&await t.filterPromise,a||(o.setConfig({value:"",disabled:!0}),n.filter());const[l]=n.add(t.callback(t.createOnUnmatched,t,[e,t]));if(n.isCommitting){let e;try{await n.commitPromise}catch(t){var c,d;e=null===(c=t.response)||void 0===c||null===(d=c.parsedJson)||void 0===d?void 0:d.error}l.isPhantom&&(t.clearError(),t.setError(e||"L{Combo.recordNotCommitted}",!1,!0),n.remove(l),n.removed.remove(l))}a&&(o.setConfig({value:"",disabled:!0}),n.filter()),t.input.value="",n.includes(l)&&i.splice(s?i.count:0,s?0:i.count,l),null==r||r.hide()}changeCreateOnUnmatched(e){return!0===e&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){super.updateLocalization();const e=this,{displayField:t}=e;let{localizedDisplayFieldsMap:n}=e;if(!0===e.localizeDisplayFields){n||(e.localizedDisplayFieldsMap=n=new Map),!e.store&&e.buildItems&&(e.items=e.buildItems());for(const i of e.items)if(i.id){var r;let s=n.get(i.id);!s&&null!==(r=i[t])&&void 0!==r&&r.startsWith("L{")&&(s=i[t],n.set(i.id,s)),s&&(i[t]=e.L(s))}e.syncInputFieldValue()}}}class kc extends Ec{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return $.encodeHtml(e.getValue(this.owner.displayField))},scrollable:{overflowY:"auto"}}}}Mc.initClass(),kc.initClass(),class extends Sc{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const t=this,n=e.target.closest(t.itemSelector);n&&!e.target.classList.contains("b-close-icon")&&(e.shiftKey||n.contains(e.target.closest("[data-noselect]"))||t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=n,t.inClickHandler=!1)}onKeyDown(e){"Enter"===e.key||e.target.selectionStart||e.target.selectionEnd||super.onKeyDown(e)}updateActiveItem(e,t){const n=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&n.selected.add(n.getRecordFromElement(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}.initClass(),Mc._$name="Combo";V.apply(class{static get target(){return{class:Mc}}changePicker(e,t){const n=this._overridden.changePicker.call(this,e,t);return null==n||n.element.setAttribute("tabindex","-1"),n}});const Ic=Tn.prototype.process;Tn.prototype.process=function(e,t){return t=t.map((e=>{if("object"==typeof e&&"DOMTokenList"===e.constructor.name){const t={};return Array.from(e).forEach((e=>t[e]=1)),t}return e})),Ic.call(this,e,t)};V.apply(class{static get target(){return{class:Br}}static getActiveElement(e){var t,n,r;return null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element),null===(n=e)||void 0===n||null===(r=n.getRootNode)||void 0===r?void 0:r.call(n).activeElement}});V.apply(class{static get target(){return{class:Br}}static elementFromPoint(e,t){return document.elementsFromPoint(e,t)[0]}});V.apply(class{static get target(){return{class:Br}}static getCommonAncestor(e,t){let n=this._overridden.getCommonAncestor.call(this,e,t);return null!=n&&n.isConnected&&!n.parentElement&&(n=n.firstChild),n}});V.apply(class{static target={class:Br};static getViewportIntersection(e,t,n){const{parentNode:r}=e,{parentElement:i}=r.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=i.ownerDocument.defaultView.getComputedStyle(i),o="visible"!==s.overflowX||"visible"!==s.overflowY,a=(l=e).ownerSVGElement?l.ownerSVGElement.parentNode:l.offsetParent;var l;let c=wn.from(e,null,!0);for(let r=o?e.parentNode:a;c&&r&&r!==document.documentElement;r=r.parentNode){for(;r&&r.nodeType===Node.DOCUMENT_FRAGMENT_NODE;){var d;r=null===(d=r.host)||void 0===d?void 0:d.parentNode}if(!r)break;const e=r===document.body,i=r.ownerDocument.defaultView.getComputedStyle(r),s=e?t:wn.inner(r,null,!0);(e||"visible"!==i.overflow)&&(c=s[n](c,!1,!0))}return c}});const Ac=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")};V.apply(class{static get target(){return{class:Br}}static isVisible(e){const t=e.ownerDocument;for(;e;e=(n=e).parentNode||n.host){if(e===t)return!0;if(e.nodeType===Element.ELEMENT_NODE&&!Ac(e))return!1;if(!e.parentNode&&e.isConnected)return!0}var n;return!1}});var Fc=e=>class extends(e||ye){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!e.target.closest(t.ignoreSelector)){const n=Br.getAncestor(e.target,t.containers,t.outerElement);if(n){const r=n.getBoundingClientRect();t.context={element:n,valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(e){var t;const n=this,{context:r,floatRootOwner:i}=n,{element:s}=r,o=s.cloneNode(!0),a=null==i?void 0:i.element.closest(".b-outer");o.classList.add(n.dragProxyCls,n.draggingCls),((null==i?void 0:i.floatRoot)||Br.getRootElement(s)).appendChild(o),r.dragProxy=o,r.dragging=s,s.classList.add(n.dropPlaceholderCls),null!=a&&null!==(t=a.parentElement)&&void 0!==t&&t.matches(".b-float-root")&&(o.style.zIndex=i.floatRootMaxZIndex+1)}onContainerDragStarted(e){const{context:t}=this,{element:n,dragProxy:r}=t,i=n.getBoundingClientRect();if(this.autoSizeClonedTarget)r.style.width=i.width+"px",r.style.height=i.height+"px",Br.setTranslateXY(t.dragProxy,i.left,i.top);else{const n=r.getBoundingClientRect();Object.assign(t,{offsetX:n.width/2,offsetY:n.height/2}),Br.setTranslateXY(r,e.clientX,e.clientY)}}updateContainerDrag(e){var t;const n=this,{context:r}=n;if(!r.started||!r.targetElement)return;const i=Br.getAncestor(r.targetElement,n.containers,"b-gridbase"),s=null===(t=r.dragging)||void 0===t?void 0:t.contains(Br.getActiveElement(r.dragging));i&&Br.isDescendant(r.element,i)||(s&&An.suspendFocusEvents(),i&&r.valid?n.moveNextTo(i,e):n.revertPosition(),s&&An.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,{context:n}=t,{dragging:r,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=n;r&&(n.valid=Boolean(s&&(o||t.externalDropTargetSelector&&e.target.closest(t.externalDropTargetSelector))&&(r!==a||l.parent!==o)),n.finalize=(e=n.valid)=>{!e&&t.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async||n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const r=this,{context:i}=r;i.dragging&&(i.dragging.classList.remove(r.dropPlaceholderCls),i.dragProxy.remove(),r.revertPosition()),n||r.trigger(e?"drop":"abort",{context:i,event:t}),r.reset()}updateContainerProxy(e){const t=this,{context:n}=t,r=n.dragProxy;let i,s=e.pageX-n.offsetX,o=e.pageY-n.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-r.offsetWidth,s)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-r.offsetHeight,o)),t.lockX?Br.setTranslateY(r,o):t.lockY?Br.setTranslateX(r,s):Br.setTranslateXY(r,s,o),"touchmove"===e.type){const t=e.changedTouches[0];i=Br.elementFromPoint(t.clientX,t.clientY)}else i=e.target;n.targetElement=i}moveNextTo(e,t){const{context:n}=this,r=n.dragging,i=e.parentElement;if(e!==r){const s=wn.from(e).center.x;this.isRTL&&t.pageX>s||!this.isRTL&&t.pageX<s?(i.insertBefore(r,e),n.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,i.insertBefore(r,e.nextElementSibling)):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(i.appendChild(r),n.insertBefore=null),n.draggedTo=i}}revertPosition(){const{context:e}=this,{dragging:t}=e,{parent:n,next:r}=e.originalPosition;if(r){r.previousSibling===t||!r&&t===n.lastChild||n.insertBefore(t,r)}else n.appendChild(t);e.draggedTo=null}};const Pc={pageXOffset:0,pageYOffset:0};var Oc=e=>class extends(mi(e||ye)){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>t.closest(e.targetSelector))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return e.target.closest(this.targetSelector)}getX(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):Br.getTranslateX(e)}getY(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):Br.getTranslateY(e)}getXY(e){return"absolute"===this.positioning?[e.offsetLeft,e.offsetTop]:Br.getTranslateXY(e)}setXY(e,t,n){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=t+"px",e.style.top=n+"px"):Br.setTranslateXY(e,t,n))}startTranslateDrag(e){const t=this,{context:n,outerElement:r,proxySelector:i}=t,s=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body;let o=n.dragProxy||n.element;const a=o,l=o.parentElement;if(t.cloneTarget){const r=i?o.querySelector(i):o,{width:l,height:c,x:d,y:u}=wn.from(r,wn.outer(s));o=t.createProxy(o);let h=d,g=u;if(t.autoSizeClonedTarget&&(o.style.width=`${l}px`,o.style.height=`${c}px`),o.classList.add(t.dragProxyCls,t.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(o),!t.autoSizeClonedTarget||i){const t=o.getBoundingClientRect(),{x:r,y:i}=s.getBoundingClientRect(),a=e.clientX-r,l=e.clientY-i+(s!==document.body?document.body.getBoundingClientRect().y:0);h=a-t.width/2,g=l-t.height/2,n.startPageX=e.pageX,n.startPageY=e.pageY}t.setXY(o,h,g),a.classList.add("b-drag-original"),t.hideOriginalElement&&a.classList.add("b-hidden")}o.classList.add(t.draggingCls),Object.assign(n,{element:o,grabbed:a,grabbedParent:l,grabbedNextSibling:o.nextElementSibling,elementStartX:t.getX(o),elementStartY:t.getY(o),elementX:Br.getOffsetX(o,s||r),elementY:Br.getOffsetY(o,s||r),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||s===r}),s&&(n.parentElement=o.parentElement,s!==o.parentElement&&s.appendChild(o),t.updateTranslateProxy(e))}onTranslateDragStarted(){var e;const t=this,{context:n}=t;let{relatedElements:r}=n;if(t.unifiedProxy&&n.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null===(e=r)||void 0===e?void 0:e.length)>0){n.relatedElStartPos=[],n.relatedElDragFromPos=[];const{proxySelector:e}=t;let[i,s]=[n.elementStartX,n.elementStartY];n.originalRelatedElements=r,r=n.relatedElements=r.map(((r,o)=>{const a=e?r.querySelector(e):r,{x:l,y:c,width:d,height:u}=wn.from(a,t.dragWithin),h=t.cloneTarget?t.createProxy(r):r;return h.classList.add(t.draggingCls),h.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(h,l,c),t.dragWithin.appendChild(h),h.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(h.style.width=`${d}px`,h.style.height=`${u}px`),t.hideOriginalElement&&r.classList.add("b-hidden"),r.classList.add("b-drag-original")),n.relatedElStartPos[o]=n.relatedElDragFromPos[o]=t.getXY(h),t.unifiedProxy&&(h.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),i+=t.unifiedOffset,s+=t.unifiedOffset,t.setXY(h,i,s),n.relatedElDragFromPos[o]=[i,s],h.style.zIndex=100-o),h})),t.unifiedProxy&&r&&r.length>0&&Zn.onTransitionEnd({element:r[0],property:"transform",handler(){r.forEach((e=>e.classList.remove("b-drag-unified-animation")))},thisObj:t,once:!0})}}applyConstraints(e,t,n){const i=this,{constrain:s,dragWithin:o}=i,{pageXOffset:a,pageYOffset:l}=o===document.body?r:Pc;return o&&s&&(t<0&&(t=0),t+e.offsetWidth>o.scrollWidth&&(t=o.scrollWidth-e.offsetWidth),n<0&&(n=0),n+e.offsetHeight>o.scrollHeight&&(n=o.scrollHeight-e.offsetHeight)),"number"==typeof i.minX&&(t=Math.max(i.minX+a,t)),"number"==typeof i.maxX&&(t=Math.min(i.maxX+a,t)),"number"==typeof i.minY&&(n=Math.max(i.minY+l,n)),"number"==typeof i.maxY&&(n=Math.min(i.maxY+l,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const n=this,{lockX:r,lockY:s,context:o}=n,a=o.dragProxy||o.element,{relatedElements:l,relatedElDragFromPos:c}=o;o.scrollManagerElementContainsDragProxy&&t&&(o.scrollX=t.getRelativeLeftScroll(a),o.scrollY=t.getRelativeTopScroll(a)),o.pageX=e.pageX,o.pageY=e.pageY,o.clientX=e.clientX,o.clientY=e.clientY;let d=o.elementStartX+e.pageX-o.startPageX+o.scrollX,u=o.elementStartY+e.pageY-o.startPageY+o.scrollY;if(n.snapCoordinates){const e=n.snapCoordinates({element:a,newX:d,newY:u});d=e.x,u=e.y}const{constrainedX:h,constrainedY:g}=n.applyConstraints(a,d,u);if((o.started||h!==d||g!==u)&&n.setXY(a,r?i:h,s?i:g),l){const e=r?0:h-o.elementStartX,t=s?0:g-o.elementStartY;l.forEach(((r,i)=>{const[s,o]=c[i];n.setXY(r,s+e,o+t)}))}o.newX=h,o.newY=g}async finishTranslateDrag(e){const t=this,n=t.context,{target:r}=e,i=!t.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),s=!t.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),o=n.dragProxy||n.element,{relatedElements:a}=n;if(!t.ignoreSamePositionDrop||i||s)if(!1===n.valid)await t.abortTranslateDrag(!0,e);else{const i=!t.allowDropOutside&&wn.from(t.dragWithin||t.outerElement);i&&("number"!=typeof t.minX&&!0!==t.minX&&e.pageX<i.left||"number"!=typeof t.maxX&&!0!==t.maxX&&e.pageX>i.right||"number"!=typeof t.minY&&!0!==t.minY&&e.pageY<i.top||"number"!=typeof t.maxY&&!0!==t.maxY&&e.pageY>i.bottom)?await t.abortTranslateDrag(!0,e):(n.finalize=async(i=n.valid)=>{n.finalized?console.warn("DragHelper: Finalizing already finalized drag"):(n.finalized=!0,!i&&t.context&&await t.abortTranslateDrag(!0,null,!0),t.isDestroyed||(t.trigger("dropFinalized",{context:n,event:e,target:r}),t.reset()),t.cloneTarget||o.parentElement===n.grabbedParent||[o,...a||[]].forEach((e=>e.style.transform="")))},n.async=!1,await t.trigger("drop",{context:n,event:e,target:r}),n.async||await n.finalize())}else t.abortTranslateDrag(!1,e)}async abortTranslateDrag(e=!1,t=null,n=!1){var r,i;const s=this,{cloneTarget:o,context:a,proxySelector:l,dragWithin:c,draggingCls:d}=s,{relatedElements:u,relatedElStartPos:h,grabbed:g}=a,m=a.dragProxy||a.element;if(a.valid=!1,null===(r=s.scrollManager)||void 0===r||r.stopMonitoring(),a.aborted)return void console.warn("DragHelper: Aborting already aborted drag");let{elementStartX:p,elementStartY:f}=a;const v=p!==s.getX(m)||f!==s.getY(m);if(m&&a.started){if(!o&&c&&c!==a.grabbedParent&&a.grabbedParent.insertBefore(m,a.grabbedNextSibling),o&&l){const e=g.querySelector(l)||g,{x:t,y:n}=wn.from(e);p=t,f=n}m.classList.add("b-aborting"),s.setXY(m,p,f),null==u||u.forEach(((e,t)=>{e.classList.remove(d),e.classList.add("b-aborting"),s.setXY(e,h[t][0],h[t][1])})),n||s.trigger(e?"drop":"abort",{context:a,event:t}),m.isConnected&&!s.isDestroying&&v&&await Zn.waitForTransitionEnd({element:m,property:Br.getPropertyTransitionDuration(m,"transform")?"transform":"all",thisObj:s,once:!0,runOnDestroy:!0}),s.isDestroyed||s.trigger("abortFinalized",{context:a,event:t})}null!==(i=s.context)&&void 0!==i&&i.started&&s.reset()}cleanUp(){const{context:e,cloneTarget:t,draggingCls:n,dragProxyCls:r}=this,i=e.dragProxy||e.element,{relatedElements:s,originalRelatedElements:o,grabbed:a}=e,l=t&&(this.removeProxyAfterDrop||!e.valid),c=[n,"b-aborting",r,"b-drag-main","b-drag-unified-proxy"];i.classList.remove(...c),l&&i.remove(),null==s||s.forEach((e=>{l?e.remove():e.classList.remove(...c)})),a.classList.remove("b-drag-original","b-hidden"),null==o||o.forEach((e=>e.classList.remove("b-hidden","b-drag-original")))}};const Lc="onMouseMove",$c="onMouseUp",_c="onDocumentClick",jc="onTouchMove",Bc="onTouchEnd",Vc="onKeyDown";class Hc extends(ye.mixin(Ge,Fc,Oc)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,n={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),Zn.on(n)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let n=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(n=e.closest(".b-outer")||n),n}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}onPointerDown(e){const t=this;if(0!==e.button||t.context)return;if(t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;t.startEvent=e;if(t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){t.blurDetacher=Zn.on({element:r,blur:t.onWindowBlur,thisObj:t});const n={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:Vc};if("touch"===e.pointerType?(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"),n.touchmove={handler:jc,passive:!1},n.touchend=n.pointerup=Bc):(n.pointermove=Lc,n.pointerup=$c),t.dragListenersDetacher=Zn.on(n),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const e=wn.from(t.dragWithin,t.outerElement);t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}async internalMove(e){var t;if(e.scrollInitiated)return;const n=this,{context:r}=n,i=Zn.getDistanceBetween(n.startEvent,e);if(n.touchStartTimer&&i>n.dragThreshold)n.abort(!0);else if(!n.touchStartTimer&&null!=r&&r.element&&(r.started||i>=n.dragThreshold)&&(null===(t=e.target)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var s;if(!1===n.trigger("beforeDragStart",{context:r,event:e}))return n.abort();n.isContainerDrag?n.startContainerDrag(e):n.startTranslateDrag(e),r.started=!0,null===(s=n.scrollManager)||void 0===s||s.startMonitoring(Xt.merge({scrollables:[{element:n.dragWithin||n.outerElement}],callback:n.onScrollManagerScrollCallback},n.monitoringConfig)),r.outermostEl=Br.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),n.dropTargetSelector&&n.dropTargetCls&&Br.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach((e=>e.classList.add(n.dropTargetCls)));const t=n.trigger("dragStart",{context:r,event:e});Xt.isPromise(t)&&await t,r.moveUnblocked=!0,n.isContainerDrag?n.onContainerDragStarted(e):n.onTranslateDragStarted(e),n.trigger("afterDragStart",{context:r,event:e})}r.moveUnblocked?n._cachedMouseEvent?(n.update(e),n.update(n._cachedMouseEvent),delete n._cachedMouseEvent):n.update(e):n._cachedMouseEvent=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:n}=this;null!==(t=this.context)&&void 0!==t&&t.element&&n&&(n.isScroll=!0,this.update(n,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const n=this,{context:r}=n,i=document.scrollingElement||document.body;let s=n.getMouseMoveEventTarget(e);if("touchmove"===e.type){const t=e.changedTouches[0];s=Br.elementFromPoint(t.clientX+i.scrollLeft,t.clientY+i.scrollTop)}r.target=s;let o=n.allowDropOutside||!n.dragWithin||n.dragWithin.contains(e.target);var a;o&&n.dropTargetSelector&&(o=o&&Boolean(null===(a=s)||void 0===a?void 0:a.closest(n.dropTargetSelector)));n.isContainerDrag?n.updateContainerProxy(e,t):n.updateTranslateProxy(e,t),r.valid=o,n.trigger("drag",{context:r,event:e}),n.isContainerDrag&&n.updateContainerDrag(e,t),r.valid=r.valid&&o;for(const e of n.draggedElements)e.classList.toggle(n.invalidCls,!r.valid);e&&(n.lastMouseMoveEvent=e)}get draggedElements(){const{context:e}=this;return[e.dragProxy||e.element,...e.relatedElements??[]]}async abort(e=!1){var t,n;const r=this,{context:s}=r;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.removeListeners(),null!=s&&s.started&&!s.aborted?(s.element.getBoundingClientRect(),s.valid=!1,r.isContainerDrag?r.abortContainerDrag(i,i,e):r.abortTranslateDrag(i,i,e),s.aborted=!0):r.reset(!0)}removeListeners(){var e,t;null===(e=this.dragListenersDetacher)||void 0===e||e.call(this),null===(t=this.blurDetacher)||void 0===t||t.call(this)}reset(e){const t=this,{context:n}=t;if(null!=n&&n.started){for(const e of t.draggedElements)e.classList.remove(t.invalidCls);n.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?n.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&Br.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach((e=>e.classList.remove(t.dropTargetCls)))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:n}=t;var r;(t.removeListeners(),n)&&(null===(r=t.scrollManager)||void 0===r||r.stopMonitoring(),n.started?n.moveUnblocked?(e.stopPropagation(),n.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),Zn.on({element:document,thisObj:t,click:_c,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.ion({drag(){t.onMouseUp(e)},once:!0}):t.reset(!0))}onKeyDown(e){var t;null!==(t=this.context)&&void 0!==t&&t.started&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return"container"===this.mode}async animateProxyTo(e,t={align:"c-c"}){const{context:n,draggedElements:r}=this,{element:i}=n,s=e.isRectangle?e:wn.from(e);r.forEach((e=>{e.classList.add("b-drag-final-transition"),Br.alignTo(e,s,t)})),await Zn.waitForTransitionEnd({element:i,property:"all",thisObj:this,once:!0}),r.forEach((e=>e.classList.remove("b-drag-final-transition")))}get isDragging(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?Br.elementFromPoint(e.clientX,e.clientY):e.target}}Hc._$name="DragHelper";V.apply(class{static target={class:Hc};getMouseMoveListenerTarget(e){return Br.getRootElement(e)}});const Nc=/-/,zc=Symbol("props"),Wc={originalTarget:!0,explicitOriginalTarget:!0,rangeParent:!0};let Uc;const Gc=e=>e[zc]?e:new Proxy((e=>{const t=Object.create(e),{relatedTarget:n}=e;n&&!n.nodeType&&Object.defineProperty(t,"relatedTarget",{get:()=>null,configurable:!0});const r=Object.create(null);for(const t in e)Wc[t]||"function"!=typeof e[t]&&(r[t]=e[t]);return t[zc]=r,t})(e),{get:(e,t)=>{const n=((e,t)=>Object.hasOwn(e,t)?e:t in e[zc]?e[zc]:Object.getPrototypeOf(e))(e,t),r=n[t];return"function"==typeof r?(...e)=>r.call(n,...e):r}});V.apply(class{static target={class:Zn};static getComposedPathTarget(e){let t;if(null==Uc)try{t=e.composedPath()[0],Uc=!1}catch{Uc=!0}return t=Uc?e.path?e.path[0]:e.target:e.composedPath()[0],t}static fixEvent(e){if((e=this._overridden.fixEvent.call(this,Gc(e))).target&&e.path&&Nc.test(e.target.tagName)){const t=e.path[0],n=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t,configurable:!0}),Object.defineProperty(e,"originalTarget",{get:()=>n,configurable:!0}))}return e}});V.apply(class{static get target(){return{class:Zn}}static addListener(e,t,n,r){return 11===(null==e?void 0:e.nodeType)&&r&&"capture"in r&&delete r.capture,this._overridden.addListener.call(this,e,t,n,r)}static addElementListener(e,t,n,r){return 11===(null==e?void 0:e.nodeType)&&n&&(delete n.capture,delete n.once,delete n.passive),this._overridden.addElementListener.call(this,e,t,n,r)}});V.apply(class{static get target(){return{class:pc}}static get configurable(){const e=this._overridden.configurable;return e.autoComplete=null,e}}),Object.defineProperty(Mo,"element",{get:()=>null});V.apply(class{static get target(){return{class:Sc}}setupTreeWalker(...e){return ti(...e)}acceptNode(e){var t;return e.offsetParent&&null!==(t=e.matches)&&void 0!==t&&t.call(e,this.itemSelector)?Wr.FILTER_ACCEPT:Wr.FILTER_SKIP}});V.apply(class{static get target(){return{class:p}}static isObject(e){return e!==r&&this._overridden.isObject.call(this,e)}});V.apply(class{static get target(){return{class:rc}}setupTreeWalker(...e){return ti(...e)}});const Yc=Object.getOwnPropertyDescriptor(ba.prototype,"floatRoot").get;Object.defineProperty(ba.prototype,"floatRoot",{get:function(){var e;const t=this.rootElement||(null===(e=this.owner)||void 0===e?void 0:e.rootElement);let{floatRoot:n}=t;return n?Br.getRootElement(n)!==t&&t.appendChild(n):n=Yc.call(this),n}});V.apply(class{static get target(){return{class:ba}}setDragImage(){}});V.apply(class{static get target(){return{class:ba}}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;let n;for(;e&&(n=e.nextSibling);)t.insertBefore(n,e)}});class qc{static get(e,t){const n=e._domData||(e._domData={});return null!=t?n[t]:n}static remove(e,t){const{_domData:n}=e,r=null==n?void 0:n[t];return null==n||delete n[t],r}static set(e,t,n){3===arguments.length?(e._domData||(e._domData={}))[t]=n:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}qc._$name="DomDataStore";class Kc{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=ba.fromElement(e,"gridbase"),n=t&&e.closest(t.focusableSelector);if(n){const{dataset:r}=n.parentNode;this.init({grid:t,rowIndex:t.store.includes(r.id)?t.store.indexOf(r.id):r.index||-1,columnId:n.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t;const n=this,r=n.grid=e.grid,{store:i,columns:s}=r,{visibleColumns:o}=s;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,null==e.id&&(n._rowIndex=-1);else{var a;const t=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(t),i.count-1),r.hideHeaders?0:-1),n._id=null===(a=i.getAt(n._rowIndex))||void 0===a?void 0:a.id}if("_rowIndex"in n||(n._rowIndex=i.indexOf(n.id)),n.isSpecialRow=null===(t=n.record)||void 0===t?void 0:t.isSpecialRow,"columnId"in e)n._column=s.getById(e.columnId);else if("field"in e)n._column=s.get(e.field);else{const t=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(t)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(t),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}get isLocation(){return!0}equals(e,t=!1){const n=this;return(null==e?void 0:e.isLocation)&&e.grid===n.grid&&(t?n.id===e.id&&n._column===e._column:e.record===n.record&&e.column===n.column&&e.target===n.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return null!=e&&e.includes(this._column)?this._column:null==e?void 0:e[this.columnIndex]}get columnId(){var e;return null===(e=this.column)||void 0===e?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,(null===(e=this.grid.columns.visibleColumns)||void 0===e?void 0:e.length)-1)}move(e){const t=this,{record:n,column:r,grid:i}=t,{store:s}=i,o=i.columns.visibleColumns,a=new Kc;let l=s.includes(n)?s.indexOf(n):t.rowIndex,c=o.includes(r)?o.indexOf(r):t.columnIndex;const d=i.hideHeaders?0:-1,u=s.count-1,h=o.length-1,g=l===d,m=l===u,p=0===c,f=c===h;switch(e){case Kc.PREV_CELL:p?g||(c=h,l--):c--;break;case Kc.NEXT_CELL:f?m||(c=0,l++):c++;break;case Kc.UP:g||l--;break;case Kc.DOWN:m||(-1===l?l=i.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case Kc.FIRST_COLUMN:c=0;break;case Kc.LAST_COLUMN:c=h;break;case Kc.FIRST_CELL:l=d,c=0;break;case Kc.LAST_CELL:l=u,c=h;break;case Kc.PREV_PAGE:l=Math.max(d,l-Math.floor(i.scrollable.clientHeight/i.rowHeight));break;case Kc.NEXT_PAGE:l=Math.min(u,l+Math.floor(i.scrollable.clientHeight/i.rowHeight))}return a.init({grid:i,rowIndex:l,columnIndex:c}),a}get cell(){const e=this,{grid:t,id:n,_cell:r}=e;if(r)return r;var i;if(null==n)return null===(i=t.columns.getById(e.columnId))||void 0===i?void 0:i.element;{const{row:n}=e;var s;if(n)return n.getCell(e.columnId)||n.getCell(null===(s=t.columns.getAt(e.columnIndex))||void 0===s?void 0:s.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:n}=this.grid;if(e)return t||(n.currentNode=this.grid.focusableFinderCell=e,n.nextNode()||e)}get isActionable(){const{cell:e,_target:t}=this,n=e&&Br.getActiveElement(e),r=n&&e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY;return Boolean(r||t&&t!==this.cell)}get isColumnHeader(){return this.cell&&-1===this.rowIndex}get isCell(){return this.cell&&this.record}}Kc.UP=1,Kc.NEXT_CELL=2,Kc.DOWN=3,Kc.PREV_CELL=4,Kc.FIRST_COLUMN=5,Kc.LAST_COLUMN=6,Kc.FIRST_CELL=7,Kc.LAST_CELL=8,Kc.PREV_PAGE=9,Kc.NEXT_PAGE=10,Kc._$name="Location";const Xc=document.createRange();class Zc extends ye{static $name="Row";static get configurable(){return{cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Kc({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),"position"===this.grid.positionMode&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2})))}get id(){return this._id}set id(e){const t=this,n={id:e},r=t.rowManager.idMap;t._id===e&&r[e]===t||(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement((t=>{qc.assign(t,n),t.dataset.id=e})),t.eachCell((e=>qc.assign(e,n))))}addElement(e,t){const n=this;let r=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),qc.assign(t,{index:n.index}),n._cells[e]=[];r;)n._cells[e].push(r),n._allCells.push(r),qc.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:n}),r=r.nextElementSibling;t.dataset.index=n.index,t.ariaRowIndex=n.grid.hideHeaders?n.index+1:n.index+2,null!==n.top&&n.translateElements(!0)}getElement(e){return this._elements[e]}getRectangle(e){return wn.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,t=!1){return this._allCells.find((n=>{const r=qc.get(n);return r.columnId==e||!t&&r.column==e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((e=>e.style.height=`${t.offsetHeight}px`)),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return null!=e&&e.isDomClassList?e:new Tn(e)}updateCls(e){this.eachElement((t=>Br.syncClassList(t,e)))}setAttribute(e,t){this.eachElement((n=>n.setAttribute(e,t)))}removeAttribute(e){this.eachElement((t=>t.removeAttribute(e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:n,_elementsArray:r}=t;if(t.lastTop!==n){for(let e=0,{length:t}=r;e<t;e++)r[e].style.transform=`translate(0,${n}px)`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}positionElements(e){const t=this,{top:n,_elementsArray:r}=t;if(t.lastTop!==n){for(let e=0,{length:t}=r;e<t;e++)r[e].style.top=`${n}px`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,n=!0,r=!1,i=!1){var s,o;const a=this,{cellContext:l,cls:c,elements:d,grid:u,rowManager:h,height:g,_id:m}=a,p=qc.get(a._elementsArray[0]),f=h._rowHeight,{store:v}=u,{isTree:y}=v;let b,C=0;if(t||!1===t||(t=u.store.getById(p.id),e=u.store.indexOf(t)),!t)return;const S=null===(s=t)||void 0===s?void 0:s.cls,D=S?S.isDomClassList?S:new Tn(S):null;c.assign({"b-grid-row-updating":n&&u.transitionDuration&&!i,"b-selected":u.isSelected(null===(o=t)||void 0===o?void 0:o.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),a.lastRecordCls&&c.remove(a.lastRecordCls),D?(c.add(D),a.lastRecordCls=Object.assign({},D)):a.lastRecordCls=null,h.trigger("beforeRenderRow",{row:a,record:t,recordIndex:e,oldId:m}),u.beforeRenderRow({row:a,record:t,recordIndex:e,oldId:m,cls:c}),a.updateCls(c),n&&u.transitionDuration&&!i&&u.setTimeout((()=>{a.isDestroyed||(c.remove("b-grid-row-updating"),a.updateCls(c))}),u.transitionDuration+50),a.id=t.id,a.dataIndex=e;const w=!u.fixedRowHeight&&u.getRowHeight(t)||f;let E=a.maxRequestedHeight=null;if(y)for(const e in d){const n=d[e];var x,R;if(n.id=`${u.id}-${e}-${a.id}`,Br.setAttributes(n,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(v))Br.setAttributes(n,{"aria-expanded":!0,"aria-owns":null!==(x=t.children)&&void 0!==x&&x.length?null===(R=t.children)||void 0===R?void 0:R.map((t=>`${u.id}-${e}-${t.id}`)).join(" "):null});else t.isLeaf?n.removeAttribute("aria-expanded"):n.setAttribute("aria-expanded",!1),n.removeAttribute("aria-owns")}for(l._record=t,l._id=t.id,l._rowIndex=e,C=0;C<u.columns.visibleColumns.length;C++){const e=u.columns.visibleColumns[C];l._columnId=e.id,l._column=e,l._columnIndex=C,l._cell=a.getCell(e.id,!0),l.height=w,l.maxRequestedHeight=E,l.updatingSingleRow=n,b=a.renderCell(l),h.fixedRowHeight||null!=b.height&&(E=Math.max(E,b.height),b.transient||(a.maxRequestedHeight=E))}const T=E??w;a.height=u.processRowHeight(t,T)??T,a.updateElementsHeight(i),n&&!i&&(g!==a.height&&h.translateFromRow(a,r),h.trigger("updateRow",{row:a,record:t,recordIndex:e,oldId:m}),h.trigger("renderDone")),u.afterRenderRow({row:a,record:t,recordIndex:e,oldId:m,oldHeight:g,isExport:i}),h.trigger("renderRow",{row:a,record:t,recordIndex:e,oldId:m,isExport:i}),g&&a.height!==g&&h.trigger("rowRowHeight",{row:a,record:t,height:a.height,oldHeight:g}),a.forceInnerHTML=!1}renderCell(e){var t,n;e.isLocation||(e=new Kc(e));let{cell:r,record:s}=e;const o=this,{grid:a,column:l,height:c,maxRequestedHeight:d,updatingSingleRow:u=!0,isMeasuring:h=!1}=e,g=null===(t=a.features)||void 0===t?void 0:t.cellEdit,m=qc.get(r),p=m.rowElement,f=qc.get(p);if(!s&&(s=e._record=a.store.getById(f.id),!s))return;let v=l.getRawValue(s);const y=s.fieldMap[l.field],b={configuredHeight:c,height:null,maxRequestedHeight:d},C=l.getCellClass(e),S={cellElement:r,dataField:y,rowElement:p,value:v,record:s,column:l,size:b,grid:a,row:m.row,updatingSingleRow:u,isMeasuring:h},D=l.renderer||l.defaultRenderer;a.beforeRenderCell(S),S.cellElement!==r&&(r=S.cellElement),Br.syncClassList(r,C);let w=!0;D?(v=l.callback(D,l,[S]),v===i&&(s.generatedParent&&l.rendererReturningContent?v="":!1===l.alwaysClearCell&&(w=!1))):y&&(v=y.print(v));const E=null===(n=a.hasFrameworkRenderer)||void 0===n?void 0:n.call(a,{cellContent:v,column:l});E&&s.isSpecialRow&&(v="");const x=E&&!l.data.tree&&!s.isSpecialRow;if(w&&!x){var R;let t=r;null!=g&&null!==(R=g.editorContext)&&void 0!==R&&R.equals(e)&&!g.editor.isFinishing&&(t=o.moveContentFromCell(r,g.editor.element));const n=null!=v&&"object"==typeof v,i="string"==typeof v,s=n||null==v?"":String(v);if(o.forceInnerHTML&&(t.innerHTML="",delete t._content,r.lastDomConfig=null),n||!l.htmlEncode||l.disableHtmlEncode?!l.autoSyncHtml||i&&!Br.getChildElementCount(t)?n?To.sync({targetElement:t,domConfig:{onlyChildren:!0,children:H.asArray(v)}}):t._content!==s&&(t.innerHTML=t._content=s):i?Br.sync(s,t.firstElementChild):n&&To.sync({domConfig:v,targetElement:t}):r._hasHtml?(t.innerText=s,r._hasHtml=!1):Br.setInnerText(t,s),t!==r){const{firstChild:e}=r;for(const n of t.childNodes)r.insertBefore(n,e)}}var T;s.isSpecialRow||(null===(T=a.processCellContent)||void 0===T||T.call(a,{cellElementData:m,rendererData:S,rendererHtml:S.rendererHtml||v}));return l.autoHeight&&null==b.height&&(r.classList.add("b-measuring-auto-height"),b.height=Math.max(r.offsetHeight,a.rowHeight),r.classList.remove("b-measuring-auto-height")),h||o.rowManager.trigger("renderCell",S),b}moveContentFromCell(e,t){Xc.setStart(e,0),Xc.setEndBefore(t);const n=document.createElement("div");return n.appendChild(Xc.extractContents()),n}}Zc.initClass(),Zc._$name="Row";V.apply(class{static target={class:Zc};moveContentFromCell(e,t){const{childNodes:n}=e,r=[];n.forEach((n=>{n!==t&&(r.push(n),e.removeChild(n))}));const i=document.createElement("div");return r.forEach((e=>{i.appendChild(e)})),i}});class Jc extends(mi(ye)){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,t){return null==t||t.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return 0!==Object.keys(this.activeScroll).length}get rtl(){var e;return null===(e=this.owner)||void 0===e?void 0:e.rtl}startMonitoring(e={}){const t=this,{element:n,direction:r}=t,{scrollables:i=[],direction:s=r,callback:o}=e,a=[];return i.length||i.push({element:n}),i.forEach((e=>{const r=e.element;"string"==typeof r?Br.forEachSelector(n,r,(n=>{t.createMonitor(n,e.direction||s,e.callback||o),a.push(n)})):(t.createMonitor(r,e.direction||s,e.callback||o),a.push(r))})),function(){var e;null===(e=t.stopMonitoring)||void 0===e||e.call(t,a)}}createMonitor(e,t,n){const{monitoring:r}=this;r.has(e)||r.set(e,new Qc({scrollManager:this,element:e,direction:t,callback:n}))}stopMonitoring(e){const t=this,{monitoring:n}=t;if(e=H.asArray(e),n){if(!e)return void n.forEach((e=>t.stopMonitoring(e.element)));e.forEach((e=>{const t=n.get(e);e.classList.remove("b-scrolling"),t&&(t.destroy(),n.delete(e))}))}}requestScroll(e,t){const{activeScroll:n}=this;return(!(e in n)||n[e]===t)&&(n[e]=t,!0)}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach((n=>{t[n]===e&&delete t[n]}))}getRelativeScroll(e,t="left"){let n=0;return this.monitoring.forEach(((r,i)=>{Br.isDescendant(i,e)&&(n+="left"===t?r.scrollRelativeLeft:r.scrollRelativeTop)})),n}}class Qc extends ye{construct(e){const{element:t}=e,n=t.scrollLeft,r=t.scrollTop;Object.assign(e,{startScrollLeft:n,startScrollTop:r}),super.construct(e),Zn.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:this}),Zn.on({element:t,pointerleave:"onPointerLeave",thisObj:this})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){const e=this;e.pendingScrollFinalize&&(e.scrollManager.releaseScroll(e),e.pendingScrollFinalize=!1),e.scrolling=!0,e.performScroll()}stopScroll(e=null){const t=this,n=()=>{t.pendingScrollFinalize=!1,t.isDestroyed||(t.scrollManager.releaseScroll(t),t.scrolling=!1)};t.scrollRequested&&(t.scrollManager.cancelAnimationFrame(t.frameId),t.scrollRequested=!1),t.scrollManager.clearTimeout(t.scrollTimeout),t.scrollTimeout=null,e||!t.ongoingScrollTop&&!t.ongoingScrollLeft?(t.ongoingScrollTop=t.ongoingScrollLeft=null,n()):(t.pendingScrollFinalize=!0,Promise.all([t.ongoingScrollTop,t.ongoingScrollLeft].filter(Boolean)).then((()=>t.pendingScrollFinalize&&n())))}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:n}=t,r=t.element.getBoundingClientRect(),i=n.zoneWidth,s=n.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){const{scrollLeft:o,scrollWidth:a,clientWidth:l}=t.element;n.rtl?e.clientX<r.left+i&&a+o-l>=1?t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1:e.clientX>r.right-i&&o<0&&(t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1):e.clientX>r.right-i&&a-o-l>=1?t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1:e.clientX<r.left+i&&o>0&&(t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1)}if("horizontal"!==t.direction){const{scrollTop:n,scrollHeight:o,clientHeight:a}=t.element;e.clientY>r.bottom-i&&o-n-a>=1?t.scrollDeltaY=Math.round((i-(r.bottom-e.clientY))/s)+1:e.clientY<r.top+i&&n>0&&(t.scrollDeltaY=-Math.round((i+(r.top-e.clientY))/s)-1)}0===t.scrollDeltaX||n.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||n.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.scrolling&&t.stopScroll():t.scrollTimeout||(t.scrollTimeout=n.setTimeout((()=>t.startScroll()),n.startScrollDelay))}performScroll(){const e=this,{element:t}=e;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){const n=t.scrollLeft,r=Math.min(n+e.scrollDeltaX,t.scrollWidth-t.clientWidth);t.scrollLeft=r,t.scrollLeft!==n?e.ongoingScrollLeft=new Promise((e=>t.addEventListener("scroll",e,{once:!0}))):(e.ongoingScrollLeft=null,e.scrollDeltaX=0)}if(0!==e.scrollDeltaY){const n=t.scrollTop,r=Math.min(n+e.scrollDeltaY,t.scrollHeight-t.clientHeight);t.scrollTop=r,t.scrollTop!==n?e.ongoingScrollTop=new Promise((e=>t.addEventListener("scroll",e,{once:!0}))):(e.ongoingScrollTop=null,e.scrollDeltaY=0)}0!==e.scrollDeltaX||0!==e.scrollDeltaY?(e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((()=>{e.scrollRequested=!1,e.performScroll(e)}))):e.stopScroll()}}onElementScroll(){var e,t;null===(e=this.config)||void 0===e||null===(t=e.callback)||void 0===t||t.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}}Jc._$name="ScrollManager";const ed=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px"));class td extends(ds.mixin(Ge,rt)){static $name="Column";static type="column";static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t,n){if(!e)return!1;if(!0===e)return!0;const r={};return"function"==typeof e?(r.originalSortFn=e,r.sortFn=e.bind(n)):"object"==typeof e&&(Object.assign(r,e),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(!0===e)return!0;const t={columnOwned:!0};return"function"==typeof e?t.filterFn=e:"object"==typeof e&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var n;const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=Q.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(r.localeClass=e.localeClass),super.construct(...arguments),r.isLeaf&&!("field"in r.data)&&(r.field="_"+(r.type||"")+ ++td.emptyCount,r.noFieldSpecified=!0),r.width||r.flex||r.children||r.set({width:td.defaultWidth,flex:null},null,!0),r.headerWidgets&&r.initHeaderWidgets(r.headerWidgets),r.isParent&&(r.meta.visibleChildren=new Set,r.collapsible&&(r.collapsible=!0)),r.rendererReturningContent=null===(n=r.renderer)||void 0===n?void 0:n.toString().includes("return ")}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return(null===(e=this.children)||void 0===e?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),-1!==e.rowIndex&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){Br.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,n,r;null!==(t=this.location)&&void 0!==t&&t.isSpecialRow||null===(n=this.location)||void 0===n||!n.cell||(null!==(r=e)&&void 0!==r&&r.length||(e=this.location.column.text),Br.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t,n;null===(e=this.data)||void 0===e||null===(t=e.editor)||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const n of e){const e=ba.create({owner:this,...n});t[e.ref||e.id]=e}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;null===(e=t.destroy)||void 0===e||e.call(t)}}static generateAutoCls(){const e=[];for(let t=this;t!==td;t=t.superclass)t.type&&t.type!==t.superclass.type&&e.push(`b-${t.type.toLowerCase()}-cell`);const t=e.join(" ");return(td.autoClsMap||(td.autoClsMap=new Map)).set(this,t),t}getCellClass(e){var t,n;const{record:r,column:i}=e,{cellCls:s,internalCellCls:o,grid:a,constructor:l,align:c}=i,d=(null===(t=td.autoClsMap)||void 0===t?void 0:t.get(l))||l.generateAutoCls(),u=e.cell.classList.contains("b-editing"),h={[a.cellCls]:a.cellCls,[d]:d,[s]:s,[o]:o,"b-cell-dirty":r.isFieldModified(i.field)&&(i.compositeField||!1!==(null===(n=r.fieldMap[i.field])||void 0===n?void 0:n.persist)),[`b-grid-cell-align-${c}`]:c,"b-selected":a.selectionMode.cell&&a.isCellSelected(e),"b-focused":a.isFocused(e),"b-auto-height":i.autoHeight,"b-editing":u};return r.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return Boolean(this.isLeaf&&this.field&&this.data.groupable)}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:t}=e.data;if(t&&!t.isWidget){const n=e.grid.processCellEditor({editor:t,field:e.field});n?t=e.data.editor=n.editor:("string"==typeof t&&(t={type:t}),t=e.data.editor=ba.create(Xt.merge(e.defaultEditor,{owner:e.grid,label:$.encodeHtml(e.text)},t)))}return t}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||(null===(e=this.parent)||void 0===e?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||(null===(e=this.grid)||void 0===e?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let t=this.previousSibling;for(;t&&(t.hidden||t.region!==e);)t=t.previousSibling;return t}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||Boolean(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return Br.getChild(this.element,".b-grid-header-text")}get textElement(){return Br.down(this.element,".b-grid-header-text-content")}get contentElement(){return Br.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some((e=>e.field===this.field))}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?$.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const n=this,{parent:r}=n;if(!n.hidden){if(n.hidden=!0,r&&!r.isRoot&&!r.isTogglingAll){r.children.some((e=>!0!==e.hidden))||r.hidden||(e=!0,r.hide())}n.isParent?n.children.forEach((e=>e.hide(!0,!0))):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](n),e||n.stores.forEach((e=>e.trigger("columnHide",{column:n})))}}show(e=!1){const t=this,{parent:n}=t;if(t.hidden){var r;if(t.hidden=!1,null!=n&&n.hidden&&n.show(),t.isParent)null===(r=t.meta.visibleChildren)||void 0===r||r.forEach((e=>e.show(!0)));e||t.stores.forEach((e=>e.trigger("columnShow",{column:t})))}}toggle(e){return this.hidden&&e===i||!0===e?this.show():!this.hidden&&e===i||!1===e?this.hide():void 0}toggleChildren(e=this.children,t=i){var n,r;const s=this;null===(n=s.grid.columns)||void 0===n||n.beginBatch(),s.isTogglingAll=!0,e.forEach((e=>e.toggle(t))),s.isTogglingAll=!1,null===(r=s.grid.columns)||void 0===r||r.endBatch()}onCollapseChange(e=i){const t=this;if("toggleAll"===t.collapseMode)t.toggleChildren();else{var n,r;const{firstChild:i}=t;null!=i.flex&&t.collapsed?(i.oldFlex=i.flex,i.width=i.element.offsetWidth):!t.collapsed&&i.oldFlex&&(i.flex=i.oldFlex,i.oldFlex=null),null===(n=t.grid.columns)||void 0===n||n.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach((t=>t.toggle(e))),t.isTogglingAll=!1,null===(r=t.grid.columns)||void 0===r||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:n=[]}=t;if(e)n.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"b-icon-collapse-"+(t.grid.rtl?"right":"left"),pressedIcon:"b-icon-collapse-"+(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:e})=>t.collapsed=e});else{const e=n.findIndex((e=>"collapseExpand"===e.ref));e>-1&&n.splice(e,1)}t.headerWidgets=n,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return td.generatedIdIndex||(td.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++td.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return Br.measureSize(e,null===(t=this.subGrid)||void 0===t?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return ed(e)&&ed(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,n,r)}resizeToFitContent(e,t,n=!1){const i=this,{grid:s,element:o,fitMode:a}=i,{rowManager:l,store:c}=s,{count:d}=c;if(d<=0||"none"===i.fitMode||!i.fitMode)return;const[u]=l.rows,{rowElement:h,cellElement:g}=s.beginGridMeasuring(),m=new Kc({grid:s,column:i,id:null});let p,f,v,y,b,C,S=0,D={length:0,record:null};if(g._domData={columnId:i.id,row:u,rowElement:h},m._cell=g,m.updatingSingleRow=!0,m.isMeasuring=!0,g.innerHTML="",s.resizeToFitIncludesHeader&&!s.hideHeaders){if(!s.$headerPadding){const e=r.getComputedStyle(o);s.$headerPadding=parseInt(e.paddingLeft)}const e=o.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",S=e.offsetWidth+2*s.$headerPadding+2,e.style.cssText=""}for(d>1e3?(p=Math.max(Math.min(l.topIndex+Math.round(l.rowCount/2)-500,d-1e3),0),f=p+1e3):(p=0,f=d),v=p;v<f;v++){if(y=c.getAt(v),b=i.getRawValue(y),"value"===a)C=String(b).length;else if(m._record=D.record,m._id=y.id,m._rowIndex=v,u.renderCell(m),"textContent"===a)C=g.textContent.length;else{const e=g.offsetWidth;e>S&&(S=e)}C>D.length&&(D={record:y,length:C,rowIndex:v})}return D.length>0&&("value"===a||"textContent"===a)&&(m._record=D.record,m._id=D.record.id,m._rowIndex=D.rowIndex,u.renderCell(m),S=Math.max(S,g.offsetWidth)),Array.isArray(e)&&([e,t]=e),S=Math.max(S,e||0),S=Math.min(S,t||1e6),n||s.endGridMeasuring(),i.width=i.maxWidth?S=Math.min(S,i.maxWidth):S,S}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=i:"flex"in e&&t.width&&(t.width=i),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,n=e&&(null==t?void 0:t.focusedCell);(null==n?void 0:n.columnId)===this.id&&(t.owns(Br.getActiveElement(t))?t.navigateRight():t._focusedCell=new Kc({grid:t,rowIndex:n.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return e.getValue(this.field)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}refreshHeader(){this.grid.refreshHeader(this)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(t!==i)return t}return!0}insertChild(e,t=null,n=!1){return(e=Array.isArray(e)?e:[e]).forEach((e=>{const{parent:t}=e;null!=t&&t.collapsed&&e===t.firstChild&&t.children.length>1&&1===t.children.filter((e=>!e.hidden)).length&&(e.nextSibling.hidden=!1)})),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var t;const n=super.getCurrentConfig(e);return null!==(t=this.sortable)&&void 0!==t&&t.originalSortFn&&(n.sortable=this.sortable.originalSortFn),n.renderer===this.internalRenderer&&delete n.renderer,n.headerRenderer===this.internalHeaderRenderer&&delete n.headerRenderer,delete n.ariaLabel,delete n.cellAriaLabel,n}}td.emptyCount=0,td.defaultWidth=100,td.exposeProperties(),td._$name="Column";const nd={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},rd=[{field:"region"}];class id extends(rt(ao)){static get defaultConfig(){return{modelClass:td,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:rd,reapplySortersOnAdd:!0}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((n,r)=>e.call(t,n,r)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some((e=>e.flex))}calculateFixedWidth(e){return e.flex?e.measureSize(td.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed)))),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,n=!1){const r=this.visibleColumns,i=e instanceof td?e:this.getById(e);let s=r.indexOf(i)+(t?1:-1);if(!r[s]){if(!n)return null;s=t?0:r.length-1}return r[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,n;const{grid:r={}}=this,{store:i}=r,s=null==i||null===(t=i.modelClass)||void 0===t||null===(n=t.fieldMap)||void 0===n?void 0:n[e.field];let o=this.modelClass;if(null!=s&&s.column&&(e=p.merge({},s.column,e)),e.type&&(o=id.getColumnClass(e.type),!o))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const a=new o(e,this);if(a.data.region||(a.data.region=r.defaultRegion||"normal"),this.autoAddField&&!a.noFieldSpecified&&i&&!s){let e=a.field;a.constructor.fieldType&&(e={name:a.field,type:a.constructor.fieldType}),i.modelClass.addField(e)}return a}indexOf(e){if(null==e)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}removeAll(e=!1){const t=this;return t.some((e=>e.isTimeAxisColumn))?t.remove(t.query((e=>!e.isTimeAxisColumn)),e):super.removeAll(e)}get usesAutoHeight(){return this.find((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.find((e=>e.autoHeight&&null!=e.flex))}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find((t=>t.field===e.field))}:e.type?{id:e.type,node:this.allRecords.find((t=>t.type===e.type))}:{id:null,node:null}}static registerColumnType(e,t=!1){e.simpleRenderer=t,(id.columnTypes||(id.columnTypes={}))[e.type]=e}static getColumnClass(e){return id.columnTypes&&id.columnTypes[e]}generateColumnForField(e,t){var n;"string"==typeof e&&this.grid&&(e=null===(n=this.grid.store)||void 0===n?void 0:n.modelClass.fieldMap[e]);let r=e.column||nd[e.type]||{};return"string"==typeof r&&(r={type:r}),r=Object.assign({text:e.text||$.separate(e.name),field:e.name},t,r),null!=e.precision&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}id.registerColumnType(td,!0),id._$name="ColumnStore";class sd extends ds{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}}sd.exposeProperties(),sd._$name="GridRowModel";const od=e=>{const t=e.parentElement,n=e.cloneNode(!0);return n.classList.add("b-removing"),t.insertBefore(n,e),n};class ad extends fi{static get pluginConfig(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{rowClass:Zc,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const n=this;return n.autoHeight&&(e=n.store.allCount*n.preciseRowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0),e&&(t.topIndex=t.lastScrollTop=0),t.scrollTargetRecordId=null;const{topRow:n}=t;n&&(n.dataIndex=t.topIndex,n.setTop(t.calculateTop(t.topIndex),!0)),t.estimateTotalHeight(),t.renderFromRow(n)}matchRowCount(e=!1){const t=this,{rows:n,grid:r,rowClass:i}=t,s=n.length,o=s-t.rowCount;if(o)if(o<0){const o=[];for(let e=s,a=s?n[s-1].dataIndex+1:0;e<t.rowCount;e++,a++)o.push(i.new({cls:r.rowCls,rowManager:t,grid:r,index:e,dataIndex:a}));n.push.apply(n,o),t.trigger("addRows",{rows:o}),e||t.renderFromRow(n[Math.max(0,s-1)])}else{var a;const{focusedCell:e}=r,i=null!=(null==e?void 0:e.id)&&(null==e||null===(a=e.cell)||void 0===a?void 0:a.contains(Br.getActiveElement(r))),c=n.splice(s-o,o);var l;if(i)o===s?r.onFocusedRowDerender():(null===(l=t.getRowFor(e._record))||void 0===l?void 0:l.index)>=n.length&&n[n.length-1].cells[e.columnIndex].focus();t.trigger("removeRows",{rows:c}),c.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,n=!1){var r;const i=this,{store:s}=i,o=Math.ceil(i.viewHeight/i.minRowOffsetHeight),a=o+i.prependRowBuffer+i.appendRowBuffer;if(null===(r=i.grid.columns)||void 0===r||!r.count||isNaN(o))return i.rowCount=0,0;if(a<i.rowCount&&!t)return i.rowCount;if(i.visibleRowCount=o,i.rowCount=Math.min(s.count,a),!e){var l;if(i.rows&&i.rowCount!==i.rows.length){if(i.matchRowCount(n),(null===(l=i.bottomRow)||void 0===l?void 0:l.dataIndex)>=s.count&&0!==i.topRow.dataIndex){const e=i.bottomRow.dataIndex-s.count+1;for(const t of i.rows)t.dataIndex-=e;i.topIndex-=e}}else i.rowCount||i.trigger("changeTotalHeight",{totalHeight:i.totalHeight});i.grid.toggleEmptyText()}return i.rowCount}insert(e,t){var n;const r=this,{rows:i,rowCount:s,rowClass:o,grid:a,rowHeight:l}=r,{rowCls:c}=a,d=(null===(n=i[e-1])||void 0===n?void 0:n.dataIndex)+1||0,u=e>=a.store.count,h=[],g=Gt.as("ms",Br.getStyleValue(a.element,"--row-splice-duration")),m=r.lastVisibleRow.index+1-e;if(t<0){var p;t=Math.abs(t);const n=Math.min(t,m),o=i.slice(e,e+n),l=n?o[o.length-1].bottom-o[0].top:0,c=[];for(let e=0,{length:t}=o;e<t;e++)c.push(...o[e]._elementsArray.map(od));if(a.setTimeout((()=>{c.forEach((e=>e.remove()))}),g),u)return r.calculateRowCount(!1,!0,!0);for(let t=e;t<s;t++)i[t].setTop(i[t].top+l);null===(p=c[0])||void 0===p||p.getBoundingClientRect(),Br.addTemporaryClass(a.element,"b-splicing-rows",g,a)}else if(t>0){t=r.grid.hasVerticalOverflow?Math.min(t,r.lastVisibleRow.index+1-e):t;let n=e,s=d;for(let e=0;e<t;e++,n++,s++)h.push(o.new({cls:`${c} b-adding`,rowManager:r,grid:a,index:n,dataIndex:s}));for(let t=e;t<r.rowCount;t++,n++,s++)i[t].index=n,i[t].dataIndex=s;a.setTimeout((()=>{h.forEach((e=>!e.isDestroyed&&e.removeCls("b-adding")))}),g),i.splice(e,0,...h),r.rowCount+=t,t&&r.trigger("addRows",{rows:h});for(let n=0,r=((null===(f=i[e-1])||void 0===f?void 0:f.bottom)||0)-l;n<t;n++,r+=l){var f;h[n].setTop(r)}Br.addTemporaryClass(a.element,"b-splicing-rows",g,a)}return r.renderFromRow(i[e]),h}removeAllRows(){const e=this,{topRow:t}=e,n=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},n}setPosition(e){const{topRow:t}=this,{topRowIndex:n,topRowTop:r}=e;t&&(t.setTop(r),t.dataIndex=n)}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=wn.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=Br.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>Math.ceil(this.grid.scrollable.y)))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=Math.ceil(this.grid.scrollable.y)))}get lastVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}get lastFullyVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,(t=>t.bottom<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:n}=t;for(let r=0;r<n;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:n,fixedRowHeight:r}=t,i=t.rowHeight;if(i!==e){if(Xt.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const s=n.scrollable.y,o=t.getRowAt(s,!0),a=o?o.top-s:0;let l,c;r?(l=e,c=i):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+n._rowBorderHeight),!0),t.refresh();s*(l/c)!==s&&n.scrollRowIntoView(o.id,{block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e,oldHeight:i})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const n=this,{heightMap:r}=n;n.fixedRowHeight||(r.has(e)&&(n.totalKnownHeight-=r.get(e)),r.set(e,t),n.totalKnownHeight+=t,t<n.minRowHeight&&(n.minRowHeight=t),n.averageRowHeight=n.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:n}=t;(e=H.asArray(e)).forEach((e=>{e&&n.has(e.id)&&(t.totalKnownHeight-=n.get(e.id),n.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/n.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let n=0;for(let r=0;r<e;r++){const e=t.getAt(r);n+=this.getOffsetHeight(e)}return Math.floor(n)}getRecordCoords(e,t=!1,n=!1){const r=this,i=r.getRowById(e);let s=r.client._bodyRectangle;return t||(s=r.client.refreshBodyRectangle()),i?new wn(s.x,t?Math.round(i.top):Math.round(i.top+s.y-r.client.scrollable.y),s.width,i.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(e),t,n)}getRecordCoordsByIndex(e,t=!1,n=!1){const r=this,{topRow:i,bottomRow:s}=r,o=r.client._bodyRectangle,{id:a}=r.store.getAt(e),l=r.preciseRowOffsetHeight,c=i.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},h=r.allHeightsKnown&&!n?r.calculateTop(e):Math.floor(u.y+u.index*l),g=Math.floor(r.heightMap.get(a)??l),m=t?"topRow"===u.from?h+l-g:h:h+o.y-r.client.scrollable.y,p=new wn(o.x,m,o.width,g);return p.virtual=!0,p.block=p.bottom<o.y?"start":p.y>o.bottom?"end":"nearest",p}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const n=new Kc({grid:this.grid,record:e,columnId:t});return Boolean(n.cell&&n.row.renderCell(n))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:n,store:r,topIndex:i,topRow:s}=t,o=r.count;let a=e?n.indexOf(e):0;if(0===t.calculateRowCount(!1,o<n.length,!0))return void t.estimateTotalHeight(!0);t.topIndex<i?(t.topRow.setTop(t.calculateTop(t.topIndex),!0),a=0,e=t.topRow):e&&n.indexOf(e)<0&&(e=n[a]||s);let l=e?e.dataIndex:n[0].dataIndex;const c=o-l-1,d=Math.min(n.length-1,a+c);let u,h=n.length-d-1,g=a>0?n[a-1].bottom:n[a].top;for(let e=a;e<=d;e++)u=n[e],u.dataIndex=l,u.setTop(g,!0),u.render(l,r.getAt(l++),!1),g+=u.offsetHeight;for(;h-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,n=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const r of e)t=r.height,r.render(null,null,!1),n|=r.height!==t;n&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const n=this;let r,i,s=e.bottom;for(i=e.dataIndex+1,r=n.getRow(i);r;r=n.getRow(++i))s=r.translate(s);t||n.estimateTotalHeight(!0)}refresh(e=!1){const t=this,{topRow:n}=t;!n&&!e||t.grid.refreshSuspended||(t.idMap={},t.renderFromRow(n),t.trigger("refresh"))}jumpToPosition(e,t){const n=this,{store:r,heightMap:i}=n,s=r.count;if(n.allHeightsKnown&&!n.fixedRowHeight){const t=e-n.prependBufferHeight,o=n.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=r.getAt(l);a+=i.get(e.id)+o,l++}const c=Math.max(Math.min(l,s-n.rowCount),0);n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=c,n.topRow.setTop(n.calculateTop(c),!1),n.refresh()}else{const r=n.preciseRowOffsetHeight,i=null==t?Math.floor(e/r)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),o=Math.max(Math.min(i,s-n.rowCount),0),a=n.client.scrollable.y,l=Math.min(n.client._bodyRectangle.height+a+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=o,n.topRow.setTop(Math.floor(o*r),!1),n.refresh(),n.bottomRow.bottom<l)for(n.calculateRowCount(!1,!1,!1);n.bottomRow.bottom<l&&n._rows[n.prependRowBuffer].top<a&&n.bottomRow.dataIndex<s-1;)n.displayRecordAtBottom();n.estimateTotalHeight()}if(null!=t){const{scrollable:r}=n.grid,i=n.getRow(t),s=i&&wn.from(i._elementsArray[0]).center.y,o=r.viewport.center.y;i&&(r.y=e=Math.floor(r.y+(s-o)))}return e}warpIfNeeded(e){const t=this,n={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(n.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),n.newScrollTop=t.jumpToPosition(e,r),n.deltaTop=0}return n}updateRenderedRows(e,t,n=!1){const r=this,i=r.client._bodyRectangle;if(0===r.rowCount)return 0;let s=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+i.height){const t=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=t.newScrollTop,t.deltaTop>0?r.fillBelow(t.newScrollTop):t.deltaTop<0&&r.fillAbove(t.newScrollTop),r.fixedRowHeight||n||r.correctError(t,i,e),s=r.estimateTotalHeight()}return s}correctError(e,t,n){const r=this;let i=0;(r.allHeightsKnown||e.deltaTop<0&&n<2*t.height||e.deltaTop>0&&n>r.totalHeight-2*t.height-3)&&(i=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),i&&(r.offsetRows(-i),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-i)}fillAbove(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>n&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,i=t.rowCount;let s=0;for(;s<n&&t.topIndex+i<r&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const n=t.store.count,r=n-t.heightMap.size,{bottomRow:i}=t;let s;if(t.fixedRowHeight)s=n*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,i&&r){const e=i.bottom;(e>s||t.topIndex+t.rowCount>=n&&s>e&&e>0)&&(s=e,i.dataIndex<n-1&&(s+=(n-1-i.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){var e;const t=this,{grid:n}=t,r=t.topIndex-1,i=t.store.getAt(r),s=t.bottomRow,o=s.top;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s._top=t.topRow.top-t.getOffsetHeight(i),s.estimatedTop=!t.fixedRowHeight,s.render(r,i,!1),s._top=o,s.setBottom(t.topRow.top),s.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),t.fixIndices(),s.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:n}=t,r=t.topIndex+t.rowCount,i=t.store.getAt(r),s=t.topRow;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s.dataIndex=r,s.setTop(t.bottomRow.bottom),s.render(r,i,!1),t.topIndex++,t._rows.push(t._rows.shift()),t.fixIndices(),s.offsetHeight}fixIndices(){for(let e=0,{rows:t}=this,{length:n}=t;e<n;e++)t[e].index=e}}ad.featureClass="",ad._$name="RowManager";const ld={x:1},cd=e=>e.isSubGrid;class dd extends No{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=ld){if("string"==typeof t&&(t={[t]:1}),t.x){e.owner.initScroll();const t=this.widget.items.filter(cd),n=e.widget.items.filter(cd);for(let e=0,{length:r}=t;e<r;e++)t[e].scrollable.addPartner(n[e].scrollable,"x")}t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach(((t,n)=>{t.isDestroyed||t.removePartner(e.xScrollers[n])})),super.removePartner(e)}updateOverflowX(e){var t;const n=!1===e;null===(t=this.xScrollers)||void 0===t||t.forEach((e=>e.overflowX=n?"hidden":"hidden-scroll")),this.widget.virtualScrollers.classList.toggle("b-hide-display",n)}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return super.scrollIntoView(e,t);for(const n of this.xScrollers)if(n.element.contains(e))return n.scrollIntoView(e,t)}hasOverflow(e="y"){return"y"===e&&this.scrollHeight>this.clientHeight}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}dd._$name="GridScroller";class ud extends ba{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let n;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id),i=Br.setLength(t.width),s=Br.setLength(t.minWidth),o=Br.setLength(t.maxWidth);if(r){if(n=i,r.style.maxWidth=o,t.isParent&&null==t.width&&null==t.flex){const e=t.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);r.style.flex=e>0?`${e} 0 auto`:"",r.style.minWidth=null,e>0&&t.traverse((e=>e.data.minWidth=null))}else if(parseInt(t.minWidth)>=0&&(r.style.minWidth=s),r.style.flex=r.style.flexBasis=r.style.width="",t.flex)!isNaN(parseInt(t.flex))&&t.children?r.style.flex=`${t.flex} 0 auto`:r.style.flex=t.flex;else if(parseInt(t.width)>=0){const s=t.parent;!e.isHeader||s.isRoot||s.width?r.style.flexBasis=n:r.style.width=i}t.height>=0&&(r.style.height=Br.setLength(t.height))}})),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}ud.initClass(),ud._$name="Bar";class hd extends ud{static $name="Header";static type="gridheader";get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return null===(e=this.subGrid)||void 0===e?void 0:e.region}changeElement(e,t){const{region:n}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${n}`]:n},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${n}`]:n},dataset:{region:n,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:n,resizable:r,isLeaf:i,isParent:s,isLastInSubGrid:o,cls:a,childLevel:l,field:c,tooltip:d,children:u,isFocusable:h,grid:g}=e,m=null==g?void 0:g.focusedCell,p=-1===(null==m?void 0:m.rowIndex)&&(null==m?void 0:m.column)===e,f={};if(e.isVisible)return e.flex?f.flex=e.flex:e.width&&(f.width=Br.setLength(e.width)),{style:f,className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${n}`]:n,"b-grid-header-resizable":r&&i,[a]:a,"b-collapsible":e.collapsible,"b-last-parent":s&&o,"b-last-leaf":i&&o},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:p?0:-1,dataset:{...lc.encodeConfig(d),columnId:t,[c?"column":""]:c},children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:`${null==g?void 0:g.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map((e=>this.getColumnConfig(e))),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>e.refreshColumn(t))),e.fixHeaderWidths()}refreshColumn(e){const t=this,n=t.getBarCellElement(e.id);if(n){let r=e.headerText;e.headerRenderer&&(r=e.headerRenderer.call(e.thisObj||t,{column:e,headerElement:n})),e.headerWidgetMap&&Object.values(e.headerWidgetMap).forEach((t=>{t.render(e.textWrapper)})),e.icon&&(r=`<i class="${$.encodeHtml(e.icon)}"></i>`+(r||""));const i=n.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=r||"")}}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const n=this;let r=0;null!=t&&t.meta&&t.meta.depth++;for(const i of e){const{meta:e}=i;e.depth=0,i.children&&(n.initDepths(i.children.filter(n.columns.chainedFilterFn),i),e.depth&&t&&(t.meta.depth+=e.depth)),e.depth>r&&(r=e.depth)}return t||(n.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;To.sync({domConfig:{children:e.columns.topColumns.map((t=>e.getColumnConfig(t))),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onInternalPaint({firstPaint:e}){e&&this.refreshContent()}}hd.initClass(),hd._$name="Header";class gd extends ud{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onInternalPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return Cc.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>Cc.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="presentation">
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}gd.initClass(),gd._$name="Footer";const md={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},pd=["pageX","pageY","clientX","clientY","screenX","screenY"];function fd(e,t=!0){null==e||e.classList.toggle("b-hover",t)}function vd(e,t,n=!0){t&&e&&fd(t.getCell(e),n)}var yd=e=>class extends(e||ye){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(md),t=e.length,n={element:this.bodyElement,thisObj:this};for(let r=0;r<t;r++){const t=e[r];n[t]={handler:"handleEvent"},t.startsWith("touch")&&(n[t].passive=!1)}Zn.on(n),Zn.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e,t=!1){const n=this,{columns:r}=n,{target:s}=e,o=s.classList.contains("b-grid-row");let a=s.closest(".b-grid-cell");if(a||!t||o||s.classList.contains("b-grid-subgrid")){if(o){var l;a=null===(l=Br.childFromPoint(e.target,e.offsetX,e.offsetY-s.offsetHeight/2))||void 0===l?void 0:l.closest(".b-grid-cell")}}else{const{top:t,left:s,right:o,bottom:l}=n.bodyContainer.getBoundingClientRect();let d,{x:u,y:h}=e;var c;if(u>=s&&u<=o?h=d=Math.ceil(n[(h<t?"first":"last")+"FullyVisibleRow"].element.getBoundingClientRect().y):h>=t&&h<=l&&(u=d=Math.ceil(r.visibleColumns[u<s?0:r.visibleColumns.length-1].element.getBoundingClientRect().x)),d!==i)a=null===(c=Br.childFromPoint(e.target,e.offsetX,e.offsetY))||void 0===c?void 0:c.closest(".b-grid-cell")}if(a){const e=qc.get(a),{id:t,columnId:i}=e,s=n.store.getById(t),o=r.getById(i);return s?{cellElement:a,cellData:e,columnId:i,id:t,record:s,column:o,cellSelector:{id:t,columnId:i}}:null}}getHeaderDataFromEvent(e){const t=e.target.closest(".b-grid-header");if(t){const e=Xt.assign({},t.dataset),{columnId:n}=e,r=this.columns.getById(n);return r?{headerElement:t,headerData:e,columnId:n,column:r}:null}}handleEvent(e){!this.disabled&&md[e.type]&&this[md[e.type]](e)}onElementTouchStart(e){const t=this,n=t.getCellDataFromEvent(e);Br.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime)),n&&!e.defaultPrevented&&t.onFocusGesture(e)}onElementTouchMove(e){const t=this,{lastTouchTarget:n}=t,r=e.changedTouches[0],{pageX:i,pageY:s}=r,o=document.elementFromPoint(i,s);if(t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null),o!==n){if(n){const t=new MouseEvent("mouseout",Xt.copyProperties({relatedTarget:o,pointerType:"touch",bubbles:!0},r,pd));t.preventDefault=()=>e.preventDefault(),null==n||n.dispatchEvent(t)}if(o){const t=new MouseEvent("mouseover",Xt.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},r,pd));t.preventDefault=()=>e.preventDefault(),null==o||o.dispatchEvent(t)}}t.lastTouchTarget=o}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t,n=this.getCellDataFromEvent(t)){const r=this;if(n){const s=r.columns.getById(n.columnId),o={grid:r,record:n.record,column:s,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t};var i;if(r.trigger("cell"+$.capitalize(e),o),"click"===e)null===(i=s.onCellClick)||void 0===i||i.call(s,o)}}onElementMouseDown(e){const t=this,n=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,n),n&&!e.defaultPrevented&&t.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:t,y:n}){if(e.closest(".b-grid-splitter")||e.matches(".b-grid-row, .b-virtual-width"))return!0;if(e.matches(".b-vertical-overflow")){return t>e.getBoundingClientRect().right-Br.scrollBarWidth}if(e.matches(".b-horizontal-overflow")){return n>e.getBoundingClientRect().bottom-Br.scrollBarWidth-1}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,n=t.getCellDataFromEvent(e);n&&t.triggerCellMouseEvent("click",e,n)}onFocusGesture(e){const t=this,{navigationEvent:n}=t,{target:i}=e,s=2===e.button,a=!s&&i.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),l=!document.hasFocus()&&o.isMac&&s;if(a||l)e.preventDefault();else{var c;t.navigationEvent=e;const o=new Kc(i);if(s||null!==(c=t.focusedCell)&&void 0!==c&&c.equals(o)){let s;r.TouchEvent&&e instanceof MouseEvent&&n instanceof TouchEvent&&i===n.target&&(s={doSelect:!1}),t.focusCell(o,s)}}}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const e=t.closest(".b-grid-header");this.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const n=this,{hoveredCell:r}=n,i=("number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType;let s=e.target.closest(".b-grid-cell");var t;if(!s&&e.target.classList.contains("b-grid-row"))s=null===(t=Br.childFromPoint(e.target,e.offsetX,e.offsetY-2))||void 0===t?void 0:t.closest(".b-grid-cell");s&&(i&&(n.hoveredCell=s),r!==n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",e)),n.trigger("mouseOver",{event:e})}}onElementMouseOut(e){var t;const n=this,{target:r,relatedTarget:i}=e;i&&r.matches(".b-grid-cell")&&!r.contains(i)?i.matches(".b-grid-row")||(n.hoveredCell=i.closest(".b-grid-cell")):null!=i&&i.matches(".b-grid-row,.b-grid-cell")||null!==(t=n.hoveredCell)&&void 0!==t&&t.contains(i)||(n.hoveredCell=null),n.scrolling||((null==i?void 0:i.closest(".b-grid-cell"))!==(null==r?void 0:r.closest(".b-grid-cell"))&&null!=r&&r.closest(".b-grid-cell")&&n.triggerCellMouseEvent("mouseOut",e),n.trigger("mouseOut",{event:e}))}updateHoveredCell(e,t){var n,r;const i=this,{selectionMode:s}=i,o=s.rowNumber&&(null===(n=i.columns.find((e=>"rownumber"==e.type)))||void 0===n?void 0:n.id),a=s.checkbox&&(null===(r=i.checkboxSelectionColumn)||void 0===r?void 0:r.id);if(t){fd(t,!1);const e=qc.get(t),{row:n}=e;var l;if(n&&!n.isDestroyed&&(vd(o,n,!1),vd(a,n,!1)),null!=e&&e.columnId)fd(null===(l=i.columns.getById(e.columnId))||void 0===l?void 0:l.element,!1)}if(i._hoveredRow&&!i._hoveredRow.isDestroyed&&i._hoveredRow.removeCls("b-hover"),i._hoveredRow=null,e&&!i.scrolling){const t=qc.get(e),{row:n}=t;if(n)if(s.cell&&t.columnId!==o&&t.columnId!==a){const r=i.columns.getById(t.columnId);fd(e),vd(a,n),vd(o,n),null!=r&&r.element&&!1!==r.headerHoverable&&fd(r.element)}else i._hoveredRow=n,n.addCls("b-hover");else i.hoveredCell=null}}keyMapOnKeyDown(e){this.element.contains(e.target)&&(this.onElementKeyDown(e),super.keyMapOnKeyDown(e))}onElementKeyDown(e){if(e.handled||!this.element.contains(e.target))return;const t=this,n=t.focusedCell;if(null!=n&&n.isCell&&!n.isActionable){var r,i;const s=n.cell;null===(r=(i=t.columns.getById(s.dataset.columnId)).onCellKeyDown)||void 0===r||r.call(i,{event:e,cellElement:s})}}undoRedoKeyPress(e){var t;const{stm:n}=this.store;return!(!n||!this.enableUndoRedoKeys||null!==(t=this.features.cellEdit)&&void 0!==t&&t.isEditing)&&(n.onUndoKeyPress(e),!0)}clickCellByKey(e){const t=this,n=t.focusedCell,r=null==n?void 0:n.cell,i=t.columns.getById(r.dataset.columnId);return!(null==n||!n.isCell||n.isActionable||!i.onCellClick)&&(i.onCellClick({grid:t,column:i,record:t.store.getById(n.id),cellElement:r,target:e.target,event:e}),!0)}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("contextMenu",e,n),Br.isTouchEvent&&t.onFocusGesture(e))}onInternalResize(e,t,n,i,s){const o=this;o._devicePixelRatio&&o._devicePixelRatio!==r.devicePixelRatio&&Br.resetScrollBarWidth(),o._devicePixelRatio=r.devicePixelRatio,o._bodyRectangle=wn.client(o.bodyContainer),super.onInternalResize(...arguments),n!==s&&(o._bodyHeight=o.bodyContainer.offsetHeight,o.isPainted&&o.rowManager.initWithHeight(o._bodyHeight)),o.refreshVirtualScrollbars(),t!==i&&o.setTimeout((()=>{o.isDestroyed||o.updateResponsive(t,i)}),0)}get widgetClass(){}};const bd=new Map,Cd=new Map,Sd="Grid",Dd={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},wd=/\$\d+$/;class Ed{static registerFeature(e,t=!1,n=null,r=null){r=(r=$.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(wd,""),Array.isArray(n)||(n=[n||Sd]),n.forEach((n=>{const i=Dd[n]||n,s=bd.get(i)||new Map,o=Cd.get(i)||new Map;s.set(r,e),o.set(e,t),bd.set(i,s),Cd.set(i,o)}))}static getTypeNameFeatures(e=Sd){const t=Dd[e]||e,n=bd.get(t),r={};return n&&n.forEach(((e,t)=>r[t]=e)),r}static getTypeNameDefaultFeatures(e=Sd){const t=Dd[e]||e,n=bd.get(t),r=Cd.get(t),i={};return n&&r&&n.forEach(((e,t)=>{r.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[n,r])=>(this.isDefaultFeatureForTypeName(r,t)?e[n]=r:delete e[n],e)),e)),{})}static isDefaultFeatureForTypeName(e,t=Sd){const n=Dd[t]||t,r=Cd.get(n);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const n=t.$meta.names.slice().reverse();let r=null;for(let t=0,i=n.length;t<i&&null===r;++t){const i=Cd.get(n[t]);i&&i.has(e)&&(r=i.get(e))}return r||!1}static reset(){bd.clear(),Cd.clear()}}const xd={string:1,object:1,function:1};var Rd=e=>class extends(e||ye){static get $name(){return"GridFeatures"}set features(e){const t=this,n=Ed.getInstanceDefaultFeatures(this);e=t._features=Xt.assign({},e),n&&Object.keys(n).forEach((t=>{t in e||(e[t]=!0)}));const i=Ed.getInstanceFeatures(this);for(const n of Object.keys(e)){const s=e[n];if(s){const o=!r.__bryntum_code_editor_changed;if($.uncapitalize(n)!==n){const e=`Invalid feature name '${n}', must start with a lowercase letter`;if(o)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const a=i[n];if(!a){const e=`Feature '${n}' not available, make sure you have imported it`;if(o)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,n,t.createFeatureInitializer(e,n,a,s))}}}get features(){return this._features}createFeatureInitializer(e,t,n,r){const i=[this],s=n.prototype.construct;return!0===r&&(r={}),xd[typeof r]&&(i[1]=r),{configurable:!0,get:()=>(delete e[t],n.prototype.construct=function(...r){e[t]=this,s.apply(this,r),n.prototype.construct=s},new n(...i))}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}hasActiveFeature(e){var t,n;return Boolean((null===(t=this.features)||void 0===t?void 0:t[e])&&!(null!==(n=this.features)&&void 0!==n&&n[e].disabled))}getConfigValue(e,t){if("features"===e){const e={};for(const s in this.features){var n,r,i;const o=null===(n=this.features[s])||void 0===n||null===(r=(i=n).getCurrentConfig)||void 0===r?void 0:r.call(i,t);o?Xt.isEmpty(o)?Ed.isDefaultFeatureForInstance(this.features[s].constructor,this)||(e[s]=!0):e[s]=o:e[s]=!1}return e}return super.getConfigValue(e,t)}get widgetClass(){}};const Td=Object.freeze({}),Md=Object.freeze({x:!1,y:!1}),kd=function(e){return this.focusableFinderCell.contains(e)?Br.isFocusable(e)&&!e.disabled?Br.NodeFilter.FILTER_ACCEPT:Br.NodeFilter.FILTER_SKIP:Br.NodeFilter.FILTER_REJECT};var Id=e=>class extends(e||ye){static get $name(){return"GridNavigation"}static configurable={focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}}};onStoreRecordIdChange(e){var t;null===(t=super.onStoreRecordIdChange)||void 0===t||t.call(this,e);const{focusedCell:n}=this,{oldValue:r,value:i}=e;n&&n.id===r&&(n._id=i)}onFocusedRowDerender(){const e=this,{focusedCell:t}=e;if(null!=(null==t?void 0:t.id)&&t.cell){const n=t.cell.contains(Br.getActiveElement(e));if(e.hideHeaders)n&&e.revertFocus();else{const r=e.normalizeCellContext({rowIndex:-1,columnIndex:n?t.columnIndex:0});n?e.focusCell(r):r.cell.tabIndex=0}t.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(Kc.FIRST_CELL)}navigateFirstColumn(){this.focusCell(Kc.FIRST_COLUMN)}navigateLastCell(){this.focusCell(Kc.LAST_CELL)}navigateLastColumn(){this.focusCell(Kc.LAST_COLUMN)}navigatePrevPage(){this.focusCell(Kc.PREV_PAGE)}navigateNextPage(){this.focusCell(Kc.NEXT_PAGE)}activateHeader(e){if(e.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){var t;const{column:n}=this.focusedCell;null===(t=n.onKeyDown)||void 0===t||t.call(n,e),this.getHeaderElement(n.id).click()}return!1}onEscape(e){var t,n;const r=this,{focusedCell:i}=r;!e.target.closest(".b-dragging")&&null!=i&&i.isActionable?(e.stopImmediatePropagation(),r._focusedCell=null,r.focusCell({rowIndex:i.rowIndex,column:i.column},{disableActionable:!0})):!r.isNested||!r.owner||null!==(t=(n=r.owner).catchFocus)&&void 0!==t&&t.call(n,{source:r})||r.revertFocus(!0)}onTab(e){const{target:t}=e,{focusedCell:n,bodyElement:r}=this,{isActionable:i,actionTargets:s}=n;if(i&&Br.isEditable(t)&&!t.readOnly&&t===s[s.length-1])e.preventDefault(),this.navigateRight(e);else if(!i||t===s[s.length-1])return r.style.display="none",this.requestAnimationFrame((()=>r.style.display="")),!1}onShiftTab(e){const t=this,{target:n}=e,{focusedCell:r,bodyElement:i}=t,{cell:s,isActionable:o,actionTargets:a}=r,l=o&&Br.isEditable(n)&&!n.readOnly,c=0===r.columnIndex&&r.rowIndex===(t.hideHeaders?0:-1);if(!c&&l&&n===a[0])e.preventDefault(),t.navigateLeft(e);else if(!o||n===a[0]){const e=!c&&!t.hideHeaders&&t.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return e?(e.cell.tabIndex=-1,s.tabIndex=0,t._focusedCell=r):(i.style.display="none",t.requestAnimationFrame((()=>i.style.display=""))),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?`[data-index=${e.rowIndex}] [data-column-id=${e.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(e){var t;return Boolean(null===(t=this._focusedCell)||void 0===t?void 0:t.equals(this.normalizeCellContext(e)))}get focusElement(){if(!this.isDestroying){let t;var e;if(this.store.count&&this._focusedCell)t=this._focusedCell.target;else t=this.normalizeCellContext({rowIndex:-1,columnIndex:(null===(e=this._focusedCell)||void 0===e?void 0:e.columnIndex)||0}).target;const n=super.focusElement;return!n||t&&t.compareDocumentPosition(n)!==Node.DOCUMENT_POSITION_PRECEDING?t:n}}onInternalPaint({firstPaint:e}){var t;const n=this;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments);const r=this.normalizeCellContext({rowIndex:n.hideHeaders?0:-1,column:n.hideHeaders?0:n.columns.find((e=>!e.hidden&&e.isFocusable))});if(r.cell){r._isDefaultFocus=!0,n._focusedCell=r;const{target:e}=r;e===r.cell&&(r.cell.tabIndex=0)}}onGridBodyFocusIn(e){const t=this,{bodyElement:n}=t,r=t.focusedCell,i=(null==r?void 0:r.initialTarget)||(null==r?void 0:r.target),{target:s,relatedTarget:o}=e,a=s.closest(t.focusableSelector);if(a&&(!An.currentMouseDown||An.isMouseDown(0)||An.isMouseDown(2))){var l;const u=new Kc(s),{cell:h}=u,g=null==r?void 0:r.cell,m=u.actionTargets=t.findFocusables(a),p=(!t._fromFocusCell||t.selectOnFocus)&&(s===h||t._selectActionCell)&&!(null!=s&&s._isRevertingFocus);if(!t.store.getById(a.parentNode.dataset.id)&&h!==a)return void h.focus({preventScroll:!0});if(s.matches(t.focusableSelector)){if(t.disableActionable)u._target=h;else if(m.length){var c;return t._selectActionCell=(null===(c=An.currentMouseDown)||void 0===c?void 0:c.target)===s,m[0].focus(),void delete t._selectActionCell}}else{var d;if(null!=r&&r.target&&o&&(!An.isMouseDown()||!n.contains(null===(d=An.currentMouseDown)||void 0===d?void 0:d.target))&&!n.contains(o)&&!u.equals(r))return void i.focus();u._target=s}if(g&&(g.classList.remove("b-focused"),g.tabIndex=-1),h&&(h.classList.add("b-focused"),u.column.onCellFocus(u),h===s&&(h.tabIndex=0),h.contains(e.relatedTarget)&&i===s))return;t._focusedCell=u,null===(l=t.onCellNavigate)||void 0===l||l.call(t,t,r,u,p),t.trigger("navigate",{lastFocusedCell:r,focusedCell:u,event:e})}else s.closest(".b-rowexpander-body")||null==i||i.focus({preventScroll:!0})}findFocusables(e){const{focusableFinder:t}=this,n=[];t.currentNode=this.focusableFinderCell=e;for(let e=t.nextNode();e;e=t.nextNode())n.push(e);return n}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,Br.NodeFilter.SHOW_ELEMENT,{acceptNode:kd.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,t=Td){var n,r;const i=this,{_focusedCell:s}=i,{scroll:o,disableActionable:a}=t,l=e===Kc.DOWN,c=e===Kc.UP;if(-1===(null===(n=e)||void 0===n?void 0:n.rowIndex)&&i.hideHeaders)return void i.revertFocus();e="number"==typeof e&&null!=s&&s.isLocation?s.move(e):i.normalizeCellContext(e);const d="doSelect"in t?t.doSelect:!e.isActionable||e.initialTarget===e.cell;if(e.equals(s)){var u,h,g;if(i.isNested&&(l||c))null!==(u=i.owner)&&void 0!==u&&null!==(h=u.catchFocus)&&void 0!==h&&h.call(u,{source:i,navigationDirection:l?"down":"up"})||i.revertFocus(!0);else null===(g=i.onCellNavigate)||void 0===g||g.call(i,i,s,e,d);return s}const m=i.getSubGridFromColumn(e.columnId),{cell:p}=e,f=p||i.getCell({rowIndex:i.rowManager.topIndex,columnId:e.columnId}),v=wn.from(m.element),y=wn.from(i.bodyElement),b=wn.from(f).moveTo(null,v.y);return!1===o||-1===e.rowIndex?t=Object.assign({},t,Md):(t=Object.assign({},t,o),b.width>v.width||b.height>y.height?t.x=t.y=!1:t.column=e.columnId,i.scrollRowIntoView(e.id,t)),(i._hoveredRow||i.hoveredCell)&&(i.hoveredCell=null),i.disableActionable=a,i.selectOnFocus=d,i._fromFocusCell=!0,null===(r=e[a?"cell":"target"])||void 0===r||r.focus({preventScroll:!0}),i.disableActionable=i.selectOnFocus=!1,delete i._fromFocusCell,e}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}catchFocus(){}internalNextPrevCell(e=!0){const t=this,n=t._focusedCell;return n?t.focusCell({id:n.id,columnId:t.columns.getAdjacentVisibleLeafColumn(n.column,e,!0).id}):null}navigateRight(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Kc.PREV_CELL:Kc.NEXT_CELL):(arguments[0]&&_.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Kc.NEXT_CELL:Kc.PREV_CELL):(arguments[0]&&_.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(Boolean(this.rtl)))}internalNextPrevRow(e,t=!0,n=!0){const r=this,i=r._focusedCell;if(!i)return!1;const s=r.store["get"+(e?"Next":"Prev")](i.id,!1,t);return s?r.focusCell({id:s.id,columnId:i.columnId,scroll:{x:!1}}):(e||!n||i.isColumnHeader||(this.clearFocus(),this.getHeaderElement(i.columnId).focus()),!1)}navigateDown(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Kc.DOWN):(arguments[0]&&_.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Kc.UP):(arguments[0]&&_.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},Ad=e=>class extends(e||ye){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,n=Object.keys(Xt.assign({},t.responsiveLevels));let r=null,i=99995,s=null;return n.forEach((n=>{let o=t.responsiveLevels[n];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)s=n;else if(e<o){const t=o-e;t<i&&(i=t,r=n)}})),r||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const n=this,r=n.getClosestBiggerLevel(t),i=n.getClosestBiggerLevel(e);if(0===t||r!==i){const s=n.responsiveLevels[i];["number","string"].includes(typeof s)||n.applyState(s),n.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+i),n.trigger("responsive",{level:i,width:e,oldLevel:r,oldWidth:t})}}get widgetClass(){}};class Fd extends td{static $name="RowNumberColumn";static type="rownumber";static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const t=this,{grid:n}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,n&&(n.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:n.store,initial:!0}),n.store.count&&!n.rendered&&n.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const n=this;n.detachListeners("grid"),e.ion({name:"grid",[`change${n.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:n}),t||n.resizeToFitContent()||n.measureOnRender()}onStoreChange({action:e,isMove:t}){if("dataset"===e||"add"===e||"remove"===e||"removeall"===e){if("remove"===e&&t)return;const n=this.resizeToFitContent();"dataset"===e&&!n&&this.grid.store.count&&this.measureOnRender()}}measureOnRender(){this.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:this})}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const e=this,{store:t,element:n}=e.grid,{count:r}=t;if(r&&!e.hidden){const t=n.querySelector(`.b-grid-cell[data-column-id="${e.id}"]`);if(t){const n=t.isConnected?parseInt(Br.getStyleValue(t,"padding-left")):e._cachedCellPadding||0,i=Br.measureText(r,t);return e.width=Math.max(e.minWidth,i+2*n),e._cachedCellPadding=n,!0}}return!1}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var n;return e.classList.add("b-rownumber-header"),(null===(n=t.externalHeaderRenderer)||void 0===n?void 0:n.call(this,...arguments))||t.headerText}}id.registerColumnType(Fd,!0),Fd._$name="RowNumberColumn";const Pd={string:1,number:1},Od={dataset:1,batch:1};var Ld=e=>class extends(e||ye){static get $name(){return"GridSelection"}static configurable={selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{},selectionDisabled:!1};construct(e){this._selectedCells=[],this._selectedRows=[],super.construct(e),null!=e&&e.selectedRecords&&(this.selectedRecords=e.selectedRecords)}getDefaultGridSelection(e){return"GridSelection"===e.$name?e.configurable.selectionMode:e.superclass?this.getDefaultGridSelection(e.superclass):void 0}changeSelectionMode(e){const t=this;return t.selectionMode?(Xt.assign(t.selectionMode,e),t.selectionMode):(t.$defaultGridSelection=t.getDefaultGridSelection(t.constructor),new Proxy(e,{set(e,n,r){const i=Xt.assign({},e);return e[n]=r,t.updateSelectionMode(e,i),!0}}))}updateSelectionMode(e,t=this.$defaultGridSelection){const n=this,{columns:r,checkboxSelectionColumn:s}=n,o={},{rowReorder:a}=n.features;for(const n in e)e[n]!=t[n]&&(o[n]=e[n]);var l,c;(e.rowCheckboxSelection&&!e.checkboxOnly&&(e.checkboxOnly=!0,delete e.rowCheckboxSelection),o.column&&(e.cell=!0,e.multiSelect=!0),o.cell&&(e.checkboxOnly=!1),!1===o.cell&&(e.column=!1),o.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),!1===o.checkbox&&(o.checkboxOnly=!1,o.showCheckAll=!1),o.showCheckAll&&(e.checkbox=e.checkbox||!0,e.multiSelect=!0),(o.includeChildren||o.includeParents)&&(e.multiSelect=!0),!1===o.multiSelect&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=!1),o.dragSelect&&(null!=a&&a.enabled&&!0!==a.gripOnly&&(a.showGrip=a.gripOnly=!0),e.multiSelect=!0,n._selectionListenersDetachers={}),!1===o.dragSelect&&n._selectionListenersDetachers)&&(null===(l=(c=n._selectionListenersDetachers).selectiondrag)||void 0===l||l.call(c),delete n._selectionListenersDetachers.selectiondrag);!t||o.cell===i&&o.deselectFilteredOutRecords===i&&o.multiSelect===i||n.deselectAll(),o.rowNumber?r.findRecord("type","rownumber")||(r.insert(0,{..."object"==typeof e.rowNumber?e.rowNumber:{},type:"rownumber"}),n._selectionAddedRowNumberColumn=!0):!1===o.rowNumber&&n._selectionAddedRowNumberColumn&&(r.remove(r.findRecord("type","rownumber")),delete n._selectionAddedRowNumberColumn),(e.checkbox!==(null==t?void 0:t.checkbox)||e.checkbox&&e.showCheckAll!==(null==t?void 0:t.showCheckAll))&&(n.isConfiguring?n.shouldInitCheckboxSelection=!0:(t&&n.deselectAll(),n.initCheckboxSelection())),t&&e.checkbox&&t.checkbox&&e.checkboxIndex!==t.checkboxIndex&&s&&s.parent.insertChild(s,r.getAt(n.checkboxSelectionColumnInsertIndex)),n.trigger("selectionModeChange",Xt.clone(e)),n.afterSelectionModeChange(e)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){const e=this,{selectionMode:t,columns:n,checkboxSelectionColumn:r}=e,{checkbox:i}=t;if(r&&(e.checkboxSelectionColumn=null,n.remove(r)),i){var s,o;const r=id.getColumnClass("check"),a=!0===i?null:i;if(!r)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const l=e.checkboxSelectionColumn=new r(Xt.assign({id:`${e.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:null===(s=e.items)||void 0===s||null===(o=s[0])||void 0===o?void 0:o.region,showCheckAll:t.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},a),n,{isSelectionColumn:!0});l.meta.depth=0,l._grid=e;const c=l.renderer;l.renderer=t=>{t.value=e.isSelected(t.record),c.call(l,t)},l.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e}),n.insert(e.checkboxSelectionColumnInsertIndex,l)}}get checkboxSelectionColumnInsertIndex(){const{columns:e}=this;let{checkboxIndex:t}=this.selectionMode;return t?"string"==typeof t&&(t=e.indexOf(e.getById(t))):t=e.indexOf(e.findRecord("type","rownumber"))+1,t}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(e){return null!=e&&e.isCollection?(e.owner||(e.owner=this),e):Ms.new(e,{owner:this})}updateSelectedRecordCollection(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:e=[],removed:t}){this.selectedRecordCollection._fromSelection!==this&&(e=e.filter((e=>this.isSelectable(e))),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:e,deselectedRecords:t}))}changeSelectedRecordCollectionSilent(e){this.selectedRecordCollection._fromSelection=this;const t=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,t}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(t=super.bindStore)||void 0===t||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({source:e}){const t=this,n=[];for(const r of t.selectedRows)e.includes(r)||n.push(r);const r=t.prepareSelection(t.selectionMode.deselectFilteredOutRecords?n:[]);if(t.isCellSelectionMode){const{deselectedCells:e}=t.prepareSelection(t.getSelectedCellsForRecords(n));null!=e&&e.length&&(r.deselectedCells=(r.deselectedCells||[]).concat(e))}(r.deselectedCells.length||r.deselectedRecords.length)&&(t.performSelection(r,!1),t.updateCheckboxHeader())}onStoreRecordIdChange({record:e,oldValue:t}){var n;null===(n=super.onStoreRecordIdChange)||void 0===n||n.call(this,...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(e){var t;if(null===(t=super.onStoreRemove)||void 0===t||t.call(this,e),!e.isCollapse){const t=this,n=e.records.filter((e=>this.isSelected(e)));if(n.length){const e=t.prepareSelection(n);if(t.isCellSelectionMode){const{deselectedCells:r}=t.prepareSelection(t.getSelectedCellsForRecords(n));null!=r&&r.length&&(e.deselectedCells=(e.deselectedCells||[]).concat(r))}t.performSelection(e)}}}onStoreDataChange({action:e,source:t}){var n;const r=this,{selectionMode:i}=r;let s;if(null===(n=super.onStoreDataChange)||void 0===n||n.call(this,...arguments),"pageLoad"===e)i.preserveSelectionOnPageChange||(s=r.prepareSelection(null,null,!0)),r.updateCheckboxHeader();else if(Od[e]){const e=[];if(!1===i.preserveSelectionOnDatasetChange)s=r.prepareSelection(null,null,!0);else{e.push(...r.changeSelectedRecordCollectionSilent((e=>e.match(t.storage))));for(const n of r._selectedCells)t.getById(n.id)||e.push(n);s=r.prepareSelection(e)}}s&&(s.deselectAll||s.deselectedCells.length||s.deselectedRecords.length||s.selectedCells.length||s.selectedRecords.length)&&(r.performSelection(s,!1),r.updateCheckboxHeader())}onStoreRemoveAll(){var e;null===(e=super.onStoreRemoveAll)||void 0===e||e.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:e,record:t,checkbox:n}){const r=this,{multiSelect:i}=r.selectionMode,s=!i&&e,o=s||e?null:[t],a=e?[t]:null;r._isCheckboxSelecting=!0,e&&!An.shiftKeyDown&&(r._lastSelectionChecked=t),e&&i&&r._lastSelectionChecked&&An.shiftKeyDown?r.performSelection(r.internalSelectRange(r._lastSelectionChecked,t,!0)):!1===r.performSelection(r.prepareSelection(o,a,s,!0))&&(n.checked=!n.checked),r._isCheckboxSelecting=!1}updateCheckboxHeader(){const{selectionMode:e,checkboxSelectionColumn:t,store:n}=this;if(!this._isCheckAllSelecting&&e.checkbox&&e.showCheckAll&&null!=t&&t.headerCheckbox){const e=n.count&&!n.some((e=>this.isSelectable(e)&&!this.isSelected(e)));t.headerCheckbox.checked!==e&&(t.suspendEvents(),t.headerCheckbox.checked=e,t.resumeEvents())}}onCheckAllChange({checked:e}){const t=this;t._isCheckboxSelecting=t._isCheckAllSelecting=!0,t[e?"selectAll":"deselectAll"](t.store.isPaged&&t.selectionMode.preserveSelectionOnPageChange),t._isCheckboxSelecting=t._isCheckAllSelecting=!1}get selectionDragMouseEventListenerElement(){return r}onSelectionDrag(e){const t=this,{_selectionStartCell:n}=t;if(An.isMouseDown()||t.onSelectionEnd(),!n)return;const{items:r,_lastSelectionDragRegion:i}=t,s=t.getCellDataFromEvent(e,!0),o=null==s?void 0:s.column.region,a=(null==s?void 0:s.cellSelector)&&t.normalizeCellContext(s.cellSelector);if(a&&!a.equals(t._lastSelectionDragCell,!0)){if(t._isSelectionDragging||t.enableScrollingCloseToEdges(r),t._clearSelectionOnSelectionDrag&&!n.equals(a,!0)&&(t.deselectAll(),delete t._clearSelectionOnSelectionDrag),i&&o!==i){var l;const e=t.subGrids[i],n=t.subGrids[o],s=e.scrollable,a=n.scrollable,c=r.indexOf(e)-r.indexOf(n)<0;if(a.x=c?0:a.maxX,c?s.x<s.maxX-1:s.x>1)return;const d=null===(l=t.scrollManager._activeScroll)||void 0===l?void 0:l.horizontal;d&&d.element!==a.element&&d.stopScroll(!0)}t._lastSelectionDragRegion=o,t._lastSelectionDragCell=a,t._isSelectionDragging=!0;const e=t._lastSelectionDragChange=t.internalSelectRange(n,a,t.isRowNumberSelecting(a)||t.isRowNumberSelecting(n));e.deselectedCells=e.deselectedCells.filter((e=>!t.isCellSelected(e))),e.deselectedRecords=e.deselectedRecords.filter((e=>!t.isSelected(e))),t.refreshGridSelectionUI(e),t.trigger("dragSelecting",e)}}onSelectionEnd(){var e,t;const n=this,r=n._lastSelectionDragChange;n._isSelectionDragging&&!n._selectionStartCell.equals(n._lastSelectionDragCell,!0)&&r&&n.performSelection(r,!1),n.disableScrollingCloseToEdges(n.items),n._isSelectionDragging=!1,n._lastSelectionDragChange=n._lastSelectionDragCell=n._lastSelectionDragRegion=null,null===(e=(t=n._selectionListenersDetachers).selectiondrag)||void 0===e||e.call(t),delete n._selectionListenersDetachers.selectiondrag}onHandleElementClick(e){const t=this;t.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,t.store.count&&t.store.some((e=>!t.isSelected(e)))?t.selectAll():t.deselectAll()):t.selectionMode.column&&e.target.closest(".b-grid-header")&&(e.handled=!0,t.selectColumn(e,e.ctrlKey)),super.onHandleElementClick(e)}selectColumn(e,t=!1){const n=this,{store:r}=n,{columnId:i}=n.getHeaderDataFromEvent(e);n._shiftSelectRange=null,e.shiftKey||(n._shiftSelectColumn=i);const s=e.shiftKey&&n._shiftSelectColumn||i,o=n.internalSelectRange(n.normalizeCellContext({id:r.first.id,columnId:s}),n.normalizeCellContext({id:r.last.id,columnId:i}));t&&!o.selectedCells.some((e=>!n.isCellSelected(e)))&&(o.deselectedCells=o.selectedCells,o.selectedCells=[]),t||(o.deselectedCells=n._selectedCells),n.cleanSelectionChange(o),n.performSelection(o)}isSelected(e){var t;return null!==(t=e)&&void 0!==t&&t.id&&(e=e.id),!!Pd[typeof e]&&this.selectedRows.some((t=>t.id===e))}isCellSelected(e,t){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some((t=>e.equals(t,!0)))||t&&this.isSelected(e)}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedRows(){return[...this._selectedRows]}set selectedRows(e){this.selectRows(e)}spliceSelectedRecords(e,t,n){const r=this;if("number"==typeof t){const i=[...r.selectedRecords];i.splice(e,t,...H.asArray(n)),r.performSelection(r.prepareSelection(null,i,!0,!0))}else r.performSelection(r.prepareSelection(t,n,!1,!0))}selectRow(e){"number"!=typeof e&&!e.isModel&&"record"in e||(e={records:[e]}),Xt.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}selectRows(e){(!e||Array.isArray(e)||e.isModel||"number"==typeof e||!("records"in e)&&!("record"in e))&&(e={records:H.asArray(e)||[]});const t=this,{store:n}=t,r=[],{records:i=(e.record?[e.record]:[]),column:s=t.columns.visibleColumns[0],scrollIntoView:o,addToSelection:a=arguments[1]}=e;for(let e of i)e=n.getById(e),e&&r.push(e);a||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(null,r,!a,!0)),r.length&&o&&t.scrollRowIntoView(r[0].id,{column:s})}selectAll(e=!1){const{store:t}=this,n=(t.isGrouped?t.allRecords:t.records).filter((e=>!e.isSpecialRow));this.performSelection(this.prepareSelection(null,n,!1,!0),!0,e)}deselectAll(e=!1,t=!1){const{store:n}=this,r=e?(n.isGrouped?n.allRecords:n.records).filter((e=>!e.isSpecialRow)):null;this.performSelection(this.prepareSelection(r,null,!e),!0,t)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const{store:t}=this,n=H.asArray(e).map((e=>t.getById(e))).filter((e=>e));this.performSelection(this.prepareSelection(n))}selectRange(e,t,n=!1){const r=this,{store:i}=r,s=r.internalSelectRange(i.getById(e),i.getById(t),!0);r._shiftSelectRange=null,r.performSelection(s)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(e){this.selectCells([e])}get selectedCells(){return[...this._selectedCells]}set selectedCells(e){this.selectCells(e)}get selectedCellCSSSelector(){const e=this.selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectCell(e){var t;return"id"in e&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),null===(t=this.selectCells(e))||void 0===t?void 0:t[0]}selectCells(e){Array.isArray(e)&&(e={cells:e});const t=this,{cells:n=(e.cell?[e.cell]:[]),scrollIntoView:r=!0,addToSelection:i=!1,silent:s=!1}=e,o=t.prepareSelection(null,n,!i);return i||(t._shiftSelectRange=null),t.performSelection(o,!0,s),r&&t.scrollRowIntoView(n[0].id,{column:n[0].columnId}),t.isCellSelectionMode?o.selectedCells:o.selectedRecords}deselectCell(e){var t;return null===(t=this.deselectCells([e]))||void 0===t?void 0:t[0]}deselectCells(e){const t=this.prepareSelection(e);return this.performSelection(t),this.isCellSelectionMode?t.deselectedCells:t.deselectedRecords}toggleSelection(e){const t=this,{_focusedCell:n,selectionMode:r}=t,i=t.isRowNumberSelecting(n),s=t.isCellSelected(n,!0);if(!0===r.selectOnKeyboardNavigation||n.isActionable)return!1;t.performSelection(t.prepareSelection(s?n:null,s?null:n,!r.multiSelect,i)),e.preventDefault()}selectCellRange(e,t){this.performSelection(this.internalSelectRange(e,t))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(e){var t,n;const{deselectedRecords:r,deselectedCells:i,selectedCells:s,deselectedCellRecords:o}=e,a=null===(t=e.selectedRecords)||void 0===t?void 0:t.map((e=>e.id)),l=null===(n=e.selectedCellRecords)||void 0===n?void 0:n.map((e=>e.id));return null!=r&&r.length&&null!=a&&a.length&&(e.deselectedRecords=r.filter((e=>!a.includes(e.id)))),null!=i&&i.length&&null!=s&&s.length&&(e.deselectedCells=i.filter((e=>!s.some((t=>e.equals(t,!0)))))),o.length&&(l.length||null!=a&&a.length)&&(e.deselectedCellRecords=o.filter((e=>!l.includes(e.id)&&!a.includes(e.id)))),e}getSelectedCellsForRecords(e){return this._selectedCells.filter((t=>t.id&&e.some((e=>e.id===t.id))))}delayUntilMouseUp(e){const t=Zn.on({element:r,blur:n=>e(n,t),mouseup:n=>e(n,t),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return!0===this.selectionMode.cell}isRowNumberSelecting(...e){return this.selectionMode.rowNumber&&!e.some((e=>"rownumber"!==e.column.type))}selectionShouldIncludeChildren(e){var t;const{includeChildren:n,multiSelect:r}=this.selectionMode;return("always"===n||!0===n&&this._isCheckboxSelecting)&&r&&!e.isLeaf&&(null===(t=e.allChildren)||void 0===t?void 0:t.length)}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}onCellNavigate(e,t,n,i){var s;const{selectionMode:o,_selectionListenersDetachers:a}=e,{multiSelect:l,deselectOnClick:c,dragSelect:d}=o,{ctrlKeyDown:u,shiftKeyDown:h}=An,g=An.isMouseDown(),m=An.isMouseDown(2),p=An.currentMouseDown||An.currentKeyDown;if(n=e.normalizeCellContext(n),e.selectionDisabled||!i||-1===n.rowIndex||null!==(s=n.record)&&void 0!==s&&s.isGroupHeader||null!=p&&p.fromKeyMap&&!o.selectOnKeyboardNavigation||e.columns.getById(n.columnId)===e.checkboxSelectionColumn||o.checkboxOnly||!0===(null==p?void 0:p.handled))return;h||(e._isAddingToSelection=u&&l,e._selectionStartCell=n),l&&d&&g&&!a.selectiondrag&&!e.preventDragSelect&&(a.selectiondrag=Zn.on({name:"selectiondrag",element:e.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:r},mousemove:"onSelectionDrag",thisObj:e})),e.preventDragSelect=!1;const f=e._selectionStartCell,v=e._isAddingToSelection;if((h&&g||e._isKeyboardRangeSelecting)&&f&&l)e.performSelection(e.internalSelectRange(f,n,e.isRowNumberSelecting(f,n)));else{var y;let t,r=!1,i=!0;if(e.isCellSelected(n,!0)){if(m)return;if(v||c)t=c?null:[n],i=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;r=c||l}t||v||(t=null,d&&r&&a.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));const s=(r,s)=>{var o;if(null==s||s(),(null==r||null===(o=r.target)||void 0===o?void 0:o.nodeType)===Node.ELEMENT_NODE){const e=new Kc(r.target);if(null!=e&&e.grid&&!e.equals(n,!0))return}h||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(t,i&&[n],null===t,i&&e.isRowNumberSelecting(n)))};if(null!==(y=e.features.rowReorder)&&void 0!==y&&y.isDragging)return;r?e.delayUntilMouseUp(s):s()}}prepareSelection(e,t,n=!1,r=!1){const i=this,s=i._isSelectionDragging,{includeParents:o,selectRecordOnCell:a}=i.selectionMode,l=[],c=n?i._selectedCells:[],d=[],u=n?i._selectedRows:[],h=H.keyBy(u,"id",(()=>1)),g=n?i.selectedRecords.filter((e=>!h[e.id])):[];let m=[];if(!n&&e)for(const t of H.asArray(e)){const e=i.normalizeCellContext(t),n=(null==e?void 0:e.record)||(t.isModel?t:i.store.getById(e.id));if(!e.isSpecialRow&&(c.push(e),n&&!h[n.id]&&(s||i.isSelected(n)?(u.push(n),h[n.id]=1):a&&i.selectedRecordCollection.get(n.id)&&!g.some((e=>e.id===n.id))&&g.push(n),i.selectionShouldIncludeChildren(n))))for(const e of n.allChildren)h[e.id]||!s&&!i.isSelected(e)||(u.push(e),h[n.id]=1)}if(t){const e={};for(const n of H.asArray(t)){const t=i.normalizeCellContext(n),s=(null==t?void 0:t.record)||(n.isModel?n:i.store.getById(t.id));if(s&&!t.isSpecialRow&&(i.isCellSelectionMode&&!r&&l.push(t),(i.isRowSelectionMode||r)&&!e[s.id]&&(d.push(s),e[s.id]=1,i.selectionShouldIncludeChildren(s))))for(const t of s.allChildren)e[t.id]||(d.push(t),e[t.id]=1)}a&&l.length&&(m=H.unique(l.map((e=>e.record))).filter((t=>!e[t.id])))}if(o&&(u.length||d.length)){const e=[...u,...d];H.unique(e.filter((t=>t.parent&&!t.allChildren.some((t=>e.includes(t))))).map((e=>e.parent))).forEach((e=>i.toggleParentSelection(e,d,u)))}return i.cleanSelectionChange({selectedCells:l,selectedRecords:d,deselectedCells:c,deselectedRecords:u,deselectAll:n,action:null!=d&&d.length||null!=l&&l.length?"select":"deselect",selectedCellRecords:m,deselectedCellRecords:g})}toggleParentSelection(e,t,n){if(!e||e.isRoot)return;const r=this.isSelected(e),i=t.includes(e),s=n.includes(e),o=e=>this.isSelected(e)&&!n.includes(e)||t.includes(e);"some"===this.selectionMode.includeParents?e.allChildren.some(o)?r&&!s||i||t.push(e):r&&!s&&n.push(e):r?s||i||!e.allChildren.some((e=>n.includes(e)))||n.push(e):i||e.allChildren.every(o)&&t.push(e),e.parent&&this.toggleParentSelection(e.parent,t,n)}internalSelectRange(e,t,n=!1){const r=this,i=r.isRowSelectionMode||n,s=r.prepareSelection(r._shiftSelectRange,r.getRange(e,t,i),!1,n);return r._shiftSelectRange=s["selected"+(i?"Records":"Cells")],s}getRange(e,t,n=!1){const r=this,{store:i}=r,s=r.normalizeCellContext(e),o=r.normalizeCellContext(t),a=Math.min(s.rowIndex,o.rowIndex),l=Math.max(s.rowIndex,o.rowIndex),c=[],d=Math.min(s.columnIndex,o.columnIndex),u=Math.max(s.columnIndex,o.columnIndex);if(-1===a||-1===l)throw new Error("Record not found in selectRange");if(n){const e=i.getRange(a,l+1,!1);o.rowIndex<s.rowIndex&&e.reverse(),c.push(...e)}else for(let e=a;e<=l;e++)for(let t=d;t<=u;t++)c.push({rowIndex:e,columnIndex:t});return c.map((e=>r.normalizeCellContext(e)))}performSelection(e,t=!0,n=!1){const r=this,{selectedRecords:i=[],selectedCells:s=[],selectedCellRecords:o=[],deselectedRecords:a=[],deselectedCells:l=[],deselectedCellRecords:c=[],action:d}=e,u=[...i,...o],h=[...a,...c],g=r.isRowSelectionMode;if(!1===r.trigger("beforeSelectionChange",{mode:g?"row":"cell",action:d,selected:u,deselected:h,selection:r.selectedRecords,selectedCells:s,deselectedCells:l,cellSelection:r.selectedCells}))return!1;if(r._selectedCells===l)r._selectedCells=[];else{const e=[];for(const t of r._selectedCells)l.some((e=>t.equals(e,!0)))||e.push(t);r._selectedCells=e}if(e.deselectedRecords=[...e.deselectedRecords],a===r._selectedRows)r.changeSelectedRecordCollectionSilent((e=>e.clear())),r._selectedRows.length=0;else{const e=[],t=[],n=H.keyBy(h,"id",(()=>1));for(const i of r.selectedRecords)n[i.id]||(r.isSelected(i)?e.push(i):t.push(i));r.changeSelectedRecordCollectionSilent((n=>n.values=[...e,...t])),r._selectedRows=e}if(s.length)for(const e of s)r._selectedCells.some((t=>t.equals(e,!0)))||r._selectedCells.push(e);i.length&&(r.changeSelectedRecordCollectionSilent((e=>e.add(...i))),r._selectedRows.push(...i.filter((e=>!r._selectedRows.some((t=>t.id===e.id)))))),o.length&&r.changeSelectedRecordCollectionSilent((e=>e.add(...o))),t&&r.refreshGridSelectionUI(e),r.afterSelectionChange(e),n||r.triggerSelectionChangeEvent(e)}refreshGridSelectionUI({selectedRecords:e,selectedCells:t,deselectedRecords:n,deselectedCells:r}){const i=this,{checkboxSelectionColumn:s}=i;null==s||s.suspendEvents(),i.updateGridSelectionRecords(e,!0),i.updateGridSelectionRecords(n,!1),i.updateCheckboxHeader(),null==s||s.resumeEvents(),i.isCellSelectionMode&&(i.updateGridSelectionCells(t,!0),i.selectionMode.column&&i.updateGridSelectionColumns(t)),i.updateGridSelectionCells(r,!1)}updateGridSelectionRecords(e,t){const{checkboxSelectionColumn:n}=this;if(null!=e&&e.length)for(let r=0;r<e.length;r++){const i=this.getRowFor(e[r]);i&&(i.toggleCls("b-selected",t),i.setAttribute("aria-selected",t),!n||n.hidden||e[r].isSpecialRow||(i.getCell(n.id).widget.checked=t))}}updateGridSelectionCells(e,t){if(null!=e&&e.length)for(let n=0;n<e.length;n++){const r=this.getCell(e[n]);r&&(r.setAttribute("aria-selected",t),r.classList.toggle("b-selected",t))}}updateGridSelectionColumns(e){const{count:t}=this.store;for(const r of this.columns.visibleColumns){var n;null===(n=r.element)||void 0===n||n.classList.toggle("b-selected",(null==e?void 0:e.filter((e=>e.columnId===r.id)).length)===t)}}triggerSelectionChangeEvent(e){const{selectedRecords:t=[],selectedCells:n=[],selectedCellRecords:r=[],deselectedRecords:i=[],deselectedCells:s=[],deselectedCellRecords:o=[]}=e,a=[...t,...r],l=[...i,...o],c=this.isRowSelectionMode;this.trigger("selectionChange",{mode:c?"row":"cell",action:e.action,selected:a,deselected:l,selection:this.selectedRecords,selectedCells:n,deselectedCells:s,cellSelection:this.selectedCells})}doDestroy(){var e;(null===(e=this.selectedRecordCollection)||void 0===e?void 0:e.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const e in this._selectionListenersDetachers)this._selectionListenersDetachers[e]();super.doDestroy()}get widgetClass(){}};class $d extends ba{static $name="Toast";static type="toast";static get configurable(){return{testConfig:{destroyTimeout:1,timeout:1e3},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:t,html:n,showProgress:r,style:i,timeout:s}=this;return{parent:e||this.floatRoot,class:{...Tn.normalize(t,"object"),"b-toast-hide":1},html:n,style:i,children:{progressElement:r&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:t}=this;return parseInt(t.style.bottom,10)+t.offsetHeight+e}async show(){await super.show(...arguments);const e=this,{element:t}=e,{toasts:n}=$d;var r;n.includes(e)||(t.style.bottom=((null===(r=n[0])||void 0===r?void 0:r.nextBottom)??e.bottomMargin)+"px",n.unshift(e),t.getBoundingClientRect(),t.classList.remove("b-toast-hide"),e.timeout>0&&(e.hideTimeout=e.setTimeout("hide",e.timeout)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=$d;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){$d.toasts.slice().reverse().forEach((e=>e.hide()))}static show(e){const t=$d.new({autoDestroy:!0,rootElement:document.body},"string"==typeof e?{html:e}:e);return t.show(),t}}$d.toasts=[],$d.initClass(),$d._$name="Toast";class _d{static getById(e){return ba.getById(e)}static fromElement(e,t,n){return ba.fromElement(e,t,n)}static createWidget(e={}){return e.isWidget?e:ba.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>ba.create(Xt.assign({},t||{},e))))}static openPopup(e,t){return ba.create(Xt.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:(t.forElement=document.body,Array.isArray(e)&&(e=new En(...e)),e instanceof En&&(t.align={position:e})),t.internalListeners={destroy:n.currentContextMenu=null},n.currentContextMenu=ba.create(t,"menu")}static attachTooltip(e,t){return ba.attachTooltip(e,t)}static hasTooltipAttached(e){return ba.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return ba.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),Go.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return $d.show(e)}}_d._$name="WidgetHelper";const jd=e=>e.columns.suspendEvents(),Bd=e=>e.columns.resumeEvents(),Vd=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},Hd=(e,t)=>e.stateSortIndex-t.stateSortIndex;var Nd=e=>class extends(e||ye){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","stateChange"]}}updateStore(e,t){var n;null===(n=super.updateStore)||void 0===n||n.call(this,e,t),this.detachListeners("stateStoreListeners"),null==e||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,t){var n;null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(e,t){var n;null===(n=super.updateRowManager)||void 0===n||n.call(this,e,t),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const e=this,t=e.element.style.cssText,n={rowHeight:e.rowHeight};if(t&&(n.style=t),e.selectedCell){const{id:t,columnId:r}=e.selectedCell;n.selectedCell={id:t,columnId:r}}return n.selectedRecords=e.selectedRecords.map((e=>e.id)),n.columns=e.columns.allRecords.map((e=>e.getState())),n.store=e.store.state,n.scroll=e.storeScroll(),n.subGrids={},e.eachSubGrid((e=>{const t=n.subGrids[e.region]=n.subGrids[e.region]||{};e.isPainted?null==e.flex&&(t.width=e.width):null!=e.config.width?t.width=e.config.width:t.flex=e.config.flex,t.collapsed=e.collapsed??!1,t.collapsed&&(t._beforeCollapseState=e._beforeCollapseState)})),n}applyState(e){const t=this;if(t.suspendRefresh(),"columns"in e){let n=!1,r=!1;t.columns.suspendEvents(),t.eachSubGrid(jd),e.columns.forEach(((e,i)=>{const s=t.columns.getById(e.id);if(s){const o=s.generation;"region"in e&&!(e.region in t.subGrids)&&(delete e.region,delete e.locked),s.applyState(e),n=n||s.generation!==o,s.stateSortIndex=i,s.allIndex!==i&&(r=n=!0)}})),n&&t.eachSubGrid(Vd),r&&(t.eachSubGrid((e=>{e.columns.records.sort(Hd),e.columns.allRecords.sort(Hd)})),t.columns.sort({fn:Hd,ascending:!0})),t.isPainted&&n&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(Bd)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const n=e.subGrids[t.region];"width"in n?t.width=n.width:"flex"in n&&(t.flex=n.flex),"collapsed"in n&&(t.collapsed=n.collapsed,t._beforeCollapseState=n._beforeCollapseState)}t.clearWidthCache()})),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),t.resumeRefresh(!0),t.whenVisible((()=>t.applyScrollState(e)))}applyScrollState(e){const t=this;t.eachSubGrid((e=>e.refreshFakeScroll())),"scroll"in e&&(t.restoreScroll(e.scroll),e.scroll.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((e=>{const t=_d.fromElement(e);t&&t.onElementResize(e)})))}get widgetClass(){}};const zd=Promise.resolve(),Wd={block:"nearest"};class Ud extends No{static configurable={propagate:!1,overflowX:"hidden-scroll",yScroller:null};updateYScroller(e){null==e||e.addScroller(this)}scrollIntoView(e,t=Wd){const{xDelta:n,yDelta:r}=this.getDeltaTo(e,t);let i=n||r?this.scrollBy(n,r,t):zd;if(t.highlight||t.focus){const s=i;i=i.then((()=>{var i;s.cancelled||(e=e instanceof wn?e:(null===(i=t.elementAfterScroll)||void 0===i?void 0:i.call(t))??e,t.highlight&&(e instanceof wn?e.translate(-n,-r).highlight():Br.highlight(e)),t.focus&&Br.focusWithoutScrolling(e))})),i.cancel=()=>{var e;return null===(e=s.cancel)||void 0===e?void 0:e.call(s)}}return i}scrollBy(e,t,n){const r=t&&this.yScroller.scrollBy(0,t,n),i=e&&super.scrollBy(e,0,n),s=Promise.all([i,r]);return s.cancel=()=>{var e,t;null==i||null===(e=i.cancel)||void 0===e||e.call(i),null==r||null===(t=r.cancel)||void 0===t||t.call(r),s.cancelled=!0},null!=i&&i.cancel&&null!=r&&r.cancel&&(n.force=!0),s}scrollTo(e,t,n){const r=null!=t&&this.yScroller.scrollTo(null,t,n),i=null!=e&&super.scrollTo(e,null,n);n&&n.animate||this.syncPartners();const s=Promise.all([i,r]);return s.cancel=()=>{var e,t;null==i||null===(e=i.cancel)||void 0===e||e.call(i),null==r||null===(t=r.cancel)||void 0===t||t.call(r),s.cancelled=!0},null!=i&&i.cancel&&null!=r&&r.cancel&&(n.force=!0),s}get viewport(){const e=wn.from(this.element);return e.intersect(wn.from(this.yScroller.element))||new wn(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}suspendEvents(){var e;super.suspendEvents(),null===(e=this.yScroller)||void 0===e||e.suspendEvents()}resumeEvents(){var e;super.resumeEvents(),null===(e=this.yScroller)||void 0===e||e.resumeEvents()}}Ud._$name="SubGridScroller";const Gd=(e,t)=>e+t.getBoundingClientRect().width;class Yd extends ba{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Ud,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}static delayable={hideOverlayScroller:1e3};construct(e){const t=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),o.isFirefox){const{element:e}=t,n=t.grid.scrollable;let r=0;e.addEventListener("wheel",(({ctrlKey:i,deltaY:s,deltaX:o})=>{const a=Math.abs(s)>Math.abs(o);i||!a||t.scrollEndDetacher||n.y===r||(e.style.pointerEvents="none",r=n.y,t.scrollEndDetacher=n.ion({scrollEnd:async()=>{r=n.y,e.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))}))}_.isTestEnv&&(t.hideOverlayScroller.delay=50)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach((e=>e.remove())),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:n}=e.element.style,r={subGrid:e,parent:e,maxWidth:e.maxWidth||i,minWidth:e.minWidth||i};return n?r.flex=n:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(Xt.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(Xt.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach((n=>null==n?void 0:n.classList[t?"add":"remove"](e)))}hideSplitter(){this.splitterElements.forEach((e=>e.classList.add("b-hide-display"))),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach((e=>e.classList.remove("b-hide-display"))),this.$showingSplitter=!0}changeElement(e,t){const{region:n}=this;return super.changeElement({"aria-label":n,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${n}`]:n,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:n}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map(((t,n)=>({role:"gridcell","aria-colindex":n+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}})))}}changeVirtualScrollerElement(){const e=Br.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=Br.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[o.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[o.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[o.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[o.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return Br.createElement(this.splitterConfig)}changeScrollerSplitter(){return Br.createElement(this.splitterConfig)}changeFooterSplitter(){return Br.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach((e=>Zn.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t}))),t._collapsed&&t.collapse())}toggleHeaders(e){const t=this;if(e)t.headerSplitter.remove(),t.header.element.remove(),t.scrollable.removePartner(t.header.scrollable,"x");else{const{grid:e}=t;if(!t.isConfiguring){const n=2*e.items.indexOf(t);Br.insertAt(e.headerContainer,t.headerSplitter,n),Br.insertAt(e.headerContainer,t.header.element,n),t.refreshHeader()}t.scrollable.addPartner(t.header.scrollable,"x")}}refreshHeader(){this.header.refreshContent()}refreshColumnHeader(e){this.header.refreshColumn(e)}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}eachWidget(e,t=!0){const n=[this.header,this.footer];for(let r=0;r<n.length;r++){const i=n[r];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let n=e.firstElementChild,r=0;for(;n;){const e=t[r],{element:i}=e;e.minWidth&&(n.style.minWidth=Br.setLength(e.minWidth)),e.maxWidth&&(n.style.maxWidth=Br.setLength(e.maxWidth)),e.flex?e.childLevel&&i?(n.style.flex=`0 0 ${i.getBoundingClientRect().width}px`,n.style.width=""):(n.style.flex=e.flex,n.style.width=""):e.width?n.style.width=Br.setLength(e.width):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}get headerScrollWidth(){return[...this.header.contentElement.children].reduce(Gd,0)||this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:n,footer:r}=e;if(!e.collapsed){if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i&&e.hasCalculatedWidth){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=`${i}px`,n.width=i,r&&(r.width=i)}e.handleHorizontalScroll(!1)}}fixRowWidthsInSafariEdge(){if(o.isSafari){const e=this,{region:t,header:n}=e,r=n.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const n=e.getElement(t);n&&(n.style.width=`${r}px`)})),n.headersElement.style.width=`${r}px`}}set width(e){const t=this;var n,r;(t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize(),t.isExpanding||t.isCollapsing||t.isConfiguring)||(null===(n=(r=t.grid).syncSplits)||void 0===n||n.call(r,(n=>n.subGrids[t.region]&&(n.subGrids[t.region].width=e))))}get width(){return super.width}set flex(e){const t=this;var n,r;(t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize(),t.isExpanding||t.isCollapsing||t.isConfiguring)||(null===(n=(r=t.grid).syncSplits)||void 0===n||n.call(r,(n=>n.subGrids[t.region]&&(n.subGrids[t.region].flex=e))))}get flex(){return super.flex}onInternalResize(e,t,n,r,i){const s=this,{grid:o}=s;super.onInternalResize(...arguments),null!=o&&o.isPainted&&(s.syncSplitterButtonPosition(),t!==r&&(s.trigger("beforeInternalResize",s),o.trigger("horizontalScroll",{grid:o,subGrid:s,scrollLeft:s.scrollable.scrollLeft,scrollX:s.scrollable.x}),o.trigger("horizontalScrollEnd",{subGrid:s}),s.fakeScroller&&s.refreshFakeScroll(),o.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),n!==i&&o.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:n}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=n.getSubGrid(n.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new wn(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach((t=>Br.toggleClasses(t,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&(this.hideHeaders?this.scrollable.hasOverflow("x"):this.header.scrollable.hasOverflow("x"))}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:n,virtualScrollerWidth:r,header:i,footer:s,scrollable:o}=e,a=[...i.contentElement.children].reduce(Gd,0);o.scrollWidth=a,t.style.setProperty("--total-column-width",`${e.headerScrollWidth}px`),n.style.width=t.style.width,n.style.flex=t.style.flex,n.style.minWidth=t.style.minWidth,n.style.maxWidth=t.style.maxWidth,i.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width=`${o.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:n,grid:r}=e;o.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),e.fakeScroller=new No({element:n,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),r.hideHorizontalScrollbar||(t.addPartner(e.fakeScroller,"x"),e.refreshFakeScroll()),r.hideHeaders||t.addPartner(e.header.scrollable,"x"),r.hideFooters||t.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(e){const t=this,{grid:n}=t;t.scrollingToCenter=null==e?void 0:e.scrollingToCenter,t.scrolling=!1,t.handleHorizontalScroll(!1),Br.scrollBarWidth||(n.virtualScrollers.classList.remove("b-scrolling"),t.hideOverlayScroller()),n.trigger("horizontalScrollEnd",{subGrid:t})}onSubGridScroll(e){this.scrollingToCenter=null==e?void 0:e.scrollingToCenter,this.handleHorizontalScroll()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}handleHorizontalScroll(e=!0){const t=this,{grid:n}=t;!t.scrolling&&e&&(t.scrolling=!0,Br.scrollBarWidth||(n.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),n.trigger("horizontalScroll",{subGrid:t,grid:n,scrollLeft:t.scrollable.scrollLeft,scrollX:t.scrollable.x,scrollingToCenter:null==t?void 0:t.scrollingToCenter})}scrollColumnIntoView(e,t){const{columns:n,header:r}=this,i=r.scrollable;if(e=e instanceof td?e:n.get(e)||n.getById(e)||n.getAt(e)){const n=r.getHeader(e.id);if(n)return i.scrollIntoView(wn.from(n,null,!0),t)}}onAddRow({source:e=this.grid.rowManager,rows:t,isExport:n}){var r;const i=this,{region:s}=i,o=i.rowElementConfig,a=document.createDocumentFragment(),l=null===(r=e.rows[t[t.length-1].index+1])||void 0===r?void 0:r.elements[s];t.forEach((e=>{const t=Br.createElement(o);Br.syncClassList(t,e.cls),a.appendChild(t),e.addElement(s,t),i.fixCellWidths(t)})),n||(i.fixRowWidthsInSafariEdge(),i.element.insertBefore(a,l||i.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=Br.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,n=t.grid,r=n.getSubGrid(n.getNextRegion(t.region)),i=n.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){var e;const t=this,{grid:n,element:r}=t,i=n.getSubGrid(n.getNextRegion(t.region)),s=t.splitterElement?t:t.previousSibling;let{_beforeCollapseState:o}=t,a=0;if(!n.rendered||!0!==t._collapsed){if(t.isCollapsing=!0,n.eachSubGrid((e=>{e!==t&&!e._collapsed&&++a})),null===(e=n.syncSplits)||void 0===e||e.call(n,(e=>{var n;return null===(n=e.subGrids[t.region])||void 0===n?void 0:n.collapse()})),0===a){if(!i)return;await i.expand()}return new Promise((e=>{if(o)e();else{o=t._beforeCollapseState={};let n=!1;t.width&&(n=!0,t.ion({afterinternalresize:()=>{e(t)},thisObj:t,once:!0})),o.width=t.width,o.elementWidth=r.style.width,""===i.element.style.flex&&(o.nextRegionWidth=i.width,i.width="",i.flex="1"),""!==r.style.flex&&(o.flex=r.style.flex,t.header.element.style.flex=r.style.flex=""),r.classList.add("b-grid-subgrid-collapsed"),t.virtualScrollerElement.classList.add("b-collapsed"),t.header.element.classList.add("b-collapsed"),t.footer.element.classList.add("b-collapsed"),t._collapsed=!0,t.width="",n||(t.syncParallelSplitters(!0),e(!1))}n.trigger("subGridCollapse",{subGrid:t}),n.afterToggleSubGrid({subGrid:t,collapsed:!0}),t.isCollapsing=!1})).then((e=>{var r;t.isDestroyed||!1!==e&&(n.refreshVirtualScrollbars(),t.syncParallelSplitters(!0),null===(r=s.startSplitterButtonSyncing)||void 0===r||r.call(s))}))}}async expand(){var e;const t=this,{grid:n,_beforeCollapseState:r}=t,i=n.getSubGrid(n.getNextRegion(t.region)),s=t.splitterElement?t:t.previousSibling;if(!n.rendered||!0===t._collapsed)return t.isExpanding=!0,null===(e=n.syncSplits)||void 0===e||e.call(n,(e=>{var n;return null===(n=e.subGrids[t.region])||void 0===n?void 0:n.expand()})),new Promise((e=>{if(null!=r){let n=!1;t.width!==r.elementWidth&&(n=!0,t.ion({afterinternalresize(){t.setTimeout((()=>e(t)),10)},thisObj:t,once:!0})),r.nextRegionWidth&&(i.width=r.nextRegionWidth,i.flex=null),t.element.classList.remove("b-grid-subgrid-collapsed"),t._collapsed=!1,t.virtualScrollerElement.classList.remove("b-collapsed"),t.header.element.classList.remove("b-collapsed"),t.footer.element.classList.remove("b-collapsed"),r.flex?(t.width=r.width,t.header.flex=t.flex=r.flex,t.footer.flex=r.flex,t._width=null):t.width=r.elementWidth,t.element.classList.remove("b-grid-subgrid-collapsed"),t._collapsed=!1,n?(s.stopSplitterButtonSyncing(),t.syncParallelSplitters(!1)):e(!1),delete t._beforeCollapseState}else e();n.trigger("subGridExpand",{subGrid:t}),n.afterToggleSubGrid({subGrid:t,collapsed:!1}),t.isExpanding=!1}))}hide(){var e,t;return null===(e=this.header)||void 0===e||e.hide(),null===(t=this.footer)||void 0===t||t.hide(),this.hideSplitter(),super.hide()}show(){var e,t;const n=this;return null===(e=n.header)||void 0===e||e.show(),null===(t=n.footer)||void 0===t||t.show(),n.region!==n.grid.regions[n.grid.regions.length-1]&&n.showSplitter(),super.show()}}Yd.initClass(),Yd._$name="SubGrid";var qd=e=>class extends(e||ye){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const t=this,n=new Set;for(const r of t.columns){const{region:t}=r;t&&(e[t]||(e[t]={}),n.add(t))}e.normal&&Xt.isEmpty(e.normal)&&(e.normal={flex:1});for(const r of n)t.createSubGrid(r,e[r]);return t.items=t.subGrids,e}createSubGrid(e,t=null){const n=this,r=n.columns.makeChained((t=>t.region===e),["region"]),i=Xt.assign({type:"subgrid",id:`${n.id}-${e}Subgrid`,parent:n,grid:n,region:e,headerClass:n.headerClass,footerClass:n.footerClass,columns:r,weight:e,scrollable:{yScroller:n.scrollable}},t||n.subGridConfigs[e]);let s=!1;i.flex||i.width||(i.width=r.totalFixedWidth,s=!0);const o=n.subGrids[e]=Yd.create(i);return o.element.style.setProperty("--total-column-width",r.totalFixedWidth),o.hasCalculatedWidth=s,e===n.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(e){if(e.isSubGrid){const t=this,{items:n,headerContainer:r,virtualScrollers:i,footerContainer:s}=t,o=2*n.indexOf(e);t.hideHeaders&&!t.columns.some((e=>e.flex))||(Br.insertAt(r,e.headerSplitter,o),Br.insertAt(r,e.header.element,o)),Br.insertAt(i,e.scrollerSplitter,o),Br.insertAt(i,e.virtualScrollerElement,o),Br.insertAt(s,e.footerSplitter,o),Br.insertAt(s,e.footer.element,o),n.forEach(((e,t)=>{t<n.length-1&&e.showSplitter()})),0===o&&t.emptyTextEl&&e.element.appendChild(t.emptyTextEl)}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],H.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((n,r)=>{n.isSubGrid&&e.call(t||n,n,r++)}))}callEachSubGrid(e,...t){let n=null;return this.items.forEach(((r,i)=>{if(r.isSubGrid&&r[e]){const s=r[e](...t);0===i&&(n=s)}})),n}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof td?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let n=e instanceof Yd?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}get widgetClass(){}},Kd=e=>class extends e{static $name="LoadMaskable";static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const e=this,{loadMask:t}=e;return t&&(e.masked=Go.mergeConfigs(e.loadMaskDefaults,t)),e.masked}applyMaskError(e){const{loadMaskError:t,masked:n}=this;return!1===t?n.hide():n&&(Xt.assign(n.errorDefaults,t),n.error=e),n}get widgetClass(){}};const Xd={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:new String},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:e=>{var t;return`${e.text?e.text:""} ${null!==(t=e.location)&&void 0!==t&&t.record?`rating : ${e.location.record.get(e.field)||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",printSettings:"Print settings",print:"Print",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}};qe.publishLocale(Xd);const Zd=new Promise((e=>e())),Jd="GridBase:store",Qd={block:"nearest",inline:"nearest"},eu={dataset:1,pageLoad:1,filter:1},tu=Object.freeze([]),nu=(e,t)=>e-t;class ru extends(rc.mixin(vi,Ri,yd,Rd,Id,Ad,Ld,Nd,qd,Kd)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store",rowHeight:null,preserveScroll:!1,animateTreeNodeToggle:_.checkVersion("core","6.0",">="),columnLines:!0,rowLines:!0}}static get defaultConfig(){return{fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:hd,footerClass:gd,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:dd,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}static bindStoreChangeset=!0;finishConfigure(e){const t=this,{initScroll:n}=t;t.initScroll=()=>!t.scrollInitialized&&n.call(t),_.isTestEnv&&(t.bufferedAfterColumnsResized.delay=50,t.bufferedElementResize.delay=50),super.finishConfigure(e),Xe.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),Xe.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),An.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",t.fixElementHeightsBuffer,t),t.setGridClassList(t.element.classList),t.verticalScroller.classList.remove("b-content-element","b-auto-container"),t.bodyWrapElement.classList.remove("b-auto-container-panel")}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?Jc.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners(Jd),null===(e=t.scrollManager)||void 0===e||e.destroy();for(const e of Object.values(t.features)){var n;null===(n=e.destroy)||void 0===n||n.call(e)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled||!1===t)return;let n;n=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:`b-${t instanceof ye?t.$$name:t.constructor.name}`,n&&e.add(n.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:n,fillLastColumn:r,positionMode:i,showDirty:s}=this;return{class:{[`b-grid-${i}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!n,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":s,"b-show-dirty-during-edit":null==s?void 0:s.duringEdit}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:n}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":n}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:o.isFirefox&&Br.scrollBarWidth?{height:`${Br.scrollBarWidth}px`}:i},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideHeaders(e){var t;e=Boolean(e),null===(t=this.headerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((t=>t.toggleHeaders(e)))}updateHideFooters(e){var t;e=Boolean(e),null===(t=this.footerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((t=>{t.scrollable[e?"removePartner":"addPartner"](t.footer.scrollable,"x")}))}updateHideHorizontalScrollbar(e){e=Boolean(e),this.eachSubGrid((t=>{t.virtualScrollerElement.classList.toggle("b-hide-display",e),t.scrollable[e?"removePartner":"addPartner"](t.fakeScroller,"x"),e||t.refreshFakeScroll()}))}changeColumns(e,t){const n=this;if(!e&&t)return n.isDestroying?t.owner===n&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===n&&t.destroy(),e.grid=n,e;if(Array.isArray(e)){if(t){const n=t.allRecords.slice();t.data=e;for(const e of n)t.includes(e)||e.destroy();return t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return id.new({grid:n,owner:n},e)}updateColumns(e,t){var n,r;const i=this;var s,a;null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),e.ion({refresh:i.onColumnsChanged,sort:i.onColumnsChanged,change:i.onColumnsChanged,move:i.onColumnsChanged,thisObj:i}),e.ion((s=i.onColumnsResized,a=i,{update:({store:e,record:t,changes:n})=>{let r=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(r=s.call(a,{store:e,record:t,changes:n})),r}})),o.isTouchDevice&&(i.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)}))),null===(r=i.bodyElement)||void 0===r||r.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:n,record:r,records:i,isMove:s}){const o=this,{columns:a,checkboxSelectionColumn:l}=o,c=n&&1===Object.keys(n).length;if(s=!0===s||s&&Object.values(s).some((e=>e)),s||"refresh"===e&&"batch"!==t&&"sort"!==t||"update"===t&&c&&"parentIndex"in n||"sort"===t&&a.isSyncingDataOnLoad)return;const d="add"===t&&i.some((e=>e.region&&!o.subGrids[e.region]));if(!o.isConfiguring&&(d||o.isPainted&&(!s||"remove"!==t))){if("add"===t)for(const e of i){const{region:t}=e;var u;if(!o.subGrids[t])o.add(o.createSubGrid(t,null===(u=o.subGridConfigs)||void 0===u?void 0:u[t]))}if("update"===t){if(("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&!("region"in n)){const{region:e}=r;return a.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&o.refreshColumn(t)})),void o.afterColumnsChange({action:t,changes:n,column:r})}if("text"in n&&c)return void r.subGrid.refreshHeader();if("hidden"in n){const e=o.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===t||"batch"===t||"update"===t&&"region"in n){const e=a.getDistinctValues("region",!0),{toRemove:t,toAdd:n}=H.delta(e,o.regions,!0);o.remove(t.map((e=>o.getSubGrid(e)))),o.add(n.map((e=>o.createSubGrid(e,o.subGridConfigs[e]))))}if(l&&!a.includes(l)){const e=a.indexOf(a.findRecord("type","rownumber"))+1;a.insert(e,l,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",a.visibleColumns.length),o.afterColumnsChange({action:t,changes:n,column:r,columns:i})}}onColumnsResized({changes:e,record:t}){const n=this;if(n.isConfiguring)return;const r=Br.setLength(t.width),i=Br.setLength(t.minWidth),s=Br.setLength(t.maxWidth),o=n.getSubGridFromColumn(t.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!t.flex||!t.childLevel){n.cellEls&&t===n.lastColumnResized||(n.cellEls=Br.children(n.element,`.b-grid-cell[data-column-id="${t.id}"]`),n.lastColumnResized=t);for(const o of n.cellEls)"width"in e&&(o.style.width=r),"minWidth"in e&&(o.style.minWidth=i),"maxWidth"in e&&(o.style.maxWidth=s),"flex"in e&&(o.style.flex=t.flex??null)}n.resizingColumns||n.afterColumnsResized(t),n.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||(t.fixWidths(),t.fixRowWidthsInSafariEdge())})),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query((e=>e.flex&&e.childLevel&&e.element));if(e)for(const t of e){const e=t.element.getBoundingClientRect().width,n=Br.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const t of n)t.style.flex=`0 0 ${e}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||t.refreshFakeScroll()}))}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,n,r,i){Br.scrollBarWidth&&t<r&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const n=this;if(n._isRowMeasured||n.measureRowHeight(),null==t||t.destroy(),e){const t=ad.new({grid:n,rowHeight:n.rowHeight,rowScrollMode:n.rowScrollMode||"move",autoHeight:n.autoHeight,fixedRowHeight:n.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:n}},e);return n.relayEvents(t,["beforeRenderRow","renderRow"]),n._rowManager=null,t}}updateRowHeight(e){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=e)}get rowHeight(){var e;return(null===(e=this._rowManager)||void 0===e?void 0:e.rowHeight)??this._rowHeight}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}getAsyncEventSuffixForStore(e){return this.asyncEventSuffix}bindStore(e){const t=this.getAsyncEventSuffixForStore(e);e.ion({name:Jd,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",startApplyChangeset:"internalOnStoreStartApplyChangeset",endApplyChangeset:"internalOnStoreEndApplyChangeset",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(Jd),this.destroyStore&&e.destroy()}changeStore(e){if(null==e)return null;var t;("string"==typeof e&&(e=ao.getStore(e)),e.isStore)||((e=Xt.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=sd),e=new(e.readUrl?ho:ao)(e));return e}updateStore(e,t){var n;const r=this;var i;(null===(n=super.updateStore)||void 0===n||n.call(this,e,t),t&&r.unbindStore(t),e&&(t&&r.deselectAll(),r.bindStore(e)),r.trigger("bindStore",{store:e,oldStore:t}),r.isDestroying||!r.isPainted||r.refreshSuspended)||(null===(i=r._rowManager)||void 0===i||i.reinitialize())}onStoreUpdateRecord({source:e,record:t,changes:n}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=r.getRowFor(t.meta.modified.id)),i=i||r.getRowFor(t),!i)return;if(r.fullRowRefresh||t.isSpecialRow){const n=e.indexOf(t);-1!==n&&i.render(n,t)}else r.columns.visibleColumns.forEach((e=>{const t=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||n[t]){const e=i.getCell(t);e&&i.renderCell(e)}}))}}refreshFromRowOnStoreAdd(e,t){const n=this,{rowManager:r}=n;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===n.store.count&&n.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:n,oldIndex:r,isChild:i,oldParent:s,parent:o,isMove:a,isExpand:l,isExpandAll:c}){const d=this,{rowManager:u}=d;if(!d.isPainted||c||d.refreshSuspended)return;if(l&&d.animateTreeNodeToggle)return u.insert(n,t.length);const h=a&&t.some((t=>{if(a[t.id]){const n=e.getById(t.meta.modified.parentId);return(null==n?void 0:n.isExpanded(e))&&(null==n?void 0:n.ancestorsExpanded(e))}}));if(i&&!t[0].ancestorsExpanded(e)&&!h){if(!o.isLeaf){const e=u.getRowById(o);e&&u.renderRows([e])}return}u.calculateRowCount(!1,!0,!0),e.isFiltered&&(n=e.indexOf(t[0]));const{topIndex:g,rows:m,rowCount:p}=u,f=u.topIndex+u.rowCount-1,v=n,y=n+t.length-1,b=f>=e.count-t.length-1;s||r>-1||i&&a&&Object.values(a).some((e=>e))?u.refresh():v>=g&&v<g+p?d.refreshFromRowOnStoreAdd(m[v-g],...arguments):y>=g&&y<g+p?u.refresh():(b&&n>f&&u.fillBelow(d._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:n,exceptionType:r,error:i}){var s;const o=this;let a;switch(t){case"server":a=n.message||o.L("L{unspecifiedFailure}");break;case"exception":a="network"===r?o.L("L{networkFailure}"):(null==i?void 0:i.message)||(null==n||null===(s=n.parsedJson)||void 0===s?void 0:s.message)||o.L("L{parseFailure}")}o.applyMaskError(`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${o.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                ${null!=n&&n.url?`<div class="b-grid-load-fail">${n.url}</div>`:""}\n                <div class="b-grid-load-fail">${o.L("L{serverResponse}")}</div>\n                <div class="b-grid-load-fail">${a}</div>\n            </div>`)}onStoreDataChange({action:e,changes:t,source:n,syncInfo:r}){var i;null===(i=super.onStoreDataChange)||void 0===i||i.call(this,...arguments);const s=this;if(s.refreshSuspended||!s.rowManager)return;if("dataset"===e&&(s.rowManager.clearKnownHeights(),n.isTree&&n.isFiltered))return;const o=n.isGrouped&&t&&n.groupers.some((e=>e.field in t));s.isPainted&&!o&&s.renderRows(Boolean(!(e in eu)||s.preserveScrollOnDatasetChange)),s.toggleEmptyText()}onStoreRecordIdChange(){var e;null===(e=super.onStoreRecordIdChange)||void 0===e||e.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){var t,n;const{store:r}=this;return(null===(t=this.features)||void 0===t||null===(n=t.group)||void 0===n?void 0:n.enabled)&&r.isGrouped||r.tree&&!e&&r.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:t,isCollapse:n,isChild:r,isMove:i,isCollapseAll:s}){var o;if(!this.isPainted||i||s)return;null===(o=super.onStoreRemove)||void 0===o||o.call(this,...arguments);const a=this,{rowManager:l}=a;if(l.invalidateKnownHeight(t),!a.refreshSuspended)if(!a.animateRemovingRows||n||r)if(n&&a.animateTreeNodeToggle){const e=t.flatMap((e=>{const t=l.getRowFor(e);return t?t.index:tu})).sort(nu),{length:n}=e;if(n&&e[n-1]===e[0]+n-1)return l.insert(e[0],-e.length)}else if(a.needsFullRefreshOnStoreRemove(...arguments))l.refresh(),a.afterRemove(arguments[0]);else{const{rows:e}=l,r=t.reduce(((t,n)=>{const r=l.getRowById(n.id);return r&&(t=Math.min(t,e.indexOf(r))),t}),e.length);e[r]?!a.refreshSuspended&&l.renderFromRow(e[r]):l.trigger("changeTotalHeight",{totalHeight:l.totalHeight}),a.trigger("rowRemove",{isCollapse:n}),a.afterRemove(arguments[0])}else{const e=t.reduce(((e,t)=>{const n=l.getRowById(t.id);return n&&e.push(n),e}),[]);if(e.length){const t=e[0];a.isAnimating=!0,Zn.onTransitionEnd({element:t._elementsArray[0],property:"left",duration:a.transitionDuration+50,thisObj:a,handler:()=>{a.isAnimating=!1,e.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),l.refresh(),a.trigger("rowRemove"),a.afterRemove(arguments[0])}}),e.forEach((e=>e.addCls("b-removing")))}}}onFlatStoreMove({from:e,to:t}){const{rowManager:n,store:r}=this,{topIndex:i,rowCount:s}=n,[o,a]=[e,t].sort(((e,t)=>e-t)),l=r.indexOf(r.getAt(o,!0)),c=r.indexOf(r.getAt(a,!0));l>=i&&l<i+s?n.renderFromRow(n.rows[l-i]):c>=i&&c<i+s&&n.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:n}=this;if(t)n.clearKnownHeights(),n.refresh();else{const t=e.reduce(((e,[,t])=>{const n=this.getRowFor(t);return n&&e.push(n),e}),[]);n.invalidateKnownHeight(e),n.renderRows(t)}}relayStoreDataChange(e){var t;if(null===(t=this.ariaElement)||void 0===t||t.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;null===(e=super.onStoreRemoveAll)||void 0===e||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const n=this.rowManager.getRowFor(e);n&&t.push(n)})),this.rowManager.renderRows(t)}}internalOnStoreStartApplyChangeset(){this.suspendRefresh(),this.constructor.bindStoreChangeset&&this.captureScrollTargetRow()}internalOnStoreEndApplyChangeset(){this.resumeRefresh(!0),this.constructor.bindStoreChangeset&&this.restoreScrollTargetRow()}captureScrollTargetRow(){const e=this;if(e.preserveScroll){const{firstFullyVisibleRow:t,lastVisibleRow:n}=e.rowManager;if(t){e.lastVisibleRowIds=[t.id];for(let r=t.dataIndex+1;r<=n.dataIndex;r++)e.lastVisibleRowIds.push(e.rowManager.getRow(r).id);e.lastTopRowOffset=e.scrollable.getDeltaTo(t.element,{block:"start",x:!1,constrainToScrollable:!1})}}}restoreScrollTargetRow(){const e=this;if(e.preserveScroll){if(e.lastVisibleRowIds){e.rowManager.refresh();const t=e.lastVisibleRowIds.find((t=>e.store.getById(t)));if(t!=i&&t!==e.rowManager.firstFullyVisibleRow.id){if(e.preserveScroll.overscroll){const n=e.scrollable.getDeltaTo(e.getRecordCoords(t),{block:"start",x:!1,constrainToScrollable:!1,edgeOffset:e.lastTopRowOffset.yDelta}).yDelta;n>e.scrollable.maxY&&(e.scrollable.scrollHeight+=n)}e.scrollRowIntoView(t,{block:"start",edgeOffset:e.lastTopRowOffset.yDelta,x:!1})}}e.lastVisibleRowIds=i,e.lastTopRowOffset=i}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const n=this,{subGrids:r,regions:i}=n,{parent:s}=e;let o=!0;Object.entries(r).forEach((([a,l])=>{if(!l.sealedColumns&&e.draggable&&a!==e.region&&(!s&&r[e.region].columns.count>1||s&&s.children.length>1)){const s=l.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=n.rtl?!s:s,d=i.length>2?n.L("L{moveColumnTo}",n.optionalL(a)):n.L(c?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${a}Region`]={targetSubGrid:a,text:d,icon:"b-fw-icon b-icon-column-move-"+(c?"right":"left"),separator:o,disabled:!e.allowDrag,onItem:({item:t})=>{e.traverse((e=>e.region=a)),n.columns.insert(n.columns.indexOf(r[t.targetSubGrid].columns.last)+1,e),n.scrollColumnIntoView(e)}},o=!1}}))}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:n}=t;return e.isLocation?e:e.isModel?new Kc({grid:t,id:e.id,columnId:n.visibleColumns[0].id}):new Kc(Xt.assign({grid:t},e))}getCell(e){const{store:t,columns:n}=this,{visibleColumns:r}=this.columns,i=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||n.getById(e.columnId)||n.get(e.field)||r[0]):e.columnIndex:e.column;return i>-1&&i<t.count&&s>-1&&s<r.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean(null===(e=this.features.treeGroup)||void 0===e?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const n=qc.get(t);return this.columns.getById(n.columnId)}updateAutoHeight(e){Xt.assertBoolean(e,"autoHeight")}updateColumnLines(e){Xt.assertBoolean(e,"columnLines"),Br.toggleClasses(this.element,"b-no-column-lines",!e)}updateRowLines(e){Br.toggleClasses(this.element,"b-no-row-lines",!e)}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:n}=e;t<n;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const n=this;if(n.renderingRows||!n.isVisible)return!1;const r=n.scrollable,i=Math.abs(n.virtualScrollHeight-e),s=n._bodyRectangle.height;if(i){const o=e-s-n._scrollTop<2*s||n._verticalScrollHeight&&n._verticalScrollHeight-s<n._scrollTop;r.scrollHeight=n.virtualScrollHeight=e,n.isPainted&&(n.scrolling&&!o||i<100)&&!t?n.bufferedFixElementHeights():(n.virtualScrollHeightDirty&&n.virtualScrollHeightDirty(),n.bufferedFixElementHeights.cancel(),n.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,n=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=n,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=wn.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...H.asArray(e||[]).map((e=>({element:("string"==typeof e?this.subGrids[e]:e).scrollable.element})))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...H.asArray(e||[]).map((e=>("string"==typeof e?this.subGrids[e]:e).element))])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),o.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:n}=e;n!==t._scrollTop&&(t._scrollTop=n,t.scrolling||(t.scrolling=!0,t.eachSubGrid((e=>e.suspendResizeMonitor=!0))),t.rowManager.updateRenderedRows(n),t.afterScroll({scrollTop:n}),t.trigger("scroll",{scrollTop:n}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid((e=>e.suspendResizeMonitor=!1))}async scrollRowIntoView(e,t=Qd){const n=this,r=t.block||"nearest",{rowManager:i}=n,s=n.store.getById(e);if(s){let e;if(-1===n.store.indexOf(s))return Zd;let a=n.scrollable,l=n.getRecordCoords(s);const c=wn.from(a.element);if(l.virtual){const d=l.block,u="nearest"!==r?t:{block:d};if(e=a.scrollIntoView(l,{block:"center"}),i.scrollTargetRecordId=s,i.updateRenderedRows(a.y,!0),l=n.getRecordCoords(s),i.lastScrollTop=a.y,l.virtual)return Zd;var o;if(t.animate)a.suspendEvents(),"end"===r||"nearest"===r&&"end"===d?a.y-=c.bottom-l.bottom:("start"===r||"nearest"===r&&"start"===d)&&(a.y+=l.y-c.y),i.updateRenderedRows(a.y,!1,!0),"end"===d?a.y-=i.appendRowBuffer*i.rowHeight-1:a.y+=i.prependRowBuffer*i.rowHeight-1,a.resumeEvents(),await a.scrollIntoView(n.getRecordCoords(s),Object.assign({},t,u));else t.recursive||await e,await(null===(o=n.scrollRowIntoView)||void 0===o?void 0:o.call(n,s,Object.assign({recursive:!0},t,u)))}else{let{column:e}=t;if(e){if(e.isModel||(e=n.columns.getById(e)||n.columns.get(e)),e){a=n.getSubGridFromColumn(e).scrollable;const t=wn.from(i.getRowFor(s).getCell(e.id));l.x=t.x,l.width=t.width}}else t=Xt.assign({},t,{x:!1});await a.scrollIntoView(l,t)}}}scrollColumnIntoView(e,t){return e=e instanceof td?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{const n=e.scrollLeft[t.region];var r;null!=n&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),null===(r=t.fakeScroller)||void 0===r||r.updateX(n))})),this.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=Br.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:o.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,n=Br.getRootElement("string"==typeof t?document.getElementById(t):t)||document.body;e.adopt&&n.contains(e.element)||(n.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),n=Br.getStyleValue(t,["height","border-top-width","border-bottom-width"]),i=parseInt(n.height),s=o.isFirefox?r.devicePixelRatio/Math.max(Math.trunc(r.devicePixelRatio),1):1,a=n["border-top-width"]?Math.round(s*parseFloat(n["border-top-width"])):0,l=n["border-bottom-width"]?Math.round(s*parseFloat(n["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=a+l,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:n}=this;t.classList.add("b-notransition"),e?n.returnToTop():n.refresh(!0),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach((t=>t.renderCell(t.getCell(e.id)))):e.children.forEach((e=>this.refreshColumn(e))))}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:n,virtualScrollers:r,scrollable:i,hasVerticalOverflow:s}=e,{classList:o}=r,a=!o.contains("b-hide-display"),l=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),c=l!==a;if(c&&r.classList.toggle("b-hide-display",!l),Br.scrollBarWidth){const o=s||"scroll"===i.overflowY;t.classList.toggle("b-show-yscroll-padding",o),n.classList.toggle("b-show-yscroll-padding",o),r.classList.toggle("b-show-yscroll-padding",o),c&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,n=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(n),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:n,footerContainer:r,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader"),e.callEachSubGrid("refreshFooter"),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.rowCount&&(i.setPosition(s),e.renderRows())}}refreshHeaders(){this.callEachSubGrid("refreshHeader")}refreshHeader(e){e.subGrid.refreshHeader()}onPaintOverride(){}onInternalPaint({firstPaint:e}){var t;const n=this;if(n.ariaElement.setAttribute("aria-rowcount",n.store.count+1),null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),n.onPaintOverride()||!e)return;const{rowManager:r,store:i,element:s,headerContainer:o,bodyContainer:a,footerContainer:l}=n,c=Br.scrollBarPadElement;let d,u=0;n.role=null!=i&&i.isTree?"treegrid":"grid",n.columns.ion({change:()=>d=!0,once:!0}),n.updateResponsive(n.width,0),d&&(n.callEachSubGrid("refreshHeader",o),n.callEachSubGrid("refreshFooter",l)),n.renderHeader(o,s),n.renderFooter(l,s),Br.append(o,c),Br.append(l,c),Br.append(n.virtualScrollers,c),n.refreshBodyRectangle();const h=n.bodyContainer.offsetHeight;if(n.autoHeight?(n._bodyHeight=r.initWithHeight(s.offsetHeight-o.offsetHeight-l.offsetHeight,!0),a.style.height=n.bodyHeight+"px"):(n._bodyHeight=h,r.initWithHeight(n._bodyHeight,!0)),n.eachSubGrid((e=>{e.header.maxDepth>u&&(u=e.header.maxDepth)})),o.dataset.maxDepth=u,n.fixSizes(),!i.count&&i.isLoading||n.renderRows(),n.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!n.isDestroyed&&n.refreshRows()))}n.initScroll(),n.initInternalEvents()}render(){const e=this;var t;(e.requireSize=Boolean(e.owner),super.render(...arguments),e.setupFocusListeners(),e.autoHeight)||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),e.splitFrom||null!==(t=e.features.split)&&void 0!==t&&t.owner||"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(r.getComputedStyle(e.element).minHeight)!==e.height||console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}onConfigChange(e){super.onConfigChange(e),this.isConfiguring||this.afterConfigChange(e)}afterConfigChange(e){}afterAddListener(e,t){}afterRemoveListener(e,t){}syncMaskCover(e=this.masked){if(e){const t="body"===e.cover&&this.rectangleOf("bodyContainer"),n=t&&this.rectangleOf("virtualScrollers"),{style:r}=e.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+((null==n?void 0:n.height)||0)}px`:""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=Go.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t,n;null===(t=this.emptyTextEl)||void 0===t||t.remove(),this.emptyTextEl=Br.createElement({parent:null===(n=this.firstItem)||void 0===n?void 0:n.element,className:"b-empty-text",[null!=e&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:t}=this;null==e||e.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const t of this.columns.bottomColumns){var n;null===(n=t.updateReadOnly)||void 0===n||n.call(t,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:n}=this,r=n.getInlineData(e),i=n.getCurrentConfig(e)||t.store;return r.length&&(t.data=r),i&&n.originalModelClass===sd&&delete i.modelClass,Xt.isEmpty(i)||(t.store=i),t.store&&delete t.store.data,t}}ru.initClass(),_.setVersion("grid","5.6.2"),ru._$name="GridBase";V.apply(class{static get target(){return{class:ru}}refreshBodyRectangle(){const{_bodyRectangle:e}=this,t=wn.client(this.bodyContainer);return 0===t.height&&e?this._bodyRectangle:this._bodyRectangle=t}get selectionDragMouseEventListenerElement(){return this.rootElement}});const iu={all:"all",visible:"visible"},su={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69,portraitWidth:8.3,portraitHeight:11.7,landscapeWidth:11.7,landscapeHeight:8.26},A3:{width:11.69,height:16.49,portraitWidth:11.7,portraitHeight:16.49,landscapeWidth:16.54,landscapeHeight:11.68},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}};function ou(){return o.isFirefox?{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.26}:o.isSafari?{portraitWidth:0,portraitHeight:.1,landscapeWidth:0,landscapeHeight:.5}:{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.25}}const au={portrait:"portrait",landscape:"landscape"},lu={pdf:"pdf",png:"png"},cu={pdf:"application/pdf",png:"image/png"};class du extends(mi(Ge(rt(ye)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}static inchToPx(e){return 96*e}pageTpl(e){const{title:t,header:n,footer:r,styles:i,htmlClasses:s,bodyClasses:a=[],paperHeight:l,paperWidth:c,html:d,currentPage:u,isPrint:h}=e;let{htmlStyle:g="",bodyStyle:m=""}=e;return a.push(`b-${this.constructor.type}`),Br.scrollBarWidth?a.push("b-visible-scrollbar"):a.push("b-overlay-scrollbar"),o.isChrome?a.push("b-chrome"):o.isSafari?a.push("b-safari"):o.isFirefox&&a.push("b-firefox"),g=h?g:`${g}; width: ${c}in; height: ${l}in;`,m=h?`${m}; width: ${c}in;`:`${m}; width: ${c}in; height: ${l}in;`,Cc.tpl`
            <!DOCTYPE html>
            <html class="${s} b-print-root" style="${g}">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${i.join("")}
                </head>
                <body class="b-export ${a.join(" ")}" style="${m}">
                    <div class="b-export-content b-page-${u}">
                        ${n&&`<div class="b-export-header" style="width: 100%">${n}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${r&&`<div class="b-export-footer" style="width: 100%">${r}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,n=r.origin,i=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),s=[];return i.forEach((r=>{if(r=r.cloneNode(!0),t&&r.href){let e;e=!0===t?r.href:this.keepPathName?r.href.replace(n,t):new URL(r.getAttribute("href"),t),r.setAttribute("href",e)}let i=r.outerHTML;if(t&&/style/i.test(r.tagName)){const n=e.getStyleTagURLConverter(t);i=i.replace(/url\(['"]?(.+?)['"]?\)/g,n)}s.push(i)})),e._stylesheets=e.filterStyles(s)}set stylesheets(e){this._stylesheets=e?this.filterStyles(e):e}getStyleTagURLConverter(e){return function(t,n){let i;try{let s;/^#/.test(n)?i=t:(s=!0===e?r.location.href:this.keepPathName?r.location.href.replace(r.location.origin,e):e,i=`url('${new URL(n,s).href}')`)}catch(e){i=t}return i}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const t=[],n=new Set;n.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:r})=>{n.add(r.ion({scroll(){t.push(r.await("scrollEnd"))}})),n.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}}))})),e.state=this.state,await Promise.all(t),n.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0)),Br.removeEachSelector(t,".b-grid-row,.b-grid-merged-cells-container");const r=t.querySelector(".b-gridbase > .b-mask");r&&r.remove()}createPlaceholder(e,t=!0,n={}){return t&&(e.innerHTML=""),Br.createElement(Object.assign({parent:e,id:vs.generateId("export")},n))}prepareElement({client:e}){const{tbar:t,bbar:n}=e;t&&this.element.querySelector(`#${t.id}`).remove(),n&&this.element.querySelector(`#${n.id}`).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=Br.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),n=t.offsetHeight-2;return t.remove(),n}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=Br.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),n=t.querySelectorAll("img");for(let e=0,t=n.length;e<t;e++)n[e].setAttribute("src",n[e].src);const r=t.innerHTML;return t.remove(),r}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=Br.scrollBarWidth)})),0===t?t:t+1}getPaperWidth(e,t){if("portraitWidth"in e){const n=t?"portraitWidth":"landscapeWidth";return e[n]-(this.exportMeta.isPrinting?ou()[n]:0)}return t?e.width:e.height}getPaperHeight(e,t){if("portraitHeight"in e){const n=t?"portraitHeight":"landscapeHeight";return e[n]-(this.exportMeta.isPrinting?ou()[n]:0)}return t?e.height:e.width}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,n=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==n?-1===r?e.store.count-n:r-n+1:e.store.count,i}async export(e){const t=this;let n;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{n=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise((e=>t.requestAnimationFrame(e))),await t.restoreState(e)}return n}async getPages(e){const t=this.pagesExtractor(e),n=[];let r;for(;(r=await t.next())&&!r.done;)n.push(r.value);return n}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:n}=e;this.oldRowManagerConfig={prependRowBuffer:n.prependRowBuffer,appendRowBuffer:n.appendRowBuffer};const r=Math.ceil(t/n.rowOffsetHeight);n.prependRowBuffer=r,n.appendRowBuffer=r,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:n,columns:r,rowsRange:i,keepRegionSizes:s,enableDirectRendering:o,useRenderedColumnWidth:a}=e,{rowManager:l}=n,c=t.exportMeta={enableDirectRendering:o,totalWidth:0,totalHeight:0-(o?0:t.getVirtualScrollerHeight(n)),subGrids:{},isPrinting:e.useBrowserPrint};n.columns.forEach((e=>{r.includes(e.id)?e.show():e.hide()})),await new Promise((e=>n.requestAnimationFrame(e))),l.rowCount>0&&(i===iu.all?c.firstVisibleDataIndex=l.rows[0].dataIndex:(c.firstVisibleDataIndex=l.firstVisibleRow.dataIndex,e.alignRows=!0),o||await n.scrollRowIntoView(n.store.getAt(c.firstVisibleDataIndex),{block:"start"}));const{element:d}=t;let u;t.cloneElement(n.element),t.prepareElement(e),o&&(c.fakeRow=u=l.rowClass.new({cls:n.rowCls,rowManager:l,grid:n,index:-10,dataIndex:-10})),n.eachSubGrid((e=>{var r,i,o;u&&(e.onAddRow({rows:[u],isExport:!0}),u.element.dataset.ownerCmp=n.id);const h=t.createPlaceholder(d.querySelector(`[id="${e.id}"]`),!1);let g;if(null!=s&&s[e.region])g=e.element.offsetWidth;else{const{visibleColumns:r}=e.columns;g=1!==r.length||r[0].isTimeAxisColumn||0!==t.state.columns.filter((t=>t.region===e.region&&!t.hidden&&t.id!==r[0].id)).length?e.columns.visibleColumns.reduce(((e,t)=>(a||"number"!=typeof t.width?e+=(n.hideHeaders?l.rows[0].getCell(t.id):t.element).offsetWidth:e+=t.width,e)),0):e.element.offsetWidth}c.totalWidth+=g;const m=(null===(r=e.splitterElement)||void 0===r?void 0:r.offsetWidth)||0;c.totalWidth+=m,c.subGrids[e.region]={id:e.id,headerId:(null===(i=e.header)||void 0===i?void 0:i.id)||null,footerId:(null===(o=e.footer)||void 0===o?void 0:o.id)||null,rows:[],splitterWidth:m,placeHolder:h,width:g}}))}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:n,headerId:r,footerId:i})=>{[n,r,i].forEach((n=>{if(n){const r=e.querySelector(`[id="${n}"]`);r&&(r.style.width=`${t}px`,r.style.flex="")}}))})),e.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise((e=>this.requestAnimationFrame(e)))}collectRow(e){const t=this.exportMeta.subGrids,n=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach((([r,i])=>{t[r].rows.push([i.outerHTML.replace(n,""),e.top,e.offsetHeight,new Map])}))}renderMergedCells(e,t,n,r){const{client:i}=e,{subGrids:s}=this.exportMeta,o=i.features.mergeCells.buildMergedCellsConfig(t,n,r);for(const e in s){const t=s[e],n=document.createElement("div");To.sync({targetElement:n,domConfig:{children:o[e].children}}),n.childNodes.length&&(n.childNodes.forEach((e=>{const{syncId:t}=e.dataset,n=i.features.mergeCells.mergedRanges.find((e=>{var n;return(null===(n=e.cellElement)||void 0===n?void 0:n.parentNode.dataset.syncId)===t}));n&&(e.innerHTML=n.cellElement.outerHTML)})),t.mergedCellsHtml=[n.innerHTML])}}}du.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},du._$name="Exporter";class uu extends du{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:t,enableDirectRendering:n}){const{exportMeta:r}=this;++r.currentPage,++r.verticalPosition,delete r.lastExportedRowBottom,r.verticalPosition>=r.verticalPages&&(Object.assign(r,{verticalPosition:0,horizontalPosition:r.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:t===iu.visible?e.rowManager.firstVisibleRow.dataIndex:0}),delete r.lastRowDataIndex,n||await this.scrollRowIntoView(e,r.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,enableDirectRendering:l}=e,c=su[e.paperFormat],d=e.orientation===au.portrait,u=t.getPaperWidth(c,d),h=t.getPaperHeight(c,d),g=t.inchToPx(u),m=t.inchToPx(h),p=a===iu.visible,f=Math.ceil(n.totalWidth/g);let v=m;i&&(v-=t.measureElement(i({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1}))),s&&(v-=t.measureElement(s({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1})));let y,b,C=r.store.count;if(p?(C=t.getVisibleRowsCount(r),y=n.totalHeight+r.headerHeight+r.footerHeight+r.bodyHeight):y=n.totalHeight+r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,o&&!p){const e=r.rowManager.rowOffsetHeight,t=Math.floor((v-r.headerHeight)/e),n=Math.floor(v/e),i=C-t;b=1+Math.ceil(i/n)}else b=Math.ceil(y/v);Object.assign(n,{paperWidth:u,paperHeight:h,pageWidth:g,pageHeight:m,horizontalPages:f,verticalPages:b,totalHeight:y,contentHeight:v,totalRows:C,totalPages:f*b,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:p?r.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,rowsRange:s}=e,{subGrids:o,currentPageTopMargin:a,verticalPosition:l,contentHeight:c,totalRows:d,lastRowDataIndex:u}=n,{rowManager:h}=r,{rows:g}=h,m=s===iu.visible,p=r.hasActiveFeature("mergeCells");let f,v;v=m&&null!=u?u===g[g.length-1].dataIndex?g.length-1:g.findIndex((e=>e.dataIndex===u)):m?g.findIndex((e=>e.bottom>Math.ceil(r.scrollable.y))):g.findIndex((e=>e.bottom+a+r.headerHeight>0));const y=v;f=c-(m||0===l?0:g[v].top+a+r.headerHeight),0===l&&(f-=r.headerHeight);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0,t.exportMeta.lastExportedRowBottom=g[v-1].bottom):(t.collectRow(e),f-=e.offsetHeight,b=e.dataIndex,(++v===g.length&&f>0||m&&v-y===d)&&(f=0))}if(p)for(const e in o){const t=o[e],n=r.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of n)t.mergedCellsHtml.push(e.outerHTML)}const S=g[v-1];if(S&&(n.exactGridHeight=S.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight,n.lastRowDataIndex=S.dataIndex+1),await t.onRowsCollected(g.slice(y,v),e),m)n.exactGridHeight-=n.scrollableTopMargin=r.scrollable.y;else{const e=h.ion({offsetRows:({offset:e})=>C+=e});await t.scrollRowIntoView(r,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,rowsRange:s}=e,{currentPageTopMargin:o,verticalPosition:a,contentHeight:l,totalRows:c,lastRowIndex:d,fakeRow:u}=n,{store:h}=r,g=r.hasActiveFeature("mergeCells"),m=s===iu.visible;let p,f=d,{lastTop:v}=n;const y=f,b=[];p=l-(m||0===a?0:v+o+r.headerHeight),0===a&&(p-=r.headerHeight);let C,S,D=0;for(;p>0;)u.render(f,h.getAt(f),!0,!1,!0),i&&p<u.offsetHeight?(D=-p,p=0,t.exportMeta.lastExportedRowBottom=v):(S=v,C=f,v=u.translate(v),p-=u.offsetHeight,t.collectRow(u),b.push({top:u.top,bottom:u.bottom,offsetHeight:u.offsetHeight,dataIndex:u.dataIndex}),(++f===h.count&&p>0||m&&f-y===c)&&(p=0));return g&&t.renderMergedCells(e,y,f,b),n.lastRowIndex=i?f:C,n.lastTop=i?v:S,u&&(n.exactGridHeight=u.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(b,e),D}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,enableDirectRendering:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d}=n;let u,h,g;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===iu.all&&(n.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r)),i&&(u=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c}))),g=o?await t.renderRows(e):await t.collectRows(e);return{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.reduce(((e,t)=>e+=t[0]),"");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}}uu.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,totalPages:s,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:c,contentHeight:d}=n,u=e.useBrowserPrint;let h;for(;(h=n.currentPage)<s;){t.trigger("exportStep",{text:t.L(uu.exportingPageText,{currentPage:h,totalPages:s}),progress:Math.round((h+1)/s*90)});const{html:g,header:m,footer:p,offset:f}=await t.buildPage(e),v=[...r,`\n                <style>\n                    .b-page-wrap {\n                        width: ${o}in;\n                        height: ${a}in;\n                    }\n                    .b-page-${h} #${e.client.id} {\n                        height: ${n.exactGridHeight}px !important;\n                        width: ${i}px !important;\n                    }\n                    .b-page-${h} .b-export-body .b-export-viewport {\n                        transform: translate(${-o*n.horizontalPosition}in, ${n.currentPageTopMargin}px);\n                    }\n                </style>\n            `];n.currentPageTopMargin-=d+f,await t.stateNextPage(e),yield{html:t.pageTpl({html:g,header:m,footer:p,styles:v,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:c,currentPage:h,isPrint:u})}}},uu._$name="MultiPageExporter";class hu extends du{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:n,processedRows:r,totalPages:i}=t;++t.currentPage,++t.verticalPosition,t.currentPage===i&&r.size!==n&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,repeatHeader:l,enableDirectRendering:c}=e,{pageWidth:d,pageHeight:u,totalWidth:h}=n,g=t.getScaleValue(d,h);let m,p=0-t.getVirtualScrollerHeight(r)+r.height-r.bodyElement.offsetHeight+r.scrollable.scrollHeight,f=u/g,v=r.store.count,y=0,b=p;if(i&&(f-=t.measureElement(i({totalWidth:h,totalPages:-1,currentPage:-1}))),s&&(f-=t.measureElement(s({totalWidth:h,totalPages:-1,currentPage:-1}))),l&&(f-=r.headerHeight+r.footerHeight,p-=r.headerHeight+r.footerHeight),a===iu.visible){const e=r.rowManager,i=e.firstVisibleRow,s=e.lastVisibleRow;c||(y=i.top),v=t.getVisibleRowsCount(r),c?(p=r.headerHeight+r.footerHeight+s.bottom-i.top,b=s.bottom-i.top):b=p=p-r.scrollable.scrollHeight+s.bottom-i.top,n.lastRowIndex=i.dataIndex,n.finishRowIndex=s.dataIndex}else n.finishRowIndex=r.store.count-1;if(o&&!l&&a!==iu.visible){const e=r.rowManager.rowOffsetHeight,t=Math.floor((f-r.headerHeight)/e),n=Math.floor(f/e),i=v-t;m=1+Math.ceil(i/n)}else m=Math.ceil(b/f);Object.assign(n,{scale:g,contentHeight:f,totalRows:v,totalHeight:p,verticalPages:m,initialScroll:y,horizontalPages:1,totalPages:m})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r}=e,i=su[e.paperFormat],s=e.orientation===au.portrait,o=t.getPaperWidth(i,s),a=t.getPaperHeight(i,s),l=t.inchToPx(o),c=t.inchToPx(a);Object.assign(n,{paperWidth:o,paperHeight:a,realPaperWidth:t.getPaperWidth(i,s),realPaperHeight:t.getPaperHeight(i,s),pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),t.estimateTotalPages(e),e.enableDirectRendering||t.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{subGrids:o,currentPageTopMargin:a,verticalPosition:l,totalRows:c,contentHeight:d}=n,u=s?0:r.headerHeight,{rowManager:h}=r,{rows:g}=h,m=e.rowsRange===iu.visible,p=r.hasActiveFeature("mergeCells");let f,v=m?g.findIndex((e=>e.bottom>r.scrollable.y)):g.findIndex((e=>e.bottom+a+u>0));const y=v;f=d-(0===l?0:g[v].top+a+u),0===l&&(f-=u);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0):(t.collectRow(e),f-=e.offsetHeight,f>0&&n.processedRows.add(e.dataIndex),b=e.dataIndex,(++v===g.length&&f>0||m&&v-y===c)&&(f=0))}if(p)for(const e in o){const t=o[e],n=r.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of n)t.mergedCellsHtml.push(e.outerHTML)}const S=g[v-1];if(S&&(n.exactGridHeight=S.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(g.slice(y,v),e),m)n.scrollableTopMargin=r.scrollable.y;else{const e=h.ion({offsetRows:({offset:e})=>C+=e});await t.scrollRowIntoView(r,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{currentPageTopMargin:o,verticalPosition:a,totalRows:l,contentHeight:c,lastRowIndex:d,finishRowIndex:u,fakeRow:h}=n,g=s?0:r.headerHeight,{store:m}=r,p=r.hasActiveFeature("mergeCells"),f=e.rowsRange===iu.visible;let v,y=d,{lastTop:b}=n;const C=y,S=[];v=c-(0===a?0:b+o+g),0===a&&(v-=g);let D,w,E=0;for(;v>0;)h.render(y,m.getAt(y),!0,!1,!0),i&&v<h.offsetHeight?(E=-v,v=0):(w=b,D=y,b=h.translate(b),v-=h.offsetHeight,t.collectRow(h),S.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),v>0&&n.processedRows.add(y),(y===u||++y-C===l&&f)&&(v=0));return p&&t.renderMergedCells(e,C,y,S),n.lastRowIndex=D,n.lastTop=w,h&&(n.exactGridHeight=h.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(S,e),E}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,enableDirectRendering:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d}=n;let u,h,g;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===iu.all&&(n.totalHeight=r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,o||(n.totalHeight-=t.getVirtualScrollerHeight(r))),i&&(u=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c}))),g=o?await t.renderRows(e):await t.collectRows(e);return{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.reduce(((e,t)=>e+=t[0]),"");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}}hu.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,paperWidth:s,paperHeight:o,realPaperWidth:a,realPaperHeight:l,contentHeight:c,scale:d,initialScroll:u}=n,h=e.useBrowserPrint;let g,m,{totalPages:p}=n;for(;(g=n.currentPage)<p;){t.trigger("exportStep",{text:t.L(hu.exportingPageText,{currentPage:g,totalPages:p}),progress:Math.round((g+1)/p*90)});const{html:f,header:v,footer:y,offset:b}=await t.buildPage(e);if(m=`\n            ${h?`\n                        .b-page-wrap {\n                            width: ${a}in;\n                            height: ${l}in;\n                        }\n                        .b-print:not(.b-firefox) .b-export-content {\n                            zoom: ${d};\n                            height: 100%;\n                        }\n                        .b-print.b-firefox .b-export-content {\n                            transform: scale(${d});\n                            transform-origin: top left;\n                            height: ${100/d}%;\n                            width: ${100/d}%;\n                        }\n                    `:`\n                        .b-export .b-page-${g}.b-export-content {\n                            transform: scale(${d});\n                            transform-origin: top left;\n                            height: ${100/d}%;\n                            width: ${100/d}%;\n                        }\n                    `}\n        `,e.repeatHeader){const t=n.exactGridHeight?`${n.exactGridHeight+n.currentPageTopMargin}px`:"100%";m=`\n                ${m}\n                .b-page-${g} #${e.client.id} {\n                    height: ${t} !important;\n                    width: ${i}px !important;\n                }\n                .b-export-body {\n                    height: 100%;\n                    display: flex;\n                }\n                .b-export-viewport {\n                    height: 100%;\n                }\n                .b-page-${g} .b-grid-vertical-scroller {\n                    margin-top: ${n.currentPageTopMargin-u}px;\n                }\n            `}else{const t=n.exactGridHeight||c-n.currentPageTopMargin;m=`\n                ${m}\n                .b-page-${g} #${e.client.id} {\n                    height: ${t}px !important;\n                    width: ${i}px !important;\n                }\n                .b-export-body {\n                    overflow: hidden;\n                }\n                .b-page-${g} .b-export-body .b-export-viewport {\n                    margin-top: ${n.currentPageTopMargin}px;\n                }\n                .b-page-${g} .b-grid-vertical-scroller {\n                    margin-top: -${u}px;\n                }\n            `}const C=[...r,`<style>${m}</style>`];n.currentPageTopMargin-=c+b,await t.stateNextPage(e),({totalPages:p}=n),yield{html:t.pageTpl({html:f,header:v,footer:y,styles:C,paperWidth:s,paperHeight:o,realPaperWidth:a,realPaperHeight:l,currentPage:g,isPrint:h})}}},hu._$name="MultiPageVerticalExporter";class gu extends du{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,t){if(t.enableDirectRendering)return e.map((e=>e[0]));{let t=0;return e.map((([e,,n])=>{const r=e.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=n,r}))}}async collectRows(e){const t=this,{client:n}=e,{rowManager:r,store:i}=n,s=n.hasActiveFeature("mergeCells"),{subGrids:o}=t.exportMeta,a=e.rowsRange===iu.visible&&i.count?t.getVisibleRowsCount(n):i.count;let{totalHeight:l}=t.exportMeta,c=0,d=-1;if(r.rows.length>0){if(e.rowsRange===iu.visible&&(d=r.firstVisibleRow.dataIndex-1),s)for(const e of Object.values(o))e.mergedCellsHtml=[];for(;c<a;){const i=r.rows,u=i[i.length-1],h=c;if(i.forEach((e=>{e.dataIndex>d&&c<a&&(++c,l+=e.offsetHeight,t.collectRow(e))})),s)for(const e in o){const t=o[e],r=n.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");for(const e of r)t.mergedCellsHtml.push(e.outerHTML)}const g=i.findIndex((e=>e.dataIndex===d+1)),m=g+(c-h);await t.onRowsCollected(i.slice(g,m),e),c<a&&(d=u.dataIndex,await t.scrollRowIntoView(n,d+1))}}return l}async renderRows(e){const t=this,{client:n,rowsRange:r}=e,{rowManager:i,store:s}=n,o=n.hasActiveFeature("mergeCells"),a=r===iu.visible;let{totalHeight:l}=t.exportMeta;if(s.count){const{fakeRow:n}=t.exportMeta,{firstVisibleRow:r}=i,c=a?r.dataIndex:0,d=a?i.lastVisibleRow.dataIndex:s.count-1,u=[];let h=0;if(n.cells.length){for(let e=c;e<=d;e++)n.render(e,s.getAt(e),!0,!1,!0),h=n.translate(h),t.collectRow(n),u.push({top:n.top,bottom:n.bottom,offsetHeight:n.offsetHeight,dataIndex:n.dataIndex});await t.onRowsCollected(u,e)}l+=h,o&&t.renderMergedCells(e,c,d,u)}return l}buildPageHtml(e){const t=this,{subGrids:n}=t.exportMeta;let r=t.prepareExportElement();return Object.values(n).forEach((({placeHolder:n,rows:i,mergedCellsHtml:s})=>{const o=n.outerHTML;let a=t.positionRows(i,e).join("");null!=s&&s.length&&(a+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),r=r.replace(o,a)})),r}}gu.prototype.pagesExtractor=async function*(e){const t=this,{client:n}=e,{totalWidth:r}=t.exportMeta,i=t.stylesheets,s=e.orientation===au.portrait,o=su[e.paperFormat],a=e.useBrowserPrint,l=t.getPaperWidth(o,s),c=t.getPaperHeight(o,s),d=t.getPaperWidth(o,s),u=t.getPaperHeight(o,s);let h,g,m;e.enableDirectRendering?(h=await t.renderRows(e),h+=n.headerHeight+n.footerHeight):(h=await t.collectRows(e),h+=n.height-n.bodyHeight);const p=t.buildPageHtml(e),f=h;if(e.headerTpl){g=t.prepareHTML(e.headerTpl({totalWidth:r}));h+=t.measureElement(g)}if(e.footerTpl){m=t.prepareHTML(e.footerTpl({totalWidth:r}));h+=t.measureElement(m)}const v=Math.min(1,t.getScaleValue(t.inchToPx(l),r)),y=Math.min(1,t.getScaleValue(t.inchToPx(c),h)),b=Math.min(v,y);i.push(`<style>\n                #${n.id} {\n                    height: ${f}px !important;\n                    width: ${r}px !important;\n                }\n                ${a?`\n                            html, body {\n                                overflow: hidden;\n                            }\n                            .b-page-wrap {\n                                width: ${d}in;\n                                height: ${u}in;\n                            }\n                            .b-print:not(.b-firefox) .b-export-content {\n                                zoom: ${b};\n                                height: 100%;\n                            }\n                            .b-print.b-firefox .b-export-content {\n                                transform: scale(${b}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                                transform-origin: top left;\n                                height: ${1===b?"inherit":"auto !important"};\n                            }\n                            .b-export-content {\n                                ${t.centerContentHorizontally?"left: 50%;":""}\n                            }\n                        `:`\n                            .b-export-content {\n                                ${t.centerContentHorizontally?"left: 50%;":""}\n                                transform: scale(${b}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                                transform-origin: top left;\n                                height: ${1===b?"inherit":"auto !important"};\n                            }\n                        `}\n            </style>`),yield{html:t.pageTpl({html:p,header:g,footer:m,styles:i,paperWidth:l,paperHeight:c,realPaperHeight:u,realPaperWidth:d,currentPage:0,isPrint:e.useBrowserPrint})}},gu._$name="SinglePageExporter";class mu extends Mc{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:iu.all,text:this.L("L{all}")},{id:iu.visible,text:this.L("L{visible}")}]}}mu.initClass(),mu._$name="ExportRowsCombo";class pu extends Mc{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:au.portrait,text:this.L("L{portrait}")},{id:au.landscape,text:this.L("L{landscape}")}]}}pu.initClass(),pu._$name="ExportOrientationCombo";const fu=e=>!e.value;class vu extends pc{static $name="Checkbox";static type="checkbox";static alias="check";static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=Xt.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=!0===t?fu:t,e.collapsed=t(this))}assignFieldValue(e,t,n){this.value=n===this.checkedValue||n!==this.uncheckedValue&&null}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const n=this,r=n.value?n.checkedValue:n.uncheckedValue,s=r!==i,{valueName:o}=n;s&&(e[o]=r),n.gatherValues(e,s),!0===r&&(null===(t=e[o])||void 0===t?void 0:t.value)===r&&delete e[o].value}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){var t;const n=this,r=n.input.checked!==e;n.input.checked=e,null===(t=n.container)||void 0===t||t.syncChildConfigs(),!r||n.inputting||n.isConfiguring||(n.uncheckToggleGroupMembers(),n.triggerChange(!1,null))}get inputValueAttr(){return"checked"}updateColor(e,t){const n=this.element.classList;t&&n.remove(t),e&&n.add(e)}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:n,input:r,type:i}=e,s=[];return t&&n&&Br.forEachSelector(e.rootElement,`input[type=${i}][data-group=${n}]`,(e=>{if(e!==r){const t=ba.fromElement(e);t&&s.push(t)}})),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0,e),t.inputting=!1))}updateInputReadOnly(e){}triggerChange(e,t){const n=this,{checked:r}=n.input,i={checked:r,value:r,oldValue:!r,userAction:e,valid:!0,event:t};if(!(!r&&e&&n.toggleGroup&&n.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===n.trigger("beforeChange",i)))return n.triggerFieldChange(i,!1),e&&n.uncheckToggleGroupMembers(),n.trigger("action",i),n.trigger("change",i),!0;n.input.checked=n._value=!r}}function yu(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}vu.initClass(),vu._$name="Checkbox";class bu extends ic{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,useBrowserPrint:!1,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",name:"columns",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",name:"rowsRange",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",name:"exporterType",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map((t=>({id:t.type,text:e.optionalL(t.title,this)})))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",name:"alignRows",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",name:"repeatHeader",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",name:"fileFormat",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:t}){const n=this.parent;if(n.hidePNGMultipageOption){const r=n.widgetMap.exporterTypeField,i=r.store.find((e=>"singlepage"===e.id));e===lu.png&&i?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):t===lu.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",name:"paperFormat",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",name:"orientation",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const t=this,{client:n}=e;if(!n)throw new Error("`client` config is required");t.columnsStore=n.columns.chain((e=>e.isLeaf&&e.exportable),null,{excludeCollapsedRecords:!1}),t.applyInitialValues(e),super.construct(e),Xe.ion({locale:"onLocaleChange",prio:-1,thisObj:t})}updateUseBrowserPrint(e){const t=this;t.whenVisible((()=>{e?(t.widgetMap.exportButton.text=t.L("L{ExportDialog.print}"),t.widgetMap.fileFormatField.hidden=!0,t.title=t.L("L{printSettings}")):(t.widgetMap.exportButton.text=t.L("L{ExportDialog.export}"),t.widgetMap.fileFormatField.hidden=Boolean(t.widgetMap.fileFormatField.initialConfig.hidden),t.title=t.L("L{exportSettings}"))}))}applyInitialValues(e){const t=this,n=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),n.columnsField=n.columnsField||{},n.fileFormatField=n.fileFormatField||{},n.paperFormatField=n.paperFormatField||{},n.fileFormatField.items=yu(lu,(e=>e.toUpperCase())),n.paperFormatField.items=yu(su),n.columnsField.store=t.columnsStore}onBeforeShow(){var e;const{columnsField:t,alignRowsField:n,exporterTypeField:r,repeatHeaderField:i}=this.widgetMap;this.autoSelectVisibleColumns&&(t.value=this.columnsStore.query((e=>!e.hidden))),n.hidden="singlepage"===r.value,i.hidden="multipagevertical"!==r.value,null===(e=super.onBeforeShow)||void 0===e||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof pc&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}}bu.initClass(),bu._$name="ExportDialog";class Cu extends fi{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:bu,exportServer:i,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[gu,uu,hu],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0,useRenderedColumnWidth:!1,useBrowserPrint:!1}}updateEnableDirectRendering(e){e||_.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;null===(e=this.exportDialog)||void 0===e||e.destroy(),this.exportersMap.forEach((e=>e.destroy())),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:n}=t,{type:r}=e;let i;if(n.has(r))i=n.get(r),Object.assign(i,e);else{const s=this.exporters.find((e=>e.type===r));if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);delete(e=Xt.clone(e)).type,i=new s(e),i.relayAll(t),n.set(r,i)}return i}buildExportConfig(e={}){const{client:t,exportServer:n,clientURL:r,fileFormat:i,fileName:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,filterStyles:v,enableDirectRendering:y,useRenderedColumnWidth:b,useBrowserPrint:C}=this;e.columns||(e.columns=t.columns.visibleColumns.filter((e=>e.exportable)).map((e=>e.id)));const S=Xt.assign({client:t,exportServer:n,clientURL:r,fileFormat:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,enableDirectRendering:y,useRenderedColumnWidth:b,useBrowserPrint:C,exporterType:this.exporterType,fileName:s||t.$$name},e);return S.columns=e.columns.slice(),"multipagevertical"!==S.exporterType&&(S.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(S.alignRows=!0),S.exporterConfig=Xt.assign({type:S.exporterType,translateURLsToAbsolute:S.translateURLsToAbsolute,keepPathName:S.keepPathName,filterStyles:v},S.exporterConfig||{}),delete S.exporterType,delete S.translateURLsToAbsolute,delete S.keepPathName,S}async export(e={}){const t=this,{client:n,pagesPerRequest:r}=t;let i;if(e=t.buildExportConfig(e),!1!==n.trigger("beforePdfExport",{config:e})){n.isExporting=!0,n.mask(t.exportMask);try{const o=t.getExporter(e.exporterConfig);if(0===r){var s;const r=await o.export(e);if(t.isDestroying)return;if(null===(s=t.exportDialog)||void 0===s||s.close(),n.unmask(),t.trigger("exportStep",{progress:90,text:t.exportProgressMask,contentGenerated:!0}),e.useBrowserPrint)await t.doPrint(r,e),i={};else{const n=t.receiveExportContent(r,e);t.toast=t.showLoadingToast(n);const s=await n;i={response:s},await t.processExportContent(s,e)}}}catch(e){throw i=e instanceof Response?{response:e}:{error:e},e}finally{var o;if(t.toast&&!t.toast.isDestroying&&t.toast.hide(),!t.isDestroying)null===(o=t.exportDialog)||void 0===o||o.close(),n.unmask(),t.showErrorToast&&(i.error?"AbortError"!==i.error.name&&$d.show({html:t.L("L{Export failed}"),rootElement:t.rootElement}):i.response&&!i.response.ok&&$d.show({html:t.L("L{Server error}"),rootElement:t.rootElement})),n.trigger("pdfExport",i),n.isExporting=!1}}return i}receiveExportContent(e,t){return Se.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}async processExportContent(e,t){const n=this;if(e.ok&&n.openAfterExport){const r=(e=e.clone()).headers.get("content-type");if(r.match(/application\/octet-stream/)){const r=cu[t.fileFormat],i=await n.responseBlobToObjectURL(e,r);n.getDownloadLink(t.fileName,i).click()}else if(r.match(/application\/json/)){const r=await e.json();if(r.success){n.getDownloadLink(t.fileName,r.url).click()}else $d.show({html:r.msg,rootElement:this.rootElement})}}}doPrint(e){}async responseBlobToObjectURL(e,t){const n=await e.blob();return URL.createObjectURL(n.slice(0,n.size,t))}getDownloadLink(e,t){const n=document.createElement("a");return n.download=e,n.href=t,this.openInNewTab&&(n.target="_blank"),n}get defaultExportDialogConfig(){return Xt.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader","useBrowserPrint"])}changeExportDialog(e,t){const n=this;if(null==t||t.destroy(),e){const t=n.dialogClass.mergeConfigs({rootElement:n.rootElement,client:n.client,modal:{transparent:!0},items:{rowsRangeField:{value:n.rowsRange},exporterTypeField:{value:n.exporterType},orientationField:{value:n.orientation},paperFormatField:{value:n.paperFormat},repeatHeaderField:{value:n.repeatHeader},fileFormatField:{value:n.fileFormat},alignRowsField:{checked:n.alignRows}}},n.defaultExportDialogConfig,e);(e=n.dialogClass.new(t)).ion({export:n.onExportButtonClick,thisObj:n})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const t=this,n=t.exportDialog.mask({progress:0,maxProgress:100,text:t.exportMask}),r=t.ion({exportstep({progress:e,text:i,contentGenerated:s}){s?(t.exportDialog.unmask(),r()):(n.progress=e,null!=i&&(n.text=i))}});t.currentExportPromise=t.export(e),t.currentExportPromise.catch((()=>{})).finally((()=>{var e;r(),null===(e=t.exportDialog)||void 0===e||e.unmask(),t.currentExportPromise=null}))}showLoadingToast(e){const t=$d.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`\n    <span class="b-mask-icon b-icon b-icon-spinner"></span>\n    <span>${this.exportProgressMask}</span>\n    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return Zn.on({element:t.element,click(){var t;null===(t=e.abort)||void 0===t||t.call(e)}}),t}}Cu._$name="PdfExport",Ed.registerFeature(Cu,!1,"Grid"),V.apply(class{static target={class:Cu};onPrintIFrameLoad(e){const t=e.contentDocument;Array.from(document.querySelectorAll('link[href*="/resource/"]')).forEach((e=>{const n=t.importNode(e);n.setAttribute("href",e.href),t.head.appendChild(n)}))}});class Su extends td{static type="action";static fields=[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}];static defaults={filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30};get groupHeaderReserved(){return!0}construct(e,t){const n=this;super.construct(...arguments),e.width||e.flex||n.grid.ion({paint:"updateAutoWidth",thisObj:n}),n.disableIfGridReadOnly&&n.grid.element.classList.add("b-actioncolumn-readonly"),n.renderer!==n.internalRenderer&&(n.externalRenderer=n.renderer,n.renderer=n.internalRenderer)}internalRenderer({grid:e,column:t,record:n,callExternalRenderer:r=!0}){var i;const s=n&&"groupRowFor"in n.meta,{subGrid:o}=t;var a;r&&(null===(a=this.externalRenderer)||void 0===a||a.call(this,...arguments));return{className:{"b-action-ct":1},children:null===(i=t.actions)||void 0===i?void 0:i.map(((e,r)=>{var i;if("visible"in e){if("function"==typeof e.visible&&!1===e.visible({record:n}))return"";if(!1===e.visible)return""}if(s&&!e.showForGroup||!s&&e.showForGroup)return"";const{tooltip:a,renderer:l}=e,c="function"==typeof a||null!=a&&null!==(i=a.startsWith)&&void 0!==i&&i.call(a,"up.")?o.callback(a,o,[{record:n}]):a||"";if(l){const i=o.callback(l,o,[{index:r,record:n,column:t,tooltip:c,action:e}]);return"string"==typeof i?{tag:"span",dataset:{...lc.encodeConfig(c),index:r},html:i}:(i.dataset=i.dataset||{},i.dataset.index=r,i)}return{tag:"button",dataset:{...lc.encodeConfig(c),index:r},"aria-label":c,className:{"b-tool":1,"b-action-item":1,[e.cls]:e.cls}}}))}}onCellClick({column:e,record:t,target:n}){var r;if(e!==this||!n.classList.contains("b-action-item"))return;let i=n.dataset.index;i||(i=n.parentElement.dataset&&n.parentElement.dataset.index);const s=null===(r=e.actions)||void 0===r?void 0:r[i],o=null==s?void 0:s.onClick;o&&this.callback(o,e,[{record:t,action:s,target:n}])}updateAutoWidth(){const e=this,t=[],{actions:n}=e;if(!e.element)return;const r=e.actions=[];null==n||n.forEach((e=>{const n={...e};delete n.visible,n.showForGroup?(delete n.showForGroup,t.push(n)):r.push(n)})),t.length>r.length&&(e._actions=t);const i=Br.createElement(e.internalRenderer({column:e,callExternalRenderer:!1})).outerHTML;e.width=Br.measureText(i,e.element,!0,e.element.parentElement),e.actions=n}}id.registerColumnType(Su),Su.exposeProperties(),Su._$name="ActionColumn";const Du={onTab:1,onShiftTab:1},wu={remove:1,filter:1,dataset:1,replace:1};class Eu extends(fi.mixin(mi)){static $name="RowExpander";static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",shadowRootContainerClass:"b-rowexpander-shadowroot-container",recordStateMap:new Map,collapsingStateMap:new Map}}static configurable={renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0,widget:null,dataField:null,keyMap:{Tab:{handler:"onTab",weight:50},"Shift+Tab":{handler:"onShiftTab",weight:50}},autoScroll:!1,spanRegions:!1};static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore","navigateUp"],override:["onGridBodyFocusIn","navigateDown","catchFocus","keyMapOnKeyDown"]}}afterConstruct(){const e=this,{client:t}=e;if(!e.renderer&&!e.widget)return e.disabled=!0,void console.warn("RowExpander requires either a widget config or implementing the renderer function.");t.isGanttBase&&!1!==t.fixedRowHeight&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.widget&&An.ion({theme:e.onThemeChange,thisObj:e}),e.bindStore(t.store),e.triggerEvent&&t.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn()}bindStore(e){const t=this;t.recordStateMap.clear(),t.collapsingStateMap.clear(),t.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}doDisable(e){const{client:t}=this;e&&(this.recordStateMap.clear(),this.collapsingStateMap.clear()),t.isConfiguring||t.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e?this.L(e):e}onGridBodyFocusIn(e){var t,n;const r=this;(r.hasWidget?e.target.matches(`.${r.expanderBodyClass}, .${r.shadowRootContainerClass}`):null!==(t=r.client.lastMousedownEvent)&&void 0!==t&&null!==(n=t.target)&&void 0!==n&&n.closest("."+r.expanderBodyClass))||r.overridden.onGridBodyFocusIn(e)}keyMapOnKeyDown({target:e}){var t;this.hasWidget&&null!==(t=e.classList)&&void 0!==t&&t.contains(this.shadowRootContainerClass)||this.overridden.keyMapOnKeyDown(...arguments)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:t}=this,n=t.isAnimating;t.isAnimating=e,t.isAnimating!==n&&t.element.classList.toggle("b-rowexpander-animating")}changeWidget(e){return e&&this.isWidgetConfig(e)?{[this.client.regions[0]]:e}:e}afterColumnsChange(){this.addColumn()}changeColumn(e){return null==e?e:{type:"action",actions:[{cls:"b-icon b-icon-collapse-down",tooltip:({record:e})=>this.L(this.recordStateMap.has(e)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:e})=>this.toggleExpand(e)}],width:40,hideable:!1,align:"center",region:this.client.regions[0],...e,field:"expanderActionColumn"}}addColumn(){const e=this,{column:t}=e,{columns:n}=e.client;e._isAddingExpanderColumn||!t||e._expander&&n.includes(e._expander)||(e._isAddingExpanderColumn=!0,"last"===e.columnPosition?[e._expander]=n.add(t):[e._expander]=n.insert(0,t),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||null!=e&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onExpanderBodyResize(e){for(const n of e){var t;const e=this.client.store.getById(null===(t=n.target.dataset)||void 0===t?void 0:t.id),r=e&&this.recordStateMap.get(e);if(r&&!r.ignoreResize&&!r.isAnimating){const t=r.expanderBodyHeight;r.expanderBodyHeight=null,this.processRowHeight(e,0)!==t&&this.renderRowsWithAnimation(e)}}}get shouldSpanRegions(){return this.spanRegions&&this.client.regions.length>1}onStoreChange({action:e,source:t,records:n,changes:r}){var i;const s=this,{recordStateMap:o,collapsingStateMap:a}=s,l=r&&Object.keys(r);if((1!==(null==l?void 0:l.length)||"store"!==(null===(i=t.modelClass.fieldMap[l[0]])||void 0===i?void 0:i.type))&&!s.disabled)if("removeAll"===e)o.clear(),a.clear();else if(wu[e])for(const[e,n]of o)t.includes(e)||(s.destroyWidgets(n),o.delete(e),a.delete(e));else if(s.refreshOnRecordChange&&null!=n&&n.length)if("update"===e){const e=o.get(n[0]);null!=e&&e.isCreated&&(e.isCreated=!1,s.client.rowManager.renderFromRecord(n[0]))}else if("updatemultiple"===e){let e,r;for(const i of n){const n=o.get(i);if(null!=n&&n.isCreated){const s=t.records.indexOf(i);n.isCreated=!1,(!r||e>s)&&(e=s,r=i)}}r&&s.client.rowManager.renderFromRecord(r)}}processRowHeight(e,t){var n;const r=this,{shouldSpanRegions:i}=r;let s=r.recordStateMap.get(e),o=!1;if(s&&!s.expanderBodyHeight)for(const e of r.client.regions){var a;const t=null===(a=s.expandedBodyElements[e])||void 0===a?void 0:a.offsetHeight;t>s.expanderBodyHeight&&(s.expanderBodyHeight=t,o=!0)}else!s&&(s=r.collapsingStateMap.get(e))&&s.expanderBodyHeight&&(s.expanderBodyHeight=0,o=!0);return o&&r.enableAnimations&&i&&r.animateSpannedExpander(s),((null===(n=s)||void 0===n?void 0:n.expanderBodyHeight)??0)+t}animateSpannedExpander(e){const t=this,n=e.expandedBodyElements[t.client.regions[0]],r=t.client.rowManager.getRowById(e.record).element;e.isAnimating=t.isAnimating=!0,e.ignoreResize=!0,n.style.height=r.offsetHeight-e.cellHeight+"px",n.offsetHeight,n.style.height=e.expanderBodyHeight+"px",t.waitForTransition(n,(()=>{n.style.height="",e.expanderBodyHeight||n.remove(),e.isAnimating=t.isAnimating=!1}))}beforeRenderRow({row:e,record:t}){const n=this,{regions:r}=n.client,{expandedRowClass:i,collapsingStateMap:s,shouldSpanRegions:o}=n,a=n.recordStateMap.get(t);if(e.cls.toggle("b-rowexpander-disabled",n.disabled),e.cls[i]){let r=s.get(t);if(r){const i=()=>{r=s.get(t),r&&(s.delete(t),n.removeExpander(e),n.destroyWidgets(r))};n.enableAnimations&&n.isAnimating?n.waitForTransition(e,i):i()}else a||n.removeExpander(e)}else s.delete(t);!n.disabled&&a&&(a.isCreated||(a.ignoreResize=!0,n.renderExpander(t,e,a)),e.cls.add(i),r.forEach(((t,r)=>{const i=e.getElement(t);if(a.isCreated&&(!o||0===r)){const r=a.expandedBodyElements[t],s=o?n.client.verticalScroller:i;r.parentElement!==s&&(o||Br.removeEachSelector(i,"."+n.expanderBodyClass),s.appendChild(r),n.observeResize(r)),o&&(r.style.top=e.top+a.cellHeight+"px"),a.ignoreResize=!1,a.renderPromiseResolver&&!a.isRenderingAsync&&(n.delay(a.renderPromiseResolver),a.renderPromiseResolver=null)}n.lockCellHeight(i,a.cellHeight,!1)})),n._shouldScrollIntoView&&n.autoScroll&&(n._shouldScrollIntoView=!1,Br.isInView(a.expandedBodyElements[r[0]],!0)||n.client.rowManager.ion({once:!0,thisObj:n,renderDone:()=>n.scrollRowIntoView(e,t)})))}scrollRowIntoView(e,t){this.isAnimating?this.waitForTransition(e,(()=>this.client.scrollRowIntoView(t))):this.client.scrollRowIntoView(t)}waitForTransition(e,t){const n=Br.isElement(e)?e:e.element;Zn.onTransitionEnd({element:n,property:"height",handler:t,thisObj:this,duration:Br.getPropertyTransitionDuration(n,"height")??1})}removeExpander(e){const t=this;e.cls.remove(t.expandedRowClass);for(const s of t.client.regions){const o=e.getElement(s);for(const e of o.querySelectorAll("."+t.expanderBodyClass))t.unobserveResize(e),e.remove();var n,r,i;if(o.classList.remove(t.expandedRowClass),t.lockCellHeight(o,null,!1),t.shouldSpanRegions)null===(n=e._spannedExpandedBodyElement)||void 0===n||null===(r=(i=n).remove)||void 0===r||r.call(i),e._spannedExpandedBodyElement=null}}destroyWidgets(e){for(const s of this.client.regions){var t,n,r,i;null===(t=e.widgets)||void 0===t||null===(n=t[s])||void 0===n||null===(r=(i=n).destroy)||void 0===r||r.call(i)}}isWidgetConfig(e){return e.type&&!e.tag}renderExpander(e,t,n){var r;const i=this,{client:s,widget:o,shouldSpanRegions:a}=i,l=null===(r=t.cells[0])||void 0===r?void 0:r.offsetHeight,{expandedBodyElements:c={}}=n,d=[],u=(e,t,n)=>{if(null!=e)if("string"==typeof e){const n=[...t.childNodes].map((e=>t.removeChild(e)));t.innerHTML=e,n.reverse().forEach((e=>t.insertBefore(e,t.firstChild)))}else i.isWidgetConfig(e)?h(e,t,n):(e=Br.createElement(e),t.appendChild(e))},h=(r,o,a)=>{var l;const c=null===(l=Br.getThemeInfo())||void 0===l?void 0:l.name,u=Br.createElement({parent:o,className:i.shadowRootContainerClass,style:"flex : 1"}),h=u._shadowRoot=u.attachShadow({mode:"closed"});d.push(Br.cloneStylesIntoShadowRoot(h).then((()=>{if(s.isDestroyed)return;const l=r.dataField??i.dataField;if(l){const t=e.getValue(l);if(null!=t&&t.isStore)r.store=t;else if(s.store[`${l}Store`]){const t=s.store[`${l}Store`];r.store=t.chain((t=>e.getValue(l).includes(t)))}else r.data=t}if(c){const{cls:e}=r,t=`b-theme-${c.toLowerCase()}`;r.cls=e?e+" "+t:t}n.widgets||(n.widgets={}),n.widgets[a]=o.widget=ba.create(Xt.assign({appendTo:h,owner:s,flex:1,minHeight:"5em",isNested:!0,expandedRecord:e},r)),l&&o.widget.store.ion({change:()=>!t.isDestroyed&&t.render(),thisObj:i})})).catch((e=>{throw new Error("Could not load stylesheet "+e)})))};if(!n.isRenderingAsync){t.addCls(i.expandedRowClass),Object.assign(n,{cellHeight:l,expandedBodyElements:c,expanderBodyHeight:0,loadingIndicators:[]});for(const[n,r]of s.regions.entries()){if(a&&n>0)break;const m=t.getElement(r);let f,v=c[r];var g;if(v?(i.unobserveResize(v),v.replaceChildren()):v=Br.createElement({parent:a?s.verticalScroller:m,tabIndex:-1,className:i.expanderBodyClass,style:{top:a?t.top+l:l+"px"},dataset:{id:e.id}}),a&&(t._spannedExpandedBodyElement=v),i.observeResize(v),null!=o&&o[r])h(o[r],v,r);else f=null===(g=i.renderer)||void 0===g?void 0:g.call(i,{record:e,expanderElement:v,rowElement:m,region:r,grid:s});p.isPromise(f)?d.push(f.then((e=>u(e,v,r)))):u(f,v,r),c[r]=v}d.length&&(n.isRenderingAsync=!0,i.showLoadingIndicators(n),Promise.all(d).then((()=>{Promise.all(d).then((()=>{var t,r;if(!s.isDestroyed){null===(t=n.loadingIndicators)||void 0===t||t.forEach((e=>e.remove())),n.loadingIndicators.length=0,n.ignoreResize=!1,n.isRenderingAsync=!1;for(const[,e]of i.recordStateMap)if(e.isRenderingAsync)return;null===(r=i.renderRowsWithAnimation)||void 0===r||r.call(i,e,!0)}}))}))),n.isCreated=!0}}showLoadingIndicators(e){for(const t in e.expandedBodyElements)e.loadingIndicators.push(Br.createElement({parent:e.expandedBodyElements[t],className:"b-rowexpander-loading",style:{height:this.loadingIndicatorHeight+"px"},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]}))}renderRowsWithAnimation(e){const t=this;if(t.enableAnimations){const n=t.client.rowManager.getRowById(e);n&&(t.isAnimating=!0,t.collapsingStateMap.has(e)&&n.addCls("b-row-is-collapsing"),t.waitForTransition(n,(()=>{var e;(t.isAnimating=!1,n.isDestroyed)||(null===(e=n.removeCls)||void 0===e||e.call(n,"b-row-is-collapsing"))})))}return t.bufferedRenderer(e)}bufferedRenderer(e){return(this._bufferedRecords??(this._bufferedRecords=[])).push(e),this._rafPromise||(this._rafPromise=new Promise((e=>{requestAnimationFrame((()=>{var t;null===(t=this.internalRender)||void 0===t||t.call(this,e),this._rafPromise=null}))}))),this._rafPromise}internalRender(e){const t=this,{_bufferedRecords:n}=t,{store:r}=t.client;t.recordStateMap.forEach(((e,t)=>{e.renderPromiseResolver&&e.isCreated&&!n.includes(t)&&n.push(t)}));const[i]=n.sort(((e,t)=>r.indexOf(e)-r.indexOf(t)));t.client.rowManager.renderFromRecord(i),n.length=0,t.delay(e)}lockCellHeight(e,t,n){for(let r=0;r<e.children.length;r++){const i=e.children[r];i.classList.contains(this.expanderBodyClass)||(i.style.height=n?"":t+"px")}}async expand(e,t=!1){const n=this;if(n.disabled||n.recordStateMap.has(e)||!1===await n.trigger("beforeExpand",{record:e}))return;let r;return new Promise((i=>{var s,o;(r={isCreated:!1,renderPromiseResolver:i,record:e},n.recordStateMap.set(e,r),n.collapsingStateMap.delete(e),n._shouldScrollIntoView=!0,n.renderRowsWithAnimation(e),t)||(null===(s=(o=n.client).syncSplits)||void 0===s||s.call(o,(t=>t.features.rowExpander.expand(e,!0))))})).then((()=>{var t,i;null===(t=n.trigger)||void 0===t||t.call(n,"expand",{record:e,expandedElements:r.expandedBodyElements,widget:null===(i=r.widgets)||void 0===i?void 0:i[n.client.regions[0]],widgets:r.widgets})}))}async collapse(e,t=!1){const n=this,r=n.recordStateMap.get(e);if(!n.disabled&&!1!==await n.trigger("beforeCollapse",{record:e})){if(null!=r&&r.expandedBodyElements)for(const e in r.expandedBodyElements)n.unobserveResize(r.expandedBodyElements[e]);var i,s;if(n.recordStateMap.delete(e),n.collapsingStateMap.set(e,r),await n.renderRowsWithAnimation(e),n.trigger("collapse",{record:e}),!t)null===(i=(s=n.client).syncSplits)||void 0===i||i.call(s,(t=>t.features.rowExpander.collapse(e,!0)))}}get hasWidget(){return Boolean(this.widget)||[...this.recordStateMap.values()].some((e=>e.widgets))}navigateDown(){if(!this.onKeyboardIn())return this.overridden.navigateDown(...arguments)}navigateUp(){this.onKeyboardIn(!0)}catchFocus({navigationDirection:e,source:t,editing:n}){const{client:r}=this,{focusedCell:s,regions:o}=r;for(let[l,c]of this.recordStateMap.entries())for(const d in c.expandedBodyElements)if(c.expandedBodyElements[d].widget===t){if(n){const t=o[o.indexOf(d)+("down"===e?1:-1)];var a;if(t)return this.startEditInWidget(null===(a=c.widgets)||void 0===a?void 0:a[t],"down"===e)}let t;"down"===e&&(l=r.store.getNext(l,i,!0)),t=n||!s||s._isDefaultFocus?this.getNavigateableColumn(r,!0,n&&"up"===e):s.column,r._focusedCell=null;const u=r.normalizeCellContext({record:l,column:t});return r.focusCell(u),n&&r.startEditing(u),!0}}onKeyboardIn(e){var t,n,r;const{focusedCell:i}=this.client,s=i&&this.recordStateMap.get(i.record),o=null==s||null===(t=s.expandedBodyElements)||void 0===t||null===(n=t[null==i||null===(r=i.column)||void 0===r?void 0:r.region])||void 0===n?void 0:n.widget;if(null!=o&&o.isGrid){let t;return t=o.focusedCell&&!o.focusedCell._isDefaultFocus?o.focusedCell.column:this.getNavigateableColumn(o),o._focusedCell=null,o.focusCell(o.normalizeCellContext({record:o[(e?"last":"first")+"VisibleRow"],column:t})),!0}return!1}getNavigateableColumn(e,t=!0,n=!1){const r=n?[...e.columns.visibleColumns].reverse():e.columns.visibleColumns;return r.find((n=>{var r;return n!==e.checkboxSelectionColumn&&n!==(null===(r=e.features.rowExpander)||void 0===r?void 0:r._expander)&&(!t||n.editor)}))??r[0]}isActionAvailable({actionName:e}){var t;if(Du[e])return!this.isDisabled&&(null===(t=this.client.features.cellEdit)||void 0===t?void 0:t.isEditing)}onTab(e){const{client:t}=this,{cellEdit:n}=t.features;if(null!=n&&n.enabled){var r;const{columns:i,regions:s}=t,{activeRecord:o}=n,a=!0!==e,l=n.getAdjacentEditableCell(t.focusedCell,a),c=a?o:l?t.store.getById(l.id):null,d=c&&(null===(r=this.recordStateMap.get(c))||void 0===r?void 0:r.widgets);if(d&&(null==o?void 0:o.id)!==(null==l?void 0:l.id)){let e=(l?i.getById(l.columnId):i.visibleColumns[0]).region;for(;e;){const t=d[e];if(this.startEditInWidget(t,a))return!0;e=s[s.indexOf(e)+(a?1:-1)]}}}return!1}startEditInWidget(e,t=!0){var n,r;const{cellEdit:i}=this.client.features;if(null!=i&&i.enabled&&null!=e&&null!==(n=e.features)&&void 0!==n&&null!==(r=n.cellEdit)&&void 0!==r&&r.enabled)return i.finishEditing().then((()=>{const n=e[(t?"first":"last")+"VisibleRow"],r=this.getNavigateableColumn(e,!0,!t);e.startEditing(e.normalizeCellContext({record:n,column:r}))})),!0}onShiftTab(){return this.onTab(!0)}observeResize(e){const t=this;t.resizeObserver||(t.resizeObserver=new ResizeObserver((e=>t.onExpanderBodyResize(e)))),t.resizeObserver.observe(e)}unobserveResize(e){var t;null===(t=this.resizeObserver)||void 0===t||t.unobserve(e)}doDestroy(){var e;null===(e=this.resizeObserver)||void 0===e||e.disconnect(),delete this.resizeObserver;for(const[,e]of this.recordStateMap)this.destroyWidgets(e);super.doDestroy()}onThemeChange({prev:e,theme:t}){for(const[,n]of this.recordStateMap)Object.values(n.expandedBodyElements).forEach((n=>{const r=n.querySelector("."+this.shadowRootContainerClass);var i,s,o,a;null!=r&&r._shadowRoot&&(Br.cloneStylesIntoShadowRoot(null==r?void 0:r._shadowRoot,!0),null===(i=n.widget)||void 0===i||null===(s=i.element)||void 0===s||s.classList.remove(`b-theme-${e}`),null===(o=n.widget)||void 0===o||null===(a=o.element)||void 0===a||a.classList.add(`b-theme-${t}`))}))}getExpandedRecord(e){for(const[n,{widgets:r,expandedBodyElements:i}]of this.recordStateMap.entries())if(r&&e.isWidget){var t;for(const t in r)if(r[t]===e)return n;if(null!==(t=e.expandedRecord)&&void 0!==t&&t.isModel)return e.expandedRecord}else for(const t in i){const r=i[t];if(r===e||r.contains(e))return n}return null}getExpandedWidgets(e){var t;return null===(t=this.recordStateMap.get(e))||void 0===t?void 0:t.widgets}}Eu._$name="RowExpander",Ed.registerFeature(Eu),V.apply(class{static target={class:Eu};observeResize(e){const t=this,{_overridden:n}=t;if(r.ResizeObserver)return n.observeResize.call(t,e);t.$resizeObserved||(t.$resizeObserved=new Map);const i=e=>t.onExpanderBodyResize([{target:e}]);t.$resizeObserved.set(e,i),Fo.addResizeListener(e,i)}unobserveResize(e){var t;this._overridden.unobserveResize.call(this,e);const n=null===(t=this.$resizeObserved)||void 0===t?void 0:t.get(e);n&&(Fo.removeResizeListener(e,n),this.$resizeObserved.delete(e))}doDestroy(){var e;this._overridden.doDestroy.call(this),null===(e=this.$resizeObserved)||void 0===e||e.forEach(((e,t)=>Fo.removeResizeListener(t,e))),delete this.$resizeObserved}});class xu extends ye{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${Gt.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${Gt.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${$.encodeHtml(e.text)}</span>\n                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,t){const n=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),r=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&n&&r&&o.isBrowserEnv&&("hour"===this.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",r.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=Gt.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=Gt.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}xu._$name="ClockTemplate";class Ru extends fi{static get defaultConfig(){return{tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onInternalPaint"]}}internalSnapToPosition(e){var t;const{dragData:n}=this;null===(t=this.snapToPosition)||void 0===t||t.call(this,{assignmentRecord:n.assignmentRecord,eventRecord:n.eventRecord,resourceRecord:n.newResource||n.resourceRecord,startDate:n.startDate,endDate:n.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:n,constrainDragToResource:r,constrainDragToTimeSlot:i,dragHelperConfig:s={}}=e,{timeAxisViewModel:o,isHorizontal:a}=t,l=a?r:i,c=a?i:r;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),p.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!n,removeProxyAfterDrop:!1,dragWithin:n?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:n?t.scrollManager:null,createProxy:t=>e.createProxy(t),snapCoordinates:({element:n,newX:r,newY:i})=>{const{dragData:s}=e,l=this.currentOverClient;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||o.snap)){const c=s.draggedEntities[0].event||s.draggedEntities[0],d=e.getCoordinate(c,n,[r,i]),u=l.fillTicks&&t.timeAxis.isContinuous?s.startDate:o.getDateFromPosition(d,"round"),{calendar:h}=c;if(!h||u&&h.isWorkingTime(u,Gt.add(u,c.fullDuration))){const e=u&&o.getPositionFromDate(u);u&&u>=t.startDate&&null!=e&&(a?r=e:i=e)}}const c={x:r,y:i};return e.internalSnapToPosition(c),c},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(t,n)=>(!s||!s.isElementDraggable||s.isElementDraggable(t,n))&&e.isElementDraggable(t,n)})}onInternalPaint({firstPaint:e}){var t;const n=this,{client:r}=n;null===(t=n.drag)||void 0===t||t.destroy(),n.drag=Hc.new(n.buildDragHelperConfig()),e&&r.rowManager.ion({changeTotalHeight:()=>{var e;return n.updateYConstraint(null===(e=n.dragData)||void 0===e?void 0:e[`${r.scheduledEventName}Record`])},thisObj:n}),n.showTooltip&&(n.clockTemplate=new xu({scheduler:r}))}doDestroy(){var e,t,n;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(n=this.tip)||void 0===n||n.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,t){const n=this;if(e){const r=lc.reconfigure(t,lc.mergeConfigs({forElement:n.element,id:n.tipId,getHtml:n.getTipHtml.bind(n),cls:n.tooltipCls,owner:n.client},e),{owner:n.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:n}),r}null==t||t.destroy()}createProxy(e){const t=e.cloneNode(!0);return delete t.id,t.classList.add(`b-sch-${this.client.mode}`),t}onBeforeDragStart({context:e,event:t}){const n=this,{client:r}=n,i=n.getMinimalDragData(e,t),s=null==i?void 0:i[`${r.scheduledEventName}Record`],o=i.resourceRecord;if(r.readOnly||n.disabled||!s||!1===s.isDraggable||s.readOnly||null!=o&&o.readOnly)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const a=!1!==n.triggerBeforeEventDrag(`before${r.capitalizedEventName}Drag`,{...i,event:t,context:{...e,...i}});var l;a&&(n.updateYConstraint(s,o),null===(l=r[`before${r.capitalizedEventName}DragStart`])||void 0===l||l.call(r,e,i));return a}onAfterDragStart({context:e,event:t}){}get isDragging(){var e;return null===(e=this.drag)||void 0===e?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var n,r;const i=this,s=i.findClientFromTarget(t,e)??i.client;i.currentOverClient=s,i.drag.unifiedProxy=i.unifiedDrag,i.onMouseOverNewTimeline(s,!0);const o=i.dragData=i.getDragData(e);if(i.suspendElementRedrawing(e.element),i.showTooltip&&i.tip){const t=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;i.tip.showBy(t)}i.triggerDragStart(o),null===(n=s[`after${s.capitalizedEventName}DragStart`])||void 0===n||n.call(s,e,o);const{eventMenu:a,taskMenu:l}=s.features,c=a||l;null==c||null===(r=c.hideContextMenu)||void 0===r||r.call(c,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:n,clockTemplate:r}=this,i=n.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(n.element,e),i&&r.updateDateIndicator(i,t)}findClientFromTarget(e,t){let{target:n}=e;if(/^touch/.test(e.type)){const e=wn.from(t.element,null,!0).center;n=Br.elementFromPoint(e.x,e.y)}const r=ba.fromElement(n,"timelinebase");return null!=r&&r.isResourceHistogram?null:r}onDrag({context:e,event:t}){const n=this,r=n.dragData,i=r.startDate;let s;if(s=n.constrainDragToTimeline?n.client:n.findClientFromTarget(t,r.context),n.updateDragContext(e,t),s){if(s!==n.currentOverClient&&n.onMouseOverNewTimeline(s),r.dirty||!n.throttleDragEvent){const e=r.valid;n.triggerEventDrag(r,i),e!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}n.showTooltip&&n.tip&&(n.tip.lastAlignSpec.allowTargetOut=!r.valid,n.tip.realign())}}onMouseOverNewTimeline(e,t){const n=this,{drag:{lockX:r,lockY:i}}=n,s=[];n.currentOverClient.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||n.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:n.drag.onScrollManagerScrollCallback}),n.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,n){n.trigger(e,t)}onDrop({context:e,event:t}){var n;const r=this,{currentOverClient:i,dragData:s}=r;let o=!1;if(null==i||i.scrollManager.stopMonitoring(),null===(n=r.tip)||void 0===n||n.hide(),e.valid=e.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=Boolean(s.externalDropTarget),e.valid&&s.startDate&&s.endDate){let n=!1;s.finalize=async t=>{n||s.async?await r.finalize(t):e.valid=e.valid&&t},r.triggerBeforeEventDropFinalize(`before${i.capitalizedEventName}DropFinalize`,{context:s,domEvent:t},i),n=!0,e.async=s.async,e.async||s.externalDropTarget||(o=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)}e.async||r.finalize(s.valid&&e.valid&&o)}onDragAbort({context:e}){var t,n;const r=this;r.isAborting=!0,null===(t=r.currentOverClient)||void 0===t||t.scrollManager.stopMonitoring(),r.client.currentOrientation.onDragAbort({context:e,dragData:r.dragData}),r.resetDraggedElements(),null===(n=r.tip)||void 0===n||n.hide(),r.triggerDragAbort(r.dragData)}onDragAbortFinalized({context:e}){var t,n;const r=this;r.triggerDragAbortFinalized(r.dragData),null===(t=(n=r.client)[`after${r.client.capitalizedEventName}DragAbortFinalized`])||void 0===t||t.call(n,e,r.dragData),r.isAborting=!1}onDragReset({source:e}){var t;const n=this,r=n.currentOverClient;null!==(t=e.context)&&void 0!==t&&t.started&&(n.resetDraggedElements(),r.trigger(`${r.scheduledEventName}DragReset`)),null==r||r.element.classList.remove(`b-dragging-${r.scheduledEventName}`),n.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:n}=e;this.resumeRecordElementRedrawing(e.record),n.forEach(((e,n)=>{this.resumeRecordElementRedrawing(e),t[n].classList.remove(this.drag.draggingCls),t[n].retainElement=!1})),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const n=this,{context:r}=n.drag;null===(t=n.tip)||void 0===t||t.hide(),n.triggerAfterDrop(n.dragData,!1),r.valid=!1,e&&n.drag.abort()}async finalize(e){const t=this,{dragData:n,currentOverClient:r}=t,i=r.features.taskTooltip||r.features.eventTooltip;if(!n||t.finalizing)return;const{context:s,draggedEntities:o,externalDropTarget:a}=n;let l;return t.finalizing=!0,o.forEach(((e,r)=>{t.resumeRecordElementRedrawing(e),n.eventBarEls[r].classList.remove(t.drag.draggingCls),n.eventBarEls[r].retainElement=!1})),s.element.retainElement=!1,a&&n.valid||e?(l=t.updateRecords(n),!a&&p.isPromise(l)&&(s.async=!0,await l),n.valid?(s.async&&s.finalize(),a&&t.client.refreshRows(!1),t.triggerAfterDrop(n,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(s.async||n.async),t.finalizing=!1,null!=i&&i.enabled&&(i.disabled=!0,r.setTimeout((()=>{i.disabled=!1}),200)),l}getEventNewStartEndDates(e,t){let n,r=this.adjustStartDate(e.startDate,t);return e.graph?(r=e.run("skipNonWorkingTime",r),n=e.run("calculateProjectedXDateWithDuration",r,!0,e.duration)):n=Gt.add(r,e.fullDuration),{startDate:r,endDate:n}}updateDragContext(e,t){const n=this,{drag:r}=n,s=n.dragData,o=n.currentOverClient,{isHorizontal:a}=o,[l]=s.draggedEntities,c=l.isAssignment?l.event:l,d=s.startDate,u=n.constrainDragToTimeSlot||(a?r.lockX:r.lockY);if(s.browserEvent=t,Object.assign(s,n.getProductDragContext(s)),u)s.timeDiff=0;else{let t;if(o.timeAxis.isContinuous||s.startsOutsideView&&s.endsOutsideView){const r=o.isHorizontal?e.pageX??e.startPageX:e.pageY??e.startPageY,i=o.getDateFromCoordinate(r,null,!1,!0);t=s.timeDiff=i-e.pointerStartDate,null!==t&&(Object.assign(s,n.getEventNewStartEndDates(c,t)),s.valid&&(s.timeDiff=s.startDate-s.origStart))}else{const r=n.resolveStartEndDates(e.element);s.valid=Boolean(r.startDate&&r.endDate),s.valid&&(t=r.startDate-s.origStart),t!==i&&(c.graph?(s.startDate=c.run("skipNonWorkingTime",r.startDate),s.endDate=c.run("calculateProjectedXDateWithDuration",r.startDate,!0,c.duration)):(s.startDate=r.startDate,s.endDatee=r.endDate)),s.timeDiff=t}}const h=s.dirty=s.dirty||d-s.startDate!=0;if(s.valid)if(n.constrainDragToTimeline&&(s.endDate<=o.timeAxis.startDate||s.startDate>=o.timeAxis.endDate))s.valid=!1,s.context.message=n.L("L{EventDrag.noDropOutsideTimeline}");else if(h||s.externalDropTarget){const r=s.externalDragValidity=!t||e.pageX&&n.checkDragValidity(s,t);r&&"boolean"!=typeof r?(s.valid=!1!==r.valid,s.context.message=r.message):(s.valid=!1!==r,s.context.message="")}else{var g;s.valid=!1!==s.externalDragValidity&&!1!==(null===(g=s.externalDragValidity)||void 0===g?void 0:g.valid)}else s.valid=!1;s.context.valid=s.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:n,drag:r}=t,i=t.setupProductDragData(e),{record:s,eventBarEls:o,draggedEntities:a}=i,{startEvent:l}=r,c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=n.timeAxis,g=d<h.startDate,m=u>h.endDate,p=n.isSchedulerBase?n.multiEventSelect:n.selectionMode.multiSelect,f=t.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),v=t.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(s),a.forEach((e=>t.suspendRecordElementRedrawing(e))),s.isAssignment?n.selectAssignment(s,l.ctrlKey&&p):n.selectEvent(s,l.ctrlKey&&p);const y={context:e,...i,sourceDate:g?d:n.getDateFromCoordinate(f),screenSourceDate:n.getDateFromCoordinate(v,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:g,endsOutsideView:m,duration:u-d,browserEvent:l};return o.forEach((e=>e.classList.remove("b-sch-event-hover","b-active"))),o.length>1&&(e.relatedElements=o.slice(1)),y}setupConstraints(e,t,n,r){const i=this,s=!i.showExactDropPosition&&n>1?n:0;r?i.setXConstraint(e.left,e.right-t.width,s):i.setXConstraint(!0,!0,s),i.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e,t){const n=this,{client:r}=n,{context:i}=n.drag,s=r.timeAxisViewModel.snapPixelAmount;if(i&&!n.drag.lockY){let o;if(!n.constrainDragToTimeline)return void n.setYConstraint(null,null,s);o=r.getScheduleRegion(t,e),n.setYConstraint(o.top,o.bottom-i.element.offsetHeight,s)}else n.setYConstraint(null,null,s)}setXConstraint(e,t,n){const{drag:r}=this;r.minX=e,r.maxX=t}setYConstraint(e,t,n){const{drag:r}=this;r.minY=e,r.maxY=t}adjustStartDate(e,t){const n=this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e);return this.constrainStartDate(n)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:n}=t,r=wn.from(e.querySelector(t.eventInnerSelector),t.timeAxisSubGridElement),i=this.dragData,[s]=i.draggedEntities,o=s.isAssignment?s.event:s,a=t.fillTicks&&t.snapRelativeToEventStartDate,l=o.endDate-o.startDate;let{start:c,end:d}=t.getStartEndDatesFromRectangle(r,a?null:"round",l,!0);if(c&&d){if(a){const e=(o.startDate-Gt.startOf(o.startDate,n.unit))/(d-c)*r.width;r.deflate(e,0,0,e);const i=r.getStart(t.rtl,!t.isVertical);c=t.getDateFromCoordinate(i,null,!0),c=n.roundDate(c,o.startDate)}if(c=this.adjustStartDate(c,0),i.startsOutsideView)i.endsOutsideView||(c=d&&Gt.add(d,-l));else{if(!n.dateInAxis(c,!1)){const e=n.getTickFromDate(c);e>=0&&(c=n.getDateFromTick(e))}d=c&&Gt.add(c,l)}}return{startDate:c,endDate:d}}getTipHtml(){const e=this,{dragData:t,client:n,tooltipTemplate:r}=e,{startDate:i,endDate:s,draggedEntities:o}=t,a=n.getFormattedDate(i),l=n.getFormattedEndDate(s,i),{valid:c,message:d,element:u,dragProxy:h}=t.context,g=h?h.firstChild:u,m=o[0],p=m.isTask?m:m.event;return e.tip.lastAlignSpec.target=g,r({valid:c,startDate:i,endDate:s,startText:a,endText:l,dragData:t,message:d||"",[n.scheduledEventName+"Record"]:p,startClockHtml:e.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:p.isMilestone?"":e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[t]=e)}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:n}=t,{isHorizontal:r}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=r?e:n,t.drag.lockX=r?n:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:t}=this,{dateConstraints:n}=t,r=t.eventRecord||t.taskRecord||t.draggedEntities[0];return null!=n&&n.start&&(e=Gt.max(n.start,e)),null!=n&&n.end&&(e=Gt.min(new Date(n.end-r.durationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,n){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}Ru._$name="DragBase";class Tu extends Ru{static get $name(){return"EventDrag"}static get configurable(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(e,t)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,copyKey:"SHIFT",copyMode:"auto",mode:"move",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changeMode(e){const{dragData:t,copyMode:n}=this;if(("event"===n||"auto"===n||"assignment"===n&&!this.scheduler.eventStore.usesSingleAssignment)&&(!t||t.eventRecords.every((e=>!e.isRecurring))))return e}updateMode(e){this.dragData&&("copy"===e?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;e&&(e.eventBarCopies.some((e=>e.isConnected))?e.eventBarCopies.forEach((e=>{e.classList.remove("b-hidden")})):e.eventBarCopies.forEach((t=>{t.classList.add("b-drag-proxy-copy"),t.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(t),t.retainElement=!0})))}setMoving(){const{dragData:e}=this;e&&e.eventBarCopies.forEach((e=>{e.classList.add("b-hidden")}))}get scheduler(){return this.client}onAfterDragStart(e){const t=this,{context:{element:n}}=e;super.onAfterDragStart(e),t.handleKeyDownOrMove(e.event),t.keyEventDetacher=Zn.on({element:Br.getRootElement(n),keydown:t.handleKeyDownOrMove,keyup:t.handleKeyUp,thisObj:t})}onDragReset(e){var t;super.onDragReset(e),null===(t=this.keyEventDetacher)||void 0===t||t.call(this),this.mode="move"}onDrop(e){var t;return null===(t=this.dragData.eventBarCopies)||void 0===t||t.forEach((e=>e.remove())),super.onDrop(e)}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveEventRecord(e)}isElementDraggable(e,t){var n;const r=this,{client:i}=r,s=r.getDraggableElement(e);if(!s||r.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const o=r.resolveEventRecord(s,i);if(!o||!o.isDraggable||o.readOnly)return!1;return!(!1===(null===(n=i[`is${r.capitalizedEventName}ElementDraggable`])||void 0===n?void 0:n.call(i,s,o,e,t)))}getTriggerParams(e){const{assignmentRecords:t,eventRecords:n,resourceRecord:r,browserEvent:i}=e;return{context:e,eventRecords:n,resourceRecord:r,assignmentRecords:t,event:i,domEvent:i}}getGroupedToStoreResources(e){if(e.resourcesInStore)return e.resourcesInStore;const t=this.client,n=t.isVertical?t.resourceStore:t.store;return e.resourcesInStore=[...new Set(n.getAllDataRecords().map((e=>e.$original)))].filter((e=>e.isLeaf))}getIndexDiff(e){const t=this,n=t.client,r=t.currentOverClient,i=n!==r,{isVertical:s}=r,o=n.isVertical?n.resourceStore:n.store,a=s?r.resourceStore:r.store,{resourceRecord:l,newResource:c}=e;let d;if(i)d=a.indexOf(c)-o.indexOf(l.$original);else if(t.constainDragToResource)d=0;else if(s&&a.isGrouped){const n=t.getGroupedToStoreResources(e);d=n.indexOf(l.$original)-n.indexOf(c)}else d=o.indexOf(l.$original)-o.indexOf(c);return d}getNewResource(e,t,n){const r=this,i=r.client,s=r.currentOverClient,o=i!==s,{isVertical:a}=s,l=i.isVertical?i.resourceStore:i.store,c=a?s.resourceStore:s.store;let{newResource:d}=e;if(o){const e=l.indexOf(t);d=c.getAt(e+n)||d}else if(0!==n){var u;let i;if(a&&c.isGrouped){const s=r.getGroupedToStoreResources(e);i=Math.max(Math.min(s.indexOf(t)-n,s.length-1),0),d=s[i]}else i=Math.max(Math.min(l.indexOf(t)-n,l.count-1),0),d=l.getAt(i),d.isSpecialRow&&(d=l.getNext(d,!1,!0)||l.getPrevious(d,!1,!0));d=null===(u=d)||void 0===u?void 0:u.$original}else d=t;return d}getDropData(e){const t=this.getIndexDiff(e);return{events:e.eventRecords.map((t=>({eventRecord:t,...this.getEventNewStartEndDates(t,e.timeDiff)}))),assignments:e.assignmentRecords.map((n=>({assignmentRecord:n,resourceRecord:this.getNewResource(e,n.resource,t)})))}}triggerBeforeEventDropFinalize(e,t,n){t.context.dropData=this.getDropData(t.context),super.triggerBeforeEventDropFinalize(e,t,n)}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){const n=this;if(n.currentOverClient.trigger("afterEventDrop",Object.assign(n.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=n.client;n.dragData.initialAssignmentsState.find((({resource:r,assignment:i},s)=>{var o;return!e.includes(i)||!t.includes(i.event)||r.id!==(null===(o=n.dragData.assignmentRecords[s])||void 0===o?void 0:o.resourceId)}))&&n.client.refresh()}n.client.setTimeout((()=>n.client.navigator.skipNextClick=!1),10)}handleKeyDownOrMove(e){var t,n;"copy"!==this.mode&&((e.key&&Zn.specialKeyFromEventKey(e.key)===(null===(t=this.copyKey)||void 0===t?void 0:t.toLowerCase())||e[`${null===(n=this.copyKey)||void 0===n?void 0:n.toLowerCase()}Key`])&&(this.mode="copy"))}handleKeyUp(e){Zn.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()&&(this.mode="move")}isValidDrop(e){const{newResource:t,resourceRecord:n,browserEvent:r}=e,i=e.draggedEntities[0],{target:s}=r;return t?!t.isSpecialRow&&!t.readOnly&&(n.$original===t||!i.event.resources.includes(t)):!(this.constrainDragToTimeline||!this.externalDropTargetSelector)&&Boolean(s.closest(this.externalDropTargetSelector))}checkDragValidity(e,t){var n;const r=this,i=r.currentOverClient;let s;if(null!==(n=e.newResource)&&void 0!==n&&n.readOnly)return!1;var o;(s=i.allowOverlap||i.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?r.validatorFn.call(r.validatorFnThisObj||r,e,t):{valid:!1,message:r.L("L{eventOverlapsExisting}")},!s||s.valid)&&(s=(null===(o=i.checkEventDragValidity)||void 0===o?void 0:o.call(i,e,t))??s);return s}async updateRecords(e){const t=this,n=t.client,r=t.currentOverClient,i="copy"===t.mode,{draggedEntities:s,timeDiff:o,initialAssignmentsState:a}=e,l=a[0].startDate,c=t.adjustStartDate(l,o);let d;return e.externalDropTarget||(r.timeAxis.timeSpanInAxis(c,Gt.add(c,s[0].event.durationMS,"ms"))||(e.valid=!1),e.valid&&(n.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit(),d=await t.updateAssignments(n,r,e,i),n.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit())),e.valid&&r.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:i,copyMode:t.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),d}async updateAssignments(e,t,n,r){const s=this,{copyMode:o}=s,a=e!==t,{isVertical:l}=t,{assignmentStore:c,eventStore:d}=e,{assignmentStore:u,eventStore:h}=t,g=e.isVertical?e.resourceStore:e.store,{eventRecords:m,assignmentRecords:p,timeDiff:f,initialAssignmentsState:v,newResource:y}=n,{unifiedDrag:b}=s,C=h.usesSingleAssignment||!1!==h.usesSingleAssignment&&d.usesSingleAssignment,S="event"===o?"event":"assignment"===o?"assignment":C?"event":"assignment",D=s.adjustStartDate(p[0].event.startDate,f),w=[],E=[],x=[],R=[],T=[],M=new Set;e.suspendRefresh(),t.suspendRefresh();let k=!1,I=!1,A=s.getIndexDiff(n);l&&m.forEach(((t,r)=>{const i=n.eventBarEls[r];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const F=n.eventBarEls.slice(),P=[],O={};for(let e=0;e<p.length;e++){const l=p[e];let m,$=l.event;if(r?(m=l.copy(),O[l.id]=m):m=l,!(m.isOccurrenceAssignment||c.includes(l)&&d.includes($))){F[e].remove(),F.splice(e,1),p.splice(e,1),e--;continue}const _=v[e],j=$,B=_.startDate,V=_.resource,H=this.constrainDragToTimeSlot?B:b?D:s.adjustStartDate(B,f);if(c!==u){const e=j.assignments.length>1||r;let t;var L;if(r?t=m:(t=m.copy(),O[m.id]=t),t.event&&!C&&(t.event=t.event.id,t.resource=t.resource.id),r||R.push(m),e||E.push(j),r&&("event"===o||"auto"===o&&h.usesSingleAssignment)||!h.getById(j.id))$=h.createRecord({...j.data,children:null===(L=j.children)||void 0===L?void 0:L.map((e=>e.copy())),id:!r||"event"!==o&&"auto"!==o?j.id:i,calendar:null}),t.set({eventId:$.id,event:$}),w.push($);C||x.push(t),m=t}let N=y,z=null;b||(N=s.getNewResource(n,V,A)||y);const W=m.resourceId!==N.$original.id;if(W){if(z=g.getById(m.resourceId),r&&c===u){m.setData({resource:null,resourceId:null}),m.resource=N,m.event=h.getById(m.eventId);const e="event"===o||d.usesSingleAssignment&&"auto"===o;e&&($=$.copy(),$.meta.endDateCached=s.adjustStartDate($.endDate,f),$.endDate=null,m.event=$,h.usesSingleAssignment&&($.resource=N,$.resourceId=N.id)),u.find((e=>e.eventId===m.eventId&&e.resourceId===m.resourceId))||x.find((e=>e.eventId===m.eventId&&e.resourceId===m.resourceId))||(e&&w.push($),x.push(m))}else m.resource=N;$.isEvent&&M.add($),k=!0,$.isOccurrence&&$.set("newResource",N),a&&C&&($.resourceId=N.id)}else r&&("event"===o||"auto"===o&&d.usesSingleAssignment)&&!w.includes($)&&($=$.copy(),$.meta.endDateCached=s.adjustStartDate($.endDate,f),$.endDate=null,w.push($),m.event=$,h.usesSingleAssignment&&$.set({resource:N,resourceId:N.id}),x.push(m));if(!T.find((e=>e.draggedEvent===$))&&!Gt.isEqual($.startDate,H)){for(;!$.isOccurrence&&$.isBatchUpdating;)$.endBatch(!0);r&&!a&&!C&&"assignment"===S&&W||($.startDate=H,T.push({draggedEvent:$,originalStartDate:B})),$.isEvent&&M.add($),I=!0}t.processEventDrop({eventRecord:$,resourceRecord:N,element:0===e?n.context.element:n.context.relatedElements[e-1],context:n,toScheduler:t,reassignedFrom:z,eventsToAdd:w,addedEvents:P,draggedAssignment:m}),t.trigger("processEventDrop",{originalAssignment:l,draggedAssignment:m,context:n,copyMode:o,isCopy:r})}if(c.remove(R),d.remove(E),u.add(x),r&&c===u){const{syncIdMap:t}=e.foregroundCanvas;Object.entries(O).forEach((([e,n])=>{const r=t[e];delete t[e],t[n.id]=r}))}if(w.length&&P.push(...h.add(w)),null==P||P.forEach((e=>M.add(e))),(R.length||E.length||x.length||w.length)&&(k=!0),(k||I)&&(C&&M.forEach((e=>e.beginBatch())),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),C&&M.forEach((e=>e.endBatch(!1,!0)))),k||(k=T.some((({draggedEvent:e,originalStartDate:t})=>!Gt.isEqual(e.startDate,t)))),!s.constrainDragToTimeline&&k)for(let e=0;e<p.length;e++){const i=(O[p[e].id]||p[e]).event,s=(null==P?void 0:P.find((e=>e.id===i.id)))||i,o=n.eventBarEls[e],c=0===e?n.context.element:n.context.relatedElements[e-1],d=t.isInTimeAxis(s);if(delete s.meta.endDateCached,r||To.removeChild(o.parentElement,o),s.resource&&(l||t.rowManager.getRowFor(s.resource))&&d){if(!s.parent||s.parent.isRoot){const e=wn.from(c,t.foregroundCanvas,!0);Br.setTopLeft(c,e.y,e.x),To.addChild(t.foregroundCanvas,c,s.assignments[0].id),a&&t.processCrossSchedulerEventDrop({eventRecord:s,toScheduler:t})}c.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),c.retainElement=!1}}t.resumeRefresh(!1),e.resumeRefresh(!1),p.length>0&&(k?(F.forEach((e=>delete e.lastDomConfig)),t.refreshWithTransition(),a&&(e.refreshWithTransition(),t.selectedEvents=P)):n.valid=!1)}getProductDragContext(e){const t=this,{currentOverClient:n}=t,r=e.browserEvent.target,i=e.newResource||e.resourceRecord,s=e.targetEventRecord;let o,a,l=n?t.resolveEventRecord(r,n):null;e.eventRecords.includes(l)&&(l=null),t.constrainDragToResource?o=e.resourceRecord:t.constrainDragToTimeline?n&&(o=t.resolveResource()||e.newResource||e.resourceRecord):o=t.resolveResource();const{assignmentRecords:c,eventRecords:d}=e,u=i!==o;let h=Boolean(o&&!o.isSpecialRow);return!o&&t.externalDropTargetSelector&&(a=r.closest(t.externalDropTargetSelector),h=Boolean(a)),{valid:h,externalDropTarget:a,eventRecords:d,assignmentRecords:c,newResource:o,targetEventRecord:l,dirty:u||l!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const t=this,{scheduler:n}=t,r=t.getElementFromContext(e),i=t.resolveEventRecord(r,n),s=n.resolveResourceRecord(r),o=n.resolveAssignmentRecord(r),a=o?[o]:[];o&&(n.isAssignmentSelected(a[0])||t.drag.startEvent.ctrlKey&&n.multiEventSelect)&&a.push.apply(a,t.getRelatedRecords(o));return{eventRecord:i,resourceRecord:s,assignmentRecord:o,eventRecords:[...new Set(a.map((e=>e.event)))],assignmentRecords:a}}setupProductDragData(e){var t;const n=this,{scheduler:r}=n,i=n.getElementFromContext(e),{eventRecord:s,resourceRecord:o,assignmentRecord:a,assignmentRecords:l}=n.getMinimalDragData(e),c=[];if(n.constrainDragToResource&&!o)throw new Error("Resource could not be resolved for event: "+s.id);let d;if(n.constrainDragToTimeline){var u;d=null===(u=n.getDateConstraints)||void 0===u?void 0:u.call(n,o,s);const e=n.constrainRectangle=n.getConstrainingRectangle(d,o,s),t=wn.from(i,r.timeAxisSubGridElement);super.setupConstraints(e,t,r.timeAxisViewModel.snapPixelAmount,Boolean(d.start))}return l.forEach((e=>{let t=r.getElementFromAssignmentRecord(e,!0);t||(t=r.currentOrientation.addTemporaryDragElement(e.event,e.resource)),c.push(t)})),{record:a,draggedEntities:l,dateConstraints:null!==(t=d)&&void 0!==t&&t.start?d:null,eventBarCopies:c.map((e=>n.createProxy(e))),eventBarEls:c}}getDateConstraints(e,t){var n;const{scheduler:r}=this,i=null===(n=r.getDateConstraints)||void 0===n?void 0:n.call(r,e,t);let s,o;return this.constrainDragToTimeSlot?(s=t.startDate,o=t.endDate):i&&(s=i.start,o=i.end),{start:s,end:o}}getConstrainingRectangle(e,t,n){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,n,!0,e&&{start:e.start,end:e.end})}getDragData(e){const t=this.getMinimalDragData(e)||{};return{...super.getDragData(e),...t,initialAssignmentsState:t.assignmentRecords.map((e=>({startDate:e.event.startDate,resource:e.resource,assignment:e})))}}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&!t.resource.readOnly&&t.event.isDraggable))}getCoordinate(e,t,n){const r=this.currentOverClient;if(r.isHorizontal){let i=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){var e;const t=this,n=t.currentOverClient,{isHorizontal:r}=n,{context:i,browserEvent:s,dragProxy:o}=t.dragData,a=o||i.element,l=wn.from(a,null,!0),c=n.isVertical||t.unifiedDrag?i.clientY:l.center.y,d=wn.from(a,n.timeAxisSubGridElement,!0),{x:u,y:h}=d.center,g=t.getMouseMoveEventTarget(s);let m=null;if(n.element.contains(g))if(r){const e=n.rowManager.getRowAt(c);m=e&&n.store.getAt(e.dataIndex)}else m=n.resolveResourceRecord(n.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[u,h]);return null===(e=m)||void 0===e?void 0:e.$original}adjustStartDate(e,t){const n=this.currentOverClient;return e=n.timeAxis.roundDate(new Date(e-0+t),!!n.snapRelativeToEventStartDate&&e),this.constrainStartDate(e)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){var t;const{dragData:n}=this;if(this.isDragging&&null!==(t=n.proxyElements)&&void 0!==t&&t.length){const t=n.assignmentRecords.indexOf(e);if(t>=0)return n.proxyElements[t]}return null}getMouseMoveEventTarget(e){return e.target}}Tu._$name="EventDrag",Ed.registerFeature(Tu,!0,"Scheduler"),Ed.registerFeature(Tu,!1,"ResourceHistogram");V.apply(class{static target={class:Tu};getMouseMoveEventTarget(e){return Zn.getComposedPathTarget(e)}});class Mu extends(mi(fi)){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onInternalPaint"]}}construct(e,t={}){const n=this;n.scheduleDraw=n.createOnFrame("draw",[],n,!0),super.construct(e,t),this.lineSegments=[]}doDisable(e){const t=this;t.attachToClient(e?null:t.client),t.client.rendered&&t.draw(),super.doDisable(e)}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.disabled||this.scheduleDraw())}getSVGCanvas(){const e=this,{client:t}=e;if(!e._svgCanvas){const n=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");n.retainElement=!0,n.classList.add("b-sch-canvas",e.containerCls),n.style.width=(t.isHorizontal?t.timeAxisViewModel.totalSize:t.timeAxisColumn.width)+"px",t.timeAxisSubGridElement.appendChild(n)}return e._svgCanvas}attachToProject(e){this.detachListeners("project"),null==e||e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}attachToRowManager(e){this.detachListeners("rowManager"),null==e||e.ion({name:"rowManager",translaterow:"onTranslateRow",refresh:"scheduleDraw",rerender:"scheduleDraw",changetotalheight:"scheduleDraw",thisObj:this})}attachToClient(e){const t=this;t.detachListeners("client"),null==e||e.ion({name:"client",horizontalscroll:"scheduleDraw",togglenode:"scheduleDraw",taskdrag:"onTaskDrag",taskdragabortfinalized:"scheduleDraw",aftertaskdrop:"scheduleDraw",timelineviewportresize:"scheduleDraw",thisObj:t}),t.attachToProject(null==e?void 0:e.project),t.attachToRowManager(null==e?void 0:e.rowManager)}onInternalPaint(){this.attachToProject(this.disabled?null:this.client.project)}onProjectRefresh(){this.scheduleDraw()}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:t}){e.forEach((e=>{this.updateLineForTask(e,{[e.id]:Gt.add(e.startDate,t.timeDiff)})}))}shouldDrawProgressLine(){const e=this;return!e.client.timeAxisSubGrid.collapsed&&!e.disabled&&(!e.drawLineOnlyWhenStatusDateVisible||e.client.timeAxis.dateInAxis(e.statusDate))}getStatusDateX(){let{statusDate:e}=this;const{client:t}=this;return t.timeAxis.dateInAxis(e)||(e=e<t.timeAxis.startDate?t.timeAxis.startDate:t.timeAxis.endDate),t.getCoordinateFromDate(e)}getRenderData(){const e=this.getStatusDateX(),t=this.client.timeAxisSubGridElement.getBoundingClientRect();return{statusDateX:e,viewXY:[this.client.scrollLeft-t.left,-t.top]}}draw(){const e=this,{client:t}=e;if(e.lineSegments.forEach((e=>e.remove())),e.lineSegments=[],!e.shouldDrawProgressLine())return;if(t.isAnimating)return void t.ion({transitionend(){e.scheduleDraw()},once:!0});const n=e.getRenderData(),r=[];t.rowManager.forEach((t=>r.push(...e.getLineSegmentRenderData(t,n)))),r.forEach((t=>e.drawLineSegment(t))),t.trigger("progressLineDrawn")}segmentBelongsToTask(e,t){return e.getAttribute("data-task-id")==t.id}updateLineForTask(e,t){const n=this;if(n.disabled)return;const r=n.client.getRowFor(e);if(r){const i=[];n.lineSegments.forEach((t=>{n.segmentBelongsToTask(t,e)&&(i.push(t),t.remove())})),H.remove(n.lineSegments,...i),n.getLineSegmentRenderData(r,n.getRenderData(),t).forEach((e=>n.drawLineSegment(e)))}}getLineSegmentRenderData(e,t,n={}){const r=this,{statusDateX:i,viewXY:s}=t,o=r.client.getRecordFromElement(e.elements.normal),a=o.id,l=[];let c;return r.isStatusLineTask(o,n[o.id])&&(c=r.calculateCoordinateForTask(o,s),c&&l.push({dataset:{taskId:a},x1:i,y1:e.top,x2:c.x,y2:c.y},{dataset:{taskId:a},x1:c.x,y1:c.y,x2:i,y2:e.bottom})),c||l.push({dataset:{taskId:a},x1:i,y1:e.top,x2:i,y2:e.bottom}),l}drawLineSegment(e){const t=this;t.lineSegments.push(Br.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:t.lineCls,parent:t.getSVGCanvas()},e)))}isStatusLineTask(e,t){const n=this.statusDate;return t=t||e.startDate,(null==e?void 0:e.project)&&!e.inactive&&this.client.timeAxis.isTimeSpanInAxis(e)&&(e.isInProgress||!e.isStarted&&t<n||e.isCompleted&&t>n)}calculateCoordinateForTask(e,t){const{client:n}=this,r=n.getElementFromTaskRecord(e),i=e.milestone,s=i?r:null==r?void 0:r.querySelector(".b-task-percent-bar");if(s){const e=s.getBoundingClientRect(),r=n.timeAxisViewModel.totalSize;return{x:Math.min((i?e.left:e.right)+t[0],r),y:e.top+e.height/2+t[1]}}}}Mu._$name="ProgressLine",Ed.registerFeature(Mu);V.apply(class{static get target(){return{class:Mu}}drawLineSegment(e){return"dataset"in e&&(Object.entries(e.dataset).forEach((([t,n])=>{e[`data-${$.hyphenate(t)}`]=n})),delete e.dataset),this._overridden.drawLineSegment.call(this,e)}});const ku=()=>{throw new Error("Abstract method call!")},Iu=()=>{throw new Error("Method cannot be called at this state!")};class Au extends ye{canUndo(e){ku()}canRedo(e){ku()}onUndo(e){ku()}onRedo(e){ku()}onStartTransaction(e){ku()}onStopTransaction(e){ku()}onStopTransactionDelayed(e){ku()}onRejectTransaction(e){ku()}onEnable(e){ku()}onDisable(e){ku()}onAutoRecordOn(e){ku()}onAutoRecordOff(e){ku()}onResetQueue(e){ku()}onModelUpdate(e){ku()}onStoreModelAdd(e){ku()}onStoreModelInsert(e){ku()}onStoreModelRemove(e){ku()}onStoreModelRemoveAll(e){ku()}onModelInsertChild(e){ku()}onModelRemoveChild(e){ku()}}Au._$name="StateBase";const Fu=Symbol("STATE_PROP"),Pu=Symbol("STORES_PROP"),Ou=Symbol("QUEUE_PROP"),Lu=Symbol("POS_PROP"),$u=Symbol("TRANSACTION_PROP"),_u=Symbol("TRANSACTION_TIMER_PROP"),ju=Symbol("AUTO_RECORD_PROP"),Bu=Symbol("IS_APPLYING_STASH");Object.freeze([Fu,Pu,Ou,Lu,$u,_u,ju,Bu]);const Vu=new Map;var Hu=(e,t)=>{Vu.set(e,t)},Nu=e=>("string"==typeof e&&(e=Vu.get(e)),e);const zu=(e,t)=>{const{undo:n,redo:r}=t;let i;return i=n&&!r?{[Ou]:e[Ou].slice(e.position),[Lu]:0}:r&&!n?{[Ou]:e[Ou].slice(0,e.position)}:{[Ou]:[],[Lu]:0},[i,()=>{e.notifyStoresAboutQueueReset(t)}]};const Wu=new class extends Au{canUndo(){return!1}canRedo(){return!1}onUndo(){Iu()}onRedo(){Iu()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){Iu()}onAutoRecordOn(){return{[ju]:!0}}onAutoRecordOff(){return{[ju]:!1}}onStartTransaction(){Iu()}onStopTransaction(){Iu()}onStopTransactionDelayed(){Iu()}onRejectTransaction(){Iu()}onResetQueue(e,t){return zu(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};Hu("disabledstate",Wu);const Uu=Symbol("ACTION_QUEUE_PROP");class Gu extends ye{get defaultConfig(){return{title:null}}construct(...e){this[Uu]=[],super.construct(...e)}get queue(){return this[Uu].slice(0)}get length(){return this[Uu].length}addAction(e){this[Uu].push(e)}undo(){const e=this[Uu];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[Uu];for(let t=0,n=e.length;t<n;++t)e[t].redo()}}Gu._$name="Transaction";class Yu extends Au{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){let n=e.position;const r=e[Ou],i=Math.max(0,n-t);return[{[Fu]:"restoringstate",[Lu]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];for(;n!==i;){const e=r[--n];e.undo(),t.push(e)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:t})}]}]}onRedo(e,t){let n=e.position;const r=e[Ou],i=Math.min(r.length,n+t);return[{[Fu]:"restoringstate",[Lu]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];do{const e=r[n++];e.redo(),t.push(e)}while(n!==i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:t})}]}]}onEnable(){Iu()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[Fu]:"autoreadystate",[ju]:!0}}onAutoRecordOff(){Iu()}onStartTransaction(e,t){const n=new Gu({title:t});return[{[Fu]:"recordingstate",[$u]:n},()=>{e.notifyStoresAboutStateRecordingStart(n)}]}onStopTransaction(){Iu()}onStopTransactionDelayed(){Iu()}onRejectTransaction(){Iu()}onResetQueue(e,t){return zu(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const qu=new Yu;Hu("readystate",qu);class Ku extends Au{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[$u];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[Fu]:"disabledstate",[$u]:null}}onAutoRecordOn(e){return[{[Fu]:"autorecordingstate",[ju]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){Iu()}onStartTransaction(){Iu()}onStopTransaction(e,t){const n=e[$u],r=e[Ou];let i=e[Lu];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),r[i]=n,r.length=++i),[{[Fu]:"readystate",[Lu]:i,[$u]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onRejectTransaction(e){const t=e[$u];return[{[Fu]:"restoringstate",[$u]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){Iu()}onResetQueue(e,t){return zu(e,t)}onModelUpdate(e,t,n,r,i){e[$u].addAction(e.makeModelUpdateAction(t,n,r,i))}onModelInsertChild(e,t,n,r,i,s){e[$u].addAction(e.makeModelInsertChildAction(t,n,r,i,s))}onModelRemoveChild(e,t,n,r){e[$u].addAction(e.makeModelRemoveChildAction(t,n,r))}onStoreModelAdd(e,t,n,r){e[$u].addAction(e.makeStoreModelAddAction(t,n,r))}onStoreModelInsert(e,t,n,r,i,s){e[$u].addAction(e.makeStoreModelInsertAction(t,n,r,i,s))}onStoreModelRemove(e,t,n,r,i){e[$u].addAction(e.makeStoreModelRemoveAction(t,n,r,i))}onStoreRemoveAll(e,t,n,r){e[$u].addAction(e.makeStoreRemoveAllAction(t,n,r))}}const Xu=new Ku;Hu("recordingstate",Xu);const Zu=new class extends Au{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){Iu()}onRedo(){Iu()}onEnable(){Iu()}onDisable(){Iu()}onAutoRecordOn(){return{[ju]:!0}}onAutoRecordOff(){return{[ju]:!1}}onStartTransaction(){Iu()}onStopTransaction(){Iu()}onStopTransactionDelayed(){Iu()}onRejectTransaction(){Iu()}onQueueReset(){Iu()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};Hu("restoringstate",Zu);const Ju=new class extends Yu{onAutoRecordOn(){Iu()}onAutoRecordOff(){return{[Fu]:"readystate",[ju]:!1}}onStartTransaction(e,t){const n=new Gu({title:t});return[{[Fu]:"autorecordingstate",[$u]:n},()=>{e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}onModelUpdate(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}onModelInsertChild(e,t,n,r,i){e.startTransaction(),e.onModelInsertChild(t,n,r,i)}onModelRemoveChild(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}onStoreModelAdd(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}onStoreModelInsert(e,t,n,r,i,s){e.startTransaction(),e.onStoreModelInsert(t,n,r,i,s)}onStoreModelRemove(e,t,n,r,i){e.startTransaction(),e.onStoreModelRemove(t,n,r,i)}onStoreRemoveAll(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}};Hu("autoreadystate",Ju);class Qu extends(Ku.mixin(mi)){onDisable(e){const t=e[$u],n=e[_u];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[Fu]:"disabledstate",[$u]:null,[_u]:null}}onAutoRecordOn(e){Iu()}onAutoRecordOff(e){const t=e[_u];return t&&this.clearTimeout(t),{[Fu]:"recordingstate",[ju]:!1,[_u]:null}}onStopTransaction(e,t){const n=e[$u],r=e[_u],i=e[Ou];let s=e[Lu];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[s]=n,i.length=++s),[{[Fu]:"autoreadystate",[Lu]:s,[$u]:null,[_u]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[_u];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[Fu]:eh,[_u]:t}}onResetQueue(e,t){return zu(e,t)}onRejectTransaction(e){const t=e[$u],n=e[_u];return n&&this.clearTimeout(n),[{[Fu]:"restoringstate",[$u]:null,[_u]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const eh=new Qu;Hu("autorecordingstate",eh);const th=()=>{throw new Error("Abstract method call!")};class nh extends ye{get type(){return this.constructor.name}undo(){th()}redo(){th()}}nh._$name="ActionBase";const rh=Symbol("MODEL_PROP"),ih=Symbol("NEW_DATA_PROP"),sh=Symbol("OLD_DATA_PROP");class oh extends nh{static get defaultConfig(){return{model:i,newData:i,oldData:i,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[rh]}set model(e){this[rh]=e}get newData(){return this[ih]}set newData(e){this[ih]={...e}}get oldData(){return this[sh]}set oldData(e){this[sh]={...e}}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}}oh._$name="UpdateAction";const ah=Symbol("PARENT_MODEL_PROP"),lh=Symbol("CHILD_MODELS_PROP"),ch=Symbol("INSERT_INDEX_PROP"),dh=Symbol("CONTEXT_PROP");class uh extends nh{static get defaultConfig(){return{parentModel:i,childModels:i,insertIndex:i,context:i}}get type(){return"InsertChildAction"}get parentModel(){return this[ah]}set parentModel(e){this[ah]=e}get childModels(){return this[lh]}set childModels(e){this[lh]=e.slice(0)}get insertIndex(){return this[ch]}set insertIndex(e){this[ch]=e}get context(){return this[dh]}set context(e){this[dh]=e}undo(){const{parentModel:e,context:t,childModels:n}=this,r=new Map,i=new Set;for(const s of n){const n=t.get(s);if(n){let t=r.get(n.parent);t||(t={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},r.set(n.parent,t)),n.parent===e?n.index>s.parentIndex?t.moveRight.push({parent:n.parent,model:s,index:n.index+1}):t.moveLeft.push({parent:n.parent,model:s,index:n.index}):t.moveFromAnotherParent.push({parent:n.parent,model:s,index:n.index})}else i.add(s)}for(const e of r.values()){const{moveRight:t,moveLeft:n}=e;n.sort(((e,t)=>e.index-t.index)),t.sort(((e,t)=>t.index-e.index))}i.forEach((e=>e.parent.removeChild(e)));for(const e of r.values()){const{moveRight:t,moveLeft:n,moveFromAnotherParent:r}=e;n.forEach((e=>{e.parent.insertChild(e.model,e.index)})),t.forEach((e=>{e.parent.insertChild(e.model,e.index)})),r.forEach((e=>{e.parent.insertChild(e.model,e.index)}))}}redo(){var e,t;const{parentModel:n,insertIndex:r,childModels:i}=this,s=null===(e=n.children)||void 0===e?void 0:e[r];n.insertChild(i,s,!1,{orderedBeforeNode:null==s||null===(t=s.previousSibling)||void 0===t?void 0:t.nextOrderedSibling})}}uh._$name="InsertChildAction";const hh=Symbol("PARENT_MODEL_PROP"),gh=Symbol("CHILD_MODELS_PROP"),mh=Symbol("CONTEXT_PROP");class ph extends nh{static get defaultConfig(){return{parentModel:i,childModels:i,context:i}}get type(){return"RemoveChildAction"}get parentModel(){return this[hh]}set parentModel(e){this[hh]=e}get childModels(){return this[gh]}set childModels(e){this[gh]=e.slice(0)}get context(){return this[mh]}set context(e){this[mh]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{const r=t.get(n);e.insertChild(n,r.parentIndex,i,{orderedParentIndex:r.orderedParentIndex})}))}redo(){this.parentModel.removeChild(this.childModels)}}ph._$name="RemoveChildAction";const fh=Symbol("STORE_PROP"),vh=Symbol("MODEL_LIST_PROP");class yh extends nh{static get defaultConfig(){return{store:i,modelList:i,silent:!1}}get type(){return"AddAction"}get store(){return this[fh]}set store(e){this[fh]=e}get modelList(){return this[vh]}set modelList(e){this[vh]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}yh._$name="AddAction";const bh=Symbol("STORE_PROP"),Ch=Symbol("MODEL_LIST_PROP"),Sh=Symbol("INSERT_INDEX_PROP"),Dh=Symbol("CONTEXT_PROP");class wh extends nh{static get defaultConfig(){return{store:i,modelList:i,insertIndex:i,context:i,silent:!1}}get type(){return"InsertAction"}get store(){return this[bh]}set store(e){this[bh]=e}get modelList(){return this[Ch]}set modelList(e){this[Ch]=e.slice(0)}get insertIndex(){return this[Sh]}set insertIndex(e){this[Sh]=e}get context(){return this[Dh]}set context(e){this[Dh]=e}undo(){const{store:e,modelList:t,context:n,silent:r}=this;t.sort(((e,t)=>{const r=n.get(e),s=n.get(t);return r!==i&&s!==i?r-s:0})),t.forEach((t=>{const s=n.get(t);t._undoingInsertion=!0,s!==i?e.insert(s,t,r):e.remove(t,r),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}wh._$name="InsertAction";const Eh=Symbol("STORE_PROP"),xh=Symbol("MODEL_LIST_PROP"),Rh=Symbol("CONTEXT_PROP");class Th extends nh{static get defaultConfig(){return{store:i,modelList:i,context:i,silent:!1}}get type(){return"RemoveAction"}get store(){return this[Eh]}set store(e){this[Eh]=e}get modelList(){return this[xh]}set modelList(e){this[xh]=e.slice(0)}get context(){return this[Rh]}set context(e){this[Rh]=e}undo(){const{store:e,context:t,modelList:n,silent:r}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{const i=t.get(n);e.insert(i,n,r)}))}redo(){this.store.remove(this.modelList,this.silent)}}Th._$name="RemoveAction";const Mh=Symbol("STORE_PROP"),kh=Symbol("ALL_RECORDS_PROP");class Ih extends nh{static get defaultConfig(){return{store:i,allRecords:i,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[Mh]}set store(e){this[Mh]=e}get allRecords(){return this[kh]}set allRecords(e){this[kh]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:n}=this;e.add(t,n)}redo(){this.store.removeAll(this.silent)}}Ih._$name="RemoveAllAction";const Ah=(e,t,n,r)=>new oh({model:e,newData:t,oldData:n,isInitialUserAction:r}),Fh=(e,t,n,r)=>new uh({parentModel:e,childModels:n,insertIndex:t,context:r}),Ph=(e,t,n)=>new ph({parentModel:e,childModels:t,context:n}),Oh=(e,t,n)=>new yh({store:e,modelList:t,silent:n}),Lh=(e,t,n,r,i)=>new wh({store:e,insertIndex:t,modelList:n,context:r,silent:i}),$h=(e,t,n,r)=>new Th({store:e,modelList:t,context:n,silent:r}),_h=(e,t,n)=>new Ih({store:e,allRecords:t,silent:n}),jh=(e,t,...n)=>{const r=e.state,i=t.call(e[Fu],e,...n);if("string"==typeof i)e[Fu]=Nu(i);else if(i instanceof Au)e[Fu]=i;else if(Array.isArray(i)){const[t,r]=i;"string"==typeof t?e[Fu]=Nu(t):t instanceof Au?e[Fu]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[Fu]=Nu(e[Fu])),"function"==typeof r&&jh(e,r,...n)}else i&&"object"==typeof i&&((e=Object.assign(e,i))[Fu]=Nu(e[Fu]));r!==qu&&r!==Ju&&i!==qu&&i!==Ju&&e.trigger("ready")};class Bh extends(Ge(ye)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:Ah,makeModelInsertChildAction:Fh,makeModelRemoveChildAction:Ph,makeStoreModelAddAction:Oh,makeStoreModelInsertAction:Lh,makeStoreModelRemoveAction:$h,makeStoreRemoveAllAction:_h,getTransactionTitle:null}}construct(...e){Object.assign(this,{[Fu]:qu,[Pu]:[],[Ou]:[],[Lu]:0,[$u]:null,[_u]:null,[ju]:!1,[Bu]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[Fu]}get position(){return this[Lu]}get length(){return this[Ou].length}get stores(){return Array.from(this[Pu])}hasStore(e){return this[Pu].includes(e)}addStore(e){this.hasStore(e)||(this[Pu].push(e),e.stm=this,e.forEach((e=>e.stm=this)),e.isTree&&(e.rootNode.stm=this))}removeStore(e){this.hasStore(e)&&(this[Pu]=this[Pu].filter((t=>t!==e)),e.stm=null,e.forEach((e=>e.stm=null)))}forEachStore(e){this[Pu].forEach((t=>e(t,t.id)))}get disabled(){return this.state===Wu}set disabled(e){const t=this;t.disabled!==e&&(jh(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===qu||this.state===Ju}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===Xu||this.state===eh}get isApplyingStash(){return this[Bu]}get autoRecord(){return this[ju]}set autoRecord(e){const t=this;t.autoRecord!=e&&jh(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){jh(this,this.state.onStartTransaction,e)}stopTransaction(e=null){jh(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){jh(this,this.state.onStopTransactionDelayed)}rejectTransaction(){jh(this,this.state.onRejectTransaction)}get transaction(){return this[$u]}get queue(){return this[Ou].map((e=>e.title))}get rawQueue(){return this[Ou]}get isRestoring(){return this.state===Zu||this.isApplyingStash}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),jh(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),jh(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){jh(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{var n;return null===(n=t.onStmRecordingStart)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore((n=>{var r;return null===(r=n.onStmRecordingStop)||void 0===r?void 0:r.call(n,this,e,t)})),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStart)||void 0===t?void 0:t.call(e,this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:t}){this.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStop)||void 0===t?void 0:t.call(e,this)})),this.trigger("restoringStop",{stm:this,cause:e,transactions:t})}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{var n;return null===(n=t.onStmQueueReset)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,n,r){jh(this,this.state.onModelUpdate,e,t,n,r)}onModelInsertChild(e,t,n,r){jh(this,this.state.onModelInsertChild,e,t,n,r)}onModelRemoveChild(e,t,n){jh(this,this.state.onModelRemoveChild,e,t,n)}onStoreModelAdd(e,t,n){jh(this,this.state.onStoreModelAdd,e,t,n)}onStoreModelInsert(e,t,n,r,i){jh(this,this.state.onStoreModelInsert,e,t,n,r,i)}onStoreModelRemove(e,t,n,r){jh(this,this.state.onStoreModelRemove,e,t,n,r)}onStoreRemoveAll(e,t,n){jh(this,this.state.onStoreRemoveAll,e,t,n)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){const e=this;if(this.transaction){const t=vs.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[t]=e.transaction,e.rejectTransaction(),t}}applyStash(e){const t=this,n=t.stashedTransactions[e];t[Bu]=!0,n&&(t.startTransaction(n.title),n.redo(),delete t.stashedTransactions[e]),t[Bu]=!1}}Bh._$name="StateTrackingManager";const Vh=/^b-icon-/,Hh=/^b-fa-/;class Nh extends ba{static $name="MenuItem";static type="menuitem";static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,t){const n=super.updateElement(e,t);return"boolean"==typeof this.checked&&(this.role="menuitemcheckbox"),this.ariaHasPopup=!!this.hasMenu&&"menu",n}compose(){var e;const t=this,{checked:n,href:r,hasMenu:i,separator:s,target:o,text:a,toggleGroup:l}=t,c="boolean"==typeof n,d=t.icon||(c?"b-fw-icon":""),u="b-icon-"+(l?"radio-":""),h="object"==typeof a;return{tag:r?"a":"div",tabIndex:-1,href:r,target:o,class:{"b-has-submenu":i,"b-checked":n,"b-separator":s||(null===(e=t.cls)||void 0===e?void 0:e["b-separator"])},dataset:{group:t.toggleGroup},[c?"aria-checked":""]:n,[i?"aria-expanded":""]:!1,children:{iconElement:d&&{"aria-hidden":!0,tag:"i",class:{"b-fa":Hh.test(d),"b-icon":Vh.test(d),"b-menuitem-icon":1,[`${u}checked`]:!0===n,[`${u}unchecked`]:!1===n,...Tn.normalize(d,"object")}},textElement:{tag:"span",html:h?null:a,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?[a]:null},subMenuIcon:i&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const t=this,n=this.parent,r={menu:n,item:t,element:t.element,bubbles:!0,domEvent:e};if("boolean"==typeof t.checked){const e=!t.checked;t.toggleGroup&&!e||(t.checked=!t.checked)}else t.href&&e.key&&t.element.click();t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&n&&(n.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout((()=>this.closeMenu()),this.closeMenuDelay))}openMenu(e){const{menu:t}=this;!this.disabled&&t&&(t.focusOnToFront=e,t.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof ba&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:n,element:r}=e,i=[];return t&&n&&Br.forEachSelector(e.rootElement,`[data-group=${n}]`,(e=>{if(e!==r){const t=ba.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}changeMenu(e,t){const n=this,{constrainTo:r,scrollAction:i}=n.owner;return!e||"object"!=typeof e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),Wh.reconfigure(t,e,{owner:n,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:n.element,owner:n,ariaLabel:n.text,constrainTo:r,scrollAction:i}})}}Nh.initClass(),Nh._$name="MenuItem";const zh={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Wh extends ic{static $name="Menu";static type="menu";static get configurable(){return{layout:"vbox",focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),Zn.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:e,element:t}=this;e.some((e=>Boolean(e._menu)))&&t.classList.add("b-menu-with-submenu");e.some((e=>e.icon))&&t.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,n=null===(e=t.parentMenu)||void 0===e?void 0:e.element.contains(Br.getActiveElement(t.parentMenu)),r=t.items[0];return!n&&!Br.usingKeyboard&&r instanceof Nh?t.element:super.focusElement}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){const t=this;var n,r;(super.hide(e),t.isVisible)||(null===(n=t.currentSubMenu)||void 0===n||null===(r=n.hide)||void 0===r||r.call(n,e),t.parentMenu&&(t.parentMenu.currentSubMenu=null))}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}onMouseOver(e){if(!1!==this.focusOnHover){var t;const n=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(".b-widget"),r=e.target.closest(".b-widget"),i=ba.fromElement(r);!Br.isTouchEvent&&r&&r!==n&&i.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const t=this,{relatedTarget:n}=e,r=n&&t.owns(n);let i=n instanceof HTMLElement&&ba.fromElement(n),s=!r;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!Br.getAncestor(i.element,[e.target])}!r&&s&&(t.currentSubMenu&&!t.currentSubMenu.closeTimer&&t.currentSubMenu.hide(),t.element.contains(Br.getActiveElement(t))&&Br.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=ba.fromElement(e),n=t&&t!==this&&!(t instanceof Nh);if("Escape"===e.key)return void(n?this:this.rootMenu).close();if(super.onInternalKeyDown(e),n)return;zh[e.key]&&e.preventDefault();const r=this.element,i=Br.getActiveElement(r);this.navigateFrom(i!==r&&r.contains(i)?i:null,e.key,e)}navigateFrom(e,t,n){const r=this,{treeWalker:i}=r,s=e&&r.getItem(e),o=r.rtl?"ArrowLeft":"ArrowRight",a=r.rtl?"ArrowRight":"ArrowLeft";let l;switch(t){case"ArrowUp":i.currentNode=e||(e=r.bottomFocusTrap),i.previousNode(),l=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(null!=s&&s.menu?r.openSubMenu(e,s):r.triggerElement(e,n));break;case o:if(e&&null!=s&&s.menu&&!e.classList.contains("b-disabled")){const t=r.openSubMenu(e,s);null==t||t.focus()}else i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode;break;case a:r.isSubMenu?r.hide():e||(i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),l=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&r.triggerElement(e,n)}l&&(l===r.element?r.navigateFrom(r.bottomFocusTrap,"ArrowUp",n):l===e?r.navigateFrom(r.topFocusTrap,"ArrowDown",n):l.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?ba.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const n=this.getItem(e);n&&!n.disabled&&n.doAction(t)}get isSubMenu(){var e;return this===(null===(e=this.owner)||void 0===e?void 0:e.menu)}openSubMenu(e,t){const n=this,r=t.menu;if(r){if(!r.isVisible){var i;const s={item:t,element:e};if(!1===n.trigger("beforeSubMenu",s))return;if(!1===(null===(i=t.onBeforeSubMenu)||void 0===i?void 0:i.call(t,s)))return;r.show()}return n.currentSubMenu=r}}set selectedElement(e){const t=this,n=t._selectedElement;if(n){const e=t.getItem(n),r=null==e?void 0:e.menu;null==r||r.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){const n=Br.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!n,focus:n})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){var e;const t=this.owner;return t&&(t.isMenu?t:null===(e=t.up)||void 0===e?void 0:e.call(t,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}let Uh;Wh.initClass(),Wh._$name="Menu";class Gh extends fi{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:r}},items:{},triggerEvent:!1,clickTriggerSelector:null,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var t;if(super.construct(...e),null===(t=this.type)||void 0===t||!t.length)throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(e.handled||this.triggerEvent!==e.type)"click"===e.type&&this.clickTriggerSelector&&e.target.matches(this.clickTriggerSelector)&&this.internalShowContextMenu(e,{align:"l-r",target:e.target});else{if(!0===e.ctrlKey&&!o.isMac)return void e.preventDefault();const t=e;if(Uh){const{target:n}=Uh;e=Zn.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>n,configurable:!0}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!Br.isEditable(e.target)){const t=this.getKeyboardContextMenuTarget(e.target);if(t)return Uh=e,Br.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),Uh=null,!0}return!1}getKeyboardContextMenuTarget(e){const t=Br.isInView(e);return e.children.length?Br.childFromPoint(e,t.width/2,t.height/2):e}internalShowContextMenu(e,t){const n=this;if(n.disabled)return;const r=n.getDataFromEvent(e);!e.handled&&!e.defaultPrevented&&r&&n.shouldShowMenu(r)&&("contextmenu"===e.type&&o.isSafari&&e.ctrlKey&&!e.metaKey&&Zn.on({element:e.target,capture:!0,once:!0,thisObj:this,click(e){e.preventDefault(),e.stopImmediatePropagation()}}),r.domEvent=e,n.showContextMenu(r,t))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}async showContextMenu(e,t){var n;const r=this,i=Br.isDOMEvent(e),s=i?r.getDataFromEvent(e):e,o=i?e:s.domEvent;if(null===(n=r._menu)||void 0===n||n.hide(),r.disabled)return;r.menuContext=s;const{type:a,client:l,processItems:c}=r,d=Br.isInView(s.targetElement).center;if(p.assign(s,{feature:r,point:null!=o&&o.clientX?[o.clientX+1,o.clientY+1]:[d.x,d.y],menu:r,items:{},selection:l.selectedRecords}),r.callChainablePopulateMenuMethod(s),p.merge(s.items,r.baseItems),r.preventDefaultEvent(s),(!c||!1!==await r.callback(c,l,[s]))&&r.hasActiveMenuItems(s)&&(r.populateItemsWithData(s),!1!==r.beforeContextMenuShow(s))){const{menu:e}=r;let n=l.trigger(`${a}MenuBeforeShow`,s);var u;if(Xt.isPromise(n)&&(o.handled=!0,n=await n),!1!==n)e.items=s.items,e.showBy(t||{target:s.domEvent}),null===(u=r.touchMoveDetacher)||void 0===u||u.call(r),r.touchMoveDetacher=Zn.on({element:l.element,touchmove:()=>e.hide(),thisObj:e,once:!0}),o&&(o.preventDefault(),o.handled=!0)}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,n=e._baseItems=p.assign({},e.items);for(const e in n){const r=n[e];r&&(t&&e in t?n[e]="object"==typeof r?p.merge(p.clone(t[e]),r):t[e]:!0===r&&delete n[e])}}return this._baseItems}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}callChainablePopulateMenuMethod(e){var t,n;null===(t=(n=this.client)[`populate${$.capitalize(this.type)}Menu`])||void 0===t||t.call(n,e)}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e&&!e.hidden))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,t){const n=this,{client:r,type:i}=n;if(e)return Wh.reconfigure(t,e?Wh.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(e){r.trigger(`${i}MenuItem`,e)},onToggle(e){r.trigger(`${i}MenuToggleItem`,e)},onDestroy(){n.menu=null},onBeforeItem(e){Object.assign(e,n.menuContext)},onShow({source:e}){n.menuContext.menu=e,r.trigger(`${i}MenuShow`,n.menuContext)}},e):null,n);null!=t&&t.isWidget&&t.destroy()}}Gh._$name="ContextMenuBase";const Yh={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class qh extends(Ge(ye)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}static configurable={skipUpdatingElement:null};construct(e){const t=this;super.construct(e),t.handleSelector||o.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:n,event:r}=e.grab;e.startEvent=r;const i=e.getCursorOffsetToElementEdge(r,n,t);e.context={element:n,edge:t,valid:!0,async:!1,elementStartX:Br.getTranslateX(n)||n.offsetLeft,elementStartY:Br.getTranslateY(n)||n.offsetTop,newX:Br.getTranslateX(n)||n.offsetLeft,newY:Br.getTranslateY(n)||n.offsetTop,elementWidth:n.offsetWidth,elementHeight:n.offsetHeight,cursorOffset:i,startX:r.clientX+i.x+e.scrollLeft,startY:r.clientY+i.y+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},n.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:Yh.down,touchstart:Yh.touchstart,thisObj:e};!e.handleSelector&&o.isHoverableDevice&&(t.mousemove={handler:Yh.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),Zn.on(t)}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){var t;const n={element:document,keydown:Yh.keydown,thisObj:this};e?(n.touchmove=Yh.touchmove,n.touchend=n.pointerup=Yh.touchend):(n.mousemove=Yh.move,n.mouseup=Yh.up),this.removeDragListeners=Zn.on(n),null===(t=this.onResizeHandlePointerDown)||void 0===t||t.call(this,this.startEvent)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const n=this;n.startEvent=t,n.canResize(t.target,t)&&n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,{context:r,direction:i}=n;if(null!=r&&r.element&&(r.started||Zn.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)){var s;if(!r.started)null===(s=n.scrollManager)||void 0===s||s.startMonitoring(Xt.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:i}],callback:e=>{var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:r,event:t}),r.started=!0;n.update(t)}else e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var n;const r=this,i=r.context;var s,o;(null===(n=r.removeDragListeners)||void 0===n||n.call(r),i)?(null===(s=r.scrollManager)||void 0===s||s.stopMonitoring(),i.started&&Zn.on({element:document,thisObj:r,click:Yh.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)):null===(o=r.reset)||void 0===o||o.call(r)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,n=t.context,{element:r}=n,i=wn.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX+n.cursorOffset.x,i.right),i.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY+n.cursorOffset.y,i.bottom),i.y)+t.scrollTop,r.classList.add(t.resizingCls),e&&(t.updateResize(e)&&(t.trigger("resizing",{context:n,event:e}),r.classList.toggle(t.invalidCls,!1===n.valid)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,n;const r=this;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;const r=n.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,o=i.clientY;let a=n.targetSelector?t.target.closest(n.targetSelector):t.target;if(a){var l;let c;if(r){if(!t.target.matches(r))return!1;c="horizontal"===n.direction?t.pageX<Br.getPageX(a)+a.offsetWidth/2?n.isRTL?"right":"left":n.isRTL?"left":"right":t.pageY<Br.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,a)?c=n.isRTL?"right":"left":n.overRightHandle(t,a)&&(c=n.isRTL?"left":"right"):n.overTopHandle(t,a)?c="top":n.overBottomHandle(t,a)&&(c="bottom"),!c)return n.context=null,!1;"touchstart"===t.type&&t.preventDefault();const d=n.getCursorOffsetToElementEdge(i,a,c),u=null===(l=n.internalBeforeStart)||void 0===l?void 0:l.call(n,{element:a,edge:c});if(u&&(a=u.element,c=u.edge),!1!==n.trigger("beforeResizeStart",{element:a,event:t}))return n.context={element:a,edge:c,isTouch:e,valid:!0,async:!1,direction:n.direction,elementStartX:Br.getTranslateX(a)||a.offsetLeft,elementStartY:Br.getTranslateY(a)||a.offsetTop,newX:Br.getTranslateX(a)||a.offsetLeft,newY:Br.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,cursorOffset:d,startX:s+d.x+n.scrollLeft,startY:o+d.y+n.scrollTop,finalize:()=>{var e;return null===(e=n.reset)||void 0===e?void 0:e.call(n)}},a.classList.add(n.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,n){const r=wn.from(t);let i=0,s=0;switch(n){case"left":i=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":i=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":s=r.y-e.clientY;break;case"bottom":s=r.y+r.height-e.clientY}return{x:i,y:s}}checkResizeHandles(e){const t=this,n=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(!n||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let r;r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n),r?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:n,allowEdgeSwitch:r,skipTranslate:i,skipUpdatingElement:s}=t;let o;r&&("horizontal"===t.direction?n.edge=n.currentX>n.startX?"right":"left":n.edge=n.currentY>n.startY?"bottom":"top");const{element:a,elementStartX:l,elementStartY:c,elementWidth:d,elementHeight:u,edge:h}=n,{style:g}=a,m=n.currentX-n.startX,p=n.currentY-n.startY,f=Br.getExtremalSizePX(a,"minWidth")||t.minWidth,v=Br.getExtremalSizePX(a,"maxWidth")||t.maxWidth,y=Br.getExtremalSizePX(a,"minHeight")||t.minHeight,b=Br.getExtremalSizePX(a,"maxHeight")||t.maxHeight,C="right"===h&&!t.isRTL||"bottom"===h?1:-1,S=d+m*C,D=u+p*C;let w=Math.max(f,S),E=Math.max(y,D);if(v>0&&(w=Math.min(w,v)),b>0&&(E=Math.min(E,b)),g.flex&&(g.flex=""),"horizontal"===t.direction&&d!==w){if(s||(g.width=Math.abs(w)+"px"),n.newWidth=w,"left"===h||w<0){const e=Math.max(Math.min(l+d-t.minWidth,l+m),0);i||Br.setTranslateX(a,Math.round(e)),n.newX=e}else"right"===h&&r&&!i&&Br.setTranslateX(a,l);o=!0}else"vertical"===t.direction&&u!==D&&(s||(g.height=Math.abs(E)+"px"),n.newHeight=E,"top"===h||E<0?(n.newY=Math.max(Math.min(c+u-t.minHeight,c+p),0),i||Br.setTranslateY(a,n.newY)):"bottom"===h&&r&&!i&&Br.setTranslateY(a,c),o=!0);return o}finishResize(e){const t=this,n=t.context,r={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){let e=!1;e="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(e?"resize":"cancel",r),n.async||n.finalize()}else{var i;null===(i=t.reset)||void 0===i||i.call(t)}}abortResize(e=null,t=!1){const n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(("left"===r.edge||r.allowEdgeSwitch&&!r.skipTranslate)&&Br.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(Br.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}overLeftHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.leftHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=wn.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(Zn.getPagePoint(e))}return!1}overRightHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.rightHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=wn.from(t);return i.x=i.right-n.getDynamicHandleSize(n.leftHandle,r),i.width>0&&i.contains(Zn.getPagePoint(e))}return!1}overTopHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.topHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=wn.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Zn.getPagePoint(e))}return!1}overBottomHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.bottomHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=wn.from(t);return i.y=i.bottom-n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Zn.getPagePoint(e))}return!1}}qh._$name="ResizeHelper";class Kh extends Array{constructor(e,t){super(),this.timeZone=e,this.year=t}}class Xh{constructor(e,t){this.asString=e,this.timeZone=t,this.asArray=Qh(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}}const Zh=(e,t)=>{const n=e.toLocaleString("sv-SE",{timeZone:t});return new Xh(n,t)},Jh=(e,t)=>{const{asTicksUtc:n,asString:r}=Zh(new Date(e),t);return{offset:(e-n)/6e4,tzTicksUtc:n,tzString:r}},Qh=e=>{const t=e.split(/[\s-:]/).map((e=>1*e));return t[1]-=1,t},eg=-864e5,tg=2592e6,ng=(e,t)=>{const n=rg.get(e,t);if(n)return n;const r=new Kh(e,t),i=new Date(Date.UTC(t,0,1)).getTime();let s,o,a,l,c=i,d=tg,u=0,h=[],g=null;for(;!l;)({offset:a,tzTicksUtc:s,tzString:o}=Jh(c,e)),null==g?(g=a,r.push({offset:a})):d>0&&a!==g?d=d===tg?eg:-6e4:d<0&&a===g&&(d===eg?d=36e5:(1===r.length?(r.push(h),g=h.offset):(r[0].startTicks=h.startTicks,r[0].startDateString=h.startDateString,l=!0),d=tg)),h={offset:a,startDateString:o,startTicks:s},d===tg&&(c=i,c+=u*tg,u+=1),c+=d,u>11&&(l=!0);return rg.set(r),r},rg={_cache:{},get(e,t){var n;return null===(n=this._cache[e])||void 0===n?void 0:n[t]},set(e){const{timeZone:t}=e,{_cache:n}=this;n[t]||(n[t]={}),n[t][e.year]=e}};class ig{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,t){if("number"==typeof t)return this.toUtcOffset(e,t);const n=Zh(e,t);return n.asArray[3]!==n.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),n.asLocalDate}static fromTimeZone(e,t){if("number"==typeof t)return this.fromUtcOffset(e,t);const n=this.dateAsArray(e),r=ng(t,e.getUTCFullYear());let i=r[0].offset;if(2===r.length){const e=Date.UTC(...n);e>=r[1].startTicks&&e<r[0].startTicks&&(i=r[1].offset)}return n[4]+=i,new Date(Date.UTC(...n))}static toUtcOffset(e,t){const n=e.getTimezoneOffset()+t;return new Date(e.getTime()+60*n*1e3)}static fromUtcOffset(e,t){const n=-e.getTimezoneOffset()-t;return new Date(e.getTime()+60*n*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}}ig.findOffsetDates=ng,ig._$name="TimeZoneHelper";class sg{static convertFromObject(e,t={}){p.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:n,elementName:r,includeHeader:i,rootElementForArray:s}=t;let{xmlns:o}=t;o=o?` xmlns="${o}"`:"";const a=e=>{const t=[];for(const n in e){const i=e[n];if(Array.isArray(i)){s&&t.push(`<${n}>`);for(const e of i)r.length?t.push(`<${r}>`):t.push(`<${n}>`),t.push(a(e)),r.length?t.push(`</${r}>`):t.push(`</${n}>`);s&&t.push(`</${n}>`)}else p.isObject(i)?t.push(`<${n}>${a(i)}</${n}>`):null==i?t.push(`<${n}/>`):t.push(`<${n}>${$.encodeHtml(i)}</${n}>`)}return t.join("")};return`${i?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':""}<${n}${o}>${a(e)}</${n}>`}}sg._$name="XMLHelper";class og{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:t}=this;let n;return t[e]?n=t[e]:(n=this.random100.filter((t=>t<e)),t[e]=n),n[this.rndIndex++%n.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,t){const n=[],r=this.nextRandom(t+1),i={};for(let t=0,s=this.nextRandom(e.length);t<r;t++){for(;i[s];)s=this.nextRandom(e.length);i[s]=!0,n.push(e[s])}return n}}og._$name="RandomGenerator";const ag=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"];class lg{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static rnd=new og;static rndTime=new og;static rndRating=new og;static rndText=new og;static get cities(){return["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"]}static get firstNames(){return["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"]}static get surNames(){return["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"]}static get teams(){return["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"]}static get foods(){return["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"]}static get colors(){return["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}static get skills(){return["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"]}static get tasks(){return["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}static*generate(e,t=!1,n=1){let r,s;"object"==typeof e&&(t=e.randomHeight,n=e.initialId??1,r=e.addSkills,s=e.rowCallback,e=e.count);const{rnd:o,rndTime:a,rndRating:l,rndText:c,firstNames:d,surNames:u,teams:h,foods:g,colors:m,cities:p,skills:f}=this;for(let y=0;y<e;y++){var v;const b=o.fromArray(d),C=o.fromArray(u),S=`${b} ${String.fromCharCode(65+y%25)} ${C}`,D=o.nextRandom(60)+1,w=new Date(2019,0,D),E=new Date(2019,0,D+o.nextRandom(30)+2),x={id:n>-1?y+n:i,title:"Row "+y,name:S,firstName:b,surName:C,city:o.fromArray(p),team:o.fromArray(p)+" "+o.fromArray(h),age:10+o.nextRandom(80),food:o.fromArray(g),color:o.fromArray(m),score:10*o.nextRandom(100),rank:o.nextRandom(100)+1,start:w,finish:E,time:Gt.getTime(a.nextRandom(24),5*a.nextRandom(12)),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:l.nextRandom(5),active:D>30,relatedTo:Math.min(e-1,y+n+o.nextRandom(10)),notes:ag[c.nextRandom(7)+1]};r&&(x.skills=o.randomArray(f,"number"==typeof r?r:7));const R=null===(v=s)||void 0===v?void 0:v(x);R&&Object.assign(x,R),t&&(x.rowHeight=5*o.nextRandom(!0===t?20:t)+20),yield x}}static generateData(e,t=!1,n=1,r=!0){let i=e;"object"!=typeof e&&(i={count:e,randomHeight:t,initialId:n,reset:r}),!1!==i.reset&&this.reset(),lg.overrideRowCount&&(i.count=lg.overrideRowCount);const s=[],o=this.generate(i);for(let e=0;e<i.count;e++)s.push(o.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:t,nbrResources:n=50,nbrEvents:r=5,dependencies:i,tickUnit:s="days",minDuration:o=2,maxDuration:a=10,gap:l=1,eventCallback:c}){const d=this.generateData(n),u=[];let h,g;i=[];for(let t=0;t<=n;t++)for(let n=0;n<=r;n++){const r=Math.round(Math.random()*(a-1-o))+o,d=u.length+1;h=0===n?Gt.add(e,Math.round(3*Math.random())*l,s):Gt.add(g,l,s),g=Gt.add(h,r,s),u.push({id:d,name:this.tasks[(t+n)%(this.tasks.length-1)],startDate:h,duration:r,endDate:g,resourceId:t}),null==c||c(u[u.length-1]),i&&t>0&&i.push({id:i.length+1,from:d-1,to:d})}return{resources:d,events:u,dependencies:i}}static generateOneEventPerTickAndResource({startDate:e,endDate:t,nbrResources:n=50,tickUnit:r="days"}){const i=this.generateData(n),s=[],o=Gt.getDurationInUnit(e,t,r);for(let t=0;t<=n;t++)for(let n=0;n<o;n++)s.push({id:s.length+1,resourceId:t,name:this.tasks[(t+n)%(this.tasks.length-1)],startDate:Gt.add(e,n,r),duration:1,durationUnit:r});return{resources:i,events:s}}static generateRow(){return lg.generateData(1,!1,-1,!1)[0]}}lg._$name="DataGenerator";const cg=["action","target","to","deltaX","deltaY","x","y","text"];class dg extends(Ge(mi())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),Zn.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:Br.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),Zn.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,n){if(!e)return null;let i;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();i=new MouseEvent(t,Object.assign({view:r,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},n||{}))}else i=document.createEvent("Event"),i.initEvent(t,!0,!1);return e.dispatchEvent(i),i}handleMouseMove(e,t){const n=this,r=n.mouse;r.classList.add("quick"),n.mouseDown&&r.classList.add("drag");const i=wn.from(r,n.outerElement),s=i.x,o=i.y;let a=0,l=0;if(e.to)if("string"==typeof e.to){const t=n.outerElement.querySelector(e.to);if(t){const e=wn.from(t,n.outerElement),r=e.x+e.width/2,i=e.y+e.height/2;a=(r-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;n.innerIntervalId=n.setInterval((()=>{if(n.shouldPause)return;9==c++&&(clearInterval(n.innerIntervalId),e.then&&e.then());const t=s+a*c,i=o+l*c;r.style.left=t+"px",r.style.top=i+"px";const d=r.getBoundingClientRect(),u=d.left,h=d.top,g=Br.elementFromPoint(u,h);g!==n.prevTarget&&(n.prevTarget&&(n.mouseOutElements.push(n.prevTarget),Br.isDescendant(n.mouseOutElements[0],g)||(n.mouseOutElements.forEach((e=>n.triggerEvent(e,"mouseout"))),n.mouseOutElements.length=0)),n.prevTarget=g,n.triggerEvent(g,"mouseover")),n.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=this,n=e.target;return n?"function"==typeof n?n(e):document.querySelector(n):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!cg.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),n=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,n}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<r.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,n=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(n),i=n.action;if(r&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(n,r);else{if(r!==e.prevTarget){const n=wn.from(r,e.outerElement);t.style.left=n.x+n.width/2+"px",t.style.top=n.y+n.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=r,t.classList.add(i),"type"===i){const e=ba.fromElement(r),t=n.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(r,i)}),"type"===i?100:550)}}}dg._$name="DemoBot";const ug=Object.hasOwn||((e,t)=>Object.prototype.hasOwnProperty.call(e,t));let hg=null;class gg{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class mg{static standardOptions=Object.freeze([]);static get(e){if(null==e)return this.NULL;if(e instanceof this)return e;const t="string"==typeof e?e:JSON.stringify(e),n=this.cache;let r=n.get(t);return r||(hg=t,r=new this(e),n.set(t,r)),r}static get cache(){return ug(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return ug(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this,{standardOptions:n}=t.constructor;if(t.cacheKey=hg,hg=null,t.initialize(),null===e)t.formatter=new gg(t);else{t.configure(e);for(const[e,r]of Object.entries(t.resolvedOptions()))null!=r&&n.includes(e)&&(t[e]=r)}}get parser(){return e=this,t=new this.constructor.Parser(this),Object.defineProperty(e,"parser",{value:t}),t;var e,t}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}mg._$name="Formatter";const pg=$.escapeRegExp,fg=/[\d+-]/g,vg=(e,t)=>new Intl.NumberFormat(e||i,t),yg=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class bg extends mg{static get $name(){return"NumberFormat"}static standardOptions=["currency","currencyDisplay","locale","maximumFractionDigits","minimumFractionDigits","minimumIntegerDigits","maximumSignificantDigits","minimumSignificantDigits","style","useGrouping"];initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits,t=Math.min(20,e+1);return null==e?null:this.as({style:"decimal",maximumFractionDigits:t,minimumFractionDigits:t},"truncator")}configure(e){"string"!=typeof e?Object.assign(this,e):this.template=e;const t=this,n={},r=t.locale?Xe.locales[t.locale]:Xe.locale,i=null==r?void 0:r.NumberFormat,{template:s}=t,{standardOptions:o}=t.constructor;if(i)for(const e in i)null==t[e]&&"function"!=typeof i[e]&&(t[e]=i[e]);if(s){const e=yg.exec(s),n=e[2],r=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",n&&(t.integer=+n),"*"===r?t.fraction=[0,20]:null!=r&&(t.fraction=[e[5].length,r.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e of o)null!=t[e]&&(n[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=vg(t.locale,n)}as(e,t=null){const n=this.resolvedOptions()||{template:"9.*"},r=this._as;let i=t&&r[t];return i||("string"==typeof e?n.style=e:Object.assign(n,e),n.from=this,i=new bg(n)),t&&(r[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,n=t.maximumFractionDigits,{truncator:r}=t;let i,s=t.parse(e);return r&&(s=r.format(s),i=s.indexOf(r.parser.decimal),i>-1&&s.length-i-1>n&&(s=s.slice(0,i+n+1)),s=r.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===i&&(e[t]=this[t]);return e}_minMax(e,t,n){const r=this,i=r[e];if(null!=i){const s=$.capitalize(e),o=`maximum${s}Digits`,a=`minimum${s}Digits`;"number"==typeof i?(t&&(r[a]=i),n&&(r[o]=i)):(r[a]=i[0],r[o]=i[1])}}}bg.Parser=class{constructor(e){const t=this,n=e.locale,r=vg(n,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(n,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(n,{style:"percent"}):null,o=r.format(1.2).replace(fg,"")[0],a=r.format(1e9).replace(fg,"")[0]||"";Object.assign(t,{currency:i,decimal:o,formatter:e,grouper:a,percent:s}),t.decimal=o,t.decimalRe=pg(o,"g"),t.grouper=a,t.stripRe=new RegExp(`(?:\\s+|${pg(a)})`+(i?`|(?:${pg(i.text)})`:"")+(s?`|(?:${pg(s.text)})`:""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace("−","-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const n=vg(e,t),r=vg(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),i=n.format(0),s=r.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}},Object.assign(bg.prototype,{currency:null,currencyDisplay:"symbol",fraction:null,from:null,integer:null,locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,significant:null,style:"decimal",template:null,useGrouping:!0}),mg.number=(e,t)=>bg.get(e).format(t),bg._$name="NumberFormat";class Cg extends(Ge(ye)){static webSocketImplementation="undefined"==typeof WebSocket?null:WebSocket;static configurable={address:"",userName:"User",autoConnect:!0};construct(e={}){const t=this;super.construct(e),t.onWsOpen=t.onWsOpen.bind(t),t.onWsClose=t.onWsClose.bind(t),t.onWsMessage=t.onWsMessage.bind(t),t.onWsError=t.onWsError.bind(t),t.autoConnect&&t.address&&t.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return(null===(e=this.connector)||void 0===e?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const t=this;e.addEventListener("open",t.onWsOpen),e.addEventListener("close",t.onWsClose),e.addEventListener("message",t.onWsMessage),e.addEventListener("error",t.onWsError)}detachSocketListeners(e){const t=this;e.removeEventListener("open",t.onWsOpen),e.removeEventListener("close",t.onWsClose),e.removeEventListener("message",t.onWsMessage),e.removeEventListener("error",t.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address)return void console.warn("Server me.address cannot be empty");if(e.isOpened)return!0;let t;return e.createWebSocketConnector(),e._openPromise=new Promise((n=>{t=e.ion({open(){n(!0)},error(){n(!1)}})})).then((n=>(t(),e._openPromise=null,n||e.destroyWebSocketConnector(),n))).catch((()=>{e._openPromise=null,e.destroyWebSocketConnector()})),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,t={}){var n;null===(n=this.connector)||void 0===n||n.send(JSON.stringify({command:e,...t}))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const t=JSON.parse(e.data);this.trigger("message",{data:t})}catch(e){this.trigger("error",{error:e})}}onWsError(e){this.trigger("error",{error:e})}}Cg._$name="WebSocketManager";class Sg extends(ye.mixin(Ge)){hasNativeAccess=!0;_content=null;async writeText(e,t){const n=this,{_content:r}=n;if(t&&n.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch(e){n.hasNativeAccess=!1}r!==e&&(n._content=e,n.triggerContentChange(r,!1,!0))}async readText(e){const t=this,{_content:n}=t;if(e&&t.hasNativeAccess)try{const e=await navigator.clipboard.readText();return n!==e&&(t._content=e,t.triggerContentChange(n,!0)),e}catch(e){t.hasNativeAccess=!1}return n}triggerPaste(e){this.trigger("paste",{source:e,text:this._content})}triggerContentChange(e,t=!1,n=!1){this.trigger("contentChange",{fromRead:t,fromWrite:n,oldText:e,newText:this._content})}async clear(e){await this.writeText("",e)}}var Dg=e=>class extends(e||ye){static $name="Clipboardable";static configurable={useNativeClipboard:!1};construct(...e){super.construct(...e),r.bryntum.clipboard||(r.bryntum.clipboard=new Sg),r.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}get clipboard(){return r.bryntum.clipboard}onClipboardPaste({text:e,source:t}){const n=this,{clipboardText:r,isCut:i}=n,s=n.compareClipboardText(r,e);var o;s&&i?(null===(o=n.handleCutData)||void 0===o||o.call(n,{text:e,source:t}),n.isCut=!1,n.cutData=null):s||n.clearClipboard(!1)}onClipboardContentChange({newText:e}){this.compareClipboardText(this.clipboardText,e)||this.clearClipboard(!1)}set cutData(e){var t,n;const r=this;null===(t=r._cutData)||void 0===t||t.forEach((e=>r.setIsCut(e,!1))),r._cutData=H.asArray(e),null===(n=r._cutData)||void 0===n||n.forEach((e=>r.setIsCut(e,!0)))}get cutData(){return this._cutData}setIsCut(){}async writeToClipboard(e,t,n={}){if(!1===await this.beforeCopy({data:e,isCut:t,...n}))return;const r=this,i="string"==typeof e,s=i?e:r.stringConverter?r.stringConverter(e):$.safeJsonStringify(e);return r.clipboardText=s,await r.clipboard.writeText(s,r.useNativeClipboard),r.clipboardData=e,r.isCut=t,r.cutData=t&&!i?e:null,s}async readFromClipboard(e={},t=!1){var n;const r=this,{clipboard:i}=r,s=await i.readText(r.useNativeClipboard),{isOwn:o,data:a}=r.transformClipboardText(s),l=s&&o&&r.isCut;if(!(null==a||Array.isArray(a)&&0==a.length||!1===await(null===(n=r.beforePaste)||void 0===n?void 0:n.call(r,{data:a,text:s,...e,isCut:l}))))return o||r.clearClipboard(!1),t||i.triggerPaste(r),a}async clearClipboard(e=!0){const t=this;t.clipboardData=t.clipboardText=t.cutData=null,t.isCut=!1,e&&await t.clipboard.clear(t.useNativeClipboard)}compareClipboardText(e,t){const n=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(null==e?void 0:e.replace(n,"\n"))===(null==t?void 0:t.replace(n,"\n"))}transformClipboardText(e){const t=this,n=t.compareClipboardText(t.clipboardText,e);return{isOwn:n,data:n?t.clipboardData:t.stringParser&&e?t.stringParser(e):e}}hasClipboardData(){const{clipboard:e}=this,{_content:t}=e;if(!this.useNativeClipboard||!e.hasNativeAccess)return Boolean(t&&this.transformClipboardText(t).data)}},wg=e=>class extends(e||ye){static get $name(){return"Finalizable"}construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}};const Eg=Symbol("dragAbort"),xg=Symbol("dragInit"),Rg=Symbol("dragDrag"),Tg=Symbol("dragDrop"),Mg={x:"horizontal",y:"vertical"};class kg extends(ye.mixin(wg,mi,ki)){static $name="DragContext";static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:n}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:n.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:xg,startEvent:n,touchStartTimer:null,_valid:!0}),"touches"in n&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay")),Zn.on({element:r,blur:"onWindowBlur",thisObj:t})}doDestroy(){const e=this,{source:t,target:n}=e;e.cleanup(),(null==n?void 0:n.dropping)===e&&(n.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===Eg}get completed(){return this.isDestroying||this.aborted||null!==this.endEvent}get pending(){return this.state===xg}get started(){return this.state!==xg&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const n=this;n._target=e,n.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=n,e.dropping!==n&&(e=null,n.valid=!1)),n._target=t}return e}updateTarget(e,t){const n=this;t&&n.source.dragLeaveTarget(n,t),e&&(n.valid=!0,e.dragMove(n),n.source.dragEnterTarget(n))}updateTargetElement(e){let t,n,r,i,s;for(s=e;s;s=s.parentElement)if(n=qc.get(s,"droppables"),n)for(i=0;i<n.length;++i)if(t=n[i],t.dropRootElement.contains(e)&&(r=t.droppableSelector,(!r||e.closest(`#${Br.getId(t.dropRootElement)} ${r}`))&&(this.target=t,this.target===t)))return}abort(){const e=this,{element:t,source:n}=e;null==t||t.getBoundingClientRect(),e.state!==Tg&&(e.state=Eg,e.cleanup()),null==n||n.endDrag(e)}begin(){const e=this,{source:t}=e,n=t.beforeDrag(e);return!1!==n&&(t.dragging=e),n}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:n,target:r}=t,{dragSwallowClickTime:i}=t.source;t.event=t.domEvent=t.endEvent=e,t.syncFlags(),t.started&&((null==n?void 0:n.clientX)===e.clientX&&(null==n?void 0:n.clientY)===e.clientY&&(null==n?void 0:n.target)===e.target||t.track(),i&&Zn.on({element:document,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}}),t.state=Tg,r!==t.source&&(null==r||r.dragDrop(t)))}fakeKey(e,t){const n=this,{lastMoveEvent:r}=n;if(r&&n.element){let i;r.isKey=!0,"Alt"===e.key?n.altKey!==t&&(n.altKey=t,i=!0):"Control"===e.key&&n.ctrlKey!==t&&(n.ctrlKey=t,i=!0),i&&(n.event=n.domEvent=r,n.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return Zn.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:n}=e,r=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)r&&t.abort();else if(n&&n.nodeType===Node.ELEMENT_NODE){if(r&&!t.started&&(t.event=t.domEvent=e,!1===t.start()))return void t.abort();t.started&&!t.completed&&(t.lastMoveEvent=t.event=t.domEvent=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:n,source:r}=e,{draggingBodyCls:i,dragLock:s}=r,a=r.dragRootElement;if(e.state=Rg,"touchstart"===e.startEvent.type&&o.isMobileSafari){for(let t=e.startEvent.target.parentElement;t;t=t.parentElement){const{style:n}=t,r=Br.getStyleValue(t,"overflow");"auto"!==r&&"scroll"!=r||(e.scrollingAncestors||(e.scrollingAncestors=[]),e.scrollingAncestors.push([t,n.overflow,n.overflowX,n.overflowY]),n.overflow="hidden")}e.requestAnimationFrame((()=>{e.scrollingAncestors.forEach((([{style:e},t,n,r])=>{e.overflow=t,e.overflowX=n,e.overflowY=r})),e.scrollingAncestors=null}))}if(t){const r=t.startMonitoring(p.merge({scrollables:[{element:a}],direction:Mg[s]||s||"both",callback(t){const{lastMoveEvent:n}=e;n&&e.element&&(n.isScroll=!0,e.event=e.domEvent=n,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},n));e.cleaners.push(r)}const l=r.dragRootElement.closest(".b-outer")||document.body;if(l.classList.add(i),e.cleaners.push((()=>l.classList.remove(i))),!1===r.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:n,target:r}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=Br.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,r===e.target&&(null==r||r.dragMove(e)),n.trackDrag(e)}}kg.prototype.STATE=kg.STATE=Object.freeze({ABORTED:Eg,INIT:xg,DRAGGING:Rg,DROPPED:Tg}),kg._$name="DragContext";class Ig extends(ye.mixin(Ni)){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:Ig}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}Ig.initClass(),Ig._$name="DragProxy";var Ag=e=>class extends(e||ye){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(e){const{dragRootElement:t,dragSelector:n,ignoreSelector:r}=this,i=n&&e.element.closest(n);return!n||Boolean(i&&i===t||t.contains(i)&&(!r||!e.element.matches(r)))}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return null!=e&&e.started&&!e.completed?e:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beginDrag(e){const{draggingCls:t,draggingClassElement:n}=this;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:n,dragProxy:r}=t;e.valid&&await t.dragDrop(e),t.isDestroyed||(e.pending?e.destroy():(t.dragEnd(e),null==r||r.dragEnd(e),null==n||n.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)))}async finalizeDrag(e){var t;await(null===(t=e.finalize)||void 0===t?void 0:t.call(e))}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:n}=this;null==n||n.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:n,id:r}=t,{target:i}=e;return{event:e,id:r?`${r}-drag-${t._nextDragId=(t._nextDragId||0)+1}`:null,itemElement:n?i.closest(n):i,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:n,draggingItemCls:r,dragEventer:i,dragProxy:s}=this,{itemElement:o}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t)))),r&&o&&(o.classList.add(r),e.cleaners.push((()=>o.classList.remove(r)))),null==s||s.dragStart(e);const a=this.dragStart(e);return!1!==a&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),a}trackDrag(e){var t;const{dropTargetSelector:n}=this;e.valid=!(n&&(null===(t=e.targetElement)||void 0===t||!t.closest(n))),this.moveDrag(e)}configureListeners(e){const t=Xt.assign({thisObj:this},this.dragDocumentListeners);return"touches"in e.startEvent?(delete t.mousemove,delete t.mouseup):(delete t.contextmenu,delete t.touchmove,delete t.touchend,delete t.pointerup),t}updateDragging(e,t){const n=this;if(e){const t=n.configureListeners(e);e.cleaners.push(Zn.on(t)),n.beginDrag(e)}else t&&t.destroy()}changeDragProxy(e,t){return Ig.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e,t){var n;const r=this,{draggableCls:i,dragItemSelector:s,onDragItemMouseMove:o}=r;if(null==t||t.classList.remove(i),null===(n=r._dragRootDetacher)||void 0===n||n.call(r),e){const t={thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:e=>{var t,n;return e.pointerId&&(null===(t=(n=e.target).releasePointerCapture)||void 0===t?void 0:t.call(n,e.pointerId))}};o&&(t.mousemove={delegate:s,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||o||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(t,{mouseover:{delegate:s,handler:"onDragItemMouseOver"},mouseout:{delegate:s,handler:"onDragItemMouseOut"}}),e.classList.add(i),r._dragRootDetacher=Zn.on(t)}}onDragItemMouseOver(e){this.overItem=e}onDragItemMouseOut(e){this.dragging||(this.overItem=e)}changeOverItem(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}updateOverItem(e,t){const n=this,{dragItemOverCls:r}=n;var i,s;t&&(r&&t.classList.remove(r),null===(i=n.onDragItemMouseLeave)||void 0===i||i.call(n,n.enterLeaveEvent,t));e&&(r&&e.classList.add(r),null===(s=n.onDragItemMouseEnter)||void 0===s||s.call(n,n.enterLeaveEvent,e))}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e),t&&(t=new kg(t),!1===t.begin()&&t.destroy()))}changeDragging(e,t){return null==t||t.destroy(),e}onDragPointerMove(e){const{dragging:t}=this;t&&!t.completed&&(null==t||t.move(e))}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},Fg=e=>class extends(e||ye){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragEnter",{drag:e,event:e.event})}dragMove(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragMove",{drag:e,event:e.event})}dragDrop(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("drop",{drag:e,event:e.event})}dragLeave(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragLeave",{drag:e,event:e.event})}changeDropping(e,t){if(e!==t){const n=this;t&&(!t.aborted&&t.completed||n.dragLeave(t)),e&&(n._dropping=e,!1===n.dragEnter(e)&&(e=null),n._dropping=t)}return e}updateDropRootElement(e,t){const n=this,{droppableCls:r}=n;let i,s,o;t&&(i=qc.get(t,"droppables"),o=!0,Array.isArray(i)&&(s=i.indexOf(n))>-1&&(i.length<2?qc.remove(t,"droppables"):(i.splice(s,1),i.forEach((e=>{r===e.droppableCls&&(o=!1)})))),o&&t.classList.remove(r)),e&&(i=qc.get(e,"droppables"),i?i.push(n):qc.set(e,"droppables",[n]),e.classList.add(r))}};const Pg="b-hover-edge",Og="b-hover-top",Lg="b-hover-right",$g="b-hover-bottom",_g="b-hover-left",jg={[Pg]:1,[Og]:1,[Lg]:1,[$g]:1,[_g]:1},Bg={t:[Pg,Og],r:[Pg,Lg],b:[Pg,$g],l:[Pg,_g],tr:[Pg,Og,Lg],bl:[Pg,$g,_g],tl:[Pg,Og,_g],br:[Pg,$g,Lg]};const{defineProperty:Vg}=Object,{hasOwn:Hg}=Xt,Ng=Symbol("fencible"),zg=[],Wg=e=>Array.from(new Set(e)),Ug=e=>e?Wg($.split(e)):zg,Gg=(e,t,n)=>{!0===n&&(n=t),Xt.isObject(n)||(n={all:n});let r=Ug(n.any);const i=Ug(n.all),s=n.lock?Ug(n.lock):Wg(i.concat(r)),o=t+"Impl";r=r.length?r:null,!e[o]&&Vg(e,o,{configurable:!0,value:e[t]}),Vg(e,t,{configurable:!0,value:function(...e){const t=this,n=Hg(t,Ng)?t[Ng]:t[Ng]={},a=e=>!n[e];if(i.every(a)&&(!r||r.some(a)))try{return s.forEach((e=>n[e]=(n[e]||0)+1)),t[o](...e)}finally{s.forEach((e=>--n[e]))}}})};var Yg=e=>class extends(e||ye){static $name="Fencible";static declarable=["fenced"];static setupFenced(e){let{fenced:t}=e;const n=t.static,r=[];n&&(t={...t},delete t.static,r.push([n,e])),r.push([t,e.prototype]);for(const[e,t]of r)for(const n in e)Gg(t,n,e[n])}get widgetClass(){}};const qg=6e4,Kg=36e5,Xg=864e5,Zg=/(\d+)?:?(\d*)/;class Jg{static format(e){const t=Math.floor(e/Kg),n=Math.floor(e/qg)%60;return`${t}:${n<10?"0":""}${n}`}static parse(e){const t=typeof e;if("string"===t){const t=Zg.exec(e);e=Number(t[1]||0)*Kg+Number(t[2]||0)*qg}else"number"!==t?e=Gt.getTimeOfDay(e):e<=24&&(e*=Kg);return Math.min(Math.max(Math.floor(e),0),Xg)}constructor(e){let t,n,r=0;null!=e&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,n=e.dayEndTime):"number"==typeof e?r=t=n=e:e&&(r=e.startShift,t=e.timeStart,n=e.timeEnd),this.startShift=r=Jg.parse(r||0),this.timeEnd=(null==n?(r+Xg)%Xg:Jg.parse(n))||Xg,this.timeStart=null==t?r:Jg.parse(t)}get startHour(){return Math.floor(this.timeStart/Kg)}get endHour(){return Math.floor(this.timeEnd/Kg)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?Xg-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),Gt.makeKey(e)}dayOfDate(e){return this.shiftDate(Gt.clearTime(e))}dayOfWeek(e){return(e=this.shiftDate(e,-1)).getDay()}delta(e,t="ms"){const{timeStart:n}=this,r=Jg.parse(e),i=(this.startShift&&r<n?r+Xg:r)-n;return"ms"===t?i:Gt.as(t,i,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:n}=this,r=t<n?n-t:Xg-t+n;return"ms"===e?r:Gt.as(e,r,"ms")}equals(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const n=this,{timeStart:r,timeEnd:i}=n,[s,o]=n._dateRangeArgs(e,t),[a,l]=n.timeRange(s,o);return r<i?a<l?a<i&&r<=l:a<i||r<=l:!(a<l)||a<i||r<=l}isIntraDay(e,t){const[n,r]=this._dateRangeArgs(e,t),i=this.startOfDay(n),s=Xg-Gt.diff(i,r,"ms");return!(s<0)&&(s>0||i<n)}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:t,timeStart:n,timeEnd:r}=this,i=Jg.parse(e);return n<r?i<n?i<t?1:-1:i<r?0:i<t?-1:1:i<r||i>=n?0:i<t?1:-1}parseKey(e){return this.dayOfDate(Gt.parseKey(e))}shiftDate(e,t=1){const{startShift:n}=this,r=typeof e;return e="number"===r?new Date(e):"string"===r?Gt.parse(e):new Date(e.getTime()),t&&n&&e.setMilliseconds(t>0?n:-n),e}sortEvents(e,t){const n=this.startOfDay(e);return null==t?void 0:t.sort(((e,t)=>{e=e.eventRecord||e,t=t.eventRecord||t;let{startDate:r}=e,{startDate:i}=t;return r?i?(r=r<n?n:r,i=i<n?n:i,r-i||t.endDate-i-(e.endDate-r)):1:-1}))}startOfDay(e){return e=this.shiftDate(e,-1),e=Gt.clearTime(e),e=this.shiftDate(e)}timeRange(e,t){const[n,r]=this._dateRangeArgs(e,t);return[Gt.getTimeOfDay(n),Gt.getTimeOfDay(r)]}toString(){const{startShift:e,timeEnd:t,timeStart:n}=this,r=e?`@${Jg.format(e)}`:"",i=Jg.format(n);return n===t?e?r:i:`${i}-${Jg.format(t)}${r}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}Jg.MIDNIGHT=new Jg({startShift:0,timeStart:0,timeEnd:24}),Jg.MILLIS_PER_MINUTE=qg,Jg.MILLIS_PER_HOUR=Kg,Jg.MILLIS_PER_DAY=Xg,Jg._$name="DayTime";class Qg extends(Ge(ye)){static $name="Month";static get configurable(){return{date:{$config:{equal:"date"},value:Gt.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?Gt.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const n=this,{dayColumnIndex:r,weekCount:i}=n,s=Gt.getFirstDateOfMonth(e),o=Gt.getLastDateOfMonth(s),a=r[s.getDay()],l=r[o.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),d=!t||e.getMonth()!==t.getMonth(),u=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|d<<2|c<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-a,n.endDayOfMonth=o.getDate()+(6-l),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!c||n.calculateWeekBase(),(d||c)&&n.generation++,u){const r={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&u),m:Boolean(12&u),y:Boolean(8&u),r:n.weekCount!==i}};n.trigger("dateChange",r),2&u&&n.trigger("weekChange",r),12&u&&n.trigger("monthChange",r),8&u&&n.trigger("yearChange",r)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,n=new Date(e.year,0,1),r=new Date(e.year,11,31),i=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(Gt.diff(e.weekBase,r,"day")/7);e.has53weeks=53===s&&t[r.getDay()]>2}getWeekStart(e){if("number"==typeof e)return Gt.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[n,r]=e;return n===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(n,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,n=t===em?new Qg(null):em;return n.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),n.date=e,n.updateDate(n.date,n.date),n}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Gt.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||Gt.nonWorkingDays}changeNonWorkingDays(e){return Xt.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:n}=t;for(let r=t.startDayOfMonth,i=0;i<n;i++){const n=[],i=t.getWeekNumber(new Date(t.year,t.month,r));for(let e=0;e<7;e++,r++)n.push(new Date(t.year,t.month,r));e(i,n)}}getWeekNumber(e){const t=this;if((e=Gt.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let n=Math.floor(Gt.diff(t.weekBase,e,"day")/7),r=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,r++),[r,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,n=Jg.MIDNIGHT){const r=this,i=e.getDay(),s=r.visibleDayColumnIndex[i],o=r.nonWorkingDays[i],a=r.hideNonWorkingDays&&o;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:i,dayTime:n,visibleColumnIndex:s,isNonWorking:o,week:r.getOtherMonth(e).getWeekNumber(e),key:Gt.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[i],date:new Date(e),dayEnd:n.duration("s"),tomorrow:n.dayOfDate(Gt.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!a&&e>=t.startDate&&e<Gt.add(t.endDate,1,"day"),isRowStart:0===s,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:n,hideNonWorkingDays:r}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[];let a=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,r&&n[l]||(o[l]=a++)}e.visibleColumnCount=a,e.weekLength=r?7-Xt.keys(n).length:7}}const em=new Qg(null);Qg._$name="Month";let tm=0;const nm=new WeakMap,rm=e=>{const t=new Map;return(...n)=>{const r=((...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=nm.get(e),t===i&&(t=++tm,nm.set(e,t))):t=String(e),t})).join("-"))(n);let s=t.get(r);return s===i&&(s=e(...n),t.set(r,s)),s}},im=e=>{const t=new Map,n=e=>e[0],r=e=>e[1],s=(e,t)=>n(e).push(t);return(o,a)=>{const l=(e=>{let n=t.get(e);return n===i&&(n=[[],[]],t.set(e,n)),n})(o);(e=>!r(e).length&&!n(e).length)(l)?(s(l,a),e(o,(e=>{((e,t)=>r(e).some((e=>Xt.isEqual(e,t))))(l,e)||(((e,t)=>{r(e).push(t)})(l,e),n(l).forEach((t=>t(e))))}))):(s(l,a),r(l).forEach((e=>a(e))))}},sm=Symbol("success"),om=Symbol("failure"),am=(e,t)=>[sm,e,t],lm=e=>[om,e],cm=e=>e.length&&e[0]===sm,dm=e=>"function"!=typeof e||e.length?e:e(),um=rm((e=>im(((t,n)=>n(am(e,t)))))),hm=rm((e=>im(((t,n)=>{const r=Math.min(e.length,t.length),i=t.substr(0,r),s=t.substr(r);n(i===e?am(i,s):lm(s))})))),gm=(e,t)=>(n,r)=>dm(e)(n,(e=>{if(cm(e)){const[,n,i]=e;t(n)(i,r)}else r(e)})),mm=rm(((...e)=>{const t=rm(((e,t)=>im(gm(e,(e=>gm(t,(t=>um([].concat(e,t)))))))));return e.reduce(t,um([]))})),pm=rm(((...e)=>im(((t,n)=>e.forEach((e=>dm(e)(t,n))))))),fm=rm((e=>(t,n)=>{const r=new RegExp(`^${e}`).exec(t);if(r){const e=r[0],i=t.substr(e.length);n(am(e,i))}else n(lm(t))})),vm=rm(((e,t)=>gm(e,((...e)=>um(t(...[].concat.apply([],e))))))),ym=(e,t)=>{const n=[];return e(t,(e=>{if(cm(e)){const[,,t]=e;""===t&&n.push(e)}})),n};var bm={memo:rm,memoCps:im,success:am,failure:lm,isSuccess:cm,resolveParser:dm,succeed:um,string:hm,bind:gm,seq:mm,alt:pm,regexp:fm,red:vm,runParser:ym,defineParser:e=>(t,n)=>n?dm(e)(t,n):ym(dm(e),t)};class Cm extends Ig{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:n}=this,{event:r}=e;n&&(n.isVisible||n.show(),n.alignTo({align:this.align,target:new wn(r.clientX-t,r.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return ba.reconfigure(t,e,this)}}Cm.initClass(),Cm._$name="DragTipProxy";class Sm extends Fa{static $name="UndoRedoBase";static type="undoredobase";static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}},overflowable:!0}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),null==e||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:t,redoBtn:n}=e;return this.color&&(t&&(t.color=this.color),n&&(n.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),n&&(n.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=[[0,"Original data"],...this.stm.queue.map(((e,t)=>[t+1,e||`Transaction ${t+1}`]))])}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:n,redoBtn:r,transactionsCombo:i}=this.widgetMap;n.badge=e.position||(t?"0":""),r.badge=e.length-e.position||(t?"0":""),n.disabled=!e.canUndo,r.disabled=!e.canRedo,this.fillUndoRedoCombo(),i&&(i.disabled=i.store.count<=1)}transactionsDisplayValueRenderer(e,t){var n;const r=(null===(n=this.stm)||void 0===n?void 0:n.position)||0;return`${r} undo actions / ${t.store.count-r-1} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const{stm:t}=this,n=t.position-e.value;n>0?t.canUndo&&t.undo(n):n<0&&t.canRedo&&t.redo(-n)}}Sm.initClass(),Sm._$name="UndoRedoBase";class Dm extends Mc{static $name="BooleanCombo";static type="booleancombo";static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const n=this;return super.changeStore(new ao({data:[{id:n.positiveValue,text:n.positiveText||n.L("L{Object.Yes}")},{id:n.negativeValue,text:n.negativeText||n.L("L{Object.No}")}]}),t)}}Dm.initClass(),Dm._$name="BooleanCombo";class wm extends(Fa.mixin(Ya)){static $name="ButtonGroup";static type="buttongroup";static configurable={defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"};onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const t=this;t.resetValueCache(),t.isSettingValue||t.toggleGroup&&!e.pressed||t.triggerFieldChange({value:t.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=wm.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=100/t.columns+"%"),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget((t=>{!1!==t.rotate&&(t.rotate=e)}))}get value(){if(!this._value){const e=[];this.items.forEach((t=>{t.pressed&&t.value!==i&&e.push(t.value)})),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const t=this,n=t.value;Array.isArray(e)||(e=e===i||null===e?[]:"string"==typeof e?e.split(t.valueSeparator):[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach((t=>{t.value!==i&&(t.pressed=e.includes(t.value))})),t.isSettingValue=!1,t.isConfiguring||n===t.value||t.triggerFieldChange({value:t.value,userAction:!1})}updateDisabled(e){this.items.forEach((t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly))}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}wm.initClass(),wm._$name="ButtonGroup";class Em extends rc{static $name="CalendarPanel";static type="calendarpanel";static get configurable(){return{layout:"vbox",textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}updateMinRowHeight(e){this.element.style.setProperty("--min-row-height",Br.setLength(e)),this.scrollable={overflowY:!!e&&"auto"}}updateMinColumnWidth(e){const t=this;t.element.style.setProperty("--min-column-width",Br.setLength(e)),t.scrollable={overflowX:!!e&&"auto"},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return Gt.parseKey(t.dataset.date)}changeTip(e,t){const n=this;return lc.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:`${n.id}-cell-tip`,forElement:n.bodyElement,forSelector:`.${n.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),null==e||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const n=this;super.updateElement(e,t),n.updateHideNonWorkingDays(n.hideNonWorkingDays),n.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),n.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),n.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),n.cellElements=[];for(let e=0,{length:t}=n.weekDayElements;e<t;e++)n.cellElements.push(n.weekDayElements[e].previousSibling,...n.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?Gt.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return Gt.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(Gt.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Gt.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=Gt.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=Gt.weekends)}changeNonWorkingDays(e){return Xt.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return Gt.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return Gt.add(e,1,"day")}changeMonth(e,t){const n=this;if(!(e instanceof Qg)){if("number"==typeof e){if(t)return void(t.month=e);const r=n.date||Gt.clearTime(new Date);r.setMonth(e),e={date:r}}e=Qg.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:n}),e}onMonthDateChange({source:e,newDate:t,oldDate:n,changes:r}){const i=this;if(i.year=e.year,!i.isConfiguring){if(!i.getCell(t)||r.m||r.y){const{isVisible:e}=i;i.refresh(),i.animateTimeShift&&e&&Br.slideIn(i.contentElement,t>n?1:-1)}i.trigger("dateChange",{changes:r,value:t,oldValue:n})}}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,n=null!=t.timeZone?t.timeZone:null===(e=t.project)||void 0===e?void 0:e.timeZone,r=null!=n?ig.toTimeZone(new Date,n):new Date,{weekElements:i,weekDayElements:s,date:o,month:a,dayCellCls:l,dayHeaderCls:c,disabledCls:d,otherMonthCls:u,weekendCls:h,todayCls:g,nonWorkingDayCls:m,nonWorkingDays:p,canonicalDayNumbers:f,sixWeeks:v}=t;if(r.setHours(0,0,0,0),!o)return void(t.date=r);t.element.style.setProperty("--visible-week-count",a.weekCount),t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let e=0;e<7;e++){const n=t.weekdayCells[e],r=t.canonicalDayNumbers[e],i={[c]:1,[h]:Gt.weekends[r],[m]:p[r]};t.headerRenderer?(n.innerHTML="",t.callback(t.headerRenderer,t,[n,e,r])):Br.setInnerText(n,t.shortDayNames[r]),Br.syncClassList(n,i),n.dataset.columnIndex=e,n.dataset.cellDay=r}let y=0,b=0,C=6;for(let e=6;e>=0;e--)if(!p[f[e]]){C=e;break}i[4].classList.toggle("b-hide-display",a.weekCount<5&&!v),i[5].classList.toggle("b-hide-display",a.weekCount<6&&!v),a.eachWeek(((e,n)=>{const o=s[y],c=[o.previousSibling,...o.children];i[y].dataset.week=`${e[0]},${e[1]}`,t.weekRenderer?t.callback(t.weekRenderer,t,[c[0],e]):c[0].innerText=e[1];for(let s=0;s<7;s++){const o=n[s],f=o.getDay(),v=Gt.makeKey(o),S=p[f],D=c[s+1],w={[l]:1,[d]:t.isDisabledDate(o),[u]:o.getMonth()!==a.month,[h]:Gt.weekends[f],[g]:o.getTime()===r.getTime(),[m]:S,"b-last-working-day":s===C,"b-first-visible-cell":!(o-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(o-(t.lastVisibleDate||-1)),[`b-day-of-week-${f}`]:1};Br.syncClassList(D,w),D.dataset.date=v,D.dataset.cellIndex=b,D.dataset.columnIndex=s,D.lastDomConfig&&(delete D.lastDomConfig.class,delete D.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:D,date:o,day:f,row:i[y],rowIndex:y,cellIndex:b,columnIndex:s,visibleColumnIndex:t.visibleDayColumnIndex[f],week:e,key:v}]):D.innerHTML=o.getDate(),b++}y++})),t.visibleWeekCount=y,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:n,nonWorkingDays:r}=this;return!(!this.disableWeekends||!r[t])||(n?Array.isArray(n)?(e=Gt.clearTime(e,!0),n.some((t=>!(Gt.clearTime(t,!0)-e)))):this.callback(this.disabledDates,this,[e]):void 0)}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...H.fill(7,{class:this.dayHeaderCls}),Br.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const n={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:e},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(n)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=Gt.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,n=e;;n.setDate(n.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[n.getDay()])return n}getCell(e,t){"string"!=typeof e&&(e=Gt.makeKey(e));const n=this.weeksElement.querySelector(`[data-date="${e}"]`);if(n&&(!t||!n.classList.contains(this.otherMonthCls)))return n}onTipOverCell({source:e,target:t}){e.date=Gt.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}Em.initClass(),Em._$name="CalendarPanel";class xm extends wc{static $name="ColorPicker";static type="colorpicker";static configurable={itemsFocusable:!1,navigator:{focusCls:"b-color-active"},itemWrapperTpl(e,t){const{selected:n}=this,{color:r,text:i}=e,s=this.getColorClassName(r);return Cc.tpl`
                    <li
                        class="${this.getItemClasses(e,t)} ${s}"
                        role="option"
                        aria-selected="${n.includes(e)}"
                        data-index="${t}"
                        data-id="${$.encodeHtml(r)}"
                        data-btip="${i}"
                        ${this.itemsFocusable?'tabindex="-1"':""}
                        style="${s?"":"background-color: "+r}"
                    ></li>`},colorClasses:null,colorClassPrefix:null,colors:["#45171D","#F03861","#FF847C","#FECEA8","#A5F2E7","#AA83F3","#8983F3","#A10054","#073059","#2866AB","#5FBDC5","#D8D95C","#FFDEDE","#F7F3CE","#C5ECBE","#3E3E3E","#405559","#68868C","#EDEDED","#D3D6DB","#3A4750","#303841","#BE3144"],addNoColorItem:!0,columns:6,colorSelected:null};configure(e){super.configure(e),this.setItems(),this.ion({item:"onColorSelect"})}setItems(){const e=this,{colors:t,colorClasses:n}=e;let r=n||t;e.addNoColorItem&&(r=[...r],r.push(null)),e.items=r.map((t=>t&&"string"!=typeof t?t:{color:t,text:(n?$.capitalize(t):t)||e.L("L{noColor}")}))}afterConfigure(){super.afterConfigure(...arguments),(this.addNoColorItem||this.value)&&this.select(this.value??null)}updateColors(){this.isConfiguring||this.setItems()}updateAddNoColorItem(){this.isConfiguring||this.setItems()}onColorSelect({record:e}){var t;this.refresh();const n={color:e.color,record:e,bubbles:!0};null===(t=this.colorSelected)||void 0===t||t.call(this,n),this.trigger("colorSelected",n)}select(e){e&&"string"!=typeof e||(e=this.store.findRecord("color",e??null)),e&&super.select(e)}updateColumns(e){this.style=`grid-template-columns:repeat(${e}, 1fr);`}getColorClassName(e){var t,n;return null!==(t=this.colorClasses)&&void 0!==t&&t.includes(e)||null!==(n=this.colorClasses)&&void 0!==n&&n.find((t=>t&&t.color===e))?this.colorClassPrefix+e:e?"":"b-no-color"}}xm.initClass(),xm._$name="ColorPicker";class Rm extends Mc{static $name="ColorField";static type="colorfield";static configurable={displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0};configure(e){const t=e.picker??{};e.colors&&(t.colors=e.colors),"addNoColorItem"in e&&(t.addNoColorItem=e.addNoColorItem),e.picker=t,super.configure(e)}updatePicker(e){e&&(this.items=e.store.records)}updateColors(e){this.isConfiguring||(this.picker.colors=e)}updateAddNoColorItem(e){this.isConfiguring||(this.picker.addNoColorItem=e)}set value(e){this.store||(this.items=[],this.store=this.picker.store),e||(e=this.store.findRecord("color",null)),super.value=e}showPicker(){this.picker.refresh(),super.showPicker(...arguments)}get value(){return super.value}syncInputFieldValue(...e){var t;const n=this,{value:r}=n;let i=null===(t=n.picker)||void 0===t?void 0:t.getColorClassName(r);i||(n.colorBox.style.color=r),i="b-colorbox "+i,n.colorBox.className=i,n.showBoxForNoColor||n.element.classList.toggle("b-colorless",!r),super.syncInputFieldValue(...e)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}}Rm.initClass(),Rm._$name="ColorField";class Tm extends rc{static $name="YearPicker";static type="yearpicker";static configurable={textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null};construct(e){super.construct({year:(new Date).getFullYear(),...e}),Zn.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return Xt.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const n=this;!n.startYear||e>n.endYear?n.startYear=e:e<n.startYear&&(n.startYear=e-(n.yearButtonCount-1)),n.isConfiguring||n.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&Br.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),n=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let t=0,r=e;t<this.yearButtonCount;t++,r++)n.push({tag:"button",dataset:{year:r},class:{"b-yearpicker-year":1,"b-selected":r===this.year},text:`000${r}`.slice(-4)});return t}}Tm.initClass(),Tm._$name="YearPicker";class Mm extends fc{static $name="DisplayField";static type="displayfield";static alias="display";static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):$.encodeHtml(this.value)}}}Mm.initClass(),Mm._$name="DisplayField";const km=()=>Gt.getMonthNames().map(((e,t)=>[t,e])),Im=(e,t)=>e.valueOf()-t.valueOf(),Am=Object.freeze([]);(class extends Mc{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}).initClass();class Fm extends Em{static $name="DatePicker";static type="datepicker";static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:km(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach((e=>e.setAttribute("role","row"))),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),Zn.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;null===(e=this._yearPicker)||void 0===e||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;null===(e=this.yearButton)||void 0===e||e.destroy(),null===(t=this.monthField)||void 0===t||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,{date:t}=e,n=e.focusElement,r=Gt.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=t;e.getConfig("tbar"),super.doRefresh(...arguments),e.widgetMap.monthField.value=t.getMonth(),e.widgetMap.yearButton.text=t.getFullYear();const i=Gt.parseKey(null==n?void 0:n.dataset.date);r-i&&e.syncActiveDate(r,i)}internalCellRenderer({cell:e,date:t}){const n=this,{activeCls:r,selectedCls:i,externalCellRenderer:s}=n,o=n.isSelectedDate(t),a={[r]:r&&n.isActiveDate(t),[i]:o,[n.outOfRangeCls]:n.minDate&&t<n.minDate||n.maxDate&&t>n.maxDate};if(o&&n.multiSelect){const e=!n.isSelectedDate(Gt.add(t,-1,"d")),r=!n.isSelectedDate(Gt.add(t,1,"d"));a["b-range-start"]=e,a["b-range-end"]=r,a["b-in-range"]=!e&&!r}Br.updateClassList(e,a),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",Gt.format(t,"MMMM D, YYYY")),n.isActiveDate(t)?e.id=`${n.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,n.callback(s,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");t.focus(),Br.getActiveElement(t)===t&&e.preventDefault(),this.activeDate=Gt.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(Gt.parseKey(t.dataset.date),e)}onUIDateSelect(e,t){const n=this,{lastClickedDate:r,multiSelect:i}=n;n.lastClickedDate=e,n.isDisabledDate(e)||(n.activatingEvent=t,i?n.handleMultiSelect(r,e,t):(n.selection=e,n.floating&&n.hide()),n.activatingEvent=null)}handleMultiSelect(e,t,n){const r=this,{multiSelect:i}=r,s=r._selection||(r._selection=new Pm),o=s.dates,a="range"===i,{size:l,generation:c}=s,d=l&&{[Gt.makeKey(Gt.add(o[0],-1,"d"))]:1,[Gt.makeKey(o[0])]:1,[Gt.makeKey(o[o.length-1])]:1,[Gt.makeKey(Gt.add(o[o.length-1],1,"d"))]:1},u=s.has(t)?"delete":"add",h=a&&(null==d?void 0:d[Gt.makeKey(t)]);if(n.ctrlKey)!0!==i&&l&&!h||(s[u](t),a&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<o[1]?1:-1)));else if(n.shiftKey&&l){const[n,i]=[new Date(a?r.rangeStartDate||(r.rangeStartDate=o[0]):e),t].sort(Im);a&&s.clear();for(const e=n;e<=i;e.setDate(e.getDate()+1))s.add(e)}else s.has(t)&&1===s.size||(s.clear(),s.add(t));const g=s.size;1===g?r.rangeStartDate=t:g||(r.rangeStartDate=null),s.generation!==c&&r.updateSelection(s)}changeSelection(e){const t=this;let n,r;if(e)if(e.forEach||(e=[e]),e.forEach(((n,r)=>e[r]=t.changeDate(n))),r=e[0],e.sort(Im),"range"===t.multiSelect&&2===e.length){n=new Pm;for(const t=new Date(e[0]);t<=e[1];t.setDate(t.getDate()+1))n.add(t)}else r=e[0],n=new Pm(e);else n=new Pm;return r&&(t.activeDate=t.rangeStartDate=Gt.clearTime(r)),n}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",Boolean(e)),e||(this.selection=[...this.selection][0])}updateSelection(e){const t=this,{dates:n}=e,r="range"===t.multiSelect?[n[0],n[n.length-1]]:n;n.length&&(t.date=n[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:r,userAction:Boolean(t.activatingEvent)}))}get selection(){const{_selection:e}=this,t=e?e.dates:Am;return"range"===this.multiSelect&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,n=e.key.trim()||e.code,r=t.activeDate;let i=new Date(r);if("Escape"===n&&t.floating)return t.hide();if(r&&t.weeksElement.contains(e.target)){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}changeMinDate(e){return e&&Em.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&Em.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}changeDate(e){return Gt.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e,t){const n=this,{month:r}=n;if(n.isConfiguring&&!n.initializingActiveDate&&(n.selection=e),!r.date||e.getMonth()===r.month||!n.getCell(e)||n.alwaysRefreshOnMonthChange||n.isNavigating)super.updateDate(e);else{const i=r.getOtherMonth(e),s=n.eventListeners&&(t?e.getDate()!==t.getDate()|(i.getWeekId(e)!==r.getWeekId(t))<<1|(e.getMonth()!==(null==t?void 0:t.getMonth()))<<2|(e.getFullYear()!==(null==t?void 0:t.getFullYear()))<<3:15);n.trigger("dateChange",{changes:{d:!0,w:Boolean(2&s),m:Boolean(12&s),y:Boolean(8&s),r:i.weekCount!==r.weekCount},value:e,oldValue:t})}}changeActiveDate(e,t){if(!1!==this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?this.changeDate(e):this.date||(this.date=Gt.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return Gt.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const n=this,{isConfiguring:r}=n;!r&&n.getCell(e)||(n.initializingActiveDate=r,n.date=e,n.initializingActiveDate=!1),r||n.refresh.isPending||n.syncActiveDate(e,t)}syncActiveDate(e,t){const n=this,{activeCls:r}=n,i=n.getCell(e),s=t&&n.getCell(t),o=Br.getActiveElement(n.element);i.setAttribute("tabIndex",0),r&&i.classList.add(r),i.id=`${n.id}-active-day`,n.weeksElement.contains(o)&&i.focus(),s&&s!==i&&(s.removeAttribute("tabIndex"),r&&s.classList.remove(r),s.removeAttribute("id"))}set value(e){const t=this,{selection:n,duration:r}=t;if(e){if(e=t.changeDate(e,t.value),"range"===t.multiSelect&&2===(null==n?void 0:n.length))return Gt.betweenLesserEqual(e,...n)||(e<n[0]?t.selection=[e,Gt.add(e,r-1,"d")]:t.selection=[Gt.add(e,-(r-1),"d"),e]),void(t.date=t.activeDate=e);e!==i&&(t.selection=e)}else t.date=new Date,t.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return"range"===this.multiSelect?Gt.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const n=this,{activeDate:r}=n,i=r&&n.getCell(r);let s;s="month"===t&&i&&(null==r?void 0:r.getMonth())===n.month.month+e?r:Gt.add(i?r:n.date,e,t);const o=new Date(s);o.setDate(1);const a=Gt.add(Gt.add(o,1,"month"),-1,"day");if(n.minDate&&e<0&&a<n.minDate||n.maxDate&&e>0&&o>n.maxDate)return;n.isNavigating=!0;const l=n.date=s;return i&&(n.activeDate=s),n.isNavigating=!1,l}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return null===(t=this._selection)||void 0===t?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){var n;t&&(this.activeDate=Gt.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),null===(n=this.focusElement)||void 0===n||n.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const n=new Date(this.activeDate);n.setFullYear(e),this.activeDate=n,this.focusElement&&Br.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var n,r;return Tm.reconfigure(t,e?Tm.mergeConfigs({owner:this,appendTo:this.element,minYear:null===(n=this.minDate)||void 0===n?void 0:n.getFullYear(),maxYear:null===(r=this.maxDate)||void 0===r?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=km();this.isConfiguring||t.every(((t,n)=>t[1]===e.store.getAt(n).text))||(t[e.value??this.date.getMonth()].selected=!0,e.items=t),super.updateLocalization()}}class Pm extends Set{add(e){return e=Gt.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=Gt.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(Gt.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new Pm(e)),e.size===this.size&&[...this].every((t=>e.has(t)))}get dates(){return[...this].sort().map((e=>Gt.parseKey(e)))}}Fm.initClass(),Fm._$name="DatePicker";class Om extends vc{static $name="DateField";static type="datefield";static alias="date";static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const n=this,r={owner:n,forElement:n[n.pickerAlignElement],minDate:n.min,maxDate:n.max,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(n._isUserAction=n._isPickerInput=!0,n.value=n.value?Gt.copyTimeValues(new Date(e[0]),n.value):new Date(e[0]),n._isPickerInput=n._isUserAction=!1,t.hide())}};n.calendarContainerCls&&(r.cls=n.calendarContainerCls),n.value?r.value=n.value:r.activeDate=new Date;const i=Fm.reconfigure(t,e,{owner:n,defaults:r});return null==i||i.refresh.flush(),i}get backShiftDate(){return Gt.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=e.backShiftDate;(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get forwardShiftDate(){return Gt.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=e.forwardShiftDate;(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:n}=t;if(n){const e={minDate:t.min,maxDate:t.max};t.value?e.value=t.value:n.activeDate||(e.activeDate=new Date),n.setConfig(e)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:n,max:r,validateDateOnly:i}=e;if(i&&(t=Gt.clearTime(t,!1)),n&&t<n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e,t=!0){const n=this;return null!=e&&(Gt.isDate(e)||(e="string"==typeof e?Gt.parse(e,n.format,n.strictParsing)||Gt.parse(e,n.fallbackFormat,n.strictParsing):new Date(e)),Gt.isValidDate(e))?t&&(!n.min||e-n.min>-Gt.MS_PER_DAY)&&(!n.max||e<=n.max)?n.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:n}=t;if(e=Gt.clone(e),n)if("entered"!==n&&!0!==n){const r=Gt.parse(n,t.timeFormat);Gt.isValidDate(r)?Gt.copyTimeValues(e,r):Gt.isValidDate(t.value)&&Gt.copyTimeValues(e,t.value)}else!0===n&&(t._isPickerInput||t.inputting)&&Gt.isValidDate(t.value)&&Gt.copyTimeValues(e,t.value);else Gt.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e,!1)}updateMin(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e,!1)}updateMax(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Gt.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const n=this,r=n.transformDateValue(e);if(!e||r){if(n.clearError("L{invalidDate}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue()}else n.setError("L{invalidDate}")}updateValue(e,t){const n=this._picker;n&&!this.inputting&&(n.value=n.activeDate=e),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=Gt.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime&&"entered"!==this.keepTime&&!0!==this.keepTime?!Gt.isEqual(Gt.clearTime(e),Gt.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?Gt.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}Om.initClass(),Om._$name="DateField";const Lm=e=>e.ctrlKey&&e.preventDefault();class $m extends pc{static $name="NumberField";static type="numberfield";static alias="number";static get configurable(){return{wrapAround:null,min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;const e=this.input.value,r=parseFloat(e);e!==t&&(n=!this.acceptValue(r,e))}return n}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,n=e.key;let r;if("ArrowUp"===n)t.doSpinUp(e.shiftKey),r=!0;else if("ArrowDown"===n)t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&n&&1===n.length){const e=t.getAfterValue(n),i=t.formatter.parseStrict(e);r=!(i===t.value||"-"===e&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(i,e)}"Enter"===n&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)+(e?t.largeStep:t.step);t.okMin(n)||(n=t.min),t.okMax(n)?t.applySpinChange(n):t.wrapAround&&(n=t.min,t.applySpinChange(n))}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)-(e?t.largeStep:t.step);t.okMax(n)||(n=t.max),t.okMin(n)?t.applySpinChange(n):t.wrapAround&&(n=t.max,t.applySpinChange(n))}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,n,r;super.onFocusOut(...arguments);const i=this,{input:s}=i,o=s.value,a=i.formatter.truncate(o),l=isNaN(a)?o:i.formatValue(a);null===(t=i.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(r=n.clickRepeater)||void 0===r||r.cancel(),i.lastTouchmove=null,o!==l&&(s.value=l),i._changedBySilentSpin&&(i.triggerChange(e,!0),i._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:n,input:r}=t,{parser:i,maximumFractionDigits:s}=n,o=r.value,a=i.decimalPlaces(o);if(n.truncator&&a>s){let e,l=o;const c=n.truncate(o);if(!isNaN(c)&&(l=t.formatValue(c),e=i.decimalPlaces(l),e<s&&(l+="0".repeat(s-e),e=s),e<a)){const e=o.length-t.caretPos;r.value=l,t.caretPos=l.length-e+1}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:n,decimalPrecision:r}=t;e=n?`${n}>9`:null,null!=r?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let n=e._formatter;return n&&e._lastFormat===t||(n=bg.get(e._lastFormat=t),e._formatter=n),n}updateStep(e){const t=this;var n;(t.element.classList.toggle("b-hide-spinner",!e),t._step=e,e&&o.isMobile)?t.touchMoveListener||(t.touchMoveListener=Zn.on({element:t.input,touchmove:"onInputSwipe",thisObj:t,throttled:{buffer:150,alt:Lm}})):null===(n=t.touchMoveListener)||void 0===n||n.call(t)}onInputSwipe(e){const{lastTouchmove:t}=this;if(t){const n=e.screenX-t.screenX,r=t.screenY-e.screenY;this["doSpin"+((Math.abs(n)>Math.abs(r)?n:r)>0?"Up":"Down")]()}e.preventDefault(),this.lastTouchmove=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const n=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?n.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&n.format&&(e=n.formatter.round(e))}else e=i;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}}$m.initClass(),$m._$name="NumberField";class _m extends rc{static $name="TimePicker";static type="timepicker";static configurable={floating:!0,layout:"hbox",items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9",wrapAround:!0},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9",wrapAround:!0},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9",wrapAround:!0},amPm:{type:"buttongroup",items:{amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}}}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null};construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){this.isConfiguring||this.isRefreshing||(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm="pmButton"===e.ref,this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const n=this;switch(e.key){case"Escape":return n.triggerTimeChange(n._initialValue),n.hide(),void e.preventDefault();case"Enter":return n.value=n.pickerToTime(),n.hide(),void e.preventDefault()}null===(t=super.onInternalKeyDown)||void 0===t||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:n,minute:r,second:i}=e.widgetMap;n.format=e._is24Hour?"2>9":null;let s=n.value,o=new Date(e.value);return e._is24Hour||(t&&s<12&&(s+=12),t||12!==s||(s=0)),o.setHours(s),o.setMinutes(r.value),e.seconds&&o.setSeconds(i.value),e._min&&(o=Gt.max(e._min,o)),e._max&&(o=Gt.min(e._max,o)),o}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e="string"==typeof e?Gt.parse(e,this.format):e),this.isVisible||(this._initialValue=e),e??Gt.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=Gt.is24HourFormat(e),this.refresh()}changeMin(e){return"string"==typeof e?Gt.parse(e,this.format):e}changeMax(e){return"string"==typeof e?Gt.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:n,second:r,amButton:i,pmButton:s}=e.widgetMap,o=e.value,a=e._is24Hour,l=o.getHours(),c=e._pm=l>=12;e.element.classList[a?"add":"remove"]("b-24h"),t.min=a?0:1,t.max=a?23:12,t.value=a?l:l%12||12,n.value=o.getMinutes(),r.value=o.getSeconds(),i.pressed=!c,s.pressed=c,i.hidden=s.hidden=a,e.isRefreshing=!1}}}_m.initClass(),_m._$name="TimePicker";class jm extends vc{static $name="TimeField";static type="timefield";static alias="time";static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const n=this;return _m.reconfigure(t,e,{owner:n,defaults:{value:n.value,forElement:n[n.pickerAlignElement],owner:n,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onTimeChange({time:e}){n._isUserAction=!0,n.value=e,n._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=Gt.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=Gt.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:n}=e;e.readOnly||(t.value=n,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,n||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=null===(e=this.pickerKeyDownRemover)||void 0===e?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("string"==typeof e?(e=Gt.parse(e,this.format),this.keepDate&&(e=Gt.copyTimeValues(new Date(this.value),e))):e=new Date(e),Gt.isValidDate(e))?this.keepDate?e:Gt.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const n=this,r=n.transformTimeValue(e);if(e&&!r||n.isRequired&&""===e)n.setError("L{invalidTime}");else{if(n.clearError("L{invalidTime}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:n}=this.triggers;n&&e&&(n.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){var n,r;const i=typeof e;return e?("number"===i?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===i&&(e=Gt.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(r=e)&&void 0!==r&&r.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return Gt.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}jm.initClass(),jm._$name="TimeField";const Bm=new Date(2e3,0,1);class Vm extends pc{static $name="DateTimeField";static type="datetimefield";static alias="datetime";static configurable={timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"};doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,n=jm.new({revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;jm.prototype.syncInvalid.apply(this,e),t.timeField&&!n&&t.syncInvalid()}},e);return Zn.on({element:n.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(n.readOnly=!0),n}updateTimeField(e){const t=this;e.ion({change({userAction:e,value:n}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?Gt.copyTimeValues(new Date(e),n||Bm):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,n=(null==e?void 0:e.type)||"datefield",r=ba.resolveType(e.type||"datefield"),i=ba.create(Xt.assign({type:n,revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;r.prototype.syncInvalid.apply(this,e),t.dateField&&!n&&t.syncInvalid()}},e));return Zn.on({element:i.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(i.readOnly=!0),i.ion({keydown:({event:e})=>{var t;"Tab"===e.key&&!e.shiftKey&&null!==(t=this.timeField)&&void 0!==t&&t.isVisible&&(e.stopPropagation(),e.cancelBubble=!0)}}),i}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.ion({change({userAction:e,value:n}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value=n,t.value=n,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t;return"number"==typeof e?e:(null===(t=this.dateField)||void 0===t?void 0:t.weekStartDay)??Gt.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:n,timeField:r}=t,i=n.highlightExternalChange,s=r.highlightExternalChange;e||t.highlightExternalChange||(e=!0),t.$isInternalChange=!0,n.highlightExternalChange=!1,n.highlightExternalChange=i,e&&(r.highlightExternalChange=n.highlightExternalChange=!1),r.value=n.value=t.inputValue,n.highlightExternalChange=i,r.highlightExternalChange=s,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if("Enter"===e.key||"Tab"===e.key){const e=t.dateField.value;t._isUserAction=!0,t.value=e?Gt.copyTimeValues(new Date(e),t.timeField.value||Bm):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;"Tab"!==e.key||e.shiftKey?"Enter"===e.key&&(t.value=t.dateField.value):(e.stopPropagation(),e.preventDefault(),t.timeField.focus())}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!Gt.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((n=>n.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((n=>n.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}}Vm.initClass(),Vm._$name="DateTimeField";class Hm extends fc{static $name="DurationField";static type="durationfield";static alias="duration";static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return"string"==typeof e?new us(e):e}changeMax(e){return"string"==typeof e?new us(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e.length>0&&!e.includes(this.defaultUnit)&&(this.defaultUnit=e[0]),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||this.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?Xt.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,n=t.value,r=t._lastValue;t.hasChanged(r,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,n,r;return this.syncInputFieldValue(!0),null===(t=this.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(r=n.clickRepeater)||void 0===r||r.cancel(),super.onFocusOut(e)}set value(e){const t=this;let n,r;if(t.getConfig("allowedUnits"),t.clearError("L{invalidUnit}"),"number"==typeof e||"string"==typeof e&&e.length>0&&!isNaN(e))n=Number(e),r=t.unitWithDefault;else if("string"==typeof e)if(/^\s*$/.test(e))n=null;else{const i=Gt.parseDuration(e,t.allowDecimals,t.unitWithDefault);i&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(i.unit)?(r=i.unit,n=i.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,n=e.magnitude):(r=null,n=null);t._magnitude===n&&t._unit==r||(t._magnitude=n,r&&(t._unit=r),super.value=t.calcValue())}okMax(e){return"number"==typeof e&&(e=new us({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}okMin(e){return"number"==typeof e&&(e=new us({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return t._unit&&null!=t._magnitude||!t.clearable?new us(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}Hm.initClass(),Hm._$name="DurationField";class Nm extends Sa{static $name="Fit";static type="fit";static configurable={containerCls:"b-fit-container",itemCls:"b-fit-item"}}Nm.initClass(),Nm._$name="Fit";class zm extends Fa{static $name="Editor";static type="editor";static configurable={positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0};afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),Zn.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),Xe.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}render(e){const t=this.element.parentNode,[n]=this.getRenderContext(this,e);n.classList.add("b-editing"),super.render(...arguments),null!=t&&t.classList&&n!==t&&t.classList.remove("b-editing")}async startEdit(e){const t=this;if(e=Xt.assignIf(e,{align:t.align,hideTarget:t.hideTarget,matchSize:t.matchSize,matchFont:t.matchFont,fitTargetContent:t.fitTargetContent,focus:!0}),!1!==t.trigger("beforeStart",e)){var n,r,s;const{target:o,hideTarget:a,matchSize:l,matchFont:c,fitTargetContent:d,record:u,field:h=t.inputField.name,focus:g}=e,{inputField:m}=t,{input:p}=m,f=Br.getStyleValue(o,"font-size"),v=Br.getStyleValue(o,"font-family");let{value:y,align:b}=e;if(u&&h&&(t.record=u,t.dataField=h,y===i&&(y=u.getValue(h))),l&&(o instanceof HTMLElement&&t.updateSize(o,l),o instanceof HTMLElement&&Fo.addResizeListener(o,t.onTargetSizeChange)),p&&(c?(p.style.fontSize=f,p.style.fontFamily=v):p.style.fontSize=p.style.fontFamily=""),t.assigningValues=!0,null===(n=m.clearError)||void 0===n||n.call(m),"setValue"in m?await m.setValue(y):m.value=y,t.assigningValues=!1,"string"==typeof b&&(b={align:b}),await t.showBy({target:o,allowTargetOut:!0,...b}),d){const e=p.scrollWidth-p.clientWidth;e>0&&(t.width+=e+Br.scrollBarWidth)}g&&(null===(r=m.focus)||void 0===r||r.call(m)),o.nodeType===Element.ELEMENT_NODE&&a&&o.classList.add("b-hide-visibility"),t.editing=!0;const C=m.value;return t.trigger("start",{value:C}),Array.isArray(C)&&m.editingRecords&&null!==(s=C[0])&&void 0!==s&&s.isModel?t.oldValue=C.map((e=>e.copy(e.id))):(t.oldValue=C,Array.isArray(t.oldValue)&&(t.oldValue=t.oldValue.slice())),m.initialValue=t.oldValue,!0}return!1}async refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:n}=this;if(e&&t){const r=e.getValue(t);Xt.isEqual(n.value,r)||await n.setValue(r)}}}finishEdit(){const{target:e,aligningToElement:t}=this.lastAlignSpec;t&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var t;const n=this;switch(e.key){case n.completeKey:n.completeEdit(null,e),e.stopImmediatePropagation();break;case n.cancelKey:n.cancelEdit(e),e.stopImmediatePropagation()}null===(t=n.trigger)||void 0===t||t.call(n,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing)switch(t.blurAction){case"cancel":t.cancelEdit(e);break;case"complete":t.completeEdit(null,e)}}async completeEdit(e,t){const n=this,{inputField:r,oldValue:i,record:s}=n,o=r.invalidAction||(!1===r.allowInvalid?"block":n.invalidAction),{value:a}=r;if(n.isVisible){if(r.isValid||"allow"===o){if(Xt.isEqual(a,i))return!1!==n.cancelEdit(t);{const t={inputField:r,record:s,value:a,oldValue:i};if(!1!==n.trigger("beforeComplete",t)){var l;if(!e)e=t.finalize||(null===(l=t.editorContext)||void 0===l?void 0:l.finalize);if(e){let s=await e(t);if(!0===s)n.onEditComplete();else{if(r.setError){const e=s||r.invalidValueError,t=()=>{n(),r.clearError(e)},n=r.ion({change:t,input:t});r.setError(e)}var c;if("block"===o)null===(c=r.focus)||void 0===c||c.call(r);else"revert"===o&&(await r.setValue(i),s=!0);s=!1}return s}return n.onEditComplete(),!0}var d;null===(d=r.focus)||void 0===d||d.call(r)}}else{var u;if("block"===o)return null===(u=r.focus)||void 0===u||u.call(r),!1;if("revert"===o)return!1!==n.cancelEdit(t)}return!1}}cancelEdit(e){const t=this,{inputField:n,oldValue:r}=t,{value:i}=n;if(!t.editing||t.isFinishing||!1===t.trigger("beforeCancel",{value:i,oldValue:r,event:e}))return!1;var s;null===(s=n.clearError)||void 0===s||s.call(n),t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:i,oldValue:r,event:e}),t.finishEdit(),t.isFinishing=!1}onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:i}=e,{value:s}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e=`set${$.capitalize(n)}`;t[e]?t[e](s):t.setValue(n,s)}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||ba.fromElement(this.element.parentNode)}changeInputField(e,t){const n=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof ba||(e=ba.create(e),n.createdInputField=!0),n.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:n}),e.parent=n,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,n){t&&n&&this.updateSize(e)}updateSize(e,t=this.lastMatchSize){const n=this,r=wn.inner(e);n.width=!1===t.width?"auto":r.width-n.align.offset[0],n.height=!1===t.height?"auto":r.height,n.lastMatchSize=t}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),Fo.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}zm.initClass(),zm._$name="Editor";const Wm={number:!0,boolean:!0,string:!0,date:!0,duration:!0,time:!0,auto:!0},Um={number:!0,boolean:!0,string:!0},Gm=e=>{var t;return"duration"===(null==e||null===(t=e.column)||void 0===t?void 0:t.type)},Ym="b-fieldfilterpicker",qm={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},Km={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0,timefield:!0},Xm={value:"empty",text:"L{isEmpty}",argCount:0},Zm={value:"notEmpty",text:"L{isNotEmpty}",argCount:0},Jm={value:"=",text:"L{equals}"},Qm={value:"!=",text:"L{doesNotEqual}"},ep={value:">",text:"L{isGreaterThan}"},tp={value:"<",text:"L{isLessThan}"},np={value:">=",text:"L{isGreaterThanOrEqualTo}"},rp={value:"<=",text:"L{isLessThanOrEqualTo}"},ip={value:"between",text:"L{isBetween}",argCount:2},sp={value:"notBetween",text:"L{isNotBetween}",argCount:2},op={value:"isIncludedIn",text:"L{isOneOf}",isArrayValued:!0},ap={value:"isNotIncludedIn",text:"L{isNotOneOf}",isArrayValued:!0};class lp extends Fa{static $name="FieldFilterPicker";static type="fieldfilterpicker";static operators={empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}};static defaultOperators={string:[Xm,Zm,Jm,Qm,{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},op,ap],number:[Xm,Zm,Jm,Qm,ep,tp,np,rp,ip,sp,op,ap],date:[Xm,Zm,Jm,Qm,{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},ip,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},op,ap],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[Xm,Zm,Jm,Qm,ep,tp,np,rp,ip,sp,op,ap],time:[Xm,Zm,Jm,Qm,ep,tp,np,rp,ip,sp,op,ap],relation:[Xm,Zm,Jm,Qm,op,ap],auto:[{value:"*",text:"L{contains}"}]};static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",relation:"L{selectValue}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}",time:"L{selectATime}",auto:"L{enterAValue}"}}static configurable={fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,triggerChangeOnInput:!0,items:{inputs:{type:"container",layout:"hbox",cls:`${Ym}-inputs`,items:{propertyPicker:{type:"combo",items:{},cls:`${Ym}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}",highlightExternalChange:!1},operatorPicker:{type:"combo",items:{},cls:`${Ym}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}",highlightExternalChange:!1},valueFields:{type:"container",cls:`${Ym}-values`,items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`${Ym}-case-sensitive`}},operators:lp.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null};static buildOperatorArgCountLookup=e=>H.keyBy(Object.entries(e),(([e])=>e),(([,e])=>H.keyBy(e,(({value:e})=>e),(({argCount:e})=>e===i?1:e))));afterConstruct(){const e=this;if(!e._fields)throw new Error(`${lp.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${lp.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:n,caseSensitive:r}}=e;t.ion({select:"onPropertySelect",thisObj:e}),n.ion({select:"onOperatorSelect",thisObj:e}),r.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&n.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,n.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:n}=this.widgetMap;return[e,t,...this.valueFields,n]}updateDisabled(e){this.allChildInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){const{propertyPicker:t,operatorPicker:n}=this.widgetMap;this.allChildInputs.forEach((t=>t.readOnly=e)),t.readOnly=t.readOnly||e,n.readOnly=n.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e??lp.defaultOperators;return Object.keys(t).reduce(((e,n)=>({...e,[n]:t[n].map((e=>({...e,text:this.L(e.text)})))})),{})}changeFields(e){let t=e;return Array.isArray(e)&&(_.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=H.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null===(e=this._filter)||void 0===e?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new Tn(`${Ym}-property`,null===(e=this.propertyFieldConfig)||void 0===e?void 0:e.cls,{[`${Ym}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new Tn(`${Ym}-operator`,null===(e=this.operatorFieldConfig)||void 0===e?void 0:e.cls,{[`${Ym}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:n,_filter:{operator:r},onValueChange:i,filterValues:s,isMultiSelectValueField:o,operatorArgCount:a,getValueFieldConfig:l,fieldIsRelation:c,triggerChangeOnInput:d}=e,u=Xt.merge({},lp.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!n||!r||0===a)return[];let h={type:"textfield",internalListeners:{change:i,input:d?i:null,thisObj:e},bubbleEvents:{keydown:!0},cls:t,dataset:{type:n},placeholder:e.L(u[o?"list":c?"relation":n]),highlightExternalChange:!1};return o||c?h={...h,type:"combo",multiSelect:o,createOnUnmatched:!0,items:e.getUniqueDataValues(s),value:s??[]}:["number","date","boolean","duration","time"].includes(n)&&(h.type=`${n}field`),l&&(h=e.callback(l,e,[e.filter,h])),o?[h]:H.populate(a,(t=>[{type:"widget",tag:"div",cls:`${Ym}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},{...h,value:s[t]}])).flat().slice(1)}getUniqueDataValues(e=[]){var t;const n=this,{fieldType:r}=n;if(!n.store||null===(t=n._filter)||void 0===t||!t.property)return[];const{relatedDisplayField:i}=n.selectedField;let s,o;if(n.fieldIsRelation){const{foreignStore:e}=n.currentPropertyRelationConfig;i?(s=e.allRecords.reduce(((e,t)=>(null!=t.id&&e.push({text:t.getValue(i),value:t.id}),e)),[]),o=s.sort(((e,t)=>n.sortStrings(e.text,t.text)))):s=e.allRecords.map((e=>e.id))}else s=n.store.allRecords.map((e=>e.getValue(n._filter.property)));if(!o){s.push(...e);const t=H.unique(s.reduce(((e,t)=>(null!=t&&""!==String(t).trim()&&("date"===r?e.push(t.valueOf()):"duration"===r?e.push(t.toString()):e.push(t)),e)),[]));o="string"===r?t.sort(n.sortStrings):"duration"===r?t.map((e=>new us(e))).filter((e=>e.isValid)).sort(n.sortDurations):t.sort(n.sortNumerics),"date"===r?o=o.map((e=>{const t=new Date(e);return{text:Gt.format(t,n.dateFormat),value:e}})):"duration"===r&&(o=o.map((e=>e.toString())))}return o}sortStrings(e,t){return(e??"").localeCompare(t??"")}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return null===(e=this.selectedField)||void 0===e?void 0:e.type}get selectedField(){var e,t;return null===(e=this.fields)||void 0===e?void 0:e[null===(t=this._filter)||void 0===t?void 0:t.property]}get propertyOptions(){return Object.entries(this.fields??{}).filter((([,e])=>Wm[e.type]||Gm(e))).map((([e,{title:t}])=>({value:e,text:t??e}))).sort(((e,t)=>e.text.localeCompare(t.text)))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return Boolean(this.currentPropertyRelationConfig)}get currentPropertyRelationConfig(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.modelRelations)||void 0===t?void 0:t.find((({foreignKey:e})=>{var t;return e===(null===(t=this._filter)||void 0===t?void 0:t.property)}))}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=lp.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;null===(t=this._store)||void 0===t||t.un(this),null==e||e.ion({refresh:"onStoreRefresh",thisObj:this}),this.inferFieldTypes()}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFields:t}=e.widgetMap,{fieldType:n,operatorArgCount:r,_filter:{property:s,operator:o}}=e,a=qm[o];t.element.className=new Tn({[`${Ym}-values`]:!0,[`${Ym}-values-multiple`]:a,[`${Ym}-values-${n}`]:n!==i,"b-hidden":s==i||o==i||0===r}),t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const n=this,{fieldType:r,operatorArgCount:i,isMultiSelectValueField:s}=n,o=null===(e=n._filter)||void 0===e?void 0:e.operator,{caseSensitive:a}=n.widgetMap;a.hidden="string"!==r||!o||s||0===i,a.checked=!1!==(null===(t=n._filter)||void 0===t?void 0:t.caseSensitive)}onPropertySelect(e){var t;const n=this,{_filter:r}=n;r.property=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.fieldType!==n._fieldType&&(r.operator=null,r.value=null),n._fieldType=r.type=n.fieldType,n.refreshOperatorPicker(),n.refreshValueFields(),n.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const n=this,r=n.isMultiSelectValueField,i=this.operatorArgCount;n._filter.operator=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.operatorArgCount!==i&&(n._filter.value=null),n.isMultiSelectValueField&&!r&&(n._filter.value=[]),n.refreshValueFields(),n.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const{isMultiSelectValueField:e,fieldType:t,_filter:n}=this,r=this.valueFields.map((e=>e.value));e&&"date"===t?n.value=r[0].map((e=>new Date(e))):e&&"duration"===t?n.value=r[0].map((e=>new us(e))):("date"===t&&"between"===n.operator&&Gt.isValidDate(r[1])&&r[1].setHours(23,59,59,999),n.value=1===r.length?r[0]:r),this.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:n},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=null===n}populateUIFromFilter(e=!1){const t=this,{filterValues:n,widgetMap:{propertyPicker:r,operatorPicker:i},_filter:{property:s,operator:o,disabled:a},propertyOptions:l,operatorOptions:c,isMultiSelectValueField:d}=t;r.items=l,i.items=c,i.hidden=null===s;let u=e;r.value!==s&&(r.value=s,t.refreshOperatorPicker(),u=!0),i.value!==o&&(null!==o&&i.items.find((({value:e})=>e===o))?i.value=o:i.clear(),u=!0),o||1!==i.items.length||(i.value=t._filter.operator=i.items[0].value),u&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach(((e,r)=>{d&&(e.value.length>0||n.length>0)?"date"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.valueOf())):"duration"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.toString())):e.value=n:r>=n.length?e.clear():e.value=n[r]})),t.allChildInputs.forEach((e=>e.disabled=t.disabled||a))}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll((e=>e.owner===this.widgetMap.valueFields&&Km[e.type])))}get filterValues(){var e;return null==(null===(e=this._filter)||void 0===e?void 0:e.value)?[]:H.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,n=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(n)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:n}=this;return e&&t?n[e][t]:1}get isValid(){const{filter:e,fieldType:t,filterValues:n,isMultiSelectValueField:r,operatorArgCount:i}=this,{operator:s}=e,o=i>0&&null==(null==e?void 0:e.value);return t&&s&&!o&&(r&&n.length>0||n.length===i)&&n.every((e=>null!=e&&("duration"!==t||e.isValid)))}focus(){var e;null===(e=this.valueFields.find((e=>e.isEmptyInput))??this.operatorPicker??this.propertyPicker)||void 0===e||e.focus()}inferFieldTypes(){if(this.store&&this.fields)for(const[e,t]of Object.entries(this.fields))"auto"===t.type&&(t.type=lp.inferFieldType(this.store,e))}static inferFieldType(e,t){var n;const r=null===(n=e.find((e=>null!=e.getValue(t)),!0))||void 0===n?void 0:n.getValue(t);if(r!==i){const e=typeof r;if("object"===e&&r instanceof Date)return"date";if(Um[e])return e}return"auto"}}lp.initClass(),lp._$name="FieldFilterPicker";class cp extends ba{static $name="Label";static type="label";static configurable={text:null,localizableProperties:["text"]};compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}cp.initClass(),cp._$name="Label";class dp extends Fa{static $name="FieldFilterPickerGroup";static type="fieldfilterpickergroup";static addFilterButtonDefaultText="L{FieldFilterPickerGroup.addFilter}";static configurable={filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,triggerChangeOnInput:!0,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:dp.addFilterButtonDefaultText,cls:`b-${dp.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"};static childPickerType="fieldfilterpicker";afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}updateFields(e){this.widgetMap.pickers.childItems.forEach((t=>t.fields=e))}updateFilters(e,t){const n=this;t&&t.filter((t=>!e.find((e=>e.id===t.id)))).forEach((e=>{var t;return null===(t=n.store)||void 0===t?void 0:t.removeFilter(e.id)})),e.forEach((e=>e.id=e.id||n.nextFilterId)),n.widgetMap.pickers.items=(null==e?void 0:e.map((e=>n.getPickerRowConfig(e))))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter((e=>this.callback(t,this,[e]))):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach((({widgetMap:{filterPicker:{filter:t,isValid:n}}})=>{e.removeFilter(t.id,!0),n&&e.addFilter(t,!0)})),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach((t=>t.store=e))}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e??dp.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach((t=>{var n;const r=e.canManage(t),{property:i,operator:s,id:o}=t;r&&i&&s&&(null===(n=e.filters)||void 0===n||!n.find((e=>e.id===o)))&&e.appendFilter(t)}))}canManage(e){const t=this;return!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e])}getFilterPickerConfig(e){const t=this,{fields:n,store:r,disabled:s,readOnly:o,valueFieldCls:a,operators:l,limitToProperty:c,dateFormat:d,getFieldFilterPickerConfig:u,triggerChangeOnInput:h}=t;return{type:t.constructor.childPickerType,fields:n??t.getFieldsFromStore(r),filter:e,store:r,disabled:s,readOnly:o,propertyLocked:Boolean(c),valueFieldCls:a,operators:l,dateFormat:d,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,triggerChangeOnInput:h,...u?t.callback(u,t,[e]):i}}getFieldsFromStore(e){var t;return Object.fromEntries((null===(t=e.modelClass)||void 0===t?void 0:t.fields.map((({name:e,type:t})=>[e,{type:t}])))??[])}getPickerRowConfig(e){const t=this,{disabled:n,readOnly:r,canDeleteFilter:i}=t,s=!(i&&!1===t.callback(i,t,[e]));return{type:"container",layout:"box",cls:{[`b-${dp.type}-row`]:!0,[`b-${dp.type}-row-removable`]:s},dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:n,readOnly:r,checked:!Boolean(e.disabled),internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${dp.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:n,readOnly:r,hidden:!s,cls:`b-transparent b-${dp.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((t=>e.includes(t.type)))}updateDisabled(e){this.allInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){this.allInputs.forEach((t=>t.readOnly=e))}onFilterActiveChange({source:e,checked:t}){const n=this,r=n.getFilterIndex(e),i=n.filters[r],s=n.getFilterPicker(r);i.disabled=!t,s.onFilterChange(),n.store&&s.isValid&&n.store.addFilter(i,!0),n.updateStoreFilter(),n.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:n}){const r=this,{store:i}=r,s=r.getFilterIndex(e);i&&(i.removeFilter(t.id,!0),n&&i.addFilter(t,!0),r.updateStoreFilter()),Object.assign(r.filters[s],t),r.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,n=t.getFilterIndex(e),r=t.filters[n],i=t.getPickerRow(n),s=t.query((e=>e.isFocusable&&"container"!==e.type&&!i.contains(e)));s&&s.focus(),t.removeFilterAt(n),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:n=null}={}){const r=this,{filters:i}=r,s={property:r.limitToProperty||e,operator:t,value:n,disabled:!1,id:r.nextFilterId,caseSensitive:!1};if(r.trigger("beforeAddFilter",{filter:s})){var o;if(r.appendFilter(s),r.getFilterPicker(i.length-1).isValid)null===(o=r.store)||void 0===o||o.addFilter(s,!0),r.store&&r.updateStoreFilter();r.trigger("add",{filter:s}),r.triggerChange()}}appendFilter(e){const t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:n}=e,r=n.values.reduce(((e,t)=>({...e,[t.id]:t})),{});for(let e=t.filters.length-1;e>=0;e--){const n=t.filters[e],s=r[n.id],o=t.getPickerRow(e);if(o){const{filterPicker:r,activeCheckbox:a}=o.widgetMap;if(!s&&r.isValid)t.removeFilterAt(e);else if(s!==i){const{operator:e,value:t,property:i,disabled:o,caseSensitive:l}=s;n!==s&&Object.assign(n,{operator:e,value:t,property:i,disabled:o,caseSensitive:l}),r.filter=n,r.onFilterChange(),a.checked=!o}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:n}=this;t.remove(t.childItems[e]),n.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,null===(e=this.store)||void 0===e||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,t=e.filter(((e,t)=>this.getPickerRow(t).widgetMap.filterPicker.isValid));this.trigger("change",{filters:e,validFilters:t})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:n,store:r}=t;n.forEach(((n,i)=>{if(e===n.disabled){const{filterPicker:s,activeCheckbox:o}=t.getPickerRow(i).widgetMap;n.disabled=!e,s.onFilterChange(),o.checked=e,e&&r&&s.isValid&&r.addFilter(n,!0)}})),t.updateStoreFilter()}focus(){const{length:e}=this._filters;var t;e>0&&(null===(t=this.getPickerRow(e-1))||void 0===t||t.widgetMap.filterPicker.focus())}}dp.initClass(),dp._$name="FieldFilterPickerGroup";class up extends(rc.mixin(cc)){static $name="FieldSet";static type="fieldset";static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:n,hasLabel:r,title:i}=this;return delete e.html,t["b-inline"]=n,t["b-fieldset-has-label"]=r,i&&(e.children={legendElement:{tag:"legend",text:i,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:n,labelWidth:r}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":t?{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[n]:n},style:{width:Br.unitize("width",r)[1]}}:null}}}syncInlineInternal(){this.inlineInternal=this.inline??(null!=this.label&&"before"===this.labelPosition)}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget((t=>{t.disabled=e}),!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}}up.initClass(),up._$name="FieldSet";class hp extends pc{static $name="FileField";static type="filefield";static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}hp.initClass(),hp._$name="FileField";class gp extends Fa{static $name="FilePicker";static type="filepicker";static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.ion({click:t.onButtonClick,thisObj:t}),t.fileField.ion({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new lc({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const t=this,n=e.files;return!(!n||!n.length)&&(t.html=`${Array.from(n).map((e=>e.name)).join("<br>")}`,!0)}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}}gp.initClass(),gp._$name="FilePicker";class mp extends fc{static $name="FilterField";static type="filterfield";static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,ignoreParentReadOnly:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:n,filterFunction:r}=this;if(t){const i=`${n||this.id}-Filter`;if(0===e.length)t.removeFilter(i);else{let s;r?s=t=>r(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>{var r;return null===(r=t.getValue(n))||void 0===r?void 0:r.match(new RegExp(e,"i"))}),t.filter({id:i,filterBy:s})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}}mp.initClass(),mp._$name="FilterField";const pp=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];o.isWindows&&pp.reverse();class fp extends ic{static $name="MessageDialog";static type="messagedialog";static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:pp}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return ba.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:n=" ",cancelButton:r,okButton:i,rootElement:s=document.body}){const o=this;return o.rootElement=s,o.getConfig("lazyItems"),o.title=o.optionalL(n),o.widgetMap.message.html=o.optionalL(t),o.showClass=`b-messagedialog-${e}`,i&&(i="string"==typeof i?{text:i}:i),r&&(r="string"==typeof r?{text:r}:r),i=Object.assign({},o.widgetMap.okButton.initialConfig,i),r=Object.assign({},o.widgetMap.cancelButton.initialConfig,r),i.text=o.optionalL(i.text),r.text=o.optionalL(r.text),ba.reconfigure(o.widgetMap.okButton,i),ba.reconfigure(o.widgetMap.cancelButton,r),o.show(),o.promise=new Promise((e=>{o.resolve=e}))}show(){const e=Br.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:fp.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:n}=this.element;t&&n.remove(t),e&&n.add(e)}doResolve(e){const t=this,{resolve:n}=t;if(n){const r="b-messagedialog-prompt"===t.showClass;if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key?(e.stopImmediatePropagation(),this.onCancelClick()):"Enter"!==e.key||e.target.closest(".b-button")||(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(vp.okButton)}onCancelClick(){this.doResolve(vp.cancelButton)}}fp.initClass();const vp=new Proxy({},{get(e,t){const n=e.instance||(e.instance=new fp({rootElement:document.body})),r=n[t];return"function"==typeof r?r.bind(n):r}});class yp extends Gl{static $name="PagingToolbar";static type="pagingtoolbar";static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this;t.detachListeners("store"),t._store=e,e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:n}=e.widgetMap;let r=0,i=0,s=0,o=0,a=0;if(e.store){const{store:t}=e,{pageSize:n,currentPage:l}=t;r=t.count,i=t.lastPage,a=t.allCount,s=Math.max(0,(l-1)*n+1),o=Math.min(a,s+n-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),n.html=r?e.L("L{summaryTemplate}")({start:s,end:o,allCount:a}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:n}=e,{count:r,lastPage:i,currentPage:s}=n,{pageNumber:o,pageCount:a,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),o.value=s,o.max=i,h.disabled=o.disabled=a.disabled=!r,l.disabled=c.disabled=s<=1||!r,d.disabled=u.disabled=s>=i||!r,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}yp.initClass(),yp._$name="PagingToolbar";const{dockIsHorz:bp}=pl.maps,Cp={top:0,down:0,left:1,bottom:2,up:2,right:3},Sp={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}};class Dp extends(pl.mixin(mi)){static $name="PanelCollapserOverlay";static type="overlay";static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;null===(e=this.collapsible)||void 0===e||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={recollapse:e}}beforeCollapse(e){if(!1===super.beforeCollapse(e))return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var n;null===(n=this.panel)||void 0===n||n.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:n,innerElement:r}=t,{animation:i}=e,{collapseTool:s,panel:o}=t;t.configuredWidth=o._lastWidth,t.configuredHeight=o._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),null==s||s.element.classList.add("b-collapsed"),i&&(o.element.classList.add("b-collapsing"),i.element=r,i.transform=Sp[n],e.animation=za.run(i))}onComplete(e){var t,n;super.onComplete(e);const r=this,{panel:i}=r,{element:s}=i;r.autoCloseLeaveDetacher=null===(t=r.autoCloseLeaveDetacher)||void 0===t?void 0:t.call(r),r.autoCloseClickDetacher=null===(n=r.autoCloseClickDetacher)||void 0===n?void 0:n.call(r),r.doAutoClose.cancel(),"reveal"===e&&r.autoClose&&(i.containsFocus&&(r.autoCloseLeaveDetacher=Zn.on({element:s,mouseenter:e=>{r.doAutoClose.cancel()},mouseleave:e=>{r.doAutoClose()}})),r.autoCloseClickDetacher=Zn.on({element:document.body,thisObj:i,mousedown:e=>{var t;i.owns(e)||null!==(t=r.revealer)&&void 0!==t&&t.contains(e.target)||null==r.autoCloseDelay||r.doAutoClose.now()}}))}expandBegin(e){const t=this,{animation:n}=e,{collapseDir:r,collapseTool:i,innerElement:s,panel:o}=t,{element:a}=o;a.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),null==i||i.element.classList.remove("b-collapsed"),n&&(a.classList.add("b-collapsed","b-expanding"),n.element=s,n.transform={from:Sp[r].to,to:Sp[r].from},e.animation=za.run(n))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const{direction:e}=this,t=super.toolsConfig,n=this.recollapseTool;return n?{...t,recollapse:n&&Xt.assign({direction:e.toLowerCase()},n)}:t}lockInnerSize(e=!0){const t=this,{panel:n}=t,r=e&&n.rectangle(),i=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(i[Cp[t.collapseDir]]=`-${r[t.collapseDim]+10}px`),n.element.style.clipPath=e?`inset(${i.join(" ")})`:"",s}onOverlayTransitionDone(e){const t=this,{panel:n}=t;e.srcElement===n.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(n.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}toggleReveal(e){const{panel:t}=this,{element:n}=t;t.collapsed&&(this.revealer=Br.getActiveElement(n),null==e&&(e=!t.revealed),t.revealed!==e&&!1!==t.trigger("beforeToggleReveal",{reveal:e})&&(!e&&n.contains(this.revealer)&&t.revertFocus(!0),this.revealing=!0,t.revealed=e))}updateRevealing(e){const t=this,{panel:n}=t,r=/left|right/i.test(t.collapseDir)?"height":"width";n&&(t.innerElement.style[r]="0px",t.innerElement.style[`min-${r}`]="100%",n.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,t){var n;const r=this,{collapseDir:i,panel:s}=r,{expandedHeaderDock:o,header:a,uiClassList:l}=s,c=null===(n=s.tools)||void 0===n?void 0:n.recollapse,[d,u]=r.splitHeaderItems({as:"element",dock:r.collapseDock}),h=bp[o],g=s.hasHeader?s.title||(null==a?void 0:a.title)||" ":null;return c&&(c.direction=i),["overlayElement",{class:{...l,[`b-panel-overlay-header-${o}`]:1,[`b-panel-overlay-${i}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:e=>r.onOverlayTransitionDone(e),transitioncancel:e=>r.onOverlayTransitionDone(e)},children:{overlayHeaderElement:g&&{tag:"header",class:new Tn({...l,[`b-dock-${o}`]:1,"b-panel-header":1,"b-panel-overlay-header":1},null==a?void 0:a.cls),children:[...d,{reference:"overlayTitleElement",html:g,class:{...l,[`b-align-${(null==a?void 0:a.titleAlign)||"start"}`]:1,"b-header-title":1}},...u]},[e]:t}}]}}Dp.initClass(),Dp._$name="PanelCollapserOverlay";class wp extends pc{static $name="PasswordField";static type="passwordfield";static alias="password";construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}}wp.initClass(),wp._$name="PasswordField";class Ep extends vu{static $name="Radio";static type="radio";static alias="radiobutton";static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:i}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){!1!==super.internalOnClick(e)&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}}Ep.initClass(),Ep._$name="Radio";class xp extends up{static $name="RadioGroup";static type="radiogroup";static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter((t=>t.name===e))}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter((e=>e.input.checked))[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach((t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1}))}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&Xt.isDeeplyEqual(t,e)))return e}convertOption(e,t,n){const r=this,{name:i}=r,s={name:i,type:"radio",value:e===r.value,ref:`${r.refPrefix}${e}`,checkedValue:e};return"string"==typeof t?s.text=t:Xt.assign(s,t),n?ba.reconfigure(n,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:t}=e;t.checked&&this.clearable&&null==t.clearable&&(t.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const t=this,{lastValue:n}=t;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}}onRadioItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:n}=e,r=e.existingOptions.reduce(((e,t)=>(e[t.ref.substring(n.length)]=t,e)),{});let i,s,o=0;if(t)for(i in t)s=e.convertOption(i,t[i],r[i]),delete r[i],e.insert(s,o++);const a=Object.values(r);null!=a&&a.length&&(e.remove(a),a.forEach((e=>e.destroy())))}}xp.initClass(),xp._$name="RadioGroup";const Rp={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class Tp extends ba{static $name="Slider";static type="slider";static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value"}}compose(){const{id:e,min:t,max:n,showValue:r,step:i,text:s,value:o,unit:a="",disabled:l}=this,c=`${e}-input`,d=Boolean(s||r);return{class:{"b-has-label":d,"b-text":d,"b-disabled":l},children:{input:{tag:"input",type:"range",id:c,reference:"input",[l?"disabled":""]:l,min:t,max:n,step:i,value:o,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:c,html:r?s?`${s} (${o}${a})`:o+a:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&Rp[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;e.readOnly?e.input.value=e.value:(e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e))}onInternalMouseOver(){var e;const t=this,n=t.rtl?100-t.percentProgress:t.percentProgress;null===(e=t.tooltip)||void 0===e||e.showBy({target:wn.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(n)}`})}onInternalMouseOut(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){return e&&(e.owner=this),this.showTooltip?lc.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+(this.unit??"")}}):null}changeValue(e){const{min:t,step:n}=this;return(e=Math.min(Math.max(e,t),this.max))>t?t+Xt.roundTo(e-t,n):Xt.roundTo(e,n)}updateValue(e){const t=this,{input:n,_tooltip:r}=t;r&&(r.html=t.value+(t.unit??"")),n&&n.value!==String(e)&&(n.value=e,t.triggerChange(!1)),t.updateUI()}updateUI(){var e,t;const n=this;(null===(e=n._tooltip)||void 0===e?void 0:e.isVisible)&&(null===(t=n._tooltip)||void 0===t||t.alignTo({target:wn.from(n.input).inflate(n.thumbSize/2,-n.thumbSize/2),align:`b-t${Math.round(n.percentProgress)}`}))}}Tp.initClass(),Tp._$name="Slider";class Mp extends vu{static $name="SlideToggle";static type="slidetoggle";static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e.checked&&(e.cls=Tn.from(e.cls)||{},e.cls[this.constructor.properties.toggledCls]=1),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}Mp.initClass(),Mp._$name="SlideToggle";const kp=["b-horizontal","b-vertical"],Ip=e=>"flex"===Br.getStyleValue(e.parentElement,"display")&&(parseInt(Br.getStyleValue(e,"flex-basis"),10)||parseInt(Br.getStyleValue(e,"flex-grow"),10)),Ap={horizontal:!1,vertical:!0};class Fp extends ba{static $name="Splitter";static type="splitter";static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;null===(e=this.mouseDetacher)||void 0===e||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:{pointerdown:"onMouseDown",mouseenter:"syncState",...!o.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(e=!0){let t,{element:n}=this;for(;!t&&(n=n[(e?"next":"previous")+"ElementSibling"]);)n.isConnected&&!Br.isVisible(n)||(t=n);return t}get nextWidget(){let e,{element:t}=this;for(;!e&&(t=t.nextElementSibling);)e=ba.fromElement(t,this.element.parentElement);return e}get previousWidget(){let e,{element:t}=this;for(;!e&&(t=t.previousElementSibling);)e=ba.fromElement(t,this.element.parentElement);return e}updateContainerElement(e){var t;const n=this;n.stateDetector=null===(t=n.stateDetector)||void 0===t?void 0:t.disconnect(),e&&(n.stateDetector=new MutationObserver((()=>n.syncState())),n.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,t){this.detachListeners(t),null==e||e.ion({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var t;const n=null===(t=this.element)||void 0===t?void 0:t.classList;null==n||n.add(kp[e?1:0]),null==n||n.remove(kp[e?0:1])}syncState(){const e=this,{element:t,nextWidget:n,previousWidget:r}=e;let i=Ap[e.orientation]??null;if(e.nextNeighbor=n,e.previousNeighbor=r,e.disabled=n&&(n.collapsible&&n.collapsed||n.hidden)||r&&(r.collapsible&&r.collapsed||r.hidden),null!==i&&n&&r)e.containerElement=null;else if(e.containerElement=t.parentElement,e.rendered&&t.offsetParent){const e=Br.getStyleValue(t.parentElement,"flex-direction");if(e)i=!e.startsWith("column");else{const e=t.previousElementSibling,n=t.nextElementSibling;if(!e||!n)return;const r=e.getBoundingClientRect(),s=n.getBoundingClientRect(),o=r.top<s.top?r:s,a=o===s?r:s;i=o.top===a.top}}e.vertical=i}onMouseDown(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);const n=this,{element:r,nextNeighbor:i,previousNeighbor:s}=n,a=s?s.element:n.getSibling(!1),l=i?i.element:n.getSibling(),c=Ip(a),d=Ip(l),u=[];null===(t=n.mouseDetacher)||void 0===t||t.call(n);for(const e of r.parentElement.children)Ip(e)&&e!==r&&u.push({element:e,width:e.offsetWidth,height:e.offsetHeight});n.context={startX:e.pageX,startY:e.pageY,prevWidth:a.offsetWidth,prevHeight:a.offsetHeight,nextWidth:l.offsetWidth,nextHeight:l.offsetHeight,prevHasFlex:c,nextHasFlex:d,flexed:u,prev:a,next:l};const h={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:n};o.supportsPointerEvents||(h.mousemove=h.touchmove="onMouseMove",h.mouseup=h.touchend="onMouseUp"),r.classList.add("b-moving"),n.mouseDetacher=Zn.on(h),n.trigger("splitterMouseDown",{event:e})}onMouseMove(e){const t=this,{context:n,nextWidget:r,previousWidget:i}=t,s=n.prev.style,o=n.next.style,a=(e.pageX-n.startX)*(t.rtl?-1:1),l=e.pageY-n.startY;if(e.preventDefault(),Object.assign(n,{deltaX:a,deltaY:l}),n.started||(n.started=!0,t.trigger("dragStart",{context:n,event:e}),n.flexed.forEach((e=>{e.element.style.flexGrow=t.vertical?e.width:e.height,e.element.style.flexBasis="0"}))),t.vertical){const e=n.prevWidth+a,t=n.nextWidth-a;n.prevHasFlex?s.flexGrow=e:i?i.width=e:s.width=`${e}px`,n.nextHasFlex?o.flexGrow=t:r?r.width=t:o.width=`${t}px`}else{const e=n.prevHeight+l,t=n.nextHeight-l;n.prevHasFlex?s.flexGrow=e:i?i.height=e:s.height=`${e}px`,n.nextHasFlex?o.flexGrow=t:r?r.height=t:o.height=`${t}px`}t.trigger("drag",{context:n,event:e})}onMouseUp(e){var t;const n=this;null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.mouseDetacher=null,n.element.classList.remove("b-moving"),n.context.started&&n.trigger("drop",{context:n.context,event:e}),n.context=null}render(){super.render(...arguments),this.syncState.now(),null===this.vertical&&this.syncState()}}Fp.initClass(),Fp._$name="Splitter";class Pp extends $l{static $name="Tab";static type="tab";static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:t,index:n,isFirst:r,isLast:i}=this;return{tabindex:0,"aria-selected":e,"aria-setsize":this.owner.visibleChildCount,"aria-posinset":n+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":r,"b-tab-last":i,...t},dataset:{index:n}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var n,r;const i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls,i.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),null===(n=i.itemChangeDetacher)||void 0===n||n.call(i),i.itemChangeDetacher=e&&Me.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null===(r=i.itemHideDetacher)||void 0===r||r.call(i),i.itemHideDetacher=null==e?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}updateItemCls(e,t){const{element:n}=this,r=n&&Tn.from(null==n?void 0:n.classList,!0);n&&(r.remove(t).add(e),n.className=r.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:n}=e;let{_minWidth:r,_minHeight:i,_maxWidth:s,_maxHeight:o}=e;if(n){const{tabMinWidth:a,tabMaxWidth:l}=n;null!=a&&(t?(r===a&&(r=null),i=a):(i===a&&(i=null),r=a)),null!=l&&(t?(s===l&&(s=null),o=l):(o===l&&(o=null),s=l)),e.minWidth=r,e.minHeight=i,e.maxWidth=s,e.maxHeight=o}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:n}=this;this.hidden=t,t&&e===n.activeItem&&n.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:n}=this;this.disabled=t,e===n.activeItem&&n.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}}Pp.initClass(),Pp._$name="Tab";const Op=e=>e.isTab;class Lp extends Gl{static $name="TabBar";static type="tabbar";static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Op)}get tabs(){return H.from(this._items,Op)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Op)}onChildAdd(e){super.onChildAdd(e),null==e.index&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,n=e.length;t<n;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===n-1}tabAt(e){return this._items.find(Op,e)||null}}Lp.initClass(),Lp._$name="TabBar";const $p=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class _p extends Sa{static $name="Card";static type="card";static configurable={containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null};onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:n,owner:r}=t,i=null!=r.activeIndex?r.activeIndex:t.activeIndex||0,s=r.items.indexOf(e),o=null!=n?e===n:s===i;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),o?(t._activeIndex=s,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const t=this;t._activeItem===e&&t.activateSiblingOf(e),t._activeIndex=t.owner.items.indexOf(t._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,n=t.items.slice(),r=n.indexOf(e);n.splice(r,1),this.activeIndex=Math.min(r,n.length-1)}setActiveItem(e,t=this.activeIndex,n){const r=this,{owner:i}=r,{items:s}=i,o=e instanceof ba,a=s[t],l=i.items[e=o?s.indexOf(e):parseInt(e,10)],c=!1!==(null==n?void 0:n.animation),d=!(null!=n&&n.silent),u={prevActiveIndex:t,prevActiveItem:a};if(l&&!l.$isActivating&&l!==a){var h;const s=a&&a.element,o=l&&l.element;if(r.animateDetacher){const e=r.animateDetacher.event;if(e.activeItem===l)return e.promise;r.animateDetacher(),e.prevActiveItem.element.classList.remove(...$p),e.activeItem.element.classList.remove(...$p),r.animateDetacher=null}if(u.activeIndex=e,u.activeItem=l,d&&!1===i.trigger("beforeActiveItemChange",u))return null;const g=r._activeIndex!==u.activeIndex;g&&(r._activeIndex=u.activeIndex),d&&(null===(h=i.onBeginActiveItemChange)||void 0===h||h.call(i,u)),g&&(r._activeIndex=u.prevActiveIndex),c&&s&&i.isVisible&&r.animateCardChange?u.promise=r.cardChangeAnimation=new Promise(((c,h)=>{const g=a.monitorResize;a.monitorResize=!1,r.contentElement.style.overflowX="hidden",a._hidden=!0,l.$isActivating=!0,l.show(),l.$isActivating=!1,s.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),o.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),i.isAnimating=!0,r.animateDetacher=Zn.onTransitionEnd({mode:"animation",element:o,thisObj:a,handler(){i.isAnimating=r.cardChangeAnimation=!1,r.animateDetacher?(r.animateDetacher=null,o.classList.remove(...$p),s&&(s.classList.remove(...$p),a.$isDeactivating=!0,a._hidden=!1,a.hide(),a.monitorResize=g,a.$isDeactivating=!1),r.contentElement.style.overflowX="",r.onActiveItemChange(u,c,!d)):r.setActiveItem(e,t,n)}}),r.animateDetacher.reject=h,r.animateDetacher.event=u})):(l.$isActivating=!0,l.show(),l.focus(),l.$isActivating=!1,a&&(a.$isDeactivating=!0,a.hide(),a.$isDeactivating=!1),r.onActiveItemChange(u,null,!d))}return u}onActiveItemChange(e,t,n){const r=this;r._activeItem=e.activeItem,r._activeIndex=e.activeIndex,!n&&r.owner.trigger("activeItemChange",e),r.owner.containsFocus&&e.activeItem.focus(),null==t||t(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return Boolean(this.animateDetacher)}}_p.initClass(),_p._$name="Card";const jp=e=>e.maximized;class Bp extends rc{static $name="TabPanel";static type="tabpanel";static alias="tabs";static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:n,tabBar:r}=this;return n.indexOf(null===(e=r.tabs[t])||void 0===e?void 0:e.item)}get bodyConfig(){return Xt.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==t||null===(e=t.tab)||void 0===e?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:n}=e,{activeIndex:r}=n,{tabs:i}=e.tabBar,s=t>=0&&t<i.length&&e.items.indexOf(i[t].item);if(i.length>0&&(!1===s||s<0))throw new Error(`Invalid activeTab ${t} (${i.length} tabs)`);s!==r&&n.setActiveItem(s,r,{animation:!1,silent:!0}),n.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:n}=t,r=t.makeTabConfig(e),i=r&&(null==n?void 0:n.firstTab),s=i&&n._items,o=i&&H.from(t._items,(t=>t.tab||t===e)),a=i?o.indexOf(e)+s.indexOf(i):0;r&&n&&(i&&null==e.weight&&a<s.count-1?n.insert(r,a):n.add(r))}}onChildRemove(e){const{tab:t}=e,{items:n}=this;t&&(this.tabBar.remove(t),t.destroy()),e===this.activeItem&&(this._activeTab=null,n.length&&(this.activeTab=n[Math.min(this.activeIndex,n.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,n=null==t?void 0:t[e];return n&&(n.disabled||n.hidden)}findAvailableTab(e,t=1){const{tabs:n}=this.tabBar,r=n.length,i=Math.max(0,n.indexOf(e.tab));let s;i&&(t=-t);for(let e=1;e<=r&&(s=(i+(t<0?r:0)+e*t)%r,this.isDisabledOrHiddenTab(s));++e);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const n=this,{tabBar:r,layout:i}=n,{tabCount:s}=r;if(e.isWidget||Xt.isObject(e)?(-1===n.items.indexOf(e)&&(e=n.add(e)),e=r.indexOfTab(e.tab)):e=parseInt(e,10),!n.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(n.isDisabledOrHiddenTab(e)&&(e=n.findAvailableTab(e)),!i.animateCardChange||!i.cardChangeAnimation)return e;i.cardChangeAnimation.then((r=>{(null==r?void 0:r.activeIndex)!==e&&(n._activeTab=e,n.updateActiveTab(e,t))}))}async updateActiveTab(e,t){if(!this.initialItems){const{activeTabItemIndex:e,layout:r}=this;if(e>-1){const i=this.items[t],s=this.items[e];var n;if(r.activeItem!==s)r.animateCardChange&&await this.tabSelectionPromise,null!=i&&i.containsFocus&&i.tab.focus(),this.tabSelectionPromise=null===(n=r.setActiveItem(s))||void 0===n?void 0:n.promise}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,n={item:e,type:"tab",tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:Xt.isObject(t)?Pp.mergeConfigs(n,t):n}updateItems(e,t){const n=this,{activeTab:r,initialItems:i}=n;let s,o=0;super.updateItems(e,t),i&&(s=Array.from(e,(e=>n.makeTabConfig(e))).filter((e=>{if(e)return e.index=o++,!0})),o&&(s[0].isFirst=!0,s[o-1].isLast=!0,s[r].active=!0,n.tabBar.add(s),n.activeTab=r))}updateTabMinWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.minWidth=e)}))}updateTabMaxWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.maxWidth=e)}))}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&An.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:n,element:r}=e,{animateCardChange:i}=t;if(t.animateCardChange=!1,e.height=null,!e.up(jp)){const t=e.height=Math.max(...e.items.map((t=>(e.activeTab=t,r.clientHeight))))+1;e.flex=`1 1 ${t}px`}e.activeTab=n,t.animateCardChange=i,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:n,prevActiveItem:r}=e;this.activeTab=t.indexOf(null==n?void 0:n.tab),null!=r&&r.tab&&(r.tab.active=!1),null!=n&&n.tab&&(n.tab.active=!0,n.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onInternalPaint(){super.onInternalPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}}Bp.initClass(),Bp._$name="TabPanel";class Vp extends pc{static $name="TextAreaField";static type="textareafield";static alias="textarea";static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}}Vp.initClass(),Vp._$name="TextAreaField";class Hp extends vc{static $name="TextAreaPickerField";static type="textareapickerfield";static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){"boolean"==typeof e.inline&&_.deprecate("Core","6.0.0","TextAreaPickerField.inline config is no longer supported"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return null!==(e=this._picker)&&void 0!==e&&e.isVisible?this.input:this.displayElement}get needsInputSync(){return this.displayElement[this.inputValueAttr]!==String(this.inputValue??"")}showPicker(){const e=this,{picker:t}=e;e.inline||(t.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,n=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=n,r}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}changePicker(e,t){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width);if(e=Hp.reconfigure(t,e?p.merge({owner:r,forElement:r[r.pickerAlignElement],align:{matchSize:null==i,anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},id:r.id+"-input",style:{resize:r.resize},html:r.value??""},e):null,r)){const t=r.input=e.element;r.inputListenerRemover=Zn.on({element:t,thisObj:r,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}Hp.initClass(),Hp._$name="TextAreaPickerField";const Np=[],zp=e=>"*"!==e[0],Wp=(e,t)=>{const n=e[t]||null;return delete e[t],n},Up=e=>e.responsiveRoot,Gp={number:e=>({width:t})=>t<=e&&e},Yp=e=>(delete e.once,{callback:Wp(e,"callback"),configs:e,when:Wp(e,"when")}),qp=(e,...t)=>{const n=t.flatMap((e=>(null==e?void 0:e.once)||Np)),r=e.mergeConfigs(...t),i=Yp(r);return i.once=n.length?Yp(e.mergeConfigs(...n)):null,i};const Kp="http://www.w3.org/2000/svg",Xp={bar:1,outline:2,text:3},Zp=(e,t)=>parseInt(e.order,10)-parseInt(t.order,10),Jp=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),Qp=e=>e.field,ef=()=>!1,tf=/\s+/;class nf extends ba{static type="histogram";static $name="Histogram";static get configurable(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Kp,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Kp,tag:"g",reference:"scaledSvgGroup"},{ns:Kp,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass:(e,t,n,r)=>"",getOutlineClass:(e,t)=>"",getBarTip(e,t,n,r){},getBarText:(e,t,n)=>"",getRectConfig:null,getBarTextRenderData:(e,t,n,r)=>e,getBarTextTip(e,t,n,r){}}}static properties={refreshSuspended:0};construct(e){const t=this;super.construct(e),t.scheduleRefresh=t.createOnFrame(t.refresh,[],t,!0),t.refresh()}set tip(e){var t;const n=this;null===(t=n.tip)||void 0===t||t.destroy(),n._tip=e?lc.new({owner:n,forElement:n.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}updateSeries(e){const t=this,n=t._series={};let r=0,i=0;for(const t in e)if(!1!==e[t]){const s=n[t]=p.merge({},e[t]);s.field||(s.field=t),s.type||(s.type="bar"),"order"in s||(s.order=10*Xp[s.type]+r),"index"in s||(s.index=r),"bar"===s.type&&(s.index=i++),s.id=t,r++}!t.topValue&&t._data&&(t.topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}getDataTopValue(e,t){const n=Object.values(t||this.series).map(Qp);let r,i=0;for(let t=0,{length:s}=e;t<s;t++){r=e[t];for(let e=0,{length:t}=n;e<t;e++)i=Math.max(i,r[n[e]])}return i}updateData(e){const t=this;t._data=e,!t.topValue&&t._data&&t._series&&(t.topValue=t.getDataTopValue(e)),t.refreshSuspended||t.scheduleRefresh()}updateTopValue(e){const t=this;t._topValue=e,!e&&t._data&&(t._topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}scheduleRefresh(){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(){this.refreshSuspended&&this.refreshSuspended--}refresh(e){const t=this,{series:n,_tip:r,topValue:i,singleTextForAllBars:s}=t,o=(null==e?void 0:e.args)||[],a=[],l=[];if(n){for(const e of Object.values(n).sort(Zp)){const n=t[`draw${$.capitalize(e.type)}`](e,...o);Array.isArray(n)?a.push.apply(a,n):a.push(n),s||"bar"!==e.type||l.push(...t.drawText(e,...o))}a.sort(Jp),s?l.push(...t.drawText(null,...o)):l.sort(Jp),To.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:i},children:[{ns:Kp,tag:"g",reference:"scaledSvgGroup",children:a},{ns:Kp,tag:"g",reference:"unscaledSvgGroup",children:l}]},configEquality:ef,targetElement:t.svgElement}),r&&r.isVisible&&t.onBeforeTipShow({source:r})}}drawBar(e,...t){const n=this,{topValue:r,data:s,omitZeroHeightBars:o,barStyle:a}=n,{field:l,order:c,stretch:d}=e,{length:u}=s,h=1/u,g=[],m=$.createId(e.id),p=e.index,f=d?1:i;let v;for(let i=0,d=0,{length:u}=s;i<u;i++,d+=v){const u=s[i];let y=u.rectConfig={ns:Kp,tag:"rect",dataset:{}};const b=u[l],C=b?f||u.height||(b>r?r:b)/r:0,S=1-C,D=n.callback("getBarTip",n,[e,y,u,i,...t]);v=u.width||h,a?y.style=a:delete y.style,Object.assign(y.dataset,{index:i,order:c,series:m});const w={[`b-series-${m}`]:1,[`b-series-index-${p}`]:1},E=n.callback("getRectClass",n,[e,y,u,i,...t]);E&&E.split(tf).forEach((e=>w[e]=1)),Object.assign(y,{x:d,y:S,width:v,height:C,class:w}),D?y.dataset.btip=D:delete y.dataset.btip,n.getRectConfig&&(y=n.getRectConfig(y,u,i,e,...t)),!y||!y.height&&o||g.push(y)}return g}changeGetRectConfig(e){return e?this.bindCallback(e):null}drawOutline(e,...t){const n=this,{topValue:r,data:i}=n,{field:s,order:o,id:a}=e,l=1/i.length,c=["M 0,1"],d={ns:Kp,tag:"path",dataset:{order:o,id:a}};let u,h="M",g="L";for(let e=0,t=0,{length:n}=i;e<n;e++){const n=1-i[e][s]/r;u=i[e].width||l,c.push(`${h} ${t},${n} ${g} ${t+=u},${n}`),h=g=""}return d.class=`b-series-${e.id} b-series-index-${e.index} `+n.callback("getOutlineClass",n,[e,i,...t]),d.d=c.join(" "),d}drawText(e,...t){const n=this,{data:r}=n,s=1/r.length,o=[];for(let a,l=0,c=0,{length:d}=r;l<d;l++,c+=a){a=r[l].width||s;const d=n.callback("getBarText",n,[r[l],l,e,...t]);if(d){const s=n.callback("getBarTextRenderData",n,[{ns:Kp,tag:"text",className:"b-bar-legend",html:d,left:c,width:a,x:100*(c+a/2)+"%",y:r[l].y!==i?r[l].y:"100%",dataset:{index:l,series:e}},r[l],l,e,...t]),u=n.callback("getBarTextTip",n,[s,r[l],l,e,...t]);u?s.dataset.btip=u:delete s.dataset.btip,o.push(s)}}return o}}nf.initClass(),nf._$name="Histogram";const rf="http://www.w3.org/2000/svg";class sf extends ba{static $name="Scale";static type="scale";static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:rf,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:rf,tag:"g",reference:"scaledSvgGroup",children:[{ns:rf,tag:"path",reference:"pathElement"}]},{ns:rf,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){var e;if(!this.scalePoints)return;const t=this,{horizontal:n,width:r,height:i,align:s,scalePoints:o,scaleMaxPadding:a}=t,l=null===(e=o[o.length-1])||void 0===e?void 0:e.value,c=[],d=[],u=1/(l+a*l);t.scaledSvgGroup.setAttribute("transform",`scale(${n?r:1} ${n?1:i})`);for(const e of o){const t=Boolean(e.text),o=u*e.value;if(t){const t={ns:rf,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};n?(t.x=100*o+"%",t.y="top"===s?"1.6em":i-12):(t.x="left"===s?"12":""+(r-12),t.y=100*(1-o)+"%"),d.push(t)}n?"top"===s?c.push(`M${o},0 L${o},${t?10:5}`):c.push(`M${o},${i} L${o},${i-(t?10:5)}`):"left"===s?c.push(`M0,${1-o} L${t?10:5},${1-o}`):c.push(`M${r},${1-o} L${r-(t?10:5)},${1-o}`)}t.pathElement.setAttribute("d",c.join("")),To.syncChildren({domConfig:{children:d}},t.unscaledSvgGroup)}}sf.initClass(),sf._$name="Scale";class of extends ye{static $name="AvatarRendering";static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),super.doDestroy()}updateElement(e){Zn.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return lc.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar(e){if(Array.isArray(e))return e.map((e=>this.getResourceAvatar(e)));const{initials:t,color:n,iconCls:r,imageUrl:s,defaultImageUrl:o,dataset:a={},resourceRecord:l,alt:c=$.encodeHtml(null==l?void 0:l.name)}=e,d=this.getImageConfig(t,n,s,o,a,c)||this.getIconConfig(r,a)||this.getResourceInitialsConfig(t,n,a),{size:u}=this;return Object.assign(d.style,{...u?{height:u,width:u}:i}),d}getImageConfig(e,t,n,r,i,s){if(n=of.failedUrls.has(n)?r:n||r)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:s,elementData:{defaultImageUrl:r,imageUrl:n,initials:e,color:t,dataset:i},src:n,dataset:i}}getIconConfig(e,t){if(e)return e&&{tag:"i",style:{},class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,n){const r=Br.isNamedColor(t)&&t,s=!r&&t,{size:o}=this;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${r}`]:r},style:{backgroundColor:s||null,...o?{height:o,width:o}:i},children:[e],dataset:n}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:n,color:r,imageUrl:i,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const t=Br.createElement(this.getResourceInitialsConfig(n,r,s));t.elementData=e.elementData,e.parentElement.replaceChild(t,e)}of.failedUrls.add(i)}}of._$name="AvatarRendering",n&&!n.bryntum&&(n.bryntum={});class af extends td{static type="number";static fieldType="number";static fields=["format","min","max","step","largeStep","unit"];static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:t,max:n,min:r,step:i,largeStep:s,align:o}=this;return Xt.cleanupProperties({type:"numberfield",format:e,name:t,max:n,min:r,step:i,largeStep:s,textAlign:o})}get formatter(){const e=this,{format:t}=e;let n=e._formatter;return n&&e._lastFormat===t||(e._formatter=n=bg.get(e._lastFormat=t)),n}formatValue(e){return null!=e&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),e??""}defaultRenderer({value:e}){return this.formatValue(e)}}id.registerColumnType(af,!0),af.exposeProperties(),af._$name="NumberColumn";class lf extends af{static type="aggregate";static fields=["function","includeParentInChangeSet"];static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,t){const n=this;n.configuredAlign="align"in e,n.configuredEditor="editor"in e,super.construct(...arguments);const{grid:r}=t;"sum"===n.function&&(n.function="sumChildren"),r&&(n.store=r.store)}set store(e){const t=this,n={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(n),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.ion(n)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let t=0;for(let n=0,{length:r}=e;n<r;n++)t+=parseFloat(e[n]||0,10);return t}avg(...e){let t=0;const{length:n}=e;for(let r=0;r<n;r++)t+=parseFloat(e[r]||0,10);return t/n}onRecordUpdate({record:e,changes:t}){const n=this,{rowManager:r}=n.grid;n.field in t&&e.isLeaf&&e.bubble((e=>{const t=r.getRowFor(e);if(t){const e=t.getCell(n.field);e&&t.renderCell(e)}}),!0)}getRawValue(e){var t;let n;const r=this,{field:i}=r;if(null!==(t=e.children)&&void 0!==t&&t.length){const t=r.function,s="string"==typeof t&&"function"==typeof Math[t],{handler:o,thisObj:a}=s?{handler:Math[t],thisObj:Math}:r.resolveCallback(t);n=o.apply(a,e.children.map((e=>r.getRawValue(e)))),r.includeParentInChangeSet?e.set(i,n,!0):e.setData(i,n)}else n=e.getValue(i);return n}canFillValue(){return!1}}id.registerColumnType(lf,!0),lf.exposeProperties(),lf._$name="AggregateColumn";class cf extends td{static $name="WidgetColumn";static type="widget";static fields=["widgets"];static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,t){const n=this;n.widgetMap={},super.construct(...arguments),n.renderer!==n.internalRenderer&&(n.externalRenderer=n.renderer,n.renderer=n.internalRenderer)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const n=this,{cellElement:r,column:i,record:s,isExport:o}=e,{widgets:a}=i;!o&&a&&(r.widgets||n.clearCell(r),r.widgets=e.widgets=a.map(((t,o)=>{var a,l;let c,d;if(r.widgets&&(c=r.widgets[o],d=c.element.nextElementSibling,t.recreate&&c&&(delete n.widgetMap[c.id],c.destroy(),r.widgets[o]=null)),c||(n.onBeforeWidgetCreate(t,e),t.recomposeAsync=!1,t.owner=n.grid,c=_d.append(t,d?{insertBefore:d}:r)[0],n.widgetMap[c.id]=c,n.onAfterWidgetCreate(c,e),c.name&&c.ion({change:({value:e,userAction:t})=>{t&&c.cellInfo.record.setValue(c.name,e)}})),c.cellInfo={record:s,column:i},n.grid&&!n.meta.isSelectionColumn&&(c.readOnly=n.grid.readOnly||s.readOnly),!1!==(null===(a=n.onBeforeWidgetSetValue)||void 0===a?void 0:a.call(n,c,e))){const n=t.valueProperty||"value"in c&&"value"||c.defaultBindProperty;if(n){const t=c.name?s.getValue(c.name):e.value;c[n]=t}}return null===(l=n.onAfterWidgetSetValue)||void 0===l||l.call(n,c,e),c})));const l=null===(t=n.externalRenderer)||void 0===t?void 0:t.call(n,e);return o||l||a?l:""}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}id.registerColumnType(cf),cf.exposeProperties(),cf._$name="WidgetColumn";class df extends cf{static $name="CheckColumn";static type="check";static fields=["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"];static defaults={align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]};construct(e,t){super.construct(...arguments);const n=this;if(Object.assign(n,{externalHeaderRenderer:n.headerRenderer,externalOnBeforeWidgetSetValue:n.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:n.onAfterWidgetSetValue,onBeforeWidgetSetValue:n.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:n.internalOnAfterWidgetSetValue,headerRenderer:n.internalHeaderRenderer}),!n.meta.isSelectionColumn){var r;const e=null===(r=n.grid)||void 0===r?void 0:r.store.modelClass;n.field?!e||e.fieldMap[n.field]||n.constructor.suppressNoModelFieldWarning||(console.warn(n.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),e.addField({name:n.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;null===(e=this.headerCheckbox)||void 0===e||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let n;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new vu({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):n=t.headerText,n=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):n,t.showCheckAll?i:n}updateCheckAllState(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:n}=t.grid;n.beginBatch(),n.forEach((n=>t.updateRecord(n,t.field,e))),n.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:n,cellElement:r}){const i=super.internalRenderer(...arguments);return t?null!=i?i:null==e?"":e:(n.readOnly&&!this.meta.isSelectionColumn&&(r.widgets[0].readOnly=!0),e?r.widgets[0].input.setAttribute("checked",!0):r.widgets[0].input.removeAttribute("checked"),i)}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,null===(t=this.externalOnBeforeWidgetSetValue)||void 0===t||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:n}){const r=this,{grid:i}=r,{record:s}=e.cellInfo;return!(n&&r.field&&(!i.features.cellEdit||i.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!i.isSelectable(s)&&t)&&(r.isInitialSet?void 0:r.trigger("beforeToggle",{record:s,checked:t}))}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const n=this,{record:r}=e.cellInfo,{field:i}=n;i&&(n.updateRecord(r,i,t),t?n.updateCheckAllState(n.grid.store.every((e=>e[i]),null,!0)):n.updateCheckAllState(!1)),n.trigger("toggle",{record:r,checked:t,checkbox:e})}}updateRecord(e,t,n){e.setValue(t,n)}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const n=t.widget;null==n||n.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}id.registerColumnType(df,!0),df._$name="CheckColumn";class uf extends td{static $name="ColorColumn";static type="color";static fields=[{name:"colorEditorType",defaultValue:"colorpicker"},"colors",{name:"addNoColorItem",defaultValue:!0}];static defaults={align:"center",editor:null};construct(){var e;super.construct(...arguments);const t=this,{grid:n}=t;t.menu=new Wh({owner:n,rootElement:n.rootElement,autoShow:!1,align:"t50-b50",anchor:!0,internalListeners:{hide(){t.picker.navigator.activeItem=null,delete t._editingRecord}},items:[Object.assign({type:t.colorEditorType,ref:"list",addNoColorItem:t.addNoColorItem,colorSelected({color:e}){var n;null===(n=t._editingRecord)||void 0===n||n.set(t.field,e),t.menu.hide()}},null!==(e=t.colors)&&void 0!==e&&e.length?{colors:t.colors}:{})]})}applyValue(e,t,n){if(!this.isConstructing){const{picker:e}=this;"colors"===t?e.colors=n:"addNoColorItem"===t&&(e.addNoColorItem=n)}super.applyValue(...arguments)}get picker(){return this.menu.widgetMap.list}renderer({value:e}){let t="b-empty",n=e;if(e){const r=this.picker.getColorClassName(e);r?(t=r,n=null):t=""}return{className:"b-color-cell-inner "+t,style:{backgroundColor:n},"data-btip":e}}onCellClick({grid:e,record:t,target:n}){if(n.classList.contains("b-color-cell-inner")&&!this.readOnly&&!e.readOnly&&!t.isSpecialRow&&!t.readOnly){const{picker:e,menu:r}=this,i=t.get(this.field);this._editingRecord=t,e.deselectAll(),e.select(i),e.refresh(),r.showBy(n)}}}id.registerColumnType(uf),uf._$name="ColorColumn";class hf extends td{static $name="DateColumn";static type="date";static fieldType="date";static fields=["format","pickerFormat","step","min","max"];static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=Gt.parse(e,this.format||i)),Gt.format(e,this.format||i)}set format(e){const{editor:t}=this.data;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:t,max:n,step:r,format:i}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:i,max:n,min:t,step:r}}}id.registerColumnType(hf,!0),hf.exposeProperties(),hf._$name="DateColumn";class gf extends af{static type="percent";static fieldType="number";static fields=["showValue","lowThreshold"];static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:({sum:e})=>`${e}%`,fitMode:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return{className:"b-percent-bar-outer",role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e=e||0,"aria-label":e+"%",tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===e,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:i]}]}}resizeToFitContent(){}}gf.sum="average",id.registerColumnType(gf,!0),gf._$name="PercentColumn";class mf extends af{static $name="RatingColumn";static type="rating";static fieldType="number";static fields=["emptyIcon","filledIcon","editable"];static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:H.populate(this.max,(t=>{const n=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":n,"b-empty":!n,[n?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:n,target:r,event:i}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===n.getValue(t.field)&&0===e&&(e=-1),n.set(t.field,e+1)}}}id.registerColumnType(mf,!0),mf.exposeProperties(),mf._$name="RatingColumn";class pf extends td{static type="template";static fields=["template"];static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:this.field})}}id.registerColumnType(pf,!0),pf.exposeProperties(),pf._$name="TemplateColumn";class ff extends td{static type="time";static fieldType="date";static fields=["format"];static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=Gt.parse(e,this.format)),Gt.format(e,this.format)}set format(e){const{editor:t}=this;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}id.registerColumnType(ff,!0),ff.exposeProperties(),ff._$name="TimeColumn";let vf=!1;class yf extends td{static $name="TreeColumn";static type="tree";static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}constructor(e,t){super(...arguments);const n=this;n.shouldHtmlEncode=n.htmlEncode,n.setData("htmlEncode",!1),n.renderer&&(n.originalRenderer=n.renderer),n.renderer=n.treeRenderer.bind(n)}treeRenderer(e){const t=this,{grid:n,cellElement:r,row:i,record:s,isExport:o}=e,a=s.instanceMeta(n.store),l=!s.isLeaf&&a.collapsed,c={className:"b-tree-cell-value"},d=[c],u={className:{"b-tree-cell-inner":1},tag:s.href?"a":"div",href:s.href,target:s.target,children:d};let h,g,{value:m}=e,p=t;const f=n.isTreeGrouped&&!s.isLeaf&&n.features.treeGroup.parentRenderer;if(t.originalRenderer||f){var v;let i;if(f){var y;if(s.field)p=n.columns.get(s.field),m=p.isWidgetColumn?m:(null===(y=p.renderer||p.defaultRenderer)||void 0===y?void 0:y.call(p,{...e,column:p,value:s.name,isTreeGroup:!0}))??s.name;i=n.features.treeGroup.parentRenderer({field:s.field,value:m,column:p,record:s.firstGroupChild,grid:n})}else i=t.originalRenderer(e);const o=null===(v=n.hasFrameworkRenderer)||void 0===v?void 0:v.call(n,{cellContent:i,renderingColumn:p});h="object"==typeof i&&!o,m=o?"":!1===i?r.innerHTML:i,e.rendererHtml=i}if(h||(m=String(m??"")),o)return m;if(s.isLeaf)r.classList.add("b-tree-leaf-cell"),g=e.iconCls||s.iconCls||t.leafIconCls;else{var b;const i=!s.isExpanded(n.store),o=i?t.expandIconCls:t.collapseIconCls,l=i?t.collapsedFolderIconCls:t.expandedFolderIconCls;r.classList.add("b-tree-parent-cell"),d.unshift({tag:"i",className:{"b-tree-expander":1,[o]:1,"b-empty-parent":!(a.isLoadingChildren||!0===s.children||null!==(b=s.children)&&void 0!==b&&b.length)}}),vf=g=e.iconCls||s.iconCls||l}if(g&&d.splice(d.length-1,0,{tag:"i",className:{"b-tree-icon":1,[g]:1}}),i.isRow&&!s.isLeaf)if(i.setAttribute("aria-expanded",!l),l)i.removeAttribute("aria-owns");else for(const e in n.subGrids){var C,S;const t=i.elements[e];Br.setAttributes(t,{"aria-owns":null!==(C=s.children)&&void 0!==C&&C.length?null===(S=s.children)||void 0===S?void 0:S.map((t=>`${n.id}-${e}-${t.id}`)).join(" "):null})}Array.isArray(m)?c.children=m:h?Object.assign(c,m):p.shouldHtmlEncode||!m.includes("<")?(u.className["b-text-value"]=1,c.text=m):c.html=m;const D=s.childLevel*t.indentSize+(s.isLeaf?vf?2:g?.5:.4:0);return u.style=`padding-inline-start:${D}em`,u}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.renderer=this.originalRenderer,t}}id.registerColumnType(yf,!0),yf.exposeProperties(),yf._$name="TreeColumn";class bf extends(fi.mixin(Dg)){static configurable={copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll"};get clipboardRecords(){return this.clipboardData||[]}cellsToString(e){const t=this;let n=0,r=0,s="";e.sort(((e,t)=>e.rowIndex===t.rowIndex?e.columnIndex-t.columnIndex:e.rowIndex-t.rowIndex));for(const c of e){var o,a;const{record:e,_column:d,rowIndex:u,columnIndex:h}=c;u>n?(s.length>0&&(s+="\n".repeat(u-n)),n=u,r=h):h>r&&(s.length>0&&(s+="\t".repeat(h-r)),r=h);let g=null==d||null===(o=d.toClipboardString)||void 0===o?void 0:o.call(d,c);var l;if(g===i)if(g=e.getValue(d.field),g instanceof Date)g=Gt.format(g,t.dateFormat);else g=null===(l=g)||void 0===l?void 0:l.toString();t.toCopyString&&(g=t.toCopyString({currentValue:g,column:d,record:e})),g=null===(a=g)||void 0===a?void 0:a.replace(/[\n\t]/," "),s+=g||t.emptyValueChar}return s}setFromStringData(e,t=!1,n=this.client.store,r){const i=this,{client:s}=i,{columns:o,_shiftSelectRange:a}=s,l=new Set,c=i.stringAs2dArray(e),d=s.selectedCells[0],u=[],h=[];if(!t&&null!=a&&a.some((e=>e.equals(d)))){const e=i.cellSelectorsAs2dArray(a);if((null==e?void 0:e.length)%c.length==0&&e.columnCount%c.columnCount==0)for(let t=0;t<e.length;t+=c.length)for(let n=0;n<e.columnCount;n+=c.columnCount)u.push(e[t][n])}u.length||u.push(d);for(const e of u)for(let a=0;a<c.length;a++){const d=c[a],u=t?new n.modelClass:n.getAt(e.rowIndex+a);if(u&&!u.readOnly){for(let n=0;n<d.length;n++){const a=r?null:o.visibleColumns[t?n:e.columnIndex+n],l=(null==a?void 0:a.field)||(null==r?void 0:r[n]);let c=d[n];if(l&&c&&(null==a||!a.readOnly)){var g;if(c===i.emptyValueChar&&(c=null),null!=a&&a.fromClipboardString&&(c=a.fromClipboardString({string:c,record:u})),i.toPasteValue&&(c=i.toPasteValue({currentValue:c,record:u,column:a,field:l})),"string"==typeof c&&null!==(g=u.getFieldDefinition(l))&&void 0!==g&&g.isDateDataField){const e=Gt.parse(c,i.dateFormat);isNaN(e.getTime())||(c=e)}u.set(l,c,!1,!1,!1,!0),h.push(s.normalizeCellContext({column:a,record:u}))}}l.add(u)}}return{modifiedRecords:[...l],targetCells:h}}cellSelectorsAs2dArray(e){const t=[];let n,r=null;for(const i of e)i.id!==r&&(r=i.id,n=[],t.push(n)),n.push(i);return t.columnCount=t[0].length,!t.some((e=>e.length!==t.columnCount))&&t}stringAs2dArray(e){const t=[],n=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter((e=>e.length));for(const e of n){const n=e.split("\t");if(t.columnCount&&n.length!==t.columnCount)return!1;t.columnCount=n.length,t.push(n)}return t}}bf._$name="CopyPasteBase";const Cf={cut:1,copy:1,paste:1};class Sf extends bf{static $name="CellCopyPaste";static pluginConfig={chain:["populateCellMenu","afterSelectionModeChange"]};static configurable={useNativeClipboard:!_.isTestEnv,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}"};afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}entityName="cell";set copyOnly(e){this._copyOnly=e}get copyOnly(){var e;return null==this._copyOnly?!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.enabled):Boolean(this._copyOnly)}get canCopy(){var e;const{client:t}=this;return Boolean(!this.disabled&&t.selectedCells.length&&(!t._selectedRows.length||(null===(e=t.features.rowCopyPaste)||void 0===e?void 0:e.disabled)||t.focusedCell&&t.isCellSelected(t.focusedCell)))}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.isEditing)&&!this.client.readOnly}isActionAvailable({actionName:e}){if(Cf[e])return this.canCopy&&("copy"===e||this.canCutPaste)}async cut(){await this.copy(!0)}async copy(e=!1){"boolean"!=typeof e&&(e=!1);const t=this,{selectedCells:n}=t.client,r=e?n.filter((e=>{var t;return!(null!==(t=e.record)&&void 0!==t&&t.readOnly)})):n;if(r){if(e?!t.canCutPaste:!t.canCopy)return;const n=t.cellsToString(r);if(await t.writeToClipboard(n,e,{cells:r}),!0===e)for(const e of r)e.column.readOnly||e.record.set(e.column.field,null);t.client.trigger("copy",{cells:r,copiedDataString:n,isCut:e,entityName:t.entityName})}}async beforeCopy({data:e,isCut:t,cells:n}){return await this.client.trigger("beforeCopy",{cells:n,data:e,isCut:t,entityName:this.entityName})}async paste(){const e=this,{client:t,entityName:n}=e,r=t.selectedCells[0];if(!e.canCutPaste||!r)return;const i=await e.readFromClipboard({},!0);if(!i)return;const{modifiedRecords:s,targetCells:o}=e.setFromStringData(i);1===t.selectedCells.length&&o.length>1&&t.selectCellRange(o[0],o[o.length-1]),t.trigger("paste",{clipboardData:i,targetCell:r,modifiedRecords:[...s],entityName:n})}async beforePaste({data:e}){return await this.client.trigger("beforePaste",{clipboardData:e,targetCell:this.client.selectedCell,entityName:this.entityName})}populateCellMenu({record:e,items:t}){const n=this;n.canCopy&&(t.cutCell={text:n.cutText,localeClass:n,icon:"b-icon b-icon-cut",weight:115,disabled:e.readOnly||!n.canCutPaste,onItem:()=>n.cut()},t.pasteCell={text:n.pasteText,localeClass:n,icon:"b-icon b-icon-paste",weight:120,disabled:e.readOnly||!n.canCutPaste||!1===n.hasClipboardData(),onItem:()=>n.paste()},t.copyCell={text:n.copyText,localeClass:n,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>n.copy()})}}Sf._$name="CellCopyPaste",Ed.registerFeature(Sf);const Df={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},wf={...Df,startEditingFromKeyMap:1,finishAllSelected:1};class Ef extends(mi(fi)){static $name="CellEdit";static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,addToCurrentParent:!1,autoEdit:null,editNextOnEnterPress:!0,editorClass:zm,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditingFromKeyMap","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditingFromKeyMap","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},ignoreCSSSelector:"button,.b-icon,.b-fa,svg",validateTapOut:null}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const n=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:n};n.grid=e,"cellclick"!==n.triggerEvent&&(r[n.triggerEvent]="onTriggerEditEvent"),n.autoEdit&&!("editNextOnEnterPress"in t)&&(n.editNextOnEnterPress=!1),e.ion(r),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:n}),n.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(vp.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await vp.confirm(e),vp.owner=null),t===vp.yesButton}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:n,columnId:r,editor:i}){var s;const o=this,{grid:a,editorClass:l}=o;let c=n.cellEditor,d=0;if(n.editTargetSelector){d=t.querySelector(n.editTargetSelector).offsetLeft}return i.autoSelect=o.autoSelect,null!==(s=c)&&void 0!==s&&s.isEditor||(c=n.data.cellEditor=l.create(l.mergeConfigs({type:l.type,constrainTo:null,cls:"b-cell-editor",inputField:i,blurAction:"none",invalidAction:n.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[d,0]},internalListeners:o.getEditorListeners(),onInternalKeyDown:o.onEditorKeydown.bind(o),allowMouseEvents:i.allowMouseEvents},c))),c.minHeight=a.rowHeight,c.inputField!==i&&(c.remove(c.items[0]),c.add(i)),c.align.offset[0]=d,n.instantUpdate&&!i.cellEditValueSetter&&(Xt.wrapProperty(i,"value",null,(e=>{const{editorContext:t}=o,n=null==t?void 0:t.editor.inputField;null==t||!t.editor.isValid||Xt.isEqual(t.record.getValue(t.column.field),e)||null!=n&&n.isDateField&&!n._isPickerInput||t.record.setValue(t.column.field,e)})),i.cellEditValueSetter=!0),Object.assign(c.element.dataset,{rowId:e,columnId:r,field:n.field}),c.inputField.revertOnEscape=n.revertOnEscape,o.editor=c}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){const t=this,n=t.editorContext=e.cellEditorContext;if(n){var r;const{grid:e}=t;"cellclick"!==t.triggerEvent&&(t.detachListeners("cellClickWhileEditing"),e.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),null===(r=t.removeEditingListeners)||void 0===r||r.call(t),t.removeEditingListeners=An.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onEditorBeforeComplete(e){const{grid:t}=this,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,n=e.cellEditorContext;if(n.value=e.inputField.value,e.dataField.includes(".")){var r;const n=e.dataField.split(".")[0];null!==(r=e.record.constructor.relations)&&void 0!==r&&r[n]&&t.rowManager.refresh()}t.trigger("finishCellEdit",{grid:t,editorContext:n})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:n,grid:r}=this;n||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const{row:t,cell:n}=e.cellEditorContext;null==n||n.classList.remove("b-editing"),null==t||t.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:n}=this,{store:r,columns:i}=n,{visibleColumns:s}=i;let o=e.id,a=i.getAdjacentVisibleLeafColumn(e.columnId,t);for(;o;)if(a){if(a.editor&&a.canEdit(e.record))return{id:o,columnId:a.id};a=i.getAdjacentVisibleLeafColumn(a,t)}else{const n=r.getAdjacent(e.id,t,!1,!0);o=null==n?void 0:n.id,n&&(a=t?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?Xt.clone(this.addNewAtEnd):{},{grid:{store:t,rowManager:n},addToCurrentParent:r}=this;let i;return i=t.tree&&r?t.last.parent.appendChild(e):t.add(e)[0],n.getRowFor(i)||n.displayRecordAtBottom(),i}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:n}=e;if(null!=t&&t.isVisible&&t.editor&&!t.readOnly&&n&&!n.isSpecialRow&&!n.readOnly&&t.canEdit(n)){const r=n?t.getRawValue(n):n;return Object.assign(e,{value:r===i?null:r,editor:t.editor}),e}return!1}startEditingFromKeyMap(){return this.startEditing(this.grid.focusedCell)}async startEditing(e={}){const t=this;if(!t.disabled){var n,r,i;const{grid:s}=t;if(null!==(n=e)&&void 0!==n&&n.fromKeyMap&&(e=t.grid.focusedCell),Xt.isEmpty(e)&&(e.id=s.firstVisibleRow.id),s.store.isTree&&s.features.tree){const t=e.id?s.store.getById(e.id):e.record??s.store.getAt(e.row);if(!t)return!1;await s.expandTo(t)}const o=t.getEditingContext(e);if(!o)return!1;if(t.editorContext&&!1===t.cancelEditing())return!1;if(null!==(r=s.focusedCell)&&void 0!==r&&r.equals(o)||s.focusCell(o),!1===s.trigger("beforeCellEditStart",{grid:s,editorContext:o}))return!1;const a=o.editor=t.getEditorForCell(o),{row:l,cell:c,record:d}=o;return a.inputField.highlightExternalChange=!1,a.cellEditorContext=o,a.render(c),c.classList.add("b-editing"),l.addCls("b-editing"),await a.startEdit({target:c,field:a.inputField.name||o.column.field,value:o.value,record:d})||(c.classList.remove("b-editing"),l.removeCls("b-editing")),null===(i=t.onCellEditStart)||void 0===i||i.call(t),!0}return!1}cancelEditing(e=!1,t){const n=this,{editor:r}=n;if(!n.isEditing)return;e.fromKeyMap&&(t=e,e=!1),n.muteEvents=e;const i=r.cancelEdit(t);var s;(n.muteEvents=!1,!1===i)?r.inputField.focus():(n.finishEditingPromise=!1,null===(s=n.afterCellEdit)||void 0===s||s.call(n));return i}async finishEditing(){const e=this,{editorContext:t,grid:n}=e;let r=!1;if(e.finishEditingPromise)return e.finishEditingPromise;if(t){const{column:s}=t;var i;if(e.finishEditingPromise=t.editor.completeEdit(s.bindCallback(s.finalizeCellEdit)),r=await e.finishEditingPromise,await n.waitForAnimations(),e.finishEditingPromise=null,r)null===(i=e.afterCellEdit)||void 0===i||i.call(e)}return r}async onCellClickWhileEditing({event:e,cellSelector:t}){const n=this;e.target.closest(".b-editor")||(Br.isTouchEvent||e.target.matches(n.ignoreCSSSelector)?await n.finishEditing():n.finishEditingPromise||n.editorContext&&!n.editorContext.editor.owns(e.target)&&(n.getEditingContext(t)?await n.finishEditing()?n.continueEditingOnCellClick&&await n.startEditing(t):(n.grid.focusCell(n.editorContext),n.editor.inputField.focus()):await n.finishEditing()))}async onCellClick({cellSelector:e,target:t,event:n,column:r}){if(r.onCellClick)return;const i=this,{focusedCell:s}=i.client;if(t.closest(".b-tree-expander"))return!1;Br.isTouchEvent&&i._lastCellClicked===(null==s?void 0:s.cell)&&n.timeStamp-i.touchEditDelay>i._lastCellClickedTime?await i.startEditing(e):"cellclick"===this.triggerEvent&&await i.onTriggerEditEvent({cellSelector:e,target:t}),i._lastCellClicked=null==s?void 0:s.cell,i._lastCellClickedTime=n.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(i,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:n}){var r;const{editorContext:i,client:s}=this;t.closest(".b-tree-expander")||Br.isTouchEvent&&"dblclick"===n.type||n&&(null===(r=s.features.cellMenu)||void 0===r?void 0:r.triggerEvent)===n.type||(!i||!i.equals(this.grid.normalizeCellContext(e))&&await this.finishEditing())&&await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:n}=this;null!=n&&n.editor.isVisible&&t===n.record&&n.editor.dataField in e&&n.editor.refreshEdit()}onStoreBeforeSort(){var e;const t=null===(e=this.editorContext)||void 0===e?void 0:e.editor;if(this.isEditing&&(null==t||!t.isFinishing)&&!t.isValid)return this.cancelEditing()}onGridRefreshed(){const e=this,{grid:t,editorContext:n}=e;if(n&&t.isVisible&&t.focusedCell){const r=t.getCell(t.focusedCell),{editor:i}=n;r&&Br.isInView(r)&&!i.isFinishing?(n._cell=r,An.suspendFocusEvents(),i.render(r),i.showBy(r),i.focus(),An.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:e,event:t}){const n=this;if(wf[e]){if(!n.disabled&&!t.target.closest(".b-grid-header"))if(n.isEditing){if("finishAllSelected"===e)return n.multiEdit&&n.gridSelection.length>1;if(Df[e])return!0}else if("startEditingFromKeyMap"===e)return n.grid.focusedCell.cell===t.target;return!1}}async finishAllSelected(){const e=this,{dataField:t,record:n}=e.editor;if(await e.finishEditing()&&!e.isDestroyed){const r=n.getValue(t);for(const i of e.gridSelection)i.isModel?i!==n&&i.setValue(t,r):i.record.set(i.column.field,r)}}async finishAndEditNextRow(e,t=!1){const n=this,{grid:r}=n,{record:i}=n.editorContext;let s;if(await n.finishEditing()){if(n.isDestroyed)return;n.isEditing||(t?s=r.internalNextPrevRow(!1,!0,!1):(n.addNewAtEnd&&i===r.store.last&&await n.doAddNewAtEnd(),n.isDestroyed||(s=r.internalNextPrevRow(!0,!0))),s&&n.editNextOnEnterPress&&!r.touch&&await n.startEditing(s))}}finishAndEditPrevRow(e){return this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const n=this,{grid:r}=n,{focusedCell:i}=r;if(i&&!n.finishEditingPromise){var s,o;const{rowIndex:a,columnIndex:l}=i;let c=n.getAdjacentEditableCell(i,!t);if(!c&&!t&&n.addNewAtEnd){!0===await n.finishEditing()&&await n.doAddNewAtEnd()}let d=!0;if(n.isEditing&&(d=await n.finishEditing()),n.isDestroyed)return;c=n.getAdjacentEditableCell(new Kc({grid:r,rowIndex:a,columnIndex:l}),!t),c?d&&(r.focusCell(c,{animate:n.focusCellAnimationDuration}),await n.startEditing(c)||await n.finishAndEditNextCell(e,t)):!r.isNested||!r.owner||null!==(s=(o=r.owner).catchFocus)&&void 0!==s&&s.call(o,{source:r,navigationDirection:t?"up":"down",editing:!0})||r.onTab(e)}}finishAndEditPrevCell(e){return this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:n}=t,{focusedCell:r}=n;if(e.handled||!t.autoEdit||t.isEditing||!r||r.isActionable||e.ctrlKey)return;const{key:i}=e,s="Delete"===e.key||"Backspace"===e.key,{gridSelection:o}=s?t:{},a=t.multiEdit&&(null==o?void 0:o.length)>1;if((i.length<=1||s&&!a)&&await t.startEditing(r)){const{inputField:n}=t.editor,{input:r}=n;r&&(n.internalOnKeyEvent(e),e.defaultPrevented||(r.value=s?"":i,n.internalOnInput(e))),e.preventDefault()}else if(a&&!1!==n.trigger("beforeCellRangeDelete",{grid:n,gridSelection:o}))for(const e of o)e.isModel?n.columns.visibleColumns.forEach((t=>{!t.readOnly&&e.set(t.field,null)})):e.column.readOnly||e.record.set(e.column.field,null)}onEditorKeydown(e){if(1!==e.key.length&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return e.key.startsWith("Arrow")||"Backspace"!==!e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:n,editor:r,editorContext:s}=t,o=new Kc(e.relatedTarget),a=o.grid===n&&t.getEditingContext(o);s&&!r.isFinishing&&r.owns(e._target)&&("cancel"!==t.blurAction&&n.store.includes(s.record)?t.finishEditingPromise||"cellclick"!==t.triggerEvent&&("cellclick"===t.triggerEvent||a)||await t.finishEditing():t.cancelEditing(i,e))}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this,{target:n}=e;if(!n._shadowRoot&&!t.editor.owns(n)&&(!t.grid.bodyContainer.contains(n)||e.button)){const n=t.resolveCallback(t.validateTapOut,t,!1),r=(null==n?void 0:n.handler.call(n.thisObj,e,t.editorContext))||t.blurAction;t.editingStoppedByTapOutside=!0,"cancel"===r?t.cancelEditing(i,e):await t.finishEditing(),delete t.editingStoppedByTapOutside}}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}}Ef._$name="CellEdit",Ed.registerFeature(Ef,!0);class xf extends Gh{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,event:n}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(t),event:n}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return Xt.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:n}){if(!1===n.cellMenuItems)return!1;e&&!e.isSpecialRow||(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:n}){const{client:r}=this;null!=t&&t.cellMenuItems&&Xt.merge(e,t.cellMenuItems),r.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:n.readOnly,onItem:()=>{var e;((null===(e=r.features.treeGroup)||void 0===e?void 0:e.originalStore)??r.store).remove(r.selectedRecords.filter((e=>!e.readOnly)).map((e=>e.$original)))}})}get showMenu(){return!0}}xf.featureClass="",xf._$name="CellMenu",Ed.registerFeature(xf,!0,["Grid","Scheduler"]),Ed.registerFeature(xf,!1,["Gantt"]);class Rf extends fi{static $name="CellTooltip";static configurable={tooltipRenderer:null};construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=lc.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const t=this.client.getColumnFromElement(e);return!1!==t.tooltipRenderer&&Boolean(t.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:n}){const r=this,i=r.client.getRecordFromElement(t),s=r.client.getColumnFromElement(t),o={cellElement:t,record:i,column:s,event:n,tip:e,cellTooltip:r};let a;return r.forSelector||i!==r.lastRecord||i.generation!==r.lastRecordGeneration||s!==r.lastColumn?(r.lastRecord=i,r.lastRecordGeneration=i.generation,r.lastColumn=s,s.tooltipRenderer?a=s.tooltipRenderer(o):r.tooltipRenderer&&!1!==s.tooltipRenderer&&(a=r.tooltipRenderer(o)),p.isPromise(a)&&(r.lastRecord=r.lastRecordGeneration=r.lastColumn=null),a||e.hide(),a):r.tip._html}}Rf._$name="CellTooltip",Ed.registerFeature(Rf);const Tf="store";class Mf extends(mi(fi)){static $name="ColumnAutoWidth";static configurable={default:null,delay:0};static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:t}=this.client;t&&this.bindStore(t)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.ion({name:Tf,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(Tf)}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if("move"!==e){const e=this,{cellEdit:t}=e.client.features;++e.storeGeneration,null!=t&&t.isEditing&&!t.editingStoppedByTapOutside?e.syncAutoWidthColumns():e.client.refreshSuspended?e.client.rowManager.once("renderDone",(()=>e.syncAutoWidthColumns())):e.setTimeout({fn:"syncAutoWidthColumns",delay:e.delay,cancelOutstanding:!0})}}onInternalResize(e,t,n,r){0===r&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,{client:t,storeGeneration:n}=e;if(!t.splitFrom){if(e.lastSync!==n){let r,i;e.lastSync=n;for(const n of t.columns.visibleColumns)r=n.autoWidth,r&&(!0===r&&(r=e.default),t.resizingColumns=i=!0,n.resizeToFitContent(r));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}}Mf.prototype.storeGeneration=0,Mf._$name="ColumnAutoWidth",Ed.registerFeature(Mf,!0);class kf extends(mi(fi)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:n}){const r=t.columns.getById(n.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridHeaderDrop:e.onDrop,thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),n.forEach((e=>{e.text=e.localeClass.L(e.text);let t=r.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},r.push(t)),t.buttons.push(e)})),t.element=Br.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await Zn.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const n=this;if(e.dragProxy.getBoundingClientRect().top-n.grid.element.getBoundingClientRect().top>100?n.element.classList.add("b-closer"):n.element.classList.remove("b-closer"),n.hoveringButton&&(n.hoveringButton.classList.remove("b-hover"),n.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){n.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),n.hoveringButton=t)}else n.element.classList.remove("b-hover")}onDrop({context:e}){const t=this,{targetElement:n}=e;if(n&&n.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const e=t.buttons.find((e=>e.ref===n.dataset.ref));e&&(n.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),e.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return Cc.tpl`
            <div class="b-columndragtoolbar">
            <div class="b-title"></div>
            ${e.map((e=>Cc.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>Cc.tpl`
                        <div class="b-target-button" data-ref="${e.ref}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}kf.featureClass="b-hascolumndragtoolbar",kf._$name="ColumnDragToolbar",Ed.registerFeature(kf,o.isTouchDevice);class If extends fi{static $name="ColumnPicker";static configurable={groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"};static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:n}=t;let r;if(t.groupByRegion)r=t.grid.regions.map((e=>{const n=t.grid.getSubGrid(e).columns.topColumns;return{text:$.capitalize(e),menu:t.buildColumnMenu(n),disabled:0===n.length,region:e}})),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const i={};e.topColumns.forEach((e=>{e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((e=>{i[e]||(i[e]=1)}))})),r=Object.keys(i).sort().map((e=>({text:$.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:n})=>{t.refreshTagMenu(e,n)}}))),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),n&&r.items.push(...Xt.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:n,store:r}=t,{modelClass:i}=r,{allFields:s}=i,o={};for(let t=0,{length:r}=s;t<r;t++){const r=s[t],i=r.name;n.get(i)||r.internal||(o[i]={text:r.text||$.separate(r.name),checked:!1,onToggle:t=>{const s=n.get(i);s?s[t.checked?"show":"hide"]():n.add(n.generateColumnForField(r,{region:e.forColumn.region})),t.bubbles=!1}})}return o}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const n=e.items.find((e=>e.column===t));n&&(n.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:n}=this,r=e.reduce(((e,r)=>{const i=n.columns.visibleColumns.filter((e=>e.region===r.region));if(!1!==r.hideable){const s={grid:n,column:r,text:r.headerText,checked:!0!==r.hidden,disabled:!0!==r.hidden&&1===i.length,cls:r.region!==t?"b-separator":""};t=r.region,r.children&&!r.isCollapsible&&(s.menu=this.buildColumnMenu(r.children)),e.push(s)}return e}),[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const n=this,{columns:r}=n.grid;n.forColumn=e,!1!==e.showColumnPicker&&r.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:n,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:n.getColumnPickerItems(r),onToggle:n.onColumnToggle,disabled:n.disabled}),!1===e.hideable||e.parent.isCollapsible||(t.hideColumn={text:"L{hideColumn}",localeClass:n,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!e.allowDrag||n.disabled,onItem:()=>e.hide()})}onColumnToggle({menu:e,item:t,checked:n}){if(Boolean(t.column.hidden)!==!n){var r,i;t.column[n?"show":"hide"]();const{grid:s,column:o}=t,{columns:a,features:l}=s,c=e.items,d=a.visibleColumns.filter((e=>e.region===t.column.region)),u=(null===(r=l.headerMenu)||void 0===r?void 0:r.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(1===d.length){const e=c.find((e=>e.column===d[0]));e&&(e.disabled=!0),u&&o.region===t.column.region&&(u.disabled=!0)}else d.forEach((e=>{const t=c.find((t=>t.column===e));t&&(t.disabled=!1)})),u&&o.region===t.column.region&&(u.disabled=!1);null===(i=t.menu)||void 0===i||i.eachWidget((e=>{e.checked=n}));const h=e.owner;h&&h.column===o.parent&&(h.checked=c.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const n=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&n.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:e})=>e.hide()}),t}}If._$name="ColumnPicker",Ed.registerFeature(If,!0);class Af extends fi{static $name="ColumnRename";static configurable={keyMap:{F2:"startEdit"}};doDestroy(){var e;null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:t}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:t.readOnly,onItem:()=>this.startEdit(t)}}startEdit(e){var t;e instanceof Event&&(e=null===(t=this.client.getHeaderDataFromEvent(e))||void 0===t?void 0:t.column);if(e){if(e.readOnly)return!1;const{textWrapper:t}=e;let{editor:n}=this;n||(this.editor=n=new zm({owner:this.client,align:{align:"t0-t0"}})),n.render(t),n.startEdit({target:t,record:e,field:"text"})}}}Af._$name="ColumnRename",Ed.registerFeature(Af,!1);class Ff extends(mi(fi)){static $name="ColumnReorder";ignoreSelectors=[".b-grid-header-resize-handle",".b-field"];static pluginConfig={after:["onInternalPaint","renderContents"]};init(){const e=this,{grid:t}=e,n=t.element,r=Br.children(n,".b-grid-headers");r.push(...Br.children(n,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:t.whenVisible((()=>e.createDragHelper()))}createDragHelper(){const e=this,{grid:t}=e,n=t.element,r=Br.children(n,".b-grid-headers");return r.push(...Br.children(n,".b-grid-header-children")),e.dragHelper=new Hc({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,dropTargetSelector:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Jc.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable(n){if(Boolean(n.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const r=n.closest(this.targetSelector),i=r&&t.columns.getById(r.dataset.columnId),s=0===(null==i?void 0:i.childLevel)&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onAbort,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),e.dragHelper}doDestroy(){var e,t;null===(e=this.dragHelper)||void 0===e||e.scrollManager.destroy(),null===(t=this.dragHelper)||void 0===t||t.destroy(),super.doDestroy()}get grid(){return this.client}onBeforeDragStart({context:e,event:t}){const n=this,{element:r}=e,i=e.column=n.client.columns.getById(r.dataset.columnId);return n.dragHelper.autoSizeClonedTarget=!n.usingGroupBarWidget,i.allowDrag&&n.client.trigger("beforeColumnDragStart",{column:i,event:t})}onDragStart({context:e,event:t}){const n=this,{grid:r,usingGroupBarWidget:i}=n,{column:s,dragProxy:o}=e;if(!r.features.columnDragToolbar&&!i){const e=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();n.dragHelper.minY=e.top,n.dragHelper.maxY=e.bottom}r.element.classList.add("b-dragging-header"),i&&o.classList.add("b-grid-reordering-columns-with-groupbar"),r.features.filterBar&&r.features.filterBar.compactMode&&o.classList.add("b-filter-bar-compact"),o.style.fontSize=Br.getStyleValue(e.element,"fontSize"),r.trigger("columnDragStart",{column:s,event:t})}onDrag({context:e,event:t}){const n=this.client,{column:r,insertBefore:i}=e,s=n.columns.getById(null==i?void 0:i.dataset.columnId),o=ba.fromElement(t.target,"gridheader");null!=o&&o.subGrid.sealedColumns&&(e.valid=!1),n.trigger("columnDrag",{column:r,insertBefore:s,event:t,context:e})}onDrop({context:e,event:t}){var n;if(!e.valid)return this.onInvalidDrop({context:e,event:t});const{grid:r}=this,{column:i}=e,s=e.dragging,o=e.target.closest(".b-grid-header"),a=null===(n=e.draggedTo)||void 0===n?void 0:n.dataset.region,l=a||o;let c,d,u,h,g;if(r.element.classList.remove("b-dragging-header"),l){const t=o?r.columns.get(o.dataset.column):r.subGrids[a].columns.last,n=e.insertBefore;if(h=a||t.region,g=i.parent,u=n?r.columns.getById(n.dataset.columnId):r.subGrids[h].columns.last.nextSibling,u)d=u.parent;else{const e=null==o?void 0:o.parentElement.closest(".b-grid-header");d=e?r.columns.getById(e.dataset.columnId):r.columns.rootNode}c=h===i.region&&g===d&&(t===i.previousSibling||u===i.nextSibling),s.remove()}c=c||!1===r.trigger("beforeColumnDropFinalize",{column:i,newParent:d,insertBefore:u,event:t,region:h}),!c&&l&&(c=!d.insertChild(i,u)),e.valid=!c,!c&&l&&(i.region=h,0===g.children.length&&g.parent.removeChild(g)),r.trigger("columnDrop",{column:i,newParent:d,insertBefore:u,valid:e.valid,event:t,region:h})}onAbort({context:e,event:t}){this.onInvalidDrop({context:e,event:t})}onInvalidDrop({context:e,event:t}){const{grid:n}=this,{column:r}=e;n.trigger("columnDrop",{column:r,valid:!1,event:t}),n.element.classList.remove("b-dragging-header")}renderContents(){this.init()}onInternalPaint(){this.init()}get isReordering(){var e;return Boolean(null===(e=this.dragHelper)||void 0===e?void 0:e.isDragging)}}Ff.featureClass="b-column-reorder",Ff._$name="ColumnReorder",Ed.registerFeature(Ff,!0);class Pf extends fi{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const n=this;n.grid=e,super.construct(e,t),n.resizer=new qh({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,cancel:n.onCancel,thisObj:n}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}changeLiveResize(e){return"auto"===e?!o.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:n}=this,r=e.column=t.columns.getById(e.element.dataset.columnId);n.minWidth=r.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:n}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(n)):n.width=e.newWidth)}onCancel({context:e}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}}Pf._$name="ColumnResize",Ed.registerFeature(Pf,!0);class Of extends(fi.mixin(mi)){static $name="FillHandle";static configurable={calculateFillValue:null,allowCropping:!1};static pluginConfig={chain:["afterSelectionChange","onContentChange","afterColumnsChange","fixElementHeights"],override:["getCellDataFromEvent"]};afterConstruct(){super.afterConstruct(),this.client.selectionMode.cell||(this.disabled=!0),this._fillListeners={}}delayable={handleSelection:"raf"};onContentChange(){this.handleSelection()}afterColumnsChange(){this.handleSelection()}fixElementHeights(){this.handleSelection()}getCellDataFromEvent(e,t){return t&&(t=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,t)}findPatternsIn2dRange(e,t,n){const r={};for(const n of e){const e=t?n.id:n.columnId;let i=n.record.getValue(n.column.field);i&&"string"==typeof i&&!isNaN(i)&&(i=parseFloat(i)),r[e]||(r[e]=[]),r[e].push(i)}for(const e in r)r[e].pattern=this.findPatternsIn1dRange(r[e],n);return r}findPatternsIn1dRange(e,t){const n=e[t?0:e.length-1],r={next:()=>n,lastValue:n};if(e.every((e=>"number"==typeof e))||e.every((e=>e instanceof Date))){const n=e.map(((t,n)=>t-e[n-1]));n.shift(),1===new Set(n).size&&(r.increaseBy=n[0]*(t?-1:1),r.next=()=>(r.lastValue instanceof Date?r.lastValue=new Date(r.lastValue.getTime()+r.increaseBy):r.lastValue+=r.increaseBy,r.lastValue))}else e.length>1&&(r.stringPattern=[...e],r.next=()=>(r.currentIndex===i?r.currentIndex=0:(r.currentIndex+=1,r.currentIndex>=r.stringPattern.length&&(r.currentIndex=0)),r.stringPattern[r.currentIndex]));return r}afterSelectionChange(){const e=this;e.client.readOnly?e.removeElements():An.isMouseDown()?(e.client.delayUntilMouseUp((()=>e.handleSelection(!0))),e.removeElements()):e.handleSelection(!0)}handleSelection(){if(!this._isExtending){const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(e){const{client:t}=this;t.readOnly||(this._fillListeners.mouseMoveOrUp=Zn.on({element:r,mouseover:{handler:"onMouseOver",element:t.selectionDragMouseEventListenerElement},mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0)}onMouseUp(){const e=this,{client:t,currentRange:n,_isCropping:r}=e,s=e.rangeSelection,o=s&&n&&t.internalSelectRange(n.from,n.to),a=(null==o?void 0:o.selectedCells)||[],l=r?e.croppingCells:a.filter((e=>!s.some((t=>t.equals(e,!0)))));if(delete e._isCropping,e._isExtending&&(t.disableScrollingCloseToEdges(t.items),delete e._isExtending),null!=l&&l.length){if(t.suspendRefresh(),r)l.forEach((e=>e.record.set(e.column.field,null,!1,!1,!1,!0)));else{const[t]=l,n=s.some((e=>e.record===t.record)),r=n?t.columnIndex<s[0].columnIndex:t.rowIndex<s[0].rowIndex,o=e.findPatternsIn2dRange(s,n,r),a=new Map;r&&l.reverse();for(const t of l){const{column:r,record:l}=t;if(!r.readOnly&&r.canFillValue({range:s,record:l,cell:t})){var c,d;let u=null===(c=e.calculateFillValue)||void 0===c?void 0:c.call(e,{range:s,column:r,record:l,cell:t}),h=a.get(l);if(h||(h={},a.set(l,h)),u===i){u=o[n?t.id:t.columnId].pattern.next()}h[r.field]=(null===(d=r.calculateFillValue)||void 0===d?void 0:d.call(r,{value:u,record:l,range:s}))||u}}for(const[e,t]of a)e.set(t,null,null,null,null,!0)}t.resumeRefresh(!0),t.performSelection(o),delete e.currentRange,e.handleSelection()}else e.handleSelection()}onMouseOver(e){var t,n;const r=this,{client:i,rangeSelection:s}=r,o=s[0],a=s[s.length-1],l=i.getCellDataFromEvent(e,!0);let c=l&&i.normalizeCellContext(l.cellSelector);if((null===(t=c)||void 0===t||null===(n=t._column)||void 0===n?void 0:n.region)===o._column.region){const e=s.some((e=>e.equals(c,!0)));let t;r._isExtending||i.enableScrollingCloseToEdges(i.items),e?r._isCropping=r.allowCropping&&(c.rowIndex<a.rowIndex||c.columnIndex<a.columnIndex):c.rowIndex>=o.rowIndex&&c.rowIndex<=a.rowIndex?(t=o.columnIndex>c.columnIndex,c=new Kc({grid:i,record:t?o.record:a.record,column:c.column})):(t=o.rowIndex>c.rowIndex,c=new Kc({grid:i,record:c.record,column:t?o.column:a.column}));const n=t?c:o,l=t||e&&!r._isCropping?a:c;r.currentRange={from:n,to:l},r._isExtending=!0,r.drawFillHandleAndBorder(n,l,!0)}}drawFillHandleAndBorder(e,t,n=!1){var r;const i=this,{client:s,currentRange:o,_fillListeners:a}=i,l=s.subGrids[e.column.region].element,{x:c}=wn.from(e.cell||e.column.element,l),{right:d}=wn.from(t.cell||t.column.element,l),{y:u}=s.getRecordCoords(e.record,!0),h=s.getRecordCoords(t.record,!0).bottom-1;let{borderElement:g,handleElement:m}=i;if(i.removeElements(n),g||(i.borderElement=g=Br.createElement({className:"b-fill-selection-border"}),i.handleElement=m=Br.createElement({className:"b-fill-handle"})),Br.setRect(g,{y:u,x:c,width:d-c,height:h-u}),l.appendChild(g),Br.setTopLeft(m,h,d>=l.scrollWidth?c:d),l.appendChild(m),i.toggleCroppingCls(!1),delete i.croppingCells,i._isCropping&&null!==(r=i.rangeSelection)&&void 0!==r&&r.length){const e=s.getRange(o.from,o.to);i.croppingCells=i.rangeSelection.filter((t=>!e.some((e=>e.equals(t,!0))))),i.toggleCroppingCls()}a.handleClick||(a.handleClick=Zn.on({element:s.rootElement,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:i})),i.hasFillElements=!0}toggleCroppingCls(e=!0){var t;null===(t=this.croppingCells)||void 0===t||t.forEach((t=>{var n;return null===(n=this.client.getCell(t))||void 0===n?void 0:n.classList.toggle("b-indicate-crop",e)}))}removeElements(e=!1){var t,n;const r=this;null===(t=r.handleElement)||void 0===t||t.remove(),null===(n=r.borderElement)||void 0===n||n.remove(),e||r.removeListeners(),r.hasFillElements=!1}removeListeners(){const e=this;for(const t in e._fillListeners)e._fillListeners[t]();e._fillListeners={}}get rangeSelection(){const{client:e}=this,{selectedCells:t}=e,n=e._shiftSelectRange??(1===t.length&&t);return!e._selectedRows.length&&null!=n&&n.length&&n.length===t.length&&n.every((r=>t.some((e=>r.equals(e,!0)))&&r._column.parent&&r._column.region===n[0]._column.region&&e.store.isAvailable(r.id)))?n:null}}Of._$name="FillHandle",Ed.registerFeature(Of);class Lf extends lp{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}static configurable={grid:null,allowedFieldNames:null};afterConstruct(){const e=this;if(!e.grid)throw new Error(`${e.constructor.$name} requires 'grid' to be configured.`);e.fields=e.fields??{},super.afterConstruct()}updateGrid(e){var t;if(null===(t=e.store)||void 0===t||!t.modelClass)throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getColumnFields(e,t,n){return Object.fromEntries((null==e?void 0:e.reduce(((e,{field:r,text:s,filterType:o,filterable:a})=>{if(!n||n.includes(r)){const n=r&&t.getFieldDefinition(r),l=(e=>Wm[null==e?void 0:e.type]||Gm(e))(n)?n.type:i;(l||o||a)&&e.push([r,{title:s||r,type:o??(Gm(n)?"duration":l)??"auto"}])}return e}),[]))??[])}changeFields(e){var t;let n=e;Array.isArray(e)&&(_.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),n=H.keyBy(n,"name"));const r=Xt.merge({},Lf.getColumnFields(this.grid.columns,null===(t=this.grid.store)||void 0===t?void 0:t.modelClass),n);return this.allowedFieldNames?Object.fromEntries(this.allowedFieldNames.map((e=>[e,r[e]]))):r}}Lf.initClass(),Lf._$name="GridFieldFilterPicker";class $f extends dp{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}static configurable={grid:null,allowedFieldNames:null};static childPickerType="gridfieldfilterpicker";validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:n,fields:r}=this;return{...super.getFilterPickerConfig(e),fields:r,grid:t,allowedFieldNames:n}}updateGrid(e){this.store=this.grid.store}canManage(e){return super.canManage(e)&&(!this.allowedFieldNames||this.allowedFieldNames.includes(e.property))}}$f.initClass(),$f._$name="GridFieldFilterPickerGroup";const _f={date:"date",int:"number",integer:"number",number:"number",string:"string",duration:"duration",time:"time",auto:"auto"},jf={date:"=",number:"=",string:"includes",duration:"=",relation:null,auto:"*"},Bf={...Wm,relation:!0},Vf={filterDateIsToday:!0,filterDateIsThisWeek:!0,filterDateIsThisMonth:!0,filterDateIsThisYear:!0};class Hf extends fi{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},legacyMode:!1,pickerConfig:null,closeEmptyPopup:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const n=this;if(n.grid=e,n.closeFilterEditor=n.closeFilterEditor.bind(n),null!=t&&t.isMulti&&(_.deprecate("Grid","6.0.0","Filter plugin config isMulti deprecated, use pickerConfig instead"),"object"==typeof t.isMulti&&(t.pickerConfig=t.isMulti),delete t.isMulti),super.construct(e,t),n.bindStore(e.store),t&&"object"==typeof t){const n=Xt.clone(t);delete n.prioritizeColumns,delete n.legacyMode,delete n.pickerConfig,delete n.dateFormat,delete n.closeEmptyPopup,Xt.isEmpty(n)||e.store.filter(n,null,e.isConfiguring)}}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,n=t.grid,r=n.headerContainer;r&&(Br.children(r,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new lc({forElement:r,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText})),n.store.isFiltered||t.filterTip.hide(),n.columns.visibleColumns.forEach((e=>{if(!1!==e.filterable){const n=t.store.filters.allValues.filter((({property:t,disabled:n,internal:r})=>t===e.field&&!n&&!r)),r=n.length>0,i=e.element;if(i){const s=e.textWrapper;let o,a=null==s?void 0:s.querySelector(".b-filter-icon");if(r){const r="&#x2022 ";o=`${t.L("L{filter}")}: `+(n.length>1?"<br/><br/>":"")+n.map((i=>{var s,o;let a=i.value??"";const l=Array.isArray(a),c=null===(s=t.store)||void 0===s||null===(o=s.modelRelations)||void 0===o?void 0:o.find((({foreignKey:e})=>e===i.property));if(i.displayValue)a=i.displayValue;else{if(!t.legacyMode&&c){var d,u;const{relatedDisplayField:e}=null===(d=t.pickerConfig)||void 0===d||null===(u=d.fields)||void 0===u?void 0:u[i.property];if(e){const t=t=>{var n;return null===(n=c.foreignStore.getById(t))||void 0===n?void 0:n[e]};a=l?a.map(t).sort(((e,t)=>(e??"").localeCompare(t??""))):t(a)}}else e.formatValue&&a&&(a=l?a.map((t=>e.formatValue(t))):e.formatValue(a));l&&(a=`[ ${a.join(", ")} ]`)}return(n.length>1?r:"")+("string"==typeof i?i:`${i.operator} ${a}`)})).join("<br/><br/>")}else o=t.L("L{applyFilter}");a?a.dataset.filterText=o:a=Br.createElement({parent:s,tag:"div",className:"b-filter-icon",dataset:{filterText:o}}),e.field===t.store.latestFilterField&&a.classList.add("b-latest"),i.classList.add("b-filterable"),i.classList.toggle("b-filter",r)}e.meta.isFiltered=r}})),e&&n.refreshRows())}applyFilter(e,t){const{store:n}=this;e.$filter=n.addFilter(this.injectColumnFilterConfig(e,t),!0),n.filter()}injectColumnFilterConfig(e,t){const{filterFn:n}=e.filterable;return Xt.assign(t,{...e.filterable,...t,property:e.field,[n?"filterBy":"_"]:function(t){return n({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}})}removeFilter(e,t){var n;if(this.legacyMode||null!==(n=e.filterable)&&void 0!==n&&n.filterField)this.store.removeFilter(e.field);else for(const n of this.getCurrentMultiFilters(e))t&&n.operator!==t||this.store.removeFilter(n)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter((t=>t.property===e.field))}getPopupDateItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n,displayValue:t._value,type:"date"}))}return[Xt.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"sameDay"===(null==n?void 0:n.operator)?n.value:r,operator:"sameDay",onKeydown:u,onChange:h,onClose:c,onClear:d},a),Xt.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},a),Xt.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},a)]}getPopupNumberItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[Xt.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),Xt.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),Xt.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},a)]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,n,r,i,s,o,a){const l=this,c=s,d=()=>l.removeFilter(e);function u({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[Xt.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onChange:u,onEsc:c,onClear:d},a),Xt.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},a),Xt.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onChange:u,onEsc:c,onClear:d},a)]}getPopupStringItems(e,t,n,r,s,o,a,l){const c=this;return[Xt.assign({type:"text",cls:"b-last-row",placeholder:"L{filter}",localeClass:c,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:n?n.value||n:r,operator:"*",onChange({source:t,value:n}){""===n?a():(c.applyFilter(e,{operator:t.operator,value:n,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):i}),t.multiSelect||o())},onClose:o,onClear:a},l)]}getPopupItems(e,t,n,r,i,s,o,a){const l=this;if(l.useLegacyModeForColumn(e)||a)switch(t){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}return[l.getFieldFilterPickerGroup(e)]}getFieldFilterPickerGroup(e){const t=this;return{...t.pickerConfig,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:t.grid,propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",internalListeners:{beforeAddFilter:({filter:n})=>{t.injectColumnFilterConfig(e,n)},remove:t.onPopupFilterRemove,keydown:t.onPopupKeydown,thisObj:t},triggerChangeOnInput:!1}}onPopupFilterRemove(){this.closeEmptyPopup&&0===this.filterEditorPopup.widgetMap.pickerGroup.filters.length&&this.delay(this.closeFilterEditor,0)}onPopupKeydown({event:e}){"Enter"===e.key&&this.delay(this.closeFilterEditor,0)}showFilterEditor(e,t,n,r=!1){e=this.grid.columns.getById(e);const i=this,{store:s}=i,o=e.element,a=s.filters.getBy("property",e.field),l=i.getFilterType(e),c=i.useLegacyModeForColumn(e);if(!1===e.filterable)return;i.closeFilterEditor();const d=i.getPopupItems(e,l,null!=a&&a.internal?null:a,t,s,i.closeFilterEditor,(()=>{i.removeFilter(e),i.closeFilterEditor()}),e.filterable.filterField);var u;(d.forEach((e=>e.placeholder=e.placeholder?this.L(e.placeholder):e.placeholder)),i.filterEditorPopup=_d.openPopup(o,{owner:i.grid,cls:new Tn("b-filter-popup",{"b-filter-popup-legacymode":c}),scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:d}),c)||(!r&&null!==(u=i.grid.store)&&void 0!==u&&u.filters.find((t=>t.property===e.field))||i.filterEditorPopup.widgetMap.pickerGroup.addFilter({type:l,property:e.field,operator:n??jf[l],value:t}),i.filterEditorPopup.items[0].focus())}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){var t,n;const r=e.field,i=this.client.store.modelClass.getFieldDefinition(r),s=e.filterType??_f[e.type]??_f[null==i?void 0:i.type];return(null===(t=this.store)||void 0===t||null===(n=t.modelRelations)||void 0===n?void 0:n.find((({foreignKey:e})=>e===r)))?"relation":"auto"===s&&this.store&&!this.useLegacyModeForColumn(e)?lp.inferFieldType(this.store,r):s?_f[s]:"auto"}populateCellMenuWithDateItems({column:e,record:t,items:n}){const r=e.field;if("date"===this.getFilterType(e)){const i=this,s=t.getValue(r),o=t=>{i.applyFilter(e,{operator:t,value:s,displayValue:e.formatValue?e.formatValue(s):s,type:"date"})};n.filterDateEquals={text:"L{on}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDateBefore={text:"L{before}",localeClass:i,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDateAfter={text:"L{after}",localeClass:i,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:n}){const r=e.field;if("number"===this.getFilterType(e)){const i=this,s=t.getValue(r),o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterNumberEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterNumberLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterNumberMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}addMenuItemsForDataType(e,t,n,r){const i=lp.defaultOperators[t].filter((({argCount:e,isArrayValued:t})=>!(e>1||t)));let s=300;for(const{value:o,text:a,argCount:l}of i)e[`filter${$.capitalize(t)}${$.capitalize(o)}`]={text:$.capitalize(lp.L(a)),weight:s+=10,icon:r.includes(o)?"b-icon b-icon-check":null,disabled:this.disabled,onItem:()=>n(o,l)}}populateCellMenuWithDurationItems({column:e,record:t,items:n}){if("duration"===this.getFilterType(e)){const r=this,i=e.getFilterableValue(t),s=t=>{r.applyFilter(e,{operator:t,value:i})};n.filterDurationEquals={text:"L{equals}",localeClass:r,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>s("=")},n.filterDurationLess={text:"L{lessThan}",localeClass:r,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:r.disabled,onItem:()=>s("<")},n.filterDurationMore={text:"L{moreThan}",localeClass:r,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:r.disabled,onItem:()=>s(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:n}){const r=this.getFilterType(e);if(!/(date|number|duration)/.test(r)){var i;const r=this,s=e.getFilterableValue(t),o=(null===(i=e.filterable.filterField)||void 0===i?void 0:i.operator)??"*";n.filterStringEquals={text:"L{equals}",localeClass:r,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>r.applyFilter(e,{value:s,operator:o})}}}getMenuItems(e,t){const n=this,r={},s=n.getFilterType(e);if(!1===e.filterable)return{};if(Bf[s]){const o=t?e.getFilterableValue(t):i,a=n.getCurrentMultiFilters(e).filter((e=>!e.disabled)).map((({operator:e})=>e)),l=t?1:i,c=lp.defaultOperators[s].filter((({argCount:e,isArrayValued:t})=>!(e>l||t)));let d=300;for(const{value:t,text:i,argCount:l}of c){const c=`filter${$.capitalize(s)}${$.capitalize(t)}`;r[c]={text:$.capitalize(lp.L(i)),weight:d+=10,icon:a.includes(t)?"b-icon b-icon-check":null,disabled:n.disabled,cls:Vf[c]?"b-separator":null,onItem:()=>n.onOperatorMenuItem(e,o,t,l)}}}return e.meta.isFiltered&&Object.assign(r,n.getMenuItemsForFilteredColumn(e,t!==i)),{filterMenu:{text:"L{filter}",localeClass:n,menu:r,icon:"b-fw-icon b-icon-filter",weight:t?400:100}}}onOperatorMenuItem(e,t,n,r=1){const s=this,o=s.getFilterType(e),a=s.getCurrentMultiFilters(e).find((e=>!e.disabled&&e.operator===n));a?s.removeFilter(e,n):0==r||t!==i?s.applyFilter(e,{property:e.field,operator:n,type:o,value:1===r?t:null,caseSensitive:!1,disabled:null==t&&r>0}):s.showFilterEditor(e,null,n,!0)}getMenuItemsForFilteredColumn(e,t){const n=this,r=!n.disabled&&(n.legacyMode||n.columnHasRemovableFilters(e));return{editFilter:n.legacyMode?i:{text:"L{editFilter}",localeClass:n,icon:"b-fw-icon b-icon-edit",cls:"b-separator",weight:500,disabled:!r,onItem:()=>n.showFilterEditor(e)},[t?"filterRemove":"removeFilter"]:{text:"L{removeFilter}",localeClass:n,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:510,disabled:!r,onItem:()=>n.removeFilter(e)},disableFilter:{text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:520,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)}}}populateCellMenu({column:e,record:t,items:n,...r}){const i=this;!1===e.filterable||t.isSpecialRow||(i.useLegacyModeForColumn(e)?(i.populateCellMenuWithDateItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithNumberItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithDurationItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithStringItems({column:e,record:t,items:n,...r}),e.meta.isFiltered&&Object.assign(n,i.getMenuItemsForFilteredColumn(e,!0))):Object.assign(n,i.getMenuItems(e,t)))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find((e=>!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e]))))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find((e=>!e.disabled)))}populateHeaderMenu({column:e,items:t}){const n=this;n.useLegacyModeForColumn(e)?e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:n,weight:110,icon:"b-fw-icon b-icon-remove",disabled:n.disabled||!n.legacyMode&&!n.columnHasRemovableFilters(e),onItem:()=>n.removeFilter(e)},t.disableFilter={text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)}):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)}):Object.assign(t,n.getMenuItems(e))}useLegacyModeForColumn(e){var t,n;return this.legacyMode||((null===(t=e.filterable)||void 0===t?void 0:t.filterFn)??(null===(n=e.filterable)||void 0===n?void 0:n.filterField))!=i}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){const i=e.getAt(r);if(!i.internal){var n;const s=(i.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===i.property));null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new ps({columnOwned:!0,property:i.property,operator:i.operator,value:i.value,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=i.value,s.$filter.displayValue=i.displayValue,s.$filter.operator=i.operator,e.splice(r,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable({event:e,actionName:t}){if("showFilterEditorByKey"===t){const t=e.target.closest(".b-grid-header"),n=t&&this.client.columns.find((e=>e.id===t.dataset.columnId));return Boolean(null==n?void 0:n.filterable)}}}Hf._$name="Filter",Ed.registerFeature(Hf);const Nf={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class zf extends fi{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,hidden:!1,filter:null,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const n=this;n.grid=e,n.onColumnFilterFieldChange=n.onColumnFilterFieldChange.bind(n),super.construct(e,Array.isArray(t)?{filter:t}:t),n.bindStore(e.store),n.filter&&e.store.filter(n.filter),n.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:n})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const n=this.getColumnFilterField(t);n&&(n.disabled=e)})),super.doDisable(e)}updateHidden(e){this.isConfiguring||(e?this.hideFilterBar():this.showFilterBar())}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const n=this._columnFilters[t];n.placeholder=e?n.column.headerText:null}}destroyFilterBar(){var e;null===(e=this.grid.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.grid.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t._hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this._hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(e){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach((t=>this.renderColumnFilterField(t,e))),this.rendered=!0)}renderColumnFilterField(e,t){const n=this,{grid:r}=n,i=n.getColumnFilterable(e);if(i&&e.isVisible){const s=e.element,o=r.store.filters.get(e.id)||r.store.filters.getBy("property",e.field);let a=n.getColumnFilterField(e);if(a)t&&n.onColumnFilterFieldChange({source:a,value:a.value}),a.render(s),a.show();else{const t=`${e.filterType||"text"}field`,{filterField:l}=i,c=null==l?void 0:l.cls;c&&delete i.filterField.cls,a=_d.append(Xt.assign({type:t,cls:{[n.filterFieldCls]:1,[c]:c},dataset:{column:e.field},column:e,owner:r,clearable:!0,name:e.field,value:!o||o._filterBy||o.internal?"":n.buildFilterValue(o),inputCls:n.filterFieldInputCls,keyStrokeChangeDelay:n.keyStrokeFilterDelay,onChange:n.onColumnFilterFieldChange,onClear:n.onColumnFilterFieldChange,disabled:n.disabled,placeholder:n.compactMode?e.headerText:null,format:e.format},l),s)[0],null!=l&&l.hasOwnProperty("min")||Object.defineProperty(a,"min",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.min},set:()=>null}),null!=l&&l.hasOwnProperty("max")||Object.defineProperty(a,"max",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.max},set:()=>null}),null!=l&&l.hasOwnProperty("strictParsing")||Object.defineProperty(a,"strictParsing",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.strictParsing},set:()=>null}),a.element.retainElement=!0,n.setColumnFilterField(e,a);const d=(null==l?void 0:l.store)&&(l.store.readUrl||l.store.data||l.store.isChained);if(a.isCombo&&!d&&0===a.store.count){const t=a.value,n=()=>{a.store.readUrl||a.store.isChained||(a.store.data=r.store.getDistinctValues(e.field,!0).map((t=>r.store.modelClass.new({id:t,[e.field]:t}))))};a.value=null,a.store.isSorted||a.store.sort({field:e.field,ascending:!0}),a.picker.ion({beforeShow:n}),n(),a.value=t}!n.filter&&a.value&&!1!==r.store.autoLoad&&n.onColumnFilterFieldChange({source:a,value:a.value})}s.classList.add(n.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:n}=e.grid;let r,i;e._updatingFields=!0;for(const s of t.visibleColumns)r=e.getColumnFilterField(s),r&&!s.$isApplyingFilter&&(i=n.filters.get(s.id)||n.filters.getBy("property",s.field),i&&!i.internal?i._filterBy?r.value=i.value:r.value=e.buildFilterValue(i):r.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,i))}hideColumnFilterField(e,t){const n=this,{store:r}=n.grid,i=e.element,s=n.getColumnFilterField(e);if(s){n.isDestroying||s.hide();const{$filter:o}=e;!r.isDestroyed&&n.clearStoreFiltersOnHide&&o&&r.removeFilter(o,t),null==i||i.classList.remove(n.filterableColumnCls)}}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,n){var r;if(Array.isArray(t)||t instanceof us)return{value:t};if(Xt.isDate(t))return{operator:n.isDateField?"sameDay":n.isTimeField?"sameTime":"=",value:t};const i=String(t).match(this.filterParseRegExp);return{operator:i[1]||(null===(r=e.filterable)||void 0===r?void 0:r.operator)||"*",value:i[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)||t instanceof us?t:(e in Nf?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var n;const i=e.getAt(r),s=(i.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===i.property));null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new ps({columnOwned:!0,property:i.property,id:s.id,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,property:this.property,column:s})}})),s.$filter.value=i.value,e.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:e,changes:t,column:n,columns:r}){if(!this.hidden&&null!=t&&t.hidden){t.hidden.value?this.destroyColumnFilterField(n):this.renderColumnFilterField(n)}"remove"===e&&r.forEach((e=>this.destroyColumnFilterField(e)))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))null==e||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const n=this,{column:r}=e,{filterFn:s}=r.filterable,{store:o}=n.grid,a=r.$filter||o.filters.find((e=>(e.id===r.id||e.property===r.field)&&!e.internal));if(n._updatingFields)return;const l=null==t||""===t||Array.isArray(t)&&0===t.length;var c,d;if(o.removeFilter(a,!0),r.$filter=null,r.$isApplyingFilter=!0,l){if(!a)return void(r.$isApplyingFilter=!1)}else r.$filter=o.addFilter({property:e.name,...n.parseFilterValue(r,t,e),["boolean"==typeof(null===(c=r.filterable)||void 0===c?void 0:c.caseSensitive)?"caseSensitive":i]:null===(d=r.filterable)||void 0===d?void 0:d.caseSensitive,[s?"filterBy":"_"]:function(e){return s({value:this.value,record:e,operator:this.operator,property:this.property,column:r})}},!0);o.filter(),r.$isApplyingFilter=!1}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}zf.featureClass="b-filter-bar",zf._$name="FilterBar",Ed.registerFeature(zf);class Wf extends fi{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(e,t){const n=this;e.features.tree||(n._thisIsAUsedExpression(e.features.groupSummary),t=n.processConfig(t),n.grid=e,super.construct(e,t),n.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:n}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:this}),this.onStoreGroup({groupers:e.groupers})}updateRenderer(e){this.groupRenderer=e}updateField(e){var t;this.isConfiguring&&null!==(t=this.store.groupers)&&void 0!==t&&t.some((t=>t.field===e))||this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),this.currentGroupers=t.groupers,t.clearGroupers(),t.sort(e)}else!e&&this.currentGroupers&&(t.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}refreshGrid(e){const{store:t,rowManager:n}=this.grid;n.rowCount>t.count||!n.getRowFor(e)?n.renderFromRow():n.renderFromRecord(e)}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,n=!1,r){const s=this,{store:o,grid:a}=s,l=o.getById(e);l.isGroupHeader&&(t=t===i?!l.meta.collapsed:t,!1!==a.trigger("beforeToggleGroup",{groupRecord:l,collapse:t,domEvent:r})&&(s.isToggling=!0,t?o.collapse(l):o.expand(l),s.isToggling=!1,n||s.refreshGrid(l),a.trigger("toggleGroup",{groupRecord:l,collapse:t}),a.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(null==t?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:n,row:r,column:i,grid:s}=e,{meta:o}=e.record,a={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in o){if("action"===i.type)return;i.clearCell(n),a["b-grid-group-collapsed"]=o.collapsed,a["b-group-row"]=1,s.buildGroupHeader?s.buildGroupHeader(e):t.buildGroupHeader(e),i===t.groupHeaderColumn&&(Br.createElement({parent:n,tag:"i",className:"b-group-state-icon",nextSibling:n.firstChild}),n.classList.add("b-group-title"),n.$groupHeader=n._hasHtml=!0)}else if(n.$groupHeader){var l;null===(l=n.querySelector(".b-group-state-icon"))||void 0===l||l.remove(),n.classList.remove("b-group-title"),n.$groupHeader=!1}r.assignCls(a)}buildGroupHeader(e){const t=this,{record:n,cellElement:r,column:i,persist:s}=e,{grid:o}=t,a=n.meta,l=a.emptyArray?o.L("L{Object.None}"):a.groupRowFor,{groupSummary:c}=o.features,d=a.childCount-(c&&"header"!==c.target?1:0);let u=null,h=!0;if(s||i){const s=o.columns.get(a.groupField),c=e.isFirstColumn=i===t.groupHeaderColumn;null!=s&&s.groupRenderer?c&&(u=s.groupRenderer({...e,groupRowFor:l,groupRecords:n.groupChildren,groupColumn:s,count:d}),h=!1):t.groupRenderer&&(u=t.groupRenderer({...e,groupRowFor:l,groupRecords:n.groupChildren,groupColumn:s,count:d,isFirstColumn:c})),c&&null==u&&h&&0===Br.getChildElementCount(r)&&(u=$.encodeHtml(`${"__novalue__"===l?"":l} (${d})`))}else t.groupRenderer&&(u=t.groupRenderer(e));return"string"==typeof u?r.innerHTML=u:"object"==typeof u&&To.sync({targetElement:r,domConfig:{onlyChildren:!0,children:H.asArray(u)}}),Br.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}renderHeader(e=this.grid.headerContainer){const{store:t,grid:n}=this;if(e&&t.isGrouped)for(const e of t.groupers){var r;const t=n.columns.get(e.field),i=t&&n.getHeaderElement(t.id);if(null==i||i.classList.add("b-group",e.ascending?"b-asc":"b-desc"),i&&(null===(r=n.features.sort)||void 0===r||!r.enabled||!1===t.sortable)){const e=t.textWrapper;null!=e&&e.querySelector(".b-sort-icon")||Br.createElement({parent:e,className:"b-sort-icon"})}}}populateHeaderMenu({column:e,items:t}){const n=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:n.disabled,onItem:()=>n.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:n,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:n.disabled,onItem:()=>n.store.group(e.field,!1)}),n.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:n.disabled,onItem:()=>n.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var n;const r=this,{store:i,disabled:s}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!1)});const o=(null===(n=i.groupers)||void 0===n?void 0:n.some((t=>t.field===e.field)))&&!s;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!o,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:n}=t,r=n&&Br.children(n,".b-grid-header.b-group");if(n){for(const e of r)e.classList.remove("b-group","b-asc","b-desc");e&&this.renderHeader()}}onStoreChange({action:e,records:t}){const{client:n}=this,{rowManager:r,store:i}=n;if(i.isGrouped&&"move"===e){const{field:e}=i.groupers[0],n=Math.min(...t.reduce(((t,n)=>{if(t.push(i.indexOf(n.groupParent.get(i.id))),e in n.meta.modified){const r=i.groupRecords.find((t=>t.meta.groupRowFor===n.meta.modified[e]));r&&t.push(i.indexOf(r))}return t}),[]));r.renderFromRow(r.getRow(n))}}onStoreToggleGroup({groupRecord:e}){this.isToggling||this.refreshGrid(e)}onElementTouchStart(e){const t=this,{target:n}=e,r=n.closest(".b-grid-header"),i=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,s=r.closest(".b-group-row"),o=r.closest(".b-grid-header"),a=null==o?void 0:o.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item")||e.handled)){if(o&&a){var l;const r=null===(l=n.groupers)||void 0===l?void 0:l.find((e=>e.field===a));if(r&&!e.shiftKey)return r.ascending=!r.ascending,n.group(),!1;if(e.shiftKey){!1!==t.grid.columns.get(a).groupable&&(e.altKey?n.removeGrouper(a):n.group(a))}}return s&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon"))?(t.internalToggleCollapse(qc.get(s).id,i,i,e),!1):void 0}}toggleGroup(e){var t;const{grid:n}=this,{focusedCell:r}=n;return!(this.disabled||r.isActionable||null===(t=r.record)||void 0===t||!t.isGroupHeader)&&(this.internalToggleCollapse(r.id),!0)}}Wf._$name="Group",Ed.registerFeature(Wf,!0,["Grid","Scheduler"]),Ed.registerFeature(Wf,!1,["TreeGrid"]);var Uf=e=>class extends(e||ye){static get $name(){return"SummaryFormatter"}generateHtml(e,t,n,r,i,s){const o=this.store,a=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let l=`<div class="b-summary-wrap ${n}">`;return a.forEach((n=>{let r=n.sum,i=null;switch(!0===r&&(r="sum"),r){case"sum":case"add":i=o.sum(e.field,t);break;case"max":i=o.max(e.field,t);break;case"min":i=o.min(e.field,t);break;case"average":case"avg":i=o.average(e.field,t);break;case"count":i=t.length;break;case"countNotEmpty":i=t.reduce(((t,n)=>t+(null!=n.getValue(e.field)?1:0)),0)}if("function"==typeof r&&(i=t.reduce(r,"seed"in n?n.seed:0)),null!==i){const e="b-grid-summary-value",t=n.label?`<div class="b-grid-summary-label">${n.label}</div>`:"";let r,s=n.renderer?n.renderer({config:n,sum:i}):i;null==s&&(s=""),r=String(s).includes("<div>")?s:t?`${t}<div class="${e}">${s}</div>`:`<div class="${e} b-nolabel">${s}</div>`,l+=r}})),`${l}</div>`}};class Gf extends(Uf(fi)){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return Xt.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&"footer"===e,this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return Xt.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:n,record:r,size:i,isFirstColumn:s}){const o=this,{meta:a}=r,{rowHeight:l}=o.grid,c="groupRowFor"in a,d="groupFooterFor"in a,u="header"===o.target,h={"b-group-footer":0,"b-header-summary":0},g=c&&(u||o.collapseToHeader&&a.collapsed)&&!s||d&&!u;if((c||d)&&(i.height=c&&i.height||l),o.store.isGrouped&&g&&!o.disabled){e.clearCell(t);const s=c?r:a.groupRecord;n.isGroupFooter=d,n.isGroupHeader=c,d?h["b-group-footer"]=1:h["b-header-summary"]=1;const g=o.updateSummaryHtml(t,e,s),m="number"==typeof g?g:g.count;m>1&&(i.height+=a.collapsed&&!u?0:m*l*.1),g.height&&(i.height+=g.height)}n.assignCls(h)}updateSummaryHtml(e,t,n){const r=n.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const i=this.generateHtml(t,r,"b-grid-group-summary",n,n.meta.groupField,n.meta.groupRowFor);return e.children.length?Br.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;const n=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}));n&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach((e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)}))}hasSummary(e){return e.sum||e.summaries}}Gf.featureClass="b-group-summary",Gf._$name="GroupSummary",Ed.registerFeature(Gf);class Yf extends Gh{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return Xt.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const n=this;if(t){if(t.headerMenuItems&&Xt.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,i=r?n.client.rtl?"left":"right":n.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${i}`,text:n.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(n.moveColumns){const r=n.getColumnToMoveBefore(t),i=n.getColumnToMoveAfter(t);r&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:n.L("L{moveBefore}",$.encodeHtml(r.text)),onItem:()=>{const{parent:e}=t;var n;r.parent.insertChild(t,r)&&(t.region=r.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}}),i&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:n.L("L{moveAfter}",$.encodeHtml(i.text)),onItem:()=>{const{parent:e}=t;var n;i.parent.insertChild(t,i.nextSibling)&&(t.region=i.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:n}=e;return t?t.children&&!e.children?t.children[t.children.length-1]:t:n.isRoot?void 0:n}getColumnToMoveAfter(e){const{nextSibling:t,parent:n}=e;return t||(n.isRoot?void 0:n)}}Yf.featureClass="",Yf._$name="HeaderMenu",Ed.registerFeature(Yf,!0);const qf={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"};class Kf extends fi{static $name="MergeCells";static configurable={passthrough:!0,sortedOnly:!0};mergedRanges=[];mergedMap={};static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:t}=e;t.eachSubGrid((t=>e.setupSubGrid(t))),t.rowManager.ion({renderDone:"onRenderDone",thisObj:e}),e.bindStore(t.store)}setupSubGrid(e){e.$mergedCellsElement=Br.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}}),e.ion({beforeInternalResize:"refreshBounds",thisObj:this})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}updateSortedOnly(e){this.isConfiguring||this.reset(!0,e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const t=this,{column:n,record:r,cellElement:i}=e,s=t.client.subGrids[n.region];if(!t.disabled&&n.mergeCells&&(n.isSorted||!t.sortedOnly)&&!r.isSpecialRow&&!s.collapsed){const s=t.getMergeRange(r,n);null!=s&&s.use&&(i.classList.add("b-merged-cell"),i.innerHTML="",e.cellElement=s.cellElement)}}afterRenderRow({row:e,oldId:t,oldHeight:n}){t===e.id&&n!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:t,column:n}){if(!this.disabled)if("update"!==e||!t.mergeCells||n.mergeCells)this.refreshBounds();else{for(const e of this.mergedRanges.slice())e.column===n&&this.removeRange(e);this.syncDom()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,t=e.selectedRecords.map((t=>e.store.indexOf(t)));let n=!1;for(const e of this.mergedRanges){let r=!0;for(let n=e.fromIndex;n<=e.toIndex&&r;n++)r=t.includes(n);e.isSelected!==r&&(e.isSelected=r,n=!0)}n&&this.syncDom()}}getRecordFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:t}){!1!==e.mergeable&&(t.mergeCells={text:"L{MergeCells.mergeCells}",icon:"b-fw-icon "+(e.mergeCells?"b-icon-checked":"b-icon-unchecked"),tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){if(!this.passthrough){const t=e.target.closest(".b-grid-merged-cells");if(t){const{client:n}=this,{range:r}=t.elementData,{cellEdit:i}=n.features,{column:s}=r,o=$.capitalize(qf[e.type]??e.type),a={grid:n,records:[],column:s,cellElement:t.firstElementChild,target:e.target,event:e};for(let e=r.fromIndex;e<=r.toIndex;e++)a.records.push(n.store.getAt(e));if(n.trigger(`mergedCell${o}`,a),(null==i?void 0:i.triggerEvent.toLowerCase())===`cell${o}`.toLowerCase()){const t=n.rowManager.getRowAt(e.clientY);await i.startEditing({id:t.id,columnId:s.id})}else"click"===e.type&&this.onRangeClick({range:r})}}}onRangeClick({range:e}){const t=[];for(let n=e.fromIndex;n<=e.toIndex;n++)t.push(this.client.store.getAt(n));this.client.selectedRecords=t}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){"filter"!==e&&"dataset"!==e&&!this.disabled&&this.reset(!1)}createRangeElement(e){var t,n;const r=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,i=`${e.fromIndex}-@-${e.column.id}`;let s=(null===(t=r.syncIdMap)||void 0===t?void 0:t[i])??(null===(n=r.releasedIdMap)||void 0===n?void 0:n[i]);return r.releasedIdMap&&delete r.releasedIdMap[i],s||(s=Br.createElement(this.createRangeDomConfig(e))),To.addChild(r,s,i),e.element=s,e.cellElement=s.firstElementChild,s}createRangeDomConfig(e){var t;const{column:n,fromIndex:r,toIndex:i,top:s,left:o,right:a,width:l,height:c}=e,{type:d}=n,u=this.client.store.getAt(r),h={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:o,right:a,height:c,width:l},dataset:{syncId:`${r}-@-${n.id}`,fromIndex:r,toIndex:i,column:n.field,columnId:n.id},children:[{className:new Tn(this.client.cellCls).assign({[`b-${null==d?void 0:d.toLowerCase()}-cell`]:d,[n.cellCls]:n.cellCls,[n.internalCellCls]:n.internalCellCls}).assign(n.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:n.field,columnId:n.id},style:{height:this.client.rowManager.rowHeight}}]};return null===(t=n.mergedRenderer)||void 0===t||t.call(n,{domConfig:h,value:n.getRawValue(u),record:u,column:n,fromIndex:r,toIndex:i}),h}buildMergedCellsConfig(e,t,n){var r,i;const s=this,{client:o}=s,{rowManager:a}=o;e=e??(null===(r=a.topRow)||void 0===r?void 0:r.dataIndex),t=t??(null===(i=a.bottomRow)||void 0===i?void 0:i.dataIndex);const l=o.regions.reduce(((e,t)=>(e[t]={className:{"b-grid-merged-cells-container":1},children:[]},e)),{});for(const r of s.mergedRanges)r.use&&r.fromIndex<=t&&r.toIndex>=e&&(s.updateRange(r,s.heightChanged,n),l[r.column.region].children.push(s.createRangeDomConfig(r)));return l}syncDom(e=!1){const t=this,{client:n}=t,{rowManager:r}=n;if(!e&&!r.topRow||t.disabled&&!t.isDisabling)return;const i=this.buildMergedCellsConfig();n.eachSubGrid((e=>{To.sync({targetElement:e.$mergedCellsElement,syncIdField:"syncId",domConfig:i[e.region]})})),t.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){H.remove(this.mergedRanges,e);for(let t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap[`${t}-@-${e.column.id}`]}reset(e=!0,t=!1){const n=this,r=n.client.columns.visibleColumns.filter((e=>e.mergeCells&&(e.isSorted||!n.sortedOnly||t)),!0),i=n.mergedRanges.length;if(n.mergedRanges=[],n.mergedMap={},e&&!n.client.refreshSuspended){for(const e of n.client.rowManager.rows)for(const t of r)e.renderCell(e.getCell(t.id));n.syncDom(i&&!n.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,t=this.client.rowManager.topRow,n=new Map,r=this.client.rtl;for(const i of e.slice()){const{column:e}=i,s=t.getCell(e.id);if(s){let{rowWidth:t,bounds:o}=n.get(e)??{};o||(t=s.parentElement.offsetWidth,o=wn.from(s,s.parentElement),n.set(e,{rowWidth:t,bounds:o})),r?i.right=t-o.right:i.left=o.left,i.width=o.width}else this.removeRange(i)}this.syncDom()}updateRange(e,t,n=null){const{store:r,rowManager:i}=this.client,{topRendered:s,bottomRendered:o}=e,{rowOffsetHeight:a}=i;let l,c,{fromIndex:d,toIndex:u}=e;if((t=n?n.length>0:t)||!s||!o){if(!s||t){if(n){const e=n.findIndex((e=>e.dataIndex>=d));l=n[e],d=l.dataIndex}else do{l=i.getRowById(r.getAt(d))}while(!l&&d++<u);e.topRendered=d===e.fromIndex;const t=d-e.fromIndex;e.top=l.top-t*(n?l.offsetHeight:a)}if(!o||t){if(n){const e=n.findIndex((e=>e.dataIndex===u));c=n[-1===e?n.length-1:e],d=c.dataIndex}else do{c=i.getRowById(r.getAt(u))}while(!c&&u-- >d);e.bottomRendered=u===e.toIndex;const t=e.toIndex-u;e.bottom=c.bottom+t*(n?c.offsetHeight:a)}e.height=e.bottom-e.top}}getMergeRange(e,t){if(e.isSpecialRow)return;const n=this,{mergedMap:r}=n,{store:i}=n.client,s=n.client.rowManager.topRow,o=t.id,a=i.indexOf(e),l=`${a}-@-${o}`,c=this.client.rtl;let d=r[l];if(!d){const u=t.getRawValue(e);d=r[l]={column:t},n.mergedRanges.push(d);let h,g,m=a;do{h=i.getAt(--m),g=h&&t.getRawValue(h),g===u&&(r[`${m}-@-${o}`]=d)}while(h&&!h.isSpecialRow&&g===u);let p,f,v=a;do{p=i.getAt(++v),f=p&&t.getRawValue(p),f===u&&(r[`${v}-@-${o}`]=d)}while(p&&!p.isSpecialRow&&f===u);if(d.fromIndex=m+1,d.toIndex=v-1,d.toIndex-d.fromIndex>0){const e=s.getCell(o),t=e.parentElement.offsetWidth,n=wn.from(e,e.parentElement);c?d.right=t-n.right:d.left=n.left,d.width=n.width,d.use=!0}}return!d.element&&d.use&&n.createRangeElement(d),d}}Kf._$name="MergeCells",Ed.registerFeature(Kf);const Xf={goToNextHit:1,goToPrevHit:1,showFilterEditor:1,clearSearch:1};class Zf extends fi{static $name="QuickFind";static configurable={mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}};static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,Br.NodeFilter.SHOW_TEXT,(()=>Br.NodeFilter.FILTER_ACCEPT))})}isActionAvailable({actionName:e}){if(Xf[e]){const{focusedCell:e}=this.grid;return!this.disabled&&(null==e?void 0:e.record)&&!e.isActionable&&this.find.length>0}}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,{grid:t}=e,n=t.getHeaderElement(e.columnId);if(n){if(!e.headerField){const[r,i,s]=Br.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});"header"===e.mode?n.appendChild(r):(r.className+=" b-quick-hit-mode-grid",t.element.appendChild(r)),e.headerField={header:r,field:i,badge:s,colHeader:n}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,n.classList.add("b-quick-find-header")}!n&&!t.hideHeaders||e.renderListenerInitialized||(t.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}hideQuickFind(){const e=this,{grid:t,headerField:n}=e;for(const n of e.prevFound||e.found){const r=t.getRowById(n.id);if(r){r.forceInnerHTML=!0;const t=r.getCell(e.columnId);t._content=null,r.renderCell(t),r.forceInnerHTML=!1}}n&&(n.header.parentNode.removeChild(n.header),n.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId,n=!1){var r;const i=this,{grid:s}=i,o=s.columns.getById(t)||s.columns.get(t),a=i.store.findByField(o.field,e,o.mergeCells&&o.isSorted);let l=1;Object.assign(i,{foundMap:{},prevFound:i.found,found:a,find:e,columnId:o.id,findRe:new RegExp(`(\\s+)?(${$.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?i.showQuickFind():i.hideQuickFind();for(const e of Br.children(s.element,`.${i.hitCls}`))e.classList.remove(i.hitCls,i.hitCellCls),e._originalContent&&(e.innerHTML=e._originalContent,e._originalContent=null);if(a){a.length>0&&!n&&i.gotoClosestHit(s.focusedCell,a);for(const e of a){i.foundMap[e.id]=l++;const t=s.getRowById(e.data.id);if(null==t||t.renderCell(t.getCell(o.id)),l>1e3)break}null===(r=s.syncSplits)||void 0===r||r.call(s,(n=>n.features.quickFind.search(e,t,!0))),s.trigger("quickFind",{find:e,found:a})}}clear(){var e;(this.find||null!==(e=this.found)&&void 0!==e&&e.length)&&this.search("")}get foundCount(){var e;return(null===(e=this.found)||void 0===e?void 0:e.length)??0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),!!t}gotoClosestHit(e,t){const n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort(((e,t)=>Math.abs(e.index-n)-Math.abs(t.index-n)));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,t;const n=this,{grid:r}=n,i=(null===(e=r._focusedCell)||void 0===e?void 0:e.id)??(null===(t=r.lastFocusedCell)||void 0===t?void 0:t.id),s=r.store.indexOf(i)||0,o=n.found.find((e=>e.index>s));o?r.focusCell({columnId:n.columnId,id:o.id},{doSelect:!0}):n.gotoFirstHit()}gotoPrevHit(){var e,t;const n=this,{grid:r,found:i}=n,s=(null===(e=r._focusedCell)||void 0===e?void 0:e.id)??(null===(t=r.lastFocusedCell)||void 0===t?void 0:t.id),o=r.store.indexOf(s)||0;let a;if(i.length){for(let e=i.length-1;e--;e>=0)if(i[e].index<o){a=i[e];break}a?r.focusCell({columnId:n.columnId,id:a.id},{doSelect:!0}):n.gotoLastHit()}}renderCell({cellElement:e,column:t,record:n}){var r;const i=this,{classList:s}=e,{treeWalker:o,findRe:a,hitTextCls:l}=i,c=i.columnId===t.id&&(null===(r=i.foundMap)||void 0===r?void 0:r[n.id]);if(c){s.add(i.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const t=o.currentNode=Br.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],c=e[3]?" ":"";r.push(`${$.encodeHtml(t)}${s}<span class="${l}">${o}</span>${c}`),i=a.lastIndex}r.push($.encodeHtml(n.substring(i)),"</span>"),t.parentNode.insertBefore(Br.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}Br.createElement({parent:e,className:i.hitCellBadgeCls,text:c})}}onBackspace(e){const t=this;return!!t.find&&(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0)}clearSearch(){return!!this.find&&(this.find="",this.search(this.find),!0)}showFilterEditor(){const e=this,{filter:t}=e.client.features;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var t;const n=this,{grid:r}=n,{focusedCell:i}=r;if(!e.handled&&!n.disabled&&null!=i&&i.record&&!i.isActionable&&1===(null===(t=e.key)||void 0===t?void 0:t.length)){const t=r.columns.getById(r._focusedCell.columnId);t&&!1!==t.searchable&&(n.columnId=r._focusedCell.columnId,n.find+=e.key,n.search(n.find))}}onCellNavigate(e,t,n){const r=this;!r.find||n&&n.columnId===r.columnId||r.clear()}}Zf._$name="QuickFind",Ed.registerFeature(Zf);class Jf extends fi{static $name="RegionResize";static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}static configurable={showSplitterButtons:!0,enableDragging:!0};updateShowSplitterButtons(e){this.client.element.classList.toggle("b-hide-splitter-buttons",!e)}onElementDblClick(e){const t=this,{client:n}=t,r=e.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let e=r.dataset.region,i=n.getSubGrid(e);i.collapsed||(e=n.getLastRegions()[1],i=n.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const n=this,{clientX:r}=t,{client:i}=n,s=e.dataset.region,o=i.element,a=i.regions[i.regions.indexOf(s)+1],l=i.getSubGrid(a),c=i.getSubGrid(s);let d=c,u=1;if(null!=d.flex&&null==l.flex&&(d=l,u=-1),i.rtl&&(u*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const h=Object.values(i.subGrids).reduce(((e,t)=>t.width+e),0);i.trigger("splitterDragStart",{subGrid:d,domEvent:t}),n.dragContext={element:e,headerEl:d.header.element,subGridEl:d.element,subGrid:d,splitterSubGrid:c,originalWidth:d.element.offsetWidth,originalX:r,minWidth:d.minWidth||0,maxWidth:Math.min(h,d.maxWidth||h),flip:u},o.classList.add("b-moving-splitter"),c.toggleSplitterCls("b-moving"),n.pointerDetacher=Zn.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:n})}endMove(e){const t=this,{dragContext:n,client:r}=t;if(n){const{subGrid:i}=n;e.preventDefault(),t.pointerDetacher(),r.element.classList.remove("b-moving-splitter"),n.splitterSubGrid.toggleSplitterCls("b-moving",!1),t.dragContext=null,r.trigger("splitterDragEnd",{subGrid:i,domEvent:e})}}onCollapseClick(e,t,n){const{client:r}=this,i=t.dataset.region,s=r.getLastRegions();if(!1!==r.trigger("splitterCollapseClick",{subGrid:e,domEvent:n})){if(s[0]===i){const e=r.getSubGrid(s[1]);if(e.collapsed)return void e.expand()}e.collapse()}}onExpandClick(e,t,n){const{client:r}=this,i=t.dataset.region,s=r.getLastRegions();if(!1!==r.trigger("splitterExpandClick",{subGrid:e,domEvent:n}))if(s[0]!==i||e.collapsed)e.expand();else{r.getSubGrid(s[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const n=e-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+n*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}onElementPointerDown(e){const t=this,{target:n}=e,r=0===e.button&&n.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),i=r&&t.client.getSubGrid(r.dataset.region);let s;r&&(n.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(i,r,e):n.closest(".b-grid-splitter-button-expand")?t.onExpandClick(i,r,e):t.enableDragging&&(t.startMove(r,e),s=r)),"touch"===e.pointerType&&t.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.enableDragging&&this.endMove(e)}onSubGridCollapse({subGrid:e}){const t=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const t=this,{touchedSplitter:n}=t;e&&n&&e.dataset.region!==n.dataset.region&&t.toggleTouchSplitter();const r=t.client.getSubGrid(e?e.dataset.region:null==n?void 0:n.dataset.region);r&&(r.toggleSplitterCls("b-touching",Boolean(e)),e?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=e}render(){const{regions:e,subGrids:t}=this.client;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}updateEnableDragging(e){this.client.element.classList.toggle("b-grid-splitter-no-drag",!e)}}Jf.featureClass="b-split",Jf._$name="RegionResize",Ed.registerFeature(Jf);const Qf={cut:1,copy:1,paste:1};class ev extends bf{static $name="RowCopyPaste";static type="rowCopyPaste";static pluginConfig={assign:["copyRows","pasteRows"],chain:["populateCellMenu"]};static configurable={nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1};construct(e,t){super.construct(e,t),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}entityName="row";onBeforeRenderRow({row:e,record:t}){var n;e.cls["b-cut-row"]=this.isCut&&(null===(n=this.cutData)||void 0===n?void 0:n.includes(t))}isActionAvailable({actionName:e,event:t}){const{grid:n}=this,{cellEdit:i}=n.features,{target:s}=t;var o;if(Qf[e])return!this.disabled&&0===r.getSelection().toString().length&&(!i||!i.isEditing)&&("copy"===e||!this.copyOnly)&&(null===(o=n.selectedRecords)||void 0===o?void 0:o.length)>0&&(!s||Boolean(s.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)")))}async copy(){await this.copyRows()}async cut(){await this.copyRows(!0)}paste(e){return this.pasteRows(null!=e&&e.isModel?e:null)}async copyRows(e=!1){const{client:t,entityName:n}=this,r=this.selectedRecords.filter((t=>!t.readOnly||!e));r.length&&!t.readOnly&&(await this.writeToClipboard(r,e),t.trigger("copy",{records:r,isCut:e,entityName:n}))}setIsCut(e,t){var n;null===(n=this.grid.rowManager.getRowById(e))||void 0===n||n.toggleCls("b-cut-row",t),e.meta.isCut=t}handleCutData({source:e}){var t;e!==this&&null!==(t=this.cutData)&&void 0!==t&&t.length&&this.grid.store.remove(this.cutData)}stringConverter(e){const{rowManager:t}=this.grid,n=e.flatMap((e=>{var n;return null===(n=t.getRowById(e))||void 0===n?void 0:n.cells.map((e=>new Kc(e)))}));return this.cellsToString(n.filter((e=>e)))}async beforeCopy({data:e,isCut:t}){return await this.client.trigger("beforeCopy",{records:e,isCut:t,entityName:this.entityName})}async pasteRows(e){var t,n,r;const i=this,{client:s,isCut:o,entityName:a}=i,l=e||s.selectedRecord;if(s.readOnly||s.isTreeGrouped)return[];const c=await i.readFromClipboard({referenceRecord:l},!0),d=i.clipboardData===c;if(!Array.isArray(c)||null==c||!c.length||s.store.tree&&o&&c.some((e=>e.contains(l,!0))))return[];i.sortByIndex(c);const u=i.extractParents(c,{},d);return await i.insertCopiedRecords(u,l),s.isDestroying?void 0:(o?await i.clearClipboard():s.selectedRecords=u,s.trigger("paste",{records:u,originalRecords:c,referenceRecord:l,isCut:o,entityName:a}),i.clipboard.triggerPaste(i),null===(t=s.getRowFor(u[u.length-1]))||void 0===t||null===(n=t.cells)||void 0===n||null===(r=n[0])||void 0===r||r.focus(),u)}async beforePaste({referenceRecord:e,data:t,text:n,isCut:r}){const i=t!==n?t:[];return await this.client.trigger("beforePaste",{records:i,referenceRecord:e,isCut:r,entityName:this.entityName,data:t})}stringParser(e){return this.setFromStringData(e,!0).modifiedRecords}generateNewName(e){const t=e.getValue(this.nameField);let n=2;for(;this.client.store.findRecord(this.nameField,`${t} - ${n}`);)n++;return`${t} - ${n}`}insertCopiedRecords(e,t){const{store:n}=this.client,r=n.indexOf(t)+1;return n.tree?t.parent.insertChild(e,t.nextSibling,!1,{orderedBeforeNode:t.nextOrderedSibling}):n.insert(r,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach((t=>{e.includes(t.record)||e.push(t.record)})),e}getMenuItemText(e,t=!1){const n=this;let r=n[e+"RecordText"];return t&&(r+=` (${n.selectedRecords.length>1?n.rowSpecifierTextPlural:n.rowSpecifierText})`),r}populateCellMenu({record:e,items:t,cellSelector:n}){var r;const i=this,{client:s,rowOptionsOnCellContextMenu:o}=i,a=!0===(null===(r=s.features.cellCopyPaste)||void 0===r?void 0:r.enabled),l=a&&s.isCellSelected(n);s.readOnly||s.isTreeGrouped||!1!==(null==e?void 0:e.isSpecialRow)||!(a?s.selectedRows.length:s.selectedRecords.length)||l&&!i.rowOptionsOnCellContextMenu||(i.copyOnly||(t.cut={text:i.getMenuItemText("cut",l&&o),localeClass:i,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly,onItem:()=>i.cut()},t.paste={text:i.getMenuItemText("paste",l&&o),localeClass:i,icon:"b-icon b-icon-paste",weight:140,onItem:()=>i.paste(e),disabled:!1===i.hasClipboardData()}),t.copy={text:i.getMenuItemText("copy",l&&o),localeClass:i,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>i.copy()})}sortByIndex(e){const{store:t}=this.client;return e.sort(((n,r)=>{const i=n.indexPath,s=r.indexPath;if(!e.includes(n.parent)&&!e.includes(r.parent))return t.indexOf(n)-t.indexOf(r);if(i.length===s.length){for(let e=0;e<i.length;e++){if(i[e]<s[e])return-1;if(i[e]>s[e])return 1}return 0}return i.length-s.length}))}extractParents(e,t,n=!0){const r=this,{store:i}=r.client;i.tree&&e.forEach((t=>{t.traverse((t=>{const n=t.getTopParent(!0);e.includes(t)||r.isCut&&e.some((e=>n.includes(e)))||e.push(t)}))}));const s=e.reduce(((e,s)=>{let o;const a=s.parentId||s.meta.modified;return r.isCut?(o=s,o.meta.isCut=!1):(o=s.copy(),n&&(o[r.nameField]=r.generateNewName(o)),o.data.expanded=s.isExpanded(r.client.store)),t[s.id]=o,s.parent===i.rootNode?e.push(o):a in t?t[a].appendChild(o,!0):e.push(o),e}),[]);return s.forEach((e=>{e.sortOrderedChildren(!0,!0)})),s}}ev.featureClass="b-row-copypaste",ev._$name="RowCopyPaste",Ed.registerFeature(ev,!0,"Grid"),Ed.registerFeature(ev,!1,"Gantt"),Ed.registerFeature(ev,!1,"SchedulerPro"),Ed.registerFeature(ev,!1,"ResourceHistogram");class tv extends(mi(fi)){static $name="RowReorder";static configurable={showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1,dragHelperConfig:null};static get deprecatedEvents(){return{gridRowBeforeDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDrag:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrag` event is deprecated, listen on this event on the Grid instead."},gridRowBeforeDropFinalize:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDropFinalize` event is deprecated, listen on this event on the Grid instead."},gridRowDrop:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrop` event is deprecated, listen on this event on the Grid instead."},gridRowAbort:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowAbort` event is deprecated, listen on this event on the Grid instead."}}}construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=Hc.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!0,dragWithin:t.bodyContainer,allowDropOutside:!0,scrollManager:t.scrollManager,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},setXY(e,t,n){const{context:i}=this;if(!i.started){const e=wn.from(i.element,this.dragWithin),t=i.startPageY-r.pageYOffset-i.element.getBoundingClientRect().top;n=e.top+t+this.proxyTopOffset}Br.setTranslateXY(e,t,n)},ignoreSamePositionDrop:!1,createProxy(e){const n=e.cloneNode(!0),r=document.createElement("div");if(r.classList.add("b-row-reorder-proxy"),n.removeAttribute("id"),n.style.transform="",n.style.width="",r.appendChild(n),t.selectedRecords.length>1){const e=n.cloneNode(!0);e.classList.add("b-row-dragging-multiple"),r.appendChild(e)}return Br.removeClsGlobally(r,"b-selected","b-hover","b-focused"),r},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onAbort",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),t.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=Br.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}static pluginConfig={after:["onInternalPaint"]};get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}isElementDraggable(e,t){if(!e.closest(".b-grid-cell .b-widget")){if(!this.gripOnly)return!0;{const n=e.closest(".b-grid-cell:first-child");if(n){const e=getComputedStyle(n,":before"),r=(this.grid.rtl?n.getBoundingClientRect().width-t.borderOffsetX:t.borderOffsetX)<=parseFloat(e.width);return r&&(this.client.preventDragSelect=!0),r}}}}onBeforeDragStart({event:e,source:t,context:n}){const r=this,{grid:i}=r,{group:s}=i.features,o=r.targetSubGridElement;if(e.target.classList.contains("b-rowexpander-shadowroot-container")||r.disabled||i.readOnly||i.isTreeGrouped||!o.contains(n.element))return!1;const a=n.startRecord=i.getRecordFromElement(n.element);if(null!=s&&s.enabled&&Array.isArray(a[i.features.group.field]))return!1;if(a.readOnly||a.isSpecialRow)return!1;n.originalRowTop=i.rowManager.getRowFor(a).top,i.selectionMode.checkboxOnly||("touch"===t.startEvent.pointerType?i.isSelected(a)||i.selectRow({record:a,addToSelection:!1}):i.isSelected(a)||e.shiftKey||e.ctrlKey||i.selectRow({record:a}));const l=i.selectedRecords.filter((e=>!e.readOnly));return n.records=[a],l.includes(a)&&(n.records.push(...l.filter((e=>e!==a))),n.records.sort(((e,t)=>i.store.indexOf(e)-i.store.indexOf(t)))),!0}onDragStart({context:e}){var t,n;const r=this,{grid:i}=r,{cellEdit:s,cellMenu:o,headerMenu:a}=i.features;s&&(r.cellEditDisabledState=s.disabled,s.disabled=!0),null==o||null===(t=o.hideContextMenu)||void 0===t||t.call(o,!1),null==a||null===(n=a.hideContextMenu)||void 0===n||n.call(a,!1),i.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");null==l||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),i.bodyContainer.appendChild(r.dropIndicator)}onDrag({context:e,event:t}){const n=this,{grid:r}=n,{store:i,rowManager:s}=r,{clientY:o}=t;let a,l,c,d,u,h=!0,g=s.getRowAt(o);if(g){const e=g.top+r.scrollable.element.getBoundingClientRect().top-r.scrollable.y,s=g.height/4,u=e+s,h=e+g.height/2,m=e+3*s;l=g.dataIndex,a=i.getAt(l),i.tree?d=(a.isParent||n.dropOnLeaf)&&o>u&&o<m:i.isGrouped&&(d=a.isGroupHeader&&a.meta.collapsed),c=!d&&t.clientY>=h}else t.pageY<r._bodyRectangle.y?(l=0,a=i.first,c=!1):(l=i.count-1,a=i.last,c=!0),g=r.rowManager.getRow(l);if(a!==n.overRecord||n.after!==c||n.over!==d){var m;if(n.overRecord!==a)null===(m=s.getRowById(n.overRecord))||void 0===m||m.removeCls(n.dropOverTargetCls);n.overRecord=a,n.after=c,n.over=d,(a===e.startRecord||!c&&!d&&0===l&&i.isGrouped||c&&a.isGroupHeader&&a.meta.collapsed&&i.indexOf(a)===i.count-1)&&(h=!1),i.tree?(u=c?a.nextSibling:a,e.records.some((e=>e.contains(a)))&&(h=!1),e.parent=h&&d?a:a.parent,n.clearTimeout(n.hoverTimer),a&&a.isParent&&!a.isExpanded(i)&&(n.hoverTimer=n.setTimeout((()=>r.expand(a)),n.hoverExpandTimeout))):u=c?i.getAt(l+1):a,g.toggleCls(n.dropOverTargetCls,h&&d),!d&&l===i.indexOf(e.startRecord)+(c?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(h=!1),g&&Br.setTranslateY(n.dropIndicator,Math.max(g.top+(c?g.element.getBoundingClientRect().height:0),1)),n.dropIndicator.style.visibility=d?"hidden":"visible",n.dropIndicator.classList.toggle("b-drag-invalid",!h),e.insertBefore=u,e.valid=n.reorderValid=h}else e.valid=n.reorderValid}async onDrop(e){const t=this,{client:n}=t,{context:r}=e;if(r.valid=r.valid&&t.reorderValid,r.valid){r.async=!0,n.store.tree&&(r.oldPositionContext=r.records.map((e=>{var t;return{record:e,parentId:null===(t=e.parent)||void 0===t?void 0:t.id,parentIndex:e.parentIndex}})));let i=await t.trigger("gridRowBeforeDropFinalize",e);!1===i&&(r.valid=!1),i=await n.trigger("gridRowBeforeDropFinalize",e),!1===i&&(r.valid=!1),await t.dragHelper.animateProxyTo(t.dropIndicator,{align:"l0-l0"}),await t.finalizeReorder(r)}t.clearTimeout(t.hoverTimer),t.overRecord=t.after=t.over=null,t.trigger("gridRowDrop",e),n.trigger("gridRowDrop",e)}onAbort(e){this.client.trigger("gridRowDragAbort",e)}async finalizeReorder(e){const t=this,{grid:n}=t,{store:r,focusedCell:i}=n;let{records:s}=e;if(e.valid=e.valid&&!s.some((e=>!r.includes(e))),e.valid){let l;var o,a;if(r.tree)s=s.filter((e=>!e.parent||e.bubbleWhile((e=>!s.includes(e)),!0))),l=await e.parent.tryInsertChild(s,t.over?null===(o=e.parent.children)||void 0===o?void 0:o[0]:e.insertBefore),n.rowManager.forEach((e=>e.removeCls(t.dropOverTargetCls))),!e.parent.isExpanded()&&null!==(a=e.parent.children)&&void 0!==a&&a.length&&n.expand(e.parent),e.valid=!1!==l;else if(r.isGrouped&&t.over)r.move(s,r.getAt(r.indexOf(e.insertBefore)+1));else{if(s.length>1)for(;e.insertBefore&&s.includes(e.insertBefore);)e.insertBefore=r.getNext(e.insertBefore,!1,!0);r.move(s,e.insertBefore)}(null==i?void 0:i._rowIndex)>=0&&(n._focusedCell=null,n.focusCell({grid:n,record:i.record,columnId:i.columnId})),r.clearSorters()}e.finalize(e.valid),n.element.classList.remove("b-row-reordering")}onReset(){const e=this,{grid:t}=e,n=t.features.cellEdit;t.element.classList.remove("b-row-reordering"),n&&(n.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),Br.removeClsGlobally(t.element,...e.dropOverTargetCls)}onInternalPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}get isDragging(){return this.dragHelper.isDragging}}tv.featureClass="",tv._$name="RowReorder",Ed.registerFeature(tv,!1);class nv extends fi{static $name="RowResize";static configurable={applyToAllRows:null,cellSelector:".b-grid-cell",minHeight:20,maxHeight:0};construct(e,t){const n=this;super.construct(...arguments),n.resizer=new qh({name:"rowResize",targetSelector:".b-grid-row:not(.b-group-header)",handleContainerSelector:".b-grid-row",outerElement:e.element,direction:"vertical",dragThreshold:1,handleSize:Math.min(5,.1*e.rowHeight),internalListeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,cancel:n.onCancel,thisObj:n},allowResize(t,r){var i;return null===(i=e.hoveredCell)||void 0===i?void 0:i.matches(n.cellSelector)},overTopHandle(e,t){if(this.canResize(t,e)&&"0"!==t.dataset.index){const n=wn.from(t);return n.height=this.handleSize,n.height>0&&Math.abs(n.top-Zn.getPagePoint(e).top)<this.handleSize}return!1},internalBeforeStart(e){const{edge:t,element:n}=e;if("top"===t)return{edge:"bottom",element:n.previousElementSibling}},onResizeHandlePointerDown(t){e.selectionDisabled=!0,e.features.rowReorder&&(n._oldReorderDisabled=e.features.rowReorder.disabled,e.features.rowReorder.disabled=!0),e.setTimeout((()=>{e.selectionDisabled=!1}),10)}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({source:e,context:t}){const{client:n}=this,r=this.applyToAllRows||n.fixedRowHeight;t.record=n.store.getById(t.element.dataset.id),t.oldHeight=t.record.rowHeight,n.store.suspendAutoCommit(),Object.assign(e,{minHeight:this.minHeight,maxHeight:this.maxHeight,skipUpdatingElement:!r}),n.element.classList.add("b-row-resizing")}onResizing({context:e}){this.applyToAllRows||this.client.fixedRowHeight||!e.valid||(e.record.rowHeight=e.newHeight)}onResize({context:e}){const{client:t}=this;this.applyToAllRows||t.fixedRowHeight?t.rowHeight=e.newHeight:t.selectionMode.multiSelect&&t.selectedRecords.includes(e.record)&&t.selectedRecords.forEach((t=>t.rowHeight=e.newHeight)),this.cleanup()}onCancel({context:e}){this.applyToAllRows||this.client.fixedRowHeight||(e.record.rowHeight=e.oldHeight),this.cleanup()}cleanup(){const{client:e}=this;e.element.classList.remove("b-row-resizing"),e.store.resumeAutoCommit(),"boolean"==typeof this._oldReorderDisabled&&(e.features.rowReorder.disabled=this._oldReorderDisabled)}}nv._$name="RowResize",Ed.registerFeature(nv,!1);const rv={goToNextHit:1,goToPrevHit:1};class iv extends(mi(fi)){static $name="Search";static configurable={limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}};static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,Br.NodeFilter.SHOW_TEXT,(()=>Br.NodeFilter.FILTER_ACCEPT))}),e.ion({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable({actionName:e}){if(rv[e])return Boolean(this.text)}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,t=!0,n=!1,r,i=!1){var s;const o=this;if(!e)return o.clear();if(!n&&e===o.text||o.disabled)return;const{grid:a,store:l}=o,c=a.columns.visibleColumns.filter((e=>!1!==e.searchable)),d=[];r=r||c.map((e=>{var t;return d.push(null===(t=e.formatValue)||void 0===t?void 0:t.bind(e)),e.field}));const u=l.search(e,r,d);l.isTree&&u.length&&await a.expandTo(u.map((e=>e.id)));for(const e of c)if(e.mergeCells&&e.isSorted){let t=null,n=null;for(const r of u)if(r.field===e.field){const e=r.data[r.field];e===t&&(r.belongsTo=n),t=e,n=`${r.field}-${r.id}`}}let h=1;if(Object.assign(o,{foundMap:{},prevFound:o.found,found:u,text:e,findRe:new RegExp(`(\\s+)?(${$.escapeRegExp(String(e))})(\\s+)?`,"ig")}),o.clearHits(),u){for(const e of u)if(o.foundMap[`${e.field}-${e.id}`]=e.belongsTo?o.foundMap[e.belongsTo]:h++,h>o.limit)break;return o.listenersInitialized||(a.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:o}),l.ion({name:"storeRefresh",[`refresh${a.asyncEventSuffix}`]:"onStoreRefresh",thisObj:o}),o.listenersInitialized=!0),a.refreshRows(),a.trigger("search",{grid:a,find:e,found:u}),!t||o.isHitFocused||i||o.gotoNextHit(!0),null===(s=a.syncSplits)||void 0===s||s.call(a,(i=>i.features.search.search(e,t,n,r,!0))),u}}clearHits(){for(const e of Br.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const t=qc.get(e).row;t&&(t.forceInnerHTML=!0,t.renderCell(e),t.forceInnerHTML=!1)}}clear(e=!1){const t=this,{grid:n}=t;var r;(t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(t.detachListeners("renderCell"),t.detachListeners("storeRefresh"),t.listenersInitialized=!1),e)||(n.trigger("clearSearch",{grid:n}),null===(r=n.syncSplits)||void 0===r||r.call(n,(e=>e.features.search.clear())))}get foundCount(){var e;return(null===(e=this.found)||void 0===e?void 0:e.length)??0}get isHitFocused(){var e;const t=this,{grid:n}=t,{focusedCell:r}=n;if(null!=r&&null!==(e=r.cell)&&void 0!==e&&e.contains(Br.getActiveElement(n.element))){const{rowIndex:e,column:n}=r;return-1!==e&&t.found.some((t=>t.index===e&&n&&t.field===n.field))}}gotoNextHit(e=!1){var t;const n=this;if(null===(t=n.found)||void 0===t||!t.length)return;const{grid:r,store:s}=n,o=r.focusedCell||r.lastFocusedCell,a=o&&!0!==e?s.indexOf(o.record,i,!0):-1,l=n.found.findIndex((e=>e.index>a));-1!==l&&n.gotoHit(l)}gotoPrevHit(){var e;const t=this,{store:n}=t;if(null===(e=t.found)||void 0===e||!e.length)return;const{grid:r,found:s}=t,o=r.focusedCell||r.lastFocusedCell,a=o?n.indexOf(o.record,i,!0):0;for(let e=s.length-1;e--;e>=0){if(s[e].index<a){t.gotoHit(e);break}}}gotoHit(e){const{grid:t}=this,n=this.found[e];return n&&t.focusCell({field:n.field,id:n.id}),Boolean(n)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:n,value:r}){var i;const s=this,{treeWalker:o,findRe:a,hitTextCls:l,showHitIndex:c}=s,d=null===(i=s.foundMap)||void 0===i?void 0:i[t.field+"-"+n.id];if(d){var u;e.classList.add(s.hitCls),c&&(null===(u=e.querySelector(`.${s.hitCellBadgeCls}`))||void 0===u||u.remove());const t=Br.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(r).toLowerCase()===String(s.text).toLowerCase())t.innerHTML=`<span class="${s.hitTextCls}">${t.innerHTML}</span>${c?`<div class="${s.hitCellBadgeCls}">${d}</div>`:""}`;else{o.currentNode=t;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],c=e[3]?" ":"";r.push(`${$.encodeHtml(t)}${s}<span class="${l}">${$.encodeHtml(o)}</span>${c}`),i=a.lastIndex}r.push($.encodeHtml(n.substring(i)),"<span>"),t.parentNode.insertBefore(Br.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}c&&Br.createElement({parent:e,className:s.hitCellBadgeCls,text:d})}s.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:n,cellElement:i}){const s=this;e.searchable&&(n.search={text:"L{searchForValue}",localeClass:s,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:s.disabled,onItem:()=>{let e=r.getSelection().toString();e||(e=i.innerText),s.search(e)}})}onStoreRefresh(){this.search(this.text,!1,!0)}}iv.featureClass="b-search",iv._$name="Search",Ed.registerFeature(iv);const sv=Object.freeze([]);class ov extends fi{static $name="Sort";static configurable={multiSort:!0,prioritizeColumns:!1,toggleOnHeaderClick:!0};static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(this.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){var t;this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),null!==(t=this.client)&&void 0!==t&&t.isPainted&&this.syncHeaderSortState()}set field(e){var t;const n=this.grid.columns.get(e);n&&"object"==typeof n.sortable&&(n.sortable.field=n.sortable.property||e,e=n.sortable),null!==(t=this.store.sorters)&&void 0!==t&&t.some((t=>t.field===e))||this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onInternalPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters.concat(e.store.groupers||sv),i=r.length,s=new Tn;let o;for(const a of t.columns.visibleColumns){if(!a.sortable)continue;const t=a.element,l=a.textWrapper,c=null==l?void 0:l.dataset;let d="none";var n;if((null==c?void 0:c.sortIndex)&&delete c.sortIndex,s.value=t.classList,!1===a.sortable)s.remove(e.sortableCls),null==l||null===(n=l.querySelector(".b-sort-icon"))||void 0===n||n.remove();else null!=l&&l.querySelector(".b-sort-icon")||Br.createElement({parent:l,className:"b-sort-icon"}),s.add(e.sortableCls),o=r.find((e=>e.field===a.field||e.sortFn&&e.sortFn===a.sortable.sortFn)),o?(i>1&&c&&(c.sortIndex=r.indexOf(o)+1),s.add(e.sortedCls),o.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls),d="ascending"):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls),d="descending")):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)));Br.syncClassList(t,s),Br.setAttributes(t,{"aria-sort":d})}}}populateHeaderMenu({column:e,items:t}){const n=this,{store:r}=n,i={...e.sortable,field:e.field,columnOwned:!0};if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>r.sort(i,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:n.disabled,onItem:()=>r.sort(i,!1)},n.multiSort&&n.grid.columns.records.some((e=>e.sortable)))){const s=r.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn));t.multiSort={text:"L{multiSort}",localeClass:n,icon:"b-fw-icon b-icon-sort",weight:320,disabled:n.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&(null==s?void 0:s.ascending),weight:330,onItem:()=>r.addSorter(i,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:()=>r.addSorter(i,!1)},removeSorter:{text:"L{removeSorter}",localeClass:n,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:()=>{r.removeSorter(i.field)}}}}}}getColumnDragToolbarItems(e,t){const n=this,{store:r,disabled:i}=n;if(!1!==e.sortable){const s=r.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>r.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var n;const i=e[r],s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.field);null!=s&&null!==(n=s.sortable)&&void 0!==n&&n.sortFn&&(e[r]={...i,...s.sortable,columnOwned:!0})}}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=r.closest(".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!(t.ignoreRe.test(r.className)||t.disabled||e.handled)&&i&&s&&(t.toggleOnHeaderClick||r.closest(".b-sort-icon"))){const r=t.grid.columns.getById(i.dataset.columnId);if(n.isGrouped&&n.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(r.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)n.removeSorter(r.field);else{const i={columnOwned:!0,field:r.field};"object"==typeof r.sortable&&Xt.assign(i,r.sortable),n.sort(i,null,e.ctrlKey&&t.multiSort)}}}renderHeader(){this.syncHeaderSortState()}onInternalPaint(){this.syncHeaderSortState()}}ov.featureClass="b-sort",ov._$name="Sort",Ed.registerFeature(ov,!0);class av extends fi{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,Br.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:n,contentElement:r}=e,i=wn.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(i.y),o=s!==e.currentTopRow;if(s){o&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));const t=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[t?"add":"remove"]("b-hide-visibility"),e.currentTopRow[t?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,Br.alignTo(n,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:n}=e,r={"b-grid-sticky-row":1},i={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),o=e.stickyEls||(e.stickyEls=[]);for(o.forEach((e=>{e.classList.remove("b-sticky-content-el")})),o.length=0,t.eachElement((t=>{o.push(...t.querySelectorAll(e.contentSelector))}));s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,o.map((t=>{t.closest(".b-grid-cell").classList.forEach((e=>i[e]=1)),t.closest(".b-grid-row").classList.forEach((e=>r[e]=1)),Object.assign(i,n),Object.assign(r,n);const o=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,o),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+o),t.style.alignSelf="";const a=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),s.appendChild(a),a})),i["b-focused"]=!1,Br.syncClassList(e.contentElement,i),Br.syncClassList(e.element,r),s}}av._$name="StickyCells",Ed.registerFeature(av,!1);class lv extends fi{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,n=e.dataIndex%2==0;e.assignCls({"b-even":!t&&n,"b-odd":!t&&!n})}}lv._$name="Stripe",Ed.registerFeature(lv);const cv=Object.freeze({animate:!1,block:"start"}),dv=Object.freeze({animate:!1,block:"end"}),uv={split:1,unsplit:1};class hv extends fi{static $name="Split";static featureClass="";static configurable={subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}};static pluginConfig={chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener"],assign:["split","unsplit","subViews","syncSplits"]};#e=!1;restorers=[];doDestroy(){this.unsplit(!0),super.doDestroy()}doDisable(e){const t=this;t.isConfiguring||(e?(t._disabledSplitOptions=t._splitOptions,t.unsplit()):t._disabledSplitOptions&&(t.split(t._disabledSplitOptions),t._disabledSplitOptions=null))}get isSplit(){var e;return Boolean(null===(e=this.widgets)||void 0===e?void 0:e.length)}getClientConfig(e,t,n,r={}){const{client:i}=this,{subGrids:s,regions:o}=i,a=i.columns.records.slice(),l=Xt.assign({},i.subGridConfigs);if(i.eachSubGrid((e=>{const t=l[e.region];e.flex?t.flex=e.flex:t.width=e.element.style.width})),n.atColumn&&o.length>1&&t>0){const e=o.indexOf(n.atColumn.region);for(let t=0;t<e;t++){const e=s[o[t]];H.remove(a,...e.columns.records),delete l[o[t]]}}const c=Xt.assign({},i.initialConfig,{appendTo:e,insertFirst:null,insertBefore:null,splitFrom:i,owner:i.owner,tbar:i.initialConfig.tbar&&1===t?{height:i.tbar.height,items:[" "]}:null,store:i.store,selectedRecordCollection:i.selectedRecordCollection,subGridConfigs:l,columns:this.cloneColumns(a),minHeight:0,minWidth:0},r);for(const e of Xt.keys(this.relayProperties))c[e]=i[e];const d={};for(const e in i.listeners)if(!uv[e]){const t=i.listeners[e].filter((e=>!e.$internal));t.length&&(d[e]=t)}return c.listeners=d,("horizontal"===n.direction||"both"===n.direction&&1!==t)&&(c.hideHeaders=!0),delete c.data,delete c.adopt,c}cloneColumns(e){return e.flatMap((e=>{if(e.meta.isSelectionColumn||"expanderActionColumn"===e.field)return[];const t={...e.data};return e.children&&(t.children=e.children.map((e=>({...e.data})))),delete t.headerRenderer,delete t.parentId,t}))}cloneClient(e,t,n,r){const i=this.getClientConfig(e,t,n,r),s=new this.client.constructor(i);return s.element.classList.add("b-split-clone"),s}processOptions(e){const{client:t}=this,{atRecord:n,atColumn:r,direction:i}=e;if(i){if("vertical"!==i&&!n&&t.store.count){const n=t._bodyRectangle.height/2+t.scrollable.y,r=t.rowManager.getRowAt(n,!0)??t.rowManager.rows[Math.ceil(t.rowManager.rows.length/2)];e.atRecord=t.store.getById(r.id)}if("horizontal"!==i&&!r){const n=wn.from(t.element);let r=n.center.x-n.x,i=t.subGrids[t.regions[0]],s=0,o=null;for(;r>i.width;)r-=i.width,i=t.subGrids[t.regions[++s]];r+=i.scrollable.x;const{visibleColumns:a}=i.columns;let l=0,c=0;for(;l<r&&c<a.length;)o=a[c++],l+=o.element.offsetWidth;e.atColumn=o}}else e.direction=n&&r?"both":r?"vertical":"horizontal";return e}createSplitContainer({direction:e}){const{client:t}=this,{element:n}=t;return this.splitContainer=Br.createElement({parent:n.parentElement,className:{"b-split-container":1,[`b-split-${e}`]:1,"b-rtl":t.rtl},style:{width:n.style.width,height:n.style.height},children:["both"!==e&&n,"both"===e&&{className:"b-split-top",children:[n]},"both"===e&&{className:"b-split-bottom"}]})}syncHeaderHeights(){let e=0;for(const t of this.subViews)t.eachSubGrid((t=>{t.header.height>e&&(e=t.header.height)}));for(const t of this.subViews)t.eachSubGrid((t=>{t.header.height=e}))}toggleOriginalSubGrids(e){const t=this,{client:n}=t,{regions:r}=n;if(e.atColumn&&r.length>1){const i=r.indexOf(e.atColumn.region),s=[n];"both"===e.direction&&s.push(t.subViews[2]);for(const e of s)if(i+1<r.length){const s=e===n,o=e.subGrids[r[i]];o.hideSplitter(),s&&t.restorers.push((()=>o.showSplitter())),o.flex||(n.inForEachOther=!0,o.flex=1,n.inForEachOther=!1,s&&t.restorers.push((()=>{o.flex=null,o.width=o._initialWidth})));for(let n=i+1;n<r.length;n++){const i=e.subGrids[r[n]];i.hide(),s&&t.restorers.push((()=>{i.show()}))}2===r.length&&(e._initialWidth=e.element.style.width,e._initialFlex=e.flex,e.width=o._initialWidth,s&&t.restorers.push((()=>{null!==e._initialFlex?e.flex=e._initialFlex:null!==e._initialWidth&&(e.width=e._initialWidth)})))}}}async split(e={}){const t=this,{client:n}=t;if(n.splitFrom)return;t.isSplit&&await t.unsplit(!0);const{rtl:r}=n,{atRecord:i,atColumn:s,direction:o}=t.processOptions(e);let{splitX:a,remainingWidth:l}=e,c=null,d=null;if(i){await n.scrollRowIntoView(i);const e=n.getRowFor(i);if(!e)throw new Error(`Could not find row for record ${i.id}`);c=wn.from(e.cells[0],n.element).bottom,d=wn.from(n.element).height-c}if(s&&!a&&(a=wn.from(s.element,n.element).getEnd(r),l=wn.from(n.element).width-a-Br.scrollBarWidth,r)){const e=a;a=l+Br.scrollBarWidth,l=e-Br.scrollBarWidth}const u=[],h=t.createSplitContainer(e),{visibleColumns:g}=n.columns,m=s?g[g.indexOf(s)+1]:null,p=i?n.store.getNext(i):null;if(n.eachSubGrid((e=>e._initialWidth=e.width)),n.columns.commit(),"both"!==o){const r={flex:`0 0 ${(null!=c?d:l)-7}px`,height:null},[,i]=t.widgets=[new Fp({appendTo:h}),t.cloneClient(h,"vertical"===o?1:0,e,r)];null!=a&&(n.renderRows(),e.atDate||(u.push(n.scrollColumnIntoView(s,dv)),m&&u.push(i.scrollColumnIntoView(m,cv)))),null!=c&&u.push(i.scrollRowIntoView(p,cv)),n.element.classList.add("b-split-start"),i.element.classList.add("b-split-end"),n.scrollable.addPartner(i.scrollable,{x:"horizontal"===o,y:"horizontal"!==o})}else{const r={flex:`0 0 ${l-7}px`};h.lastElementChild.style.flex=`0 0 ${d-7}px`,t.widgets=[new Fp({insertBefore:h.lastElementChild}),t.topSplitter=new Fp({appendTo:h.firstElementChild}),t.cloneClient(h.firstElementChild,1,e,r),t.cloneClient(h.lastElementChild,0,e),t.bottomSplitter=new Fp({appendTo:h.lastElementChild}),t.cloneClient(h.lastElementChild,2,e,r)];const i=n,o=t.widgets[2],g=t.widgets[3],f=t.widgets[5];i.element.classList.add("b-split-top-start"),o.element.classList.add("b-split-top-end"),g.element.classList.add("b-split-bottom-start"),f.element.classList.add("b-split-bottom-end"),null!=a&&(i.renderRows(),g.renderRows(),s&&!e.atDate&&(u.push(n.scrollColumnIntoView(s,dv)),m&&u.push(o.scrollColumnIntoView(m,cv)))),null!=c&&u.push(g.scrollRowIntoView(p,cv),f.scrollRowIntoView(p,cv)),i.scrollable.addPartner(o.scrollable,"y"),i.scrollable.addPartner(g.scrollable,"x"),o.scrollable.addPartner(f.scrollable,"x"),g.scrollable.addPartner(f.scrollable,"y"),t.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:t}),t.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:t})}t.subViews=[n,...t.widgets.filter((e=>e.isGridBase))],t.toggleOriginalSubGrids(e),t.syncHeaderHeights(),t._splitOptions=e,await Promise.all(u);const f=wn.from(n.element);return n.onInternalResize(n.element,f.width,f.height),n.eachSubGrid((e=>{const t=wn.from(e.element);e.onInternalResize(e.element,t.width,t.height)})),n.scrollable.x+=.5,n.scrollable.y+=.5,t.startSyncingColumns(),n.trigger("split",{subViews:t.subViews,options:e}),t.subViews}async unsplit(e=!1){const t=this,{client:n}=t,{element:r}=n;var i;if(t.isSplit&&(t.stopSyncingColumns(),null===(i=t.widgets)||void 0===i||i.forEach((e=>e.destroy())),t.widgets=null,n.eachSubGrid((e=>e.scrollable.x)),n.scrollable.y,t.splitContainer.parentElement.appendChild(r),t.splitContainer.remove(),t.splitContainer=null,r.style.flexBasis=r.style.flexGrow="",r.classList.remove("b-split-top-start","b-split-start"),t.subViews.length=0,!t.isDestroying)){n.renderRows(),t.unsplitCleanup();for(const e of t.restorers)e();if(t.restorers.length=0,await N.animationFrame(),await N.animationFrame(),t.isDestroyed)return;!e&&n.trigger("unsplit"),t._splitOptions=null}}unsplitCleanup(){}populateCellMenu({record:e,column:t,items:n}){const r=this,{isSplit:i}=r,{splitFrom:s}=r.client;r.disabled||(n.splitGrid={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:i||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:e})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atColumn:t})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atColumn:t,atRecord:e})}}}},n.unsplitGrid={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(i||s),weight:400,separator:!0,onItem(){(s||r).unsplit()}})}startSyncingColumns(){for(const e of this.subViews)e.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}stopSyncingColumns(){this.detachListeners("columns")}onColumnsChange({source:e,isMove:t,action:n,parent:r,records:i,changes:s}){const o=this;if(!o.#e){o.#e=!0;for(const a of o.subViews){const{columns:l}=a;if(e!==l){if("update"===n&&s.region&&1===Object.keys(s).length){if(l.getById(i[0].id))l.remove(i[0].id);else{const[e]=i,t=l.getById(o.$before.parent.id)??l.rootNode,n=null!==o.$before.id&&l.getById(o.$before.id);t.insertChild(e.data,n)}o.$before=null}else if(null!=t&&t[i[0].id]||!0===t){if("add"===n){const e=i[0],t=e.nextSibling,n=l.getById(e.id);if(!n){o.$before={id:null==t?void 0:t.id,parent:r},o.#e=!1;continue}if(e.meta.isSelectionColumn){o.#e=!1;continue}const s=l.getById(r.id)??l.rootNode,a=t&&l.getById(t.id);s.insertChild(n,a)}}else if("add"===n){const e=i.filter((e=>a.getSubGridFromColumn(e)));l.add(o.cloneColumns(e))}else l.applyChangesFromStore(e);l.commit()}}e.commit(),o.#e=!1}}getOtherSplitter(e){return e===this.topSplitter?this.bottomSplitter:this.topSplitter}onSplitterMouseDown({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseDown(t))}onSplitterDrag({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseMove(t))}onSplitterDrop({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseUp(t))}afterConfigChange({name:e,value:t}){this.isSplit&&this.relayProperties[e]&&this.syncSplits((n=>{n[e]=t}))}afterAddListener(e,t){!this.isSplit||t.$internal||uv[e]||this.syncSplits((n=>n.on(e,t)))}afterRemoveListener(e,t){t.$internal||this.syncSplits((n=>n.un(e,t)))}forEachOther(e){const t=this.client.splitFrom||this.client;if(t.features.split.enabled&&!t.inForEachOther){t.inForEachOther=!0;for(const n of t.subViews)n!==this.client&&e(n);t.inForEachOther=!1}}syncSplits(e){this.forEachOther(e)}}hv._$name="Split",Ed.registerFeature(hv,!1);class gv extends(Uf(fi)){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:t}=this;e?t.element.classList.add("b-summary-disabled"):(this.updateSummaries(),t.element.classList.remove("b-summary-disabled"),t.eachSubGrid((e=>e.scrollable.syncPartners())))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:n}=e,r=Br.children(t.element,".b-grid-footer"),i=e.selectedOnly&&t.selectedRecords.length>0,s=(n.isFiltered?n.storage.values:n.allRecords).filter((e=>!e.isSpecialRow&&(!i||t.isSelected(e))));t.columns.forEach((e=>{var t;null===(t=e.summaries)||void 0===t||t.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}))})),r.forEach((n=>{if(!n.dataset.column)return;const r=t.columns.get(n.dataset.column),i=e.generateHtml(r,s,"b-grid-footer-summary");(r.summaries?r.summaries.length:!!r.sum)&&(n.children.length?Br.sync(i,n.firstElementChild):n.innerHTML=i)}))}onStoreChange({action:e,changes:t}){let n=!0;this.disabled||("update"===e&&(n=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),n&&this.updateSummaries())}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.ion({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.updateSummaries()}}gv.featureClass="b-summary",gv._$name="Summary",Ed.registerFeature(gv);const mv=Promise.resolve();class pv extends(fi.mixin(mi)){static $name="Tree";static configurable={expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}};static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore","beforeRenderRow"]}}construct(e,t){super.construct(e,t),this.treeColumn||console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:t}=e.client;return e._treeColumn&&t.includes(e._treeColumn)||(e._treeColumn=t.find((e=>e.isTreeColumn))),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t){if(null==e)throw new Error("Tree#toggleCollapse must be passed a record");const n=this,{store:r,client:i}=n,{rowManager:s}=i,o=r.getById(e),a=o.instanceMeta(r);if(o.generation++,await r.toggleCollapse(o,t)){const e=s.getRowFor(o);e&&o.ancestorsExpanded()&&e.render(null,null,!1),n.isTogglingNode||(i.element.classList.add("b-toggling-node"),n.isTogglingNode=!0,n.requestAnimationFrame((()=>{i.element.classList.remove("b-toggling-node"),n.isTogglingNode=!1}))),i.trigger(a.collapsed?"collapseNode":"expandNode",{record:o}),i.trigger("toggleNode",{record:o,collapse:a.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.client.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(n);null==r||r.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(n);null==r||r.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.client.rowManager.getRowFor(e);null==t||t.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,t=this.store.rootNode){const{client:n,store:r}=this,{animateTreeNodeToggle:i}=n,s=[],o=[];return n.trigger("beforeToggleAllNodes",{collapse:e}),n.animateTreeNodeToggle=!1,r.suspendEvents(),r.traverse((t=>{const n=t.instanceMeta(r);t.isLeaf||(e&&!n.collapsed?(this.toggleCollapse(t,!0),o.push(...t.children)):!e&&n.collapsed&&(Array.isArray(t.children)&&o.push(...t.children),s.push(this.toggleCollapse(t,!1))))}),t,t===r.rootNode),r.resumeEvents(),(e?mv:Promise.all(s)).then((()=>{n.refreshRows(e),o.length&&(e?r.trigger("remove",{records:o,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:o,isExpand:!0,isExpandAll:!0})),n.trigger("toggleAllNodes",{collapse:e}),n.animateTreeNodeToggle=i}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,t=!0){const n=this,{store:r,client:i}=n,{animateTreeNodeToggle:s}=i;if(Array.isArray(e)){if(e.length>0){i.suspendRefresh();for(let t=e.length-1;t>=0;t--){var o;const s=r.getById(e[t]);var a;if(0===t)null===(a=i.resumeRefresh)||void 0===a||a.call(i),i.rowManager.refresh();await(null===(o=n.expandTo)||void 0===o?void 0:o.call(n,s,0===t))}}return}const l=r.getById(e);if(!1!==l.instanceMeta(n.store).hiddenByCollapse){if(i.animateTreeNodeToggle=!1,!l.ancestorsExpanded()){var c,d;const e=[];for(let t=l.parent;t&&!t.isRoot;t=t.parent)t.isExpanded(r)||e.unshift(t);i.suspendRefresh();for(const t of e)n.isDestroyed||await n.toggleCollapse(t,!1);null===(c=i.resumeRefresh)||void 0===c||c.call(i),null===(d=i.refreshRows)||void 0===d||d.call(i)}i.animateTreeNodeToggle=s,!n.isDestroyed&&t&&await i.scrollRowIntoView(l)}}onElementPointerUp(e){const t=this,n=e.target,r=t.client.getCellDataFromEvent(e);(n.closest(".b-tree-expander")||t.expandOnCellClick&&null!=r&&r.record.isParent)&&t.toggleCollapse(r.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return(null==e?void 0:e.rowIndex)>-1&&!e.isActionable&&(this.toggleCollapse(e.id),!0)}beforeRenderRow({record:e,cls:t}){if(e.isLeaf)t["b-tree-parent-row"]=0,t["b-tree-collapsed"]=0,t["b-tree-expanded"]=0,t["b-loading-children"]=0;else{const n=!e.isExpanded(this.client.store);t["b-tree-parent-row"]=1,t["b-tree-collapsed"]=n,t["b-tree-expanded"]=!n,t["b-loading-children"]=e.instanceMeta(this.client).isLoadingChildren}}expandIfSingleColumn(){return 1===this.client.columns.count&&this.expandByKey()}expandByKey(){const e=this,{client:t}=e,{focusedCell:n}=t,r=null==n?void 0:n.record;return!!(r&&null!=n&&n.column.tree&&r.isParent&&r.instanceMeta(t.store).collapsed)&&(e.expand(r),!0)}collapseIfSingleColumn(){return 1===this.client.columns.count&&this.collapseByKey()}collapseByKey(){const e=this,{client:t}=e,{focusedCell:n}=t,r=null==n?void 0:n.record;if(null!=n&&n.column.tree&&r){if(r.isParent&&!r.instanceMeta(t.store).collapsed)return e.collapse(r),!0;if(r.parent&&!r.parent.isRoot)return t.deselectAll(),t.focusCell({record:r.parent,column:n.column}),!0}return!1}}pv.featureClass="b-tree",pv._$name="Tree",Ed.registerFeature(pv,!1,"Grid"),Ed.registerFeature(pv,!0,"TreeGrid");class fv extends fi{static $name="TreeGroup";static configurable={levels:[],parentCls:"b-generated-parent",parentRenderer:null,hideGroupedColumns:null,refreshGroupsTimeout:100};static pluginConfig={chain:["populateHeaderMenu"],assign:["group","clearGroups","refreshGroups"]};static properties={isApplying:0,originalStore:null};construct(e,t){if(this.treeColumn=e.columns.find((e=>e.isTreeColumn)),super.construct(e,t),this._levels=this._levels||[],!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}applyPluginConfig(){return this.scheduleRefreshGroups=Me.createBuffered(this.refreshGroups,this.refreshGroupsTimeout,this),super.applyPluginConfig(...arguments)}processParentData(e){const t=this;t.parentCls&&(e.cls=t.parentCls)}processTransformedData(e){}async waitForReadiness(){const e=this;if(e.originalStore.isLoading&&(await e.originalStore.await("load",!1),e.isDestroyed))return;const{crudManager:t}=this.client;if(t){var n;if((t.isLoadingOrSyncing||t._autoLoadPromise)&&await t.await("requestDone"),e.isDestroyed)return;await(null===(n=e.client.project)||void 0===n?void 0:n.commitAsync())}}async applyLevels(e){const t=this,{client:n,treeColumn:r}=t;let i,{store:s}=n,o=null;const{modelClass:a}=s;if(null!=r&&r.field&&a.getFieldDefinition(r.field)&&(i=a.getFieldDataSource(r.field)),0!==(e=e||[]).length||!t.isConfiguring){var l;if(t._levels=e,t.isApplying++,n.suspendRefresh(),!t.originalStore)t.originalStore=s,s=new s.constructor({reapplyFilterOnAdd:!0,reapplyFilterOnUpdate:!0,tree:!0,modelClass:s.modelClass,load:null===(l=s.load)||void 0===l?void 0:l.bind(s),commit:s.commit.bind(s)}),n.store=s,t.originalStore.ion({name:"originalStore",refresh:t.onOriginalStoreRefresh,add:t.onOriginalStoreChanged,remove:t.onOriginalStoreChanged,removeAll:t.onOriginalStoreChanged,thisObj:t});if(await t.waitForReadiness(),!t.isDestroyed){if(e.length>0){const n=t.originalStore.getAllDataRecords(!1).flatMap((e=>e.isLeaf?e.link():[]));n.forEach((e=>e.setInstanceMeta(s.id,{collapsed:!1}))),s.data=n,o=s.treeify(e,(e=>{i&&Xt.setPath(e,i,e.key),t.processParentData(e)})),t.processTransformedData(o),await t.trigger("beforeDataLoad",{store:s,data:o.children}),s.data=o.children}else n.store=t.originalStore,t.detachListeners("originalStore"),t.originalStore=null;t.isApplying--,n.resumeRefresh(!1),n.isPainted&&n.renderRows(!1),n.trigger("treeGroupChange",{levels:e})}}}doDisable(e){e&&this.clearGroups(),super.doDisable(e)}onOriginalStoreChanged(){this.scheduleRefreshGroups()}onOriginalStoreRefresh({action:e}){"dataset"!==e&&"filter"!==e||this.scheduleRefreshGroups()}updateLevels(e,t){const n=this,{client:r}=n;n.hideGroupedColumns&&(null==t||t.forEach((t=>{t=t.fieldName||t,e.some((e=>(e.fieldName||e)===t))||r.columns.get(t).show()})),null==e||e.forEach((e=>{e=e.fieldName||e,t&&t.some((t=>t.fieldName===e))||(r._suspendRenderContentsOnColumnsChanged=!0,r.columns.get(e).hide(),r._suspendRenderContentsOnColumnsChanged=!1)}))),!e&&n.isConfiguring||(n.updatePromise=n.applyLevels(e),r.renderContents())}async group(e){Xt.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&(this.levels=[],await this.updatePromise)}refreshGroups(){var e;return null===(e=this.applyLevels)||void 0===e?void 0:e.call(this,this._levels)}get isGrouped(){return this._levels.length>0}populateHeaderMenu({column:e,items:t}){const n=this;let r=!1;!1!==e.groupable&&!e.isTreeColumn&&!n.isGroupedByField(e.field)&&(t.groupAsc={text:"L{group}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",separator:!0,weight:400,disabled:n.disabled,onItem:()=>n.addGrouper(e)},r=!0),n.isGrouped&&(n.isGroupedByField(e.field)&&(t.groupRemove={text:"L{stopGroupingThisColumn}",localeClass:n,icon:"b-fw-icon b-icon-clear",separator:!r,weight:420,disabled:n.disabled,onItem:()=>n.removeGrouper(e)},r=!0),t.groupRemoveAll={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",separator:!r,weight:420,disabled:n.disabled,onItem:()=>n.clearGroups()})}addGrouper(e){this.levels=this.levels.concat(e.field)}isGroupedByField(e){return this.levels.find((t=>t.fieldName===e))}removeGrouper(e){this.levels.splice(this.levels.findIndex((t=>t.fieldName===e.field)),1),this.levels=this.levels.slice()}}fv._$name="TreeGroup",Ed.registerFeature(fv);var vv=e=>class extends e{static get $name(){return"PrintMixin"}static get configurable(){return{useBrowserPrint:!0,exporterType:"multipagevertical"}}static get pluginConfig(){return{assign:["print","showPrintDialog"]}}showPrintDialog(e){return this.showExportDialog(e)}print(e){return this.export(e)}async onPrintIFrameLoad(e){}async showBrowserPrintDialog(e,t){if(await this.onPrintIFrameLoad(e),!1!==await this.client.trigger("beforeShowPrintDialog",{iframe:e})){const{contentWindow:n}=e;n.onafterprint=()=>{e.remove(),t()},n.print()}else e.remove(),t()}doPrint(e){const t=this;return new Promise(((n,r)=>{const i=document.createElement("iframe");i.className="b-print-wrapper",i.style.visibility="hidden",i.style.height="0",i.onload=()=>{var s;const o=i.contentWindow.document,{body:a}=o,l=new DOMParser;let c;e.forEach((({html:e})=>{const t=l.parseFromString(e,"text/html"),n=o.adoptNode(t.body.firstChild),r=o.createElement("div");t.head.querySelectorAll('style,link[rel="stylesheet"],link[as="style"]').forEach((e=>{const t=o.adoptNode(e);o.head.appendChild(t)})),r.classList.add("b-page-wrap"),r.style.height=t.body.parentElement.style.height,r.style.width=t.body.parentElement.style.width,c=parseFloat(t.body.parentElement.style.height),a.appendChild(r),r.appendChild(n)}));const{html:d}=e[0];a.className=(null===(s=d.match(/<body class="(.+?)"/))||void 0===s?void 0:s[1])||"",a.classList.add("b-print"),a.parentElement.classList.add("b-print-root"),a.parentElement.style.height=c*e.length+"in",Promise.all(Array.from(o.head.querySelectorAll('link[rel="stylesheet"]')).map((e=>new Promise(((t,n)=>{e.onload=t,e.onerror=n}))))).then((()=>o.fonts.ready)).then((()=>t.showBrowserPrintDialog(i,n))).catch((e=>{console.warn("Failed to load stylesheets "+(e.message?`: ${e.message}`:"")),r(t.L("L{PdfExport.Export failed}"))}))},t.client.element.parentElement.appendChild(i)}))}};class yv extends(vv(Cu)){static $name="Print"}yv._$name="Print",Ed.registerFeature(yv,!1,"Grid");class bv extends ye{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}export(e={}){const t=this;return e=Xt.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter((e=>!1!==e.exportable));e.columns=t.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){const{columns:t,rows:n}=e;if(0===t.length||0===(null==n?void 0:n.length))return[];const r=this,{target:i}=r;return(n||i.store).map((n=>r.processRecord(n,t,e))).filter((e=>null==e?void 0:e.length))}getColumnType(e,t=this.target.store){let n=e.exportedType||"object";if(e.exportedType===i&&e.field){const r=t.modelClass.getFieldDefinition(e.field);r&&"auto"!==r.type&&(n=r.type)}return n}processColumn(e,t){const{target:n}=this,{defaultColumnWidth:r}=t;let{field:i,text:s,width:o,minWidth:a}=e;if(i in n.store.modelClass.fieldMap||(i=""),!s||!o){const e=n.columns.find((e=>e.field===i));s||(s=e&&e.text||i),null==o&&(o=e&&e.width||r)}return o=Math.max(o||r,a||r),{field:i,value:s,width:o,type:this.getColumnType(e)}}processRecord(e,t,n){const{target:r}=this,{showGroupHeader:i,indent:s,indentationSymbol:o}=n;let a;return e?e.isSpecialRow?i&&e.meta.groupRowFor&&(a=t.map((t=>r.features.group.buildGroupHeader({cellElement:Br.createElement(),grid:r,record:e,column:t})))):a=t.map((t=>{let i=e.getValue(t.field);const a=t.renderer||t.defaultRenderer;return!a||i&&t.isDateColumn&&n.exportDateAsInstance||(i=a.call(t,{value:i,record:e,column:t,grid:r,isExport:!0})),s&&t.tree&&(i=`${o.repeat(e.childLevel)}${i}`),i})):a=t.map((()=>"")),a}}bv._$name="TableExporter";class Cv{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"✓":""}}Cv._$name="BooleanUnicodeSymbol";class Sv extends fi{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:bv,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return e===i||null===e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:n,columns:r}=t.exporter.export(e.exporterConfig);return{rows:n.map((n=>n.map(((n,i)=>{var s;n instanceof Date?n=Gt.format(n,e.dateFormat):"boolean"==typeof n&&(n=new Cv(n)),t.convertEmptyValueToEmptyString&&(n=t.processValue(n));return{value:n,type:"number"===(null===(s=r[i])||void 0===s?void 0:s.type)?"number":"string"}})))),columns:r.map((e=>{let{field:t,value:n,width:r,type:i}=e;return i="string",{field:t,value:n,width:r,type:i}}))}}export(e={}){const t=this,n=t.zipcelx||r.zipcelx;if(!n)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=Xt.assign({},t.config,e)).filename||(e.filename=t.client.$$name);const{filename:i}=e,{rows:s,columns:a}=t.generateExportData(e);if(e.csv){const t=e.csv.columnDelimiter||",",n=e.csv.lineDelimiter||"\n",r=a.map((e=>this.processCsvValue(e.value))).join(t)+n,l=s.map((e=>e.map((e=>this.processCsvValue(e.value))).join(`${t}`))).join(n),c=new Blob([r+l],{type:"text/csv"});return o.downloadBlob(c,i),Promise.resolve()}return n({filename:i,sheet:{data:[a].concat(s),cols:a}})}processCsvValue(e=""){return`"${String(e).replace(/"/g,'""')}"`}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=r.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}Sv._$name="ExcelExporter",Ed.registerFeature(Sv,!1,"Grid");class Dv extends fi{static $name="FileDrop";construct(e,t){const n=this;super.construct(e,t),Zn.on({element:e.element,thisObj:n,drop:n.onFileDrop,dragover:n.onFileDragOver,dragenter:n.onFileDragEnter,dragleave:n.onFileDragLeave})}onFileLoad(e){this.client.trigger("fileDrop",{file:this.file,domEvent:e})}onFileDragEnter(){this.client.element.classList.add("b-dragging-file")}onFileDragOver(e){e.preventDefault()}onFileDragLeave(e){const{element:t}=this.client;e.relatedTarget&&!t.contains(e.relatedTarget)&&this.client.element.classList.remove("b-dragging-file")}onFileDrop(e){e.preventDefault();const t=e.dataTransfer.items[0].getAsFile();this.client.trigger("fileDrop",{file:t,domEvent:e}),this.onFileDragLeave(e)}}Dv._$name="FileDrop",Ed.registerFeature(Dv,!1,"Grid");class wv extends ru{static get $name(){return"Grid"}static get type(){return"grid"}}wv.initClass(),wv._$name="Grid";class Ev extends wv{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}}Ev.initClass(),Ev._$name="TreeGrid";class xv extends Ec{static type="groupbar";static $name="GroupBar";static configurable={selectedCls:"not-used",itemTpl(e){return $.encodeHtml($.capitalize(e.getValue(this.displayField)))}};construct(){super.construct(...arguments);const e=this.treeGrid=this.up("gridbase",!0);if(!e)throw new Error("GroupBar must be used inside a Grid component");e.ion({paint:this.onTreePaint,once:!0,thisObj:this})}onTreePaint(){const e=this,{treeGrid:t}=e,{treeGroup:n,columnReorder:r}=t.features;if(!n)throw new Error("GroupBar widget requires the TreeGroup feature to be present");r.usingGroupBarWidget=!0,e.store=new ao({fields:["cls","ascending"],internalListeners:{add:e.onStoreChanged,remove:e.onStoreChanged,thisObj:e}}),t.ion({treeGroupChange:e.onTreeGroupChanged,beforeColumnDropFinalize:e.onBeforeColumnDropFinalize,columnDrag:e.onColumnDrag,columnDragStart:e.onColumnDragStart,columnDrop:e.onColumnDrop,thisObj:e}),e.onTreeGroupChanged({levels:n.levels})}onStoreChanged({records:e}){var t;const n=this,{treeGrid:r}=n;n.treeGrid.isConstructing||"b-drop-target"===(null==e||null===(t=e[0])||void 0===t?void 0:t.cls)||(n.ignoreGroupChange=!0,r.features.treeGroup.levels=n.store.map((({field:e})=>e)),n.ignoreGroupChange=!1)}onTreeGroupChanged({levels:e}){if(!this.ignoreGroupChange){if(e.some((e=>e instanceof Function&&!e.fieldName)))throw new Error("GroupBar only supports column grouping");this.store.data=(e||[]).map((e=>(e=e.fieldName||e,this.treeGrid.columns.get(e))))}}onColumnDragStart(){this.store.add({id:"placeholder",cls:"b-drop-target"})}onColumnDrag({context:e,column:t,event:n}){n.target.closest(".b-groupbar")&&(e.valid=!0)}onBeforeColumnDropFinalize({column:e,event:t}){t.target.closest(".b-groupbar")&&(e.isTreeColumn||(this.store.getById("placeholder").remove(),this.store.add(e)))}onColumnDrop(){var e;null===(e=this.store.getById("placeholder"))||void 0===e||e.remove()}}xv.initClass(),xv._$name="GroupBar";class Rv extends Mc{static $name="TreeCombo";static type="treecombo";static configurable={multiSelect:!0,picker:{type:"treegrid",minWidth:"35em",disableGridRowModelWarning:!0,selectionMode:{row:!0,rowCheckboxSelection:!0}},chipView:{itemTpl:e=>$.xss`${e.name}`,scrollable:{overflowX:"hidden-scroll"}}};changePicker(e,t){var n;return null===(n=e=super.changePicker(e,t))||void 0===n||n.ion({selectionChange:"onPickerSelectionChange",thisObj:this}),e}updateMultiSelect(e){super.updateMultiSelect(...arguments),this.picker.selectionMode.multiSelect=e}updateReadOnly(e){super.updateReadOnly(...arguments),this.picker.readOnly=e}get value(){return super.value}set value(e){var t;this._settingValue=!0,super.value=e,this.picker.selectedRecords=(null===(t=e.map)||void 0===t?void 0:t.call(e,(e=>this.store.getById(e))))||[],this._settingValue=!1}onPickerSelectionChange({selection:e}){this._settingValue||(this.value=e)}}Rv.initClass(),Rv._$name="TreeCombo";class Tv extends af{compositeField=!0;static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){return e.getValue(this.field)-t.getValue(this.field)}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:n,largeStep:r}=this;return Xt.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:n,largeStep:r})}get durationUnitField(){return`${this.field}Unit`}roundValue(e){const t="number"==typeof this.grid.durationDisplayPrecision?this.grid.durationDisplayPrecision:this.decimalPrecision,n=Math.pow(10,t);return Math.round(e*n)/n}formatValue(e,t){return e instanceof us&&(t=e.unit,e=e.magnitude),(e=this.roundValue(e))+" "+Gt.getLocalizedNameOfUnit(t,1!==e)}defaultRenderer({value:e,record:t,isExport:n}){const r=typeof e,i="number"===r?e:null==e?void 0:e.magnitude,s="number"===r?t.getValue(this.durationUnitField):null==e?void 0:e.unit;return"number"!=typeof i?n?"":null:this.formatValue(i,s)}toClipboardString({record:e}){return e.getValue(this.field).toString()}fromClipboardString({string:e,record:t}){const n=Gt.parseDuration(e,!0,this.durationUnit);return n&&"magnitude"in n?n:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}}id.registerColumnType(Tv),Tv._$name="DurationColumn";const Mv={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var kv=e=>class extends e{static $name="TimeZonedDatesMixin";static fields=[{name:"timeZone",persist:!1}];get timeZone(){return this.getData("timeZone")}set timeZone(e){this.setData("timeZone",e)}setLocalDate(e,t){const n=this;n.set(e,null!=n.timeZone?ig.toTimeZone(t,n.timeZone):t,!0),n.setData(e,n[e])}getLocalDate(e){return null!=this.timeZone&&this[e]?ig.fromTimeZone(this[e],this.timeZone):this[e]}applyChangeset(e){if(null!=this.timeZone)for(const t in Mv)e[t]&&(this.setLocalDate(t,new Date(e[t])),delete e[t]);return super.applyChangeset(...arguments)}getFieldPersistentValue(e){if(null!=this.timeZone){const t=(null==e?void 0:e.field)??(null==e?void 0:e.name)??e;if(Mv[t])return this.getLocalDate(t)}return super.getFieldPersistentValue(e)}convertToTimeZone(e){const t=this,n={...t.meta.modified},r={...Mv};t.isTask&&!t.manuallyScheduled&&(delete r.startDate,delete r.endDate);for(const e in r)null!=t[e]?(r[e]=t[e],null!=t.timeZone&&(r[e]=t.getLocalDate(e),n[e]&&(n[e]=ig.fromTimeZone(n[e],t.timeZone)))):delete r[e];t.timeZone=e;for(const e in r)t.setLocalDate(e,r[e],!1),r[e]=1,null!=t.timeZone&&n[e]&&(n[e]=ig.toTimeZone(n[e],t.timeZone));t.clearChanges(!0,!0,r),Xt.isEmpty(n)||(t.meta.modified=n,t.stores.forEach((e=>e.modified.add(t))))}};class Iv extends(ds.mixin(kv)){static $name="TimeSpan";static fields=[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}];construct(e,...t){const n=this;if(null!=e&&e.fullDuration){const{magnitude:t,unit:n}=e.fullDuration;e.duration=t,e.unit=n,delete e.fullDuration}super.construct(e,...t),n.normalize(),n.startDateMS&&n.endDateMS&&n.startDateMS>n.endDateMS&&console.error(`startDate > endDate for ${n.constructor.$name} record with id: ${n.id}`)}internalCalculateStartDate(e,t,n){return Gt.add(e,-t,n)}internalCalculateEndDate(e,t,n){return Gt.add(e,t,n)}internalCalculateDuration(e,t,n){return Gt.as(n,Gt.diff(e,t,"h"),"h")}internalNormalize(e,t,n,r){const i=this,s=null!=n;e&&t&&!s?i.setData("duration",i.internalCalculateDuration(e,t,r)):e&&!t&&s?i.setData("endDate",i.internalCalculateEndDate(e,n,r)):!e&&t&&s&&i.setData("startDate",i.internalCalculateStartDate(t,n,r))}normalize(){this.internalNormalize(this.startDate,this.endDate,this.duration,this.durationUnit||this.constructor.defaultValues.durationUnit)}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;var t;e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore)));return e._eventStore}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Tn(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return null!=e&&e.isDomClassList?e:(this.updateInternalCls(e),this.setData("cls",this._cls.value),this._cls)}get cls(){return this._cls||(this._cls=new Tn(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:t,startDate:n}=e;return t||Gt.add(n,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:t,...this.updateDatesFromDuration(e,t)})}updateDatesFromDuration(e,t,n=this.startDate,r=this.endDate){const i={};return n?i.endDate=this.internalCalculateEndDate(n,e,t):r&&(i.startDate=this.internalCalculateStartDate(r,e,t)),i}getDurationInUnit(e,t){const n=this;return n.startDate&&n.endDate?Gt.getDurationInUnit(n.startDate,n.endDate,e,t):Gt.as(e,n.duration,n.durationUnit)}get fullDuration(){return new us({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=Gt.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const n=this,r={startDate:e};if(e){let i;if(t)i=null!=n.duration;else if(n.endDate){if(r.duration=n.internalCalculateDuration(e,n.endDate,n.durationUnit),r.duration<0)throw new Error("Negative duration")}else i=null!=n.duration;i&&(r.endDate=n.internalCalculateEndDate(e,n.duration,n.durationUnit))}else r.duration=null;n.set(r)}setEndDate(e,t=!1){const n=this,r={endDate:e};if(e){let i;if(!0===t)i=null!=n.duration;else if(n.startDate){if(r.duration=n.internalCalculateDuration(n.startDate,e,n.durationUnit),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.startDate=n.internalCalculateStartDate(e,n.duration,n.durationUnit))}n.set(r)}setStartEndDate(e,t,n){if(e>t)throw new Error("Start date must be less or equal to end date");this.set({startDate:e,endDate:t},null,n)}get dates(){const e=[],t=Gt.startOf(this.startDate,"day"),n=this.endDate;for(let r=t;r<n;r=Gt.add(r,1,"day"))e.push(r);return e}get startDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:t}=this;return e&&t?e-t:Gt.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return 0===this.duration}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:n,duration:r,durationUnit:i=this.durationUnit}=e;"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof n&&(n=this.getFieldDefinition("endDate").convert(n)),"duration"in e?(t&&!n&&(n=this.internalCalculateEndDate(t,r,i)),!t&&n&&(t=this.internalCalculateStartDate(n,r,i))):t&&n&&(r=this.internalCalculateDuration(t,n,i));const s=Object.isFrozen(e)?Xt.clone(e):e;return t&&(s.startDate=t),n&&(s.endDate=n),null!=r&&(s.duration=r),s}}fieldToKeys(e,t){const n=super.fieldToKeys(e,t);if(n.fullDuration){const{magnitude:e,unit:t}=n.fullDuration;n.duration=e,n.durationUnit=t}return this.isEventModel||this.isTaskModel||!("duration"in n)&&!n.durationUnit||n.startDate&&n.endDate||Object.assign(n,this.updateDatesFromDuration(n.duration??this.duration,n.durationUnit??this.durationUnit,n.startDate,n.endDate)),n}inSet(e,t,n,r,i,s,o){var a;const l=this;i||(e=l.inSetNormalize(e)||e);const c=super.inSet(e,t,n,r,i,s,o);if((null===(a=l.project)||void 0===a||!a.isWritingData)&&e.startDate&&e.endDate){let t;e.startDate instanceof Date&&e.endDate instanceof Date?t=e.startDate>e.endDate:l.fieldMap.startDate.convert(e.startDate)>l.fieldMap.endDate.convert(e.endDate)&&(t=!0),t&&console.error(`startDate > endDate for ${l.constructor.$name} record with id: ${l.id}`)}return c}applyValue(e,t,n,r,i){"cls"===t&&this.updateInternalCls(n),super.applyValue(e,t,n,r,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const n=e;e=t,t=n}return this.setStartDate(Gt.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const n=this.startDate,r=this.endDate;return n&&r&&Gt.intersectSpans(n,r,e,t)}split(e=.5){const t=this,n=t.copy(),{fullDuration:r,eventStore:i,assignmentStore:s}=t,o=new us(r),a=new us(r);let l,c;return"string"==typeof e?(l=new us(e),l.unit===o.unit?a.magnitude-=l.magnitude:(a.magnitude=Gt.as(l.unit,o)-l.magnitude,a.unit=l.unit,c=!0)):(l=new us(e>1?e:t.duration*e,t.durationUnit),a.magnitude-=l.magnitude),n.startDate=Gt.add(t.startDate,l.magnitude,l.unit),c?(n.fullDuration=a,t.fullDuration=l):(n.duration=a.magnitude,t.duration=l.magnitude),i&&(i.add(n),s&&!i.usesSingleAssignment&&s.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:n.id,event:null,resource:null});return delete t.id,t})))),n}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:t,endDate:n}=this,r=e.DTSTAMP||Gt.format(new Date,"uu");delete e.DTSTAMP;let i={};i=this.allDay?{"DTSTART;VALUE=DATE":Gt.format(t,"u"),"DTEND;VALUE=DATE":Gt.format(n,"u")}:{DTSTART:Gt.format(t,"uu"),DTEND:Gt.format(n,"uu")};const s={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${_.scheduler&&_.getVersion("scheduler")||_.calendar&&_.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:r,...i,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},a=Object.keys(s).map((e=>`${e}:${s[e]}`)),l=Object.keys(o).map((e=>`${e}:${o[e]}`));return a.splice(a.length-1,0,...l),a.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});o.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return!!this.getFieldDefinition(e)||i}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}Iv._$name="TimeSpan";class Av extends ds{static $name="ViewPreset";static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:n}=t,r=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=n,t=e-1;t>=0;t--){const{unit:e,increment:i}=n[t],s=i>1;r.push(`${s?i:""}${t?e:$.capitalize(e)}${s?"s":""}`)}i=r.join("And")}return e.count&&e.includes(i)&&(i+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(i)&&(i+=`-${t.bottomHeader.increment}`,e.includes(i)&&(i=vs.generateId(`${i}-`)))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:n,shiftUnit:r}=e;if(n)for(let e=0,{length:t}=n;e<t;e++){const t=n[e];t.unit=Gt.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=Gt.normalizeUnit(t.splitUnit)),"increment"in t||(n[e]=Object.assign({increment:1},t))}t&&(t.unit=Gt.normalizeUnit(t.unit)),r&&(e.shiftUnit=Gt.normalizeUnit(r))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:n,mainHeaderLevel:r}=e,i=e.headers=[];if(t.top&&("top"===n&&(e.columnLinesFor=0),"top"===r&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===n&&(e.columnLinesFor=i.length),"middle"===r&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==n?e.columnLinesFor=i.length-1:"bottom"===n&&(e.columnLinesFor=i.length),null==r&&(e.mainHeaderLevel=i.length-1),"bottom"===r&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:n}=t;switch(n){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(Gt.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const n of e.headers)t=t&&Boolean(Gt.normalizeUnit(n.unit));return e.timeResolution&&(t=t&&Gt.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&Gt.normalizeUnit(e.shiftUnit)),t}}Av._$name="ViewPreset";qe.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:e=>e+" event"+(1!==e?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event",color:"Color"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:n})=>`Every ${e} years on ${t} of ${n}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}});class Fv extends(rt(ao)){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:Av,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const n=e.bottomHeader,r=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||zt[n.unit]-zt[r.unit]||n.increment-r.increment)*this.zoomOrder}))}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&r.bryntum.PresetManager.getById(e)}createRecord(e,...t){let n;if(e.isViewPreset)return e;if("string"==typeof e)n=this.getById(e);else{if("number"!=typeof e)return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...t);n=this.getAt(e)}if(!n)throw new Error(`ViewPreset ${e} does not exist`);return n}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let n=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);"string"==typeof n&&t.baseId&&(n=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),n&&"object"==typeof n&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&n.topDateFormat&&(n.middleDateFormat=n.middleDateFormat||n.topDateFormat),t.setData("displayDateFormat",n.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const r=t.headerConfig[e],i=n[e+"DateFormat"];r&&(r.originalDateFormat||(r.originalDateFormat=r.dateFormat),i&&r.renderer&&(r.renderer=null),r.dateFormat=i||r.originalDateFormat)})),n.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",n.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return t=Xt.clone(t.data),delete t.id,e.name&&delete t.name,Xt.merge(t,e)}add(e){return(e=Array.isArray(e)?e:[e]).forEach((e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))})),super.add(...arguments)}}Fv._$name="PresetStore";const Pv=new class extends Fv{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${Gt.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${Gt.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${Gt.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${Gt.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>Gt.getShortNameOfUnit("week")+"."+Gt.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,mainHeaderLevel:0,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,n)=>Gt.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const n in e)e[n].id=n,t[n]=this.createRecord(e[n])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:n}=e;t<n;t++){const n=e[t],r="string"==typeof n,s=r?n:n.base;let o;if(r)o=this.basePresets[s];else{const e=Object.setPrototypeOf(Xt.clone(this.basePresets[s].data),{id:s}),{timeResolution:t}=e,r=e.headers[e.headers.length-1];e.id=i,"width"in n&&(e.tickWidth=n.width),"height"in n&&(e.tickHeight=n.height),"increment"in n&&(r.increment=n.increment),"resolution"in n&&(t.increment=n.resolution),"resolutionUnit"in n&&(t.unit=Gt.getUnitByName(n.resolutionUnit)),o=this.createRecord(e),o.baseId=s}this.add(o)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const n=this.createRecord(Object.assign({id:e},t)),r=this.find((e=>e.equals(n)));if(r)return r;if(!n.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(n),n}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof Av||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof Av))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=Xt.merge(Xt.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(Xt.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};r.bryntum.PresetManager=Pv;class Ov extends Iv{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class Lv extends ao{static get defaultConfig(){return{modelClass:Ov,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.ion({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,n=!1){const r=this,i=r.getAdjustedDates(e.startDate,e.endDate),s={};if(!1!==r.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate;for(const t in e)s[t]=r[t];const i=e.viewPreset&&e.viewPreset!==r.viewPreset;if(i&&(n=r.isFiltered,r.filters.forEach((e=>e.disabled=!1))),Object.assign(r,e),!1===r.internalOnReconfigure(n,i))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1,t){const n=this;n.isConfigured=!0;const r=n.getAdjustedDates(n.startDate,n.endDate,!0),i=n.getAdjustedDates(n.startDate,n.endDate),s=i.startDate,o=i.endDate;if(s>=o)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${o}.`);const{unit:a,increment:l=1}=n,c=n.generateTicks(s,o,a,l)||n.constructor.prototype.generateTicks.call(n,s,o,a,l);n.suspendEvents(),n.maintainFilter=e,n.data=c,n.maintainFilter=!1;const{count:d}=n;if(0===d){if(e)return t&&n.disableFilters(),n.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}n.startDate=n.first.startDate,n.endDate=n.last.endDate,n.resumeEvents(),n.isContinuous?(n.adjustedStart=r.startDate,n.adjustedEnd=Gt.getNext(d>1?c[d-1].startDate:r.startDate,a,l,n.weekStartDay)):(n.adjustedStart=n.startDate,n.adjustedEnd=n.endDate),n.updateVisibleTickBoundaries(),n.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:n,startDate:r,endDate:i,weekStartDay:s,increment:o=1}=e,a=Gt.getNormalizedUnitDuration(r,n)*o,l=Gt.getNormalizedUnitDuration(i,n)*o;do{e.visibleTickStart=(r-e.adjustedStart)/a,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=Gt.getNext(e.adjustedStart,n,o,s))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-i)/l,t-e.visibleTickEnd>=1&&(e.adjustedEnd=Gt.getNext(e.adjustedEnd,n,-1,s))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!(e=Pv.getPreset(e)).isViewPreset)throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){return this._weekStartDay??Gt.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,n=!1){t&&e-t==0&&(t=null);const r=this,{startDate:i,endDate:s}=r.getAdjustedDates(e,t);if(r.startDate-i!=0||r.endDate-s!=0)return r.reconfigure({startDate:i,endDate:s},!1,n)}shift(e,t=this.shiftUnit){const n=this;let{startDate:r,endDate:i}=n;n.isFiltered&&(r=n.allRecords[0].startDate,i=n.allRecords[n.allCount-1].endDate);let s=0;do{r=Gt.add(r,e,t),i=Gt.add(i,e,t)}while(s++<n.maxTraverseTries&&!1===n.setTimeSpan(r,i,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){this.filters.clear(),super.filterBy(((n,r)=>e.call(t,n.data,r)))}filter(){const e=this,t=super.filter(...arguments);return e.maintainFilter||0!==e.count||(e.resumeEvents(),e.trigger("invalidFilter"),e.disableFilters()),t}disableFilters(){this.filters.forEach((e=>e.disabled=!0)),this.filter()}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.isFiltered}getAdjustedDates(e,t,n=!1){const r=this;return t&&e-t==0&&(t=null),e=e||r.startDate,t=t||Gt.add(e,r.defaultSpan,r.mainUnit),r.autoAdjust||n?{startDate:r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=Gt.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=Gt.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,n,r){const i=this,s=(t=!1!==t)?Gt.clone(i.startDate):null,o=r||i.resolutionIncrement,a=n||(t?i.resolutionUnit:i.mainUnit);if(t)return Gt.floor(e,{unit:a,magnitude:o},s);const l=Gt.clone(e);if("week"===a){const e=l.getDay()||7,t=i.weekStartDay||7;Gt.add(Gt.startOf(l,"day",!1),e>=t?t-e:-(7-t+e),"day",!1),l.getDay()!==t&&23===l.getHours()&&Gt.add(l,1,"hour",!1)}else{Gt.startOf(l,a,!1);const e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,n=((e,t)=>Math.floor(e/t)*t)(Gt.get(l,t)-e,o)+e;Gt.set(l,t,n)}return l}roundDate(e,t,n=this.resolutionUnit,r=this.resolutionIncrement||1){const i=this,s=Gt.clone(e);switch(t=Gt.clone(t||i.startDate),n){case"week":{Gt.startOf(s,"day",!1);let e,t=s.getDay()-i.weekStartDay;return t<0&&(t=7+t),e=1===Math.round(t/7)?7-t:-t,Gt.add(s,e,"day",!1)}case"month":{const e=Gt.diff(t,s,"month")+Gt.as("month",s.getDay()/Gt.daysInMonth(s)),n=Math.round(e/r)*r;return Gt.add(t,n,"month",!1)}case"quarter":return Gt.startOf(s,"month",!1),Gt.add(s,3-s.getMonth()%3,"month",!1);default:{const e=Gt.as(n,Gt.diff(t,s)),i="year"===n?0:Gt.as(n,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),o=Math.round((e+i)/r)*r;return Gt.add(t,o-i,n,!1)}}}ceilDate(e,t,n,r){const i=this;t=!1!==t,r=r||(t?i.resolutionIncrement:1);const s=n||(t?i.resolutionUnit:i.mainUnit),o=Gt.clone(e);let a=!1;switch(s){case"minute":a=!Gt.isStartOf(o,"minute");break;case"hour":a=!Gt.isStartOf(o,"hour");break;case"day":case"date":a=!Gt.isStartOf(o,"day");break;case"week":Gt.startOf(o,"day",!1),a=o.getDay()!==i.weekStartDay||!Gt.isEqual(o,e);break;case"month":Gt.startOf(o,"day",!1),a=1!==o.getDate()||!Gt.isEqual(o,e);break;case"quarter":Gt.startOf(o,"day",!1),a=o.getMonth()%3!=0||1!==o.getDate()||!Gt.isEqual(o,e);break;case"year":Gt.startOf(o,"day",!1),a=0!==o.getMonth()||1!==o.getDate()||!Gt.isEqual(o,e)}return a?Gt.getNext(o,s,r,i.weekStartDay):o}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,n){const{include:r}=this;return!!r&&Object.entries(r).some((([r,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(Gt.compareUnits("day",n)>=0&&Gt.getLargerUnit(r)===n&&(s&&Gt.set(e,r,s),o)){let e=n;"day"===n&&(e="date"),Gt.set(t,{[e]:Gt.get(t,e)-1,[r]:o})}if(Gt.compareUnits(r,n)>=0){const t="day"===r?e.getDay():Gt.get(e,r);if(s&&t<s||o&&t>=o)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:n,to:r}=t;t.lengthFactor=Gt.getUnitToBaseUnitRatio(e,Gt.getLargerUnit(e))/(r-n),t.lengthFactorExcl=Gt.getUnitToBaseUnitRatio(e,Gt.getLargerUnit(e))/(r-n-1),t.center=n+n/(t.lengthFactor-1)}}))}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,n=this.unit,r=this.increment){const i=this,s=[],o=Boolean(i.include);let a,l,c,d=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=Gt.getNext(u,n,r,i.weekStartDay),!i.autoAdjust&&a>h&&(a=h),"hour"===n&&r>1&&s.length>0&&0===d){const e=s[s.length-1];d=(e.startDate.getHours()+r)%24-e.endDate.getHours(),0!==d&&(a=Gt.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=i.processExclusion(u,a,n)):l=a,c||(s.push({id:s.length+1,startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t;const n=this,r=n.records,i=(null===(t=e.getTime)||void 0===t?void 0:t.call(e))??e;let s,o,a,l,c=0,d=r.length-1;if(!r.length||i<r[0].startDateMS||i>r[d].endDateMS)return-1;if(n.isContinuous){for(;c<d;)s=c+d+1>>1,i>r[s].endDateMS?c=s+1:i<r[s].startDateMS?d=s-1:c=s;return o=r[c],a=o.startDateMS,i>a&&(l=o.endDateMS,c+=(i-a)/(l-a)),Math.min(Math.max(c,n.visibleTickStart),n.visibleTickEnd)}for(let e=0;e<=d;e++)if(l=r[e].endDateMS,i<=l)return a=r[e].startDateMS,o=e+(i>a?(i-a)/(l-a):0),o}getSnappedTickFromDate(e){const t=Math.floor(this.getTickFromDate(e));return this.getAt(t)}getDateFromTick(e,t){const n=this;if(e===n.visibleTickEnd)return n.endDate;const r=Math.floor(e),i=e-r,s=n.getAt(r);if(!s)return null;const o=0===r&&n.isContinuous?n.adjustedStart:s.startDate,a=r===n.count-1&&n.isContinuous?n.adjustedEnd:s.endDate;let l=Gt.add(o,i*(a-o),"millisecond");return t&&(l=n[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,n)=>t.tickCache[e.startDate.getTime()]=n)))}dateInAxis(e,t=!1){const n=this,r=n.startDate,i=n.endDate;if(n.isContinuous)return t?Gt.betweenLesserEqual(e,r,i):Gt.betweenLesser(e,r,i);{const r=n.getCount();let i,s,o;for(let a=0;a<r;a++)if(o=n.getAt(a),i=o.startDate,s=o.endDate,t&&e<=s||!t&&e<s)return e>=i}return!1}timeSpanInAxis(e,t){const n=this;return t&&t.getTime()!==e.getTime()?n.isContinuous?Gt.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:n,endMS:r}=t,{startDateMS:i}=e,s=e.endDateMS??e.meta.endDateCached;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>n&&i<r;const o=t.getTickFromDate(e.startDate),a=t.getTickFromDate(e.endDate);return!(o===t.count&&Gt.isEqual(e.startDate,t.last.endDate)||0===a&&Gt.isEqual(e.endDate,t.first.startDate))&&(i<n&&s>r||o!==a)}forEachAuxInterval(e,t=1,n,r=this){const i=this.endDate;let s,o=this.startDate,a=0;if(o>i)throw new Error("Invalid time axis configuration");for(;o<i;)s=Gt.min(Gt.getNext(o,e,t,this.weekStartDay),i),n.call(r,o,s,a,s>=i),o=s,a++}}Lv._$name="TimeAxis";class $v extends(Ge()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const n=t.timeAxis.viewPreset||t.viewPreset;if(n)if(n instanceof Av)t.consumeViewPreset(n);else{const e=Pv.getPreset(n);e&&t.consumeViewPreset(e)}t.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:t}),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),!t&&e.count>0&&this.update()}update(e,t=!1,n=!1){const r=this,{timeAxis:i,headers:s}=r,o=0!==e;if(r.isConfiguring||o&&r._availableSpace===e)return void(n&&r.trigger("update"));if(r._availableSpace=Math.max(e||r.availableSpace||0,0),"number"!=typeof r.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");r.columnConfig=[];const a=r._tickSize=r.calculateTickSize(r.originalTickSize);if("number"!=typeof a||a<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(let e=0,{length:t}=s;e<t;e++){const t=s[e];if(t.cellGenerator){const n=t.cellGenerator.call(r,i.startDate,i.endDate);r.columnConfig[e]=r.createHeaderRow(e,t,n)}else r.columnConfig[e]=r.createHeaderRow(e,t)}t||r.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const n=this.getScaledTick(e,t);return-1===n?-1:this.tickSize*(n-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:n,isEnd:r,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l}=o;let c=o.getTickFromDate(e);if(-1!==c&&t&&a){let t=!1;if(a.hour&&Gt.compareUnits(l,"hour")>0&&"day"!==l){const{from:r,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,r),i);if(!n&&c!==l)return-1;const d=o-(o-(c+e.getMinutes()/60))*s;e=Gt.add(e,d-l,"h"),t=!0}if(a.day&&Gt.compareUnits(l,"day")>0){const{from:l,to:c,lengthFactor:d,center:u}=a.day;let h=e.getDay();r&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=c){if(!n)return-1;if(g=r?(c-h-8)%7:(l-h+7)%7,e=Gt.add(e,g,"d"),e=Gt.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:m}=o,p=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=p-(p-f)*d;e=Gt.add(e,v-f+m,"d"),t=!0}t&&(e=Gt.constrain(e,o.startDate,o.endDate),c=o.getTickFromDate(e))}return c}getDateFromPosition(e,t,n=!1){const r=this,{timeAxis:i}=r,s=r.getScaledPosition(e)/r.tickSize+i.visibleTickStart;if(s<0||s>i.count){if(n){let e;return e=s<0?Gt.add(i.startDate,s,i.unit):Gt.add(i.endDate,s-i.count,i.unit),t&&(e=i[t+"Date"](e)),e}return null}return i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:n,weekStartDay:r}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&Gt.compareUnits(n,"day")>0){const{from:n,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(n-r)*i+(e-o)}if(t.hour&&Gt.compareUnits(n,"hour")>0&&"day"!==n){const{from:n,lengthFactorExcl:r}=t.hour,s=e%i;e=s/r+n*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=Gt.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(i,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:n,timeAxis:r,suppressFit:i}=t,s=r.unit;let o=0,a=1;if(t.snap){const e=r.resolution;a=Gt.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)o=e;else{const i=t.availableSpace/r.visibleTickTimeSpan;o=n||e<i?i:e,a>0&&(!n||a<1)&&(o=Math.max(1,a*o)/a)}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,n=!1){const r=this,i=[],s=t?r.lowestHeader:e,o=r.majorHeaderLevel,a=r.headers&&r.headers[e].unit,l=null!=o&&r.headers&&r.headers[o].unit,c=null!=o&&Gt.doesUnitsAlign(l,a);if(!(!r.headers||!r.headers[s].cellGenerator)){const e=r.columnConfig[s];for(let t=1,n=e.length;t<n;t++)i.push({date:e[t].startDate})}else r.forEachInterval(s,((t,s)=>{i.push({date:n?s:t,isMajor:o!==e&&c&&r.isMajorTick(n?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,n){const r=this,i=[],{align:s,headerCellCls:o=""}=t,a=Gt.clearTime(new Date),{timeAxis:l}=r,c=r.headers.length-1,d=(n,d,h,g,m)=>{let p=Gt.format(n,t.dateFormat);const f=h>0&&!g,v={align:s,start:n,end:d,value:m?m.header:p,headerCellCls:o,width:c===e&&r.owner&&(l.fullTicks||f)?r.owner.tickSize:r.getDistanceBetweenDates(n,d),index:h};0!==v.width&&(v.coord=u-1,u+=v.width,r.headersDatesCache[e][n.getTime()]=1,t.renderer&&(p=t.renderer.call(t.thisObj||r,n,d,v,h),v.value=null==p?"":p),"day"!==t.unit||t.increment&&1!==t.increment||(v.headerCellCls+=" b-sch-dayheadercell-"+n.getDay(),Gt.clearTime(n,!0)-a==0&&(v.headerCellCls+=" b-sch-dayheadercell-today")),i.push(v))};let u=0;return r.headersDatesCache[e]={},n?n.forEach(((e,t)=>d(e.start,e.end,t,t===n.length-1,e))):r.forEachInterval(e,d),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,n=this){const{headers:r,timeAxis:i}=this;if(r)if(e===r.length-1)i.forEach(((e,r)=>t.call(n,e.startDate,e.endDate,r,r===i.count-1)));else{const s=r[e];i.forEachAuxInterval(s.unit,s.increment,t,n)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}$v._$name="TimeAxisViewModel";const _v=new Date;var jv=e=>class extends(e||ye){static $name="TimelineDateMapper";static configurable={snap:!1};getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,t,n=!0,r=!1,i=!1){return n||(e=this.currentOrientation.translateToScheduleCoordinate(e)),i||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,r)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromXY(e,t,n=!0,r=!1){return this.currentOrientation.getDateFromXY(e,t,n,r)}getDateFromDomEvent(e,t,n=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,n)}getStartEndDatesFromRectangle(e,t,n,r=!1){const i=this,{isHorizontal:s}=i,o=s?e.x:e.top,a=s?e.right:e.bottom;let l,c;return o>=0&&a<i.timeAxisViewModel.totalSize?(l=i.getDateFromCoordinate(o,t,!0),c=i.getDateFromCoordinate(a,t,!0)):o<0?(c=i.getDateFromCoordinate(a,t,!0,r),l=c&&Gt.add(c,-n,"ms")):(l=i.getDateFromCoordinate(o,t,!0,r),c=l&&Gt.add(l,n,"ms")),{start:l,end:c}}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||Gt.formatContainsHourInfo(this.displayDateFormat)||(e=Gt.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){var n;const r=this,{timeAxisViewModel:i}=r,{isContinuous:s,startMS:o,endMS:a,startDate:l,endDate:c,unit:d}=r.timeAxis,u=e.valueOf();let h;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(_v.setTime(e),e=_v),s&&e.getTimezoneOffset()===l.getTimezoneOffset()&&l.getTimezoneOffset()===c.getTimezoneOffset()&&-1!==Gt.getUnitToBaseUnitRatio(d,"day")){if(u<o||u>a)return-1;h=(u-o)/(a-o)*i.totalSize}else h=i.getPositionFromDate(e,t);return!r.rtl||!r.isHorizontal||null!==(n=t)&&void 0!==n&&n.ignoreRTL||(h=i.totalSize-h),t.local||(h=r.currentOrientation.translateToPageCoordinate(h)),h}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const{timeAxis:e,timelineScroller:t}=this;if(e.isContinuous){const n=(t.position+t.clientSize/2)/t.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*n)}return this.getDateFromCoordinate(t.position+t.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e;return(null===(e=this._timeAxisViewModel)||void 0===e?void 0:e.snap)??this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll(e,t,n,r){r||(this.cachedCenterDate=null)}get widgetClass(){}};const{eventNameMap:Bv}=Zn;var Vv=e=>class extends(e||ye){static $name="TimelineDomEvents";static configurable={timelineContext:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}},updateTimelineContextOnScroll:!1,ignoreDomEventsWhileScrolling:null};static properties={schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}};static delayable={onScheduleScroll:"raf"};hoveredEvents=new Set;initDomEvents(){const e=this,{schedulerEvents:t}=e;t.element=e.timeAxisSubGridElement,t.thisObj=e,Zn.on(t),Zn.on({element:e.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:e}),e.updateTimelineContextOnScroll&&o.supportsPointerEventConstructor&&Zn.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduleEvent(e){const t=this;if(t.ignoreDomEventsWhileScrolling&&(t.scrolling||t.timeAxisSubGrid.scrolling))return;const n=t.getTimelineEventContext(e);t.lastPointerEvent=e,n&&t.trigger(`${n.eventElement?t.scheduledEventName:"schedule"}${Bv[e.type]||$.capitalize(e.type)}`,n),t.timelineContext=n}handleScheduleLeaveEvent(e){e.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(e)}onScheduleScroll({target:e}){var t;const n=this;if(e&&n.updateTimelineContextOnScroll&&(null===(t=n.features.pan)||void 0===t||!t.isActive)&&!n.partners.some((e=>{var t;return null===(t=e.features.pan)||void 0===t?void 0:t.isActive}))&&(e.contains(n.element)||n.bodyElement.contains(e))){const{timelineContext:e,lastPointerEvent:t}=n;if(e){var r,i;const n=Br.elementFromPoint(e.domEvent.clientX,e.domEvent.clientY),s=new o.PointerEventConstructor("pointermove",t),a=new MouseEvent("mousemove",t);Object.defineProperty(s,"pointerId",{value:(null===(r=An.currentPointerDown)||void 0===r?void 0:r.pointerId)??(null===(i=An.currentTouch)||void 0===i?void 0:i.identifier)??1}),s.scrollInitiated=a.scrollInitiated=!0,null==n||n.dispatchEvent(s),null==n||n.dispatchEvent(a)}}}updateTimelineContext(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e&&!t?this.trigger("scheduleMouseEnter",e):e||this.trigger("scheduleMouseLeave",{event:t.event})}getTimelineEventContext(e){const t=this,n=e.target.closest(t.eventInnerSelector),r=t.getCellElementFromDomEvent(e);if(r){const i=t.getDateFromDomEvent(e,"floor");if(!i)return;const s=qc.get(r),o=n?t.getTimeSpanMouseEventParams(n,e):t.getScheduleMouseEventParams(s,e);if(!o)return;const a=t.isVertical?t.resourceStore.indexOf(o.resourceRecord):s.row.dataIndex,l=t.timeAxis.getTickFromDate(i),c=t.timeAxis.getAt(Math.floor(l));if(c)return{isTimelineContext:!0,domEvent:e,eventElement:n,cellElement:r,index:a,tick:c,tickIndex:l,date:i,tickStartDate:c.startDate,tickEndDate:c.endDate,tickParentIndex:c.parentIndex,row:s.row,event:e,...o}}}getCellElementFromDomEvent({target:e,clientY:t,type:n}){const r=this,{isVertical:i,foregroundCanvas:s}=r,o=e.closest(r.eventSelector);if(o){const e=!i&&(r.resolveRowRecord(o)||r.store.getAt(r.rowManager.getRowAt(t,!1).dataIndex));return r.getCell({[i?"row":"record"]:i?0:e,column:r.timeAxisColumn})}return s.contains(e)?e===s||"mousemove"===n?null===(a=r.rowManager.getRowAt(t,!1))||void 0===a?void 0:a.getCell(r.timeAxisColumn.id):void 0:e.matches(".b-grid-row")?e.firstElementChild:e.closest(r.timeCellSelector);var a}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){const n=this,r=t.parentElement.dataset.headerPosition,i=n.timeAxisViewModel.columnConfig[r],s=n.timeAxis.isFiltered?i.findIndex((e=>e.index==t.dataset.tickIndex)):t.dataset.tickIndex,o=i[s],a=n.features.contextMenu;a&&e.type===a.triggerEvent||this.trigger(`timeAxisHeader${$.capitalize(e.type)}`,{startDate:o.start,endDate:o.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var t;const n=this;if(n.ignoreDomEventsWhileScrolling&&(n.scrolling||n.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(e);const{target:r}=e,{hoveredEvents:i}=n;if(!r.closest(n.eventInnerSelector)&&!r.matches(".b-sch-terminal-hover-area")||null!==(t=n.features.eventDrag)&&void 0!==t&&t.isDragging)i.size&&n.unhoverAll(e);else{const t=r.closest(n.eventSelector);if(!i.has(t)&&!n.preventOverCls){i.add(t),t.classList.add(n.overScheduledEventClass);const r=n.getTimeSpanMouseEventParams(t,e);r&&n.trigger(`${n.scheduledEventName}MouseEnter`,r)}}}onElementMouseOut(e){var t;const n=this,{features:r}=n,{target:i,relatedTarget:s}=e;null!=s&&s.closest(".b-sch-canvas *")||super.onElementMouseOut(e);const o=i.closest(n.eventSelector),a=null==o?void 0:o.querySelector(n.eventInnerSelector),l=o&&n.resolveTimeSpanRecord(o);a&&l&&n.hoveredEvents.has(o)&&(null===(t=r.eventDrag)||void 0===t||!t.isDragging)&&s&&(Br.isDescendant(a,s)||s.matches(".b-sch-terminal-hover-area"))||o&&n.unhover(o,e)}unhover(e,t){const n=this;e.classList.remove(n.overScheduledEventClass),n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(e,t)),n.hoveredEvents.delete(e)}unhoverAll(e){for(const t of this.hoveredEvents)!t.isReleased&&!t.classList.contains("b-released")&&this.unhover(t,e);this.hoveredEvents.clear()}get widgetClass(){}},Hv=e=>class extends(e||ye){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let n=[];if(!0===e)n=Pv.allRecords;else if(Array.isArray(e))for(const t of e)if("string"==typeof t){const e=Pv.getById(t);e&&n.push(e)}else n.push(t);else Xt.assign(t,e);const r=new Fv(t);return r.add(n),r}changeViewPreset(e,t){const n=this,{presets:r}=n;e?(e=r.createRecord(e),r.includes(e)||r.add(e)):e=r.first;const i=n.lastViewPresetOptions||{},s=e.options||(e.options={}),o={...s,from:t,to:e,preset:e},a=!n._viewPreset||!n._viewPreset.equals(e);if(delete i.event,(a||!Xt.isEqual(s,i))&&(s.event=o,a||(n._viewPreset=null),n.isConfiguring||!1!==n.trigger("beforePresetChange",o)))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return Gt.format(e,this.displayDateFormat)}updateViewPreset(e){var t;const n=this,{options:r}=e,{event:i,startDate:s,endDate:o}=r,{isHorizontal:a,_timeAxis:l,_timeAxisViewModel:c}=n,d=a&&n.rtl;let{centerDate:u,zoomDate:h,zoomPosition:g}=r,m=!1;if(null===(t=n.syncSplits)||void 0===t||t.call(n,(t=>t.viewPreset=e)),delete e.options,n._viewPresetChanging=!0,l&&!n.isConfiguring){const{timelineScroller:t}=n;if(n.lastViewPresetOptions=r,l.isConfigured){n.suspendRefresh();const t=Xt.copyProperties({},n,["weekStartDay","startTime","endTime"]);n.infiniteScroll?Object.assign(t,n.calculateInfiniteScrollingDateRange(u||(s&&o?new Date((s.getTime()+o.getTime())/2):n.viewportCenterDateCached),!0,e)):s?(t.startDate=s,t.endDate=o,!u&&o&&(u=new Date((s.getTime()+o.getTime())/2))):(t.startDate=l.startDate,t.endDate=o||l.endDate,u||(u=n.viewportCenterDate)),l.isConfigured=!1,t.viewPreset=e,l.reconfigure(t,!0),c.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:r.tickSize||(a?e.tickWidth:e.tickHeight||e.tickWidth||60)}),r.tickSize&&(n.tickSize=r.tickSize),n.resumeRefresh(!1)}if(n.refresh(),!r.notScroll&&n.isPainted)if("scrollPosition"in r)m=t.position===r.scrollPosition,t.scrollTo(r.scrollPosition);else if(r.visibleDate)n.visibleDate=r.visibleDate;else if(h&&g){const e=zt[l.resolutionUnit]>3?"hour":"minute",s=Gt.asMilliseconds("minute"===e?15:1,e),o=new Date(Math.round(h/s)*s);i.zoomDate=h,i.zoomPosition=g,i.zoomLevel=r.zoomLevel,t.position=d?t.scrollWidth-(n.getCoordinateFromDate(o)+g):n.getCoordinateFromDate(o)-g}else if(u){n.cachedCenterDate=u,i.centerDate=u;const e=n.timelineScroller.clientSize,t=d?n.timeAxisViewModel.totalSize-n.getCoordinateFromDate(u,!0):n.getCoordinateFromDate(u,!0),r=Math.max(t-e/2,0);r===(n.isHorizontal?n.scrollLeft:n.scrollTop)?m=!0:n.isHorizontal?n.scrollHorizontallyTo(r,{scrollingToCenter:!0}):n.scrollVerticallyTo(r,{scrollingToCenter:!0})}else 0===(n.isHorizontal?n.scrollLeft:n.scrollTop)?m=!0:n.timelineScroller.scrollTo(0)}n.dataset.presetId=e.id,n.trigger("presetChange",i),n._viewPresetChanging=!1,m&&(n.isHorizontal?n.currentOrientation.updateFromHorizontalScroll(n.scrollLeft,!0):n.currentOrientation.updateFromVerticalScroll(n.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},Nv=e=>class extends(e||ye){static $name="TimelineZoomable";static defaultConfig={zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null};lastWheelTime=-1;lastZoomPosition=-1;construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&Zn.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:e=>e.ctrlKey&&e.preventDefault()},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.ion({timeaxisheaderdblclick:({startDate:e,endDate:n})=>{t.forceFit||t.zoomToSpan({startDate:e,endDate:n})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:n}=e,r=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((Gt.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(t?r:e.actualWidth||r))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){if(this.forceFit)return void console.warn("Warning: The forceFit setting and zooming cannot be combined");"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const n=this,{presets:r}=n,i=n.isVertical?"tickHeight":"tickWidth",s=r.createRecord(e),o=s[i],a=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;r.add(s);let c=a&&l?{startDate:a,endDate:l}:null;const d=t.centerDate?new Date(t.centerDate):c?new Date((a.getTime()+l.getTime())/2):n.viewportCenterDateCached;let u=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;if(0===u){const{_beforeCollapseState:e}=n.timeAxisSubGrid;if(!(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&null!=e&&e.width))return null;u=e.width}return c||(c=n.calculateOptimalDateRange(d,u,s)),"width"in t&&s.setData(i,t.width),n.isZooming=!0,s.options={...t,startDate:c.startDate||n.startDate,endDate:c.endDate||n.endDate,centerDate:d},n.viewPreset=s,s.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,s.setData(i,o),n.zoomLevel}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e={leftMargin:0,rightMargin:0,...e,...t}).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,{timeAxis:n}=t,r=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:i,endDate:s}=e;if(r&&(i=Gt.add(i,-e.adjustStart,n.mainUnit),s=Gt.add(s,e.adjustEnd,n.mainUnit)),i<=s){const{availableSpace:o}=t.timeAxisViewModel,a=t.presets.allRecords,l=s-i||1;let c,d,u=t.zoomLevel;-1===u&&(u=0);let h,g=t.getMilliSecondsPerPixelForZoomLevel(a[u],!0),m=u+(c=l/g+e.leftMargin+e.rightMargin>o?-1:1),p=null;for(;m>=0&&m<=a.length-1;){h=a[m],g=t.getMilliSecondsPerPixelForZoomLevel(h,!0);const n=l/g+e.leftMargin+e.rightMargin;if(-1===c){if(n<=o){p=m;break}}else{if(!(n<=o))break;u!==m-c&&(p=m)}m+=c}p=null!=p?p:m-c,h=a[p];const f=h.bottomHeader.unit;g=t.getMilliSecondsPerPixelForZoomLevel(h,!0),(e.leftMargin||e.rightMargin)&&(i=new Date(i.getTime()-g*e.leftMargin),s=new Date(s.getTime()+g*e.rightMargin));const v=Gt.getDurationInUnit(i,s,f,!0)/h.bottomHeader.increment;if(0===v)return null;const y=Math.floor(o/v),b=e.centerDate||new Date((i.getTime()+s.getTime())/2);d=r?{startDate:i,endDate:s}:t.calculateOptimalDateRange(b,o,h);let C=t.zoomLevel;return t.zoomLevel===p?n.reconfigure(d):C=t.zoomToLevel(p,Object.assign(d,{width:y,centerDate:b})),this.trigger("zoomToSpan",{zoomLevel:p,startDate:i,endDate:s,centerDate:b}),C}return null}zoomIn(e=1,t){"object"==typeof e&&(t=e,e=1);const n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+e,t)}zoomOut(e=1,t){"object"==typeof e&&(t=e,e=1);const n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-e,t)}zoomInFull(e){return this.zoomToLevel(this.maxZoomLevel,e)}zoomOutFull(e){return this.zoomToLevel(this.minZoomLevel,e)}calculateOptimalDateRange(e,t,n){const r=this,{timeAxis:i}=r,{bottomHeader:s}=n,o=r.isHorizontal?n.tickWidth:n.tickHeight;if(r.zoomKeepsOriginalTimespan)return{startDate:i.startDate,endDate:i.endDate};const a=s.unit,l=Math.ceil(t/o*s.increment*r.visibleZoomFactor/2),c=Gt.add(e,-l,a),d=Gt.add(e,l,a);return{startDate:i.floorDate(c,!1,a,s.increment),endDate:i.ceilDate(d,!1,a,s.increment)}}onElementMouseMove(e){const{isHorizontal:t,zoomContext:n}=this;super.onElementMouseMove(e),e.isTrusted&&n&&Math.abs(e["client"+(t?"X":"Y")]-n.coordinate)>10&&(this.zoomContext=null)}async onWheel(e){if(e.ctrlKey&&!this.forceFit){e.preventDefault();const t=this,{zoomContext:n,isHorizontal:r,timelineScroller:s,zoomLevel:o}=t,a=performance.now(),l=e["client"+(r?"X":"Y")];let c=l-s.viewport[""+(r?"x":"y")];r&&t.rtl&&(c=s.viewport.width+s.viewport.x-l),a-t.lastWheelTime>200||!n||Math.abs(l-t.zoomContext.coordinate)>20?t.zoomContext={zoomLevel:o,coordinate:l,zoomPosition:c,zoomDate:t.getDateFromDomEvent(e)}:(o>n.zoomLevel&&(n.zoomDate=t.getDateFromDomEvent(e),n.zoomLevel=o),n.zoomPosition=c),t.lastWheelTime=a,t["zoom"+(e.deltaY>0?"Out":"In")](i,t.zoomContext)}}setTimeSpan(e,t,n){this.timeAxis.setTimeSpan(e,t,n)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}};class zv extends ic{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:r,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach((n=>{n in e&&(t[n]=e[n])})),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:n,cancelButton:r}=e.widgetMap,{eventRecord:i,actionType:s="update"}=e;(null==i?void 0:i.isRecurring)?(t.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(t.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),n.text=e.L(`${s}-only-this-btn-text`),r.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:n,finalizerFn:r}=this;e.beginBatch(),t&&this.callback(t,n,[e]),e.endBatch(),r&&this.callback(r,n,[e])}processSingleRecord(){var e;const{eventRecord:t,changerFn:n,thisObj:r,finalizerFn:i}=this;let s;t.beginBatch(),null!=t&&t.isRecurring&&t.recurrence.forEachOccurrence(t.startDate,null,((e,t,n)=>{if(n>1)return s=e,!1})),null===(e=s)||void 0===e||e.convertToRealEvent(),t.recurrence=null,n&&this.callback(n,r,[t]),t.recurrenceRule=null,t.endBatch(),i&&this.callback(i,r,[t])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}zv.initClass(),zv._$name="RecurrenceConfirmationPopup";var Wv=e=>class extends(e||ye){static $name="RecurringEvents";static configurable={enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}};construct(e){super.construct(e),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(e,t){const n=this.constructor.reconfigure(t,e,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(e){return e.find((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)))}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const n=e.map((e=>e.event)),r=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&r)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,n=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));n.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onAssignmentChange({action:e,records:t,changes:n}){if(("update"!==e||!n.event||!n.resource||2!==Object.keys(n).length)&&"dataset"!==e&&Array.isArray(t))for(const e of t){var r;null!==(r=e.event)&&void 0!==r&&r.isRecurring&&!e.event.isBatchUpdating&&e.event.removeOccurrences(this.eventStore)}}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(e,t=null,n=this){const r=this;if(!r.readOnly&&e.length){const i={finalize(n=!0){if(t&&t(n),!1!==n)if(e.some((e=>{var t;return e.isOccurrence||(null===(t=e.event)||void 0===t?void 0:t.isOccurrence)})))e.forEach((e=>e.isOccurrenceAssignment?e.event.remove():e.remove()));else{(e[0].isAssignment?r.assignmentStore:r.eventStore).remove(e)}}};let s;if(s=e[0].isAssignment?r.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:i}):await r.trigger("beforeEventDelete",{eventRecords:e,context:i}),!1!==s){const t=e.find((e=>e.isRecurring||e.isOccurrence));return t?(r.recurrenceConfirmationPopup.owner=n,r.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}})):i.finalize(!0),!0}}return!1}get widgetClass(){}},Uv=e=>class extends(e||ye){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}static configurable={barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null};updateFillTicks(e){this.isConfiguring||(this.timeAxis.forceFullTicks=e&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(e){return Xt.assertNumber(e,"barMargin"),null==this._resourceMargin&&this.changeResourceMargin(e),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}changeResourceMargin(e){var t,n;const r=this;return"number"==typeof e?(r.isHorizontal&&r.rowHeight&&(e=Math.min(Math.ceil(r.rowHeight/2),e)),r.resourceMarginObject={start:e,end:e,total:2*e},e):(null!==(t=e)&&void 0!==t&&t.start||(e.start=0),null!==(n=e)&&void 0!==n&&n.end||(e.end=0),r.isHorizontal&&r.rowHeight&&(e.start=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.start,e.end=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.end),r.resourceMarginObject=Xt.assign({total:e.start+e.end},e),e)}updateResourceMargin(){const e=this;e.rendered&&(e.currentOrientation.onBeforeRowHeightChange(),e.refreshWithTransition())}changeTickSize(e){return Xt.assertNumber(e,"tickSize"),e}updateTickSize(e){this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","magenta","violet","indigo","blue","cyan","teal","green","gantt-green","lime","yellow","orange","deep-orange","gray","light-gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}};const Gv={maintainVisibleStart:!0},Yv={block:"nearest"};var qv=e=>class extends((e||ye).mixin(Nv)){static $name="TimelineScroll";static configurable={bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1};onZoomToSpan({startDate:e}){this.infiniteScroll&&this.scrollToDate(e,{block:"start"})}calculateOptimalDateRange(e,t,n){if(this.infiniteScroll){if(this.zoomKeepsOriginalTimespan){const{startDate:e,endDate:t}=this.timeAxis;return{startDate:e,endDate:t}}return this.calculateInfiniteScrollingDateRange(e,!0)}return super.calculateOptimalDateRange(...arguments)}initScroll(){const e=this,{isHorizontal:t,visibleDate:n}=e;super.initScroll();const{scrollable:r}=t?e.timeAxisSubGrid:e;var i;if(r.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll)if(null!==(i=e.partneredWith)&&void 0!==i&&i.values.some((e=>e.infiniteScroll))){const t=r.element.getBoundingClientRect()[e.isHorizontal?"width":"height"];e.timeAxisViewModel.update(t,!1,!0)}else{const t=n?{...n,visibleDate:n.date}:{visibleDate:e.viewportCenterDate,block:"center"},{startDate:r,endDate:i}=e.calculateInfiniteScrollingDateRange(t.visibleDate,"center"===t.block);e.setTimeSpan(r,i,t)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new Kv({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}calculateInfiniteScrollingDateRange(e,t,n=this.timeAxisViewModel.viewPreset){const{timeAxis:r,availableSpace:i}=this.timeAxisViewModel,{bufferCoef:s}=this,{leafUnit:o,leafIncrement:a,topUnit:l,topIncrement:c,tickSize:d}=n,u=o===l&&Math.round(c)===c&&Math.round(a)===a,h=u?c:a,g=u?l:o;if(t){const t=Math.ceil((i*s+i/2)/d);return{startDate:r.floorDate(Gt.add(e,-t*a,o),!1,g,h),endDate:r.ceilDate(Gt.add(e,t*a,o),!1,g,h)}}{const t=Math.ceil(i*s/d);return{startDate:r.floorDate(Gt.add(e,-t*a,o),!1,g,h),endDate:r.ceilDate(Gt.add(e,Math.ceil((i/d+t)*a),o),!1,g,h)}}}doDestroy(){var e;null===(e=this._timelineScroller)||void 0===e||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,n=t.timelineScroller,{clientSize:r}=n,i=r*t.bufferCoef*t.bufferThreshold,s=n.maxPosition,{style:o}=t.timeAxisSubGrid.virtualScrollerElement;(s-e<i||e<i)&&(o.overflow="hidden",o.pointerEvents="none",o.paddingBottom=`${Br.scrollBarWidth}px`,t.setTimeout((()=>{o.overflow="",o.paddingBottom="",o.pointerEvents=""}),100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0,!1,!0)))}shiftToDate(e,t){const n=this.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(n.startDate,n.endDate,Gv)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(e,t={}){const n=this,{timeAxis:r,visibleDateRange:i,infiniteScroll:s}=n,{unit:o,increment:a}=r,l=t.edgeOffset||0,c=Gt.ceil(i.endDate,a+" "+o)-Gt.floor(i.startDate,a+" "+o),d=e>n.viewportCenterDate?1:-1,u=(s?c*n.bufferCoef*n.bufferThreshold:"center"===t.block?c/2:l?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*l:0)*d,h=new Date(e.getTime()+u);(h>r.endDate?1:h<r.startDate?-1:0)&&n.infiniteScroll&&(n.shiftToDate(new Date(e-u),null,!0),await n.nextAnimationFrame());const g=n.timelineScroller.viewport,m=n.getCoordinateFromDate(e,!0),p=Math.min(n.timeAxisViewModel.tickSize,n.timeAxisViewModel.availableSpace),f=n.isHorizontal?new wn(n.getCoordinateFromDate(e,!1)-(n.rtl?p:0),g.y,p,g.height):new wn(g.x,n.getCoordinateFromDate(e,!1),g.width,n.timeAxisViewModel.tickSize);await n.scrollToCoordinate(m,f,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,n,r={}){const i=this;if(e<0){const e=i.endDate-i.startDate,{unit:t,increment:s}=i.timeAxis,o=Gt.floor(new Date(n.getTime()-e/2),s+" "+t),a=Gt.add(o,e);return o-i.startDate!=0&&a-i.endDate!=0?(await i.setTimeSpan(o,a),i.scrollToDate(n,r)):void 0}return await i.timelineScroller.scrollIntoView(t,r),!i.isDestroyed&&i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class Kv extends No{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,n=Yv){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,n):this.scrollable.scrollBy(0,t||e,n)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const Xv=["barMargin"];var Zv=e=>class extends(e||ye){static get $name(){return"TimelineState"}getState(){const e=this,t=Xt.copyProperties(super.getState(),e,Xv);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:i,width:e.tickSize},t}applyState(e){const t=this;if(t.suspendRefresh(),Xt.copyProperties(t,e,Xv),super.applyState(e),null!=e.zoomLevel){var n;if(t.infiniteScroll)null!=e&&null!==(n=e.scroll)&&void 0!==n&&n.scrollLeft&&(e.scroll.scrollLeft={});t.isPainted?t.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):t._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}}t.resumeRefresh(!0)}onInternalPaint(...e){if(super.onInternalPaint(...e),this._zoomAfterPaint){const{zoomLevel:e,zoomLevelOptions:t}=this._zoomAfterPaint;this.zoomToLevel(e,t),delete this._zoomAfterPaint}}get widgetClass(){}};class Jv extends hd{static get $name(){return"SchedulerHeader"}refreshContent(){var e;null!==(e=this.headersElement)&&void 0!==e&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}Jv._$name="Header";class Qv extends Yd{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:Jv}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollWidth)??0},set(){e.grid.updateCanvasSize()}}),t}handleHorizontalScroll(e=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(e)}onInternalResize(e,t,n,r,i){const s=this;if(super.onInternalResize(...arguments),s.isPainted&&t!==r){const e=s.grid,n=e._bodyRectangle.height,i=s.monitorResize&&Br.scrollBarWidth&&t<r;i&&(s.monitorResize=!1),e.onSchedulerViewportResize(t,n,r,n),i&&queueMicrotask((()=>s.monitorResize=!0))}}get headerScrollWidth(){return this.grid.isVertical?super.headerScrollWidth:this.grid.timeAxisViewModel.totalSize}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:e}=this;await super.expand(),e.isPainted&&e.timeAxisViewModel.update(this.width,!1,!0)}}Qv.initClass(),Qv._$name="TimeAxisSubGrid";const ey={fn:"exitTransition",delay:0,cancelOutstanding:!0},ty=(e,t,n)=>null==t?null==n||e<n:null==n?e>=t:t<n?t<=e&&e<n:e<n||t<=e,ny={};class ry extends(ru.mixin(jv,Vv,Uv,Nv,qv,Zv,Hv,Wv)){static $name="TimelineBase";static type="timelinebase";static configurable={animateTreeNodeToggle:!1,partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset","infiniteScroll"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},partner:null,stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null,hideRowHover:{$config:"lazy",value:!0}};static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}timeCellSelector=null;updateTimeZone(e){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e)}get timeZone(){var e;return null===(e=this.project)||void 0===e?void 0:e.timeZone}populateEventMenu(){}populateScheduleMenu(){}internalOnVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:n}=t;(!n||n.startDate-e.startDate||n.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:n,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const n=this,{stickyHeaders:r}=n;return e===(n.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&r&&n.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},n.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:n}=e;null==n||n.destroy(),t?(t.forEach((t=>{e.removePartner(t)})),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),Fo.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return"string"==typeof e&&(e=Gt.parse(e)),e}onInternalPaint({firstPaint:e}){if(e){const e=this,r=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable).element.getBoundingClientRect()[e.isHorizontal?"width":"height"];var t,n;if(e.timeAxisViewModel.update(r,e.infiniteScroll,!0),e.infiniteScroll)null===(t=(n=e.currentOrientation).doUpdateTimeView)||void 0===t||t.call(n);e.getConfig("hideRowHover")}super.onInternalPaint(...arguments)}onSchedulerHorizontalScroll(e,t,n,r){this.currentOrientation.updateFromHorizontalScroll(n),super.onSchedulerHorizontalScroll(e,t,n,r)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:n,scrollLeft:r,scrollX:i,scrollingToCenter:s})=>{!e.isPainted||n!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(n,r,i,s),t++}}),"horizontal"===e.testPerformance&&e.setTimeout((()=>{const n=performance.now();let r=5,i=1;const s=e.setInterval((()=>{if(r+=5,e.scrollX+=(10+Math.floor(r))*i,1===i&&e.scrollX>5500&&(i=-1,r=5),-1===i&&e.scrollX<=0){const r=(performance.now()-n)/t,i=Math.round(1e3/r*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,i+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...n){const r=this,i=r.viewportCenterDate,s=e.apply(t,n),o=r.timelineScroller,{clientSize:a}=o,l=Math.max(Math.floor(r.getCoordinateFromDate(i,!0)-a/2),0);return o.scrollTo(l,{scrollingToCenter:!0}),s}setTimeSpan(e,t,n=ny){const r=this,{timeAxis:i}=r,{preventThrow:s=!1,maintainVisibleStart:o=!1,visibleDate:a}=n,{startDate:l,endDate:c}=i.getAdjustedDates(e,t),d=i.startDate-l!=0,u=i.endDate-c!=0;if(d||u){if(o){const{timeAxisViewModel:e}=r,{totalSize:t}=e,n=e.tickSize,i=r.timelineScroller,s=i.position,o=e.getDateFromPosition(s);o>=l&&o<c&&e.ion({update(){const a=e.tickSize!==n;r.updateCanvasSize(),!d||u||a?i.position=d||a?e.getPositionFromDate(o):s:i.position+=e.totalSize-t,i.syncPartners(!0)},prio:1e4,once:!0})}const e=i.reconfigure({startDate:l,endDate:c},!1,s);return a?r.scrollToDate(a,n).then((()=>e)):e}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=$.capitalize(this.scheduledEventName)),this._capitalizedEventName}updatePartner(e){e&&this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){null==t._partner&&(t._partner=e);(t.partneredWith||(t.partneredWith=new Ms)).add(e),(e.partneredWith||(e.partneredWith=new Ms)).add(t),t.getConfig("viewPreset"),t.getConfig("infiniteScroll"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const n=t.partnerSharedConfigs.reduce(((t,n)=>(t[n]=e[n],t)),{});n.viewPreset.options={scrollPosition:e.timelineScroller.position,tickSize:e.tickSize},t.setConfig(n),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=Me.createSequence(t.initScroll,(()=>{e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}removePartner(e){const t=this,{partneredWith:n}=t;t.isPartneredWith(e)&&(t._partner===e&&(t._partner=null),n.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:n}=this,r=n.hasOverflow("y")||"scroll"===n.overflowY;r!==t?"scroll"===n.overflowY?(n.overflowY=!0,this.refreshVirtualScrollbars()):r?e.overflowY="scroll":(e.overflowY=!0,n.overflowY="scroll",this.refreshVirtualScrollbars()):n.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:n,centerDate:r,zoomDate:i,zoomPosition:s,zoomLevel:o}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:n,centerDate:r,zoomDate:i,zoomPosition:s,zoomLevel:o},this.viewPreset=e)}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),[...new Set(e)]}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,t){const n=this;let r,i;if(e){const t=Array.isArray(e);let s=e;t||(s=e.data),r=s&&s.length,s.some(((e,t)=>"timeAxis"===e.type&&(r=t,i=Xt.assign(e,n.timeAxisColumn),!0))),n.isVertical?(s=[Xt.assign({type:"verticalTimeAxis"},n.verticalTimeAxisColumn),s[r]],r=1):s=s.slice(),s[r]=this._timeAxisColumn||{type:"timeAxis",cellCls:n.timeCellCls,mode:n.mode,...i},t||e.isStore&&e.owner!==this?e=s:e.data=s}return super.changeColumns(e,t)}updateColumns(e,t){if(super.updateColumns(e,t),e){const e=this,t=e._timeAxisColumn=e.columns.find((e=>e.isTimeAxisColumn));e.isVertical&&(e.verticalTimeAxisColumn=e.columns.find((e=>e.isVerticalTimeAxisColumn)),e.verticalTimeAxisColumn.relayAll(e)),t.relayAll(e)}}onColumnsChanged({action:e,changes:t,record:n,records:r}){var i;const{timeAxisColumn:s,columns:o}=this;"dataset"!==e&&"batch"!==e||o.includes(s)?n===s&&"width"in t&&this.updateCanvasSize():o.add(s,!0),n&&(null===(i=this.partneredWith)||void 0===i||i.forEach((e=>{const r=e.columns.getAt(n.allIndex);if(null!=r&&r.shouldSync(n)){const e={};for(const n in t)e[n]=t[n].value;r.set(e)}}))),super.onColumnsChanged(...arguments)}get timeView(){var e,t;const n=this;return n.columns&&n.isVertical?null===(e=n.verticalTimeAxisColumn)||void 0===e?void 0:e.view:null===(t=n.timeAxisColumn)||void 0===t?void 0:t.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const n=this,r=n._timeAxisViewModel,i={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:n};n.partner&&!e||r&&r===e||((null==r?void 0:r.owner)===n&&r.destroy(),n.detachListeners("timeAxisViewModel"),null!==(t=e)&&void 0!==t&&t.isTimeAxisViewModel?e.ion(i):e=$v.new({mode:n._mode,snap:n.snap,forceFit:n.forceFit,timeAxis:n.timeAxis,suppressFit:n.suppressFit,internalListeners:i,owner:n},e),n.isConfiguring||(n.isHorizontal?n.timeAxisColumn.timeAxisViewModel=e:n.verticalTimeAxisColumn.view.model=e),n._timeAxisViewModel=e,n.relayEvents(e,["update"],"timeAxisViewModel"),r&&e&&n.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e;return(null===(e=this._timeAxisViewModel)||void 0===e?void 0:e.suppressFit)??this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const n=this,r=n._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:n};n.partner&&!e||r&&r===e||(r&&r.owner===n&&r.destroy(),n.detachListeners("timeAxis"),null!==(t=e)&&void 0!==t&&t.isTimeAxis||(e=Xt.assign({owner:n,viewPreset:n.viewPreset,autoAdjust:n.autoAdjustTimeAxis,weekStartDay:n.weekStartDay,forceFullTicks:n.fillTicks&&n.snap},e),n.startDate&&(e.startDate=n.startDate),n.endDate&&(e.endDate=n.endDate),n.workingTime&&n.applyWorkingTime(e),e=new Lv(e)),e.ion(i),n._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){if(e){(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}})}this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,n=t._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;var r;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(r=t.features.columnLines)||void 0===r||r.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||ny;if("string"==typeof e&&(e=Gt.parse(e)),r&&s){if(e){let r=s;if(t&&i){const t=Gt.diff(i,s,o,!0);r=Gt.add(e,t,o)}n.setTimeSpan(e,r)}}else n._tempStartDate=e}get startDate(){var e;let t=(null===(e=this._timeAxis)||void 0===e?void 0:e.startDate)||this._tempStartDate;if(!t){t=new Date;const{workingTime:e}=this;if(e)for(;r=e,!ty((n=t).getDay(),r.fromDay,r.toDay)||!ty(n.getHours(),r.fromHour,r.toHour);)t.setHours(t.getHours()+1);this._tempStartDate=t}var n,r;return t}changeEndDate(e){"string"==typeof e&&(e=Gt.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||ny;if("string"==typeof e&&(e=Gt.parse(e)),r&&i){if(e){let r=i;if(t&&s){const t=Gt.diff(i,s,o,!0);r=Gt.add(e,-t,o)}n.setTimeSpan(r,e)}}else n._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||Gt.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return e instanceof Date?{date:e,block:this.isConfiguring?"start":"nearest"}:e instanceof Object?{date:e.date,block:e.block||this.isConfiguring?"start":"nearest",...e}:void 0}updateVisibleDate(e){const t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:n,height:r}){this.isVertical&&t&&n!==t.width&&delete this.timeAxisSubGrid._width;const i=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(i,r,i,t.height)}onSchedulerViewportResize(e,t,n,r){if(this.isPainted){const i=this,{isHorizontal:s,partneredWith:o}=i;i.currentOrientation.onViewportResize(e,t,n,r),i.updateViewModelAvailableSpace(s?e:Math.floor(t)),o&&!i.isSyncingFromPartner&&i.syncPartnerSubGrids(),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){this._viewPresetChanging||this.timeAxisSubGrid.collapsed||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid((t=>{const n=e.subGrids[t.region];n.width!==t.width&&(t.collapsed?n.collapse():(n.collapsed&&n.expand(),t.flex?t.flex!==n.flex&&(n.flex=t.flex):n.width=t.width))})),e.isSyncingFromPartner=!1)}))}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",vs.generateId("svg")),t.classList.add("b-sch-canvas","b-sch-dependencies-canvas"),t.retainElement=!0,e.timeAxisSubGridElement.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){var e;this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null===(e=this.timeAxisColumn)||void 0===e?void 0:e.subGridElement);return this._timeAxisSubGridElement}updateCanvasSize(){const e=this;let t=!1;if(e.isVertical){const{totalSize:n}=e.timeAxisViewModel;e.isPainted&&e.refreshTotalHeight(n+e._rowBorderHeight,!0),e.suppressFit&&Br.setLength(e.foregroundCanvas,"height",n),t=!0}return t}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;var n;t.isVisible?("dataset"===e&&null!==(n=t.project)&&void 0!==n&&n.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.isVertical||t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?!t.project||t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,{total:t}=e.resourceMarginObject,n=e.timeAxisSubGridElement,r=e._foregroundCanvas=Br.createElement({className:"b-sch-canvas b-sch-foreground-canvas",style:`font-size:${e.rowHeight-t}px`,parent:n});e.timeAxisSubGrid.insertRowsBefore=r,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}updateHideHeaders(e){const t=this,n=t.isPainted?t.scrollLeft:0;super.updateHideHeaders(e),t.isPainted&&(e||t.timeAxisColumn.refreshHeader(null,!0),t.nextAnimationFrame().then((()=>t.scrollLeft=n)))}updateHideRowHover(e){this.timeAxisSubGridElement.classList.toggle("b-hide-row-hover",e)}getCellDataFromEvent(e,t){return t&&(t=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),super.getCellDataFromEvent(e,t)}onCellNavigate(e,t,n){var r,i;const s=n.target;null===(r=n.cell)||void 0===r||!r.classList.contains("b-timeaxis-cell")||null!==(i=An.currentMouseDown)&&void 0!==i&&i.target.classList.contains("b-grid-cell")||(this.preventDragSelect=!0),null!=s&&s.matches(this.eventSelector)&&!1===this.selectResourceOnEventNavigate||null!=s&&s.matches(".b-timeaxis-cell")&&!1===this.selectResourceOnScheduleClick||super.onCellNavigate(...arguments)}runWithTransition(e,t=this.transitionDuration){const n=this;n.isVisible&&0===n._animationSuspendedCounter&&(null!=t&&!0!==t||(t=n.transitionDuration),t&&n.enableEventAnimations&&(n.hasTimeout("exitTransition")||(n.isAnimating=!0),ey.delay=t+50,n.setTimeout(ey))),e()}_animationSuspendedCounter=0;suspendAnimations(){this._animationSuspendedCounter++}resumeAnimations(){this._animationSuspendedCounter--}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){const n=this;!n.refreshSuspended&&n.isPainted&&(n.rowManager.topRow?n.runWithTransition((()=>n.refresh(e)),t):n.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some((e=>{var t;return e.column?e.column.isTimeAxisColumn:null===(t=e.cell)||void 0===t?void 0:t.closest(".b-timeaxis-cell")}))}formatDuration(e,t=this.durationDisplayPrecision){const n=Math.pow(10,t);return Math.round(e*n)/n}beginListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,null===(e=this.syncSplits)||void 0===e||e.call(this,(e=>e.beginListeningForBatchedUpdates()))}endListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),null===(e=this.syncSplits)||void 0===e||e.call(this,(e=>e.endListeningForBatchedUpdates()))}onConnectedCallback(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const t=this,{isConfiguring:n}=t;let r;n||(r=t.visibleDateRange),super.updateRtl(e),n||(t.currentOrientation.clearAll(),t.infiniteScroll?(t.shiftToDate(r.startDate),t.scrollToDate(r.startDate,{block:"start"})):t.timelineScroller.position+=.5)}applyStartEndParameters(e){const t=this,n=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=n.print(t.startDate),e[t.endParamName]=n.print(t.endDate))}}ry.initClass(),_.setVersion("scheduler","5.6.2"),ry._$name="TimelineBase";var iy=e=>class extends(e||ye){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:n}){super.onRecordIdChange({record:e,oldValue:t,value:n}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:e,endDate:t}){return this.query((n=>this.eventStore.isDateRangeAvailable(e,t,null,n)))}},sy=e=>class extends(e||ye){static get $name(){return"PartOfProject"}},oy=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image","resourceMargin",{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){this.assignmentStore.remove(this.assignments),e.forEach((e=>{e.resource=this}))}getEvents(){return _.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}isWorkingTime(e){var t,n;const r=this.effectiveCalendar||(null===(t=this.project)||void 0===t?void 0:t.calendar);return!r||(null===(n=r.isWorkingTime)||void 0===n?void 0:n.call(r,e))}};function ay(e){const t=[],n=[];let r;return[function*(){for(r||(r=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),r;){const{value:t,done:i}=r.next();if(i){r=null,e=null;break}n.push(t),yield t}}(),function*(){for(r||(r=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),r;){const{value:n,done:i}=r.next();if(i){r=null,e=null;break}t.push(n),yield n}}()]}function*ly(e,t){let n=0;for(const r of e)yield t(r,n++)}function*cy(e){const t=new Set;for(const n of e)t.has(n)||(t.add(n),yield n)}function*dy(...e){for(let t=0;t<e.length;t++)yield*e[t]}function*uy(e){for(const t of e)yield*t}class hy{constructor(e){if(this.iterable=i,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=i,new hy(e)}copy(){const[e,t]=ay(this.iterable);return this.iterable=t,new hy(e)}split(){const[e,t]=ay(this.iterable);return[new hy(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const n=[];for(const r of e)n.length===t&&(yield n,n.length=0),n.push(r);n.length>0&&(yield n)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let n=0;for(const r of e)t(r,n++)&&(yield r)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let n=0;for(const r of e)++n>t&&(yield r)}(this.iterable,e))}map(e){return this.derive(ly(this.iterable,e))}reduce(e,t){return function(e,t,n){let r=0,i=n;for(const n of e)i=t(i,n,r++);return i}(this,e,t)}concat(){return this.derive(uy(this.iterable))}uniqueOnly(){return this.derive(cy(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const n=new Set;for(const r of e){const e=t(r);n.has(e)||(n.add(e),yield r)}}(this.iterable,e))}every(e){return function(e,t){let n=0;for(const r of e)if(!t(r,n++))return!1;return!0}(this,e)}some(e){return function(e,t){let n=0;for(const r of e)if(t(r,n++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let n=0;for(const r of e){if(!t(r,n++))return;yield r}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=i,yield*e,e=i}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new my(this)}}const gy=e=>new hy(e);class my extends hy{constructor(){super(...arguments),this.elements=[],this.$iterator=i}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new hy(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,n=e.length;for(n>0&&(yield*e);;){if(e.length>n){for(let t=n;t<e.length;t++)yield e[t];n=e.length}if(!t)break;const{value:r,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(r),n++,yield r)}}else yield*e}}const py=e=>new my(e),fy=Symbol("MixinIdentity"),vy=Symbol("MixinStateProperty");class yy{constructor(){this.baseEl=i,this.sourceEl=i,this.$elementsByTopoLevel=i,this.$topoLevels=i,this.linearizedByTopoLevelsSource=py(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return this.$topoLevels!==i?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==i?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let n=e.get(t);return n||(n=[],e.set(t,n)),n}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?gy(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,n=gy(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[n,r])=>(n>e&&(e=n),this.getOrCreateLevel(t,n).push(r),t)),new Map);return this.getOrCreateLevel(n,e+1).push([this.sourceEl]),gy(n).map((([e,n])=>[e,gy(n).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*gy(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}let by=1;const Cy=e=>class extends e{};class Sy{}class Dy{constructor(){this.id=by++,this.requirements=[],this.baseClass=Sy,this.identitySymbol=i,this.mixinLambda=Cy,this.walkDepthState=i,this.$minimalClass=i,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=yy.new({sourceEl:t,baseEl:wy(t.baseClass)});const n=t.mixinLambda,r=t.identitySymbol=Symbol(n.name),i=Object.assign((function(e){const t=n(e);return t.prototype[r]=!0,t}),{[fy]:r,[vy]:t});return Object.defineProperty(i,Symbol.hasInstance,{value:xy}),t.mixinLambda=i,t}get minimalClass(){return this.$minimalClass!==i?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,n=t.baseClassesIds.get(e);if(n!==i)return n;const r=by++;return t.baseClassesIds.set(e,r),r}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const n=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,n)=>{const{cls:r,hash:i}=t,s=i+String.fromCharCode(n.id);let o=e.minimalClassesByLinearHash.get(s);return o||(o=n.mixinLambda(r),n.name=o.name,e.minimalClassesByLinearHash.set(s,o)),t.cls=o,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,{[fy]:this.identitySymbol,[vy]:this,mix:this.mixinLambda,derive:e=>Ty([r,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:xy}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}Dy.minimalClassesByLinearHash=new Map,Dy.baseClassesIds=new Map;const wy=e=>Object.getPrototypeOf(e.prototype).constructor[vy],Ey=(e,t)=>{let n;if(e.length>0){const t=e[e.length-1];r=t,Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(vy)||t===Sy||(n=t)}var r;const s=[];e.forEach(((t,r)=>{const o=t[vy];if(o!==i){const e=o.baseClass;if(e!==Sy)if(n){if(n!==e){const t=e.prototype.isPrototypeOf(n.prototype),r=n.prototype.isPrototypeOf(e.prototype);if(!t&&!r)throw new Error("Base class mismatch");n=r?e:n}}else n=e;s.push(o)}else if(r!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return Dy.new({requirements:s,mixinLambda:t,baseClass:n||Sy}).minimalClass},xy=function(e){return Boolean(e&&e[this[fy]])},Ry=(e,t)=>Boolean(e&&e[t[fy]]),Ty=Ey,My=Ey;class ky{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}}class Iy extends(Ty([],(e=>{e.prototype;return class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){}class Ay extends(Ty([Iy],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}}))){}class Fy extends(Ty([Iy,ao],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,n){const r=this,{asyncEvents:i,project:s}=r,o=null==i?void 0:i[e];return o&&(!0===o||o[n.action])?(t.trigger.call(r,`${e}PreCommit`,{...n}),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(r,e,n):!r.eventsSuspended&&s&&(s.dataReadyDetacher||(s.queuedDataReadyEvents=[],s.dataReadyDetacher=s.ion({dataReady(){this.queuedDataReadyEvents.forEach((([e,t,n,r])=>{e.trigger.call(t,n,r)})),s.queuedDataReadyEvents=null,s.dataReadyDetacher(),s.dataReadyDetacher=null},once:!0})),s.queuedDataReadyEvents.push([t,r,e,n])),!0):t.trigger.call(r,e,n)}calculateProject(){return this.project}setStoreData(e){var n;!this.project||this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag||(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const n=this.add(e,t);return await this.project.commitAsync(),n}async insertAsync(e,t,n){const r=this.insert(e,t,n);return await this.project.commitAsync(),r}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}performFilter(){var e;return this.project&&(this.isLoadingData||null!==(e=this.rootNode)&&void 0!==e&&e.isLoading)&&this.project.commitAsync().then((()=>this.filter())),super.performFilter(...arguments)}}}))){}class Py extends(Ty([Iy,ds],(e=>{const t=e.prototype;return class extends e{joinStore(e){let n=null;if(Ry(e,Fy)){const t=e.getProject();t&&!this.getProject()&&(this.setProject(t),n=t)}t.joinStore.call(this,e),n&&!n.isRepopulatingStores&&this.joinProject()}unjoinStore(e,n=!1){t.unjoinStore.call(this,e,n);const{project:r}=this,i=Ry(e,Fy)&&!e.isFillingFromMaster&&r===(e.isChained&&e.project?e.masterStore.project:e.project);r&&!r.isDestroying&&!r.isRepopulatingStores&&i&&(this.leaveProject(n),this.setProject(null)),i&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>Ry(e,Fy)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,n){var r;const i=this.set(e,t,n);return await(null===(r=this.project)||void 0===r?void 0:r.commitAsync()),i}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}}))){}class Oy extends(Ty([Py,Ay,ds],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var n;t.leaveProject.call(this,e),null===(n=this.project)||void 0===n||n.bufferedCommitAsync()}invalidate(){var e;null===(e=this.project)||void 0===e||e.invalidate(this)}getCurrentOrProposed(e){return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:this.get(e)??null}hasCurrentOrProposed(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}propose(e){var t;if(this.project||null!==(t=this.recurringTimeSpan)&&void 0!==t&&t.project){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.$changed[r]=e[r]}this.invalidate()}else this.set(e)}setChanged(e,t,n=!0,r=!1){const i=this;i.$changed[e]=t,r&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),n&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}class Ly extends(Ty([Oy],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this))));t.joinProject.call(this)}leaveProject(e=!1){var n;if(this.assigned&&!e&&(null===(n=this.resourceStore)||void 0===n||!n.isLoadingData)){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,n,r,i,s){"id"===(null==s?void 0:s.name)&&this.assigned.forEach((e=>{e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,i,s)}}}))){}const $y=Ly;class _y extends(oy(sy($y.derive(sd)))){static $name="ResourceModel"}_y.exposeProperties(),_y._$name="ResourceModel";class jy extends(Ty([Fy,Ay,ao],(e=>{const t=e.prototype;return class extends e{setProject(e){const n=t.setProject.call(this,e);return e&&this.joinProject(e),n}joinProject(e){}onCommitAsync(){}}}))){}const By={splice:1,clear:1};class Vy extends(Ty([Fy],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;const n=By[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterResourceRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterResourceRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const n=this.getById(e.id);if(n&&n!==e)for(const t of n.assigned||[])t.resource=e;return e}}}))){}class Hy extends(Ty([Vy,jy],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Ly}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}clear(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}}))){}const Ny=sy(Hy.derive(ho));class zy extends(iy(Ny)){static get defaultConfig(){return{modelClass:_y}}}zy._$name="ResourceStore";var Wy=e=>class extends(e||ye){static $name="EventStoreMixin";static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==Me.returnTrue?t=>t.isCreating||e(t):e}getEventCounts(e){const t=this,{filtersFunction:n,added:r}=t,i=t.getEvents({...e,storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?n:e=>r.includes(e)?t.indexOf(e)>-1:n(e):null,dateMap:e.dateMap||!0});return i.forEach(((e,t)=>i.set(t,e.length))),i}forEachScheduledEvent(e,t=this){this.forEach((n=>{const{startDate:r,endDate:i}=n;if(r&&i)return e.call(t,n,r,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((n=>{n.startDate&&(e=Gt.min(n.startDate,e)),n.endDate&&(t=Gt.max(n.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,t,n,r){if(r.data.generatedParent)return!1;const i=new Set(this.getEventsForResource(r));if(null!=n&&n.isAssignment){n.event.resources.forEach((e=>{e.id!==n.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(n){const e=n.isAssignment?n.event:n;i.delete(e)}const s=Array.from(i);return e.getTime()===t.getTime()?!s.some((n=>n.isScheduled&&(0===n.duration?n.startDate.getTime()===e.getTime():Gt.intersectSpans(e,t,n.startDate,n.endDate)))):!s.some((n=>n.isScheduled&&Gt.intersectSpans(e,t,n.startDate,n.endDate)))}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,n=!1){return this.assignmentStore.assignEventToResource(e,t,i,n)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,n){const r=this,i=ds.asId(n),s=r.assignmentStore.getAssignmentForEventAndResource(e,t);s?s.resourceId=i:r.assignmentStore.assignEventToResource(e,n)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}append(e){return this.add(e)}get project(){return super.project}set project(e){var t;(super.project=e,this.detachListeners("project"),e)&&(null!==(t=e.assignmentStore)&&void 0!==t&&t.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesResourceIds(){var e;return(null===(e=this.modelClass.fieldMap)||void 0===e?void 0:e.resourceIds.persist)??!1}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(e){this._usesSingleAssignment=e;const{assignmentStore:t}=this;null!=t&&t.isStore&&!t.hasGenerateIdOverride&&(t.modelClass.generateId=function(){return null==this.singleAssignmentIdCounter&&(this.singleAssignmentIdCounter=0),"a-"+ ++this.singleAssignmentIdCounter},t.hasGenerateIdOverride=!0)}processRecords(e){var t;const{assignmentStore:n}=this,r=[];return n&&(n.skipInvalidateIndices=!0),e=super.processRecords(e,n&&!(null!==(t=this.stm)&&void 0!==t&&t.isRestoring)&&(e=>{const t=e.get("resourceId");e.reassignedFromReplace||null==t||n.includesAssignment(e.id,t)||r.push({id:n.modelClass.generateId(""),resourceId:t,eventId:e.id}),e.reassignedFromReplace=!1})||i),n&&(n.storage.invalidateIndices(),n.skipInvalidateIndices=!1,n.add(r)),e}joinRecordsToStore(e){const{assignmentStore:t}=this;t?(t.skipInvalidateIndices=!0,super.joinRecordsToStore(e),t.storage.invalidateIndices(),t.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){var n;e=super.processRecord(e,t);const r=this,i=r.assignmentStore??(null===(n=r.crudManager)||void 0===n?void 0:n.assignmentStore),s=e.get("resourceId"),{resourceIds:o}=e;if(null!=o&&o.length&&!1!==e.meta.skipEnforcingSingleAssignment&&r.usesResourceIds)i?i.add(o.filter((t=>!i.some((n=>n.eventId===e.id&&n.resourceId===t)))).map((t=>({resource:t,event:e})))):r.$processResourceIds=!0;else if(null!=s&&!e.meta.skipEnforcingSingleAssignment){const n=r.getById(e.id);if(n&&n!==e&&!t){const t=i.storage.findItem("eventId",e.id);if(null!=t&&t.size){t.values().next().value.resource=s,e.reassignedFromReplace=!0}}else r.$processResourceIds=!0;r.usesSingleAssignment=!0}return e}processResourceIds(){var e,t;const n=this,r=n.assignmentStore??(null===(e=n.crudManager)||void 0===e?void 0:e.assignmentStore);if(n.$processResourceIds&&null!=r&&r.isAssignmentStore&&(null===(t=n.project)||void 0===t||!t.isSharingAssignmentStore||!n.isChained)){const e=[];n.forEach((t=>{const{resourceId:n,resourceIds:i,id:s}=t;null!=n?e.push({id:r.modelClass.generateId(""),resourceId:n,eventId:s}):null!=i&&i.length&&i.forEach((t=>{e.push({id:r.modelClass.generateId(""),resourceId:t,eventId:s})}))}),n,{includeFilteredOutRecords:!0}),r.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},r.usesSingleAssignment=!1,r.verifyNoGeneratedIds=!1,r.data=e,r.usesSingleAssignment=!0,n.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&(null===(t=n.stm)||void 0===t||!t.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach((n=>{const{event:r}=n;r&&!r.isRemoved&&r.assignments.every((t=>e.includes(t)))&&t.add(r)})),t.size&&n.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit({records:e}){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?e.forEach((e=>{const{event:t}=e;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)})):t.usesResourceIds&&e.forEach((e=>{const{event:t}=e;if(null!=t&&t.isEvent){t.meta.isAssigning=!0;const n=t.resourceIds??[];n.includes(e.resourceId)||(t.resourceIds=[...n,e.resourceId]),t.meta.isAssigning=!1}})))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?e.forEach((e=>{var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)})):t.usesResourceIds&&e.forEach((({event:e,resourceId:t})=>{const n=e.resourceIds.slice(),r=null==n?void 0:n.indexOf(t);r>=0&&(n.splice(r,1),e.resourceIds=n)})))},removeAllPreCommit(){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?t.allRecords.forEach((e=>e.set("resourceId",null))):t.usesResourceIds&&t.allRecords.forEach((e=>{e.resourceIds=[]})))},update({record:e,changes:n}){if("resourceId"in n){const{event:r}=e;if(t.usesSingleAssignment)r.meta.isAssigning=!0,r.set("resourceId",n.resourceId.value),r.meta.isAssigning=!1;else if(t.usesResourceIds){r.meta.isAssigning=!0;const e=r.resourceIds.slice(),t=null==e?void 0:e.indexOf(n.resourceId.oldValue);t>=0&&e.splice(t,1),null!=e&&e.includes(n.resourceId.value)||(e.push(n.resourceId.value),r.resourceIds=e),r.meta.isAssigning=!1}}},change({action:e,records:n}){"dataset"===e&&t.usesResourceIds&&n.forEach((({event:e,resourceId:t})=>{const n=e.resourceIds??[];n.includes(t)||(n.push(t),e.meta.isAssigning=!0,e.setData("resourceIds",n),e.meta.isAssigning=!1)}))},thisObj:t}))}set data(e){this.isSettingData=!0,!this.usesSingleAssignment||this.syncDataOnLoad||this.isChained||this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){var n;const{changes:r}=t||{};return!r||!("resourceId"in r)||1!==Object.keys(r).length||null!==(n=this.stm)&&void 0!==n&&n.isRestoring||(t.isAssign=!0),super.trigger(...arguments)}remove(e,...t){const n=super.remove(e,...t);if(n.length&&this.usesSingleAssignment)for(const e of n){var r,i;if(!e.isOccurrence)null===(r=this.assignmentStore||(null===(i=this.crudManager)||void 0===i?void 0:i.assignmentStore))||void 0===r||r.remove(e.assignments,!0)}return n}};const Uy=()=>!0;var Gy=e=>class extends e{static $name="GetEventsMixin";getEvents({filter:e,date:t,startDate:n,endDate:r,startOnly:i,includeOccurrences:s,allowPartial:o,onlyAssigned:a=!1,dateMap:l=!1,dayTime:c=null,getDateIndex:d}){const u=this,h=arguments[0],{lastDateRange:g,added:m,filtersFunction:f}=u,v=e;if(a&&(h.filter=v?e=>v(e)&&e.resources.length:e=>e.resources.length),"startDate"in h||(n=h.startDate=t),"includeOccurrences"in h||(s=h.includeOccurrences=!0),"allowPartial"in h||(o=h.allowPartial=!i),h.storeFilterFn=u.isFiltered&&!h.ignoreFilters?u.reapplyFilterOnAdd?f:e=>m.includes(e)?u.indexOf(e)>-1:f(e):null,!r)if(n)(r=h.endDate=Gt.clearTime(n)).setDate(r.getDate()+1);else{if(s)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");h.dateFilter=Uy}h.dateFilter||(h.dateFilter=i?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(Gt.clearTime(t)-n)}:o?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&(!(t-i)?Gt.betweenLesserEqual(t,n,r):Gt.intersectSpans(t,i,n,r))}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=n&&i<=r});const y={startDate:n,endDate:r};return u.processConfiguredListeners(),u.trigger("loadDateRange",{old:g||{},new:p.clone(y),changed:Boolean(!g||g.startDate-y.startDate||g.endDate-y.endDate)}),u.lastDateRange=p.clone(y),l?u.getEventsAsMap(h):u.getEventsAsArray(h)}getEventsAsArray({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dayTime:a=null,dateFilter:l,storeFilterFn:c,getDateIndex:d}){const u=this,h=[];if(c?u.count:u.allCount){let e=n?u.getEventsForResource(n):null;if(!n){const t=u.useDayIndex(a),n=new Set,o=s?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=r&&n.add(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){const r=t.get(d?d(e):o,e);null==r||r.forEach((e=>n.add(e)))}e=[...n]}c&&(e=e.filter(c));for(let t=0,{length:n}=e;t<n;t++){const n=e[t];o&&n.isRecurring?h.push.apply(h,n.getOccurrencesForDateRange(r,i).filter(l)):l(n)&&h.push(n)}}return e?h.filter(e):h}getEventsAsMap({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateMap:a,dayTime:l=null,storeFilterFn:c,getDateIndex:d}){var u;const h=this;if(null!==(u=a)&&void 0!==u&&u.clear?a.clear():a=new Map,h.count){const t=h.useDayIndex(l),u=s?"startDate":"date",p=[],f=t=>(!e||e(t))&&(!c||c(t)),v=e=>!e.isRecurring&&f(e);if(l=t.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var g;null===(g=h.recurringEvents)||void 0===g||g.forEach((e=>{l.startOfDay(e.startDate)<i&&p.push(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){var m;let[n,r]=t.get(d?d(e):u,e,!0);null!==(m=n)&&void 0!==m&&m.size&&(n=[...n].filter(v),n.length&&(a.get(r)||a.set(r,[]).get(r)).push(...n))}for(let e=0,{length:t}=p;e<t;e++){const t=p[e],n=(o?t.getOccurrencesForDateRange(r,i):[t]).filter(f),c=Gt.add(i,1,"day");for(let e,t=0,{length:r}=n;t<r;t++){const r=n[t],i=l.startOfDay(r.startDate),o="startDate"!==(d?d(i):s?"startDate":"date")&&r.durationMS?Gt.min(r.endDate||Gt.add(r.startDate,r.duration,r.durationUnit),c):Gt.add(i,1,"day");for(;i<o;i.setDate(i.getDate()+1)){const t=l.dateKey(i);(e=a.get(t))||a.set(t,e=[]),e.push(r)}}}}return a}};const Yy={date:"_dateIndex",startDate:"_startDateIndex"},qy=Object.values(Yy),Ky=Object.freeze([]),{MILLIS_PER_DAY:Xy}=Jg;class Zy{constructor(e,t){this.dayTime=t||Jg.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,n){const r=this[Yy[e]],i=this.dayTime.dateKey(t);(r[i]||(r[i]=new Set)).add(n)}addEvent(e){var t;let n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var i;n=(null===(i=e.endDate)||void 0===i?void 0:i.getTime())??r,this.add("startDate",r,e);do{this.add("date",r,e),r+=Xy}while(r<n)}}clear(){qy.forEach((e=>this[e]=Object.create(null)))}get(e,t,n){!this.initialized&&this.initialize();let r,i=this[Yy[e]];return t&&(r=this.dayTime.dateKey(t),i=n?[i[r],r]:i[r]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,qy.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,n){const r=this[Yy[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}removeEvent(e,t,n){var r;let i,s=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(s){i=(null==n?void 0:n.getTime())??s,this.remove("startDate",s,e);do{this.remove("date",s,e),s+=Xy}while(s<i)}}sync(e,t,n,r,i){var s,o;n=n||Ky;const a=this,l=(t=t||Ky).length,c=n.length,d=null==r?void 0:r.length;let u,h,g;if(a.initialized)switch(e){case"clear":a.clear();break;case"splice":if(d)for(t=t.slice(),n=n.slice(),u=0;u<d;u++)n.push(r[u][0]),t.push(r[u][1]);if(c)for(u=0;u<c;u++)g=n[u],a.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&!h.isParent&&a.addEvent(h);break;case"reschedule":g=t[0],a.removeEvent(g,(null===(s=i.startDate)||void 0===s?void 0:s.oldValue)||g.startDate,(null===(o=i.endDate)||void 0===o?void 0:o.oldValue)||g.endDate),a.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}const Jy=Zy.prototype;qy.forEach((e=>Jy[e]=null)),Jy.initialized=!1,Zy._$name="EventDayIndex";const{MIDNIGHT:Qy}=Jg;var eb=e=>class extends e{static $name="DayIndexMixin";construct(e){super.construct(e),this.dayIndices=null}afterLoadData(){var e;this.syncIndices("splice",this.storage.allValues),null===(e=super.afterLoadData)||void 0===e||e.call(this)}onDataChange({action:e,added:t,removed:n,replaced:r}){this.syncIndices(e,t,n,r),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,n,r,i){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[e],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,n=t.dayIndices||(t.dayIndices=[]);let r,i;for(i=0;!r&&i<n.length;++i)n[i].matches(e)&&(r=n[i]).register(e);return!r&&n.push(r=new Zy(t,e)),r}syncIndices(...e){var t;null===(t=this.dayIndices)||void 0===t||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}useDayIndex(e){const t=this,{dayIndices:n}=t;e=e||Qy;for(let t=0;n&&t<n.length;++t)if(n[t].matches(e))return n[t];if(e.startShift)throw new Error(`No day index registered for ${e} on ${t.id}`);return t.registerDayIndex(Qy)}};const tb=Object.freeze([]);var nb=e=>class extends(e||ye){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:n,replaced:r}){this.refreshRecurringEventsCache(e,t,n,r),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=tb,n=tb,r){const{recurringEvents:i}=this,s=null==r?void 0:r.length;switch(e){case"clear":i.clear();break;case"splice":{if(s){t=t.slice(),n=n.slice();for(let e=0;e<s;e++)n.push(r[e][0]),t.push(r[e][1])}const e=t.length,o=n.length;if(o&&i.size)for(let e=0;e<o;e++)i.delete(n[e]);if(e)for(let n=0;n<e;n++){const e=t[n];e.isRecurring&&i.add(e)}break}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,n,r,i){const s=!r&&this.isRecurrenceRelatedFieldChange(e,n);if(s&&e.removeOccurrences(),super.onModelChange(...arguments),s){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,n){const r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(e=>r.push(e))),r}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},rb=e=>class extends(nb(e||ye)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};const ib=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,sb=["SU","MO","TU","WE","TH","FR","SA"];class ob extends ye{static decodeDay(e){let t,n;return(t=ib.exec(e))&&(n=[sb.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+sb[e]}static decode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.decodeDay(e[r]))&&t.push(n);return t}static encode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.encodeDay(e[r]))&&t.push(n);return t}}ob._$name="RecurrenceDayRuleEncoder";const ab=/ly$/i,lb=e=>{const t=e.replace(ab,"");return"DAI"===t?"DAY":t},cb=(e,t,n,r)=>r.buildOccurrence(e,n),db=e=>ub=e;let ub;class hb extends ye{static frequency="NONE";static MAX_OCCURRENCES_COUNT=1e6;static processIterationConfig(e){var t;const{recurrence:n}=e,{frequency:r,interval:i,timeSpan:s,endDate:o,count:a}=n;if(!e.syncingStartDate&&!s.meta.isSyncedWithRule){const t=Gt.add(s.startDate,i,lb(r)),o=Gt.min(t,e.endDate||t);this.forEachDate({syncingStartDate:!0,startDate:s.startDate,endDate:o,recurrence:n,fn:cb})}const l=s.startDate;let{startDate:c=l,endDate:d=o}=e;c<l&&(c=l),o?(!d||d>o)&&(d=o):a&&c>l&&(this.forEachDate({recurrence:n,fn:db}),(!d||d>ub)&&(d=new Date(ub.getTime()+1)));const u=c;return e.startOnly||(c=new Date(Gt.max(Gt.add(c,-i,lb(r)),l))),Object.assign({extraArgs:[],startOnly:!Boolean(s.durationMS)},e,{startDate:c,endDate:d,timeSpan:s,timeSpanStart:l,earliestVisibleDate:u,endDateMS:null===(t=d)||void 0===t?void 0:t.getTime(),timeSpanStartMS:l.getTime(),earliestVisibleDateMS:u.getTime(),durationMS:s.durationMS,spansStart:c<=l&&d>l})}static getOccurrenceIndex(e){if(e.isOccurrence)return Gt.diff(e.recurringTimeSpan.startDate,e.startDate,lb(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,n,r){let i,s,o;if(r){r>0?(s=1,o=e):(s=-1,o=t);const a=n-o.getDay();s*a<0&&(r+=s),i=new Date(o),i.setDate(o.getDate()+7*(r-s)+a),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,n){const r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,n,r){const i=e.length,s={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[i+a];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===n.call(r,t)))return!1}}}static isInView(e,t,n,r,i){return(e?t>=n:t.valueOf()+r>n)&&!i.hasException(t)}static isInViewMS(e,t,n,r,i,s){return(e?n>=r:n+i>r)&&!s.hasException(t)}}hb._$name="AbstractRecurrenceIterator";class gb extends hb{static frequency="DAILY";static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,earliestVisibleDateMS:a,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:m}=d,p=n-o,f=864e5*m,v=Math.floor(p/f);let{count:y}=d,b=0,C=Gt.add(o,v*m,"day"),S=C.getTime();for(r||y||(y=this.MAX_OCCURRENCES_COUNT);!i||S<i;){if(b++,this.isInViewMS(t,C,S,a,l,s)&&(i&&S>i||!1===u.apply(g,[C,b,1===b&&c,s,...h])||y&&b>=y))break;C=Gt.add(C,m,"day"),S=C.getTime()}}}gb._$name="DailyRecurrenceIterator";class mb extends hb{static frequency="WEEKLY";static forEachDate(e){var t;const{startOnly:n,startDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,timeSpanStartMS:a,earliestVisibleDateMS:l,durationMS:c,spansStart:d,recurrence:u,fn:h,extraArgs:g,scope:m=this}=this.processIterationConfig(e),{interval:p,days:f}=u,{weekStartDay:v}=Gt,y=o.getHours(),b=o.getMinutes(),C=o.getSeconds(),S=o.getMilliseconds();let D,w,E=0,{count:x}=u,R=ob.decode(f);if(null!==(t=R)&&void 0!==t&&t.length||(R=[[o.getDay()]]),v>0)for(let e=0;e<R.length;e++)v>R[e][0]?R[e][0]=7-v-R[e][0]:R[e][0]-=v;for(R.sort(((e,t)=>e[0]-t[0])),D=Gt.getNext(x||p>1?o:r,"week",0),i||x||(x=this.MAX_OCCURRENCES_COUNT);!i||D.getTime()<i;){for(let e=0;e<R.length;e++){w=new Date(D.getFullYear(),D.getMonth(),D.getDate()+R[e][0],y,b,C,S);const t=w.getTime();if(t>=a){if(E++,this.isInViewMS(n,w,t,l,c,s)&&(i&&t>=i||!1===h.apply(m,[w,E,1===E&&d,s,...g])||x&&E>=x))return}}D=Gt.getNext(D,"week",p)}}}mb._$name="WeeklyRecurrenceIterator";class pb extends hb{static frequency="MONTHLY";static getNthDayOfMonth(e,t){const n=Gt.daysInMonth(e);let r=null;return t&&Math.abs(t)<=n&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?n+t+1:t)),r}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=ob.decode(m),y=f&&f.length,b={};let C,S,D,w,E,x,{monthDays:R}=c,T=0;for(S=Gt.startOf(p||g>1?s:n,"month"),D=new Date(Gt.getNext(S,"month",1)-1),R&&R.length||v&&v.length||(R=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!r||r>S)&&(!p||T<p);){if(w=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),x=n;x<=r;x++)(E=this.getNthDayInPeriod(S,D,t,x))&&(E=Gt.copyTimeValues(E,s),b[E.getTime()]||(b[E.getTime()]=!0,w.push(E)))})),w.sort(((e,t)=>e-t)),!y)for(x=0;x<w.length;x++)if(E=w[x],E>=s){const e=this.isInView(t,E,o,a,i);if(T++,e&&(r&&E>=r||!1===d.apply(h,[E,T,1===T&&l,i,...u])||p&&T>=p))return!1}}else{const e=[];for(x=0;x<R.length;x++)(E=this.getNthDayOfMonth(S,R[x]))&&!b[E.getTime()]&&(b[E.getTime()]=!0,e.push(E));for(e.sort(((e,t)=>e-t)),x=0;x<e.length;x++)if(E=Gt.copyTimeValues(e[x],s),y)w.push(E);else if(E>=s){const e=this.isInView(t,E,o,a,i);if(T++,e&&(r&&E>r||!1===d.apply(h,[E,T,1===T&&l,i,...u])||p&&T>=p))return}}y&&w.length&&this.forEachDateAtPositions(w,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<=r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),S=Gt.getNext(S,"month",g),D=new Date(Gt.getNext(S,"month",1)-1)}}}pb._$name="MonthlyRecurrenceIterator";class fb extends hb{static frequency="YEARLY";static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=ob.decode(m),y=f&&f.length,b={};let C,S,D,w,E,x,{months:R}=c,T=0;for(w=Gt.startOf(p||g>1?s:n,"year"),E=new Date(Gt.getNext(w,"year",1)-1),R&&R.sort(((e,t)=>e-t)),R&&R.length||v&&v.length||(R=[s.getMonth()+1]),v&&v.length&&v.forEach((e=>{e[1]&&(x=x||{},x[e[0]]=e[1])}));(!r||r>w)&&(!p||T<p);){if(D=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),C=n;C<=r;C++)(S=this.getNthDayInPeriod(w,E,t,C))&&(S=Gt.copyTimeValues(S,s),b[S.getTime()]||(b[S.getTime()]=!0,D.push(S)))})),D.sort(((e,t)=>e-t)),!y)for(C=0;C<D.length;C++)if(S=D[C],S>=s){const e=this.isInView(t,S,o,a,i);if(T++,e&&(r&&S>=r||!1===d.apply(h,[S,T,1===T&&l,i,...u])||p&&T>=p))return}}else for(C=0;C<R.length;C++)if((S=this.buildDate(w.getFullYear(),R[C]-1,s.getDate()))&&(S=Gt.copyTimeValues(S,s),!b[S.getTime()]))if(b[S.getTime()]=!0,y)D.push(S);else if(S>=s){const e=t?S>=o:S.valueOf()+a>o&&!i.hasException(S);if(T++,e&&(r&&S>=r||!1===d.apply(h,[S,T,1===T&&l,i,...u])||p&&T>=p))return}y&&D.length&&this.forEachDateAtPositions(D,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),w=Gt.getNext(w,"year",g),E=new Date(Gt.getNext(w,"year",1)-1)}}}fb._$name="YearlyRecurrenceIterator";const vb={};function yb(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function bb(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function Cb(e,t){return String(e)===String(t)}function Sb(e){return this.defaultValue&&e===i?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?i:e)}[gb,mb,pb,fb].forEach((e=>{vb[e.frequency]=e}));class Db extends ds{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Sb},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Sb},{name:"days",convert:bb,isEqual:Cb},{name:"monthDays",convert:yb,isEqual:Cb},{name:"months",convert:yb,isEqual:Cb},{name:"positions",convert:yb,isEqual:Cb}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return vb[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push(`FREQ=${e.frequency}`),e.interval>1&&t.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push(`COUNT=${e.count}`),e.endDate&&t.push("UNTIL="+Gt.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this,n={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(t.beginBatch(),e){const r=e.split(";");for(let e=0,i=r.length;e<i;e++){const i=r[e].split("="),s=i[1];switch(i[0]){case"FREQ":n.frequency=s;break;case"INTERVAL":n.interval=s;break;case"COUNT":n.count=s,n.until=null;break;case"UNTIL":n.endDate=s?Gt.parse(s,t.dateFormat):null,n.count=null;break;case"BYDAY":n.days=s;break;case"BYMONTHDAY":n.monthDays=s;break;case"BYMONTH":n.months=s;break;case"BYSETPOS":n.positions=s}}}t.set(n),e&&t.sanitize(),t.endBatch()}construct(e={}){const t=this,{rule:n,timeSpan:r}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),n&&(t.suspendTimeSpanNotifying(),t.rule=n,t.resumeTimeSpanNotifying()),t.timeSpan=r}forEachOccurrence(e,t,n){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn:(e,t,r,i)=>n(i.buildOccurrence(e,r),r,t,e)})}sanitize(){var e;const t=this,n=null===(e=t.timeSpan)||void 0===e?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===ob.encodeDay(n.getDay())&&(r.days=null);break}case"MONTHLY":{var i;null!==(i=t.monthDays)&&void 0!==i&&i.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===n.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===n.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,n){const r=super.afterChange(e,t,n),{timeSpan:i}=this;return this.isSanitizing||this.sanitize(),i&&(i.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged()),r}set(e,t,...n){const r="object"==typeof e?e:{[e]:t};r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,i,...n)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function wb(e){const t={},{dateFormat:n}=this;return e&&(e="string"==typeof e?e.split(","):H.asArray(e)).forEach((e=>{"string"==typeof e&&(e=Gt.parse(e,n)),isNaN(e)||(t[Gt.makeKey(e)]=1)})),t}function Eb(e){const t=[],{dateFormat:n}=this;for(const r in e)e[r]&&t.push(Gt.format(Gt.parseKey(r),n));return t}Db._$name="RecurrenceModel";const xb=[];var Rb=e=>class extends(e||Iv){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:wb,serialize:Eb,internal:!0}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);{const e=this,{recurringTimeSpan:t}=e;e.cancelBatch(),t.beginBatch(),e.detachFromRecurringEvent(),t.endBatch()}}get eventStore(){var e,t;let n=this.isOccurrence&&(null===(e=this.recurringEvent)||void 0===e?void 0:e.eventStore)||super.eventStore;return!n&&null!==(t=this.firstStore)&&void 0!==t&&t.isRecurringTimeSpansMixin&&(n=this.firstStore),n}get recurrenceModel(){return this._recurrenceModel||Db}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,n){const r=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new r.recurrenceModel(e)),e.timeSpan=r,i=e.rule),r.recurrence=e,r.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return xb}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e,t=this.eventStore){const n=e.isTimeSpan?e.occurrenceDate:e;null==t||t.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(Gt.makeKey(n))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,n)=>{Gt.parseKey(n)>=e&&this.removeOccurrence(t)}))}removeOccurrences(e){[this,...this.occurrences].forEach((t=>this.removeOccurrence(t,e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}sanitizeRecurrenceData(e=this.recurrence){if(e.endDate){const t=Gt.clearTime(e.endDate),{exceptionDates:n}=this;if(this.removeOccurrencesFrom(t),n)for(const e in n){Gt.parseKey(e)>=t&&delete n[e]}}}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return hb.getOccurrenceIndex(this)}buildOccurrence(e,t){var n;const r=this,{occurrenceMap:s,recurrence:o,meta:a}=r,l=null===(n=r.eventStore)||void 0===n?void 0:n.globalOccurrences,c=Gt.makeKey(e),d=r.createRecurrenceKey(e,c),u=!(e-r.startDate),{fieldMap:h}=r.constructor;let g=null==l?void 0:l.get(d),{duration:m}=r;!r.endDate||!r.allDay&&m||(m=Gt.as(r.durationUnit,r.endDate.getTime()-r.startDate.getTime()));const p=m!==i?Gt.add(e,m,r.durationUnit):i;return g||(t||u?(g=r,u||(r.setStartEndDate(e,p,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),a.isSyncedWithRule=!0):(g=r.copy({[h.id.dataSource]:d,[h.startDate.dataSource]:e,[h.endDate.dataSource]:p,[h.duration.dataSource]:m,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=r),null==l||l.set(d,g),s.set(c,g)),g}createRecurrenceKey(e=this.startDate,t=null){return`_generated:${this.id}:${t||Gt.makeKey(e)}`}convertToRealEvent(e,t){var n;if(!this.isOccurrence)return;const r=this,{recurringTimeSpan:i,resource:s,occurrenceIndex:o,recurrence:a}=r,l=a&&i.recurrence.count,c=(null==e||null===(n=e.resourceRecords)||void 0===n?void 0:n.value)||r.data.newResource;i.beginBatch(),r.detachFromRecurringEvent(),r.clearChanges(),r.setData("id",r.generateId(i.eventStore)),c&&delete r.data.resourceId,i.eventStore.add(r,t),l&&(r.recurrence.count=l-o),(c||s)&&r.assign(c||s),c&&delete r.data.resourceRecords,e&&delete e.resourceRecords,i.endBatch()}afterChange(e,t,n,...r){const i=this,{eventStore:s}=i;return"recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence?i.convertToRealEvent(t,n):"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value)),super.afterChange(e,t,n,...r)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:n,startDate:r}=e;e.recurringTimeSpan=null,t.addExceptionDate(n),e.recurrenceRule&&(t.recurrence.endDate=Gt.add(r,-1,"minute"))}set newExceptionDate(e){if(e){(this.exceptionDates||(this.exceptionDates={}))[Gt.makeKey(e)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var t;return null===(t=this.exceptionDates)||void 0===t?void 0:t[Gt.makeKey(e)]}};var Tb=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach((e=>{e.eventId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}setValue(e,t){if("resource"!==e||this.usesSingleAssignment)return super.setValue(e,t);this.resources=H.asArray(t)??[]}get resources(){return this.assignments.reduce(((e,{resource:t})=>(t&&e.push(t.$original),e)),[])}set resources(e){var t;e=H.asArray(e);const n=this,r=e.map(n.constructor.asId);if(n.usesSingleAssignment)n.set("resourceId",r[0]);else if(null!==(t=n.fieldMap)&&void 0!==t&&t.resourceIds.persist)n.resourceIds=r;else{const e=n.assignments.map((e=>e.resource.id)),{onlyInA:t,onlyInB:i}=H.delta(r,e);n.assignmentStore.add(t.map((e=>({resource:e,event:n})))),n.assignmentStore.remove(i.map((e=>n.assignments.find((t=>t.resource.id===e)))))}}forEachResource(e,t=this){for(const n of this.resources)if(!1===e.call(t,n))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e;return e=this.isOccurrence?this.get("startDate"):this._startDate??super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){let e;return e=this.isOccurrence?this.get("endDate"):this._endDate??super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(e,t,n){const r=this,i=r.isPersistable;if(super.endBatch(e,t,n),r.isPersistable&&!i&&!r.ignoreBag&&r.assigned)for(const e of r.assigned)e.stores.forEach((t=>t.updateModifiedBagForRecord(e)))}get isCreating(){return super.isCreating}set isCreating(e){var t,n;super.isCreating=e,null===(t=this.assignmentStore)||void 0===t||t.suspendAutoCommit(),this.assignments.forEach((t=>t.isCreating=e)),null===(n=this.assignmentStore)||void 0===n||n.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const t=super.copy(...e);return this.usesSingleAssignment||(t.resourceId=null),t}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.assignments[0])||void 0===e?void 0:e.resourceId}set resourceId(e){this.applyResourceId(e)}get resourceIds(){var e,t;return null!==(e=this.fieldMap)&&void 0!==e&&e.resourceIds.persist?this.get("resourceIds"):(null===(t=this.resources)||void 0===t?void 0:t.map((e=>e.id)))??[]}set resourceIds(e){this.set("resourceIds",e)}get $linkedResources(){var e;return(null===(e=this.resources)||void 0===e?void 0:e.flatMap((e=>[e,...e.$links])))??[]}applyResourceId(e,t=!1){const n=this,{eventStore:r,assignments:i}=n;if(r){var s,o;const t=r.assignmentStore||(null===(s=r.crudManager)||void 0===s?void 0:s.assignmentStore);if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(r.usesSingleAssignment=!0),null!=i&&i.length&&e!==i[0].resourceId){const n=Boolean(r.eventsSuspended);n&&t.suspendEvents(),i[0].resource=e,n&&t.resumeEvents()}else t.assignEventToResource(n,e);else(n.usesSingleAssignment||null!==(o=n.resourceIds)&&void 0!==o&&o.length)&&t.remove(i)}else t||n.set({resourceId:e})}applyResourceIds(e,t=!1){const n=this,{eventStore:r,assignments:i}=n;if(!1===n.fieldMap.resourceIds.persist)return!1;if(e=[...new Set(e)],r){var s,o;const t=r.assignmentStore||(null===(s=r.crudManager)||void 0===s?void 0:s.assignmentStore);if(null!==(o=e)&&void 0!==o&&o.length)if(null!=i&&i.length){const s=Boolean(r.eventsSuspended);s&&t.suspendEvents(),i.forEach((t=>{const n=e.find((e=>!i.some((t=>t.resourceId===e))));n&&(t.resource=n)}));const{onlyInA:o,onlyInB:a}=H.delta(e,i.map((e=>e.resourceId)));t.add(o.map((e=>({resource:e,event:n})))),t.remove(a.map((e=>i.find((t=>t.resource.id===e))))),s&&t.resumeEvents()}else t.add(e.map((e=>({resource:e,event:n}))));else t.remove(i)}else t||n.set({resourceIds:e})}applyValue(e,t,n,r,i){if(i&&!this.meta.isAssigning){const{eventStore:e}=this;switch(i.name){case"resourceId":e&&(e.isAssigning=!0),this.applyResourceId(n,!0);break;case"resourceIds":e&&(e.isAssigning=!0),this.applyResourceIds(n,!0)}e&&(e.isAssigning=!1)}super.applyValue(e,t,n,r,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var n;const r=this;e=r.constructor.asId(e),r.meta.removingResource=t,null===(n=r.eventStore)||void 0===n||n.unassignEventFromResource(r,e),r.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){return[...this.incomingDeps??[]]}get successors(){return[...this.outgoingDeps??[]]}get dependencies(){return[...this.incomingDeps??[],...this.outgoingDeps??[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=864e5||!e&&this.allDay)return!0;const{endDate:t,startDate:n}=this,r=Gt.clearTime(n);return n&&t?(r.setDate(r.getDate()+1),(t||Gt.add(n,e))>r):void 0}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=Gt.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=Gt.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),Gt.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),Gt.clearTime(t,!0).valueOf()===t.valueOf()?t=Gt.add(t,Gt.DAY,-1):e.valueOf()!==t.valueOf()&&(t=Gt.clearTime(t,!0))),t}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}};class Mb extends(Ty([Oy],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){return this._startDate??this.get("startDate")??null}get endDate(){return this._endDate??this.get("endDate")??null}get duration(){return this._duration??this.get("duration")??null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,n,r,i,s){const o=this;return!o.project||o.project.isWritingData||"string"==typeof e||s||("startDate"in e&&!("startDate"in o.$changed)&&(o.$changed.startDate=!0,o.invalidate()),"endDate"in e&&!("endDate"in o.$changed)&&(o.$changed.endDate=!0,o.invalidate())),t.inSet.call(o,e,n,r,i,s)}getStartDate(){return this.startDate}proposeStartDate(e,t=!("endDate"in this.$changed)){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.startDate)||void 0===n?void 0:n.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:t}))}async setStartDate(e,t=!0){var n;return this.proposeStartDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.endDate)||void 0===n?void 0:n.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:t}))}async setEndDate(e,t=!1){var n;return this.proposeEndDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,n=!0){this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}async setDuration(e,t,n=!0){var r;return this.proposeDuration(e,t,n),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const e=this,n=e.$changed,r=e.getCurrentOrProposed("startDate"),i=e.getCurrentOrProposed("endDate"),s=e.getCurrentOrProposed("duration");if(null!=r&&(n.startDate=e._startDate=r),null!=i&&(n.endDate=e._endDate=i),null!=s&&(n.duration=e._duration=s),e.eventStore&&!e.eventStore.isLoadingData){var o;const t=null===(o=e.assignmentStore)||void 0===o?void 0:o.storage.findItem("event",null);if(t){var a;const n=null===(a=e.assignmentStore)||void 0===a?void 0:a.storage.findItem("eventId",e.id);if(n)for(const t of n)t.setChanged("event",e);else for(const n of t)n.getCurrentOrProposed("event")===e.id&&n.setChanged("event",e)}}t.joinProject.call(e)}applyValue(e,n,r,i,s){var o;if((this.project||null!==(o=this.recurringTimeSpan)&&void 0!==o&&o.project)&&s){const{name:t}=s;"startDate"!==t&&"duration"!=t&&"endDate"!==t||(e=!0,this["_"+t]=r),i&&(e=!1)}t.applyValue.call(this,e,n,r,i,s)}afterChange(e,n,r,i,s){this.$isCalculating||s||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,n,r,i,s)}calculateInvalidated(){var e;const t=this,n=t.$changed,r="startDate"in n,i="endDate"in n,s="duration"in n,{startDate:o,endDate:a,duration:l,keepDuration:c,keepStart:d}=n;let u=null;!r||i||s?r||!i||s?r||i||!s?r&&i&&!s?null===o&&null===a?n.duration=null:u="duration":r&&!i&&s?u="endDate":!r&&i&&s?u="startDate":r&&i&&s&&(u=null==l?"duration":null==o?"startDate":"endDate"):null===l?n.endDate=null:!t.hasCurrentOrProposed("startDate")||!d&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="startDate"):(d&&n.duration<0&&(n.duration=0),u="endDate"):null===a?n.startDate=null:t.hasCurrentOrProposed("startDate")&&!c&&!0!==a&&a<t.getCurrentOrProposed("startDate")?(n.startDate=a,n.duration=0):!t.hasCurrentOrProposed("duration")||!c&&t.hasCurrentOrProposed("startDate")?t.hasCurrentOrProposed("startDate")&&(u="duration"):u="startDate":null===o?n.endDate=null:t.hasCurrentOrProposed("endDate")&&o>t.getCurrentOrProposed("endDate")&&!c?(n.endDate=o,n.duration=0):!t.hasCurrentOrProposed("duration")||!c&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="duration"):u="endDate";const h=t.getCurrentOrProposed("startDate"),g=t.getCurrentOrProposed("endDate"),m=t.getCurrentOrProposed("duration"),p=t.getCurrentOrProposed("durationUnit"),f=(null===(e=t.getProject())||void 0===e?void 0:e.adjustDurationToDST)??!1;switch(u){case"startDate":const e=Gt.add(g,-m,p);if(f){const t=g.getTimezoneOffset()-e.getTimezoneOffset();e.setTime(e.getTime()-60*t*1e3)}n.startDate=e;break;case"endDate":const t=Gt.add(h,m,p);if(f){const e=h.getTimezoneOffset()-t.getTimezoneOffset();t.setTime(t.getTime()-60*e*1e3)}n.endDate=t;break;case"duration":let r=Gt.diff(h,g,"millisecond");if(f){r+=60*(h.getTimezoneOffset()-g.getTimezoneOffset())*1e3}n.duration=Gt.as(p,r,"millisecond")}"startDate"in n&&!0!==n.startDate&&(this._startDate=n.startDate),"endDate"in n&&!0!==n.endDate&&(this._endDate=n.endDate),"duration"in n&&!0!==n.duration&&(this._duration=n.duration),!0===n.startDate&&delete n.startDate,!0===n.endDate&&delete n.endDate,delete n.keepDuration,delete n.keepStart}}}))){}class kb extends(Ty([Py],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const t of this.assigned??[])if(t.resource===e)return t;return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}class Ib extends(Ty([Mb,kb],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return(null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getEventsAssignments(this))??this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,n,r,i,s){var o;"id"===n&&(null===(o=this.assigned)||void 0===o||o.forEach((e=>e.set("eventId",r))));t.applyValue.call(this,e,n,r,i,s)}copy(e=null,n=null){const r=t.copy.call(this,e,n);return(Xt.isObject(n)&&!n.skipFieldIdentifiers||!Xt.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}}))){}class Ab extends(Ty([Mb],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class Fb extends(Ty([Mb,Ib,Ab],(e=>{e.prototype;return class extends e{}}))){}const Pb=Fb;class Ob extends(Pb.derive(Iv).mixin(Rb,sy,Tb)){static get $name(){return"EventModel"}}Ob.exposeProperties(),Ob._$name="EventModel";const Lb={splice:1,clear:1};class $b extends(Ty([Fy],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;const n=Lb[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterEventRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterEventRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}onNodeRemoveChild(e,n,r,i){const s=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),s}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!n.assignmentsForRemoval.has(e)));t.length>0&&n.remove(t)}e.clear();const r=this.getDependencyStore();if(r&&!r.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!r.dependenciesForRemoval.has(e)));e.length>0&&r.remove(e)}t.clear()}processRecord(e,t=!1){var n;if(null===(n=this.project)||void 0===n||!n.isRepopulatingStores){const t=this.getById(e.id);if(t&&t!==e&&t.assigned)for(const n of t.assigned)n.event=e}return e}}}))){}class _b extends(Ty([$b,jy],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Fb}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}}))){}const jb=sy(_b.derive(ho));class Bb extends(jb.mixin(rb,Wy,eb,Gy)){static $name="EventStore";static get defaultConfig(){return{modelClass:Ob}}}Bb._$name="EventStore";var Vb=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){e=e||{};const{fieldMap:n}=this,r=n.eventId.dataSource,i=n.resourceId.dataSource,s=n.event.dataSource,o=n.resource.dataSource,a=e[r],l=e[i],c=e[s],d=e[o];null!=a?e[s]=a:null!=c&&(e[r]=c.isModel?c.id:c),null!=l?e[o]=l:null!=d&&(e[i]=d.isModel?d.id:d),super.construct(e,...t)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,t){let n,r;return n=e?e.isModel?e.id:e:this.internalId,r=t?t.isModel?t.id:t:this.internalId,`${n}-${r}`}buildIndexKey({event:e,resource:t}){return this.buildEventResourceKey(e,t)}set(e,t,...n){const r=this.fieldToKeys(e,t);var s,o;"resource"in r?(null===(s=r.resource)||void 0===s?void 0:s.id)!==i&&(r.resourceId=r.resource.id):"resourceId"in r&&this.constructor.isProAssignmentModel&&(r.resource=r.resourceId);"event"in r?(null===(o=r.event)||void 0===o?void 0:o.id)!==i&&(r.eventId=r.event.id):"eventId"in r&&this.constructor.isProAssignmentModel&&(r.event=r.eventId);return super.set(r,null,...n)}afterChange(e,t,n,r,i){var s,o;const a=this;return!a.constructor.isProAssignmentModel&&null!=t&&t.resourceId&&(null===(s=a.resource)||void 0===s?void 0:s.id)!==t.resourceId.value?a.resource=t.resourceId.value:!(a.constructor.isProAssignmentModel&&null!==(o=a.project)&&void 0!==o&&o.propagatingSyncChanges&&null!=t&&t.eventId)||null!=t&&t.event||e.event.value!==t.eventId.value&&e.event.value.id!==t.eventId.value||(delete t.eventId,delete a.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(e){const{resource:t}=this;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return(null===(e=this.resource)||void 0===e?void 0:e.id)??this.get("resourceId")}set eventId(e){const{event:t}=this;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return(null===(e=this.event)||void 0===e?void 0:e.id)??this.get("eventId")}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var e;const{event:t,resource:n,unjoinedStores:r,assignmentStore:i}=this,s=null==i?void 0:i.crudManager;let o;return o=i?this.isValid&&t.isPersistable&&(s||!t.hasGeneratedId&&!n.hasGeneratedId):!this.isPhantom&&Boolean(r[0]),o&&super.isPersistable&&!(null!==(e=this.event)&&void 0!==e&&e.isCreating)}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("event"===e||"eventId"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}if("resource"===e||"resourceId"===e){var i;const e=null===(i=this.project)||void 0===i?void 0:i.resourceStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}};function Hb(e){return null!=e&&e.isModel?e.id:e}class Nb extends(Ty([Oy],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){const{assignmentStore:i,eventStore:s,resourceStore:o,project:a}=this;let l=!1;if("event"===e){const e=Ry(n,Mb)?n:null==s?void 0:s.$master.getById(n);e&&(l=!0),n=e||n}if("resource"===e){const e=Ry(n,Ly)?n:null==o?void 0:o.$master.getById(n);e&&(l=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!i||!l||a.isPerformingCommit||i.isLoadingData||null!=o&&o.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:e=this.event,resource:t=this.resource}=this.$changed;if(null!==e&&!Ry(e,Mb)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&this.setChanged("event",t,!1)}if(null!==t&&!Ry(t,Ly)){var r;const e=null===(r=this.resourceStore)||void 0===r?void 0:r.getById(t);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){const n=this.$changed;"resource"in n&&(n.resourceId=Hb(n.resource)),"event"in n&&(n.eventId=Hb(n.event)),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e),this.setChanged("eventId",Hb(e))}get event(){const e=this.get("event");return null!=(null==e?void 0:e.id)?e:null}set resource(e){this.setChanged("resource",e),this.setChanged("resourceId",Hb(e))}get resource(){const e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null}}}))){}const zb=Nb;class Wb extends(Vb(sy(zb.derive(ds)))){static get $name(){return"AssignmentModel"}}Wb.exposeProperties(),Wb._$name="AssignmentModel";var Ub=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...t){e=H.asArray(e);for(let t=0;t<e.length;t++){var n;let r=e[t];if(r instanceof ds||(e[t]=r=this.createRecord(r)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",r.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${r.eventId} to resource: ${r.resourceId}`);null!==(n=r.event)&&void 0!==n&&n.isCreating&&(r.isCreating=!0)}return super.add(e,...t)}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",`${e}-${t}`,!0)}setStoreData(e){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0},onDuplicate(e){console.warn(`Duplicate assignment of event ${e.eventId} to resource ${e.resourceId}`)}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||null==t||!t.isOccurrence)return e;const n=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return n.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const n=this,r=t.id||t,{id:i}=e;let{occurrenceMeta:s}=n;return s||(s=n.occurrenceMeta={}),s[i]||(s[i]={}),s[i][r]||(s[i][r]={})}mapAssignmentsForEvent(e,t,n){e=this.eventStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}mapAssignmentsForResource(e,t,n){e=this.resourceStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){var t;return null===(t=e=this.resourceStore.getById(e))||void 0===t?void 0:t.events}assignEventToResource(e,t,n=null,r=!1){var i;const s=this,o=r?new Set(e.assignments):null;if(t=H.asArray(t).map((e=>e.$original??e)),null!==(i=s.eventStore)&&void 0!==i&&i.usesSingleAssignment){var a,l;if(null!==(a=e.assignments)&&void 0!==a&&a.length)return s.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];e.resourceId=null===(l=t[0])||void 0===l?void 0:l.id}let c=[];return s.suspendAutoCommit(),t.forEach((t=>{const i=s.getAssignmentForEventAndResource(e,t);if(i)r&&o.delete(i);else{const r={event:e,resource:t};c.push((null==n?void 0:n(r))??r)}})),c=s.add(c),r&&s.remove(Array.from(o)),s.resumeAutoCommit(),c}unassignEventFromResource(e,t){const n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);t=H.asArray(t);for(let i=0;i<t.length;i++)n.isEventAssignedToResource(e,t[i])&&r.push(n.getAssignmentForEventAndResource(e,t[i]));return n.remove(r)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.$master.getById(t))?this.getOccurrence(n.find((e=>{var n;return(null===(n=e.resource)||void 0===n?void 0:n.$original)===t.$original})),e):null}};const Gb=e=>Number(e)!==e,Yb=e=>e instanceof Set||e instanceof Array?gy(e):gy([e]),qb=e=>new Promise((t=>setTimeout(t,e))),Kb=(e,...t)=>e.replace(/{(\d+)}/g,((e,n)=>void 0!==t[n]?t[n]:e));class Xb extends(Ty([Fy],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,n){this.assignmentsForRemoval=Yb(e).toSet();const r=t.remove.call(this,e,n);return this.assignmentsForRemoval.clear(),r}removeAll(e){this.allAssignmentsForRemoval=!0;const n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}}))){}const Zb=new Set;class Jb extends(Ty([Xb,jy],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Nb,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e,!0)||Zb}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original,!0)||Zb}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(e,t){e=e.masterStore||e;const n=this.count&&this.storage.findItem(t,null,!0);if(n){for(const r of n){const n=e.getById(r.getCurrentOrProposed(t));n&&r.setChanged(t,n)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var n;return t.setChanged(e,(null===(n=t[e])||void 0===n?void 0:n.id)??(null==t?void 0:t.getData(e))??t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const Qb=sy(Jb.derive(ho));class eC extends(Ub(Qb)){static $name="AssignmentStore";static get defaultConfig(){return{modelClass:Wb}}}eC._$name="AssignmentStore";const tC=["SS","SF","FS","FF"];class nC extends ds{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],n=e[this.fieldMap.to.dataSource];null!=t&&(e.fromEvent=t),null!=n&&(e.toEvent=n),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=Gt.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${Gt.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new us({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:n}=e,r=t[0];let i;if(r){const{fromEvent:t,toEvent:n}=e,s=r.crudManager;i=t&&(s||!t.hasGeneratedId)&&n&&(s||!n.hasGeneratedId)}else i=Boolean(n[0]);return i&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(null!=e&&e.isScheduled&&null!=t&&t.isScheduled){const n=nC.Type;let r,i;switch(this.type){case n.StartToStart:r=e.startDateMS,i=t.startDateMS;break;case n.StartToEnd:r=e.startDateMS,i=t.endDateMS;break;case n.EndToEnd:r=e.endDateMS,i=t.endDateMS;break;case n.EndToStart:r=e.endDateMS,i=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,i),end:Math.max(r,i)}}return null}highlight(e){var t;const n=(null===(t=this.highlighted)||void 0===t?void 0:t.split(" "))??[];n.includes(e)||(this.highlighted=n.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const n=t.split(" "),r=n.indexOf(e);r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=tC[this.type];return e?t:this.type===nC.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:n}=this;return"number"==typeof n&&e&&t&&e!==t}get fromEventName(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}get toEventName(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}}nC.exposeProperties(),nC._$name="DependencyBaseModel";class rC extends(Ty([Oy],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){var i;let s=!1;if("fromEvent"===e||"toEvent"===e){var o;const e=Ry(n,Mb)?n:null===(o=this.eventStore)||void 0===o?void 0:o.getById(n);e&&(s=!0),n=e||n}var a;(t.setChanged.call(this,e,n,r,!0),!s||this.project.isPerformingCommit||null!==(i=this.dependencyStore)&&void 0!==i&&i.isLoadingData)||(null===(a=this.dependencyStore)||void 0===a||a.invalidateIndices())}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:e,toEvent:t}=this.$changed;if(null!==e&&!Ry(e,Mb)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&(this.$changed.fromEvent=t)}if(null!==t&&!Ry(t,Mb)){var r;const e=null===(r=this.eventStore)||void 0===r?void 0:r.getById(t);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null}}}))){}const iC=rC;class sC extends(sy(iC.derive(nC))){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,n){const r=nC.Type,i=n?"right":"left",s=n?"left":"right";return e===i?t===i?r.StartToStart:r.StartToEnd:t===s?r.EndToEnd:r.EndToStart}}sC.exposeProperties(),sC._$name="DependencyModel";var oC=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,n,r=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=H.asArray(e)).reduce(((e,n)=>{n.children&&!r?n.traverse((n=>{e=i(n).reduce(t,e)})):e=i(n).reduce(t,e)}),n),n}mapEventDependencies(e,t,n,r,i){return this.reduceEventDependencies(e,((e,t)=>(n(t)&&e.push(t),e)),[],r,i)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=ds.asId(e),t=ds.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}async isValidDependency(e,t,n){let r=e,i=t;return null!=e&&(e.isDependencyModel&&({fromEvent:r,toEvent:i}=e),r=this.eventStore.getById(r),i=this.eventStore.getById(i),r&&i?!(!r.project||!i.project)&&this.project.isValidDependency(r,i,n):e!==t)}isValidDependencyToCreate(e,t,n){return this.isValidDependency(e,t,n)}getHighlightedDependencies(e){return this.records.reduce(((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};class aC extends(Ty([Fy],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,n){this.dependenciesForRemoval=Yb(e).toSet();const r=t.remove.call(this,e,n);return this.dependenciesForRemoval.clear(),r}removeAll(e){this.allDependenciesForRemoval=!0;const n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}}))){}const lC=new Set;class cC extends(Ty([aC,jy],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:rC,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||lC}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||lC}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const dC=sy(cC.derive(ho));class uC extends(oC(dC.derive(ho))){static get defaultConfig(){return{modelClass:sC}}}uC._$name="DependencyStore";var hC=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,t,n){const r=[],{storeId:i}=e,s=this.crudLoadValidationMandatoryStores,o={[i]:{}};return t?t.rows||(r.push(`- "${i}" store section should have a "rows" property with an array of the store records.`),o[i].rows=["..."]):null!=s&&s.includes(i)&&(r.push(`- No "${i}" store section found. It should contain the store data.`),o[i].rows=["..."]),r.length&&Object.assign(n,o),r}getLoadResponseWarnings(e){const t=[],n={};return this.skipSuccessProperty||(n.success=!0),this.forEachCrudStore(((r,i,s)=>{t.push(...this.getStoreLoadResponseWarnings(s,null==e?void 0:e[i],n))})),t.length&&(t.push("Please adjust your response to look like this:\n"+JSON.stringify(n,null,4).replace(/"\.\.\."/g,"...")),t.push(this.disableValidationNote)),t}validateLoadResponse(e){const t=this.getLoadResponseWarnings(e);t.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+t.join("\n"))}getStoreSyncResponseWarnings(e,t,n,r){const i=[],s=[],o=[],{storeId:a}=e,l={[a]:{}},c=e.phantomIdField||this.phantomIdField,{modelClass:d}=e.store,{idField:u}=d,h=(null==n?void 0:n.rows)||[],g=(null==n?void 0:n.removed)||[];let m=!1;if(null!=t&&t.added&&(s.push(...t.added.filter((e=>!h.find((t=>t[c]==e[c]))&&!g.find((t=>t[c]==e[c]||t[u]==e[c])))).map((e=>({[c]:e[c],[u]:"..."})))),s.length)){const e=s.map((e=>"#"+e[c])).join(", ");i.push(`- "${a}" store "rows" section should mention added record(s) ${e} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!s.length&&n&&(("object"!=typeof n||Array.isArray(n))&&(i.push(`- "${a}" store section should be an Object.`),l[a]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(i.push(`- "${a}" store "rows" section should be an array`),s.push("...")),n.removed&&!Array.isArray(n.removed)&&(i.push(`- "${a}" store "removed" section should be an array:`),o.push("...")));else{if(null!=t&&t.updated){const e=t.updated.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})));if(s.push(...e),e.length){const t=e.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "rows" section should mention updated record(s) ${t} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(s.length&&s.push("..."),null!=t&&t.removed&&(o.push(...t.removed.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})))),o.length)){const e=o.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "removed" section should mention removed record(s) ${e} sent in the request. It should contain the removed record identifiers.`),l[a].removed=o,o.push("..."),m=!0}}return s.length&&(l[a].rows=s),i.length||delete l[a],Object.assign(r,l),{messages:i,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(e,t){const n=[],r={},i=t.pack;this.skipSuccessProperty||(r.success=!0);let s=!1;return this.forEachCrudStore(((t,o,a)=>{const l=this.getStoreSyncResponseWarnings(a,null==i?void 0:i[o],e[o],r);s=s||l.showSupportShortSyncResponseNote,n.push(...l.messages)})),n.length&&(n.push("Please adjust your response to look like this:\n"+JSON.stringify(r,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),s&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(e,t){const n=this.getSyncResponseWarnings(e,t);n.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+n.join("\n"))}};class gC extends Error{}class mC extends gC{constructor(e={}){var t,n;super(e.message||e.request&&$.capitalize(null===(t=e.request)||void 0===t?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null===(n=this.request)||void 0===n?void 0:n.type}}const pC=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},fC=function(e,t){return pC(e,t,"loadPriority")},vC=function(e,t){return pC(e,t,"syncPriority")};var yC=e=>{e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Ge),e.isDelayable||t.push(mi),t.push(hC),class extends((e||ye).mixin(...t)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}static configurable={loadUrl:null,syncUrl:null,forceSync:null};static delayable={doAutoLoad:"raf"};get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var e,t;return null===(e=this.transport)||void 0===e||null===(t=e.load)||void 0===t?void 0:t.url}updateLoadUrl(e){Xt.setPath(this,"transport.load.url",e)}get syncUrl(){var e,t;return null===(e=this.transport)||void 0===e||null===(t=e.sync)||void 0===t?void 0:t.url}updateSyncUrl(e){Xt.setPath(this,"transport.sync.url",e)}getStoreDescriptor(e){return e?e instanceof ao?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(ao.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:n=this.storeIdProperty,modelClass:r}=t;return e.storeId||(e.storeId=t[n]||t.id),e.idField||(e.idField=r.idField),e.phantomIdField||(e.phantomIdField=r.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=r.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((n=>!1!==e.call(t,n.store,n.storeId,n)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let n;return e instanceof ao?n={store:e}:"object"==typeof e?(e.store||(e={storeId:e.id,store:new ao(e)}),n=e):n={store:ao.getStore(e)},t.fillStoreDescriptor(n),(e=n.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,(t.loadUrl||t.syncUrl)&&(e.autoCommit=!1,e.autoLoad=!1,(e.createUrl||e.updateUrl||e.deleteUrl||e.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),t.bindCrudStoreListeners(e),n}addCrudStore(e,t,n){var r;if(null===(r=e=H.asArray(e))||void 0===r||!r.length)return;const i=this,s=e.map(i.internalAddCrudStore,i);void 0===t?i.crudStores.push(...s):(n&&((n instanceof ao||"object"!=typeof n)&&(n=i.getStoreDescriptor(n)),t+=i.crudStores.indexOf(n)),i.crudStores.splice(t,0,...s)),i.orderedCrudStores.push(...s),i.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||t.addCrudStore(e,H.findInsertionIndex(e,t.crudStores,fC)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,H.findInsertionIndex(e,t.syncApplySequence,vC))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,n=t.crudStores,r=n.find((t=>t===e||t.store===e||t.storeId===e));if(!r)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(r.store),delete t.crudStoresIndex[r.storeId],H.remove(n,r),t.syncApplySequence&&t.removeStoreFromApplySequence(e)}bindCrudStoreListeners(e){e.ion({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,n){if(!e)return;e=H.asArray(e);const r=this,i=e.reduce(((e,t)=>{const n=r.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t)r.syncApplySequence.push(...i);else{let e=t;n&&((n instanceof ao||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.syncApplySequence.indexOf(n)),r.syncApplySequence.splice(e,0,...i)}const s=r.syncApplySequence.map((({storeId:e})=>e));r.orderedCrudStores=[...r.syncApplySequence],r.crudStores.forEach((e=>{s.includes(e.storeId)||r.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(e){const t=this;t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:()=>{e.sync().catch((e=>{}))},delay:e.autoSyncTimeout})}async triggerFailedRequestEvents(e,t,n,r){const{options:i,type:s}=e;this.trigger("requestFail",{requestType:s,response:t,responseText:n,responseOptions:r}),this.trigger(s+"Fail",{response:t,responseOptions:r,responseText:n,options:i})}async internalOnResponse(e,t,n){const r=this,i=t?r.decode(t):null,{options:s,type:o}=e;if(t&&!i&&console.error("Failed to parse response: "+t),i&&(r.skipSuccessProperty?!1!==i.success:i.success)){if(!1!==r.trigger("beforeResponseApply",{requestType:o,response:i})&&!1!==r.trigger(`before${$.capitalize(o)}Apply`,{response:i,options:s})){if(r.crudRevision=i.revision,await r.applyResponse(e,i,s),r.isDestroyed)return;r.trigger("requestDone",{requestType:o,response:i,responseOptions:n}),r.trigger(o,{response:i,responseOptions:n,options:s}),"load"!==o&&r.crudStoreHasChanges()||(r.trigger("noChanges"),"load"===o&&r.emitCrudStoreEvents(e.pack.stores,"afterRequest"))}}else r.triggerFailedRequestEvents(e,i,t,n);return i}suspendChangeTracking(){this.crudIgnoreUpdates++}resumeChangeTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isChangeTrackingSuspended(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((e=>this.isCrudStoreDirty(e.store)))}isCrudStoreDirty(e){return Boolean(e.changes)}doAutoLoad(){return this.load().catch((e=>{}))}emitCrudStoreEvents(e,t,n){const r={action:"read"+t,...n};for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((e=>{var t;const n=null==r?void 0:r[e.storeId],i=e.pageSize||(null===(t=e.store)||void 0===t?void 0:t.pageSize);if(n||i){const t=Object.assign({storeId:e.storeId,page:1},n);return i&&(t.pageSize=i),e.currentPage=t.page,n&&delete r[e.storeId],t}return e.storeId})),Object.assign(t,r),t}loadCrudStore(e,t,n){const r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r,!1,{clean:!0}):e.data=r,e.trigger("load",{data:r})}loadDataToCrudStore(e,t,n){const r=e.store,i=null==t?void 0:t.rows;r.__loading=!0,i&&this.loadCrudStore(r,t,n,e),r.__loading=!1}loadCrudManagerData(e,t={}){const n=this;n.trigger("beforeLoadCrudManagerData"),n.suspendChangeTracking(),n.crudStores.forEach((r=>{const i=r.storeId,s=e[i];s&&n.loadDataToCrudStore(r,s,t[i])})),n.resumeChangeTracking(!0),n.trigger("loadCrudManagerData")}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){"string"==typeof e&&(e={request:{url:e}});const t=this,n=t.getLoadPackage(e);return t._autoLoadPromise=null,new Promise(((r,i)=>{if(!1!==t.trigger("beforeLoad",{pack:n})){var s;const{load:o}=t.activeRequests;o&&(t.cancelRequest(o.desc,o.reject),t.trigger("loadCanceled",{pack:n}));const a=p.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null===(s=e)||void 0===s?void 0:s.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject(...e){a.success=a.failure=null,i(...e)},id:n.requestId,desc:t.sendRequest(a)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),i({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAddedRecordData(e,t){const n=this,{store:r}=t,{isTree:i}=r,s=t.phantomIdField||n.phantomIdField,o=t.phantomParentIdField||n.phantomParentIdField,a=r.modelClass.allFields.filter((e=>e.subStore)),l=e.constructor,c=Object.assign(e.persistableData,{[s]:e.id});if(i){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(c[o]=t.id)}return n.resetIdsBeforeSync&&Xt.deletePath(c,l.idField),a.forEach((t=>{const r=e.get(t.name);r.allCount&&(c[t.dataSource]={added:r.getRange().map((e=>n.prepareAddedRecordData(e,{store:r})))})})),c}prepareAdded(e,t){return e.filter((e=>e.isValid)).map((e=>this.prepareAddedRecordData(e,t)))}prepareUpdated(e,t){const{store:n}=t,{isTree:r}=n,i=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,s=t.phantomParentIdField||this.phantomParentIdField,o=n.modelClass.allFields.filter((e=>e.subStore));if(t.store.tree){const n=t.store.rootNode;e=e.filter((e=>e!==n))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let n;if(n=i?t.persistableData:t.modificationDataToWrite,r){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(n[s]=e.id)}return o.forEach((e=>{const r=t.get(e.name);n[e.dataSource]=this.getCrudStoreChanges({store:r})})),Xt.isEmpty(n)||e.push(n),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return Xt.setPath({},t.idField,e.id)}))}getCrudStoreChanges(e){const{store:t}=e;let n,{added:r=[],modified:i=[],removed:s=[]}=t.changes||{};return r.length&&(r=this.prepareAdded(r,e)),i.length&&(i=this.prepareUpdated(i,e)),s.length&&(s=this.prepareRemoved(s)),(r.length||i.length||s.length)&&(n={},r.length&&(n.added=r),i.length&&(n.updated=i),s.length&&(n.removed=s)),n}getChangesetPackage(){const{changes:e}=this;return e||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...e}:null}get changes(){const e={};return this.crudStores.forEach((t=>{const n=this.getCrudStoreChanges(t);n&&(e[t.storeId]=n)})),Object.keys(e).length>0?e:null}getRowsToApplyChangesTo({store:e,storeId:t},n,r){var i,s;const o=this,{modelClass:a}=e,l=a.idField,{updated:c,removed:d}=r||{};let u,h,g;if(n){var m,p;g=!0;const e={};u=(null===(m=n.rows)||void 0===m?void 0:m.slice())||[],h=(null===(p=n.removed)||void 0===p?void 0:p.slice())||[],[...u,...h].forEach((t=>{const n=Xt.getPath(t,l);e[n]=!0})),o.supportShortSyncResponse&&(null==c||c.forEach((t=>{const n=Xt.getPath(t,l);e[n]||u.push({[l]:n})})),null==d||d.forEach((t=>{const n=Xt.getPath(t,l);e[n]||h.push({[l]:n})})))}else(c||d)&&(g=!1,u=c,h=d);return u=null!==(i=u)&&void 0!==i&&i.length?u:null,h=null!==(s=h)&&void 0!==s&&s.length?h:null,{rows:u,removed:h,remote:g}}applyChangesToStore(e,t,n){const r=this,i=e.phantomIdField||r.phantomIdField,{store:s}=e,o=s.modelClass.getFieldDataSource("id"),a=s.modelClass.allFields.filter((e=>e.subStore)),{rows:l,removed:c,remote:d}=r.getRowsToApplyChangesTo(e,t,n),u=[],h=[];if(l)for(const e of l)s.getById(e[i]??e[o])?h.push(e):u.push(e);const g=[];h.length&&a.length&&h.forEach((e=>{var t,l;const c=s.getById(e[i]??e[o]),d=(null===(t=n.added)||void 0===t?void 0:t.find((t=>t[i]==e[i])))||(null===(l=n.updated)||void 0===l?void 0:l.find((t=>t[o]==e[o]))),u={};a.forEach((t=>{const n=c.get(t.name);r.applyChangesToStore({store:n},e[t.dataSource],null==d?void 0:d[t.dataSource]),u[t.dataSource]="foo",delete e[t.dataSource]})),g.push([c,u])}));const m=s.applyChangeset({removed:c,added:u,updated:h},null,i,d,!0);return g.forEach((([e,t])=>Object.assign(m.get(e.id),t))),m}applySyncResponse(e,t){const n=this,r=n.orderedCrudStores;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangeTracking();for(const s of r){var i;n.applyChangesToStore(s,e[s.storeId],null==t||null===(i=t.pack)||void 0===i?void 0:i[s.storeId])}n.resumeChangeTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){const r=this;switch(r.trackResponseType&&t.type||e.type){case"load":r.validateResponse&&r.validateLoadResponse(t),r.applyLoadResponse(t,n);break;case"sync":r.validateResponse&&r.validateSyncResponse(t,e),r.applySyncResponse(t,e)}}applyChangeset(e,t=null,n,r=!1){const s=this,o=r?new Map:i;s.suspendAutoSync(),s.suspendChangeTracking();for(const{store:n,phantomIdField:i}of s.orderedCrudStores)if(e[n.id]){const a=n.applyChangeset(e[n.id],t,i||s.phantomIdField,!0,r);a&&o.set(n.id,a)}return s.resumeChangeTracking(!0),s.resumeAutoSync(!1),o}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.clearTimeout("autoSync"),e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,n)=>{const r=e.getChangesetPackage();r?!1!==e.trigger("beforeSync",{pack:r})?(e.trigger("syncStart",{pack:r}),e.activeRequests.sync={type:"sync",pack:r,resolve:t,reject:n,id:r.requestId,desc:e.sendRequest({id:r.requestId,data:e.encode(r),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:r}),n({cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,n){var r;const i=this,{type:s,id:o}=n;if(i.isDestroyed)return;let a="";n=i.activeRequests[s];try{a=await e.text()}catch(e){}if(i.isDestroyed)return;if((null===(r=n)||void 0===r?void 0:r.id)!==o)throw new Error(`Interleaved ${s} operation detected`);i.activeRequests[s]=null;const l=await i.internalOnResponse(n,a,t);if(!i.isDestroyed){if(!l||(i.skipSuccessProperty?!1===(null==l?void 0:l.success):null==l||!l.success)){const t={rawResponse:e,response:l,request:n};null!=l&&l.message&&(t.message=l.message),n.reject(new mC(t))}i["crud"+$.capitalize(n.type)+"ed"]=!0,n.resolve({response:l,rawResponse:e,responseText:a,request:n})}}async onCrudRequestFailure(e,t,n){var r;const i=this;if(i.isDestroyed)return;n=i.activeRequests[n.type];const s=null==t||null===(r=t.abortController)||void 0===r?void 0:r.signal;if(!Boolean(null==s?void 0:s.aborted)){let r,s="";try{s=await e.text(),r=i.decode(s)}catch(e){}if(i.isDestroyed)return;if(i.triggerFailedRequestEvents(n,r,s,t),i.isDestroyed)return;n.reject(new mC({rawResponse:e,request:n}))}i.activeRequests[n.type]=null}acceptChanges(){this.crudStores.forEach((e=>e.store.acceptChanges()))}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:e}=this.eventStore;this.orderedCrudStores.forEach((({store:t})=>(!t.isAssignmentStore||!e)&&t.revertChanges()))}doDestroy(){const e=this,{load:t,sync:n}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),n&&e.cancelRequest(n.desc,n.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}}},bC=e=>class t extends(e||ye){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),this.isDestroying||t({cancelled:!0})}shouldUseBodyForRequestData(e,t,n){return!("HEAD"===t||"GET"===t||n)}sendRequest(e){const n=this,{data:r}=e,i=n.transport[e.type]||{},s=p.assign({},i,i.requestConfig);e.url&&(s.url=e.url),s.method=s.method||t.defaultMethod[e.type],s.params=p.assign(s.params||{},e.params);let o,a,{paramName:l}=s;if(n.shouldUseBodyForRequestData(i,s.method,l)?(s.body=r,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(l=l||"data",s.params[l]=r),!s.url)throw new Error("Trying to request without URL specified");function c(){s.queryParams=s.params,delete s.params;let t=!1;const r=p.assign({},s,s.fetchOptions);return o=Se.fetch(s.url,r),o.catch((e=>{var i,s;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:!1});const a=null===(s=r.abortController)||void 0===s?void 0:s.signal;return a&&(t=a.aborted,t||console.warn(e)),{error:e,cancelled:t}})).then((t=>{var i;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:Boolean(null==t?void 0:t.ok)});const s=null!=t&&t.ok?e.success:e.failure;return null==s?void 0:s.call(e.thisObj||n,t,r,e)}))}delete s.requestConfig,delete s.paramName;const d=n.trigger("beforeSend",{params:s.params,requestType:e.type,requestConfig:s,config:e});return a=p.isPromise(d)?d.then(c):c(),a.abort=()=>{var e,t;o.done||(null===(e=(t=o).abort)||void 0===e||e.call(t))},a}},CC=e=>class extends(e||ye){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),$.safeJsonStringify(e)}decode(e){return $.safeJsonParse(e)}},SC=e=>class extends((e||ye).mixin(yC,bC,CC)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const t=this,{project:n}=t;t.applyingProjectResponse=!0;const r=n.fieldMap.startDate,i=n.fieldMap.endDate,s=Xt.getPath(e,r.dataSource),o=Xt.getPath(e,i.dataSource);"string"==typeof s&&Xt.setPath(e,r.dataSource,r.convert(s)),"string"==typeof o&&Xt.setPath(e,i.dataSource,i.convert(o)),n.setByDataSource(e),t._changesToClear.set(t,e),t.applyingProjectResponse=!1}loadCrudManagerData(e,t={}){const n=this,{project:r}=n;n.suspendChangeTracking(),super.loadCrudManagerData(...arguments),null!=e&&e.project&&(r.delayEnteringReplica&&r.hasDataInStores?r.ion({recordsUnlinked:()=>{n.suspendChangeTracking(),n.applyProjectResponse(e.project),n.resumeChangeTracking()},once:!0}):n.applyProjectResponse(e.project)),n.resumeChangeTracking()}async sync(){const{project:e}=this;if(this.suspendAutoSync(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,n){var r,i,s;const o=this;if(!(o.isDestroyed||null!==(r=o.project)&&void 0!==r&&r.isDestroyed)){var a;if(o.trigger("beforeApplyResponse"),await super.applyResponse(e,t,n),null!=t&&t.project||o.supportShortSyncResponse&&null!=e&&null!==(i=e.pack)&&void 0!==i&&i.project)o.applyProjectResponse(t.project||(null==e||null===(a=e.pack)||void 0===a?void 0:a.project));if(o.project){var l,c;let n=e.type;o.trackResponseType&&(n=t.type||n);const r=`propagating${$.capitalize(n)}Changes`;o.suspendAutoSync(),o[r]=!0;const i=o.project.isInitialCommit&&!o.project.silenceInitialCommit;await o.project.commitAsync(),o[r]=!1,null===(l=o.resumeAutoSync)||void 0===l||l.call(o,i),null===(c=o.commitRespondedChanges)||void 0===c||c.call(o)}null===(s=o.trigger)||void 0===s||s.call(o,"applyResponse")}}applySyncResponse(...e){var t;const n=this,r=null===(t=n.project)||void 0===t?void 0:t.stm.disabled;!1===r&&n.ignoreRemoteChangesInSTM&&n.project.stm.disable(),super.applySyncResponse(...e),!1===r&&n.project.stm.enable()}shouldClearRecordFieldChange(e,t,n){var r;const i=e.getValue(t);return null!==(r=t=e.getFieldDefinition(t))&&void 0!==r&&r.isEqual?t.isEqual(i,n):Xt.isEqual(i,n)}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,n])=>{this.shouldClearRecordFieldChange(t,e,n)&&delete t.meta.modified[e]}))})),this._changesToClear.clear()}applyChangesToStore(e,t,n,...r){const i=super.applyChangesToStore(e,t,n,...r);if(i.size&&this.project)for(const[t,n]of i){const r=e.store.getById(t);r&&this._changesToClear.set(r,n)}return i}};class DC extends(ye.mixin(yC)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return $.safeJsonStringify(this)}set json(e){"string"==typeof e&&(e=$.safeJsonParse(e)),this.forEachCrudStore((t=>{const n=`${t.storeId}Data`;e[n]&&(t.data=e[n])}))}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore(((t,n)=>e[`${n}Data`]=t.toJSON())),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}DC._$name="AbstractCrudManager";var wC=e=>class extends(e||ds){static $name="ProjectModelCommon";static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}static get autoExposeFields(){return!1}get assignments(){return this.assignmentStore.allRecords}updateAssignments(e){this.assignmentStore.data=e}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(e){this.dependencyStore.data=e}get resources(){return this.resourceStore.allRecords}updateResources(e){this.resourceStore.data=e}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(e,t){const n=this.timeRangeStore,r=[];for(const i of n)i.isRecurring?r.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&e<i.endDate&&r.push(i);return r}updateTimeRanges(e){this.timeRangeStore.data=e}getResourceTimeRanges(e,t){const n=this.resourceTimeRangeStore,r=[];for(const i of n)i.isRecurring?r.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&(!i.endDate||e<i.endDate)&&r.push(i);return r}};class EC extends(Iv.mixin(Rb)){static $name="ResourceTimeRangeModel";static fields=["resourceId","timeRangeColor"];static relations={resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}};static domIdPrefix="resourcetimerange";get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}EC._$name="ResourceTimeRangeModel";class xC extends(ho.mixin(nb)){static $name="ResourceTimeRangeStore";static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:EC,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:n}){return e.timeRanges.flatMap((e=>e.supportsRecurring?e.getOccurrencesForDateRange(t,n):e.intersectsRange(t,n)?e:[])).sort(((e,t)=>e.startDate-t.startDate))}}xC._$name="ResourceTimeRangeStore";class RC extends fi{static $name="storeTimeZonePlugin";static pluginConfig={before:["processRecord"],assign:["beforeSyncRecord","afterSyncRecord"]};get timeZone(){return this.client.project.timeZone}processRecord(e,t){(t||this.client.isLoadingData||e.timeZone!==i)&&this.convertRecordToTimeZone(e)}convertRecordToTimeZone(e,t=this.timeZone){if(e.timeZone!==t){var n,r;if(e.$ignoreChange=!0,null!==(n=e.baselines)&&void 0!==n&&n.count)for(const n of e.baselines)e.timeZone!==n.timeZone&&(n.timeZone=e.timeZone),n.convertToTimeZone(t);if(null!==(r=e.occurrences)&&void 0!==r&&r.length)for(const n of e.occurrences)e.timeZone!==n.timeZone&&(n.timeZone=e.timeZone),n.convertToTimeZone(t);e.convertToTimeZone(t),e.$ignoreChange=!1}}beforeSyncRecord({record:e}){null!=e.timeZone&&(e.$restoreTimeZone=e.timeZone,e.convertToTimeZone())}afterSyncRecord({record:e}){e.$restoreTimeZone&&(e.convertToTimeZone(e.$restoreTimeZone),e.$restoreTimeZone=null)}}RC._$name="StoreTimeZonePlugin";var TC=e=>class extends(e||ds){static $name="ProjectModelTimeZoneMixin";static configurable={timeZone:{$config:"lazy",value:null}};get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter((e=>e))}plugStore(e){e.hasPlugin(RC)||e.addPlugins(RC)}unplugStore(e){var t;null===(t=e.plugins.storeTimeZonePlugin)||void 0===t||t.destroy()}attachStore(e){super.attachStore(e),e&&null!=this.timeZone&&this._storesWithDates.includes(e)&&(this.plugStore(e),this.convertStoresToTimeZone([e]))}detachStore(e){super.detachStore(e),e&&!e.isDestroyed&&null!=this.timeZone&&(this.convertStoresToTimeZone([e],null),this.unplugStore(e))}relayStoreChange({source:e,action:t,records:n,replaced:r}){const i=this;var s;null!=i.timeZone&&i._storesWithDates.includes(e)&&(["add","replace"].includes(t)&&(null!==(s=n)&&void 0!==s&&s.length||null==r||!r.length||(n=r),n.length&&n.forEach((e=>e.timeZone=i.timeZone))))}convertStoresToTimeZone(e,t=this.timeZone){var n;const r=this,i=null===(n=r.stm)||void 0===n?void 0:n.autoRecord;i&&(r.stm.autoRecord=!1);for(const n of e)null==n||n.forEach((e=>n.plugins.storeTimeZonePlugin.convertRecordToTimeZone(e,t)));i&&(r.stmAutoRecord=i)}updateTimeZone(e,t){const n=this,r=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),n.calendarManagerStore.forEach((e=>e.bumpVersion())),n._storesWithDates.forEach((e=>n.plugStore(e))),n.convertStoresToTimeZone(n._storesWithDates),n.startDate){const r=null!=t?ig.fromTimeZone(n.startDate,t):n.startDate;n.startDate=null!=e?ig.toTimeZone(r,e):r}n.ignoreRecordChanges=!0,n.commitAsync().then((()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),delete n._isConfiguringTimeZone}))}};class MC extends(Iv.mixin(Rb)){static $name="TimeRangeModel";afterConstruct(){this.endDate||(this.endDate=this.startDate),super.afterConstruct()}}MC._$name="TimeRangeModel";class kC extends(ho.mixin(nb)){static $name="TimeRangeStore";static defaultConfig={loadPriority:500,syncPriority:500,modelClass:MC,storeId:"timeRanges"}}kC._$name="TimeRangeStore";var IC=e=>class extends((e||ds).mixin(wC,TC)){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:MC,resourceTimeRangeModelClass:EC,timeRangeStoreClass:kC,resourceTimeRangeStoreClass:xC,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null,resourceTimeRangesData:null}}static configurable={json:null,timeRangeStore:{value:{},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null};get inlineData(){return $.safeJsonParse(super.json)}set inlineData(e){this.json=e}construct(e={}){super.construct(...arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}attachStore(e){e&&e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&(this.detachListeners(e.$$name),super.detachStore(e))}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}updateTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}setTimeRangeStore(e){this.timeRangeStore=e}changeTimeRangeStore(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}updateResourceTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}changeResourceTimeRangeStore(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}setResourceTimeRangeStore(e){this.resourceTimeRangeStore=e}get events(){return this.eventStore.allRecords}updateEvents(e){this.eventStore.data=e}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(e){this.resourceTimeRangeStore.data=e}async loadInlineData(e){return this.isLoadingInlineData=!0,e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),super.loadInlineData(e)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON(),timeRangesData:e.timeRangeStore.toJSON(),resourceTimeRangesData:e.resourceTimeRangeStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}changeJson(e){return"string"==typeof e&&(e=$.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},AC=e=>class extends e{getCurrentConfig(e){const t=this,n=super.getCurrentConfig(e);if(n){for(const r of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=t[r];if(i){i.count&&(n[i.id+"Data"]=i.getInlineData(e));const t=i.getCurrentConfig(e);t&&Object.keys(t).length>0?n[r]=Object.assign(n[r]||{},t):n[r]&&0===Object.keys(n[r]).length&&delete n[r]}}return t.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}};class FC extends ye{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let n,r;for(r=t.length-1;r>=0;--r)n=t[r],n.isPersistable||t.splice(t.indexOf(n),1);0===t.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}FC._$name="ModelPersistencyManager";const PC=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+t,e.getMilliseconds()),OC=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,i=0!==n[0],s=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&i&&n[1]>e))break;s=o}return t[s]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],s=n[1],o=t.length,a=0===t[o-1]&&0!==r?s:0,l=e,c=t.indexOf(e),d=l;l===(t[c]||a);)if(++l>s&&(l=r),++c===o&&(c=0),l===d)return i;return l},e.array.prev=function(e,t,n){for(var r,i=t.length,s=0!==n[0],o=i-1,a=0;a<i;a++){if((r=t[a])===e)return r;if(!(r<e||0===r&&s&&n[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],s=n[1],o=t.length,a=0===t[o-1]&&0!==r?s:0,l=e,c=t.indexOf(e),d=l;l===(t[c]||a);)if(--l<r&&(l=s),-1===--c&&(c=o-1),l===d)return i;return l},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>i?i:n||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),i=e.dc.extent(r)[1];return n=n>i?i:n||i,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?i:n||i,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),i=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?i:n||i,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),i=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.start(i);return n=n>s?1:n||s,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.end(i);return n=n>s?s:n||s,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],s=0;for(var o in t){var a=o.split("_"),l=a[0],c=a[1],d=t[o],u=c?e.modifier[c](e[l],d):e[l];r.push({constraint:u,vals:d}),s++}return r.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),n=r[s-1].constraint,{start:function(t,i){for(var o,a=i,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<s;d++){var u=r[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,r[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?n.start(a):n.end(a)),a},end:function(t,n){for(var o,a=e.array[t+"Invalid"],l=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),c=s-1;c>=0;c--){var d,u=r[c].constraint,h=u.val(n),g=u.extent(n),m=a(h,r[c].vals,g);m!==i&&(!(d=u[t](n,m))||o&&!l(o,d)||(o=d))}return o},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickSafe:function(e,t){return"next"===e?PC(n.end(t),1):PC(n.start(t),-1)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,s=[],o=t.exceptions?t.exceptions.length:0,a=0;a<r;a++)n.push(e.compile(t.schedules[a]));for(var l=0;l<o;l++)s.push(e.compile(t.exceptions[l]));function c(t,r,a,l,c){var C,S,D,w=y(t),E=r,x=1e6,R=[],T=[],M=[],k="next"===t,I=k?0:1,A=k?1:0;if(!(a=a?new Date(a):new Date)||!a.getTime())throw new Error("Invalid start date.");for(!function(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]=t[i].start(e,r)}(t,n,R,a),function(t,n,r,i){for(var s=0,o=n.length;s<o;s++){var a=n[s].start(t,i);r[s]=a?[a,n[s].end(t,a)]:e.NEVER}}(t,s,T,a);x--&&E&&(C=b(R,w))&&(!l||!w(C,l));)if(o&&(h(t,s,T,C),S=p(t,T,C)))u(t,n,R,S);else{if(c){var F=f(T,w);S=v(t,n,R,C,F);var P=k?[new Date(Math.max(a,C)),S?new Date(l?Math.min(S,l):S):i]:[S?new Date(l?Math.max(l,S.getTime()+e.SEC):S.getTime()+e.SEC):i,new Date(Math.min(a,C.getTime()+e.SEC))];if(D&&P[I].getTime()===D[A].getTime()?(D[A]=P[A],E++):(D=P,M.push(D)),!S)break;u(t,n,R,S)}else M.push(k?new Date(Math.max(a,C)):m(n,R,C,l)),g(t,n,R,C);E--}for(var O=0,L=M.length;O<L;O++){var $=M[O];M[O]="[object Array]"===Object.prototype.toString.call($)?[d($[0]),d($[1])]:d($)}return 0===M.length?e.NEVER:1===r?M[0]:M}function d(e){return e instanceof Date&&!isNaN(e.valueOf())?new Date(e):i}function u(e,t,n,r){for(var i=y(e),s=0,o=t.length;s<o;s++)n[s]&&!i(n[s],r)&&(n[s]=t[s].start(e,r))}function h(t,n,r,i){for(var s=y(t),o=0,a=n.length;o<a;o++)if(r[o]&&!s(r[o][0],i)){var l=n[o].start(t,i);r[o]=l?[l,n[o].end(t,l)]:e.NEVER}}function g(t,n,r,i){for(var s=0,o=n.length;s<o;s++)if(r[s]&&r[s].getTime()===i.getTime()){const o=n[s].start(t,n[s].tick(t,i));o!==e.NEVER&&o.getTime()===r[s].getTime()?r[s]=n[s].start(t,n[s].tickSafe(t,i)):r[s]=o}}function m(e,t,n,r){for(var i,s=0,o=t.length;s<o;s++)if(t[s]&&t[s].getTime()===n.getTime()){var a=e[s].tickStart(n);if(r&&a<r)return r;(!i||a>i)&&(i=a)}return i}function p(e,t,n){for(var r,i=y(e),s=0,o=t.length;s<o;s++){var a=t[s];!a||i(a[0],n)||a[1]&&!i(a[1],n)||r&&!i(a[1],r)||(r=a[1])}return r}function f(e,t){for(var n,r=0,i=e.length;r<i;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function v(e,t,n,r,i){for(var s,o=y(e),a=0,l=t.length;a<l;a++){var c=n[a];if(c&&c.getTime()===r.getTime()){var d=t[a].end(e,c);if(i&&(!d||o(d,i)))return i;s&&!o(d,s)||(s=d)}}return s}function y(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function b(e,t){for(var n=e[0],r=1,i=e.length;r<i;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return c("next",1,t,t)!==e.NEVER},next:function(e,t,n){return c("next",e||1,t,n)},prev:function(e,t,n){return c("prev",e||1,t,n)},nextRange:function(e,t,n){return c("next",e||1,t,n,!0)},prevRange:function(e,t,n){return c("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,s=e.schedule(n);return t&&function e(){var n=Date.now(),o=s.next(2,n);if(!o[0])return void(r=i);var a=o[0].getTime()-n;a<1e3&&(a=o[1]?o[1].getTime()-n:1e3);r=a<2147483647?setTimeout(t,a):setTimeout(e,2147483647)}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function s(){i||(t(),r=e.setTimeout(s,n))}),n),i=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){i=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,i,s){return new Date(e,t,n,r,i,s)}:function(e,t,n,r,i,s){return new Date(Date.UTC(e,t,n,r,i,s))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,s,o,a){return e.date.build(t,n!==i?n-1:0,r!==i?r:1,s||0,o||0,a||0)},e.date.nextRollover=function(t,n,r,i){var s=r.val(t),o=r.extent(t)[1];return(n||o)<=s||n>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,n,r,i,s,o){var a=arguments.length;return n=a<2?11:n-1,r=a<3?e.D.extent(e.date.next(t,n+1))[1]:r,i=a<4?23:i,s=a<5?59:s,o=a<6?59:o,e.date.build(t,n,r,i,s,o)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,i){var s=n;for(e[t]||(e[t]=[]);s<=r;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function l(e,t,r,i,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(d=s(e,c,l))?o(g,r,d,d):null!==(d=s(e.replace("W",""),c,l))?function(e,t,r){var i={},s={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(i,"D",2,2),o(i,"d",n.TUE,n.FRI),o(s,"D",3,3),o(s,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(i,"D",r-1,r-1),o(i,"d",n.MON,n.THU),o(s,"D",r+1,r+1),o(s,"d",n.TUE,n.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,d):null!==(d=s(e.replace("L",""),c,l))?a(h,g,d,i-1):2===(u=e.split("#")).length?a(h,g,d=s(u[0],c,l),s(u[1])):function(e,t,n,r,i,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");r=s(u[0],a,i),i=s(u[1],a,i)||i}o(t,n,r,i,c)}(e,g,r,i,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,s,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((r=a[(n=i[t])[0]])&&"*"!==r&&"?"!==r){var c,u=(s=r.split(",").sort(d)).length;for(c=0;c<u;c++)l(s[c],o,t,n[1],n[2],n[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,n,r,i,s,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],i){for(r=[],l=d;l<=u;l+=i)r.push(l);c={n:e,x:i,c:n.length,m:u}}var g=(r=o?[d]:a?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=i=s=o=a=0}return{schedules:d,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",r=[e],this},before:function(e){return s="b",r=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){if(!e.modifier[t])throw new Error("Custom modifier "+t+" not recognized!");return s=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,n){return t[c.n]=t[c.n].splice(0,c.c),i=c.x,g(c.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,s=0,o="",a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},l={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function c(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function d(e){var t,n,r,i,a,l,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=s;!t||t.type===u;){l=-1,n=o.substring(a),t=c(a,a,o.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(r=(i=d[h]).exec(n))&&0===r.index&&r[0].length>l&&(t=c(a,a+(l=r[0].length),n.substring(0,l),i));t.type===u&&(a=t.endPos)}return t}function u(e){var t=d(e);return s=t.endPos,t}function h(e){for(var t=+b(e),n=v(a.through)?+b(e):t,r=[],i=t;i<=n;i++)r.push(i);return r}function g(e){for(var t=h(e);v(a.and);)t.push.apply(t,h(e));return e===a.dayName&&t.sort(((e,t)=>e-t)),t}function m(e){var t,n,r,i;v(a.weekend)?e.on(l.sun,l.sat).dayOfWeek():v(a.weekday)?e.on(l.mon,l.tue,l.wed,l.thu,l.fri).dayOfWeek():(t=b(a.rank),e.every(t),n=f(e),v(a.start)?(t=b(a.rank),e.startingOn(t),y(n.type)):v(a.between)&&(r=b(a.rank),v(a.and)&&(i=b(a.rank),e.between(r,i))))}function p(e){v(a.first)?e.first():v(a.last)?e.last():e.on(g(a.rank)),f(e)}function f(e){var t=y([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(t.type){case a.second:e.second();break;case a.minute:e.minute();break;case a.hour:e.hour();break;case a.dayOfYear:e.dayOfYear();break;case a.dayOfWeek:e.dayOfWeek();break;case a.dayInstance:e.dayOfWeekCount();break;case a.day:e.dayOfMonth();break;case a.weekOfMonth:e.weekOfMonth();break;case a.weekOfYear:e.weekOfYear();break;case a.month:e.month();break;case a.year:e.year();break;default:n=s}return t}function v(e){var t=d(e).type===e;return t&&u(e),t}function y(e){var t=u(e);return t.type?t.text=function(e,t){var n=e;switch(t){case a.time:var r=e.split(/(:|am|pm)/),i="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],s=r[2].trim();n=(1===i.length?"0":"")+i+":"+s;break;case a.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case a.monthName:case a.dayName:n=l[e.substring(0,3)];break;case a.fullDate:n=new Date(e.toUpperCase())}return n}(t.text,e):n=s,t}function b(e){return y(e).text}return function(e){s=0,o=e,n=-1;for(var t=r();s<o.length&&n<0;){switch(y([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]).type){case a.every:m(t);break;case a.after:d(a.time).type!==i?(t.after(b(a.time)),t.time()):d(a.fullDate).type!==i?(t.after(b(a.fullDate)),t.fullDate()):(t.after(b(a.rank)),f(t));break;case a.before:d(a.time).type!==i?(t.before(b(a.time)),t.time()):d(a.fullDate).type!==i?(t.before(b(a.fullDate)),t.fullDate()):(t.before(b(a.rank)),f(t));break;case a.onthe:p(t);break;case a.on:t.on(g(a.dayName)).dayOfWeek();break;case a.of:t.on(g(a.monthName)).month();break;case a.in:t.on(g(a.yearIndex)).year();break;case a.at:for(t.on(b(a.time)).time();v(a.and);)t.on(b(a.time)).time();break;case a.and:break;case a.also:t.and();break;case a.except:t.except();break;default:n=s}}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();OC.date.localTime();class LC extends(Ty([Py],(e=>{e.prototype;return class extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){let t=e;if(e&&e!==Object(e)&&(t=OC.parse.text(e),t!==Object(t)||t.error>=0))try{t=JSON.parse(e)}catch(e){return null}return t}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=OC.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if("EOD"===this.recurrentEndDate)return"EOD";const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=OC.schedule(e)}}}))){}class $C extends(Ty([Fy],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:LC}}}}))){}var _C,jC,BC,VC,HC,NC,zC,WC,UC;e.TimeUnit=void 0,(_C=e.TimeUnit||(e.TimeUnit={})).Millisecond="millisecond",_C.Second="second",_C.Minute="minute",_C.Hour="hour",_C.Day="day",_C.Week="week",_C.Month="month",_C.Quarter="quarter",_C.Year="year",e.ProjectConstraintResolution=void 0,(jC=e.ProjectConstraintResolution||(e.ProjectConstraintResolution={})).Honor="honor",jC.Ignore="ignore",jC.Conflict="conflict",e.ConstraintType=void 0,(BC=e.ConstraintType||(e.ConstraintType={})).MustStartOn="muststarton",BC.MustFinishOn="mustfinishon",BC.StartNoEarlierThan="startnoearlierthan",BC.StartNoLaterThan="startnolaterthan",BC.FinishNoEarlierThan="finishnoearlierthan",BC.FinishNoLaterThan="finishnolaterthan",BC.AsSoonAsPossible="assoonaspossible",BC.AsLateAsPossible="aslateaspossible",e.SchedulingMode=void 0,(VC=e.SchedulingMode||(e.SchedulingMode={})).Normal="Normal",VC.FixedDuration="FixedDuration",VC.FixedEffort="FixedEffort",VC.FixedUnits="FixedUnits",e.DependencyValidationResult=void 0,(HC=e.DependencyValidationResult||(e.DependencyValidationResult={}))[HC.NoError=0]="NoError",HC[HC.CyclicDependency=1]="CyclicDependency",HC[HC.DuplicatingDependency=2]="DuplicatingDependency",e.DependencyType=void 0,(NC=e.DependencyType||(e.DependencyType={}))[NC.StartToStart=0]="StartToStart",NC[NC.StartToEnd=1]="StartToEnd",NC[NC.EndToStart=2]="EndToStart",NC[NC.EndToEnd=3]="EndToEnd",e.DependenciesCalendar=void 0,(zC=e.DependenciesCalendar||(e.DependenciesCalendar={})).Project="Project",zC.FromEvent="FromEvent",zC.ToEvent="ToEvent",e.ProjectType=void 0,(WC=e.ProjectType||(e.ProjectType={}))[WC.SchedulerBasic=1]="SchedulerBasic",WC[WC.SchedulerPro=2]="SchedulerPro",WC[WC.Gantt=3]="Gantt",e.Direction=void 0,(UC=e.Direction||(e.Direction={})).Forward="Forward",UC.Backward="Backward",UC.None="None";const GC=(e,t)=>!(e&&!t||!e&&t)&&(!e&&!t||e.direction===t.direction&&("own"===e.kind&&"own"===t.kind||"enforced"===e.kind&&"enforced"===t.kind&&e.enforcedBy===t.enforcedBy||"inherited"===e.kind&&"inherited"===t.kind&&e.inheritedFrom===t.inheritedFrom));var YC;e.ConstraintIntervalSide=void 0,(YC=e.ConstraintIntervalSide||(e.ConstraintIntervalSide={})).Start="Start",YC.End="End";const qC=new Date(-864e13),KC=new Date(864e13),XC=e=>{if(!e)return!1;const t=e.getTime();return t!==qC.getTime()&&t!==KC.getTime()};var ZC,JC;e.EdgeInclusion=void 0,(ZC=e.EdgeInclusion||(e.EdgeInclusion={}))[ZC.Left=0]="Left",ZC[ZC.Right=1]="Right",e.CalendarIteratorResult=void 0,(JC=e.CalendarIteratorResult||(e.CalendarIteratorResult={}))[JC.FullRangeIterated=0]="FullRangeIterated",JC[JC.StoppedByIterator=1]="StoppedByIterator",JC[JC.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",JC[JC.MaxRangeReached=3]="MaxRangeReached";class QC{constructor(t){this.cacheFilledStartDate=KC,this.cacheFilledEndDate=qC,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=e.TimeUnit.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,t&&Object.assign(this,t)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==KC.getTime()){const i=e.getTime(),s=t.getTime();if(n<=i&&s<=r)return;if(s<=n)t=new Date(n-1);else if(i>=r)e=new Date(r);else if(n<=i&&i<=r)e=new Date(r+1);else{if(!(n<=s&&s<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===KC.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===qC.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=KC,this.cacheFilledEndDate=qC,this.intervalCache.clear()}forEachAvailabilityInterval(t,n,r){r=r||this;const i=t.startDate,s=t.endDate,o=i&&i.getTime(),a=s&&s.getTime(),l=t.maxRange??this.maxRange,c=!1!==t.isForward;if(c?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?i:s,h=c?i:s;const g=h.getTime();for(let t=1;t<this.maxCacheExtendCycles;t++){c?this.ensureCacheFilledForInterval(u,s||Gt.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||Gt.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let t=d.getIntervalOf(h,c?e.EdgeInclusion.Left:e.EdgeInclusion.Right);for(;t;){const u=t.startDate,m=t.endDate;if(c&&a&&u.getTime()>=a||!c&&o&&m.getTime()<=o)return e.CalendarIteratorResult.FullRangeIterated;if(c&&u.getTime()-g>=l||!c&&g-m.getTime()>=l)return e.CalendarIteratorResult.MaxRangeReached;if(c&&u.getTime()>=this.cacheFilledEndDate.getTime()||!c&&m.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?m:u;const p=o&&u.getTime()<o?i:u,f=a&&m.getTime()>a?s:m;if(!1===n.call(r,p,f,t.cacheInterval))return e.CalendarIteratorResult.StoppedByIterator;t=c?d.getNextInterval(t):d.getPrevInterval(t)}if(c&&h.getTime()===KC.getTime()||!c&&h.getTime()===qC.getTime())return e.CalendarIteratorResult.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return e.CalendarIteratorResult.MaxCacheExtendCyclesReached}}const eS=e=>Array.from(new Set(e));class tS{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new tS({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new tS({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=eS(e);return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}}const nS=(e,t,n=((e,t)=>e-t))=>{let r=0,i=t.length;for(;r<i;){const s=(r+i)/2|0,o=n(e,t[s]);if(0===o)return{found:!0,index:s};o<0?i=s:r=s+1}return{found:!1,index:i}};var rS;e.IndexPosition=void 0,(rS=e.IndexPosition||(e.IndexPosition={}))[rS.Exact=0]="Exact",rS[rS.Next=1]="Next";class iS{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=nS(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=nS(e,this.keys,this.comparator);return t.found?this.values[t.index]:i}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:i}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=nS(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(t){const n=nS(t,this.keys,this.comparator);return{found:n.found?e.IndexPosition.Exact:e.IndexPosition.Next,index:n.index}}map(e){const t=this.keys,n=this.values,r=[];for(let i=0;i<t.length;i++)r.push(e(n[i],t[i],i));return r}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class sS{constructor(e){if(this.points=new iS(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=qC,this.rightInfinityKey=KC,Object.assign(this,e),this.emptyInterval===i||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(t,n=e.EdgeInclusion.Left){let r,{found:i,index:s}=this.indexOf(t);return r=n===e.EdgeInclusion.Left&&i===e.IndexPosition.Exact?s:s-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(t,n,r){const i=this.points,{found:s,index:o}=i.indexOfKey(t);let a,l;if(s==e.IndexPosition.Exact){const e=r(l=i.getValueAt(o));i.setValueAt(o,e),a=o+1}else{const e=r(l=i.getValueAt(o-1));i.insertAt(o,t,e),a=o+1}for(;a<i.size();){if(i.getKeyAt(a).getTime()>=n.getTime())break;const e=r(l=i.getValueAt(a));i.setValueAt(a,e),a++}if(a===i.size())i.insertAt(i.size(),n,this.emptyInterval);else{i.getKeyAt(a).getTime()===n.getTime()||i.insertAt(a,n,l)}}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,(e=>this.combineIntervalsFn(e,r.cacheInterval))),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class oS extends QC{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new sS({emptyInterval:new tS({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){var n;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const r=e.getTime(),i=t.getTime(),s=this.calendar.ignoreTimeZone?null:null===(n=this.calendar.project)||void 0===n?void 0:n.timeZone;if(r>i)throw new Error("Invalid cache fill interval");const o=OC.NEVER;this.forEachRecurrentInterval((n=>{const a=n.getStartDateSchedule(),l=n.getEndDateSchedule();let c,d=a.prev(1,e);if("EOD"===l){const e=a.next(1,t);c=e!==o?Gt.getStartOfNextDay(e,!0):o}else c=l.next(1,t);if(d!==o&&d.getTime()===r){const t=a.prev(2,e);t!==o&&2===t.length&&(d=t[1])}if(c!==o&&c.getTime()===i){const e=l.next(2,t);e!==o&&2===e.length&&(c=e[1])}const u=a.next(1/0,d!==o?d:e,c!==o?new Date(c.getTime()-1):t);if(u===o)return;const h="EOD"===l?u.map((e=>Gt.getStartOfNextDay(e,!0))):l.next(1/0,new Date(u[0].getTime()+1),c!==o?c:t);h!==o&&(h.length>u.length?h.length=u.length:h.length<u.length&&(u.length=h.length),u.forEach(((e,t)=>{let r=e,i=h[t];null!=s&&(r=ig.toTimeZone(r,s),i=ig.toTimeZone(i,s)),this.intervalCache.addInterval(r,i,(e=>e.includeInterval(n)))})))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{var t;const n=null===(t=this.calendar.project)||void 0===t?void 0:t.timeZone;let{startDate:r,endDate:i}=e;null!=n&&(r=ig.toTimeZone(r,n),i=ig.toTimeZone(i,n)),this.intervalCache.addInterval(r,i,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}}class aS extends(Ty([LC],(e=>{e.prototype;return class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}}))){}class lS extends(Ty([Py],(t=>{const n=t.prototype;return class extends t{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return $C}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){var r;const i=e.maxRange??(null===(r=this.getProject())||void 0===r?void 0:r.maxCalendarRange);return i&&(e={...e,maxRange:i}),this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n){var r;if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let i=e;const s=(null===(r=this.getProject())||void 0===r?void 0:r.adjustDurationToDST)??this.adjustDurationToDST??!1;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,r,o)=>{let a=!0;if(o.getIsWorking()){let o=r.getTime()-e.getTime();if(t<=o){if(s){const i=n?e.getTimezoneOffset()-new Date(e.getTime()+t).getTimezoneOffset():new Date(r.getTime()-t).getTimezoneOffset()-r.getTimezoneOffset();t-=60*i*1e3}i=n?new Date(e.getTime()+t):new Date(r.getTime()-t),t=0,a=!1}else{if(s){o+=60*(e.getTimezoneOffset()-r.getTimezoneOffset())*1e3}i=n?r:e,t-=o}}return a})),{finalDate:new Date(i),remainingDurationInMs:t}}calculateDurationMs(e,t,n=!1){var r;let i=0;const s=e.getTime()<=t.getTime()||!n?1:-1;s<0&&([e,t]=[t,e]);const o=(null===(r=this.getProject())||void 0===r?void 0:r.adjustDurationToDST)??this.adjustDurationToDST??!1;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,n)=>{if(n.getIsWorking()&&(i+=t.getTime()-e.getTime(),o)){const n=e.getTimezoneOffset()-t.getTimezoneOffset();i+=60*n*1e3}})),i*s}calculateEndDate(e,t){const n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t){const n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(t,n=!0){let r;const i=this.forEachAvailabilityInterval(n?{startDate:t,isForward:!0}:{endDate:t,isForward:!1},((e,t,i)=>{if(i.getIsWorking())return r=n?e:t,!1}));return i===e.CalendarIteratorResult.MaxRangeReached||i===e.CalendarIteratorResult.FullRangeIterated?"empty_calendar":r?new Date(r):new Date(t)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==i)return this.$calendarCache;const e=new aS({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new oS({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=i}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,t,r){let i=n.insertChild.call(this,...arguments);return Array.isArray(i)||(i=[i]),i.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),i}joinProject(){n.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){n.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(t){const n=Gt.clearTime(t),r=Gt.getNext(t,e.TimeUnit.Day);let i=!1;return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},((e,t,n)=>(i=n.getIsWorking(),!i))),!i}getDailyHolidaysRanges(t,n){const r=[];for(t=Gt.clearTime(t);t<n;)this.isDayHoliday(t)&&r.push({startDate:t,endDate:Gt.getStartOfNextDay(t,!0,!0)}),t=Gt.getNext(t,e.TimeUnit.Day);return r}getWorkingTimeRanges(e,t,n){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},((e,t,n)=>{if(n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,startDate:e,endDate:t})}})),r}getNonWorkingTimeRanges(e,t,n){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},((e,t,n)=>{if(!n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})}})),r}isWorkingTime(t,n,r){if(r){let r;const i=this.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},((e,i,s)=>{if(s.getIsWorking()&&e<=t&&i>=n)return r=!0,!1}));return i!==e.CalendarIteratorResult.MaxRangeReached&&i!==e.CalendarIteratorResult.FullRangeIterated&&r}{const e=this.skipNonWorkingTime(t);return!(!e||"empty_calendar"===e)&&(n?e<n:e.getTime()===t.getTime())}}}}))){}class cS extends(Ty([lS,Oy],(e=>{e.prototype;return class extends e{}}))){}class dS extends(Ty([Fy],(e=>{e.prototype;return class extends e{doDestroy(){var e;const t=[];null!==(e=this.rootNode)&&void 0!==e&&e.isDestroyed||this.traverse((e=>t.push(e))),super.doDestroy(),t.forEach((e=>e.destroy()))}}}))){}class uS extends(Ty([dS,jy],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:cS}}}}))){}class hS extends(Ty([],Ge)){}class gS extends(Ty([],mi)){}class mS extends(Ty([hS,gS,ds],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const n=!("silenceInitialCommit"in e)||e.silenceInitialCommit,r="adjustDurationToDST"in e&&e.adjustDurationToDST;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=n,this.adjustDurationToDST=r}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,t,n){t(...n)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}}))){}class pS extends(Ty([],mi)){}class fS extends(Ty([mS,Ay,pS,ds],(e=>{const t=e.prototype;class n extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Fb,assignmentModelClass:Nb,resourceModelClass:Ly,dependencyModelClass:rC,calendarModelClass:cS,eventStoreClass:_b,assignmentStoreClass:Jb,resourceStoreClass:Hy,dependencyStoreClass:cC,calendarManagerStoreClass:uS,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){const n=this;if(n.$invalidated=new Set,n.isPerformingCommit=!1,n.silenceInitialCommit=!0,n.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){var r;const t=e.eventStore.masterStore||e.eventStore,i=t.assignmentStore||(null===(r=t.crudManager)||void 0===r?void 0:r.assignmentStore);null!=i&&i.isAssignmentStore&&(e.assignmentStore=i,n.isSharingAssignmentStore=!0)}t.construct.call(n,e),n.defaultCalendar=new n.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:n.unspecifiedTimeIsWorking}),n.defaultCalendar.project=n;const{calendarsData:i,eventsData:s,dependenciesData:o,resourcesData:a,assignmentsData:l}=n;Boolean(i||s||o||a||l)?(n.loadInlineData({calendarsData:i,eventsData:s,dependenciesData:o,resourcesData:a,assignmentsData:l}),delete n.calendarsData,delete n.eventsData,delete n.dependenciesData,delete n.resourcesData,delete n.assignmentsData):n.bufferedCommitAsync()}doDestroy(){var e,n,r,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(n=a.dependencyStore)||void 0===n||n.destroy(),null===(r=a.assignmentStore)||void 0===r||r.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),a.defaultCalendar.destroy(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}async loadInlineData(e){const t=this;t.isLoadingInlineData=!0,e.calendarsData&&(t.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(t.resourceStore.data=e.resourcesData),e.assignmentsData&&(t.assignmentStore.data=e.assignmentsData),e.eventsData&&(t.eventStore.data=e.eventsData),e.tasksData&&(t.eventStore.data=e.tasksData),e.dependenciesData&&(t.dependencyStore.data=e.dependenciesData),await t.commitLoad(),t.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((n=>{n!==e.rootNode&&t(n)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const n=(null==t?void 0:t.storeClass)||this[`${e}StoreClass`];let r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()[`${e}ModelClass`]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this[`${e}ModelClass`]),{storeClass:n,modelClass:r}}setEventStore(e){this.eventStore=e}changeEventStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),e instanceof ao)e.project=n,r.addStore(e),n.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("event",e);e=new t(Xt.assign({modelClass:i,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),n.unJoinStoreRecords(t);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const n=t.event;if(n){const r=e.getById(n.id);r&&(t.event=r,i.delete(t))}})),t.afterEventRemoval()}return e.setProject(n),e}updateEventStore(e,t){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),t&&r.hasStore(t)&&(r.removeStore(t),n.unJoinStoreRecords(t)),e instanceof ao)e.project=n,r.addStore(e),n.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("assignment",e);e=new t(Xt.assign({modelClass:i,project:n,stm:r},e))}return e.setProject(n),e}updateAssignmentStore(e,t){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),e instanceof ao)e.project=n,r.addStore(e),n.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("resource",e);e=new t(Xt.assign({modelClass:i,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),n.unJoinStoreRecords(t);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const n=t.resource;if(n){const r=e.getById(n.id);r&&(t.resource=r,i.delete(t))}})),t.afterResourceRemoval()}return e.setProject(n),e}updateResourceStore(e,t){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,t){const n=this;if(n.detachStore(t),e instanceof ao)e.project=n,n.stm.addStore(e),n.joinStoreRecords(e);else{const{storeClass:t,modelClass:r}=n.resolveStoreAndModelClass("dependency",e);e=new t(Xt.assign({modelClass:r,project:n,stm:n.stm},e))}return e}updateDependencyStore(e,t){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,t){const n=this;if(n.detachStore(t),e instanceof ao)n.stm.addStore(e);else{var r,i;const t=(null===(r=e)||void 0===r?void 0:r.storeClass)||n.calendarManagerStoreClass,s=(null===(i=e)||void 0===i?void 0:i.modelClass)||t.getDefaultConfiguration().modelClass||n.calendarModelClass;e=new t(Xt.assign({modelClass:s,project:n,stm:n.stm},e))}return e.setProject(n),e}updateCalendarManagerStore(e,t){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await qb(0),!e.isDestroyed){for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:n}=e,r=t&&n;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const i=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(i.forEach((e=>{var t;return null===(t=e.suspendAutoCommit)||void 0===t?void 0:t.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t,isCalculated:!0}),r)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),i.forEach((e=>{var t;return null===(t=e.resumeAutoCommit)||void 0===t?void 0:t.call(e)})),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new Bh(Xt.assign({disabled:!0},e))).ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return n.applyConfigs=!0,n}))){}const vS=fS;class yS extends(AC(IC(vS))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Ob,dependencyModelClass:sC,resourceModelClass:_y,assignmentModelClass:Wb,eventStoreClass:Bb,dependencyStoreClass:uC,resourceStoreClass:zy,assignmentStoreClass:eC}}construct(...e){super.construct(...e),_.isTestEnv&&(r.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new FC({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}yS.applyConfigs=!0,yS.initClass(),yS._$name="ProjectModel";class bS extends(DC.mixin(SC,bC,CC)){static $name="CrudManager";static get defaultConfig(){return{projectClass:yS,resourceStoreClass:zy,eventStoreClass:Bb,assignmentStoreClass:eC,dependencyStoreClass:uC,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return Xt.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>t.suspendChangeTracking(),prio:100,thisObj:t}),e.ion({name:"afterDataReady",dataReady:()=>t.resumeChangeTracking(),prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return null===(e=this._timeRangeStore)||void 0===e?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return null===(e=this._resourceTimeRangeStore)||void 0===e?void 0:e.store}set resourceTimeRangeStore(e){var t;this.setFeaturedStore("_resourceTimeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.resourceTimeRangeStoreClass)}get resourceStore(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,n){var r;const i=this,s=null===(r=i[e])||void 0===r?void 0:r.store;var o;s!==t&&(t=ao.getStore(t,(null===(o=t)||void 0===o?void 0:o.storeClass)||n),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e]));return i[e]}getChangesetPackage(){var e,t;const n=super.getChangesetPackage();return n&&(this.eventStore.usesSingleAssignment||null!==(e=this.eventStore.modelClass.fieldMap)&&void 0!==e&&null!==(t=e.resourceIds)&&void 0!==t&&t.persist)&&(delete n[this.assignmentStore.storeId],!this.crudStores.some((e=>n[e.storeId])))?null:n}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}}bS._$name="CrudManager";const CS=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],SS=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"];var DS=e=>class extends e{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(e){for(const t of SS)delete e[t];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){const t=this.project.getCurrentConfig(e),n=super.getCurrentConfig(e);if(t){n.project=t;const{crudManager:e}=n;if(e)for(const n of CS)e[n]&&(t[n]=e[n]);0===Object.keys(t).length&&delete n.project}return delete n.data,delete n.crudManager,n}get widgetClass(){}};const wS=e=>!e||Array.isArray(e)?e:[e],ES=(e,t,n)=>e&&!0!==e[t]?e[t]:n;var xS=e=>class extends(e||ye){static $name="Describable";static configurable={dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null};get dateBounds(){return[this.date]}get description(){const e=this,{descriptionRenderer:t}=e;return t?e.callback(t,e,[e]):e.formattedDescription}get formattedDescription(){const e=this,{dateBounds:t,dateFormat:n}=e,r=e.descriptionFormat??wS(e.defaultDescriptionFormat),i=ES(r,0,n),s=t.length>1&&(null==r?void 0:r.length)>1&&Gt.format(t[0],i)!==Gt.format(t[1],i);let o=Gt.format(t[0],i);return s&&(o=Gt.formatRange(t,ES(r,1,`S${n}${e.dateSeparator}E${n}`))),o}changeDescriptionFormat(e){return wS(e)}get widgetClass(){}},RS=e=>class extends(e||ye){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1,n=!1){if(this.isPainted&&e){var r,i,s,o;let d=null===(r=this.foregroundCanvas.syncIdMap)||void 0===r?void 0:r[e.id];if(!d&&null!==(i=e.resource)&&void 0!==i&&i.hasLinks)for(const t of e.resource.$links){var a,l;if(d=null===(a=this.foregroundCanvas.syncIdMap)||void 0===a?void 0:a[`${e.id}_${t.id}`],d)break;if(n&&(d=null===(l=this.foregroundCanvas.releasedIdMap)||void 0===l?void 0:l[`${e.id}_${t.id}`],d))break}var c;if(!d&&n)d=null===(c=this.foregroundCanvas.releasedIdMap)||void 0===c?void 0:c[e.id];return t?d:null===(s=d)||void 0===s||null===(o=s.syncIdMap)||void 0===o?void 0:o.event}return null}getElementFromEventRecord(e,t=(t=>null===(t=e.resources)||void 0===t?void 0:t[0])(),n=!1,r=!1){if(e.isResourceTimeRange){var i;const t=null===(i=this.foregroundCanvas.syncIdMap)||void 0===i?void 0:i[e.domId];return n?t:null==t?void 0:t.syncIdMap.event}const s=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(s,n,r)}getElementsFromEventRecord(e,t,n=!1,r=!1){return t?[this.getElementFromEventRecord(e,t,n,r)]:e.resources.reduce(((t,i)=>{const s=this.getElementFromEventRecord(e,i,n,r);return s&&t.push(s),t}),[])}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=e)||void 0===t?void 0:t.closest(this.eventSelector);if(n){if(n.dataset.eventId)return this.eventStore.getById(n.dataset.eventId);if(n.dataset.assignmentId)return this.assignmentStore.getById(n.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e,t=!1){const n=e.closest(t?"[data-assignment-id][data-event-id]":this.eventSelector),r=n&&this.assignmentStore.getById(n.dataset.assignmentId),i=n&&this.eventStore.getById(n.dataset.eventId);return this.assignmentStore.getOccurrence(r,i)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},TS=e=>class extends(e||ye){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const n=this.resolveEventRecord(e);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){const t=super.onElementKeyDown(e),n=this;return n.selectedEvents.length&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:e,eventRecord:n.selectedEvents,assignmentRecord:n.selectedAssignments}),t}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}};class MS extends ye{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e,t)}layoutEventsInBands(e,t){throw new Error("Implement in subclass")}}MS._$name="HorizontalLayout";class kS extends MS{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,t,n=!1){let r=0;do{let t=0,i=e[0];for(;i;)n||(i.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,r,i.eventRecord,i.resourceRecord)),e.splice(t,1),t=this.findClosestSuccessor(i,e),i=e[t];r++}while(e.length>0);return r}findClosestSuccessor(e,t){var n;const{endMS:r,group:i}=e,s=0===(null===(n=e.eventRecord)||void 0===n?void 0:n.duration);let o,a,l,c,d=1/0;for(let e=0,n=t.length;e<n;e++){var u;if(l=t[e],a=l.startMS-r,c=l.endMS-l.startMS==0&&!(null!==(u=l.eventRecord)&&void 0!==u&&u.meta.isDragCreating),a>=0&&a<d&&(a>0||!c||!s)&&(0!==a||!c||s)){if(this.grouped&&i!==l.group)break;o=e,d=a}}return o}}kS._$name="HorizontalLayoutStack";const IS=(e,t,n,r)=>n<=e&&e<r||e<=n&&n<t;var AS=e=>class extends(e||ye){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(e,t){return!this.grouped||e.group===t.group}packEventsInBands(e,t){const n=this,{coordProp:r,sizeProp:i}=n;let s,o,a,l;for(let c=0,d=e.length;c<d;c++){if(o=e[c],s=n.findStartSlot(e,o),a=n.getCluster(e,c),a.length>1){for(o[r]=s.start,o[i]=s.end-s.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=n.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(s.end-s.start)/d;for(l=0;l<d;l++)t(a[l],l,s,u);c+=d-1}return 1}findStartSlot(e,t){const{inBandSizeProp:n,inBandCoordProp:r,coordProp:i,sizeProp:s}=this,o=this.getPriorOverlappingEvents(e,t);let a;if(0===o.length)return{start:0,end:1};for(a=0;a<o.length;a++){const e=o[a],t=r in e?r:i,l=n in e?n:s;if(0===a&&e[t]>0)return{start:0,end:e[t]};if(e[t]+e[l]<(a<o.length-1?o[a+1][t]:1))return{start:e[t]+e[l],end:a<o.length-1?o[a+1][t]:1}}return!1}getPriorOverlappingEvents(e,t){const{startMS:n,endMS:r}=t,i=[];for(let s=0,o=e.indexOf(t);s<o;s++){const o=e[s];this.isSameGroup(o,t)&&IS(n,r,o.startMS,o.endMS)&&i.push(o)}return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){const{coordProp:n}=this;return e[n]-t[n]}getCluster(e,t){const n=e[t],r=[n];if(t>=e.length-1)return r;let{startMS:i,endMS:s}=n;for(let o=t+1,a=e.length;o<a;o++){const t=e[o];if(!this.isSameGroup(t,n)||!IS(i,s,t.startMS,t.endMS))break;r.push(t),i=Math.max(i,t.startMS),s=Math.min(t.endMS,s)}return r}};class FS extends(MS.mixin(AS)){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const t=this.packEventsInBands(e,((e,t,n,r)=>{e.height=r,e.top=n.start+t*r}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),t}}FS._$name="HorizontalLayoutPack";var PS=e=>class extends(e||ye){static $name="SchedulerResourceRendering";static configurable={resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"};get resourceColumns(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var e;return(null===(e=this.resourceColumns)||void 0===e?void 0:e.columnWidth)||null}getResourceMarginObject(e){if(null!=e&&e.resourceMargin){const t=(null==e?void 0:e.resourceMargin)??this.resourceMargin;return"number"==typeof t?{start:t,end:t,total:2*t}:(t.total=t.start+t.end,t)}return this.resourceMarginObject}getBarMargin(e){return(null==e?void 0:e.barMargin)??this.barMargin}getResourceHeight(e){return e.rowHeight??(this.isHorizontal?this.rowHeight:this.getResourceWidth(e))}getResourceWidth(e){return e.columnWidth??this.resourceColumnWidth}getAppliedResourceHeight(e){const t=this.getRowById(e);return(null==t?void 0:t.maxRequestedHeight)??this.getResourceHeight(e)}getResourceLayoutSettings(e,t=null){const n=this.getResourceMarginObject(e,t),r=this.getAppliedResourceHeight(e,t);return{barMargin:this.getBarMargin(e,t),contentHeight:Math.max(r-n.total,1),rowHeight:r,resourceMarginObject:n}}get widgetClass(){}},OS=e=>class extends(PS(e||ye)){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:FS,horizontalLayoutStackClass:kS,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(e){return this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,t){const n=this;t&&n.element.classList.remove(`b-eventlayout-${t.type}`),n.element.classList.add(`b-eventlayout-${e.type}`),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}changeHorizontalEventSorterFn(e){_.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=e}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}updateEventBodyTemplate(){_.deprecate("Scheduler","6.0.0","Return markup/DomConfigs from eventRenderer() instead")}getEventLayout(e){var t;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.eventLayout||this.internalEventLayout),"string"==typeof e&&(e={type:e}),e}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:r}=t,{type:i}=e;switch(t.layouts||(t.layouts={}),i){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(Xt.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(Xt.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalPack;default:return null}}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}getEventStyle(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}getEventColor(e,t){var n,r;return e.eventColor||(null===(n=e.event)||void 0===n?void 0:n.eventColor)||(null===(r=e.parent)||void 0===r?void 0:r.eventColor)||t.eventColor||this.eventColor}generateRenderData(e,t,n={viewport:!0}){const i=this,s=i.currentOrientation.getTimeSpanRenderData(e,t,n),{isEvent:o}=e,{eventResize:a}=i.features,l=!e.meta.isDragCreating&&e.isMilestone,c=o&&e.assignments.find((e=>e.resourceId===t.$originalId)),d={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(s){var u;s.tabIndex="0";let n=e.isResizable;a&&n&&(s.startsOutsideView&&(!0===n?n="end":"start"===n&&(n=!1)),s.endsOutsideView&&(!0===n?n="start":"end"===n&&(n=!1)),n&&(i.isHorizontal?!i.rtl&&!a.leftHandle||i.rtl&&!a.rightHandle?n="start"!==n&&"end":(!i.rtl&&!a.rightHandle||i.rtl&&!a.leftHandle)&&(n="end"!==n&&"start"):a.topHandle?a.bottomHandle||(n="end"!==n&&"start"):n="start"!==n&&"end"));const g=Boolean(e.hasPersistableChanges||(null==c?void 0:c.hasPersistableChanges)),m={[t.cls]:t.cls,[i.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[i.dirtyCls]:g,[i.committingCls]:e.isCommitting,[i.endsOutsideViewCls]:s.endsOutsideView,[i.startsOutsideViewCls]:s.startsOutsideView,"b-clipped-start":s.clippedStart,"b-clipped-end":s.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":i.rtl},p={[`${i.eventCls}-parent`]:t.isParent,"b-readonly":e.readOnly||(null==c?void 0:c.readOnly),"b-linked-resource":t.isLinked,"b-original-resource":t.hasLinks},f=e.isResourceTimeRange?new Tn:e.internalCls.clone(),v=e.isResourceTimeRange?e.internalCls.clone():new Tn;if(s.wrapperStyle="",s.isWrap=!0,o){const o=c&&i.isAssignmentSelected(c);Xt.assign(m,{[i.eventCls]:1,"b-milestone":l,"b-sch-event-narrow":!l&&s.width<i.narrowEventWidth,[i.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${n}`]:Boolean(a&&!e.readOnly),[i.eventSelectedCls]:o,[i.eventAssignHighlightCls]:i.eventAssignHighlightCls&&!o&&i.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),s.eventId=e.id;const d=i.getEventStyle(e,t),u=i.getEventColor(e,t),h=i.isFirstRender&&i.useInitialAnimation&&!0!==r.bryntum.noAnimations;if(Xt.assign(p,{[`${i.eventCls}-wrap`]:1,"b-milestone-wrap":l,[i.navigator.focusCls]:e.assignments.some((e=>e===i.activeAssignment))}),h){const e=(s.row?s.row.index:(s.top-i.scrollTop)/i.tickSize)/20*1e3;s.wrapperStyle=`animation-delay: ${e}ms;`,i.maxDelay=Math.max(i.maxDelay||0,e),i.initialAnimationDetacher||(i.initialAnimationDetacher=Zn.on({element:i.foregroundCanvas,delegate:i.eventSelector,once:!0,animationend:()=>i.setTimeout({fn:"stopInitialAnimation",delay:i.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:i.initialAnimationDuration+i.maxDelay},thisObj:i}))}s.eventColor=u,s.eventStyle=d,s.assignmentRecord=s.assignment=c}if(s.wrapperCls=Xt.assign(v,p),s.cls=Xt.assign(f,m),s.iconCls=new Tn(e.getValue(i.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(s.style="",s.wrapperStyle+=e.style||""):s.style=e.style||"",s.resource=s.resourceRecord=t,s.resourceId=s.rowId,o){let n,r=null,o=null;if(i.eventRenderer){const r=i.eventRenderer.call(i.eventRendererThisObj||i,{eventRecord:e,resourceRecord:t,assignmentRecord:s.assignmentRecord,renderData:s});"string"==typeof s.cls&&(s.cls=new Tn(s.cls)),"string"==typeof s.wrapperCls&&(s.wrapperCls=new Tn(s.wrapperCls)),"string"==typeof s.iconCls&&(s.iconCls=new Tn(s.iconCls)),n=i.eventBodyTemplate?i.eventBodyTemplate(r):r}else i.eventBodyTemplate?n=i.eventBodyTemplate(e):i.eventBarTextField&&(n=$.encodeHtml(e.getValue(i.eventBarTextField)||""));var h;if(!i.eventBodyTemplate||Array.isArray(n))d.children=[],!l||"default"!==i.milestoneLayoutMode&&"always-outside"!==i.milestoneTextPosition||null==n||""===n||d.children.unshift(o={tag:"label",children:[]}),null!==(h=s.iconCls)&&void 0!==h&&h.length&&d.children.unshift({tag:"i",className:s.iconCls}),Array.isArray(n)?(o||d).children.push(...n):$.isHtml(n)?d.children.length?r={tag:"span",class:"b-event-text-wrap",html:n}:(d.children=null,d.html=n):"string"==typeof n||"object"==typeof n?r=n:null!=n&&(r=String(n)),null!=r&&((o||d).children.push(r),s.cls.add("b-has-content")),(null!=d.html||d.children.length)&&s.children.push(d);else d.html=n,s.children.push(d)}const{eventStyle:y,eventColor:b,wrapperCls:C}=s;if(C[`b-sch-style-${y||"none"}`]=1,Br.isNamedColor(b))C[`b-sch-color-${b}`]=b;else if(b){const e=`${y?"color":"background-color"}:${b};`;s.style=e+s.style,C["b-sch-custom-color"]=1,s._customColorStyle=e}else C["b-sch-color-none"]=1;s.style&&l&&d&&(d.style=s.style,delete s.style),s.cls["b-sch-event-withicon"]=null===(u=s.iconCls)||void 0===u?void 0:u.length,s.eventContent=d,s.wrapperChildren=[],i.onEventDataGenerated(s)}return s}onEventDataGenerated(e){}changeUseInitialAnimation(e){return!0===e?"fade-in":e}updateUseInitialAnimation(e,t){const{classList:n}=this.element;t&&n.remove(`b-initial-${t}`),e&&(n.add(`b-initial-${e}`),o.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var t;const n=this;null===(t=n.initialAnimationDetacher)||void 0===t||t.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=e,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,o.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}getMilestoneLabelWidth(e,t){const n=this,r=n.milestoneLayoutMode,i=n.getResourceLayoutSettings(t).contentHeight;if("measure"===r){const r=$.encodeHtml(e.name),s=n.getEventColor(e,t),o=n.getEventStyle(e,t),a=n.milestoneMeasureElement||(n.milestoneMeasureElement=Br.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${s}`]:s,[`b-sch-style-${o}`]:o},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(a.retainElement=!0,a.style.fontSize=`${i}px`,"always-outside"===n.milestoneTextPosition){const e=a.firstElementChild.firstElementChild.firstElementChild;e.innerHTML=r;const t=wn.from(e,e.parentElement);return t.left+t.width+2}return a.firstElementChild.firstElementChild.innerHTML=`<label></label>${r}`,a.firstElementChild.offsetWidth}return"estimate"===r?e.name.length*n.milestoneCharWidth+("always-outside"===n.milestoneTextPosition?i:0):"data"===r?e.milestoneWidth:0}updateMilestoneLayoutMode(e){const t=this,n="always-outside"===t.milestoneTextPosition;t.element.classList.toggle("b-sch-layout-milestones","default"!==e&&!n),t.element.classList.toggle("b-sch-layout-milestone-labels","default"!==e&&n),t.isConfiguring||t.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}};const LS=["assignmentStore","dependencyStore","eventStore","resourceStore"];var $S=e=>class extends(e||ye){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:yS,project:{},destroyStores:null,projectSubscribers:[]}}#t;startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const n=this,{projectStoreNames:r,projectDataNames:i}=n.constructor;if(n.projectCallbacks=new Set,e){if(n.buildingProjectConfig=!0,!e.isModel){if(n.isConfiguring){n._project=e;const{crudManager:t}=n;if(t){const{isCrudManager:e}=t;for(const i of r)t[i]&&(n[i]=t[i],e||delete t[i])}n.getConfig("projectStores");for(const e of i)n.getConfig(e)}const{eventStore:t}=e;let{_sharedProject:s}=n;if(t&&!t.isEventStoreMixin&&t.autoLoad&&!t.count&&(t.autoLoad=!1,n.delayAutoLoad=!0),s&&LS.some((t=>e[t]&&e[t]!==s[t]))){for(const t of LS)e[t]&&e[t]===s[t]&&(e[t]=e[t].chain());s=null}e=s||new n.projectModelClass(e),delete n._project}n.buildingProjectConfig=!1}return e}updateProject(e,t){const n=this,{projectListeners:r,crudManager:i}=n;if(n.detachListeners("projectConsumer"),delete n._crudManager,e){var s;r.thisObj=n,e.ion(r),e.isCrudManager?n.crudManager=e:i&&(i.project=e,n.crudManager=i),n.projectSubscribers.forEach((n=>{n.detachFromProject(t),n.attachToProject(e)}));for(const t of n.constructor.projectStoreNames)n[t]=e[t];n.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load()),null===(s=e.stm)||void 0===s||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:n})}n.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}onProjectDataReady(){const e=this;e.whenVisible((()=>{e.projectCallbacks.size&&(e.projectCallbacks.forEach((e=>e())),e.projectCallbacks.clear())}),null,null,"onProjectDataReady")}onProjectRestoringStart({stm:e}){const{rawQueue:t}=e;t.length&&t[t.length-1].length>1&&(this.#t=!0,this.suspendRefresh())}onProjectRestoringStop(){this.#t&&(this.#t=!1,this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:e,oldTimeZone:t}){const n=this;if(n.startDate&&n.timeAxis.timeZone!==e){const r=null!=t?ig.fromTimeZone(n.startDate,t):n.startDate;n.startDate=null!=e?ig.toTimeZone(r,e):r,n.timeAxis.timeZone=e}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:n}=this.projectStores[t];return n&&e.push(n),e}),[])}static setupProjectStores(e,t){const{projectStores:n}=e;if(n){const e={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset"},r={projectListeners:e};let i;for(const s in n){const{dataName:o}=n[s];r[s]=r[o]=null,o&&(Object.defineProperty(t.class.prototype,o,{configurable:!0,get(){var e;return null===(e=this.project[s])||void 0===e?void 0:e.records}}),this.createDataUpdater(s,o,i,t)),this.createStoreDescriptor(t,s,n[s],e),i=o}this.setupConfigs(t,r)}}static createDataUpdater(e,t,n,r){r.class.prototype[`update${$.capitalize(t)}`]=function(r){const{project:i}=this;n&&this.getConfig(n),this.buildingProjectConfig?i[`${t}Data`]=r:i[e].data=r}}static createStoreDescriptor(e,t,{listeners:n},r){const{prototype:i}=e.class,s=$.capitalize(t);r[`${t}Change`]=function({store:e}){this[t]=e},i[`change${s}`]=function(e,r){var i;const o=this,{project:a}=o,l=null===(i=e)||void 0===i?void 0:i.project;return o.buildingProjectConfig?(null!=l&&l.isProjectModel&&(o._sharedProject=l),void(a[t]=e)):(o.initializingProject||a[t]!==e&&(a[`set${s}`](e),e=a[t]),e!==r&&(n&&(n.thisObj=o,n.name=`${t}Listeners`,n.startApplyChangeset="onProjectStoreStartApplyChangeset",n.endApplyChangeset="onProjectStoreEndApplyChangeset",o.detachListeners(n.name),e.ion(n)),o[`_${t}`]=e,o.projectSubscribers.forEach((t=>{var n;null===(n=t[`attachTo${s}`])||void 0===n||n.call(t,e)})),o[`_${t}`]=null),e)}}onProjectStoreStartApplyChangeset(){this.suspendRefresh()}onProjectStoreEndApplyChangeset(){this.resumeRefresh(!0)}relayProjectDataChange(e){if(!e.isExpand&&!e.isCollapse||e.records[0].fieldMap.expanded.persist)return this.trigger("dataChange",{project:e.source,...e,source:this})}get widgetClass(){}},_S=e=>class extends($S(e||ye)){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:_.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;t.isVisible?(e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(!1,!e),t.refreshAfterProjectRefresh=!1),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh,{scrollIntoView:!1}),t.navigateToAfterRefresh=null)):t.whenVisible("refresh",t,[!0])}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new ao({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t,records:n}){const r=arguments;this.runWithTransition((()=>{this.currentOrientation.suspended=!t&&!n.some((e=>e.isLinked)),super.refreshFromRowOnStoreAdd(e,...r),this.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:n}){let r=0;"assigned"in n&&r++,"calendar"in n&&r++,r!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){this.isPainted&&this._mode&&!e.isAssign&&!this.assignmentStore.isRemovingAssignment&&(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,n,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>{t.toggleCls(e,n,!0)}))}onAssignmentException({action:e}){"commit"===e&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map((e=>e.getResource()));new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onAssignmentBeforeRemove({records:e,removingAll:t}){if(t)return;const n=this,{activeAssignment:r}=n,i=e.includes(r);let s;if(!n.isConfiguring&&(n.navigateToAfterRefresh||r&&i)){e.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null);const t=n.getElementFromAssignmentRecord(r,!0);if(i&&t){const e=n.timeAxisSubGrid.rectangle().intersect(n._bodyRectangle),r=wn.from(t),i=r.center,o=n.isHorizontal?"y":"x",a=({element:e,distance:t,center:n,edgeDistance:r},{element:s,distance:a,center:l,edgeDistance:c})=>{if(e.dataset.resourceId!==s.dataset.resourceId){if(Math.abs(n[o]-i[o])<Math.abs(l[o]-i[o]))return-1;if(Math.abs(n[o]-i[o])>Math.abs(l[o]-i[o]))return 1}return Math.min(r,t)-Math.min(c,a)||l[o]-n[o]},l=Array.from(n.foregroundCanvas.querySelectorAll(n.navigator.itemSelector)).reduce(((s,o)=>{if(o!==t){const t=wn.from(o).intersect(e),a=t&&n.resolveAssignmentRecord(o);if(a){const{center:e}=t,n=i.getDelta(e),l=e.y<i.y?r.y-t.bottom:e.y>i.y?t.y-r.bottom:0,c=e.x<i.x?r.x-t.right:e.x>i.x?t.x-r.right:0;s.push({element:o,assignment:a,center:e,distance:Math.sqrt(n[0]**2+n[1]**2),edgeDistance:Math.max(l,c)})}}return s}),[]).sort(a)[0];l&&(s=l.assignment)}s?(n.navigateTo(s,{scrollIntoView:!1}),n.navigateToAfterRefresh=s):Br.focusWithoutScrolling(n.focusElement)}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:e}){this.applyStartEndParameters(e)}getResourcesEventsPerTick(e,t){const{timeAxis:n,resourceStore:r}=this,i=[];return(e=e||r.records).forEach((e=>{e.events.forEach((r=>{if(!n.isTimeSpanInAxis(r)||t&&!t.call(this,{resource:e,event:r}))return;let s=Math.floor(n.getTickFromDate(r.startDate)),o=Math.ceil(n.getTickFromDate(r.endDate));-1==s&&(s=0),-1===o&&(o=n.ticks.length);do{i[s]?i[s].push(r):i[s]=[r]}while(++s<o)}))})),i}get widgetClass(){}};const jS={block:"nearest",edgeOffset:20};var BS=e=>class extends(e||ye){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(e,t=jS){const n=e.resources||[e];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");n.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await this.scrollResourceEventIntoView(n[0],e,t)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}async scrollResourceEventIntoView(e,t,n=jS){var r;const i=this,s=t.startDate,o=t.endDate,a=t.isScheduled&&s<i.timeAxis.startDate|(o>i.timeAxis.endDate)<<1;let l;if(arguments.length>3&&(n=arguments[3]),null==n.edgeOffset&&(n.edgeOffset=20),a&&!1!==n.extendTimeAxis){const e=i.timeAxis.endDate-i.timeAxis.startDate;if(3===a)await i.setTimeSpan(new Date(s.getTime()-e/2),new Date(o.getTime()+e/2));else if(i.infiniteScroll){const{visibleDateRange:t}=i,n=t.endMS-t.startMS,r=1&a?1:-1;await i.setTimeSpan(new Date(s.getTime()-e/2),new Date(s.getTime()+e/2),{visibleDate:new Date(o.getTime()+r*n)})}else 1&a?await i.setTimeSpan(new Date(s),new Date(s.getTime()+e)):await i.setTimeSpan(new Date(o.getTime()-e),new Date(o))}if(!i.isDestroyed){var c;if(i.store.tree)await(null===(c=i.expandTo)||void 0===c?void 0:c.call(i,e));if(null!==(r=i.features.nestedEvents)&&void 0!==r&&r.enabled&&t.parent&&!t.parent.isRoot&&await i.scrollEventIntoView(t.parent),l=i.getElementFromEventRecord(t,e),l){Br.isFocusable(l)||(l=l.parentNode);const r=i.timeAxisSubGrid.scrollable;if(await r.scrollIntoView(l,n),i.isDestroyed)return;let s;do{if(s=i.getElementFromEventRecord(t,e),s||await N.animationFrame(),i.isDestroyed)return}while(!s)}else 3===a&&!1===n.extendTimeAxis?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):t.isOccurrence||i.eventStore.isAvailable(t)?t.isScheduled?await i.scrollUnrenderedEventIntoView(e,t,n):await i.scrollResourceIntoView(e,n):console.warn("You have asked to scroll to an event which is not available")}}scrollUnrenderedEventIntoView(e,t,n=jS){return new Promise((async r=>{const s=this,o=s.timeAxisSubGrid.scrollable,a=o.viewport,{rowManager:l}=s,c=o.y;if(!a)return void r();let d,u,h=0;do{if(++h>=50)throw new Error(`Too many preparational scrolls during 'scrollIntoView' for event id = ${t.id}`);const n=s.getResourceEventBox(t,e);if(!n)return void r();n.x=Math.ceil(n.x),n.y=Math.ceil(n.y),s.rtl&&n.translate(-s.timeAxisViewModel.totalSize+a.width,0),n.translate(a.x-o.scrollLeft,a.y-o.y);const l=Object.assign({},jS);u===i&&(u=o.getDeltaTo(n,l));const c=o.scrollIntoView(n,l);if(await c,c.cancelled||s.isDestroyed)return r(),!0;if(await N.animationFrame(),s.isDestroyed)return r(),!0;d=s.getElementFromEventRecord(t,e)}while(!d);o.suspendEvents(),u.yDelta>=0?o.y=Math.max(l.topRow.top-o.viewport.height,c):o.y=Math.min(l.bottomRow.bottom,c),s.fixElementHeights(),o.resumeEvents();const g=o.scrollIntoView(d,Object.assign({},n,{elementAfterScroll:()=>s.getElementFromEventRecord(t,e)}));if(await g,g.canceled||s.isDestroyed)return r(),!0;await N.animationFrame(),r()}))}scrollResourceIntoView(e,t=jS){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},VS=e=>class extends(e||ye){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,n=!0,r){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,t,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,n=!1,r=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,t=!1){return e.resources.map((n=>this.getResourceEventBox(e,n,t)))}get widgetClass(){}};const HS=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"];var NS=e=>class extends(e||ye){static get $name(){return"SchedulerState"}getState(){return Xt.copyProperties(super.getState(),this,HS)}applyState(e){var t;this.suspendRefresh();let n=HS.slice();"layoutFn"===(null==e?void 0:e.eventLayout)&&(delete e.eventLayout,n.splice(n.indexOf("eventLayout"),1)),null!=e&&null!==(t=e.zoomLevelOptions)&&void 0!==t&&t.width&&(n=n.filter((e=>"tickSize"!==e))),Xt.copyProperties(this,e,n),super.applyState(e),this.resumeRefresh(!0,!1)}get widgetClass(){}},zS=e=>class extends(e||ye){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectResourceOnEventNavigate:!0,selectResourceOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var e;super.afterConstruct(),null===(e=this.navigator)||void 0===e||e.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(e){return e.isCollection||(e=new Ms(e)),e}updateSelectedCollection(e){const t=this;e.owner||(e.owner=t),e.ion({change:(...e)=>t.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",((...e)=>!t.isDestroying&&t.onSelectedCollectionChange(...e)),e),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:t})}get selectedCollection(){return this._selectedCollection}getActionType(e,t,n,r){return r&&e.length>0&&n.length===e.length&&0===t.length||!r&&0===e.length&&n.length>0?"clear":t.length>0&&n.length>0?"update":t.length>0?"select":"deselect"}getEventsFromAssignments(e){return H.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){var t;const n=[];null===(t=e=H.asArray(e))||void 0===t||t.forEach((e=>{!1!==this.isEventSelectable(e)&&(e.isOccurrence?e.assignments.forEach((t=>{n.push(this.assignmentStore.getOccurrence(t,e))})):n.push(...e.assignments))})),this.selectedCollection.splice(0,this.selectedCollection.count,n)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:t}=this;return Boolean(t.count&&t.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||this.selectEvents([e],t)}selectAssignment(e,t=!1,n){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,t=!1){if(t){const t=e.reduce(((e,t)=>(!1!==this.isEventSelectable(t)&&e.push(...t.assignments),e)),[]);this.selectedCollection.add(t)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:t,index:n}){const r=this,i=r._selectedCollection.values,s=e,o=t>0?i.slice(n,t+n):[],a=r.getActionType(i,s,o,!0);if(0!==e.length||0!==t)return!1!==r.trigger("beforeEventSelectionChange",{action:a,selection:r.getEventsFromAssignments(i)||[],selected:r.getEventsFromAssignments(s)||[],deselected:r.getEventsFromAssignments(o)||[]})&&(!1!==r.trigger("beforeAssignmentSelectionChange",{action:a,selection:i,selected:s,deselected:o})&&void 0)}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedAssignments,i=e||[],s=t||[];function o(e,t){const r=e.event;if(r){const i=!1,s=!0,{eventAssignHighlightCls:o}=n,a=n.getElementFromAssignmentRecord(e,i,s);n.currentOrientation.toggleCls(e,n.eventSelectedCls,t,i,s),o&&n.getElementsFromEventRecord(r,null,i,s).forEach((e=>{if(e!==a){const r=n.resolveAssignmentRecord(e,s);n.currentOrientation.toggleCls(r,o,t,i,s),t&&!e.parentElement.isReleased&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList.toggle(o,t)}}))}}if(s.forEach((e=>o(e,!1))),i.forEach((e=>o(e,!0))),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=r.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!n.silent){const e=this.getActionType(r,i,s);n.trigger("assignmentSelectionChange",{action:e,selection:r,selected:i,deselected:s}),n.trigger("eventSelectionChange",{action:e,selection:n.selectedEvents,selected:n.getEventsFromAssignments(i),deselected:n.getEventsFromAssignments(s)})}}onAssignmentChange(e){super.onAssignmentChange(e);const t=this,{action:n,records:r}=e;if(t.silent=!t.triggerSelectionChangeOnRemove,"remove"===n)t.deselectAssignments(r);else if("removeall"!==n||t.eventStore.isSettingData){if("dataset"===n&&t.$selectedAssignments)if(t.maintainSelectionOnDatasetChange){const e=t.$selectedAssignments.map((e=>r.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));t.selectedAssignments=H.clean(e)}else t.clearEventSelection()}else t.clearEventSelection();t.silent=!1}onInternalEventStoreChange({source:e,action:t,records:n}){e.isResourceTimeRangeStore||"dataset"!==t||n.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const n=this;n.isAssignmentSelected(t)?(n.deselectOnClick||e.ctrlKey)&&n.deselectAssignment(t,n.multiEventSelect,e):!1!==this.isEventSelectable(t.event)&&n.selectAssignment(t,e.ctrlKey&&n.multiEventSelect,e)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const n=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);n?this.onAssignmentSelectionClick(e,n):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:n,eventStore:r}=t,i=t.features.dependencies;n.forEach((t=>{e.includes(t)||(t.meta.highlight=!1,n.delete(t),r.includes(t)&&t.dependencies.forEach((e=>i.unhighlight(e,"b-highlight"))))})),e.forEach((e=>{const r=[e];for(;r.length;){const e=r.pop();n.add(e),t.highlightSuccessors&&e.outgoingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.toEvent)&&r.push(e.toEvent)})),t.highlightPredecessors&&e.incomingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.fromEvent)&&r.push(e.fromEvent)}))}n.forEach((e=>e.meta.highlight=!0))})),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;(null===(e=this._selectedCollection)||void 0===e?void 0:e.owner)===this&&this._selectedCollection.destroy(),super.doDestroy()}get widgetClass(){}};const WS=e=>e.preventDefault(),US={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},GS={animate:100},YS=Object.freeze({});var qS=e=>class extends(mi(e||ye)){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new Sc(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:WS}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:WS})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var t,n;const r=this,{navigator:i}=r;if(-1===(null===(t=r.focusedCell)||void 0===t?void 0:t.rowIndex)||(null===(n=r.focusedCell)||void 0===n?void 0:n.column)!==r.timeAxisColumn||e.target.closest(i.itemSelector)||"Enter"!==e.key){var s;null===(s=super.onElementKeyDown)||void 0===s||s.call(this,e)}else{const t=r.getFirstVisibleAssignment();if(t)return r.navigateTo(t,{uiEvent:e}),!1}}getFirstVisibleAssignment(e=this.focusedCell){const{currentOrientation:t,rowManager:n,eventStore:r}=this;if(this.isHorizontal){var i;let c=t.rowMap.get(n.getRow(e.rowIndex));var s,o,a,l;if(null!==(i=c)&&void 0!==i&&i.length)return null===(s=c[0])||void 0===s?void 0:s.elementData.assignmentRecord;if(c=null===(o=t.resourceMap.get(e.id))||void 0===o?void 0:o.eventsData,null!==(a=c)&&void 0!==a&&a.length)return null===(l=c.filter((e=>r.isAvailable(e.eventRecord)))[0])||void 0===l?void 0:l.assignmentRecord}else{const e=[...t.resourceMap.values()][0],n=e&&Object.values(e);if(null!=n&&n.length)return n.filter((e=>r.isAvailable(e.renderData.eventRecord)))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){const t=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:i}=r,{target:s}=e,o=s.closest(r.navigator.itemSelector),a=o?r.normalizeCellContext({rowIndex:r.isVertical?0:r.resourceStore.indexOf(r.resolveResourceRecord(s)),column:r.timeAxisColumn,target:s}):new Kc(s);if(o){var n;const{_focusedCell:e}=r;return r._focusedCell=a,void(null===(n=r.onCellNavigate)||void 0===n||n.call(r,r,e,a,i,!0))}if(t&&(!i||US[i.key])){const t=r.getFirstVisibleAssignment(a);if(t)return void r.navigateTo(t,{scrollIntoView:Boolean(i&&"mousedown"!==i.type),uiEvent:i||e})}}t&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)-1];if(!d)for(let e=r.indexOf(c)-1;(!d||t&&d===a)&&e>=0;e--){c=r.getAt(e);const t=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i);d=t.length&&t[t.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigatePrevious(e){const t=this,n=t.getPrevious(t.normalizeTarget(e));return e.preventDefault(),n?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):t.doGridNavigation(e)}getNext(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)+1];if(!d)for(let e=r.indexOf(c)+1;(!d||t&&d===a)&&e<r.count;e++){c=r.getAt(e);d=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i)[0]}return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigateNext(e){const t=this,n=t.getNext(t.normalizeTarget(e));return e.preventDefault(),n?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):t.doGridNavigation(e)}doGridNavigation(e){e.handled||0!==e.key.indexOf("Arrow")||this[`navigate${e.key.substring(5)}ByKey`](e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:n={}}=YS){const r=this,{navigator:i}=r,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await r.scrollAssignmentIntoView(e,GS),i.disabled=!1):i.skipScrollIntoView=!0,!r.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(r.activeAssignment=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:n,item:r.getElementFromAssignmentRecord(e).closest(i.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,n=e.target.closest(t.eventSelector);return!t.navigator.disabled&&n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const e=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(e.filter((e=>!e.readOnly)))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},KS=e=>class extends e{static get $name(){return"TransactionalFeatureMixin"}static configurable={enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}};get widgetClass(){}get transactionalFeaturesEnabled(){var e;return this.enableTransactionalFeatures&&(null===(e=this.project)||void 0===e?void 0:e.queue)}},XS=e=>class extends(e.mixin(Kd)){static get $name(){return"CrudManagerView"}static config={clearMaskDelay:null,testConfig:{clearMaskDelay:0}};afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=Go.mergeConfigs(this.loadMaskDefaults,e))}bindCrudManager(e){this.detachListeners("crudManager");let t={};this.isTaskBoardBase||(t={beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",beforeLoadCrudManagerData:"onCrudManagerBeforeLoadCrudManagerData",loadCrudManagerData:"onCrudManagerLoadCrudManagerData"}),null==e||e.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",...t,thisObj:this})}onCrudManagerBeforeSend({params:e}){var t;null===(t=this.applyStartEndParameters)||void 0===t||t.call(this,e)}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){this.suspendRefresh()}onCrudManagerApplyResponse(){this.resumeRefresh(!0)}onCrudManagerBeforeLoadCrudManagerData(){this.crudManager.applyingLoadResponse||this.suspendRefresh()}async onCrudManagerLoadCrudManagerData(){this.crudManager.applyingLoadResponse||(await this.project.commitAsync(),!this.isDestroyed&&this.resumeRefresh(!0))}onCrudManagerRequestFinalize(e=!0,t,n){const r=this;var i;e?null===(i=r.toggleEmptyText)||void 0===i||i.call(r):(r.masked||r.applyLoadMask(),r.applyMaskError(`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${r.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                    ${n&&n.message?`<div class="b-grid-load-fail">${r.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}\n                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}onAjaxTransportResponseReceived(){const e=this;null!=e.clearMaskDelay?e.setTimeout((()=>e.masked=null),e.clearMaskDelay):e.masked=null}get widgetClass(){}},ZS=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){var e;super.afterConstruct();const t=this,n=t.client||t.grid,{project:r}=n;null===(e=n.projectSubscribers)||void 0===e||e.push(t),r&&(t.attachToProject(r),t.attachToResourceStore(r.resourceStore),t.attachToEventStore(r.eventStore),t.attachToAssignmentStore(r.assignmentStore),t.attachToDependencyStore(r.dependencyStore),t.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(e){var t;this.detachListeners("project"),this._project=e,null===(t=super.attachToProject)||void 0===t||t.call(this,e)}detachFromProject(e){var t;null===(t=super.detachFromProject)||void 0===t||t.call(this,e)}attachToEventStore(e){var t;this.detachListeners("eventStore"),null===(t=super.attachToEventStore)||void 0===t||t.call(this,e)}attachToResourceStore(e){var t;this.detachListeners("resourceStore"),null===(t=super.attachToResourceStore)||void 0===t||t.call(this,e)}attachToAssignmentStore(e){var t;this.detachListeners("assignmentStore"),null===(t=super.attachToAssignmentStore)||void 0===t||t.call(this,e)}attachToDependencyStore(e){var t;this.detachListeners("dependencyStore"),null===(t=super.attachToDependencyStore)||void 0===t||t.call(this,e)}attachToCalendarManagerStore(e){var t;this.detachListeners("calendarManagerStore"),null===(t=super.attachToCalendarManagerStore)||void 0===t||t.call(this,e)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}};const JS={releaseElement:1,reuseElement:1},QS={newElement:1,reuseOwnElement:1,reuseElement:1},eD=9999999,tD=({startDateMS:e},{startDateMS:t})=>e-t,nD={startDate:1,endDate:1,duration:1};function rD(e,t,n,r,i){var s,o;const{timeAxis:a}=e,l=t.isBatchUpdating&&!i?t.get(r):t[r],c=null===(s=t.hasBatchedChange)||void 0===s?void 0:s.call(t,r);if(e.fillTicks&&(!(null!==(o=t.meta)&&void 0!==o&&o.isResizing)||!c)){let e=a.getTickFromDate(l);if(e>=0){n&&e===Math.round(e)&&e>0&&e--;const t=Math.floor(e);return a.getAt(t)[r].getTime()}}return null==l?void 0:l.getTime()}class iD extends(ye.mixin(ZS)){static $name="HorizontalRendering";static get configurable(){return{bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),t.scrollBuffer=e.scrollBuffer,e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:t}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,n,r=!1){const{scheduler:i}=this;let s=e[0];return n||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,r)}translateToScheduleCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let i=e-t.timeAxisSubGridElement.getBoundingClientRect().left-r.scrollX;return t.rtl?i+=n.maxX-Math.abs(t.scrollLeft):i+=t.scrollLeft,i}translateToPageCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}getScheduleRegion(e,t,n=!0,r,i=!1){var s,o;const a=this,{scheduler:l}=a,{timeAxisSubGridElement:c,timeAxis:d}=l,{start:u,end:h}=(!i||e)&&l.getResourceMarginObject(e)||{start:0,end:0};let g;if(e){const n=l.getRowById(e.id),r=t&&l.getElementsFromEventRecord(t,e)[0];if(g=n?wn.from(n.getElement("normal"),c):l.getRecordCoords(e,!0),r){const e=wn.from(r,c);g.y=e.y,g.bottom=e.bottom}else g.y=g.y+u,g.bottom=g.bottom-h}else g=wn.from(c).moveTo(null,0),g.width=c.scrollWidth,g.y=g.y+u,g.bottom=g.bottom-h;const m=d.startDate,p=d.endDate;r=(null===(s=r)||void 0===s?void 0:s.start)&&r||(null===(o=l.getDateConstraints)||void 0===o?void 0:o.call(l,e,t))||{start:m,end:p};let f=l.getCoordinateFromDate(r.start?Gt.max(m,r.start):m),v=l.getCoordinateFromDate(r.end?Gt.min(p,r.end):p);return n||(f=a.translateToPageCoordinate(f),v=a.translateToPageCoordinate(v)),g.left=Math.min(f,v),g.right=Math.max(f,v),g}getRowRegion(e,t,n){const{scheduler:r}=this,{timeAxis:i}=r,s=r.getRowById(e.id);if(!s)return null;const o=i.startDate,a=i.endDate,l=t?Gt.max(o,t):o,c=n?Gt.min(a,n):a,d=r.getCoordinateFromDate(l),u=r.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),m=h+s.offsetHeight;return new wn(g,h,Math.max(d,u)-g,m-h)}getResourceEventBox(e,t,n,r=!1){const{scheduler:i}=this,s=this.resourceMap.get(t.id);let o=null,a=!1;if(s&&(o=s.eventsData.find((t=>t.eventRecord===e))),o||(o=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:n}),a=!0),o){const e=o.height??i.getResourceLayoutSettings(t).contentHeight,n=i.rowManager.getRecordCoords(t,!0,r),s=o.top+n.top,l=new wn(o.left,s,o.width,e);return l.layout=!a,l.rowTop=n.top,l.rowBottom=n.bottom,l.resourceId=t.id,l}return null}resolveRowRecord(e){const t=this,{scheduler:n}=t,r=e.nodeType?e:e.target,i=r.nodeType===Element.TEXT_NODE?r.parentElement:r,s=i.closest(n.eventSelector);return s?t.resourceStore.getById(s.dataset.resourceId):!i.closest(".b-grid-row")&&i.dataset.resourceId?t.resourceStore.getById(i.dataset.resourceId):n.getRecordFromElement(i)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:t,project:n}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!t.size&&null!=n.timeZone&&n.ignoreRecordChanges&&n.resourceStore.forEach((e=>t.add(e.id))),t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:t}){const n=this,{scheduler:r,toDrawOnProjectRefresh:i}=n;if(r.isVisible){if(r.isPainted&&!r.isConfiguring&&!r.refreshSuspended){if(n.refreshAllWhenReady||t&&e){r.calculateAllRowHeights(!0);const{rowManager:i}=r;i.topRow?(n.clearAll(),r.refreshAfterProjectRefresh||(i.topRow.dataIndex>=r.store.count?r.renderRows(!1):r.refreshWithTransition(!1,!n.isFirstRefresh&&e&&!t)),n.isFirstRefresh=!1):i.reinitialize(),n.refreshAllWhenReady=!1}else i.size&&n.refreshResources(i);i.clear()}}else r.whenVisible("refresh",r,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:t,records:n=[],replaced:r,changes:i}){const s=this,{scheduler:o}=s,a=new Set(n.flatMap((e=>{var t,n;return[e.resourceId,...(null===(t=e.resource)||void 0===t||null===(n=t.$links)||void 0===n?void 0:n.map((e=>e.id)))??[]]})));if(!s.resourceStore.isRemoving&&!s.resourceStore.isChangingId)switch(t){case"dataset":return void(s.eventStore.usesSingleAssignment||(a.size?s.refreshResourcesWhenReady(a):(s.clearAll(),o.refreshWithTransition())));case"add":case"remove":case"updateMultiple":return void s.refreshResourcesWhenReady(a);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return r.forEach((([e,t])=>{a.add(e.resourceId),a.add(t.resourceId)})),void s.refreshResourcesWhenReady(a);case"filter":return s.clearAll(),o.calculateAllRowHeights(!0),void o.refreshWithTransition();case"update":("eventId"in i||"resourceId"in i||"id"in i)&&("resourceId"in i&&a.add(i.resourceId.oldValue),e===o.project.assignmentStore?s.refreshResourcesOnDataReady(a):s.refreshResources(a));break;case"clearchanges":{const{added:e,modified:t,removed:n}=i;t.length?o.refreshWithTransition():(e.forEach((e=>a.add(e.resourceId))),n.forEach((e=>a.add(e.resourceId))),s.refreshResourcesOnDataReady(a))}}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const t of this.client.getElementsFromEventRecord(e))t.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){if("batch"===e){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:s,source:o}){const a=this,{scheduler:l}=a,c=o.isResourceTimeRangeStore,d=new Set;if(l.isPainted)if(t.forEach((e=>{var t;const n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((e=>a.resourceStore.includes(e)));null==n||n.forEach((e=>d.add(e.id)))})),c){switch(e){case"removeall":case"dataset":return a.clearAll(),void l.refreshWithTransition()}a.refreshResources(d)}else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":return a.clearAll(),void l.refreshWithTransition();case"dataset":return a.clearAll(),void(l.isEngineReady?l.refreshWithTransition():a.refreshAllWhenReady=!0);case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>d.add(e.id)))}));break;case"removeall":case"filter":return l.isEngineReady?(a.clearAll(),l.calculateAllRowHeights(!0),void l.refreshWithTransition()):void(a.refreshAllWhenReady=!0);case"update":{const e=n.$entity?!Object.keys(s).some((e=>!n.$entity.getField(e))):!Object.keys(s).some((e=>!nD[e]));let t=0;if("startDate"in s&&t++,"endDate"in s&&t++,"duration"in s&&t++,"resourceId"in s&&d.add(s.resourceId.oldValue),d.size&&(!e||t&&(!("duration"in s)||1!==t)||"percentDone"in s||"inactive"in s||"constraintDate"in s||"constraintType"in s||"segments"in s)){var u,h;const{eventResize:e,eventDragCreate:t}=l.features;if(n.isBatchUpdating&&(null!=e&&e.isResizing&&e.lockLayout||null!=t&&t.isResizing&&t.lockLayout)){for(const e of d)a.refreshEventsForResource(l.resourceStore.getById(e),i,!1);a.onRenderDone()}else null!==(u=a.project)&&void 0!==u&&u.propagatingLoadChanges||null!==(h=a.project)&&void 0!==h&&h.isWritingData?a.refreshResourcesOnDataReady(d):a.refreshResources(d)}return}}a.refreshResourcesWhenReady(d)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:t,records:n,changes:r}){const i=this,s=null==n?void 0:n.flatMap((e=>e.isLinked?[e.id,e.$originalId]:[e.id]));if(i.scheduler.isPainted){switch(e){case"add":return void(t||(n.every((e=>e.isLinked))?i.refreshResources(s):i.refreshResourcesWhenReady(s)));case"update":return void(i.project.isChangeTrackingSuspended||r.isLeaf||i.refreshResources(s));case"filter":case"dataset":return;case"removeall":return void i.clearAll({clearLayoutCache:!0})}s&&i.clearResources(s)}}onTranslateRow({row:e}){null!=e.id&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var t,n;const{scheduler:r}=this,i=r.getResourceHeight(e),s=r.getEventLayout(e),o=s.type,a=null===(t=r.features.eventResize)||void 0===t?void 0:t.lockLayout;if("stack"===o&&r.isEngineReady&&!e.isSpecialRow&&(null===(n=e.assigned)||void 0===n?void 0:n.size)>1){const{assignmentStore:t,eventStore:n,timeAxis:i}=r,{barMargin:o,resourceMarginObject:{total:l},contentHeight:c}=r.getResourceLayoutSettings(e),d=(n.isFiltered||t.isFiltered)&&(n=>n.assignments.some((n=>n.resource===e.$original&&t.includes(n)))),u=n.getEvents({resourceRecord:e,includeOccurrences:r.enableRecurringEvents,startDate:i.startDate,endDate:i.endDate,filter:d}).sort(tD).map((t=>{var n;const r=t.isBatchUpdating&&!(a&&null!==(n=t.meta)&&void 0!==n&&n.isResizing),i=r?t.get("startDate"):t.startDate,s=r?t.get("endDate"):t.endDate||i;return{eventRecord:t,resourceRecord:e,startMS:i.getTime(),endMS:s.getTime()}})),h=r.getEventLayoutHandler(s),g=h.layoutEventsInBands(u,e,!0);return"layoutFn"===h.type?g:g*c+(g-1)*o+l}return i}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x,!0)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:t}=e;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.ion({name:"renderingSuspend",resumeRefresh({trigger:n}){t.isEngineReady&&n&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,t,n,r){t>r&&this.onRenderDone()}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,n=!0,r=!1,i=!1){const s=this.client.getElementFromAssignmentRecord(e,r,i),o=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=null==o?void 0:o.eventsData.find((t=>t.eventId===e.eventId));a&&(a[r?"wrapperCls":"cls"][t]=n),s&&(s.classList.toggle(t,n),s.lastDomConfig.className[t]=n)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e,t){var n,r;const i=this,{scheduler:s,scrollBuffer:o}=i,a=-1===o,{timeAxisSubGrid:l,timeAxis:c,rtl:d}=s,{width:u}=l,{totalSize:h}=s.timeAxisViewModel,g=e,m=0!==l.scrollable.maxX&&Math.abs(l.scrollable.maxX)<=Math.round(g)+5,p=a?c.startDate:s.getDateFromCoord({coord:Math.max(0,g-o),ignoreRTL:!0}),f=m||a?c.endDate:s.getDateFromCoord({coord:g+u+o,ignoreRTL:!0})||c.endDate;if(p&&!s._viewPresetChanging&&(!a||t||p-((null===(n=i._visibleDateRange)||void 0===n?void 0:n.startDate)||0)||f-((null===(r=i._visibleDateRange)||void 0===r?void 0:r.endDate)||0))){i._visibleDateRange={startDate:p,endDate:f,startMS:p.getTime(),endMS:f.getTime()},i.viewportCoords=a?{left:0,right:h}:d?{left:h-e-u+o,right:h-e-o}:{left:e-o,right:e+u+o};const t=s.timeView.range={startDate:p,endDate:f};if(s.internalOnVisibleDateRangeChange(t),!s.refreshSuspended&&s.rowManager.rows.length){if(null===s.rowManager.rows[0].id)return;i.fromScroll=!0,s.rowManager.rows.forEach((e=>i.refreshEventsForResource(e,!1,!1))),i.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach((e=>this.toDrawOnDataReady.add(e)))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:n}=this;if(this.clearResources(e),!n.refreshSuspended){const r=[],i=[];e.forEach((e=>{const t=n.getRowById(e);t?r.push(t):i.push(t)})),n.runWithTransition((()=>{n.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),n.rowManager.renderRows(r)}),t)}}layoutEventVerticallyStack(e,t,n){const{barMargin:r,resourceMarginObject:{start:i},contentHeight:s}=this.scheduler.getResourceLayoutSettings(n,t.parent);return 0===e?i:i+e*s+e*r}layoutEventVerticallyPack(e,t,n,r){const{barMargin:i,resourceMarginObject:{start:s},contentHeight:o}=this.scheduler.getResourceLayoutSettings(r,n.parent),a=1/t,l=e*a,c=(o-(a-1)*i)*t;return{top:s+l*c+l*i,height:c}}addTemporaryDragElement(e,t=e.resource){const{scheduler:n}=this,r=n.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:n.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(r),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const o=Br.createElement(i);return o.innerElement=o.firstChild,e.instanceMeta(n).hasTemporaryDragElement=!0,o}eventSorter(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);const n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}calculateMS(e,t,n,r,i){var s,o;const{scheduler:a}=this,{timeAxisViewModel:l}=a;let c=rD(a,e,!1,t,r),d=rD(a,e,!0,n,r),u=d-c;if("default"!==a.milestoneLayoutMode&&0===u){const t=l.getSingleUnitInPixels("minute");if(u=60*(a.getMilestoneLabelWidth(e,i)*(1/t))*1e3,"always-outside"===a.milestoneTextPosition){c-=a.getResourceLayoutSettings(i,e.parent).contentHeight*(1/t)*60*1e3/2,d=c+u}else switch(a.milestoneAlign){case"start":case"left":d=c+u;break;case"end":case"right":d=c,c=d-u;break;default:d=c+u/2,c=d-u}}const h=c,g=d,m=u;return null!==(s=e.meta)&&void 0!==s&&s.isResizing&&null!==(o=a.features.eventResize)&&void 0!==o&&o.lockLayout&&(c=e.startDate.getTime(),d=e.endDate.getTime(),u=g-h),{startMS:c,endMS:d,durationMS:u,elementStartMS:h,elementEndMS:g,elementDurationMS:m}}setupRenderData(e,t){var n;const r=this,{scheduler:i}=r,{timeAxis:s,timeAxisViewModel:o}=i,{preamble:a,postamble:l}=e,c=r.isProHorizontalRendering&&(null===(n=i.features.eventBuffer)||void 0===n?void 0:n.enabled)&&(a||l)&&!e.isMilestone,d=o.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=c?"wrapStartDate":"startDate",g=c?"wrapEndDate":"endDate",m=u&&!c?e.get(h):e[h],p=u&&!c?e.get(g):e[g]||m,f=s.startMS,v=s.endMS,y=r.calculateMS(e,h,g,c,t),{startMS:b,endMS:C,durationMS:S}=y,D=b<f|(b>v)<<1,w=C>v|(C<=f)<<1,E=w?d*(S/6e4):null,x=i.getRowById(t);return{eventRecord:e,taskRecord:e,start:m,end:p,rowId:t.id,children:[],startsOutsideView:D,endsOutsideView:w,width:E,row:x,useEventBuffer:c,...y}}fillTimeSpanHorizontalPosition(e){const{elementStartMS:t,elementEndMS:n,elementDurationMS:r}=e,i=null!=t&&null!=n&&this.calculateHorizontalPosition(e,t,n,r);return!!i&&(Object.assign(e,i),!0)}calculateHorizontalPosition(e,t,n,r){const{scheduler:i}=this,{timeAxis:s,timeAxisViewModel:a}=i,{startsOutsideView:l,endsOutsideView:c,eventRecord:d}=e,u=s.startMS,h=a.getSingleUnitInPixels("minute");let g,m=null,p=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0}),f=!1,v=!1;if(l?(g=(t-u)/6e4*h,i.rtl&&(g=a.totalSize-g)):(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==p}),f=-1===g),c){const e=a.totalSize-g,t=(n-s.endMS)/6e4;m=i.rtl?h*r/6e4:e+h*t,p=o.isSafari&&i.features.stickyEvents&&s.endMS?i.getCoordinateFromDate(s.endMS):g+m*(i.rtl?-1:1)}else v=-1===p;return v&&!f&&(p=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),m>eD&&(1===l?1===c?(g=-100,p=i.timeAxisColumn.width+100):g=p-eD:1===c&&(p=g+eD)),f&&v&&(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:n}),p=i.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}),g===p)?(d.instanceMeta(i).excluded=!0,null):{left:Math.min(g,p),width:Math.abs(p-g)||(d.isMilestone&&!d.meta.isDragCreating?0:6),clippedStart:f,clippedEnd:v}}fillTimeSpanVerticalPosition(e,t){const{scheduler:n}=this,{start:r,end:i}=e,{resourceMarginObject:{start:s},contentHeight:o}=n.getResourceLayoutSettings(t);n.fillTicks&&(e.dataStartMS=r.getTime(),e.dataEndMS=i.getTime()),e.top=Math.max(0,s),n.managedEventSizing&&(e.height=o)}getTimeSpanRenderData(e,t,n=!1){const r=this.setupRenderData(e,t);return this.fillTimeSpanHorizontalPosition(r)?(this.fillTimeSpanVerticalPosition(r,t),r):null}layoutEvents(e,t,n=!1,r,i){const{scheduler:s}=this,{timeAxis:o}=s,a=t.reduce(((t,r)=>{if(n||o.isTimeSpanInAxis(r)){const i=s.generateRenderData(r,e,n);i&&t.push(i)}return t}),[]);a.sort(i??this.eventSorter);let l=s.getAppliedResourceHeight(e,r);const c=a.filter((({eventRecord:e})=>e.isEvent&&!e.meta.excludeFromLayout)),d=s.getEventLayout(e,r),u=s.getEventLayoutHandler(d);if(u){const{barMargin:t,resourceMarginObject:{total:n},contentHeight:i}=s.getResourceLayoutSettings(e,r),o=u.applyLayout(c,e)||1;l="layoutFn"===u.type?o:o*i+(o-1)*t+n}else if(c.length>0)for(let e=0;e<c.length;e++){c[e].wrapperStyle+=`;z-index:${e+5}`}return{rowHeight:l,eventsData:a}}layoutResourceEvents(e,t=!1){const{scheduler:n}=this,{eventStore:r,assignmentStore:i,timeAxis:s}=n,o=r.getEvents({includeOccurrences:n.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||r.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e.$original&&i.includes(t))))}),a=n.getEventsToRender(e,o)||[];return this.layoutEvents(e,a,t)}renderEvent(e,t){const{scheduler:n}=this,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=e,o=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,a={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},l={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[a,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?t:e.height,width:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:r.isLinked?`${o}_${r.id}`:o},elementData:e,retainElement:(null==i?void 0:i.instanceMeta(n).retainElement)||s.instanceMeta(n).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=t),e.zIndex&&(l.zIndex=e.zIndex),i&&(l.dataset.assignmentId=i.id),e.elementConfig=l,n.afterRenderEvent({renderData:e,rowHeight:t,domConfig:l}),l}refreshEventsForResource(e,t=!0,n=!0){const r=this,i=r.scheduler.store.getById(e.isRow?e.id:e),s=r.scheduler.rowManager.getRowFor(i);t&&r.clearResources([i]),s&&i&&(r.renderer({row:s,record:i}),t&&n&&r.onRenderDone())}getResourceLayout(e){const t=this;let n=t.resourceMap.get(e.id);if(!n||n.invalid){if(t.suspended)return;n=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,n)}return n}getEventDOMConfigForCurrentView(e,t,n,r){const i=this,{bufferSize:s,scheduler:o}=i,{labels:a,eventBuffer:l}=o.features,c=(null==l?void 0:l.enabled)||(null==a?void 0:a.enabled)&&(a.left||a.right||a.before||a.after),{eventsData:d}=e,u=i.fromScroll?i.rowMap.get(t):null,h=[];let g,m;for(let o=0;o<d.length;o++){const a=d[o];if(g=n,m=r,(c||0===a.width)&&(g-=s,m+=s),a.left+a.width>=g&&a.left<=m){a.absoluteTop=a.top+t.top;const n=null==u?void 0:u.find((e=>e.elementData.eventId===a.eventId&&e.elementData.resourceId===a.resourceId));h.push(n??i.renderEvent(a,e.rowHeight))}}return h}renderer({row:e,record:t,size:n={}}){const r=this;if(t.isSpecialRow)return void r.rowMap.delete(e);const{left:i,right:s}=r.viewportCoords,o=r.getResourceLayout(t);if(!o)return;n.height=o.rowHeight,n.transient=!0;const a=r.getEventDOMConfigForCurrentView(o,e,i,s);r.rowMap.set(e,a),r.rendererCalled=!0}onRenderDone(){const{scheduler:e,rowMap:t,verticalBufferSize:n}=this,r=[],i=e._scrollTop??0,s=i-n,o=i+e._bodyRectangle.height+n,a=n<0,l=!e.managedEventSizing;t.forEach(((e,t)=>{if(a||t.bottom>s&&t.top<o)for(let t=0;t<e.length;t++){const n=e[t],i=n.elementData,{absoluteTop:c,eventRecord:d}=i;(a||l||d.meta.isDragCreating||d.meta.isResizing||c+i.height>s&&c<o)&&r.push(n)}for(let t=0;t<e.length;t++)e[t]={...e[t]}})),this.fromScroll=!1,this.visibleEventDOMConfigs=r,To.sync({domConfig:{onlyChildren:!0,children:r},targetElement:e.foregroundCanvas,syncIdField:"syncId",callback({action:t,domConfig:n,lastDomConfig:r,targetElement:i,jsx:s}){var o,a;const{reactComponent:l}=e,c=JS[t],d=QS[t];if(!c&&(null===(o=e.processEventContent)||void 0===o||o.call(e,{jsx:s,action:t,domConfig:n,targetElement:i,isRelease:c,reactComponent:l})),"none"!==t&&null!=n&&null!==(a=n.elementData)&&void 0!==a&&a.isWrap){if(c&&null!=r&&r.elementData){var u;const{eventRecord:t,resourceRecord:n,assignmentRecord:s}=r.elementData,o={renderData:r.elementData,element:i,eventRecord:t,resourceRecord:n,assignmentRecord:s};null===(u=e.processEventContent)||void 0===u||u.call(e,{isRelease:c,targetElement:i,reactComponent:l,assignmentRecord:s}),i===Br.getActiveElement(i)&&e.focusElement.focus(),e.trigger("releaseEvent",o)}if(d){const{eventRecord:r,resourceRecord:s,assignmentRecord:o}=n.elementData,a={renderData:n.elementData,element:i,isReusingElement:"reuseElement"===t,isRepaint:"reuseOwnElement"===t,eventRecord:r,resourceRecord:s,assignmentRecord:o};"reuseElement"===t&&e.isAnimating&&Br.addTemporaryClass(i,"b-reusing-own",50,e,`b-reusing-own-${(o||r).id}`),e.trigger("renderEvent",a)}}}})}clearResources(e){(e=H.asArray(e)).map(ds.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const n=this.scheduler.getRowById(e);n&&this.rowMap.delete(n)}))}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const n=this,{layouts:r,foregroundCanvas:i}=n.scheduler;if(t&&r)for(const e in r)r[e].clearCache();if(i&&e){i.syncIdMap=i.lastDomConfig=i.releasedIdMap=null;for(const e of i.children)e.lastDomConfig=e.elementData=null}n.resourceMap.clear(),n.rowMap.clear()}}iD._$name="HorizontalRendering";class sD extends(AS()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,n,r,i,s,o){const a=this,l=o.type;return a.packEventsInBands(e,((e,s,o,c)=>{if("none"===l)e.width=t-r,e.left+=n;else{e.widthFactor=c;const a=e.leftFactor=o.start+s*c,d=Math.round(1/c),u=a/c,h=t-r-i*(d-1);"mixed"===l&&2===d?(e.left+=a*t/5+i,e.width=t-a*t/5-2*i,e.zIndex=5+u):(e.width=c*h,e.left+=a*h+n+i*u)}e.cls["b-sch-event-narrow"]=e.width<a.scheduler.narrowEventWidth}))}}sD._$name="VerticalLayout";const oD={releaseElement:1,reuseElement:1},aD={newElement:1,reuseOwnElement:1,reuseElement:1},lD={startDate:1,endDate:1,duration:1},cD=Object.freeze({});class dD extends(ye.mixin(mi,ZS)){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new sD({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t,resourceColumns:n}=e;n.resourceStore=e.resourceStore,n.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),n.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const n=this,{scheduler:r}=n,i=e.nodeType?null:e,s=i?i.target:e,o=i?[i.borderOffsetX,i.borderOffsetY]:t,a=(s.nodeType===Element.TEXT_NODE?s.parentElement:s).closest(r.eventSelector);if(a)return r.resourceStore.getById(a.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!o)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");if(r.variableColumnWidths||r.resourceStore.isGrouped){let e=0;for(const t of n.resourceStore)if(t.isSpecialRow||(e+=t.columnWidth||n.resourceColumns.columnWidth),e>=o[0])return t;return null}const l=Math.floor(o[0]/n.resourceColumns.columnWidth);return n.allResourceRecords[l]}toggleCls(e,t,n=!0,r=!1){var i;const s=null===(i=this.eventMap.get(e.eventId))||void 0===i?void 0:i[e.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][t]=n;const i=this.client.getElementFromAssignmentRecord(e,r);i&&i.classList[n?"add":"remove"](t)}}getDateFromXY(e,t,n,r=!1){let i=e[1];return n||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-r.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+r.scrollY}getResourceEventBox(e,t){var n;const r=e.id,i=t.id;let{renderData:s}=(null===(n=this.eventMap.get(r))||void 0===n?void 0:n[i])||cD;var o,a;s||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(i)),s=null===(o=this.eventMap.get(r))||void 0===o||null===(a=o[i])||void 0===a?void 0:a.renderData);return s?new wn(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(e,t,n){var r;const i=this,{scheduler:s}=i,o=wn.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(o.left=i.allResourceRecords.indexOf(e)*s.resourceColumnWidth,o.right=o.left+s.resourceColumnWidth);const a=s.timeAxis.startDate,l=s.timeAxis.endDate,c=(null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,e,t))||{start:a,end:l},d=s.getCoordinateFromDate(Gt.max(a,c.start)),u=s.getCoordinateFromDate(Gt.min(l,c.end));return n?(o.top=d,o.bottom=u):(o.top=i.translateToPageCoordinate(d),o.bottom=i.translateToPageCoordinate(u)),o}getRowRegion(e,t,n){const{scheduler:r}=this,i=this.allResourceRecords.indexOf(e)*r.resourceColumnWidth,s=r.timeAxis.startDate,o=r.timeAxis.endDate,a=t?Gt.max(s,t):s,l=n?Gt.min(o,n):o,c=r.getCoordinateFromDate(a),d=r.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new wn(i,u,r.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight,r=e.getDateFromCoordinate(t)||e.timeAxis.startDate,i=e.getDateFromCoordinate(t+n)||e.timeAxis.endDate;return{startDate:r,endDate:i,startMS:r.getTime(),endMS:i.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:t}){const n=this,{scheduler:r}=n;n.resourceColumns.width=r.timeAxisColumn.width=n.allResourceRecords.length*e,n.clearAll(),n.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:n}=e;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):n.size&&e.refresh(),n.clear()):t.whenVisible("refresh",t,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const t of this.client.getElementsFromEventRecord(e))t.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:i,isAssign:s}){const o=this,a=new Set;switch(t.forEach((e=>{var t;const n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((e=>o.resourceStore.includes(e)));null==n||n.forEach((e=>a.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":case"batch":return;case"dataset":return void o.refreshAllResourcesWhenReady();case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>a.add(e.id)))})),o.clearResources(a);break;case"removeall":case"filter":return o.clearAll(),void o.refresh();case"update":{let e=0;return"startDate"in i&&e++,"endDate"in i&&e++,"duration"in i&&e++,void((!(n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!lD[e])))||e||"percentDone"in i||"inactive"in i||"segments"in i)&&(o.shouldWaitForInitializeAndEngineReady?o.refreshResourcesWhenReady(a):(o.clearResources(a),o.refresh())))}}o.refreshResourcesWhenReady(a)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&t.scheduler.isPainted&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:n=[],record:r,replaced:i,changes:s}){const o=this,a=i?i.map((e=>e[1])):n,l=new Set(a.map((e=>e.id)));o.firstResource=o.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:c}=e;if(o.scheduler.isEngineReady){switch(t){case"update":null!=s&&s.id?o.clearResources([s.id.oldValue,s.id.value]):o.clearResources([r.id]);break;case"filter":o.clearAll()}s&&"columnWidth"in s&&o.clearAll(),o.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void o.refreshAllResourcesWhenReady();case"replace":case"add":if(!e.isGrouped){const e=a.reduce(((e,t)=>Math.min(e,c.indexOf(t))),c.length);for(let t=e;t<c.length;t++)l.add(c[t].id)}}o.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;"sort"!==e&&"group"!==e||(t.firstResource=t.lastResource=t.resourceStore._allResourceRecords=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:n,changes:r}){const i=this,s=new Set(t.map((e=>e.resourceId)));if(i.scheduler.isEngineReady){switch(e){case"remove":i.clearResources(s);break;case"filter":i.clearAll();break;case"update":if("resourceId"in r&&s.add(r.resourceId.oldValue),!Object.keys(r).filter((e=>"resource"!==e&&"event"!==e)).length)return;i.clearResources(s)}i.refresh(!0)}else{switch(r&&"resourceId"in r&&s.add(r.resourceId.oldValue),e){case"removeall":return void i.refreshAllResourcesWhenReady();case"replace":n.forEach((([e,t])=>{s.add(e.resourceId),s.add(t.resourceId)}))}i.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:n}=this,r=this.allResourceRecords.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){var e;return null===(e=this.scheduler.timeAxisColumn)||void 0===e?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[t]}}getResourceRange(e){const{scheduler:t,resourceStore:n}=this,{resourceColumnWidth:r,scrollX:i}=t,{scrollWidth:s}=t.timeAxisSubGrid.scrollable,o=e?this.resourceBufferSize:0,a=i-o,l=i+s+o;if(null==n||!n.count)return{first:-1,last:-1};if(t.variableColumnWidths){let e,n,r=0,i=0;return this.allResourceRecords.forEach(((s,o)=>{if(s.instanceMeta(t).insetStart=n=i,i=n+s.columnWidth,n>l)return!1;i>a&&null==e?e=o:n<l&&(r=o)})),{first:e,last:r}}return{first:Math.max(Math.floor(i/r)-o,0),last:Math.min(Math.floor((i+t.timeAxisSubGrid.width)/r)+o,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let n=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return n||(n=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:n,bottomDate:t}}getTimeSpanRenderData(e,t,n=!1){var r;const i=this,{scheduler:s}=i,{preamble:o,postamble:a}=e,{variableColumnWidths:l}=s,c=(null===(r=s.features.eventBuffer)||void 0===r?void 0:r.enabled)&&i.isProVerticalRendering&&(o||a)&&!e.isMilestone,d=c?"wrapStartDate":"startDate",u=c?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(d)&&!c?e.get(d):e[d],g=e.isBatchUpdating&&e.hasBatchedChange(u)&&!c?e.get(u):e[u],{resourceMarginObject:{total:m}}=s.getResourceLayoutSettings(t),p=s.getCoordinateFromDate(h),f=t.instanceMeta(s),v=l?f.insetStart:i.allResourceRecords.indexOf(t)*s.resourceColumnWidth,y=s.getResourceWidth(t),b=y-m,C=h.getTime(),S=g.getTime();let D=s.getCoordinateFromDate(g),w=D-p;return-1===D&&(w=Math.round((S-C)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),D=p+w),{eventRecord:e,resourceRecord:t,left:v,top:p,bottom:D,resourceWidth:y,width:b,height:w,startDate:h,endDate:g,startDateMS:C,endDateMS:S,useEventBuffer:c,children:[],start:h,end:g,startMS:C,endMS:S}}eventSorter(e,t){const n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}layoutEvents(e,t,n=!1,r,i){const s=this,{scheduler:o}=s,{variableColumnWidths:a}=o,{id:l}=e,c=e.instanceMeta(o),d=r?`${l}-${r.id}`:l,u=s.resourceMap.set(d,{}).get(d),h=s.allResourceRecords.indexOf(e),{barMargin:g,resourceMarginObject:{start:m,total:p}}=o.getResourceLayoutSettings(e,r),f=t.reduce(((t,n)=>{if(n.isScheduled){const r=o.generateRenderData(n,e,!1),i={renderData:r};Xt.getMapPath(s.eventMap,r.eventId,{})[l]=i,u[r.eventId]=i,r.fillSize?(r.left=a?c.insetStart:h*o.resourceColumnWidth,r.width=o.getResourceWidth(e)):t.push(r)}return t}),[]);return f.sort(i??s.eventSorter),s.verticalLayout.applyLayout(f,o.getResourceWidth(e,r),m,p,g,h,o.getEventLayout(e,r)),u}layoutResourceEvents(e){const{scheduler:t}=this,{assignmentStore:n,eventStore:r,timeAxis:i}=t;let s=r.getEvents({includeOccurrences:t.enableRecurringEvents,resourceRecord:e,startDate:i.startDate,endDate:i.endDate,filter:(n.isFiltered||r.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&n.includes(t))))});return s=t.getEventsToRender(e,s),this.layoutEvents(e,s)}addTemporaryDragElement(e){const{scheduler:t}=this,n=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});n.top=n.row?n.top+n.row.top:t.getResourceEventBox(e,e.resource,!0).top;const r=this.renderEvent({renderData:n}),{dataset:i}=r;delete r.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=Br.createElement(r);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:t}=this,n=e.renderData,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=n,o={className:n.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:n.cls,style:(n.internalStyle||"")+(n.style||""),children:n.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...n.wrapperChildren],style:{top:n.top,[t.rtl?"right":"left"]:n.left,height:s.isMilestone?"1em":n.height,width:n.width,style:n.wrapperStyle||"",fontSize:s.isMilestone?Math.min(n.width,40):null},dataset:{resourceId:r.id,eventId:n.eventId,syncId:i?this.assignmentStore.getOccurrence(i,s).id:n.eventId},elementData:e,retainElement:(i||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return o.className["b-sch-vertical"]=1,n.zIndex&&(o.zIndex=n.zIndex),i&&(o.dataset.assignmentId=i.id),n.elementConfig=e.elementConfig=o,t.afterRenderEvent({renderData:n,domConfig:o}),o}renderResource(e){const t=this,{topDateMS:n,bottomDateMS:r}=t,i=[];let s=t.resourceMap.get(e.id);s||(s=t.layoutResourceEvents(e));for(const e in s){const a=s[e],{endDateMS:l,startDateMS:c,eventRecord:d}=a.renderData;if(l>=n&&c<=r&&!d.instanceMeta(t.scheduler).hasTemporaryDragElement){var o;const e="b-released"!==(null===(o=a.elementConfig)||void 0===o?void 0:o.className)&&a.elementConfig||t.renderEvent(a);i.push(e)}}return i}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const e=this,{scheduler:t}=e,{first:n,last:r}=e.resourceRange,{topDate:i,bottomDate:s}=e.dateRange,o=[],a=[];if(!e.shouldWaitForInitializeAndEngineReady){if(!Gt.isEqual(i,e.topDate)||!Gt.isEqual(s,e.bottomDate)){e.topDate=i,e.bottomDate=s,e.topDateMS=i.getTime(),e.bottomDateMS=s.getTime();const n=e.timeView.range={startDate:i,endDate:s};t.internalOnVisibleDateRangeChange(n)}if(-1!==n&&-1!==r)for(let t=n;t<=r;t++)o.push.apply(o,e.renderResource(e.allResourceRecords[t]));if(t.getForegroundDomConfigs(a),o.push.apply(o,a),To.sync({domConfig:{onlyChildren:!0,children:o},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:n,domConfig:r,lastDomConfig:i,targetElement:s,jsx:o}){var a;const{reactComponent:l}=t;if(e.isEventElement(r)||o||null!=r&&null!==(a=r.elementData)&&void 0!==a&&a.jsx){var c;const a=oD[n],u=aD[n];if(null!==(c=t.processEventContent)&&void 0!==c&&c.call(t,{action:n,domConfig:r,isRelease:!1,targetElement:s,reactComponent:l,jsx:o}))return;if(a&&e.isEventElement(i)&&!i.isReleased){var d;const e=i.elementData.renderData,n={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s};null===(d=t.processEventContent)||void 0===d||d.call(t,{isRelease:a,targetElement:s,reactComponent:l,assignmentRecord:e.assignmentRecord}),s===Br.getActiveElement(s)&&t.focusElement.focus(),t.trigger("releaseEvent",n)}if(u){const e=r.elementData.renderData,i={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s,isReusingElement:"reuseElement"===n,isRepaint:"reuseOwnElement"===n};i.reusingElement="reuseElement"===n,t.trigger("renderEvent",i)}}}}),e.firstResource!==n||e.lastResource!==r){const i=e.resourceColumns.visibleResources={firstResource:n,lastResource:r};e.firstResource=n,e.lastResource=r,t.onVisibleResourceRangeChange(i),t.trigger("resourceRangeChange",i)}}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,t=!0,n=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:n}=this;e.forEach((e=>{t.has(e)&&(Object.values(t.get(e)).forEach((({renderData:{eventId:t}})=>{delete n.get(t)[e]})),t.delete(e))}))}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}function uD(e,t){return e===t.length-1}function hD(e,t){return t===e.cells[e.cells.length-1]}dD._$name="VerticalRendering";class gD extends ba{static $name="TimeAxisBase";static configurable={compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null};startDate=null;endDate=null;levels=[];size=null;set range({startDate:e,endDate:t}){const n=this;if(n.startDate-e||n.endDate-t){var r;const{client:i}=n;if(n.startDate=e,n.endDate=t,"width"===n.sizeProperty&&null!=i&&i.hideHeaders||"height"===n.sizeProperty&&null!=i&&null!==(r=i.verticalTimeAxisColumn)&&void 0!==r&&r.hidden)return;n.refresh()}}buildCells(e=this.startDate,t=this.endDate){var n;const i=this,{sizeProperty:s}=i,{stickyHeaders:o,isVertical:a}=i.client||{},l=[],{length:c}=i.levels,d=i.levels.map(((n,l)=>{var d;const u=o&&(a||l<c-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${n.position}`]:1,"b-sch-header-row-main":l===i.model.viewPreset.mainHeaderLevel,"b-lowest":uD(l,i.levels),"b-sticky-header":u},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${l}`,headerPosition:n.position},children:null===(d=n.cells)||void 0===d?void 0:d.filter((n=>n.start<t&&n.end>e)).map(((e,t)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,[`b-align-${e.align}`]:e.align,"b-last":hD(n,e)},dataset:{tickIndex:e.index,...r.DEBUG&&{date:e.start.getTime()}},style:{[i.positionProperty]:e.coord,[s]:e.width,[`min-${s}`]:e.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":u},html:e.value}]})))}}));return null===(n=i.client)||void 0===n||n.getHeaderDomConfigs(l),d.push(...l),{onlyChildren:!0,syncOptions:{releaseThreshold:0},children:d}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:n}=t.model,{levels:r}=t,i=r.length;if(e){r.length=0,n.forEach(((e,t)=>r[t]={position:t,cells:e})),t.size=r[0].cells.reduce(((e,t)=>e+t.width),0);const{parentElement:s}=t.element;s&&(r.length!==i||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${i}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}t.startDate&&t.endDate&&(To.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}gD._$name="TimeAxisBase";class mD extends gD{static $name="HorizontalTimeAxis";static type="horizontaltimeaxis";static configurable={model:null,sizeProperty:"width"};get positionProperty(){var e;return null!==(e=this.owner)&&void 0!==e&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){var e;(null===(e=this.owner)||void 0===e||!e.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}mD._$name="HorizontalTimeAxis";class pD extends ba{static $name="ResourceHeader";static type="resourceheader";static configurable={resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null};firstResource=-1;lastResource=-1;construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),null!=t.imagePath&&t.element.classList.add("b-has-images"),Zn.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new of({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:n}=t,r=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),r!==t.width&&(Br.setLength(n,"width",r),t.column.set("width",r,t.column.grid.isConfiguring)),"removeall"===e&&(n.innerHTML=""),("remove"===e||"add"===e||"filter"===e||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach((n=>{n.instanceMeta(t).insetStart=e,n.instanceMeta(t).insetEnd=e+(n.columnWidth||t.resourceColumnWidth),null==n.columnWidth?e+=t.resourceColumnWidth:(e+=n.columnWidth,t.variableColumnWidths=!0)})),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const n=this;n.refreshingWidths||n.refreshWidths(),n.isConfiguring||(n.resourceStore.isGrouped&&n.updateWidthCache(),n.refresh(),n.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return $.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:n,configuredColumnWidth:r}=t,i=null===(e=t.resourceStore)||void 0===e?void 0:e.count;if(!n||!i||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const s=t.fitWidth||t.fillWidth&&r*i<n?Math.floor(n/i):r,o=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-s)>30;Br.addTemporaryClass(t.element,"b-animating",o?300:0,t),t.columnWidth=s,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:n,resourceStore:r,lastResource:i}=e,{variableColumnWidths:s}=n,o=r.isGrouped&&r.groupers[0].field,a=[];if(e.element.classList.toggle("b-grouped",Boolean(o)),!e.column.grid.isConfiguring&&t>-1&&i>-1&&i<r.count){let u;for(let h=t;h<=i;h++){var l,c;const t=r.allResourceRecords[h],i=null===(l=t.groupParent)||void 0===l?void 0:l.get(r.id),g=null==i?void 0:i.groupChildren;if(o&&i.id!==(null===(c=u)||void 0===c?void 0:c.dataset.resourceId)){const e=g[0].instanceMeta(n).insetStart,t=g[g.length-1].instanceMeta(n).insetEnd-e;u={className:"b-resourceheader-group-cell",dataset:{resourceId:i.id},style:{left:e,width:t},children:[{tag:"span",html:$.encodeHtml(g[0][o])},{className:"b-resourceheader-group-children",children:[]}]},a.push(u)}const m=t.instanceMeta(n),p=t.columnWidth||e.columnWidth,f=o?m.insetStart-u.style.left:s?m.insetStart:h*e.columnWidth,v={className:new Tn({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{[n.rtl?"right":"left"]:f,width:p},children:[]};if(e.headerRenderer){const n=e.headerRenderer({elementConfig:v,resourceRecord:t});n&&("string"==typeof n?v.html=n:"object"==typeof n&&(v.children=[n]))}else{let n;if(t.imageUrl)n=t.imageUrl;else if(null!=e.imagePath&&!1!==t.image){var d;const r=t.image||(null===(d=t.name)||void 0===d?void 0:d.toLowerCase())+e.imageExtension;n=e.getImageURL(r)}v.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:n}),{tag:"span",className:"b-resource-name",html:$.encodeHtml(t.name)})}o?u.children[1].children.push(v):a.push(v)}}To.sync({domConfig:{onlyChildren:!0,children:a},targetElement:e.element,syncIdField:"resourceId",callback:({jsx:e,targetElement:t,domConfig:r})=>{var i;null===(i=n.processResourceHeader)||void 0===i||i.call(n,{jsx:e,targetElement:t,domConfig:r})}})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),n=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+$.capitalize(e.type),{resourceRecord:n,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}pD._$name="ResourceHeader";class fD extends(Ge(cf)){headerHoverable=!1;static $name="TimeAxisColumn";static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;super.construct(...arguments),t.thisObj=t,t.grid._timeAxisColumn=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(t=this.timeAxisView)||void 0===t||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:n}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new mD({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:n,client:n}):"vertical"===e&&(t.resourceColumns=pD.new({column:t,scheduler:n,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,imageExtension:n.resourceImageExtension,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;t.grid.timeAxisSubGrid.collapsed||("horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows())}onTimelinePaint({firstPaint:e}){const t=this;var n;t.subGrid.insertRowsBefore&&(e&&(t.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===t.mode&&(t.refreshHeader(),null===(n=t.grid)||void 0===n||n.onHeightChange())))}refreshHeader(e){const t=this,{element:n}=t;n&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(i,i,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(n.innerHTML="",t.timeAxisView.render(n))):"vertical"===t.mode&&(t.resourceColumns.currentElement?t.resourceColumns.refresh():(n.innerHTML="",t.resourceColumns.render(n))))}internalRenderer(e){const{grid:t}=this;return t.project.isInitialCommitPerformed||t.project.isDelayingCalculation?(t.currentOrientation.renderer(e),super.internalRenderer(e)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}}id.registerColumnType(fD),fD._$name="TimeAxisColumn";class vD extends gD{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,n=null==t?void 0:t.stickyHeaders,i=[],s=e.levels.reduce(((t,i,s)=>{var o;i.cells&&t.push(...null===(o=i.cells)||void 0===o?void 0:o.filter((t=>t.start<e.endDate&&t.end>e.startDate)).map(((t,i,o)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[t.headerCellCls]:t.headerCellCls,[`b-align-${t.align}`]:t.align,"b-last":i===o.length-1,"b-lowest":s===e.levels.length-1},dataset:{tickIndex:t.index,cellId:`${s}-${t.index}`,headerPosition:s,...r.DEBUG&&{date:t.start.getTime()}},style:{top:t.coord,height:t.width,minHeight:t.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":n},html:t.value}]}))));return t}),[]);return null==t||t.getHeaderDomConfigs(i),s.push(...i),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:s}}get height(){return this.size}}vD._$name="VerticalTimeAxis";class yD extends td{static $name="VerticalTimeAxisColumn";static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new vD({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.id,delete t.region,delete t.type,delete t.field,delete t.ariaLabel,delete t.cellAriaLabel,t}}id.registerColumnType(yD),yD._$name="VerticalTimeAxisColumn";const bD={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"};class CD extends(ry.mixin(XS,xS,RS,TS,_S,BS,NS,OS,VS,zS,qS,DS,KS)){static $name="SchedulerBase";static type="schedulerbase";static configurable={date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore",showEventColorPickers:null,updateTimelineContextOnScroll:!0};static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:bS,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}timeCellSelector=".b-sch-timeaxis-cell";resourceTimeRangeSelector=".b-sch-resourcetimerange";afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const n=this;return n.isVertical?n.currentOrientation.visibleResources:{first:n.store.getById(null===(e=n.firstVisibleRow)||void 0===e?void 0:e.id),last:n.store.getById(null===(t=n.lastVisibleRow)||void 0===t?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:t,row:n}){this.createEvent(e,t,n)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),"horizontal"===e?(t.horizontal=new iD(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new dD(t),t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return Boolean(this.eventEditingFeature)}get eventEditingFeature(){const{eventEdit:e,taskEdit:t,simpleEventEdit:n}=this.features;return null!=e&&e.enabled?e:null!=t&&t.enabled?t:null!=n&&n.enabled?n:null}editEvent(e,t,n){const r=this,{eventStore:i,assignmentStore:s}=r;if(!r.hasEventEditor)return!1;if(e.eventStore!==i){const{enableEventAnimations:n}=r,o=[];e.isCreating=!0;let a=[];if(t&&(o.push(t),a=s.assignEventToResource(e,t)),!1===r.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,assignmentRecords:a}))return null==s||s.remove(a),!1;r.enableEventAnimations=!1,i.add(e),r.project.commitAsync().then((()=>r.enableEventAnimations=n)),r.refreshRows()}}async createEvent(e,t){var n;const r=this,{enableEventAnimations:i,eventStore:s,assignmentStore:o,hasEventEditor:a}=r,l=[t],c=r.createEventOnDblClick.useEventModelDefaults,d=c?s.modelClass.defaultValues.duration:1,u=c?s.modelClass.defaultValues.durationUnit:r.timeAxis.unit,h=s.createRecord({startDate:e,endDate:Gt.add(e,d,u),duration:d,durationUnit:u,name:r.L("L{Object.newEvent}")});if(r.readOnly||t.isSpecialRow||t.readOnly||!r.allowOverlap&&!r.isDateRangeAvailable(h.startDate,h.endDate,null,t))return;null===(n=r.eventEditingFeature)||void 0===n||n.captureStm(!0),h.isCreating=a,r.onEventCreated(h);const g=null==o?void 0:o.assignEventToResource(h,t);var m;if(!1===r.trigger("beforeEventAdd",{eventRecord:h,resourceRecords:l,assignmentRecords:g}))return null==o||o.remove(g),void(null===(m=r.eventEditingFeature)||void 0===m||m.freeStm(!1));r.enableEventAnimations=!1,s.add(h),r.project.commitAsync().then((()=>r.enableEventAnimations=i)),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,await r.scrollEventIntoView(h),r.trigger("eventAutoCreated",{eventRecord:h,resourceRecord:t}),a&&r.editEvent(h,t,r.getEventElement(h))}isDateRangeAvailable(e,t,n,r){return this.eventStore.isDateRangeAvailable(e,t,n,r)}async resumeRefresh(e=_.checkVersion("core","6.0",">="),t=!0){super.resumeRefresh(!1);const n=this;if(!n.refreshSuspended&&e){if(!n.isEngineReady)return n.currentOrientation.refreshAllWhenReady=!0,n.project.commitAsync();n.isDestroyed||(t?n.refreshWithTransition():n.refresh())}}toggleEmptyText(){const e=this;var t;e.bodyContainer&&Br.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.resourceStore.count>0||null!==(t=e.crudManager)&&void 0!==t&&t.isLoading))}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){const{store:n}=this;for(const t of e)t&&n.isAvailable(t)&&this.getRowHeight(t);t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:n}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){n.clearKnownHeights();for(let e=0;e<r;e++)this.getRowHeight(t.getAt(e));e||n.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return"week"===e.range&&t.push(e.lastDate),t}get defaultDescriptionFormat(){return bD[this.range]}get lastDate(){const e=this.endDate;return e&&Gt.add(e,-1,"day")}getEventRecord(e){return e=Br.getEventElement(e),this.resolveEventRecord(e)}getResourceRecord(e){return this.resolveResourceRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return Gt.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const t=this.date,n=this.date=Gt.startOf(t,e);t.getTime()===n.getTime()&&this.updateDate(n)}}changeStepUnit(e){return Gt.normalizeUnit(e)}updateDate(e){const t=this,n=Gt.startOf(e,t.range);t.setTimeSpan(n,Gt.add(n,1,t.range)),t.visibleDate={date:Gt.max(e,t.timeAxis.startDate),block:"start",animate:!0},t.trigger("descriptionChange")}updateScrollBuffer(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}previous(){this.date=Gt.add(this.date,-1,this.stepUnit)}next(){this.date=Gt.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:n,element:r}){const i=this;if(i.eventStore.includes(t)||([t]=i.eventStore.add(t)),t.startDate=e,t.assign(n),r){const e=wn.from(r,i.foregroundCanvas);Br.setTranslateXY(r,0,0),Br.setTopLeft(r,e.y,e.x),To.addChild(i.foregroundCanvas,r,t.assignments[0].id)}await i.project.commitAsync()}}CD.initClass(),CD._$name="SchedulerBase";class SD extends xm{static $name="EventColorPicker";static type="eventcolorpicker";static configurable={colorClasses:CD.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null};colorSelected({color:e}){this.record&&(this.record.eventColor=e)}}SD.initClass(),SD._$name="EventColorPicker";class DD extends uf{static $name="EventColorColumn";static type="eventcolor";static defaults={colorEditorType:"eventcolorpicker",field:"eventColor"}}id.registerColumnType(DD),DD._$name="EventColorColumn";class wD extends td{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":"none"!==e.eventLayout}})}}onCellClick({record:e,event:t}){t.preventDefault(),e.eventLayout="none"!==e.eventLayout?"none":"stack"}}id.registerColumnType(wD),wD._$name="ResourceCollapseColumn";class ED extends td{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:!_.isTestEnv&&"text"}}construct(...e){super.construct(...e),this.avatarRendering=new of({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const t=this.grid.resourceImagePath||"",n=t.split("//"),r=n.length>1?n[1]:t,i=$.joinPaths([r||"",e||""]);return n.length>1?n[0]+"//"+i:i}template(e,t){const n=this,{showImage:r,showRole:i,showMeta:s,showEventCount:o,grid:a}=n,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=a,u="string"==typeof i?i:"role",h=o&&e.eventStore.getEvents({includeOccurrences:a.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(r&&!1!==e.image)if(e.imageUrl)g=e.imageUrl;else{const i="string"==typeof r?r:e.image||t&&n.useNameAsImageName&&t.toLowerCase()+c||d||"";g=i&&n.getImageURL(i),g&&!i.includes(".")&&(n.validNames&&!n.validNames.includes(i)||(g+=c))}return{class:"b-resource-info",children:[r&&n.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),i||o||s?{tag:"dl",children:[{tag:"dt",text:t},i?{tag:"dd",class:"b-resource-role",text:e.getValue(u)}:null,o?{tag:"dd",class:"b-resource-events",html:n.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:n.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i}){let s;return t.isSpecialRow?s="":i?s=r:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?n.style.fontSize=e.rowHeight/40+"em":n.style.fontSize="",s=this.template(t,r)),s}}id.registerColumnType(ED),ED._$name="ResourceInfoColumn";class xD extends td{static $name="ScaleColumn";static type="scale";static isScaleColumn=!0;static get fields(){return["scalePoints"]}static get defaults(){return{text:" ",width:40,minWidth:40,field:"scalePoints",cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:null}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,t,n){return"scalePoints"===t&&(this.scaleWidget[t]=n),super.applyValue(...arguments)}buildScaleWidget(){const e=this,t=new sf({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(t,{width:{get:()=>e.width,set(t){this.element.style.width=`${t}px`,this._width=e.width}},height:{get(){return this._height},set(e){this.element.style.height=`${e}px`,this._height=e}}}),t.width=e.width,t}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}renderer({cellElement:e,value:t,scaleWidgetConfig:n,scaleWidget:r=this.scaleWidget}){Xt.assign(r,{scalePoints:t||this.scalePoints,height:this.grid.rowHeight},n),r.refresh();const i=r.element.cloneNode(!0);i.removeAttribute("id"),i.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(i)}}id.registerColumnType(xD),xD._$name="ScaleColumn";class RD extends(rt()){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>!Gt.nonWorkingDays[t])).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>Gt.nonWorkingDays[t])).join(",")}static getLegend(e,t){const n=this,{timeSpan:r,interval:i,days:s,monthDays:o,months:a,positions:l}=e,c=t||r.startDate,d={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?n.L("L{Daily}"):n.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=n.getDaysLegend(s):c&&(d.days=Gt.getDayName(c.getDay())),n.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):o&&o.length?(o.sort(((e,t)=>e-t)),d.days=n.arrayToText(o)):c&&(d.days=c.getDate()),n.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):d.days=c.getDate(),a&&a.length?(a.sort(((e,t)=>e-t)),u=a.length>2?e=>Gt.getMonthShortName(e-1):e=>Gt.getMonthName(e-1),d.months=n.arrayToText(a,u)):d.months=Gt.getMonthName(c.getMonth()),n.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const n=this,r={position:""};let i;if(t&&t.length&&(r.position=n.arrayToText(t,(e=>n.L(`L{position${e}}`)))),e.length)switch(e.sort(((e,t)=>ob.decodeDay(e)[0]-ob.decodeDay(t)[0])),e.join(",")){case n.allDaysValue:r.days=n.L("L{day}");break;case n.workingDaysValue:r.days=n.L("L{weekday}");break;case n.nonWorkingDaysValue:r.days=n.L("L{weekend day}");break;default:i=e.length>2?e=>Gt.getDayShortName(ob.decodeDay(e)[0]):e=>Gt.getDayName(ob.decodeDay(e)[0]),r.days=n.arrayToText(e,i)}return n.L("L{daysFormat}",r)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}RD._$name="RecurrenceLegend";const TD={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class MD extends(fi.mixin(Ag,Fg)){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event",lockLayout:_.checkVersion("core","6.0",">=")}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),null===(e=this.dragging)||void 0===e||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,n,r){const i=this,s=null==t?void 0:t.resizable;return!(!i.disabled&&s&&!t.isMilestone)||(!0!==s&&"start"!==s||!i.isOverStartHandle(r,e))&&(!0!==s&&"end"!==s||!i.isOverEndHandle(r,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:n}){var r,i;e===(null===(r=this.dragging)||void 0===r||null===(i=r.context)||void 0===i?void 0:i.eventRecord)&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=n["b-resize-handle"]=n[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:n,dragging:i}=this,{visibleDateRange:s,isHorizontal:o}=n,a=o&&n.rtl,l=o?"X":"Y",c=r[`page${l}Offset`],d=e[`page${l}`]+((null===(t=i.context)||void 0===t?void 0:t.offset)||0),u=wn.from(n.timeAxisSubGridElement,null,!0),h=u.getStart(a,o),g=u.getEnd(a,o);let m=n.getDateFromCoord({coord:d,local:!1});a?d-c>h?m=s.startDate:d<g&&(m=s.endDate):d-c<h?m=s.startDate:d-c>g&&(m=s.endDate),i.clientStartCoord=h,i.clientEndCoord=g,i.date=m,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}beforeDrag(e){const{client:t}=this,n=t.resolveTimeSpanRecord(e.itemElement),r=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?e.startEvent:e.itemElement);return!(this.disabled||t.readOnly||null!=r&&r.readOnly||n&&(n.readOnly||!n.project&&!n.isOccurrence)||!1===super.beforeDrag(e))&&(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event["page"+(t.isHorizontal?"X":"Y")],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t,n;const r=this,{client:i,tip:s}=r,{startEvent:o,itemElement:a}=e,l=i.scheduledEventName,c=i.resolveEventRecord(a),{isBatchUpdating:d,wrapStartDate:u,wrapEndDate:h}=c,g=null===(t=i.features.eventBuffer)||void 0===t?void 0:t.enabled,m=d?c.get("startDate"):c.startDate,p=d?c.get("endDate"):c.endDate,f="x"===r.dragLock,v=f&&i.rtl,y=r.isOverEndHandle(o,a),b=y?"endDate":"startDate",C=g?y?"wrapEndDate":"wrapStartDate":null,S=y?"startDate":"endDate",D=y?"setEndDate":"setStartDate",w=y?"setStartDate":"setEndDate",E=wn.from(a),x=f?o.clientX:o.clientY,R=y?E.getEnd(v,f):E.getStart(v,f),T=e.context={eventRecord:c,element:a,timespanRecord:c,taskRecord:c,owner:r,valid:!0,oldValue:y?p:m,startDate:m,endDate:p,offset:g?0:R-x,edge:f?y?"right":"left":y?"bottom":"top",finalize:r.finalize,event:e.event,originalStartDate:m,originalEndDate:p,wrapStartDate:u,wrapEndDate:h,draggingEnd:y,toSet:b,wrapToSet:C,otherEnd:S,setMethod:D,setOtherMethod:w};c.meta.isResizing=!0,i.element.classList.add(...r.dragActiveCls.split(" ")),i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),d||r.beginEventRecordBatch(c),r.setupProductResizeContext(T,o),r.triggerEventResizeStart(`${l}ResizeStart`,{[`${l}Record`]:c,event:o,...r.getResizeStartParams(T)},T),T.resizedRecord=(null===(n=i.resolveAssignmentRecord)||void 0===n?void 0:n.call(i,T.element))||c,s&&(s.show(),s.align=TD[T.edge],s.showBy(r.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,n=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,{[`${t.scheduledEventName}Record`]:n,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t,n){var r,i;this.client.trigger(e,t),null===(r=(i=this.client)[`after${$.capitalize(e)}`])||void 0===r||r.call(i,n,t)}triggerEventResizeEnd(e,t){this.client.trigger(e,t)}triggerEventPartialResize(e,t){this.client.trigger(e,t)}triggerBeforeEventResizeFinalize(e,t){this.client.trigger(e,t)}dragEnter(e){var t;return(null===(t=e.context)||void 0===t?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var n;const{client:r}=this,{toSet:i}=t;if(null!==(n=r.features.eventBuffer)&&void 0!==n&&n.enabled)if("startDate"===i){const n=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+n)}else if("endDate"===i){const n=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+n)}e.set(i,t[i])}applyDateConstraints(e,t,n){var r,i;const s=null===(r=n.dateConstraints)||void 0===r?void 0:r.start,o=null===(i=n.dateConstraints)||void 0===i?void 0:i.end;return(s||o)&&(e=Gt.constrain(e,s,o),n.snappedDate=Gt.constrain(n.snappedDate,s,o)),e}moveDrag(e){const t=this,{client:n,tip:r}=t,i="x"===t.dragLock,s=i?"X":"Y",o=n.scheduledEventName,{visibleDateRange:a,enableEventAnimations:l,timeAxis:c,weekStartDay:d}=n,u=i&&n.rtl,{resolutionUnit:h,resolutionIncrement:g}=c,{event:m,context:p}=e,{eventRecord:f,oldValue:v}=p,y=p.offset*(u?-1:1),{isOccurrence:b}=f,C=f.get("startDate"),S=f.get("endDate"),D=m[`client${s}`]+y,w=wn.from(n.timeAxisSubGridElement,null,!0),E=w.getStart(u,i),x=w.getEnd(u,i);p.event=m,m.isScroll&&(e.date=n.getDateFromCoordinate(m[`page${s}`]+y,null,!1));let R,T,{date:M}=e,{toSet:k,otherEnd:I,draggingEnd:A}=p;u?D>E?M=e.date=a.startDate:D<x&&(M=e.date=a.endDate):D<E?M=e.date=a.startDate:D>x&&(M=e.date=a.endDate),"endDate"===k?M<C&&(R=-1):M>S&&(R=1),R&&t.onDragEndSwitch&&(t.onDragEndSwitch(p,M,R),I=p.otherEnd,k=p.toSet),n.snapRelativeToEventStartDate&&(M=c.roundDate(M,v)),p.snappedDate=Gt.round(M,c.resolution,null,d);const F=Gt.diff(M,p[I],h)*(A?-1:1);if(t.isEventDragCreate)p.tooNarrow=F<g/2;else if(F<g)if(t.allowResizeToZero)p.snappedDate=M=p[I];else{const e="startDate"===I?1:-1,t=c.roundDate(Gt.add(f.get(I),g*e,h));(t-v)*e<0||(M-v)*e>0?p.snappedDate=t:(M=e>0?Gt.max(M,v):Gt.min(M,v),p.snappedDate=v),T=!0}if(M=t.applyDateConstraints(M,f,p),(!p.date||M-p.date||T)&&(p.date=M,p[k]=t.showExactResizePosition||n.timeAxisViewModel.snap?p.snappedDate:M,p.valid=t.allowResizeToZero||p[k]-p["startDate"===k?"endDate":"startDate"]!=0,f.get(k)-p[k])){if(p.valid=t.checkValidity(p,m),p.message="",p.valid&&"boolean"!=typeof p.valid&&(p.message=p.valid.message,p.valid=p.valid.valid),p.valid=!1!==p.valid,p.valid){const r={[`${o}Record`]:f,startDate:C,endDate:S,element:e.itemElement,context:p};r[k]=p[k],t.triggerEventPartialResize(`${o}PartialResize`,r),b&&f.stores.push(n.eventStore),n.enableEventAnimations=!1,this.resizeEventPartiallyInternal(f,p),n.enableEventAnimations=l,b&&(f.stores.length=0)}p.tooNarrow&&(p.valid=!1)}r&&(r.align=TD[p.edge],r.alignTo(t.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||Zn.getPagePoint(e.event).equals(Zn.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var n;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:i,endDate:s}=e;let o;null===(n=this.tip)||void 0===n||n.hide(),e.valid=i&&s&&(this.allowResizeToZero||s-i>0)&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${r.capitalizedEventName}ResizeFinalize`,{context:e,event:t,[`${r.scheduledEventName}Record`]:e.eventRecord}),o=!0),e.async||await e.finalize(o)}async finalize(e){const t=this.owner,n=this,{eventRecord:r,oldValue:i,toSet:s}=n,{snapRelativeToEventStartDate:o,timeAxis:a}=t.client;let l=!1;e?(o&&(n[s]=n.snappedDate=a.roundDate(n.date,i)),l=await t.internalUpdateRecord(n,r)):(t.cancelEventRecordBatch(r),r.isOccurrence&&r.resources.forEach((e=>t.client.repaintEventsForResource(e)))),t.isDestroyed||t.cleanup(n,l)}cleanup(e,t){var n;const r=this,{client:i}=r,{element:s,eventRecord:o}=e,a=i.scheduledEventName;o.meta.isResizing=!1,i.endListeningForBatchedUpdates(),null===(n=r.tip)||void 0===n||n.hide(),r.unHighlightHandle(s),i.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${a}ResizeEnd`,{changed:t,[`${a}Record`]:o,...r.getResizeEndParams(e)})}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t;if(t.isOccurrence)n.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(Iv.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const r={[e.toSet]:e[e.toSet]},s=Object.assign({},t.meta.batchChanges);if(delete s[e.toSet],delete s.duration,t.isEntity){var i;const{startDate:s,endDate:o,draggingEnd:a}=e;e.duration=r.duration=t.run("calculateProjectedDuration",s,o),r[e.toSet]=t.run("calculateProjectedXDateWithDuration",a?s:o,a,e.duration);const l=!t[e.otherEnd];l&&(r[e.otherEnd]=e[e.otherEnd]),t.set(r),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),null!==(i=n.features.eventBuffer)&&void 0!==i&&i.enabled&&(t[e.wrapToSet]=null);const c=[];l&&c.push(t[e.setOtherMethod](r[e.otherEnd],!1)),c.push(t[e.setMethod](r[e.toSet],!1)),await Promise.all(c)}else n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),t[e.setMethod](r[e.toSet],!1);Object.keys(s).length&&t.set(s)}return await n.project.commitAsync(),t.generation!==r}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:n}=t;if(n&&!t.client.readOnly&&(!t.allowResize||t.allowResize(n,e))){const r=t.client.resolveTimeSpanRecord(n);if(null!=r&&r.readOnly)return;t.isOverAnyHandle(e,n)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e;const{overItem:t,client:n}=this;((null===(e=t.syncIdMap)||void 0===e?void 0:e[n.scheduledEventName])??t.querySelector(n.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){var t;const n=this,r=(null===(t=e.syncIdMap)||void 0===t?void 0:t[n.client.scheduledEventName])??e.querySelector(n.client.eventInnerSelector);r&&r.classList.remove("b-resize-handle",n.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",n.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){var n;return null===(n=this.getHandleRect("start",e,t))||void 0===n?void 0:n.contains(Zn.getPagePoint(e))}isOverEndHandle(e,t){var n;return null===(n=this.getHandleRect("end",e,t))||void 0===n?void 0:n.contains(Zn.getPagePoint(e))}getHandleRect(e,t,n){if(this.overItem){if(!(n=t.target.closest(`.${this.client.eventCls}`)||n.querySelector(`.${this.client.eventCls}`)))return;const s=this,a="start"===e,{client:l}=s,c=Boolean(l.rtl),d=s.dragLock,u="x"===d,h=u?"width":"height",g=(u?a&&!c?"left":"right":a?"top":"bottom")+"Handle",{offsetWidth:m}=n,p=l.resolveTimeSpanRecord(n),f=null==p?void 0:p.isResizable,v=wn.from(n),y=v.clone(),b=r.getComputedStyle(n,":before"),C=(s.handleSelector||o.isHoverableDevice?i:s.touchHandleSize)||s.handleSize||parseFloat(b[h]),S=s.handleVisibilityThreshold||2*s.handleSize,D=s.dynamicHandleSize?s.reservedSpace/2:0,w=[0,0,0,0];if(!s.disabled&&s[g]&&(m>=S||s.dynamicHandleSize)&&(!0===f||f===e)){if(!u&&!a||u&&c===a?(y[d]+=v[h]-C,w[u?3:0]=v[h]/2+D):w[u?1:2]=v[h]/2+D,v.deflate(...w),y[h]=C,y.constrainTo(v),y[h])return y}}}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const n=super.setupDragContext(e);return n.scrollManager=t.client.scrollManager,n}}changeHandleSize(){_.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){_.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,t){const n=this;if(!n.showTooltip)return null;if(e)e.isTooltip?e.owner=n:e=lc.reconfigure(t,lc.mergeConfigs({id:n.tipId},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new xu({scheduler:n.client});else if(t){var r;t.destroy(),null===(r=n.clockTemplate)||void 0===r||r.destroy()}return e}isElementResizable(e,t){var n;const r=this,{client:i}=r,s=i.resolveTimeSpanRecord(e);if(i.readOnly)return!1;let o=null==s?void 0:s.isResizable;const a=(null===(n=e)||void 0===n?void 0:n.syncIdMap[i.scheduledEventName])??e,l=t.target.closest('[class$="-handle"]');if(!o||l&&l!==a)return!1;if(!(e=t.target.closest(r.dragSelector)))return!1;const c=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(!0===o){if(c&&d)return!1;if(c)o="end";else{if(!d)return r.isOverStartHandle(t,e)||r.isOverEndHandle(t,e);o="start"}}return!(c&&"start"===o||d&&"end"===o)&&!!(r.isOverStartHandle(t,e)&&"start"===o||r.isOverEndHandle(t,e)&&"end"===o)}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:n,snappedDate:r}=this.dragging.context,i=n?t.get("startDate"):r,s=n?r:t.get("endDate"),{element:o}=this.tip;e.updateDateIndicator(o.querySelector(".b-sch-tooltip-startdate"),i),e.updateDateIndicator(o.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:t}){const n=this,{rtl:r}=n.client,i=wn.from(e,null,!0);return"x"===n.dragLock?(!r&&"right"===t.edge||r&&"left"===t.edge?i.x=i.right-1:i.x-=n.tip.anchorSize[0]/2,i.width=n.tip.anchorSize[0]/2):("bottom"===t.edge&&(i.y=i.bottom-1),i.height=n.tip.anchorSize[1]/2),{target:i}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:n,endDate:r,toSet:i,snappedDate:s,valid:o,message:a="",timespanRecord:l}=t.dragging.context;if(!n||!r)return e.html;const c={record:l,valid:o,message:a,startDate:n,endDate:r,[i]:s};return c.startText=t.client.getFormattedDate(c.startDate),c.endText=t.client.getFormattedDate(c.endDate),c.startClockHtml=t.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate"}),c.endClockHtml=t.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(c)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var n,r,i;const{client:s}=this,{element:o}=e,a=s.resolveEventRecord(o),l=null===(n=s.resolveResourceRecord)||void 0===n?void 0:n.call(s,o),c=null===(r=s.resolveAssignmentRecord)||void 0===r?void 0:r.call(s,o);Object.assign(e,{eventRecord:a,taskRecord:a,resourceRecord:l,assignmentRecord:c,dateConstraints:null===(i=s.getDateConstraints)||void 0===i?void 0:i.call(s,l,a)})}checkValidity({startDate:e,endDate:t,eventRecord:n,resourceRecord:r}){const{client:i}=this;return!i.allowOverlap&&n.resources.some((r=>!i.isDateRangeAvailable(e,t,n,r)))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}}MD._$name="EventResize",Ed.registerFeature(MD,!0,"Scheduler"),Ed.registerFeature(MD,!1,"ResourceHistogram");var kD=e=>class extends(e||ye){static get $name(){return"TaskEditStm"}getStmCapture(){return{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1}}applyStmCapture(e){this.stmInitiallyAutoRecord=e.stmInitiallyAutoRecord,this.stmInitiallyDisabled=e.stmInitiallyDisabled}captureStm(e=!1){const t=this,n=t.project.getStm();t.hasStmCapture||(t.hasStmCapture=!0,t.stmInitiallyDisabled=n.disabled,t.stmInitiallyAutoRecord=n.autoRecord,t.stmInitiallyDisabled?(n.enable(),n.autoRecord=!1):(t.stmInitiallyAutoRecord&&(n.autoRecord=!1),n.isRecording&&n.stopTransaction()),e&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this,t=e.project.getStm();if(!e.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");t.enabled&&(t.stopTransaction(),e.stmInitiallyDisabled&&t.resetQueue())}async rejectStmTransaction(){const e=this.project.getStm(),{client:t}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");var n;e.enabled&&(null!==(n=e.transaction)&&void 0!==n&&n.length?(t.suspendRefresh(),e.rejectTransaction(),await t.resumeRefresh(!0)):e.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(e=null){const t=this,n=t.project.getStm(),{stmInitiallyDisabled:r,stmInitiallyAutoRecord:i}=t;if(!t.hasStmCapture)return;let s;t.rejectingStmTransaction=!0,!0===e?s=t.commitStmTransaction():!1===e&&(s=t.rejectStmTransaction()),await s,n.isDestroying||(n.disabled=r,n.autoRecord=i),t.isDestroying||(t.rejectingStmTransaction=!0,t.hasStmCapture=!1)}},ID=e=>class extends(e||ye){static get $name(){return"TaskEditTransactional"}captureStm(e){if(this.client.transactionalFeaturesEnabled)return super.captureStm(),this.startStmTransaction(e);super.captureStm(e)}freeStm(e){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return super.freeStm(e)}async startStmTransaction(e){this.client.transactionalFeaturesEnabled?await this.startFeatureTransaction(e):super.startStmTransaction()}commitStmTransaction(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();super.commitStmTransaction()}async rejectStmTransaction(){this.client.transactionalFeaturesEnabled?this.rejectFeatureTransaction():await super.rejectStmTransaction()}},AD=e=>class extends(ZS(e||ye)){static $name="TransactionalFeature";detachFromProject(e){this.rejectFeatureTransaction(),super.detachFromProject(e)}getStmCapture(){const e=super.getStmCapture();return e._editorPromiseResolve=this._editorPromiseResolve,e}applyStmCapture(e){super.applyStmCapture(e),this._editorPromiseResolve=e._editorPromiseResolve}async startFeatureTransaction(){if(!this.client.transactionalFeaturesEnabled)return;const e=this,{project:t}=e.client,{stm:n}=t;let r;e.hasStmCapture?n.startTransaction():r=t.queue((()=>t.commitAsync())),t.queue((()=>{var t;return e.hasStmCapture||(e._stmInitiallyDisabled=n.disabled,e._stmInitiallyAutoRecord=n.autoRecord,n.isRecording?n.stopTransaction():e._stmInitiallyDisabled&&n.enable(),n.autoRecord=!1),n.isRecording||n.startTransaction(),null===(t=e.trigger)||void 0===t||t.call(e,"featureTransactionStart"),new Promise((t=>e._editorPromiseResolve=t))})),await r}rejectFeatureTransaction(){var e;if(!this.client.transactionalFeaturesEnabled)return;const t=this,{stm:n}=t.client.project;null===(e=t._editorPromiseResolve)||void 0===e||e.call(t),t._editorPromiseResolve=null,n.isRecording&&n.rejectTransaction(),t.hasStmCapture||null==t._stmInitiallyDisabled||(n.disabled=t._stmInitiallyDisabled,n.autoRecord=t._stmInitiallyAutoRecord),t.trigger("featureTransactionReject")}async finishFeatureTransaction(e){var t;if(!this.client.transactionalFeaturesEnabled)return;const n=this,{project:r}=n.client,{stm:i}=r;r.isEngineReady()||await r.commitAsync();const s=i.stash(),{_stmInitiallyDisabled:o,_stmInitiallyAutoRecord:a}=n,l=vs.generateId("featureTransaction");return null===(t=n._editorPromiseResolve)||void 0===t||t.call(n),n._editorPromiseResolve=null,n.isDestroying||n.trigger("featureTransactionFinalizeStart",{id:l}),r.queue((async()=>{var t,c;null==i||i.applyStash(s),await(null==e?void 0:e()),await(null===(t=r.commitAsync)||void 0===t?void 0:t.call(r)),i.isRecording&&i.stopTransaction(),n.hasStmCapture||!i||i.isDestroying||null==o||(i.disabled=o,i.autoRecord=a),null===(c=n.trigger)||void 0===c||c.call(n,"featureTransactionFinalized",{id:l})}))}};const FD=function(e){var t,n;return(null===(t=this.source)||void 0===t||null===(n=t.client.features.taskEdit)||void 0===n||!n._canceling)&&Zn.getDistanceBetween(this.startEvent,e)};class PD extends(MD.mixin(kD,AD,ID)){static configurable={showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`\n            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                ${e.startClockHtml}\n                ${e.endClockHtml}\n                <div class="b-sch-tip-message">${e.message}</div>\n            </div>\n        `,dragActiveCls:"b-dragcreating"};static pluginConfig={chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]};construct(e,t){!1===(null==t?void 0:t.showTooltip)&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:n}=t,{eventRecord:r,draggingEnd:i}=e,s="x"===this.dragLock,{initialDate:o}=this.dragging;t.enableEventAnimations=!1,r.set({startDate:o,endDate:o}),i?Object.assign(e,{endDate:o,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:o,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!i,t.enableEventAnimations=n}beforeDrag(e){const t=this,n=super.beforeDrag(e),{pan:r,eventDragSelect:i}=t.client.features;return(!1===n||!(t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||r&&!r.disabled||i&&!i.disabled))&&(t.client.preventDragSelect=!0,n)}startDrag(e){const t=super.startDrag(e);if(!1!==t){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){const{client:t}=this;if(t.matchScheduleCell(e.target)){var n;const r=null===(n=t.resolveResourceRecord(e))||void 0===n?void 0:n.$original;if(r&&!r.isSpecialRow){const n=Ag().prototype.setupDragContext.call(this,e),i=[];return t.isVertical?i.push({element:t.scrollable.element,direction:"vertical"}):i.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:i},n.resourceRecord=n.rowRecord=r,n.getDistance=FD,n}}}async dragDrop({context:e,event:t}){var n;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:i,endDate:s,eventRecord:o}=e,{generation:a}=o;let l;null===(n=this.tip)||void 0===n||n.hide(),await r.project.commitAsync(),o.generation!==a&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=i&&s&&s-i>0&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(r.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:Xt.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){if(this.finalized)return;this.finalized=!0;const t=this.owner,n=this,r=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:n.element,eventElement:n.element,eventRecord:n.eventRecord,resourceRecord:n.resourceRecord}),t.cleanup(n))};var i;e?(await t.finalizeDragCreate(n),r()):(await t.cancelDragCreate(n),null===(i=t.onAborted)||void 0===i||i.call(t,n),r())}async cancelDragCreate(e){}async finalizeDragCreate(e){var t,n;await this.internalUpdateRecord(e,e.eventRecord);const r=this.getStmCapture();return null===(t=this.client)||void 0===t||t.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element,stmCapture:r}),null===(n=this.client)||void 0===n||n.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),r.transferred}cleanup(e){var t;const{client:n}=this,{eventRecord:r}=e;r.meta.isResizing=!1,n.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),n.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,n,r=!1){return{...e,async:r,event:t,finalize:n}}onEventDataGenerated(e){var t,n;(null===(t=this.dragging)||void 0===t||null===(n=t.context)||void 0===n?void 0:n.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}PD._$name="DragCreateBase";const OD=Gt,LD=["startDate","endDate","resource","recurrenceRule"],$D=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,n]=e[0]instanceof Om?e:e.reverse(),r=OD.parse(t.value);return r&&n.value&&r.setHours(n.value.getHours(),n.value.getMinutes(),n.value.getSeconds(),n.value.getMilliseconds()),r?Gt.clone(r):null}return null},_D=(e,t)=>{const n=new Date(e.getTime());return n.setHours(t.getHours(),t.getMinutes()),n},jD=(e,t,n)=>{if(!n.editor.assigningValues&&e&&t&&n.endDateField&&n.endTimeField){const e=OD.add(_D(n.startDateField.value,n.startTimeField.value),n._durationMS,"milliseconds");n.endDateField.value=e,n.endTimeField.value=OD.clone(e)}};class BD extends fi{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,t){const n=this;e.eventEdit=n,super.construct(e,Xt.assign({weekStartDay:e.weekStartDay},t)),n.clientListenersDetacher=e.ion({[n.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this._editor)||void 0===e||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:t}=this;return t&&((e=p.clone(e)).items=Q.merge(t,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const t in e){const n=e[t];!0===n?delete e[t]:null!=n&&n.items&&this.cleanItemsConfig(n.items)}}onDatesChange({value:e,source:t}){var n,r;const i=this;if((t===i.endDateField||t===i.endTimeField)&&i.startDateField){var s,o,a,l,c,d;const e=null!==(s=i.endTimeField)&&void 0!==s&&s.value&&null!==(o=i.endDateField)&&void 0!==o&&o.value?_D(i.endDateField.value,i.endTimeField.value):null===(a=i.endDateField)||void 0===a?void 0:a.value,t=null!==(l=i.startTimeField)&&void 0!==l&&l.value&&null!==(c=i.startDateField)&&void 0!==c&&c.value?_D(i.startDateField.value,i.startTimeField.value):null===(d=i.startDateField)||void 0===d?void 0:d.value;e&&t&&(i._durationMS=e-t)}var u,h;(i.startDateField&&i.endDateField&&(i.endDateField.min=i.startDateField.value),i.endTimeField)&&(OD.isEqual(OD.clearTime(null===(u=i.startDateField)||void 0===u?void 0:u.value),OD.clearTime(null===(h=i.endDateField)||void 0===h?void 0:h.value))?i.endTimeField.min=i.startTimeField.value:i.endTimeField.min=null);switch(t.ref){case"startDateField":(null===(n=i.startTimeField)||void 0===n?void 0:n.value)&&jD(e,i.startTimeField.value,i);break;case"startTimeField":(null===(r=i.startDateField)||void 0===r?void 0:r.value)&&jD(i.startDateField.value,e,i)}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:t}=e,n=[],r=[],{values:i}=t;return LD.forEach((e=>delete i[e])),t.eachWidget((s=>{var o;const{name:a}=s;if(!a||s.hidden||s.up((t=>t===e.recurrenceEditor)))delete i[a];else switch(a){case"startDate":n.push(s);break;case"endDate":r.push(s);break;case"resource":i[a]=s.record;break;case"recurrenceRule":i[a]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":s.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(n.push(e.startTimeField),r.push(e.endTimeField)),n.length&&(i.startDate=$D(n)),r.length&&(i.endDate=$D(r)),"startDate"in i&&"endDate"in i&&(i.duration=OD.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,this._durationMS=Gt.asMilliseconds(t.duration??e.duration,e.durationUnit),e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:n}=t.widgetMap;n&&e.isCreating&&(t.assigningValues=!0,n.value="",t.assigningValues=!1,n._configuredPlaceholder=n.placeholder,n.placeholder=e.name)}resetEditingContext(){const e=this;if(!e.editingContext)return;const{client:t}=e,{editor:n,eventRecord:r}=e.editingContext,{eventStore:i}=t,{nameField:s}=n.widgetMap;if(r.isCreating){var o;if(t.isTimelineBase)null===(o=e.editingContext.eventElement)||void 0===o||o.closest("[data-event-id]").classList.add("b-released");i.remove(r),r.isCreating=!1}s&&(s.placeholder=s._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),e.targetEventElement=e.editingContext=n._record=null}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&"Enter"===e.key&&t.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&t.startTimeField&&jD(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async finalizeStmCapture(e){}async onSaveClick(){this.editor.focus(),this.isFinalizingEventSave=!0;const e=await this.save();return this.isFinalizingEventSave=!1,e&&(await this.finalizeStmCapture(!1),this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){this.isDeletingEvent=!0;const e=await this.deleteEvent();if(this.isDeletingEvent=!1,e){await this.finalizeStmCapture(!1);const{editor:e}=this;e.autoClose&&!e.containsFocus||e.close(),this.client.trigger("afterEventEdit")}}async onCancelClick(){this.isCancelingEdit=!0,this.editor.close(),this.isCancelingEdit=!1,this.hasStmCapture&&await this.finalizeStmCapture(!0),this.client.trigger("afterEventEdit")}}BD._$name="EditBase";class VD extends(fi.mixin(ZS)){static configurable={tabIndex:null,entityName:"resourceTimeRange"};static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{client:n}=t,{eventRecord:r,iconCls:i}=e;t.shouldInclude(r)&&(n.isVertical?e.width=e.resourceRecord.columnWidth||n.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,t.rangeCls&&(e.wrapperCls[t.rangeCls]=1),e.wrapperCls[`b-sch-color-${r.timeRangeColor}`]=r.timeRangeColor,t.renderContent(r,e),e.children.push(e.eventContent),e.tabIndex=null!=t.tabIndex?String(t.tabIndex):null,(null==i?void 0:i.length)>0&&e.children.unshift({tag:"i",className:i.toString()}),e.eventId=t.generateElementId(r))}renderContent(e,t){t.eventContent.text=e.name}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var t;return null==e||null===(t=e.closest(`.${this.rangeCls}`))||void 0===t?void 0:t.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var t;return this.overridden.resolveResourceRecord(...arguments)||(null===(t=this.resolveResourceTimeRangeRecord(e.target||e))||void 0===t?void 0:t.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){"removeall"!==e.action&&"dataset"!==e.action||(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}matchScheduleCell(e){let t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){const{client:n}=this,r=e.closest(`.${this.rangeCls}`);t=r&&n.getCell({record:n.isHorizontal?r.elementData.resource:n.store.first,column:n.timeAxisColumn})}return t}handleRangeMouseEvent(e){const t=this,n=e.target.closest(`.${t.rangeCls}`);if(n){const r=Zn.eventNameMap[e.type]??$.capitalize(e.type),i=t.resolveResourceTimeRangeRecord(n);t.client.trigger(t.entityName+r,{feature:t,[`${t.entityName}Record`]:i,resourceRecord:t.client.resourceStore.getById(i.resourceId),domEvent:e})}}updateEnableMouseEvents(e){var t;const n=this,{client:r}=n;if(null===(t=n.mouseEventsDetacher)||void 0===t||t.call(n),n.mouseEventsDetacher=null,e){function i(){n.mouseEventsDetacher=Zn.on({element:r.foregroundCanvas,delegate:`.${n.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:n})}r.whenVisible(i)}r.element.classList.toggle("b-interactive-resourcetimeranges",Boolean(e))}}VD.featureClass="",VD._$name="ResourceTimeRangesBase";class HD extends Gh{}HD._$name="TimeSpanMenuBase";class ND extends fi{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onInternalPaint"]}}construct(e,t){const n=this;t=n.processConfig(t),super.construct(e,t),n.forSelector||(n.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy,.b-iscreating)`),n.clockTemplate=new xu({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var e;null===(e=n.tooltip)||void 0===e||e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onInternalPaint({firstPaint:e}){if(e){var t;const e=this,{client:n}=e,r=`:not(${[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${n.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].join()})`;null===(t=e.tooltip)||void 0===t||t.destroy();const i=e.tooltip=new lc({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",forElement:n.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:e.getTipHtml.bind(e),disabled:e.disabled,...e.config,internalListeners:e.configuredListeners});i.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e}),Object.keys(i.$meta.configs).forEach((e=>{Object.defineProperty(this,e,{set:t=>i[e]=t,get:()=>i[e]})}))}}processConfiguredListeners(){}addListener(...e){var t;const n=super.addListener(...e),r=null===(t=this.tooltip)||void 0===t?void 0:t.addListener(...e);if(n||r)return()=>{null==n||n(),null==r||r()}}removeListener(...e){var t;super.removeListener(...e),null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,n=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),n&&e.clockTemplate.updateDateIndicator(n,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const n=this,{client:r}=n,i=n.recordType||`${r.scheduledEventName}Record`,s=n.resolveTimeSpanRecord(t);if((null==s?void 0:s.startDate)instanceof Date){const{startDate:t,endDate:o}=s,a=r.getFormattedDate(t),l=r.getDisplayEndDate(o,t),c=r.getFormattedDate(l);return e.eventRecord=s,n.template({tip:e,[`${i}`]:s,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:n.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":n.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){const{tooltip:t}=this;t.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?t.hide(!1):t.eventRecord=this.resolveTimeSpanRecord(e))}onRecordUpdate({record:e}){const{tooltip:t}=this;null!=t&&t.isVisible&&e===this.record&&(t.updateContent(),t.lastAlignSpec.aligningToElement?t.realign():t.internalOnPointerOver(this.client.lastPointerEvent))}}ND._$name="TooltipBase";class zD extends(fi.mixin(mi)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,hoverTooltip:null,tooltipTemplate:null,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${$.encodeHtml(e.name)||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}static configurable={showHeaderElements:!0};static pluginConfig={chain:["onInternalPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]};construct(e,t){const n=this;super.construct(e,t),e.isVertical&&e.ion({renderRows:n.onUIReady,thisObj:n,once:!0}),n.cls=n.cls||`b-sch-${n.constructor.$$name.toLowerCase()}`,n.baseSelector=`.${n.baseCls}.${n.cls}`,n.enableResizing&&(n.showHeaderElements=!0)}doDestroy(){var e,t,n,r;const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),null===(e=i.clockTemplate)||void 0===e||e.destroy(),null===(t=i.tip)||void 0===t||t.destroy(),null===(n=i.drag)||void 0===n||n.destroy(),null===(r=i.resize)||void 0===r||r.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:t}=e;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&Zn.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=Hc.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(n,r)=>!t.readOnly&&e.isElementDraggable(n,r),rtlSource:t,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=qh.new({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:(e,t)=>!e.matches(".b-dragging,.b-readonly")&&!t.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new lc(Xt.assign({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const n=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:n})},forSelector:`.b-timelinebase:not(.b-dragging-timerange, .b-resizing-timerange) .${e.baseCls}${e.cls?"."+e.cls:""}`},e.hoverTooltip)))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const n=this,r=[],i=[];if(!n.disabled){n._labelRotationMap={};for(const s of n.timeRanges){const o=n.renderRange(s,e,t);o&&(r.push(o.bodyConfig),i.push(o.headerConfig))}}return[r,i]}renderRanges(){const e=this,{client:t}=e;if(t.isPainted&&!t.timeAxisSubGrid.collapsed){const{headerContainerElement:n}=e,r=[],[i,s]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=Br.createElement({className:`b-timeranges-canvas b-timeranges-body-canvas ${e.cls}-canvas b-sch-canvas`,parent:t.timeAxisSubGridElement,retainElement:!0})),To.sync({targetElement:e.bodyCanvas,domConfig:{children:i,onlyChildren:!0,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:e,action:t})=>{"reuseElement"!==t&&"newElement"!==t&&"reuseOwnElement"!==t||r.push(e)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=Br.createElement({className:`b-timeranges-canvas b-timeranges-header-canvas ${e.cls}-canvas`,parent:n,retainElement:!0})),e.headerCanvas&&To.sync({targetElement:e.headerCanvas,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const t of r)e.cacheRotation(t.elementData.timeRange,t);for(const t of r)e.applyRotation(t.elementData.timeRange,t)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,n=this.client.visibleDateRange.endDate){const{timeAxis:r}=this.client,{startDate:i,endDate:s,duration:o}=e;return Boolean(i&&(r.isContinuous||r.isTimeSpanInAxis(e))&&Gt.intersectSpans(t,n,i,o?s:Gt.add(i,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,n,r=0){const i=this,{client:s}=i,{rtl:o}=s,a=s.getCoordinateFromDate(Gt.max(e.startDate,t),{respectExclusion:!0})-r,l=e.endDate?s.getCoordinateFromDate(Gt.min(e.endDate,n),{respectExclusion:!0,isEnd:!0})-r:a,c=Math.abs(l-a),d=c>0,u=o?`calc(${a}px - 100%)`:`${a}px`;return{className:{[i.baseCls]:1,[i.cls]:i.cls,[i.rangeCls]:d,[i.lineCls]:!d,[e.cls]:e.cls,"b-narrow-range":d&&c<i.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":o},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}renderRange(e,t,n){const r=this,{client:i}=r,{timeAxis:s}=i;if(r.shouldRenderRange(e,t,n)&&s.startDate){const t=r.getRangeDomConfig(e,s.startDate,s.endDate),n=e.iconCls&&$.xss`<i class="${e.iconCls}"></i>`,i=e.name&&$.encodeHtml(e.name),o=i||n?`${n||""}<label>${i||"&nbsp;"}</label>`:"",a={...t,style:t.style+(e.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:e}):r.showHeaderElements&&!r.showLabelInBody?"":o};let l;return r.showHeaderElements&&(l={...t,html:r.headerRenderer?r.headerRenderer({timeRange:e}):r.showLabelInBody?"":o}),{bodyConfig:a,headerConfig:l}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const n=t.firstElementChild;n&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?n.offsetHeight<t.offsetHeight:n.offsetWidth>t.offsetWidth)}applyRotation(e,t){var n,r;const i=this._labelRotationMap[(null===(n=e.recurringTimeSpan)||void 0===n?void 0:n.id)??e.id];null===(r=t.firstElementChild)||void 0===r||r.classList.toggle("b-vertical",Boolean(i))}getBodyElementByRecord(e){const t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&To.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeView:n,timeAxisColumn:r}=e.client;return e._headerContainerElement||(t&&n.element?e._headerContainerElement=n.element.parentElement:t||(e._headerContainerElement=r.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onInternalPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,t,n,r,i){this.client.isVertical&&i!==n&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${$.capitalize(e.type)}`,{event:e,domEvent:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new xu({scheduler:t.client}),t.tip=new lc(Xt.assign({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:n}=this;t.isVertical?(n.minY=0,n.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,n.minX=0,n.maxX=Number.MAX_SAFE_INTEGER):(n.minX=0,n.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,n.minY=0,n.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}updateDateIndicator({startDate:e,endDate:t}){const n=this,{tip:r}=n,i=r.element.querySelector(".b-sch-tooltip-enddate");n.clockTemplate.updateDateIndicator(r.element,e),i&&n.clockTemplate.updateDateIndicator(i,t)}onDrag({context:e}){const{client:t}=this,n=wn.from(e.element),r=n.getStart(t.rtl,t.isHorizontal),i=n.getEnd(t.rtl,t.isHorizontal),s=t.getDateFromCoordinate(r,"round",!1),o=t.getDateFromCoordinate(i,"round",!1);this.updateDateIndicator({startDate:s,endDate:o})}onDragReset(){}onResizeStart(){var e;this.client.element.classList.add("b-resizing-timerange"),null===(e=this.hoverTooltip)||void 0===e||e.hide()}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){this.client.element.classList.remove("b-resizing-timerange")}getTipHtml(e,t){const n=this,{client:r}=n,i=wn.from(t),s=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),a=r.getDateFromCoordinate(s,"round",!1),l=e.endDate&&r.getDateFromCoordinate(o,"round",!1),c=r.getFormattedDate(a),d=l&&r.getFormattedEndDate(l,a);return n.dragTipTemplate({name:e.name||"",startDate:a,endDate:l,startText:c,endText:d,startClockHtml:n.clockTemplate.template({date:a,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&n.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}}zD._$name="AbstractTimeRanges";const WD=Object.freeze({});class UD extends(fi.mixin(ZS,mi)){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","internalOnVisibleDateRangeChange","onVisibleResourceRangeChange"]}}attachToResourceStore(e){const{client:t}=this;super.attachToResourceStore(e),t.isVertical&&t.resourceStore.ion({name:"resourceStore",group({groupers:e}){0===e.length&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t){const{client:n}=this,{rtl:r}=n,i=r?-1:1,{timeAxisViewModel:s,isHorizontal:o,resourceStore:a,variableColumnWidths:l}=n,{columnConfig:c}=s,d=s.columnLinesFor,u=Math.max(d-1,0),h=e.getTime(),g=t.getTime(),m=[],p=new Set,f=o?"X":"Y";if(!this.disabled){const e=(e,t)=>{const n=e.start.getTime();n>h&&n<g&&!p.has(n)&&(p.add(n),m.push({role:"presentation",className:t?"b-column-line-major":"b-column-line",style:{transform:`translate${f}(${e.coord*i}px)`},dataset:{line:t?`major-${e.index}`:`line-${e.index}`}}))};if(d!==u)for(let t=1;t<=c[u].length-1;t++)e(c[u][t],!0);for(let t=1;t<=c[d].length-1;t++)e(c[d][t],!1);if(!o&&n.columnLines){const{columnWidth:e}=n.resourceColumns;let{first:t,last:r}=n.currentOrientation.getResourceRange(!0),s=0;if(t>-1)for(let o=t;o<r+1;o++){var v;const t=a.getAt(o);if(t.isGroupHeader){r++,s++;continue}const c=t.instanceMeta(a),d=l?c.insetStart+t.columnWidth-1:(o-s+1)*e-1,u=null===(v=t.groupParent)||void 0===v?void 0:v.get(n.resourceStore.id);m.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":a.isGrouped&&(null==u?void 0:u.groupChildren[(null==u?void 0:u.groupChildren.length)-1])===t},style:{transform:`translateX(${d*i}px)`},dataset:{line:`resource-${o}`}})}}}return m}refresh(){const e=this,{client:t}=e,{timeAxis:n}=t,{startDate:r,endDate:i}=t.visibleDateRange||WD;if(!n.startDate||!r||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=Br.createElement({parent:t.timeAxisSubGridElement,className:"b-column-lines-canvas b-sch-canvas"}));const s=e.getColumnLinesDOMConfig(r,i);To.sync({targetElement:e.element,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}internalOnVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}}UD._$name="ColumnLines",Ed.registerFeature(UD,!0,["Scheduler","Gantt","TimelineHistogram"]);var GD=e=>class extends(e||ye){static get $name(){return"DependencyCreation"}static configurable={allowDropOnEventBar:!0,terminalSize:null,terminalOffset:null,terminalShowDelay:0,terminalHideDelay:0};static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const n=this;n.eventName=e.scheduledEventName,e.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(e,"onElementTouchMove","onElementTouchMove")}doDestroy(){var e,t;const n=this;n.detachListeners("view"),n.creationData=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.client&&(e.detachListeners("view"),e.isCreateAllowed&&e.client.ion({name:"view",[`${e.eventName}MouseEnter`]:"onTimeSpanMouseEnter",[`${e.eventName}MouseLeave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.client.readOnly&&!this.disabled}updateTerminalOffset(e){this.client.whenVisible((()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-offset",-e+"px")}))}updateTerminalSize(e){"number"==typeof e&&(e=`${e}px`),this.client.whenVisible((()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-size",e?`${e}`:null)}))}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:r,resourceRecord:i}){if(!n.isCreating&&!n.readOnly){const s=this,{creationData:o,client:a}=s,l=Br.down(r,t.eventInnerSelector);if(n!==(null==o?void 0:o.source)){const{parent:t}=n;if(n.isEventModel&&t&&!t.isRoot&&a.eventStore.includes(t)){const e=a.getElementFromEventRecord(t,i,!0);e&&s.delayHideTerminals(e)}s.delayShowTerminals(n,r),o&&e.target.closest(a.eventSelector)&&(o.timeSpanElement=l,s.onOverTargetEventBar(e))}}}onTimeSpanMouseLeave(e){var t,n,r;const i=this,{creationData:s,client:o}=i,{eventRecord:a,event:l}=e,c=null===(t=l.relatedTarget)||void 0===t?void 0:t.closest(o.eventSelector),d=(null==c||null===(n=c.elementData)||void 0===n?void 0:n.eventRecord)??(null==c||null===(r=c.elementData)||void 0===r?void 0:r.taskRecord),{parent:u}=a??{},h=e[`${i.eventName}Element`];if(l){if((l.isTrusted||_.isTestEnv||s)&&i.delayHideTerminals(h),u&&!u.isRoot&&o.eventStore.includes(u)){const e=o.getElementFromEventRecord(u);e&&i.delayShowTerminals(u,e)}s&&i.onOverNewTargetWhileCreating(l.relatedTarget,null!=d&&d.readOnly||null!=d&&d.isOccurence?null:d,l)}}onTerminalMouseOver(e){this.clearTimeout(`hide-${e.target.closest(this.client.eventSelector).dataset.syncId}`),this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){var t,n,r;const i=this,{creationData:s,client:o}=i,a=e.target.closest(o.eventSelector),l=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(o.eventSelector),c=(null==l||null===(n=l.elementData)||void 0===n?void 0:n.eventRecord)??(null==l||null===(r=l.elementData)||void 0===r?void 0:r.taskRecord);l===a||!a||i.hasTimeout(`show-${a.dataset.syncId}`)||s&&a===s.timeSpanElement||(i.delayHideTerminals(a),o.unhover(a,e)),s&&i.onOverNewTargetWhileCreating(e.relatedTarget,null!=c&&c.readOnly||null!=c&&c.isOccurence?null:c,e)}onTerminalPointerDown(e){const t=this;if(0===e.button&&!t.creationData){var n;const{client:r}=t,i=r.timeAxisSubGridElement,s=e.target,o=s.closest(r.eventInnerSelector),a=wn.from(r.element,document.body);e.stopPropagation(),t.creationData={sourceElement:o,source:r.resolveTimeSpanRecord(o).$original,fromSide:s.dataset.side,startPoint:wn.from(s,i).center,startX:e.pageX-a.x+r.scrollLeft,startY:e.pageY-a.y+r.scrollTop,valid:!1,sourceResource:null===(n=r.resolveResourceRecord)||void 0===n?void 0:n.call(r,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=Zn.on({pointerup:{element:r.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:i,handler:"onMouseMove",passive:!1},thisObj:t}),t.documentPointerUpDetacher=Zn.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&t.abort()}},thisObj:t})}}onElementTouchMove(e){var t;null===(t=super.onElementTouchMove)||void 0===t||t.call(this,e),this.connector&&e.preventDefault()}onMouseMove(e){const t=this,{client:n,creationData:r}=t,i=wn.from(n.element,document.body),s=e.pageX-i.x+n.scrollLeft-r.startX,o=e.pageY-i.y+n.scrollTop-r.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);let{connector:c}=t;if(!c){if(!1===t.onRequestDragCreate(e))return;c=t.connector}c.style.width=`${a}px`,c.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{client:n,creationData:r}=t;if(!1===n.trigger("beforeDependencyCreateDrag",{data:r,source:r.source}))return t.abort(),!1;if(n.element.classList.add("b-creating-dependency"),t.createConnector(r.startPoint.x,r.startPoint.y),n.trigger("dependencyCreateDragStart",{data:r,source:r.source}),t.showCreationTooltip){const n=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=n,n.disabled=!1,n.show(),n.onMouseMove(e)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){var t;const n=this,{client:r,creationData:i,allowDropOnEventBar:s}=n,{target:o}=e;let a=r.resolveTimeSpanRecord(o).$original;null!==(t=a)&&void 0!==t&&t.isEventSegment&&(a=a.event),p.isPromise(i.valid)||!s&&!o.classList.contains(n.terminalCls)||a!==i.source&&n.onOverNewTargetWhileCreating(o,a,e)}async onOverNewTargetWhileCreating(e,t,n){const r=this,{client:i,creationData:s,allowDropOnEventBar:o,connector:a}=r;if(!p.isPromise(s.valid)&&!s.finalizing&&a){if(a.classList.remove("b-valid","b-invalid"),s.timeSpanElement&&Br.removeClsGlobally(s.timeSpanElement,"b-sch-terminal-active"),t&&t!==s.source&&(o||e.classList.contains(r.terminalCls))){var l,c;const d=s.target=t,{source:u}=s;let h,g=e.dataset.side;o&&!e.classList.contains(r.terminalCls)&&(g=r.getTargetSideFromType(r.dependencyStore.modelClass.fieldMap.type.defaultValue||nC.Type.EndToStart)),i.resolveResourceRecord&&(s.targetResource=i.resolveResourceRecord(n)),s.toSide=g;const m=s.fromSide,f=t=>{r.isDestroyed||(s.valid=t,e.classList.add(t?"b-valid":"b-invalid"),a.classList.add(t?"b-valid":"b-invalid"),i.trigger("dependencyValidationComplete",{data:s,source:u,target:d,dependencyType:h}))};switch(!0){case"start"===m&&"start"===g:h=nC.Type.StartToStart;break;case"start"===m&&"end"===g:h=nC.Type.StartToEnd;break;case"end"===m&&"start"===g:h=nC.Type.EndToStart;break;case"end"===m&&"end"===g:h=nC.Type.EndToEnd}i.trigger("dependencyValidationStart",{data:s,source:u,target:d,dependencyType:h});let v=s.valid=r.dependencyStore.isValidDependency(u,d,h);p.isPromise(v)?(v=await v,f(v)):f(v);const y=v?"b-valid":"b-invalid";a.classList.add(y),null===(l=s.timeSpanElement)||void 0===l||null===(c=l.querySelector(`.${r.terminalCls}[data-side=${g}]`))||void 0===c||c.classList.add("b-sch-terminal-active",y)}else s.target=s.toSide=null,s.valid=!1,a.classList.add("b-invalid");r.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,n=t.creationData;if(n.finalizing=!0,null===(e=t.pointerUpMoveDetacher)||void 0===e||e.call(t),n.valid){if(!1===await t.client.trigger("beforeDependencyCreateFinalize",n)?n.valid=!1:p.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let e=t.createDependency(n);null!==e&&(p.isPromise(e)&&(e=await e),n.dependency=e,t.client.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:e}),t.doAfterDependencyDrop(n))}else t.doAfterDependencyDrop(n)}else n.valid=!1,t.doAfterDependencyDrop(n);t.abort()}doAfterDependencyDrop(e){this.client.trigger("afterDependencyCreateDrop",{data:e,...e})}onDocumentMouseUp({target:e}){this.client.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const n=this,{client:r,creationData:i}=n;if(i){const{source:e,sourceResource:t,target:s,targetResource:o}=i;if(e){const i=r.getElementFromEventRecord(e,t);i&&n.hideTerminals(i)}if(s){const e=r.getElementFromEventRecord(s,o);e&&n.hideTerminals(e)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.documentPointerUpDetacher)||void 0===t||t.call(n),n.removeConnector()}createConnector(e,t){const n=this,{client:r}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=Br.createElement({parent:r.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{client:t}=e;return e.creationTooltip=lc.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,client:n}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((()=>{t.remove(),e.connector=null}),200)),n.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),n.scrollManager.stopMonitoring()}delayShowTerminals(e,t){const n=this,{syncId:r}=t.dataset;n.clearTimeout(`hide-${r}`),n.clearTimeout(`show-${r}`),t.classList.remove("b-hiding-terminals"),n.terminalShowDelay?n.setTimeout({fn:()=>n.showTerminals(e,t),name:`show-${r}`,args:[e,t],delay:n.terminalShowDelay}):n.showTerminals(e,t)}delayHideTerminals(e){const t=this,{syncId:n}=e.dataset;t.clearTimeout(`hide-${n}`),t.clearTimeout(`show-${n}`),e.classList.add("b-hiding-terminals"),t.terminalHideDelay?t.setTimeout({fn:()=>t.hideTerminals(e),name:`hide-${n}`,args:[e],delay:t.terminalHideDelay}):t.hideTerminals(e)}showTerminals(e,t=this.client.getElementFromEventRecord(e)){const n=this;if(!n.isCreateAllowed||!e.project||!t)return;const{client:r}=n,i=n.terminalCls,s=`${i}s-visible`;if(n.showingTerminalsFor&&n.hideTerminals(n.showingTerminalsFor),!(t=Br.down(t,n.client.eventInnerSelector)).classList.contains(s)&&!r.element.classList.contains("b-resizing-event")&&!r.readOnly){if(!1===r.trigger("beforeShowTerminals",{source:e}))return;Br.createElement({parent:t.closest(r.eventSelector),className:"b-sch-terminal-hover-area"}),n.terminalSides.forEach((e=>{e=n.fixSide(e);const r=Br.createElement({parent:t,className:`${i} ${i}-${e}`,dataset:{side:e,feature:!0}});r.detacher=Zn.on({element:r,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})})),t.classList.add(s),e.internalCls.add(s)}}fixSide(e){return"left"===e?"start":"right"===e?"end":e}hideTerminals(e){var t;const n=this,{client:r}=n,i=r.getTimeSpanMouseEventParams(e),s=null==i?void 0:i[`${n.eventName}Record`],o=`${n.terminalCls}s-visible`;null===(t=e.querySelector(".b-sch-terminal-hover-area"))||void 0===t||t.remove(),Br.forEachSelector(e,`> ${r.eventInnerSelector} > .${n.terminalCls}`,(e=>{var t;null===(t=e.detacher)||void 0===t||t.call(e),e.remove()})),Br.down(e,r.eventInnerSelector).classList.remove(o),null==s||s.internalCls.remove(o),e.classList.remove("b-hiding-terminals")}createDependency(e){const{source:t,target:n,fromSide:r,toSide:i}=e,s=("start"===r?0:2)+("end"===i?1:0),o=this.dependencyStore.add({from:t.id,to:n.id,type:s,fromSide:r,toSide:i});return null!==o?o[0]:null}getTargetSideFromType(e){return e===nC.Type.StartToStart||e===nC.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this;if(!e.showCreationTooltip)return;const t=e.creationData,{valid:n}=t,r=e.creationTooltip,{classList:i}=r.element;if(p.isPromise(n))return i.remove("b-invalid"),i.add("b-checking"),new Promise((i=>n.then((n=>{t.valid=n,r.isDestroyed||i(e.updateCreationTooltip())}))));r.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var t;const n=this,{tooltip:r,valid:i}=e,{classList:s}=r.element;let o,a;return Object.assign(e,{fromText:$.encodeHtml(e.source.name),toText:$.encodeHtml((null===(t=e.target)||void 0===t?void 0:t.name)??""),fromSide:e.fromSide,toSide:e.toSide||""}),s.toggle("b-invalid",!i),s.remove("b-checking"),!0===i?(o="valid",a=n.L("L{Dependencies.valid}")):(o="invalid",a=n.L("L{Dependencies.invalid}")),r.title=`<i class="b-icon b-icon-${o}"></i>${a}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:n.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${e.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:n.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${e.toSide}`}]}]}}doDisable(e){this.isConfiguring||this.updateCreateListeners(),super.doDisable(e)}};var YD=e=>class extends e{static $name="DependencyGridCache";gridCache=null;getDependenciesToConsider(e,t,n,r){const i=this,{gridCache:s}=i,{timeAxis:o}=i.client;if(s){const a=new Set,l=Math.floor((e-o.startMS)/i.MS_PER_CELL),c=Math.floor((t-o.startMS)/i.MS_PER_CELL),d=Math.floor(n/25),u=Math.floor(r/25);for(let e=l;e<=c;e++){const t=s[e];if(t)for(let e=d;e<=u;e++){const n=t[e];if(n)for(let e=0;e<n.length;e++)a.add(n[e])}}return a}}afterDrawDependency(e,t,n,r,i){const s=this;if(s.constructGridCache){const{MS_PER_CELL:o}=s,{startMS:a,endMS:l}=s.client.timeAxis,c=Math.ceil((l-a)/o),d=Math.floor((r-a)/o),u=Math.floor((i-a)/o),h=Math.floor(t/25),g=Math.floor(n/25),m=Math.min(d,u),p=Math.max(d,u),f=Math.min(h,g),v=Math.max(h,g);if(m<0&&p<0||m>c&&p>c)return;const y=Math.max(m,0),b=Math.min(p,c);for(let t=y;t<=b;t++){const n=s.gridCache[t]??(s.gridCache[t]={});for(let t=f;t<=v;t++){(n[t]??(n[t]=[])).push(e)}}}}beforeDraw(){const e=this;if(!e.gridCache){const{visibleDateRange:t}=e.client;e.constructGridCache=!0,e.MS_PER_CELL=Math.max(t.endMS-t.startMS,1e3),e.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}};const qD=Math.min(1/r.devicePixelRatio,.75),KD=["start","end","top","bottom"],XD=(e,t)=>Math.abs(e-t)<.1;class ZD extends ye{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const n=this,r=e;let i,s,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,S,D,w,E,x,R,T,M,k,I,A,F;for(t=H.asArray(t),F=0;e&&!A;){var P;if(i=Object.assign(n.config,e),s=i.startBox,o=i.endBox,a=i.startShift,l=i.endShift,c=i.startSide,d=i.endSide,u=i.startArrowMargin,h=i.endArrowMargin,g=i.horizontalMargin,m=i.verticalMargin,p=i.hasOwnProperty("startHorizontalMargin")?i.startHorizontalMargin:g,f=i.hasOwnProperty("startVerticalMargin")?i.startVerticalMargin:m,v=i.hasOwnProperty("endHorizontalMargin")?i.endHorizontalMargin:g,y=i.hasOwnProperty("endVerticalMargin")?i.endVerticalMargin:m,b=i.hasOwnProperty("otherHorizontalMargin")?i.otherHorizontalMargin:g,C=i.hasOwnProperty("otherVerticalMargin")?i.otherVerticalMargin:m,S=i.otherBoxes,c=n.normalizeSide(c),d=n.normalizeSide(d),D=n.getConnectionCoordinatesFromBoxSideShift(s,c,a),w=n.getConnectionCoordinatesFromBoxSideShift(o,d,l),M=n.calcGridBaseBoxFromBoxAndDrawParams(s,c,u,p,f),k=n.calcGridBaseBoxFromBoxAndDrawParams(o,d,h,v,y),KD.forEach((e=>{Math.abs(M[e]-k[e])<=qD&&(k[e]=M[e])})),n.shouldLookForPath(s,o,M,k))S=null===(P=S)||void 0===P?void 0:P.map((e=>n.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,b,C))),E=n.getConnectionCoordinatesFromBoxSideShift(M,c,a),x=n.getConnectionCoordinatesFromBoxSideShift(k,d,l),I=n.buildPathGrid(M,k,E,x,c,d,S),R=n.convertDecartPointToGridPoint(I,E),T=n.convertDecartPointToGridPoint(I,x),A=n.findPathOnGrid(I,R,T,c,d);for(e=!1;!A&&!e&&t&&F<t.length;F++)e=t[F](i,r)}return A&&(A=n.prependPathWithArrowStaffSegment(A,D,c),A=n.appendPathWithArrowStaffSegment(A,w,d),A=n.optimizePath(A)),A}static calculateRelativePosition(e,t,n=!1){const r=n?"top":"start",i=n?"bottom":"end";let s;return s=e[i]<t[r]?0:e[i]<=t[i]&&e[i]>=t[r]&&e[r]<t[r]?1:e[r]>=t[r]&&e[i]<=t[i]?2:e[r]<t[r]&&e[i]>t[i]?-2:e[r]<=t[i]&&e[i]>t[i]?3:4,s}static boxOverlapChanged(e,t,n,r,i=!1){const s=ZD.calculateRelativePosition;return s(e,t,i)!==s(n,r,i)}shouldLookForPath(e,t,n,r){let i=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&2===Math.abs(ZD.calculateRelativePosition(e,t,!0))&&(i=!ZD.boxOverlapChanged(e,t,n,r)),i}getConnectionCoordinatesFromBoxSideShift(e,t,n){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,n,r,i){let s;switch(this.normalizeSide(t)){case"left":s={start:e.start-Math.max(n,r),end:e.end+r,top:e.top-i,bottom:e.bottom+i};break;case"right":s={start:e.start-r,end:e.end+Math.max(n,r),top:e.top-i,bottom:e.bottom+i};break;case"top":s={start:e.start-r,end:e.end+r,top:e.top-Math.max(n,i),bottom:e.bottom+i};break;case"bottom":s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+Math.max(n,i)};break;default:s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+i}}return s}normalizeSide(e){const{rtl:t}=this.client;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}buildPathGrid(e,t,n,r,i,s,o){let a,l,c,d,u,h,g,m,p,f,v,y,b;const C={},S=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:n.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:r.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:r.y,t.bottom],o&&o.forEach((e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),a=[...new Set(a.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(d=a[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===n.x&&c===n.y||d===r.x&&c===r.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,S.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:S}}convertDecartPointToGridPoint(e,t){const n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}findPathOnGrid(e,t,n,r,i){const s=this;let o=!1;return t.permitted&&n.permitted&&(e=s.waveForward(e,t,0),o=s.collectPath(e,n,i)),o}getGridPointNeighbors(e,t,n){const r=t.ix,i=t.iy,s=[];let o;return i<e.height-1&&(o=e.points[i+1][r],(!n||n(o))&&s.push(o)),i>0&&(o=e.points[i-1][r],(!n||n(o))&&s.push(o)),r<e.width-1&&(o=e.points[i][r+1],(!n||n(o))&&s.push(o)),r>0&&(o=e.points[i][r-1],(!n||n(o))&&s.push(o)),s}waveForward(e,t,n){const r=this;return eo.preWalkUnordered([t,n],(([t,n])=>r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>n+1)).map((e=>[e,n+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,n){const r=this,i=[];let s,o,a,l,c=!0;for(;c&&t.distance;)if(s=r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance===t.distance-1)),c=s.length>0,c){switch(s=s.sort(((e,r)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;const o=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;i=r.ix-t.ix,s=r.iy-t.iy;const a=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>r.y?-1:1:void 0})),o=s[0],i.push({x1:o.x,y1:o.y,x2:t.x,y2:t.y}),a=o.ix-t.ix,l=o.iy-t.iy,!0){case!l&&a>0:n="left";break;case!l&&a<0:n="right";break;case!a&&l>0:n="top";break;case!a&&l<0:n="bottom"}t=o}return c&&i.reverse()||!1}prependPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[0],i={x2:r.x1,y2:r.y1};switch(n){case"left":case"right":i.x1=t.x,i.y1=r.y1;break;case"top":case"bottom":i.x1=r.x1,i.y1=t.y}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[e.length-1],i={x1:r.x2,y1:r.y2};switch(n){case"left":case"right":i.x2=t.x,i.y2=r.y2;break;case"top":case"bottom":i.x2=r.x2,i.y2=t.y}e.push(i)}return e}optimizePath(e){const t=[];let n,r;if(e.length>0)for(n=e.shift(),t.push(n);e.length>0;)r=e.shift(),XD(n.x1,r.x1)&&XD(n.y1,r.y1)&&XD(n.x2,r.x2)&&XD(n.y2,r.y2)?n=r:XD(n.y1,n.y2)&&XD(r.y1,r.y2)?n.x2=r.x2:XD(n.x1,n.x2)&&XD(r.x1,r.x2)?n.y2=r.y2:(t.push(r),n=r);return t}}function JD(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function QD(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function ew(e,t,n,r,i){let s=e.x1===e.x2?"v":"h",o=r;if(r){const a=QD(e),l=t?Math.abs(QD(t)):Number.MAX_SAFE_INTEGER,c=Math.sign(a);null==i&&(i=r),(Math.abs(a)<2*r||l<2*r)&&(o=Math.min(Math.abs(a),l)/2);const d=a-("single"===n?0:"first"===n?o:"between"===n?i+o:i)*c;s+=Math.sign(d)!==c?0:d,"last"!==n&&"single"!==n&&o>0&&(s+=` ${function(e,t,n){const r=JD(e)+JD(t),i=n*(r.includes("l")?-1:1),s=n*(r.includes("u")?-1:1);return`a${i},${s} 0 0 ${"ur"===r||"lu"===r||"dl"===r||"rd"===r?1:0} ${i},${s}`}(e,t,o)}`)}else s+=QD(e);return{line:s,currentRadius:r!==o?o:null}}function tw(e,t){const{length:n}=t;if(!n)return"";let r=null;return`M${t[0].x1},${t[0].y1} ${t.map(((i,s)=>{const o=1===n?"single":s===n-1?"last":0===s?"first":"between",a=ew(i,t[s+1],o,e,r);return({currentRadius:r}=a),a.line})).join(" ")}`}ZD._$name="RectangularPathFinder";var nw=e=>class extends e{static $name="DependencyLineGenerator";lineCache={};onSVGReady(){const e=this;e.pathFinder=new ZD({...e.pathFinderConfig,client:e.client}),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}changeRadius(e){return null!==e&&Xt.assertNumber(e,"radius"),e}resetAtRuntime(){this.isConfiguring||this.reset()}updateRadius(){this.resetAtRuntime()}updateRenderer(){this.resetAtRuntime()}changeClickWidth(e){return null!==e&&Xt.assertNumber(e,"clickWidth"),e}updateClickWidth(){this.resetAtRuntime()}updateDrawAroundParents(){this.resetAtRuntime()}createMarker(){var e;const t=this,{markerDef:n}=t,r=this.client.svgCanvas,i=n?`${t.client.id}-arrowEnd`:"arrowEnd";null===(e=t.marker)||void 0===e||e.remove(),r.style.setProperty("--scheduler-dependency-marker",`url(#${i})`),t.marker=Br.createElement({parent:r,id:i,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:t.markerDef??"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(e){var t,n;return(null===(t=this.client.features.eventDrag)||void 0===t||null===(n=t.getProxyElement)||void 0===n?void 0:n.call(t,e))||this.client.getElementFromAssignmentRecord(e)}getDomConfigs(e,t,n,r){const i=this,s=i.getDependencyKey(e,t,n),o=i.lineCache[s];if(i.constructLineCache||!o||r||i.drawingLive&&(i.getAssignmentElement(t)||i.getAssignmentElement(n))){const o=i.prepareLineDef(e,t,n,r),l=o&&i.pathFinder.findPath(o,i.lineDefAdjusters),{client:c,clickWidth:d}=i,{toEvent:u}=e;if(l){var a;const r=i.highlighted.get(e),h={tag:"path",ns:"http://www.w3.org/2000/svg",d:tw(i.radius??0,l),role:"presentation",dataset:{syncId:s,depId:e.id,fromId:t.id,toId:n.id},elementData:{dependency:e,points:l},class:{[i.baseCls]:1,[e.cls]:e.cls,[e.highlighted]:e.highlighted,[r&&[...r].join(" ")]:r,[i.noMarkerCls]:o.hideMarker,"b-inactive":!1===e.active,"b-sch-bidirectional-line":e.bidirectional,"b-readonly":e.readOnly,"b-sch-dependency-ends-outside":!u.milestone&&(u.endDate<=c.startDate||c.endDate<=u.startDate)||u.milestone&&(u.endDate<c.startDate||c.endDate<u.startDate)}};null===(a=i.renderer)||void 0===a||a.call(i,{domConfig:h,points:l,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:n,fromBox:o.startBox,toBox:o.endBox,fromSide:o.startSide,toSide:o.endSide});const g=[h];return d>1&&g.push({...h,class:{...h.class,"b-click-area":1},dataset:{...h.dataset,syncId:`${h.dataset.syncId}-click-area`},style:{strokeWidth:d}}),i.lineCache[s]=g}return i.lineCache[s]=null}return o}generateBoundaryBoxes(e,t){return"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}getAssignmentBounds(e){const{client:t}=this,n=this.getAssignmentElement(e);if(n&&!t.isExporting){const r=wn.from(n,this.relativeTo);if(t.isHorizontal){let n=t.getRowById(e.resource.id);if(!n)return t.getAssignmentEventBox(e,!0);if(r.y<n.top||r.bottom>n.bottom){const e=t.rowManager.getRowAt(r.center.y,!0);e&&(n=e)}r.rowTop=n.top,r.rowBottom=n.bottom}return r}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}getDependencyStartSide(e){const{fromEvent:t,type:n,fromSide:r}=e;if(r)return r;switch(!0){case n===sC.Type.StartToEnd:case n===sC.Type.StartToStart:return this.getConnectorStartSide(t);case n===sC.Type.EndToStart:case n===sC.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}getDependencyEndSide(e){const{toEvent:t,type:n,toSide:r}=e;if(r)return r;switch(!0){case n===sC.Type.EndToEnd:case n===sC.Type.StartToEnd:return this.getConnectorEndSide(t);case n===sC.Type.EndToStart:case n===sC.Type.StartToStart:default:return this.getConnectorStartSide(t)}}createLineDefAdjusters(){var e;const{client:t}=this;const n=[function(e){const{barMargin:n}=t;return(e.startArrowMargin>n||e.endArrowMargin>n)&&(e.startArrowMargin=e.endArrowMargin=n,e)},function(e){return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,e)},function(e,t){return e.horizontalMargin>2&&(e.horizontalMargin=1,t.hideMarker=!0,e)}];return null!==(e=t.features.nestedEvents)&&void 0!==e&&e.enabled&&n.unshift((e=>(e.otherBoxes.length&&(e.otherBoxes.length=e.otherBoxes.nestedStart),e))),n}adjustLineDef(e,t){return t}prepareLineDef(e,t,n,r){const i=this,s=i.getDependencyStartSide(e),o=i.getDependencyEndSide(e),a=(null==r?void 0:r.from)??i.getAssignmentBounds(t),l=(null==r?void 0:r.to)??i.getAssignmentBounds(n),c=[];if(!a||!l)return null;let{startArrowMargin:d,verticalMargin:u}=i.pathFinder;if(i.client.isHorizontal){var h;if(null!=a.rowTop&&a.rowTop!==l.rowTop&&c.push(...i.generateBoundaryBoxes(a,s)),null!==(h=i.client.features.nestedEvents)&&void 0!==h&&h.enabled&&i.drawAroundParents){const{resourceStore:e}=i.client,r=t.resource,s=n.resource,o=e.indexOf(r),a=e.indexOf(s),l=Math.min(o,a),u=Math.max(o,a);c.nestedStart=c.length;for(const r of i.client.assignmentStore){var g;if(r!==t&&r!==n&&null!==(g=r.event)&&void 0!==g&&g.isParent&&t.event.parent!==r.event&&n.event.parent!==r.event){const t=e.indexOf(r.resource);if(t>=l&&t<=u){const e=i.getAssignmentBounds(r).inflate(d);e.isNestedParent=!0,c.push(e)}}}}e.bidirectional||(/(top|bottom)/.test(s)&&(d=i.client.barMargin/2),u=i.client.barMargin/2)}return i.adjustLineDef(e,{startBox:a,endBox:l,otherBoxes:c,startArrowMargin:d,verticalMargin:u,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:s,endSide:o})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}};const rw=["start","start","end","end"],iw=["start","end","start","end"];var sw=e=>class extends e{static $name="DependencyTooltip";static configurable={showTooltip:!0,showLagInTooltip:!1,tooltipTemplate(e){const t=this;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:t.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:`b-sch-box b-${e.fromSide||rw[e.type]}`},{tag:"label",text:t.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:`b-sch-box b-${e.toSide||iw[e.type]}`},t.showLagInTooltip&&{tag:"label",text:t.L("L{DependencyEdit.Lag}")},t.showLagInTooltip&&{text:`${e.lag||0} ${Gt.getLocalizedNameOfUnit(e.lagUnit,1!==e.lag)}`}]}]}},tooltip:{$config:"nullify",value:{}}};changeTooltip(e,t){const n=this;return null==t||t.destroy(),n.showTooltip&&e?lc.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},e):null}getHoverTipHtml({activeTarget:e}){return this.tooltipTemplate(this.resolveDependencyRecord(e))}};const ow={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},aw=Object.freeze({}),lw=e=>{var t;const n=[e];return null!==(t=e.resource)&&void 0!==t&&t.hasLinks&&n.push(...e.resource.$links.map((t=>({id:`${t.id}_${e.id}`,resource:t,event:e.event,drawDependencies:e.drawDependencies})))),n};class cw extends(fi.mixin(ZS,mi,GD,YD,nw,sw)){static $name="Dependencies";static configurable={overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null,immediateRefresh:null,drawAroundParents:null};static delayable={doRefresh:10,rafRefresh:"raf"};static get pluginConfig(){return{chain:["render","onInternalPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}domConfigs=new Map;drawingLive=!1;lastScrollX=null;highlighted=new Map;visibleResources=null;usingLinks=null;visibleDateRange=null;relativeTo=null;construct(e,t){super.construct(e,t);const{scheduledEventName:n}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[n+"DragStart"]:"refresh",[n+"DragAbort"]:"refresh",[n+"ResizeStart"]:"refresh",[n+"SegmentDragStart"]:"refresh",[n+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),null==e||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),null==e||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),null==e||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),null==e||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onInternalPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,n){return this.getElementsForDependency(e,t,n)[0]}getElementsForDependency(e,t,n){let r=`[data-dep-id="${e.id}"]`;return t&&(r+=`[data-from-id="${t.id}"]`),n&&(r+=`[data-to-id="${n.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(e){var t;return null===(t=e.elementData)||void 0===t?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const n=ow[e.type];this.client.trigger(`dependency${n}`,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&t.highlight(n))}onElementMouseOut(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&t.unhighlight(n))}isDependencyVisible(e){const{rowStore:t}=this,{fromEvent:n,toEvent:r}=e;if(!n||!r)return!1;const i=n.resource,s=r.resource;return!(!t.isAvailable(i)||!t.isAvailable(s))&&(n.isModel&&!i.instanceMeta(t).hidden&&!s.instanceMeta(t).hidden)}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:e}=t;e.ion({name:"highlightOnHover",[`${e.scheduledEventName}MouseEnter`]:e=>t.highlightEventDependencies(e.eventRecord||e.taskRecord),[`${e.scheduledEventName}MouseLeave`]:e=>t.unhighlightEventDependencies(e.eventRecord||e.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let n=this.highlighted.get(e);n||this.highlighted.set(e,n=new Set),n.add(t);for(const n of this.getElementsForDependency(e))n.classList.add(t)}unhighlight(e,t=this.overCls){const n=this.highlighted.get(e);n&&(n.delete(t),n.size||this.highlighted.delete(e));for(const n of this.getElementsForDependency(e))n.classList.remove(t)}highlightEventDependencies(e,t){e.dependencies.forEach((e=>this.highlight(e,t)))}unhighlightEventDependencies(e,t){e.dependencies.forEach((e=>this.unhighlight(e,t)))}getDependenciesToConsider(e,t,n,r){var i;const{eventStore:s}=this.project;return(null===(i=super.getDependenciesToConsider)||void 0===i?void 0:i.call(this,e,t,n,r))??this.project.dependencyStore.records.filter((e=>e.isValid&&!s.isFiltered||s.isAvailable(e.fromEvent)&&s.isAvailable(e.toEvent)))}getDependencyKey(e,t,n){return`dep:${e.id};from:${t.id};to:${n.id}`}drawDependency(e,t=!1,n=null){var r,i;const s=this,{domConfigs:o,client:a,rowStore:l,topIndex:c,bottomIndex:d}=s,{useInitialAnimation:u}=a,{idMap:h}=l,{startMS:g,endMS:m}=s.visibleDateRange,{fromEvent:p,toEvent:f}=e;let v=p.assigned,y=f.assigned;if(p.isScheduled&&f.isScheduled&&null!==(r=v)&&void 0!==r&&r.size&&null!==(i=y)&&void 0!==i&&i.size){s.usingLinks&&(v=[...v].flatMap(lw),y=[...y].flatMap(lw));for(const t of v)for(const r of y){var b,C,S,D;const i=null===(b=h[null===(C=t.resource)||void 0===C?void 0:C.id])||void 0===b?void 0:b.index,v=null===(S=h[null===(D=r.resource)||void 0===D?void 0:D.id])||void 0===S?void 0:S.index,y=Math.min(p.startDateMS,f.startDateMS),w=Math.max(p.endDateMS,f.endDateMS);if(a.isExporting||null!=i&&null!=v&&!1!==t.drawDependencies&&!1!==r.drawDependencies&&l.isAvailable(t.resource)&&l.isAvailable(r.resource)&&!(i<c&&v<c||i>d&&v>d||y<g&&w<g||y>m&&w>m)){const a=s.getDependencyKey(e,t,r),l=s.getDomConfigs(e,t,r,n);l?(u&&(l[0].style={animationDelay:Math.max(i,v)/20*1e3+"ms"}),o.set(a,l)):o.delete(a)}s.afterDrawDependency(e,i,v,y,w)}}t||s.domSync()}afterDrawDependency(e,t,n,r,i){var s;null===(s=super.afterDrawDependency)||void 0===s||s.call(this,e,t,n,r,i)}beforeDraw(){var e;null===(e=super.beforeDraw)||void 0===e||e.call(this)}afterDraw(){var e;null===(e=super.afterDraw)||void 0===e||e.call(this)}domSync(e=this.client.svgCanvas,t=!1){To.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}}),t&&this.clearDomConfigs()}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=wn.from(t.svgCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),null==e.usingLinks&&(e.usingLinks=t.resourceStore.some((e=>e.hasLinks)))}clearDomConfigs(){this.domConfigs.clear()}draw(){const e=this,{client:t}=e,{visibleDateRange:n}=t;if(!t.refreshSuspended&&t.foregroundCanvas&&n&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.clearDomConfigs(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&n.endMS-n.startMS>0){const{topIndex:t,bottomIndex:r}=e,i=e.getDependenciesToConsider(n.startMS,n.endMS,t,r);e.beforeDraw();for(const t of i)e.drawDependency(t,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,n,r,i;const s=this,{client:o}=s,{scheduledEventName:a,features:l}=o;s.draw(),s.drawingLive=o.dependencyStore.count&&(o.isAnimating||o.useInitialAnimation&&o.eventStore.count||(null===(e=l[`${a}Drag`])||void 0===e?void 0:e.isActivelyDragging)||(null===(t=l[`${a}Drag`])||void 0===t?void 0:t.isAborting)||(null===(n=l[`${a}Resize`])||void 0===n?void 0:n.isResizing)||(null===(r=l[`${a}SegmentDrag`])||void 0===r?void 0:r.isActivelyDragging)||(null===(i=l[`${a}SegmentResize`])||void 0===i?void 0:i.isResizing)),s.drawingLive&&s.refresh(!1,!0)}rafRefresh(){this.doRefresh.now()}refresh(e=this.immediateRefresh,t=!1){const n=this,{client:r}=n;r.refreshSuspended||n.disabled||!r.isPainted||r.timeAxisSubGrid.collapsed||(e?n.doRefresh.now():t?n.rafRefresh():n.doRefresh())}reset({source:e,type:t}=aw){var n;null===(n=super.reset)||void 0===n||n.call(this),this.refresh(e===this.client&&"timelineviewportresize"===t)}drawForEvent(){_.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}}cw._$name="Dependencies",Ed.registerFeature(cw,!1,["Scheduler","ResourceHistogram"]);class dw extends ic{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:t}=this;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&super.processWidgetConfig(e))}afterShow(...e){const{deleteButton:t}=this.widgetMap;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}dw._$name="DependencyEditor";class uw extends fi{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(sC.Type).map((t=>({id:sC.Type[t],name:e.L(t),localeKey:t})))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0,highlightExternalChange:!1}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const n=this;if(e.dependencyEdit=n,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");n.clientListenersDetacher=e.ion({[n.triggerEvent]:n.onActivateEditor,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{autoClose:t,cls:n,client:i}=this;return Xt.assign({owner:i,align:"b-t",id:`${i.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:r,autoClose:t,cls:n},e)}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),Xt.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&(this.afterSave(),this.editor.hide())}async onDeleteClick(){await this.deleteDependency()&&this.afterDelete(),this.editor.hide()}onCancelClick(){this.afterCancel(),this.editor.hide()}afterSave(){}afterDelete(){}afterCancel(){}internalShowEditor(e){const t=this,{client:n}=t,r=t.getEditor(e);t.loadRecord(e),n.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:r});let i=t.lastPointerDownCoordinate;if(!i){const e=wn.from(n.element).center;i=[e.x-r.width/2,e.y-r.height/2]}const s=r.showBy(i),o=[];let a=0;return r.eachWidget((e=>{const{labelElement:t,element:n}=e;if(t){if(t.getBoundingClientRect().top<n.getBoundingClientRect().top)return!1;e.labelWidth=null,a=Math.max(a,t.offsetWidth),o.push(e)}})),o.forEach((e=>e.labelWidth=a)),s}async editDependency(e){const{client:t}=this;return!t.readOnly&&!e.readOnly&&!1!==await t.trigger("beforeDependencyEdit",{dependencyEdit:this,dependencyRecord:e})&&(await this.internalShowEditor(e),!0)}getEditor(){var e,t,n;const i=this;let{editor:s}=i;return s||(s=i.editor=dw.new({dependencyEditFeature:i,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:r,autoClose:i.autoClose,cls:i.cls,rootElement:i.client.rootElement,internalListeners:{keydown:i.onPopupKeyDown,thisObj:i}},i.editorConfig),0===s.items.length&&console.warn("Editor configured without any `items`"),s.eachWidget((e=>{const t=e.ref||e.id;t&&!i[t]&&(i[t]=e)})),null===(e=i.saveButton)||void 0===e||e.ion({click:"onSaveClick",thisObj:i}),null===(t=i.deleteButton)||void 0===t||t.ion({click:"onDeleteClick",thisObj:i}),null===(n=i.cancelButton)||void 0===n||n.ion({click:"onCancelClick",thisObj:i}),i.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new us(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:n}=e;if(!n||!e.isValid)return;const{dependencyStore:r,values:i}=e;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:n,values:i})){var s;if(e.onBeforeSave(n),e.updateRecord(n),r&&!n.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:e}))return;r.add(n)}await(null===(s=t.project)||void 0===s?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:n}),e.onAfterSave(n)}return n}async deleteDependency(){const{client:e,editor:t,dependencyRecord:n}=this;var r;return!1!==e.trigger("beforeDependencyDelete",{dependencyRecord:n})&&(t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(n),await(null===(r=e.project)||void 0===r?void 0:r.commitAsync()),!0)}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}uw._$name="DependencyEdit",Ed.registerFeature(uw,!1);class hw extends(fi.mixin(mi)){static get $name(){return"ScheduleContext"}static delayable={syncContextElement:"raf"};static configurable={triggerEvent:"click",renderer:null,context:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}}};construct(e,t){super.construct(e,t);const{triggerEvent:n}=this,r={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};"mouseover"===n?r.timelineContextChange="onTimelineContextChange":("click"!==n&&"mousedown"!==n||(r.schedulecontextmenu="onScheduleContextGesture"),Object.assign(r,{[`schedule${n}`]:"onScheduleContextGesture",[`event${n}`]:"onScheduleContextGesture",...r})),e.ion(r),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return"hover"!==e&&"mousemove"!==e||(e="mouseover"),e}get element(){return this._element||(this._element=Br.createElement({parent:this.client.timeAxisSubGridElement,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var t;e.timeAxis.includes(null===(t=this.context)||void 0===t?void 0:t.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,t){this.syncContextElement()}syncContextElement(){if(this.context&&this.enabled){const e=this,{client:t,element:n,context:r,renderer:i}=e,{isVertical:s}=t,{style:o}=n,a=s?t.rowManager.rows[0]:t.getRowFor(r.resourceRecord);if(a){const{tickStartDate:l,tickEndDate:c,resourceRecord:d}=r,u=t.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:c,startDateMS:l.getTime(),endDateMS:c.getTime()},d);let h,g,m;s?(h=u.top,g=u.resourceWidth,m=u.height):(h=a.top,g=u.width,m=a.height),o.display="",o.width=`${g}px`,o.height=`${m}px`,Br.setTranslateXY(n,u.left,h),r.index=a.index,n.innerHTML="",i&&e.callback(i,e,[r,n])}else o.display="none"}else this.element.style.display="none"}}hw.featureClass="b-scheduler-context",hw._$name="ScheduleContext",Ed.registerFeature(hw,!1,["Scheduler"]);const gw={cut:1,copy:1,paste:1};class mw extends(bf.mixin(ZS)){static $name="EventCopyPaste";static pluginConfig={assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]};static configurable={nameField:"name",copyPasteAction:"clone",eventToStringFields:["name","startDate","endDate","duration","durationUnit","allDay"]};construct(e,t){super.construct(e,t),e.ion({eventClick:"onEventClick",scheduleClick:"onScheduleClick",projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this})}entityName="event";get scheduler(){return this.client}attachToEventStore(e){super.attachToEventStore(e),delete this._eventClickedContext}onEventDataGenerated(e){const{assignmentRecord:t}=e;t&&(e.cls["b-cut-item"]=t.meta.isCut)}onEventClick(e){this._cellClickedContext=null,this._eventClickedContext=e}onScheduleClick(e){this._cellClickedContext=e,this._eventClickedContext=null}isActionAvailable({event:e,actionName:t}){var n,i;if(gw[t])return!this.disabled&&0===r.getSelection().toString().length&&!(null!==(n=this.client.features.cellEdit)&&void 0!==n&&n.isEditing)&&Boolean(e.target.closest(".b-timeaxissubgrid"))&&!(null!==(i=this.client.focusedCell)&&void 0!==i&&i.isSpecialRow)}async copy(){await this.copyEvents()}async cut(){await this.copyEvents(i,!0)}async paste(){await this.pasteEvents()}async copyEvents(e=this.scheduler.selectedAssignments,t=!1){const n=this,{scheduler:r}=n;if(r.splitFrom)return r.splitFrom.features.eventCopyPaste.copyEvents(e,t);if(null==e||!e.length)return;let i=e.slice();e[0].isEventModel&&(i=e.map((e=>e.assignments)).flat()),t&&(i=i.filter((e=>!e.event.readOnly)));const s=i.map((e=>e.event));i.length&&!r.readOnly&&(await n.writeToClipboard({assignmentRecords:i,eventRecords:s},t),r.trigger("copy",{assignmentRecords:i,eventRecords:s,isCut:t,entityName:n.entityName}),r.refreshWithTransition(),n._focusedEventOnCopy=n._eventClickedContext)}async beforeCopy({data:{assignmentRecords:e,eventRecords:t},isCut:n}){return await this.scheduler.trigger("beforeCopy",{assignmentRecords:e,eventRecords:t,isCut:n,entityName:this.entityName})}handleCutData({source:e}){var t;const n=this;if(e!==n&&null!==(t=n.cutData)&&void 0!==t&&t.length){const{assignmentRecords:e,eventRecords:t}=n.cutData[0];null!=e&&e.length&&n.scheduler.assignmentStore.remove(e),null!=t&&t.length&&n.scheduler.eventStore.remove(t)}}stringConverter({eventRecords:e}){const t=[];for(const n of e)t.push(this.eventToStringFields.map((e=>{const t=n[e];return t instanceof Date?Gt.format(t,this.dateFormat):t})).join("\t"));return t.join("\n")}setIsCut({assignmentRecords:e},t){e.forEach((e=>{e.meta.isCut=t})),this.scheduler.refreshWithTransition()}async pasteEvents(e,t){var n;const r=this,{scheduler:i}=r;if(i.splitFrom)return i.splitFrom.features.eventCopyPaste.pasteEvents(e,t);const{entityName:s,isCut:o,_cellClickedContext:a,_eventClickedContext:l}=r,{eventStore:c,assignmentStore:d}=i;0===arguments.length&&(a?(e=a.date,t=a.resourceRecord):r._focusedEventOnCopy!==l&&(e=l.eventRecord.startDate,t=l.resourceRecord)),t&&(t=t.$original);const u=await r.readFromClipboard({resourceRecord:t,date:e});if(null==u||null===(n=u.assignmentRecords)||void 0===n||!n.length)return;const{assignmentRecords:h,eventRecords:g}=u;let m=null;const p=new Set,f=[];for(const n of h){let{event:i}=n;const s=t||n.resource,a=e||n.event.startDate;if(p.has(i))o&&n.remove();else{if(p.add(i),o)n.meta.isCut=!1,n.resource=s,m=n;else if(c.usesResourceIds||!c.usesSingleAssignment&&"clone"!==r.copyPasteAction){if(!i.resources.includes(s)){const e=n.copy();e.resource=s,[m]=d.add(e)}}else i=i.copy(),i.name=r.generateNewName(i),c.add(i),i.assign(s),m=d.last;i.startDate=a,i.constraintDate&&(i.constraintDate=null),f.push(i)}}i.trigger("paste",{assignmentRecords:h,pastedEventRecords:f,eventRecords:g,resourceRecord:t,date:e,isCut:o,entityName:s});const v=i.ion({renderEvent({assignmentRecord:e}){e===m&&(i.navigateTo(e,{scrollIntoView:!1}),v())}});o&&await r.clearClipboard()}async beforePaste({data:{assignmentRecords:e,eventRecords:t},resourceRecord:n,isCut:r,date:i}){const{scheduler:s}=this,o={assignmentRecords:e,eventRecords:t,resourceRecord:n||e[0].resource,date:i,isCut:r,entityName:this.entityName};let a;if(null!=n&&n.readOnly&&(a="resourceReadOnly"),!s.allowOverlap){e.some((e=>!s.isDateRangeAvailable(e.event.startDate,e.event.endDate,r?e.event:null,e.resource)))&&(a="overlappingEvents")}return a?(s.trigger("pasteNotAllowed",{...o,reason:a}),!1):await this.scheduler.trigger("beforePaste",o)}stringParser(e){const{eventStore:t,assignmentStore:n}=this.scheduler,{modifiedRecords:r}=this.setFromStringData(e,!0,t,this.eventToStringFields),i=[];for(const e of r){const t=new n.modelClass({eventId:e.id});t.event=e,i.push(t)}return{eventRecords:r,assignmentRecords:i}}populateEventMenu({assignmentRecord:e,items:t}){const n=this,{scheduler:r}=n;r.readOnly||(t.copyEvent={text:"L{copyEvent}",localeClass:n,icon:"b-icon b-icon-copy",weight:110,onItem:()=>{const t=r.isAssignmentSelected(e)?r.selectedAssignments:[e];n.copyEvents(t)}},t.cutEvent={text:"L{cutEvent}",localeClass:n,icon:"b-icon b-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>{const t=r.isAssignmentSelected(e)?r.selectedAssignments:[e];n.copyEvents(t,!0)}})}populateScheduleMenu({items:e,resourceRecord:t}){const n=this,{scheduler:r}=n;r.readOnly||!1===n.hasClipboardData()||(e.pasteEvent={text:"L{pasteEvent}",localeClass:n,icon:"b-icon b-icon-paste",disabled:0===r.resourceStore.count||t.readOnly,weight:110,onItem:({date:e,resourceRecord:t})=>{n.pasteEvents(e,t,r.getRowFor(t))}})}generateNewName(e){const t=e.getValue(this.nameField);let n=2;for(;this.client.eventStore.findRecord(this.nameField,`${t} - ${n}`);)n++;return`${t} - ${n}`}}mw.featureClass="b-event-copypaste",mw._$name="EventCopyPaste",Ed.registerFeature(mw,!0,"Scheduler");class pw extends PD{static $name="EventDragCreate";static configurable={validatorFn:()=>!0};get scheduler(){return this.client}get store(){return this.client.eventStore}get project(){return this.client.project}updateLockLayout(e){this.dragActiveCls="b-dragcreating"+(e?" b-dragcreate-lock":"")}handleBeforeDragCreate(e,t,n){var r;const{resourceRecord:i}=e;if(this.disabled||i.readOnly||!this.scheduler.resourceStore.isAvailable(i))return!1;const{scheduler:s}=this,o=(!s.isSchedulerPro||t.ignoreResourceCalendar||i.isWorkingTime(e.mousedownDate))&&s.trigger("beforeDragCreate",{resourceRecord:i,date:e.mousedownDate,event:n});return this.dateConstraints=null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,i,t),o}dragStart(e){var t;const n=this,{client:r}=n,{eventStore:i,assignmentStore:s,enableEventAnimations:o,enableTransactionalFeatures:a}=r,{resourceRecord:l}=e,c=n.createEventRecord(e),d=[l];if(c.set("duration",Gt.diff(c.startDate,c.endDate,c.durationUnit,!0)),c.isCreating=!0,c.meta.isDragCreating=!0,r.features.taskEdit&&r.features.taskEdit.doCancel(),!1===n.handleBeforeDragCreate(e,c,e.event))return!1;n.captureStm(!0);let u=[];return l&&(u=i.usesSingleAssignment||!a?s.assignEventToResource(c,l):[s.createRecord({event:c,resource:l})]),!1===r.trigger("beforeEventAdd",{eventRecord:c,resourceRecords:d,assignmentRecords:u})?(!i.usesSingleAssignment&&a||s.remove(u),!1):(n.lockLayout&&(c.meta.excludeFromLayout=!0),null===(t=r.onEventCreated)||void 0===t||t.call(r,c),r.enableEventAnimations=!1,i.addAsync(c).then((()=>r.enableEventAnimations=o)),!i.usesSingleAssignment&&a&&s.add(u[0]),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,e.itemElement=e.element=r.getElementFromEventRecord(c),Br.isInView(e.itemElement)||r.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:r.barMargin}),super.dragStart(e))}checkValidity(e,t){const n=this,{client:r}=n;return e.resourceRecord=n.dragging.resourceRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&n.createValidatorFn.call(n.validatorFnThisObj||n,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const t=this,{client:n}=t,r=n.isHorizontal?"X":"Y",{timeAxis:i,eventStore:s,weekStartDay:o}=n,{event:a,mousedownDate:l}=e,c=t.draggingEnd=a[`page${r}`]>e.startEvent[`page${r}`],d={name:s.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:c?Gt.floor(l,i.resolution,null,o):l,endDate:c?l:Gt.ceil(l,i.resolution,null,o)};return n.project.isGanttProjectMixin&&Xt.assign(d,{constraintDate:d.startDate,constraintType:"startnoearlierthan"}),s.createRecord(d)}async internalUpdateRecord(e,t){await super.internalUpdateRecord(e,t),this.client.hasEventEditor||(e.eventRecord.isCreating=!1)}async finalizeDragCreate(e){const{meta:t}=e.eventRecord;t.excludeFromLayout=!1,t.isDragCreating=!1;const n=await super.finalizeDragCreate(e);return n?this.hasStmCapture=!1:await this.freeStm(!0),n}async cancelDragCreate(e){await super.cancelDragCreate(e),await this.freeStm(!1)}getTipHtml(...e){const t=super.getTipHtml(...e),{element:n}=this.tip;return n.classList.add("b-sch-dragcreate-tooltip"),n.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),t}onAborted(e){var t,n;const{eventRecord:r,resourceRecord:i}=e;null===(t=(n=this.store).unassignEventFromResource)||void 0===t||t.call(n,r,i),this.store.remove(r)}}pw._$name="EventDragCreate",Ed.registerFeature(pw,!0,"Scheduler"),Ed.registerFeature(pw,!1,"ResourceHistogram");class fw extends(mi(fi)){static $name="EventDragSelect";targetSelector=".b-sch-timeaxis-cell, .b-timeaxissubgrid";construct(e,t){e.multiEventSelect=!0,super.construct(e,t)}static pluginConfig={chain:["onElementMouseDown","onElementMouseMove"]};onElementMouseDown(e){const t=this,{client:n}=t,{foregroundCanvas:r}=n,{target:i,button:s,touches:o,clientX:a,clientY:l}=e,c=wn.from(r,!0);o||0!==s||t.disabled||!i.matches(t.targetSelector)||!1===n.trigger("beforeEventDragSelect",{event:e})||(n.preventDragSelect=!0,t.startX=a-c.x,t.startY=l-c.y,t.element=Br.createElement({tag:"div",className:"b-dragselect-rect",parent:n.foregroundCanvas,retainElement:!0,style:{transform:`translate(${t.startX}px, ${t.startY}px)`}}),n.navigator.disabled=!0,t.mouseUpDetacher=Zn.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t}))}get eventRectangles(){const{client:e}=this;return Array.from(e.foregroundCanvas.children).filter((t=>t.matches(`${e.eventSelector}, .b-nested-events-container`))).map((t=>{const n=e.resolveAssignmentRecord(t);return{rectangle:wn.from(t,!0),record:n,selected:e.selectedAssignments.includes(n)}}))}onElementMouseMove(e){const t=this,{client:n}=t;if("number"==typeof t.startX){const r=t.rectangle=wn.from(t.client.foregroundCanvas,!0),i=Math.min(Math.max(e.clientX-r.x,0),r.width+1),s=Math.min(Math.max(e.clientY-r.y,0),r.height+1),o=new wn(t.startX,t.startY,i-t.startX,s-t.startY);Br.setTranslateXY(t.element,o.x,o.y),t.element.style.width=`${o.width}px`,t.element.style.height=`${o.height}px`,t.dragging||(n.element.classList.add("b-dragselecting"),e.ctrlKey||e.metaKey||n.clearEventSelection(),t.originalSelection=n.selectedAssignments.slice(),t.subGridElementRect=wn.from(n.timeAxisSubGridElement,!0),n.navigator.disabled=!0,n.enableScrollingCloseToEdges(n.timeAxisSubGrid),t.dragging=!0),t.updateSelection()}}onDocumentMouseUp(e){var t;const n=this,{client:r}=n,{selectedAssignments:i,navigator:s}=r;var o;(r.disableScrollingCloseToEdges(r.timeAxisSubGrid),!n.dragging&&r.deselectAllOnScheduleClick&&r.clearEventSelection(),null===(t=n.element)||void 0===t||t.remove(),r.element.classList.remove("b-dragselecting"),n.startX=n.startY=null,s.skipNextClick=r.timeAxisSubGridElement.contains(e.target),s.disabled=!1,n.dragging=!1,i.length)&&(s.skipScrollIntoView=!0,r.activeAssignment=i[i.length-1],null===(o=s.activeItem)||void 0===o||o.focus(),s.skipScrollIntoView=!1);n.mouseUpDetacher()}updateSelection(){const e=this,t=e.rectangle=wn.from(e.element,!0),{eventRectangles:n,client:r}=e,i=r.selectedAssignments.reduce(((e,t)=>(r.getElementFromAssignmentRecord(t)||e.push(t),e)),[]);for(const e of n)t.intersect(e.rectangle,!0)&&(e.selected=!0,i.push(e.record));i.push(...e.originalSelection),r.selectedAssignments=i}}fw._$name="EventDragSelect",Ed.registerFeature(fw,!1,"Scheduler");class vw extends ic{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null,maximizeOnMobile:!0}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain((e=>!e.isSpecialRow),null,{storeClass:ao,excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;if(null!==(t=e.type)&&void 0!==t&&t.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;const{eventEditFeature:n}=this,r={};if("resourceField"===e.ref){const{store:t}=e;e.store=this.chainResourceStore(),t&&e.store.setConfig(t),"multiSelect"in e||(e.multiSelect=!n.eventStore.usesSingleAssignment)}return"startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(r.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(r.format=n.timeFormat),Object.assign(e,r),super.processWidgetConfig(e)}setupEditorButtons(){const{record:e}=this,{deleteButton:t}=this.widgetMap;t&&(t.hidden=this.readOnly||e.isCreating)}onBeforeShow(...e){var t;this.setupUIForEditing(),null===(t=super.onBeforeShow)||void 0===t||t.call(this,...e)}onBeforeToggleReveal({reveal:e}){e&&this.setupUIForEditing()}setupUIForEditing(){const e=this,{record:t,titleRenderer:n}=e;e.setupEditorButtons(),e.title=n?e.callback(n,e,[t]):e.initialTitle}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e)}}vw.initClass(),vw._$name="EventEditor";class yw extends Mc{static $name="RecurrenceFrequencyCombo";static type="recurrencefrequencycombo";static configurable={editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1};buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}}yw.initClass(),yw._$name="RecurrenceFrequencyCombo";class bw extends yw{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){return[{value:"none",text:"L{None}"},...super.buildItems(),{value:this.customValue,text:"L{Custom}",cls:this.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:n,monthDays:r,months:i}=e;return Boolean(t>1||n&&n.length||r&&r.length||i&&i.length)}}bw.initClass(),bw._$name="RecurrenceCombo";class Cw extends $l{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?RD.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}Cw.initClass(),Cw._$name="RecurrenceLegendButton";class Sw extends Mc{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter(((e,t)=>!Gt.nonWorkingDays[t])).join(","),nonWorkingDaysValue:e.filter(((e,t)=>Gt.nonWorkingDays[t])).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=Gt.weekStartDay,n=Gt.getDayNames().map(((e,t)=>({text:e,value:ob.encodeDay(t)})));e._weekDays=n.slice(t).concat(n.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}Sw.initClass(),Sw._$name="RecurrenceDaysCombo";class Dw extends wm{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=ob.decodeDay(e.value)[0];e.text=Gt.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=Gt.weekStartDay,n=Gt.getDayNames().map(((e,t)=>({text:e.substring(0,3),value:ob.encodeDay(t)})));e.__items=n.slice(t).concat(n.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Dw.initClass(),Dw._$name="RecurrenceDaysButtonGroup";class ww extends wm{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let n=e.minValue;n<=e.maxValue;n++)t.push({text:n+"",value:n});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}ww.initClass(),ww._$name="RecurrenceMonthDaysButtonGroup";class Ew extends wm{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return Gt.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=Gt.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Ew.initClass(),Ew._$name="RecurrenceMonthsButtonGroup";class xw extends Mc{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}xw.initClass(),xw._$name="RecurrenceStopConditionCombo";class Rw extends Mc{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return H.populate(this.maxPosition,(e=>({value:e+1,text:this.L(`position${e+1}`)})))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map((e=>parseInt(e,10))):[]}}Rw.initClass(),Rw._$name="RecurrencePositionsCombo";class Tw extends rc{static $name="RecurrenceEditorPanel";static type="recurrenceeditorpanel";static configurable={cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}};setupWidgetConfig(e){return o.isMobile&&!("editable"in e)&&(e.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(e){super.updateRecord(e);const t=this,{frequencyField:n,daysButtonField:r,monthDaysButtonField:i,monthsButtonField:s,monthDaysRadioField:o,positionAndDayRadioField:a,stopRecurrenceField:l}=t.widgetMap;if(e){const n=e.timeSpan,c=null==n?void 0:n.startDate;c&&(e.days&&e.days.length||(r.value=[ob.encodeDay(c.getDay())]),e.monthDays&&e.monthDays.length||(i.value=c.getDate()),e.months&&e.months.length||(s.value=c.getMonth()+1)),e.days&&e.positions?(a.check(),t.isPainted||o.uncheck()):(o.check(),t.isPainted||a.uncheck()),l.recurrence=e}else n.value="NONE"}syncEventRecord(e){const t=this.getValues((t=>t.name in e&&!t.disabled));"endDate"in t||(t.endDate=null),"count"in t||(t.count=null),e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:n}=this.widgetMap;t.disabled=n.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(t)}onFrequencyFieldChange({value:e,oldValue:t,valid:n}){const r=this,i=r.queryAll((e=>"forFrequency"in e)),{intervalField:s,stopRecurrenceField:o}=r.widgetMap;if(n&&e){for(let t=0;t<i.length;t++){const n=i[t];r.isWidgetAvailableForFrequency(n,e)?(n.show(),n.enable()):(n.hide(),n.disable())}s.hidden=o.hidden="NONE"===e,"NONE"!==e&&(s.hint=r.L(`L{RecurrenceEditor.${e}intervalUnit}`)),"NONE"===t&&null==s.value&&(s.value=1),r.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=e;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:n}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),n.value&&"NONE"!==n.value&&(t.hint=this.L(`L{RecurrenceEditor.${n.value}intervalUnit}`)),super.updateLocalization()}}Tw.initClass(),Tw._$name="RecurrenceEditorPanel";class Mw extends ic{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}}Mw.initClass(),Mw._$name="RecurrenceEditor";var kw=e=>class extends(e||ye){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(e){return e.items={...e.items,...this.recurringEventsItems},e=super.changeEditorConfig(e)}doDestroy(){var e,t;null===(e=this._recurrenceConfirmation)||void 0===e||e.destroy(),null===(t=this._recurrenceEditor)||void 0===t||t.destroy(),super.doDestroy()}onEditorConstructed(e){var t;const n=this;e.ion({hide:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&(n.editRecurrenceButton.menu=n.recurrenceEditor),null===(t=n.recurrenceCombo)||void 0===t||t.ion({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(e){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=e)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){var t,n,r,i;const s=e?"show":"hide";null===(t=this.editRecurrenceButton)||void 0===t||null===(n=t[s])||void 0===n||n.call(t),null===(r=this.recurrenceCombo)||void 0===r||null===(i=r[s])||void 0===i||i.call(r)}onRecurringEventEditorHide(){var e,t;null!==(e=this.recurrenceEditor)&&void 0!==e&&e.isVisible&&this.recurrenceEditor.hide(),null!==(t=this.recurrenceConfirmation)&&void 0!==t&&t.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(e){const t=this.eventRecord,n=t.copy();let r=t.recurrence;return r=!e&&r?r.copy():new t.recurrenceModel(e?{rule:e}:{}),r.timeSpan=n,n.setStartDate(this.values.startDate),r.suspendTimeSpanNotifying(),r}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const n=this;n.isEditing&&!e.isCreating&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0)}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$$name||(t=ba.create({type:"recurrenceconfirmation",owner:e.editor,...t}),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(e._recurrenceEditor=t=ba.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,minWidth:"auto",constrainTo:r,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,onBeforeShow:e.onBeforeShowRecurrenceEditor.bind(e),thisObj:e,...t}),t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:n}=e;t&&null!=n&&n.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:n}=t;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),n&&(n.recurrence=e,n.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?n.show():n.hide())}onRecurrenceComboChange({source:e,value:t,userAction:n}){if(n){const n=this,{recurrenceEditor:r}=n;t===e.customValue?(n.recurrenceCombo.recurrence=n.makeRecurrence(),r.centered?r.show():r.show((n.editRecurrenceButton||e).element)):n.loadRecurrenceData(t&&"none"!==t?n.makeRecurrence(`FREQ=${t}`):null)}}recurrenceEditorSaveHandler(e,t){e.recurrenceEditorPanel.syncEventRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){if(super.onDatesChange(...e),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:e}=this.values;e&&(this.editRecurrenceButton.eventStartDate=e)}}internalLoadRecord(e){null!=e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}updateRecord(e){return e.recurrenceRule&&!this.recurrence&&(e.recurrenceRule=null),super.updateRecord(e)}};class Iw extends Mc{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:null,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(e){if(this.owner.showEventColor){const{eventColor:t}=e,n=!Br.isNamedColor(t);return`<div class="b-icon b-icon-square${!t||n?"":` b-sch-foreground-${t}`}"${t?n?` style="color:${t}"`:"":' style="display:none"'}></div>`}return this.multiSelect?'<div class="b-icon b-icon-square"></div>':""}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){var t;this.element.classList.toggle("b-show-event-color",Boolean(e)),null===(t=this._picker)||void 0===t||t.element.classList.toggle("b-show-event-color",Boolean(e))}changePicker(e,t){var n;return null===(n=e=super.changePicker(e,t))||void 0===n||n.element.classList.toggle("b-show-event-color",Boolean(this.showEventColor)),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e;const t=this,{resourceIcon:n,lastResourceIconCls:r}=t,{classList:i}=n,s=(null===(e=t.selected)||void 0===e?void 0:e.eventColor)??"";super.syncInputFieldValue(),n.style.color="",r&&i.remove(r),t.lastResourceIconCls=null,s?(Br.isNamedColor(s)?(t.lastResourceIconCls=`b-sch-foreground-${s}`,i.add(t.lastResourceIconCls)):n.style.color=s,i.remove("b-hide-display")):i.add("b-hide-display")}}Iw.initClass(),Iw._$name="ResourceCombo";class Aw extends Rm{static $name="EventColorField";static type="eventcolorfield";static configurable={picker:{type:"eventcolorpicker"},name:"eventColor"}}Aw.initClass(),Aw._$name="EventColorField";const Fw=/[^\w\d]/g;class Pw extends(BD.mixin(kD,kw,mi)){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600},colorField:{label:"L{SchedulerBase.color}",type:"eventColorField",name:"eventColor",weight:700}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get project(){return this.client.project}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,t,n,r,i;const s=this,o={beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s};let{_editor:a}=s;if(a)return a;a=s._editor=ba.create(s.getEditorConfig());const{startDateField:l,startTimeField:c,endDateField:d,endTimeField:u}=a.widgetMap;return!l&&c&&(c.keepDate=!0,c.label=s.L("Start"),c.flex="1 0 100%"),!d&&u&&(u.keepDate=!0,u.label=s.L("End"),u.flex="1 0 100%"),a.floating||a.positioned||(a.element.parentNode||s.client.add(a),delete o.beforehide,delete o.beforeshow,o.beforeToggleReveal="onBeforeEditorToggleReveal"),a.readOnly=s._readOnly,0===a.items.length&&console.warn("Event Editor configured without any `items`"),a.ion(o),s.scheduler.relayEvents(a,["beforeSetRecord"],"eventEdit"),Object.values(a.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.ion({change:"onDatesChange",thisObj:s})}})),null===(e=s.onEditorConstructed)||void 0===e||e.call(s,a),null===(t=s.eventTypeField)||void 0===t||t.ion({change:"onEventTypeChange",thisObj:s}),null===(n=s.saveButton)||void 0===n||n.ion({click:"onSaveClick",thisObj:s}),null===(r=s.deleteButton)||void 0===r||r.ion({click:"onDeleteClick",thisObj:s}),null===(i=s.cancelButton)||void 0===i||i.ion({click:"onCancelClick",thisObj:s}),a}getEditorConfig(){const e=this,{cls:t,scheduler:n}=e,i=Xt.assign({owner:n,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${n.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:r,cls:t},e.editorConfig);return ba.prototype.getRenderContext(i)[0]&&(i.floating=!1),!1!==i.floating||i.positioned||(i.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},i.collapsed=!0,i.hidden=i.anchor=!1,i.hide=function(){this.collapsible.toggleReveal(!1)}),!n.showEventColorPickers&&i.items.colorField&&(i.items.colorField.hidden=!0),i.onElementCreated=e.updateCSSVars.bind(this),i}updateCSSVars({element:e}){const t=new Date(2e3,12,31,23,55,55),n=Gt.format(t,this.dateFormat).replace(Fw,"").length,r=Gt.format(t,this.timeFormat).replace(Fw,"").length,i=n+r;e.style.setProperty("--date-time-length",`${i}em`),e.style.setProperty("--date-width-difference",(n-r)/2+"em")}async internalShowEditor(e,t,n=null){var r,i;const s=this,{scheduler:o}=s,{useInitialAnimation:a}=o,l=(null===(r=n)||void 0===r||null===(i=r.target)||void 0===i?void 0:i.nodeType)===Element.ELEMENT_NODE?n.target:o.getElementFromEventRecord(e,t),c=e.isPartOfStore(o.eventStore);if((n=n??{target:l,anchor:!0}).target||!c||0===e.resources.length||e.isCreating){var d;o.element.classList.add("b-eventeditor-editing"),s.resourceRecord=t;const{editor:r}=s;s.editingContext={eventRecord:e,resourceRecord:t,eventElement:l,editor:r,isPartOfStore:c},null===(d=super.internalShowEditor)||void 0===d||d.call(this,e,t,n),s.typeField&&s.toggleEventType(e.getValue(s.typeField)),s.loadRecord(e,t),r.collapsed?(await N.sleep(100),await r.collapsible.toggleReveal(!0),r.focus()):!r.centered&&r.anchor&&r.floating?!l||e.isCreating&&a&&!0!==a&&"fade-in"!==a?(r.show(),r.updateCentered(!0)):(s.targetEventElement=l,r.showBy(n)):r.show();const i=o.timeAxisViewModel.timeResolution;if("hour"===i.unit||"minute"===i.unit){const e=`${i.increment}${i.unit}`;s.startTimeField&&(s.startTimeField.step=e),s.endTimeField&&(s.endTimeField.step=e)}s.detachListeners("changesWhileEditing"),o.eventStore.ion({change:s.onChangeWhileEditing,refresh:s.onChangeWhileEditing,thisObj:s,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.editor.autoUpdateRecord||e.isFinalizingEventSave||!e.isEditing||!e.editingContext.isPartOfStore||e.eventRecord.isPartOfStore(e.scheduler.eventStore)||e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{eventEdit:this,...this.editingContext})}updateTargetEventElement(e,t){null==e||e.classList.add("b-editing"),null==t||t.classList.remove("b-editing")}editEvent(e,t,n=null,r=null){var i;const s=this,{client:o}=s,{simpleEventEdit:a}=o.features;if(s.isEditing&&s.resetEditingContext(),!(s.disabled||e.readOnly||e.isCreating&&null!=a&&a.enabled))return!1===o.trigger("beforeEventEdit",{eventEdit:s,eventRecord:e,resourceRecord:t,eventElement:(null===(i=o.getElementFromEventRecord)||void 0===i?void 0:i.call(o,e,t))||n})?(o.element.classList.remove("b-eventeditor-editing"),!1):(r?(s.applyStmCapture(r),s.hasStmCapture=!0,r.transferred=!0):!1===r||o.isCalendar||s.hasStmCapture||s.captureStm(!0),s.doEditEvent(...arguments).then((e=>{if(!(s.isDestroying||s.isEditing||o.isCalendar||s.rejectingStmTransaction))return!1!==e&&s.hasStmCapture?s.freeStm(!1):s.freeStm()})))}get isEditing(){const{_editor:e}=this;return Boolean((null==e?void 0:e.isVisible)&&!(e.collapsed&&!e.revealed))}async doEditEvent(e,t,n=null){const r=this,{scheduler:i}=r,s=e.isCreating;if(t||(t=e.resource||r.resourceStore.getById(e.resourceId)),s&&Iv.prototype.normalize.call(e),n||s||0===e.resources.length)return r.internalShowEditor(e,t,n?{target:n}:null);await i.scrollResourceEventIntoView(t,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}),i.isDestroyed||(await r.internalShowEditor(e,t),i.isDestroyed||i.element.classList.remove("b-eventeditor-editing"))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return null===(e=this._editor)||void 0===e?void 0:e.record}internalLoadRecord(e,t){var n;const r=this,{eventStore:i}=r.client,{editor:s,resourceField:o}=r;if(r.resourceRecord=t,o&&(null===(n=o.store)||void 0===n?void 0:n.masterStore)!==r.resourceStore&&(o.store=s.chainResourceStore()),s.record=e,o){const n=i.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,e.isOccurrence||i.storage.includes(e,!0)||!t?r.assignmentStore&&(r.resourceField.value=n.map((e=>e.getValue(r.resourceField.valueField)))):r.resourceField.value=t.getValue(r.resourceField.valueField),s.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var n;(null===(n=t.dataset)||void 0===n?void 0:n.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,n,r){const i=this,{scheduler:s,assignmentStore:o}=i;o.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):i.resourceField&&o.assignEventToResource(e,t,null,!0),e.isCreating=!1,await s.project.commitAsync(),o.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),n(e)}save(){return new Promise(((e,t)=>{var n;const r=this,{scheduler:i,eventRecord:s}=r;if(!s||!r.editor.isValid)return void e(!1);const{eventStore:o,values:a}=r,l=(null===(n=r.resourceField)||void 0===n?void 0:n.records)||(r.resourceRecord?[r.resourceRecord]:[]);if(!r.scheduler.allowOverlap&&o){let{startDate:t,endDate:n}=a;n||(n="duration"in a?Gt.add(t,a.duration,a.durationUnit||s.durationUnit):"fullDuration"in a?Gt.add(t,a.fullDuration):s.endDate);if(l.some((e=>!o.isDateRangeAvailable(t,n,s,e))))return void e(!1)}const c={finalize(n){try{!1!==n?r.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}},d=i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:a,context:c});function u(t,n,i){!1===t?e(!1):(r.onRecurrableEventBeforeSave({eventRecord:n,context:i}),i.async||i.finalize())}Xt.isPromise(d)?d.then((e=>u(e,s,c))):u(d,s,c)}))}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise(((e,t)=>{const{eventRecord:n,editor:r}=this;this.scheduler.removeEvents([n],(t=>{t&&r.containsFocus&&r.revertFocus(),e(t)}),r)}))}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:n}){this.editEvent(e,t,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n,stmCapture:r}){this.editEvent(e,t,n,r)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:n}){const{client:r}=this,i=n[n.matches(r.eventSelector)?"querySelector":"closest"](r.eventInnerSelector);e?this.editEvent(t,e.resource,i):t&&this.editEvent(t,t.resource,i)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:n}){this.scheduler.readOnly||this.disabled||(n.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,t)}})}onBeforeEditorToggleReveal({reveal:e}){e&&this.editor.setupEditorButtons(),this[e?"onBeforeEditorShow":"resetEditingContext"]()}async resetEditingContext(){const e=this;e.detachListeners("changesWhileEditing"),super.resetEditingContext(),!e.hasStmCapture||e.isDeletingEvent||e.isCancelingEdit||await e.freeStm(!1),e.resourceRecord=null}finalizeStmCapture(e){return this.freeStm(!e)}updateLocalization(){this._editor&&this.updateCSSVars({element:this._editor.element}),super.updateLocalization(...arguments)}}Pw._$name="EventEdit",Ed.registerFeature(Pw,!0,"Scheduler"),Ed.registerFeature(Pw,!1,["SchedulerPro","ResourceHistogram"]),Pw.initClass();class Ow extends fi{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{type:"popup",localeClass:t,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,internalListeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:e}){const[n]=e.items,r=t.store.filters.getBy("property","name");n.value=(null==r?void 0:r.value)||""}}}}onEventFilterChange({value:e}){""!==e?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}}Ow.featureClass="b-event-filter",Ow._$name="EventFilter",Ed.registerFeature(Ow,!0,["Scheduler","Gantt"]),Ed.registerFeature(Ow,!1,"ResourceHistogram");class Lw extends HD{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var t;const n=super.getDataFromEvent(e),r=n.targetElement,{client:i}=this,s=i.resolveEventRecord(r),o=s&&(null===(t=i.resolveResourceRecord(r)||this.resourceStore.last)||void 0===t?void 0:t.$original),a=s&&i.resolveAssignmentRecord(r);return Object.assign(n,{date:i.getDateFromXY([e.pageX,e.pageY],null,!1),eventElement:r,eventRecord:s,resourceRecord:o,assignmentRecord:a})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:n}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&Br.triggerMouseEvent(t,this.triggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){const{client:r}=this;e.deleteEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly},e.unassignEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly||r.eventStore.usesSingleAssignment},r.showEventColorPickers||r.showTaskColorPickers?e.eventColor={disabled:t.readOnly,hidden:r.readOnly}:e.eventColor={hidden:!0}}populateItemsWithData({items:e,eventRecord:t}){var n;super.populateItemsWithData(...arguments);const{client:r}=this;(r.showEventColorPickers||r.isSchedulerPro&&r.showTaskColorPickers)&&null!==(n=e.eventColor)&&void 0!==n&&n.menu&&p.merge(e.eventColor.menu.colorMenu,{value:t.eventColor,record:t})}changeItems(e){const{client:t}=this;return p.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:e,eventRecord:n}){var r;const i=null===(r=e.focusInEvent)||void 0===r?void 0:r.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeEvents(t.isEventSelected(n)?t.selectedEvents:[n])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:e,eventRecord:n,resourceRecord:r}){var i;const s=null===(i=e.focusInEvent)||void 0===i?void 0:i.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),t.isEventSelected(n)?t.assignmentStore.remove(t.selectedAssignments):n.unassign(r)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},e)}}Lw.featureClass="",Lw._$name="EventMenu",Ed.registerFeature(Lw,!0,"Scheduler"),Ed.registerFeature(Lw,!1,"ResourceHistogram");var $w=e=>class extends e{static $name="NonWorkingTimeMixin";static configurable={maxTimeAxisUnit:"week"};getNonWorkingTimeRanges(e,t,n){const r=n.getTime()-t.getTime()+864e5;if(!e.getNonWorkingTimeRanges){const i=[];return e.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0,maxRange:r},((e,t,n)=>{for(const[r,s]of n.intervalGroups)s.getIsWorking()||i.push({name:r.name,iconCls:r.iconCls,cls:r.cls,startDate:e,endDate:t})})),i}return e.getNonWorkingTimeRanges(t,n,r)}getCalendarTimeRanges(e,t=!1){const n=this,{timeAxis:r,fillTicks:i}=n.client,{unit:s,increment:o}=r,a=!n.maxTimeAxisUnit||Gt.compareUnits(s,n.maxTimeAxisUnit)<=0;if(e&&a&&r.count){const a=n.getNonWorkingTimeRanges(e,r.startDate,r.endDate).map((e=>new Iv({name:e.name,cls:`b-nonworkingtime ${e.cls||""}`,startDate:e.startDate,endDate:e.endDate})));let l=[],c=null;for(const e of a)c&&e.startDate<=c.endDate&&(t||e.name===c.name)&&e.duration>0?c.endDate=e.endDate:(l.push(e),e.setData("id",`nonworking-${l.length}`),c=e);return i&&(l=l.filter((e=>!Gt.isSameDate(e.startDate,e.endDate)&&Gt.ceil(e.startDate,{magnitude:o,unit:s})<Gt.floor(e.endDate,{magnitude:o,unit:s}))),l.forEach((e=>e.setStartEndDate(Gt.ceil(e.startDate,{magnitude:o,unit:s}),Gt.floor(e.endDate,{magnitude:o,unit:s}))))),l}return[]}setupDefaultCalendar(){const{client:e,project:t}=this;this.autoGeneratedWeekends||e.isSchedulerPro||e.isGantt||t.effectiveCalendar!==t.defaultCalendar||t.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,n=Boolean(t.length);e.ignoreTimeZone=!0,e.clearIntervals(n),n&&e.addIntervals(t)}}updateLocalization(){var e;null===(e=super.updateLocalization)||void 0===e||e.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return Gt.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:`on ${e[t]} at 0:00`,recurrentEndDate:`on ${e[(t+1)%7]} at 0:00`,isWorking:!1})))}};class _w extends(fi.mixin(ZS,$w)){static $name="EventNonWorkingTime";static pluginConfig={chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]};static get properties(){return{calendarRangeCache:new Map}}doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const t=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.client.isScheduler&&t.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,t,n,r){const{client:i}=this,{rtl:s}=i,o=i.getCoordinateFromDate(Gt.max(e.startDate,t))-r,a=e.endDate?i.getCoordinateFromDate(Gt.min(e.endDate,n))-r:o,l=Math.abs(a-o),c=l>0,d=s?`calc(${o}px - 100%)`:`${o}px`;return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":s},dataset:{id:e.id},elementData:{timeRange:e},style:i.isVertical?`transform: translateY(${d}); ${c?`height:${l}px`:""};`:`transform: translateX(${d}); ${c?`width:${l}px`:""};`}}getCalendarTimeRanges(e){let t=this.calendarRangeCache.get(e);return t||(t=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,t)),t}onEventDataGenerated({eventRecord:e,endMS:t,startMS:n,start:r,end:i,left:s,top:o,children:a}){if(this.enabled){const{isVertical:l}=this.client,c=e.effectiveCalendarsCombination??this.client.project.calendar;for(const e of this.getCalendarTimeRanges(c))if(e.startDateMS<t&&e.endDateMS>n){const t=this.getRangeDomConfig(e,r,i,l?o:s);a.push(t)}}}}_w._$name="EventNonWorkingTime",Ed.registerFeature(_w,!1,"Scheduler");const jw=[0,0],Bw=[null,[0,10],[10,0]];class Vw extends ND{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?$.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,t){super.construct(e,t),"string"==typeof this.align&&(this.align={align:this.align})}onInternalPaint({firstPaint:e}){if(super.onInternalPaint(...arguments),e){const{dependencies:e}=this.client.features;e&&this.tooltip.ion({beforeAlign({source:t,offset:n=jw}){const{edgeAligned:r}=Sn(t.align.align),i=e.disabled||!e.allowCreate?jw:Bw[r];arguments[0].offset=[n[0]+i[0],n[1]+i[1]]}})}}}Vw._$name="EventTooltip",Ed.registerFeature(Vw,!0,"Scheduler"),Ed.registerFeature(Vw,!1,"ResourceHistogram");const Hw={update:1,filter:1},Nw={add:1,remove:1,update:1,removeAll:1,filter:1};class zw extends Gf{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),!n.summaries&&n.renderer&&(n.summaries=[{renderer:n.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:n.onEventStoreChange,thisObj:n}),e.assignmentStore.ion({changePreCommit:n.onAssignmentStoreChange,thisObj:n}),e.ion({timeAxisViewModelUpdate:n.onTimeAxisChange,thisObj:n}),e.project.ion({dataReady:n.onProjectDataReady,thisObj:n}))}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach((e=>{e.isGroupFooter&&e.render()}))}onEventStoreChange({action:e,records:t,changes:n}){if(Hw[e]){const e=new Set;t.forEach((t=>t.resources.forEach((t=>e.add(t))))),this.afterChange(e)}}onAssignmentStoreChange({action:e,records:t,changes:n}){if(Nw[e]){var r;const e=new Set;if(t.forEach((t=>t.resource&&e.add(t.resource))),null!=(null==n||null===(r=n.resourceId)||void 0===r?void 0:r.oldValue)){const t=this.scheduler.resourceStore.getById(n.resourceId.oldValue);t&&e.add(t)}this.afterChange(e)}}afterChange(e){const{resourceStore:t}=this.scheduler;for(const n of e){let e=n;if("header"===this.target)for(;e&&!e.isGroupHeader;)e=t.getPrev(e);else for(;e&&!e.isGroupFooter;)e=t.getNext(e);const r=this.scheduler.rowManager.getRowFor(e);e&&r&&this.footersToUpdate.add(r)}}onProjectDataReady(){const{footersToUpdate:e,client:t}=this;if(t.isVisible){if(e.size){for(const t of e){var n;null===(n=t.render)||void 0===n||n.call(t)}e.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,n,r,i,s){if("timeAxis"===e.type){const e=this,{scheduler:n}=e,{eventStore:o}=n,a=n.timeAxisViewModel.columnConfig;let l="";const c=n.getResourcesEventsPerTick(t,(({event:e})=>e.resources.some((e=>t.includes(e)))&&(!o.isFiltered||o.records.includes(e))));return n.timeAxis.forEach(((d,u)=>{const h=c[u]||[],g=e.summaries.map((e=>`<div class="b-timeaxis-summary-value">${e.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:n.resourceStore,events:h,resources:t,eventStore:o,groupRecord:r,groupField:i,groupValue:s})}</div>`)).join("");l+=`<div class="b-timeaxis-tick" style="width: ${a[a.length-1][u].width}px">${g}</div>`})),`<div class="b-timeaxis-group-summary">${l}</div>`}return super.generateHtml(e,t,n,r,i,s)}updateSummaryHtml(e,t,n){const r=super.updateSummaryHtml(e,t,n);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return r}getTipHtml({activeTarget:e}){const t=this,n=Array.from(e.parentElement.children).indexOf(e),r=t.scheduler.timeAxis.getAt(n);let i=`<header>${t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(r.startDate))}</header>`,s=!1;return Br.forEachSelector(e,".b-timeaxis-summary-value",((e,n)=>{const r=t._labels[n],o=e.innerText.trim();i+=`<label>${r||""}</label><div class="b-timeaxis-summary-value">${o}</div>`,e.innerHTML&&(s=!0)})),s?i:null}render(){const e=this,{scheduler:t}=e;var n;t.isSchedulerBase&&(null!==(n=e.summaries)&&void 0!==n&&n.some((e=>e.label))&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map((e=>e.label||"")),e._tip=new lc({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:e.getTipHtml.bind(e)})))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}}zw._$name="GroupSummary",Ed.registerFeature(zw,!1,"Scheduler");class Ww extends fi{static $name="HeaderZoom";static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this;if(!e.touches&&0===e.button&&!t.disabled&&e.target.closest(".b-sch-header-timeaxis-cell")){const n=t.client.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=Br.createElement({parent:n,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=wn.from(n),Zn.on({element:document,mouseup:"onMouseUp",thisObj:t,once:!0})}}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const n=Math.max(e.clientX,t.headerElementRect.left),r=Math.min(t.startX,n),i=Math.abs(t.startX-n),s=new wn(r-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);Br.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if("number"==typeof e.startX){const{client:t}=e,n=wn.from(e.element),r=t.getDateFromCoordinate(n.left,"round",!1),i=t.getDateFromCoordinate(n.right,"round",!1);e.element.remove(),e.startX=null,t.zoomToSpan({startDate:r,endDate:i})}}}Ww._$name="HeaderZoom",Ed.registerFeature(Ww,!1,"Scheduler");const Uw=["top","before","after","bottom"],Gw=(e,t)=>{switch(e){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},Yw={top:1,bottom:1},qw={estimate:1,measure:1},Kw={before:1,after:1};class Xw extends fi{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),(n.top||n.bottom||n.before||n.after)&&n.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:n}=this.scheduler.element;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,n=e.target;if(n&&!t.scheduler.readOnly){const{side:r}=n.dataset,i=t[r],{editor:s,field:o}=i;if(s){const a=this.scheduler.resolveEventRecord(e.target);if(a.readOnly)return;return s instanceof zm||(i.editor=new zm({blurAction:t.blurAction,inputField:s,scrollAction:"realign"})),i.editor.render(t.scheduler.element),i.editor.startEdit({target:n,align:Gw(r,t.client),matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.setPrototypeOf({},e)}const{scheduler:n}=this,{eventStore:r,resourceStore:i,taskStore:s,id:o}=n,{field:a,editor:l}=e;if(Yw[t]&&(n.milestoneWidth=null),e.recordType=r&&!s?"event":"task",a){let t;r&&!s&&(t=r.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(r.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?n.editor={type:"textfield"}:"string"==typeof l&&(n.editor={type:l}),Zn.on({element:n.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,n=[];for(const r of Uw)if(t[r]){const{field:i,fieldDef:s,recordType:o,renderer:a,thisObj:l}=t[r],c={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${r}`]:1},dataset:{side:r,taskFeature:`label-${r}`}};let d;const u=`${o}Record`,h=e[u];a?d=a.call(l||t.thisObj||t,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h.getValue(i),d="date"!==(null==s?void 0:s.type)||a?$.encodeHtml(d):Gt.format(d,t.client.displayDateFormat)),c.html=d||" ",n.push(c)}return n}measureLabels(e,t){const n=this,r=n.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of e)if(Kw[i.dataset.side]){let{html:e}=i,s=0;if("estimate"===n.labelLayoutMode)e.includes("<")&&(e=Br.stripTags(e)),s=e.length*n.labelCharWidth+18;else{const e=n.labelMeasureElement||(n.labelMeasureElement=Br.createElement({className:"b-sch-event-wrap b-measure-label",parent:n.client.foregroundCanvas}));e.retainElement=!0,To.sync({targetElement:e,domConfig:{onlyChildren:!0,children:[i]}}),s=e.firstElementChild.offsetWidth}const o=s/r;switch(i.dataset.side){case"before":t.startMS-=o;break;case"after":t.endMS+=o}}}onEventDataGenerated(e){var t;if(!(this.disabled||null!==(t=e.eventRecord)&&void 0!==t&&t.isResourceTimeRange)){const t=this.generateLabelConfigs(e);qw[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}Xw.featureClass="b-sch-labels",Xw._$name="Labels",Ed.registerFeature(Xw,!1,"Scheduler");class Zw extends(zD.mixin(ZS,$w)){static $name="NonWorkingTime";static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}static pluginConfig={chain:["onInternalPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]};doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){_.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){this.isConfiguring||"fillTicks"!==e||this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.graph||this.client.isScheduler||e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:n,client:r}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>t.setTimeout((()=>t.refresh()),1)})),!r.isEngineReady||r.project.isDelayingCalculation||r.isDestroying?n.isDestroyed||(t.detachListeners("initialProjectListener"),n.ion({name:"initialProjectListener",refresh({isCalculated:e}){!1!==e&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=Gt.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}Zw._$name="NonWorkingTime",Ed.registerFeature(Zw,!1,"Scheduler"),Ed.registerFeature(Zw,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class Jw extends fi{static $name="Pan";static configurable={horizontal:!0,vertical:!0,enableInHeader:!0};get targetSelector(){return".b-sch-timeaxis-cell,.b-timeline-subgrid"+(this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":"")}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const t=this,{client:n}=t,{button:r,touches:i,target:s,clientX:o,clientY:a}=e,l=n.features.taskDrag||n.features.eventDrag,c=n.readOnly||!(null!=l&&l.enabled);i||0!==r||t.disabled||!1===n.trigger("beforePan",{event:e})||(s.matches(t.targetSelector)||c&&s.closest(n.eventSelector))&&(t.mouseX=o,t.mouseY=a,t.onHeader=t.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),t.mouseDetacher=Zn.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(e){const t=this,{client:n}=t,r=n.timeAxisSubGrid.scrollable,i=n.scrollable,s=e.clientX,o=e.clientY;e.preventDefault(),!t.vertical||!n.isVertical&&t.onHeader||i.scrollBy(0,t.mouseY-o),!t.horizontal||!n.isHorizontal&&t.onHeader||r.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=o}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return Boolean(this.mouseDetacher)}}Jw._$name="Pan",Ed.registerFeature(Jw,!1,["Scheduler","Gantt"]);class Qw extends Gh{static $name="ResourceMenu";static configurable={processItems:null,items:null,type:"resource"};static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateResourceMenu"),e}getDataFromEvent(e){const t=e.target.closest(".b-resourceheader-cell"),n=null==t?void 0:t.dataset.resourceId;if(n){return{cellElement:t,resourceRecord:this.client.resourceStore.getById(n)}}}populateResourceMenu({items:e,resourceRecord:t}){const{client:n}=this;n.readOnly||(e.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>n.resourceStore.remove(t)})}get showMenu(){return!0}}Qw.featureClass="",Qw._$name="ResourceMenu",Ed.registerFeature(Qw,!1,["Scheduler"]);class eE extends VD{static $name="ResourceTimeRanges";static configurable={rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"};static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(e){const t=this,{client:n}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=n.resourceTimeRangeStore||new xC({owner:t});const{crudManager:r}=n;r&&!r.resourceTimeRangeStore&&(r.resourceTimeRangeStore=e.resourceTimeRangeStore)}const r=e.resourceTimeRangeStore;t.exposedOnScheduler||(n.resourceTimeRanges&&(r.add(n.resourceTimeRanges),delete n.resourceTimeRanges),Object.defineProperty(n,"resourceTimeRanges",{get:()=>r.records,set:e=>r.data=e}),t.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=e.resourceStore),t.detachListeners("store"),r.ion({name:"store",change:t.onStoreChange,thisObj:t})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,t){if(!this.disabled){const{timeRanges:n}=e.$original;if(null!=n&&n.length){const{startDate:e,endDate:r}=this.client;n.forEach((n=>{n.isRecurring?t.push(...n.getOccurrencesForDateRange(e,r)):t.push(n)}))}}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}renderContent(e,t){const{client:n}=this,{eventContent:r}=t;if(n.resourceTimeRangeRenderer){const i=n.resourceTimeRangeRenderer({resourceTimeRangeRecord:e,resourceRecord:t.resourceRecord,renderData:t});Array.isArray(i)?r.children=i:$.isHtml(i)?(r.children=null,r.html=i):"string"==typeof i||"object"==typeof i?r.children=[i]:null!=i&&(r.text=i)}else super.renderContent(...arguments)}doDestroy(){var e;(null===(e=this.store)||void 0===e?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}}eE.featureClass="",eE._$name="ResourceTimeRanges",Ed.registerFeature(eE,!1,"Scheduler");class tE extends(AD(tv)){static $name="RowReorder";onDragStart(...e){if(super.onDragStart(...e),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...e){return this.rejectFeatureTransaction(),super.onDrop(...e)}onAbort(...e){return this.rejectFeatureTransaction(),super.onAbort(...e)}}tE._$name="RowReorder",Ed.registerFeature(tE,!1,"Scheduler"),Ed.registerFeature(tE,!0,"Gantt");class nE extends nv{static $name="RowResize";onResizeStart({context:e}){super.onResizeStart(...arguments);const{client:t}=this,{record:n}=e;var r,i,s;t.isTimelineBase&&(t.suspendAnimations(),null===(r=t.crudManager)||void 0===r||null===(i=r.suspendAutoSync)||void 0===i||i.call(r),t.features.eventDragCreate&&(this._oldDragCreateDisabled=t.features.eventDragCreate.disabled,t.features.eventDragCreate.disabled=!0));t.isSchedulerBase&&("stack"===(null===(s=t.getEventLayout)||void 0===s?void 0:s.call(t,n).type)&&(e.oldEventLayout=n.eventLayout,n.eventLayout="pack",n.rowHeight=e.elementHeight),e.originalBarMargin=t.getBarMargin(n),e.originalResourceMarginObject=t.getResourceMarginObject(n),e.originalRecordResourceMargin=n.resourceMargin)}onResizing({context:e}){const{record:t,newHeight:n,elementHeight:r,originalBarMargin:i,originalResourceMarginObject:s}=e;if(super.onResizing(...arguments),!this.applyToAllRows&&!this.client.fixedRowHeight&&e.valid){if(t.beginBatch(),t.rowHeight=n,n<r){const e=n/r;t.barMargin=i*e,s.start===s.end&&(t.resourceMargin=s.start*e)}t.endBatch()}}onCancel({context:e}){e.record.eventLayout=e.oldEventLayout,e.record.resourceMargin=e.originalRecordResourceMargin,e.record.barMargin=e.originalBarMargin,super.onCancel(...arguments)}cleanup(){const{client:e}=this;var t,n;e.isTimelineBase&&(e.resumeAnimations(),null===(t=e.crudManager)||void 0===t||null===(n=t.resumeAutoSync)||void 0===n||n.call(t),e.features.eventDragCreate&&(e.features.eventDragCreate.disabled=this._oldDragCreateDisabled));super.cleanup()}}nE._$name="RowResize",Ed.registerFeature(nE,!1);class rE extends HD{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{targetElement:n,resourceRecord:r}=e,i=t.timeAxisSubGridElement.contains(n);return!n.closest(t.eventSelector)&&i&&!(r&&r.isSpecialRow)}getDataFromEvent(e){if(Br.isDOMEvent(e)){var t,n;const{client:r}=this,i=null===(t=r.getCellDataFromEvent)||void 0===t?void 0:t.call(r,e),s=null===(n=r.getDateFromDomEvent)||void 0===n?void 0:n.call(r,e,"floor"),o=r.resolveResourceRecord(e)||r.isVertical&&r.resourceStore.last;return Xt.assign(super.getDataFromEvent(e),i,{date:s,resourceRecord:o})}return e}populateScheduleMenu({items:e,resourceRecord:t,date:n}){const{client:r}=this;!r.readOnly&&r.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!t||t.readOnly||!t.isWorkingTime(n),weight:100,onItem(){r.createEvent(n,t,r.getRowFor(t))}})}}rE.featureClass="",rE._$name="ScheduleMenu",Ed.registerFeature(rE,!0,"Scheduler");class iE extends fi{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}onInternalPaint({firstPaint:e}){if(!e)return;const t=this,{client:n}=t;let r;n.isSchedulerPro&&t.hideForNonWorkingTime===i&&(t.hideForNonWorkingTime=!0);const s=t.hoverTip=new lc({id:`${n.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:n.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event,.b-dragcreating,.b-creating-dependency) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){s.forElement.contains(e.event.target)&&(r=Zn.on({thisObj:t,element:n.timeAxisSubGridElement,mousemove:e=>s.internalOnPointerOver(e),capture:!0}));const i=s.hideAnimation;s.hideAnimation=!1,s.constructor.prototype.onDocumentMouseDown.call(s,e),s.hideAnimation=i},...t.config,internalListeners:t.configuredListeners});s.ion({pointerover({event:e}){const n="buttons"in e?e.buttons>0:e.which>0;return!n&&r&&r(),!t.disabled&&!n},innerhtmlupdate({source:e}){t.clockTemplate.updateDateIndicator(e.element,t.lastTime)}}),n.ion({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new xu({scheduler:n})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const n=this,r=n.client,i=t&&r.getDateFromDomEvent(t,"floor",!0);let s=n.lastHtml;if(i&&t.target){const o=r.resolveResourceRecord(t);if(o&&(i-n.lastTime!=0||o.id!==n.lastResourceId)){if(n.hideForNonWorkingTime){const t=o.isWorkingTime(i);e.element.classList.toggle("b-nonworking-time",!t)}n.lastResourceId=o.id,s=n.lastHtml=n.generateTipContent({date:i,event:t,resourceRecord:o})}}else e.hide(),n.lastTime=null,n.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:n}){const r=this,i=r.clockTemplate.generateContent({date:e,text:r.client.getFormattedDate(e)}),s=r.messageTemplate({message:r.getText(e,t,n)||""});return r.lastTime=e,i+s}getText(e,t,n){}}iE.featureClass="b-scheduletip",iE._$name="ScheduleTooltip",Ed.registerFeature(iE,!0,"Scheduler"),Ed.registerFeature(iE,!1,"ResourceUtilization");class sE extends(fi.mixin(kD)){static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const n=this;n.scheduler=e,e.eventEdit=n,super.construct(e,t),n.clientListenersDetacher=e.ion({[n.triggerEvent]:({eventRecord:e,eventElement:t})=>n.editEvent(e,e.resource,t),dragcreateend:n.onDragCreateEnd,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}get project(){return this.client.project}async editEvent(e,t,n,r){const i=this,{scheduler:s}=i,{eventEdit:o}=i.client.features;if(s.readOnly||i.disabled||e.readOnly||o&&!o.disabled&&!e.isCreating)return;let{editor:a}=i;n=Br.down(n,s.eventInnerSelector)||n,e=e.isAssignment?e.event:e,i.resource=t,i.event=e,i.element=n,s.element.classList.add("b-eventeditor-editing"),a?a.render(s.timeAxisSubGridElement):(i.editor=a=zm.new({owner:s.timeAxisSubGrid,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:s.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:i},onInternalKeyDown:e=>e.stopPropagation()},i.editorConfig),i.relayEvents(i.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),r?(i.stmInitiallyAutoRecord=r.stmInitiallyAutoRecord,i.stmInitiallyDisabled=r.stmInitiallyDisabled,i.hasStmCapture=!0,r.transferred=!0):!1===r||i.hasStmCapture||i.captureStm(!0),e.isCreating&&(e.name=""),await a.startEdit({target:n,record:e,field:i.field}),s.isVertical&&e.startDate<s.visibleDateRange.startDate&&a.element.scrollIntoView(),s.navigator.disabled=!0}onEditorComplete(){this.event.isCreating=!1,this.reset(),this.freeStm(!0)}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset(),this.freeStm(!1)}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const n=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),r=(e||t).resource;this.editEvent(t,r,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,eventElement:n,stmCapture:r}){this.element=n,this.editEvent(e,t,n,r)}}sE._$name="SimpleEventEdit",Ed.registerFeature(sE,!1,"Scheduler");const oE=Object.freeze({animate:!1,block:"start"}),aE=Object.freeze({animate:!1,block:"end"});class lE extends hv{static $name="Split";static configurable={relayProperties:{value:{barMargin:1,eventColor:1,eventStyle:1,eventLayout:1,fillTicks:1,resourceMargin:1,snap:1,tickSize:1},$config:{merge:"merge"}}};static pluginConfig={chain:["populateCellMenu","populateScheduleMenu","afterConfigChange","afterAddListener","afterRemoveListener"],assign:["split","unsplit","subViews","syncSplits"]};getClientConfig(e,t,n,r){var i;const{client:s}=this,o=super.getClientConfig(e,t,n,r);return s.isSchedulerBase||s.isSchedulerProBase||s.isGanttBase?(delete o.store,delete o.events,delete o.resources,delete o.assignments,delete o.dependencies,delete o.resourceTimeRanges,delete o.timeRanges,o.project=s.project,o.assignmentStore=o.project.assignmentStore,o.crudManager=s.crudManager,o.viewPreset=s.viewPreset,o.startDate=s.startDate,o.endDate=s.endDate,o.selectedCollection=s.selectedCollection,o.useInitialAnimation=!1,!1!==(null===(i=o.features)||void 0===i?void 0:i.eventDrag)&&(Xt.setPath(o,"features.eventDrag.constrainDragToTimeline",!1),s.features.eventDrag.constrainDragToTimeline=!1),o):o}unsplitCleanup(e){this.client.timeAxisSubGrid.onElementResize()}processOptions(e){const{client:t}=this;let{atDate:n,atRecord:r}=e;if("horizontal"!==e.direction&&!e.atColumn&&!e.atRecord&&!n){const r=wn.from(t.element),i=t.getDateFromCoordinate(r.center.x,"round",!1);i&&(e.atDate=n=i,e.atColumn=t.timeAxisColumn)}return n&&(e.direction||(e.direction=r?"both":"vertical"),e.splitX=t.getCoordinateFromDate(n,{ignoreRTL:!0})-t.timeAxisSubGrid.scrollable.x,t.rtl?e.splitX+=t._bodyRectangle.width-wn.from(t.timeAxisSubGridElement).right+Br.scrollBarWidth:e.splitX+=wn.from(t.timeAxisSubGridElement,t.bodyContainer).left,e.remainingWidth=wn.from(t.element).width-e.splitX),super.processOptions(e)}async split(e={}){const{client:t}=this;if(t.isVertical)throw new Error("Splitting is not supported in vertical mode");const n=await super.split(e);return n&&e.atDate&&await Promise.all([n[0].scrollToDate(Gt.add(e.atDate,-1,t.timeAxis.unit),aE),n[1].scrollToDate(e.atDate,oE)]),t.timeAxisSubGrid.scrollable.x+=.5,n}populateCellMenu(){}populateScheduleMenu({items:e,date:t,record:n}){const r=this,{isSplit:i}=r,{splitFrom:s}=r.client;!r.disabled&&r.client.isHorizontal&&(e.splitSchedule={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:i||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:n,direction:"horizontal"}).then()}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atDate:t}).then()}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atDate:t,atRecord:n,direction:"both"}).then()}}}},e.unsplitSchedule={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(i||s),weight:550,onItem(){(s||r).unsplit()}})}}lE._$name="Split",Ed.registerFeature(lE,!1,"Scheduler");const cE={width:0,height:0};class dE extends fi{static $name="StickyEvents";static type="stickyEvents";static pluginConfig={chain:["onEventDataGenerated"]};construct(e,t){super.construct(e,t),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=!1===e.eventRecord.stickyContents:(this.syncEventContentPosition(e,i,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)Br.applyStyle(e,t);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const e of t.values())for(const{renderData:t,elementConfig:n}of Object.values(e)){const e=[t];n&&t.eventRecord.isResourceTimeRange&&e.push(n.children[0]),this.syncEventContentPosition.apply(this,e)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,t=e.eventContent,n=!1){if(this.disabled||!1===e.eventRecord.stickyContents)return;const{client:r}=this,{eventRecord:i,resourceRecord:s,useEventBuffer:o,bufferAfterWidth:a,bufferBeforeWidth:l,top:c,height:d}=e,u=r.scrollable.y,h=n?null:r.getElementFromEventRecord(i,s,!0),g=h&&To.getChild(h,"event.content"),m=i.instanceMeta(r),p="string"==typeof t.style?t.style=Br.parseStyle(t.style):t.style||(t.style={});if(null!=h&&h.classList.contains("b-dragging"))return;let f=c,v=d,y=f+v;if(o&&(f+=l,v=v-l-a,y=f+v),f<u&&y>=u&&!i.isMilestone){const t=null==g?void 0:g.offsetWidth,n="center"===((null==g?void 0:g.parentNode)&&Br.getStyleValue(g.parentNode,"justifyContent"))?(e.width-t)/2:0,r=f;if((!g||t)&&r<u&&r+v-1>=u){const e=this.getEventContentMargins(g),t=g?v-g.offsetHeight-e.height-n:Number.MAX_SAFE_INTEGER,i=Math.min(u-r,t-2);p.transform=i>0?`translateY(${i}px)`:"",m.stuck=!0}else p.transform="",m.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:p})}else g&&m.stuck&&(p.transform="",m.stuck=!1,this.toUpdate.add({contentEl:g,style:p}))}getEventContentMargins(e){return null!=e&&e.classList.contains("b-sch-event-content")?Br.getEdgeSize(e,"margin"):cE}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}}dE._$name="StickyEvents",Ed.registerFeature(dE,!0,"Scheduler"),Ed.registerFeature(dE,!1,"ResourceHistogram");class uE extends gv{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,t){const n=this;super.construct(e,t),n.summaries||(n.summaries=[{renderer:n.renderer}]),e.isTimelineBase&&(n.updateProject(e.project),e.ion({timeAxisViewModelUpdate:n.renderRows,thisObj:n}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:t}=e,n=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((e=>e.label))&&(e._tip=new lc({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),i.innerHTML=r[r.length-1].map((e=>`<div class="b-timeaxis-tick" style="${n}: ${e.width}px"></div>`)).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var t;const{isConfiguring:n}=this.client;super.doDisable(e),null===(t=this.summaryColumn)||void 0===t||t.toggle(!e),n||e||this.render()}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}}uE._$name="TimelineSummary";class hE extends uE{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,t){const n=this;n.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),n.summaryColumn=e.columns.add(Xt.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:n.disabled},n.verticalSummaryColumnConfig))[0]),super.construct(e,t),e.isSchedulerBase&&(n.updateEventStore(e.eventStore),n.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t}=e,{eventStore:n,timeAxis:r}=t,i=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){const o=t.getResourcesEventsPerTick(s,(({event:e})=>!n.isFiltered||n.records.includes(e)));Array.from(i.children).forEach(((i,s)=>{const a=r.getAt(s),l=o[s]||[];let c="",d=`<header>${e.L("L{Summary for}",t.getFormattedDate(a.startDate))}</header>`;e.summaries.forEach((r=>{const s=r.renderer({startDate:a.startDate,endDate:a.endDate,resourceStore:t.resourceStore,eventStore:n,events:l,element:i}),o=s?`<div class="b-timeaxis-summary-value">${s}</div>`:"";(e.summaries.length>1||s)&&(c+=o),d+=o?`<label>${r.label||""}</label>`+o:""})),i.innerHTML=c,i._tipHtml=c?d:""}))}}}hE._$name="Summary",Ed.registerFeature(hE,!1,"Scheduler");const gE={maintainVisibleStart:!0};class mE extends Yf{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t,targetElement:n}=e,{client:r}=this;return r.isHorizontal?!1!==(null==t?void 0:t.enableHeaderContextMenu)&&(null==t?void 0:t.isTimeAxisColumn):n.matches(".b-sch-header-timeaxis-cell")}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:n}=t,r={magnitude:n.timeAxis.shiftIncrement,unit:n.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!n.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:e}){const[r]=e.items;r.min=n.minZoomLevel,r.max=n.maxZoomLevel,r.value=n.zoomLevel,t.zoomDetatcher=r.ion({change:"onZoomSliderChange",thisObj:t})},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:t.onRightShiftBtnClick,thisObj:t}}},internalListeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeAxis:i}=r,s=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=Gt.add(s,i.shiftIncrement,i.shiftUnit)):o=Gt.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(s,o,gE),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=Gt.clearTime(new Date);this.client.setTimeSpan(e,Gt.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}mE._$name="TimeAxisHeaderMenu",Ed.registerFeature(mE,!0,["Scheduler","TimelineHistogram","Gantt"]);class pE extends(zD.mixin(ZS)){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}static configurable={store:{modelClass:Iv},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1};doDestroy(){var e;null===(e=this.storeDetacher)||void 0===e||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:t}=e;let{records:n}=t;if(t.recurringEvents){const{startDate:t,endDate:r}=e.client.timeAxis;n=n.flatMap((e=>e.isRecurring?e.getOccurrencesForDateRange(t,r):e))}e.currentTimeLine&&(t.recurringEvents||(n=n.slice()),n.push(e.currentTimeLine)),e._timeRanges=n}return e._timeRanges}attachToProject(e){var t;super.attachToProject(e);const n=this;var r;(null===(t=n.projectTimeZoneChangeDetacher)||void 0===t||t.call(n),n.showCurrentTimeLine)&&(n.projectTimeZoneChangeDetacher=null===(r=n.client.project)||void 0===r?void 0:r.ion({timeZoneChange:()=>n.updateCurrentTimeLine()}),n.currentTimeLine&&n.updateCurrentTimeLine())}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const t="object"==typeof e.showCurrentTimeLine?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},t),e.currentTimeInterval=e.setInterval((()=>e.updateCurrentTimeLine()),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){var e;const t=this,{currentTimeLine:n}=t;n.timeZone=null===(e=t.project)||void 0===e?void 0:e.timeZone,n.setLocalDate("startDate",new Date),n.endDate=n.startDate,n.originalData.name||(n.name=Gt.format(n.startDate,t.currentDateFormat)),t.renderRanges()}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({items:e}){e.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.currentTimeLine,onToggle:({checked:e})=>{this.showCurrentTimeLine?this.updateShowCurrentTimeLine(e):this.showCurrentTimeLine=e}}}attachToStore(e){const t=this;let n=!1;t.storeDetacher&&(t.storeDetacher(),n=!0),t.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,n&&t.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const{client:t}=this,{project:n}=t;e=n.timeRangeStore,this.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){const t=e.closest(this.baseSelector).dataset.id;return"currentTime"===t?this.currentTimeLine:this.store.getById(t)}onStoreChange({type:e,action:t}){const n=this;n._timeRanges=null,n.disabled||!n.client.isVisible||n.isConfiguring||"refresh"===e&&"batch"!==t||n.client.runWithTransition((()=>n.renderRanges()),!n.client.refreshSuspended)}onDragStart(e){const t=this,{context:n}=e,r=t.resolveTimeRangeRecord(n.element.closest(t.baseSelector)),i=t.getBodyElementByRecord(r);n.relatedElements=[i],Object.assign(n,{record:r,rangeBodyEl:i,originRangeX:Br.getTranslateX(i),originRangeY:Br.getTranslateY(i)}),super.onDragStart(e),t.showTip(n)}onDrop(e){const{context:t}=e;if(!t.valid)return this.onInvalidDrop({context:t});const n=this,{client:r}=n,{record:i}=t,s=wn.from(t.rangeBodyEl),o=r.getDateFromCoordinate(s.getStart(r.rtl,r.isHorizontal),"round",!1);i.startDate-o!=0?i.setStartDate(o):n.drag.abort(),n.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const t=this,n=t.resolveTimeRangeRecord(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n);Object.assign(e,{record:n,rangeBodyEl:r}),t.showTip(e),super.onResizeStart(...arguments)}onResizeDrag({context:e}){const t=this,{rangeBodyEl:n}=e,{client:r}=t,i=wn.from(e.element),s=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),a=r.getDateFromCoordinate(s,"round",!1),l=r.getDateFromCoordinate(o,"round",!1);t.client.isVertical?("top"===e.edge&&Br.setTranslateY(n,e.newY),n.style.height=e.newHeight+"px"):("left"===e.edge&&Br.setTranslateX(n,e.newX),n.style.width=e.newWidth+"px"),t.updateDateIndicator({startDate:a,endDate:l})}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:n}=t,{rtl:r}=n,i=e.record,s=wn.from(e.element),o=s.getStart(r,n.isHorizontal),a=s.getEnd(r,n.isHorizontal),l=n.getDateFromCoordinate(o,"round",!1),c=r&&"right"===e.edge||!r&&"left"===e.edge||"top"===e.edge,d=n.getDateFromCoordinate(a,"round",!1);(c&&i.startDate-l!=0||d&&i.endDate-d!=0)&&d>l?c?i.setStartDate(l,!1):i.setEndDate(d,!1):t.onInvalidResize({context:e}),t.destroyTip()}onInvalidResize({context:e}){const t=this;t.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=e.element.lastDomConfig=null,t.renderRanges(),t.destroyTip()}}pE._$name="TimeRanges",Ed.registerFeature(pE,!1,["TimelineBase"]);class fE extends zD{static $name="TimeSelection";static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:t}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${Gt.format(e.startDate,t)}</span>\n                        <span class="b-selection-end">${Gt.format(e.endDate,t)}</span>\n                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:null}}onUIReady(){const e=this;super.onUIReady(),e.hoverTooltip&&(e.hoverTooltip.getHtml=()=>e.tooltipTemplate({...e.selectedTimeSpan})),e.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:e})}onTimeAxisHeaderMouseDown({startDate:e,endDate:t}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:t})}onTimeRangeClick(e){super.onTimeRangeClick(e);const t=this;!t.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?t.selectedTimeSpan=null:t.client.trigger("timeSelectionElementClick",{...t.selectedTimeSpan,domEvent:e}))}updateFromCoords(e,t,n,r){const{client:i}=this,s=i.isHorizontal?n:r;let o=i.isHorizontal?e:t;i.rtl&&i.isHorizontal&&(o=Math.max(i.timeAxisViewModel.totalSize-o-s,0));const a=i.getDateFromCoord({coord:o,roundingMethod:"round",ignoreRTL:!0}),l=i.getDateFromCoord({coord:o+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:Gt.max(a,i.startDate),endDate:Gt.min(l,i.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:t,timeResolution:n}=this.client,r=Gt.asMilliseconds(n.increment,n.unit);this.resize.minWidth=t.getDistanceForDuration(r)}onResizeDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.newWidth??e.elementWidth,e.newHeight??e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:t}=e;t.elementWidth=t.element.offsetWidth,t.elementHeight=t.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...e??{}})}}fE._$name="TimeSelection",Ed.registerFeature(fE,!1,"Scheduler");const vE={completeview:"completeview",currentview:"currentview",daterange:"daterange"},yE=Promise.resolve();var bE=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:n,scrollable:r}=e,i=r.y;return t<e.store.count&&(r.scrollTo(null,n.calculateTop(t)),r.y!==i)?new Promise((r=>{const i=e.ion({scroll({scrollTop:e}){null!=e&&n.getRow(t)&&(i(),r())}})})):yE}async scrollToDate(e,t){let n=!1;const r=[],i=e.timeAxisSubGrid.scrollable.ion({scrollStart({x:e}){null!=e&&(n=!0)}});r.push(e.scrollToDate(t,{block:"start"})),i(),n&&r.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}cloneElement(e,t,n){super.cloneElement(e,t,n);const r=this.element.querySelector(".b-schedulerbase");null==r||r.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map((e=>`b-initial-${e}`)))}async prepareComponent(e){const t=this,{client:n}=e,{currentOrientation:r}=n,i=n.timeAxisSubGrid.width>0;switch(e.scheduleRange){case vE.completeview:e.rangeStart=n.startDate,e.rangeEnd=n.endDate;break;case vE.currentview:{const{startDate:t,endDate:r}=n.visibleDateRange;e.rangeStart=t,e.rangeEnd=r;break}}await n.waitForAnimations(),e.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,i&&(n.setTimeSpan(e.rangeStart,e.rangeEnd),e.scheduleRange===vE.daterange&&(e.rangeStart=n.startDate,e.rangeEnd=n.endDate),n.svgCanvas),t._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,r.isHorizontalRendering&&(t._oldScrollBuffer=r.scrollBuffer,t._oldVerticalBuffer=r.verticalBufferSize,r.scrollBuffer=100,r.verticalBufferSize=-1),n.ignoreViewBox=!0,await super.prepareComponent(e);const{exportMeta:s,element:o}=t,a=o.querySelector(".b-sch-foreground-canvas"),l=o.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=i,i&&e.scheduleRange!==vE.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=n.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(s.totalWidth/s.pageWidth),r=t*s.verticalPages;s.horizontalPages=t,s.totalPages=r,s.subGrids.normal.scrollLeft=n.getCoordinateFromDate(e.rangeStart)}s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,Br.forEachSelector(l,".b-sch-header-row",(e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)})),s.subGrids.normal.eventsPlaceholder=t.createPlaceholder(a,!1),Br.removeEachSelector(a,".b-sch-event-wrap,.b-sch-resourcetimerange"),Br.removeEachSelector(t.element,".b-released"),s.eventsBoxes=new Map,s.client=n;const c=o.querySelector(".b-column-lines-canvas"),d=o.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),u=o.querySelector(".b-timeaxissubgrid .b-sch-timeranges-canvas");if(n.hasActiveFeature("columnLines")&&c&&(s.columnLinesPlaceholder=t.createPlaceholder(c),s.columnLines={lines:new Map,majorLines:new Map}),n.hasActiveFeature("timeRanges")&&u&&(s.timeRanges={},d&&(s.timeRanges.header=e.enableDirectRendering?"":{},s.timeRangesHeaderPlaceholder=t.createPlaceholder(d)),s.timeRanges.body=e.enableDirectRendering?"":{},s.timeRangesBodyPlaceholder=t.createPlaceholder(u)),n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const e=o.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);e&&(s.dependencyCanvasEl=e,s.dependenciesPlaceholder=t.createPlaceholder(e,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),Br.removeEachSelector(e,".b-sch-dependency"))}i&&!Gt.betweenLesser(e.rangeStart,n.startDate,n.endDate)&&await t.scrollToDate(n,e.rangeStart)}async restoreState(e){let t=!1;const{client:n}=e,r=[],i=n.timeAxisSubGrid.scrollable.ion({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});r.push(super.restoreState(e)),i(),t&&r.push(n.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}async restoreComponent(e){const{client:t}=e,{currentOrientation:n}=t;t.ignoreViewBox=!1,t.infiniteScroll=e.infiniteScroll,t.enableEventAnimations=this._oldEnableEventAnimations,n.isHorizontalRendering&&(n.scrollBuffer=this._oldScrollBuffer,n.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(e)}async onRowsCollected(e,t){const n=this;if(await super.onRowsCollected(e,t),n.exportMeta.includeTimeline){const{client:r,enableDirectRendering:i}=t,{timeView:s}=r,{pageRangeStart:o,pageRangeEnd:a}=n.getCurrentPageDateRange(t);if(i)o&&a&&(n.renderHeaders(t,o,a),n.renderLines(t,o,a),n.renderRanges(t,o,a),n.renderEvents(t,e,o,a));else{if(o){let i=!1;for(await n.scrollToDate(r,o);!i;)if(n.collectLines(t),n.collectHeaders(t),n.collectRanges(t),n.collectEvents(e,t),Gt.timeSpanContains(s.startDate,s.endDate,o,a))i=!0;else if(s.endDate.getTime()>=a.getTime())i=!0;else{const e=s.endDate;if(await n.scrollToDate(r,s.endDate),e.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}}await n.scrollToDate(r,t.rangeStart)}}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,enableDirectRendering:n,client:r}){const{exportMeta:i}=this,{horizontalPages:s,horizontalPosition:o,pageWidth:a,subGrids:l}=i;let c,d;if(s>1){const e=o*a,i=(o+1)*a,s=l.locked.width+l.locked.splitterWidth;if(i<=s)d=c=null;else{const{scrollLeft:o=0}=l.normal;c=r.getDateFromCoordinate(Math.max(e-s+o,0));const a=n?1:1.2;d=r.getDateFromCoordinate((i-s+o)*a)||t}}else c=e,d=t;return{pageRangeStart:c,pageRangeEnd:d}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:n,headerId:r,footerId:i,scrollLeft:s}=t.subGrids.normal;return e.querySelector(`[id="${n}"]`).querySelectorAll(".b-sch-canvas").forEach((e=>{t.lastExportedRowBottom?e.style.height=`${t.lastExportedRowBottom}px`:e.style.height="",s&&(e.style.marginLeft=`-${s}px`)})),s&&[r,i].forEach((t=>{const n=e.querySelector(`[id="${t}"] .b-widget-scroller`);n&&(n.style.marginLeft=`-${s}px`)})),super.prepareExportElement()}collectHeaders(e){const{client:t}=e,{exportMeta:n}=this;if(!n.headersCollected){const e=t.timeView.element,r=n.timeAxisHeaders;Br.forEachSelector(e,".b-sch-header-row",((e,i,s)=>{const o=r[i];Br.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{o.has(e.dataset.tickIndex)||o.set(e.dataset.tickIndex,e.outerHTML)})),i===s.length-1&&o.has(String(t.timeAxis.count-1))&&(n.headersCollected=!0)}))}}collectRanges(e){const{client:t}=e,{exportMeta:n}=this,{timeRanges:r}=n;if(!n.headersCollected&&r){const{headerCanvas:e,bodyCanvas:n}=t.features.timeRanges;e&&Br.forEachSelector(e,".b-sch-timerange",(e=>{r.header[e.dataset.id]=e.outerHTML})),Br.forEachSelector(n,".b-sch-timerange",(e=>{r.body[e.dataset.id]=e.outerHTML}))}}collectLines(e){const{client:t}=e,{exportMeta:n}=this,{columnLines:r}=n;!n.headersCollected&&r&&t.timeAxisSubGridElement.querySelectorAll(".b-column-line, .b-column-line-major").forEach((e=>{if(e.classList.contains("b-column-line")){const t=Number(e.dataset.line.replace(/line-/,""));r.lines.set(t,e.outerHTML)}else{const t=Number(e.dataset.line.replace(/major-/,""));r.majorLines.set(t,e.outerHTML)}}))}collectEvents(e,t){const n=e.length,{client:r}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{var s,o;const a=i[i.length-n+t],l=r.store.getAt(e.dataIndex),c=a[3];null===(s=l.events)||void 0===s||s.forEach((e=>{if(e.isScheduled){let t=r.getElementFromEventRecord(e,l);t&&(t=t.parentElement)&&!c.has(e.id)&&c.set(e.id,[t.outerHTML,wn.from(t,t.offsetParent)])}})),null===(o=l.timeRanges)||void 0===o||o.forEach((e=>{var t;const n=(null===(t=r.features.resourceTimeRanges)||void 0===t?void 0:t.generateElementId(e))||"",i=r.foregroundCanvas.syncIdMap[n];i&&!c.has(n)&&c.set(n,[i.outerHTML,wn.from(i,i.offsetParent)])}))}))}renderHeaders(e,t,n){const{exportMeta:r}=this,{client:i}=e,s=r.timeAxisHeaders,{timeAxisView:o}=i.timeAxisColumn,a=o.buildCells(t,n),l=document.createElement("div");To.sync({targetElement:l,domConfig:a}),Br.forEachSelector(l,".b-sch-header-row",((e,t)=>{const n=s[t];Br.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{n.has(e.dataset.tickIndex)||n.set(e.dataset.tickIndex,e.outerHTML)}))}))}renderEvents(e,t,n,r){const{client:i}=e,s=this.exportMeta.subGrids.normal.rows;t.forEach(((e,t)=>{const o=s[t][3],a=i.store.getAt(e.dataIndex),l=i.currentOrientation.getResourceLayout(a),c=i.getCoordinateFromDate(n),d=i.getCoordinateFromDate(r),u=i.currentOrientation.getEventDOMConfigForCurrentView(l,e,c,d),h=document.createElement("div");u.forEach((e=>{const{eventId:t}=e.dataset,{left:n,top:r,width:i,height:s}=e.style;To.sync({targetElement:h,domConfig:e}),o.set(t,[h.outerHTML,new wn(n,r,i,s)])}))}))}renderLines(e,t,n){const{client:r}=e,{exportMeta:i}=this,{columnLines:s}=i;if(s){const e=r.features.columnLines.getColumnLinesDOMConfig(t,n),i=document.createElement("div");To.sync({targetElement:i,domConfig:{onlyChildren:!0,children:e}}),s.lines.set(0,i.innerHTML)}}renderRanges(e,t,n){const{client:r}=e,{exportMeta:i}=this,{timeRanges:s}=i;if(s){const e=r.features.timeRanges.getDOMConfig(t,n),i=document.createElement("div");e.forEach(((e,t)=>{To.sync({targetElement:i,domConfig:{children:e,onlyChildren:!0}}),0===t?s.body=i.innerHTML:s.header=i.innerHTML}))}}buildPageHtml(e){const t=this,{subGrids:n,timeAxisHeaders:r,timeAxisPlaceholders:i,columnLines:s,columnLinesPlaceholder:o,timeRanges:a,timeRangesHeaderPlaceholder:l,timeRangesBodyPlaceholder:c}=t.exportMeta,{enableDirectRendering:d}=e;let u=t.prepareExportElement();if(Object.values(n).forEach((({placeHolder:n,eventsPlaceholder:r,rows:i,mergedCellsHtml:s})=>{const o=n.outerHTML,{resources:a,events:l}=t.positionRows(i,e);let c=a.join("");null!=s&&s.length&&(c+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),u=u.replace(o,c),r&&(u=u.replace(r.outerHTML,l.join("")))})),r.forEach(((e,t)=>{u=u.replace(i[t].outerHTML,Array.from(e.values()).join(""))})),s){const e=Array.from(s.lines.values()).concat(Array.from(s.majorLines.values()));u=u.replace(o.outerHTML,e.join("")),d&&(t.exportMeta.columnLines.lines.clear(),t.exportMeta.columnLines.majorLines.clear())}return a&&(d?(u=u.replace(c.outerHTML,a.body),l&&(u=u.replace(l.outerHTML,a.header)),t.exportMeta.timeRanges={}):(u=u.replace(c.outerHTML,Object.values(a.body).join("")),l&&(u=u.replace(l.outerHTML,Object.values(a.body).join(""))))),u=t.buildDependenciesHtml(u),u}getEventBox(e){const{eventsBoxes:t,enableDirectRendering:n}=this.exportMeta,r=e&&t.get(String(e.id));return n&&r&&e.isMilestone&&r.translate(-r.width/2,0),r}renderDependencies(){const e=this,{client:t,eventsBoxes:n}=e.exportMeta,{dependencies:r}=t,i=t.features.dependencies,s=Br.createElement();let o=!1;return r.forEach((t=>{if(!n.has(String(t.from))&&!n.has(String(t.to))||!i.isDependencyVisible(t))return;const r=e.getEventBox(t.fromEvent),s=e.getEventBox(t.toEvent);i.drawDependency(t,!0,{from:null==r?void 0:r.clone(),to:null==s?void 0:s.clone()}),o=!0})),o&&i.domSync(s,!0),s.innerHTML}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:n}=this.exportMeta;if(t&&n){const n=t.outerHTML;e=e.replace(n,this.renderDependencies())}return e}};class CE extends(bE(uu)){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],n=[];return e.forEach((([e,r,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,r,i=[]]])=>{n.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}CE._$name="MultiPageExporter";class SE extends(bE(hu)){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==vE.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],n=[];return e.forEach((([e,,,r])=>{t.push(e),r&&Array.from(r.entries()).forEach((([e,[t,r,i=[]]])=>{n.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}SE._$name="MultiPageVerticalExporter";class DE extends Mc{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems:()=>Object.entries(vE).map((([e,t])=>({value:e,text:"L{"+t+"}"})))}}}DE.initClass(),DE._$name="ScheduleRangeCombo";class wE extends bu{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",name:"scheduleRange",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==vE.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",name:"rangeStart",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=Gt.add(e,1,"d")}},rangeEndField:{type:"datefield",label:"L{Export to}",name:"rangeEnd",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=Gt.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof pc?t.labelWidth=e:"rangesContainer"===t.ref&&(t.items[0].width=e)}))}applyInitialValues(e){super.applyInitialValues(e);const{client:t,scheduleRange:n}=e,r=e.items=e.items||{},i=r.scheduleRangeField=r.scheduleRangeField||{},s=r.rangesContainer=r.rangesContainer||{},o=s.items=s.items||{},a=o.filler=o.filler||{},l=o.rangeStartField=o.rangeStartField||{},c=o.rangeEndField=o.rangeEndField||{};a.width=this.L("labelWidth"),i.value=i.value||n,i.value===vE.daterange&&(s.hidden=!1);const d=l.value=l.value||t.startDate;l.max=Gt.max(t.startDate,Gt.add(t.endDate,-1,"d"));let u=c.value||t.endDate;u<=d&&(u=Gt.add(d,1,"d")),c.value=u,c.min=Gt.min(t.endDate,Gt.add(t.startDate,1,"d"))}}wE._$name="SchedulerExportDialog";class EE extends(bE(gu)){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,t){const n=[],r=[],i=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(t.enableDirectRendering)e.forEach((([e,,,t])=>{n.push(e),t&&Array.from(t.entries()).forEach((([e,[t,n,i=[]]])=>{this.exportMeta.eventsBoxes.set(String(e),n),r.push(t+i.join(""))}))}));else{let t=0;e.forEach((([e,o,a,l])=>{n.push(e.replace(i,`translate($1px, ${t}px)`));const c=t-o;l&&Array.from(l.entries()).forEach((([e,[t,n]])=>{n.translate(0,c),this.exportMeta.eventsBoxes.set(String(e),n),r.push(t.replace(s,`top: ${n.y}px`))})),t+=a}))}return{resources:n,events:r}}}EE._$name="SinglePageExporter";class xE extends Cu{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[EE,CE,SE],dialogClass:wE,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return Xt.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:n,rangeEnd:r}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),Xt.assign({scheduleRange:t,rangeStart:n,rangeEnd:r},e)}}xE._$name="PdfExport",Ed.registerFeature(xE,!1,"Scheduler");class RE extends(vv(xE)){static $name="Print"}RE._$name="Print",Ed.registerFeature(RE,!1,"Scheduler");class TE extends(rt(bv)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,n=this.target instanceof CD,r=t.generateColumns(e),i=n?t.generateEventColumns(e):[];return{columns:r.concat(i),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}processEventColumn(e,t){const{width:n,minWidth:r}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:n}=t;let r;if(n instanceof CD){if(r=[],n.resourceStore.map((i=>{const s=i.events||[];s.sort(t.eventSortFn),s.length||s.push(""),s.forEach((s=>{(""===s||n.eventStore.isAvailable(s))&&r.push(t.getRowData(e,i,s))}))})),e.includeUnassigned&&e.eventColumns.length){const i=n.eventStore.query((e=>!e.resources.length));if(i.length){const n=new Array(e.columns.length).fill("");n.push(t.L("L{ExcelExporter.No resource assigned}")),r.push(n),i.forEach((n=>r.push(t.getRowData(e,null,n))))}}r=r.filter((e=>e.length))}else r=super.generateRows(e);return r}getRowData(e,t,n){const{columns:r,eventColumns:i}=e,s=[],o=this.processRecord(t,r,e);if(o&&s.push(...o),!t||!t.isSpecialRow){const t=this.processRecord(n,i,e);t&&s.push(...t)}return s}}TE._$name="ScheduleTableExporter";class ME extends Sv{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:TE,exporterConfig:null}}}ME._$name="ExcelExporter",Ed.registerFeature(ME,!1,"Scheduler");class kE extends CD{static get $name(){return"Scheduler"}static get type(){return"scheduler"}}kE.initClass(),kE._$name="Scheduler";var IE=e=>class extends(e||ye){static $name="DelayedRecordsRendering";static configurable={scheduledRecordsRefreshTimeout:10};static get properties(){return{recordsToRefresh:new Set}}beforeRenderRow({record:e}){var t;return null!==(t=this.recordIsReadyForRendering)&&void 0!==t&&t.call(this,e)&&this.unscheduleRecordRefresh(e),super.beforeRenderRow(...arguments)}cleanupScheduledRecord(){const{rowManager:e,store:t}=this;for(const n of[...this.recordsToRefresh])n.stores.includes(t)&&e.getRowById(n)||this.recordsToRefresh.delete(n)}renderScheduledRecords(){const e=this;if(e.refreshSuspended)e.scheduleRecordRefresh();else{e.cleanupScheduledRecord();const{rowManager:t}=e,n=[...e.recordsToRefresh],r=n.map((e=>t.getRowById(e)));r.length&&(t.renderRows(r),e.trigger("scheduledRecordsRender",{records:n,rows:r})),e.recordsToRefresh.size&&e.scheduleRecordRefresh()}}unscheduleRecordRefresh(e=!0){const t=this;!0===e?t.recordsToRefresh.clear():e&&H.asArray(e).forEach((e=>t.recordsToRefresh.delete(e))),t.scheduledRecordsRefreshTimer&&!t.recordsToRefresh.size&&t.clearTimeout(t.scheduledRecordsRefreshTimer)}scheduleRecordRefresh(e){const t=this;e&&H.asArray(e).forEach((e=>t.recordsToRefresh.add(e))),t.scheduledRecordsRefreshTimer=t.setTimeout({fn:"renderScheduledRecords",delay:t.scheduledRecordsRefreshTimeout,cancelOutstanding:!0})}get widgetClass(){}};class AE extends ye{static configurable={scrollBuffer:0};construct(e){super.construct(),this.client=e}init(){}onTimeAxisViewModelUpdate(){const{scrollable:e}=this.client.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}updateFromHorizontalScroll(e){const t=this,{client:n,scrollBuffer:r}=t,{timeAxisSubGrid:i,timeAxis:s,rtl:o}=n,{width:a}=i,{totalSize:l}=n.timeAxisViewModel,c=e,d=0!==i.scrollable.maxX&&Math.abs(i.scrollable.maxX)<=Math.round(c)+5,u=n.getDateFromCoord({coord:Math.max(0,c-r),ignoreRTL:!0}),h=d?s.endDate:n.getDateFromCoord({coord:c+a+r,ignoreRTL:!0})||s.endDate;if(u&&!n._viewPresetChanging){t._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},t.viewportCoords=o?{left:l-e-a+r,right:l-e-r}:{left:e-r,right:e+a+r};const i=n.timeView.range={startDate:u,endDate:h};if(n.internalOnVisibleDateRangeChange(i),!n.refreshSuspended&&n.rowManager.rows.length){if(null===n.rowManager.rows[0].id)return;(t._timeAxisStartDate-s.startDate||t._timeAxisEndDate-s.endDate)&&(t._timeAxisStartDate=s.startDate,t._timeAxisEndDate=s.endDate,n.rowManager.renderRows(n.rowManager.rows))}}}onViewportResize(){}refreshRows(){}get visibleDateRange(){return this._visibleDateRange}translateToPageCoordinate(e){const{client:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}translateToScheduleCoordinate(e){const{client:t}=this,{scrollable:n}=t.timeAxisSubGrid;let i=e-t.timeAxisSubGridElement.getBoundingClientRect().left-r.scrollX;return t.rtl?i+=n.maxX-Math.abs(t.scrollLeft):i+=t.scrollLeft,i}getDateFromXY(e,t,n,r=!1){const{client:i}=this;let s=e[0];return n||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,r)}}AE._$name="TimelineHistogramRendering";const FE={series:null,topValue:null},PE=()=>{};class OE extends(ry.mixin(IE)){static $name="TimelineHistogramBase";static type="timelinehistogrambase";static configurable={timeAxisColumnCellCls:"b-sch-timeaxis-cell b-timelinehistogram-cell",mode:"horizontal",rowHeight:50,showBarTip:!1,barTooltip:null,barTooltipClass:lc,series:null,dataModelField:"histogramData",getRecordData:null,hardRefreshOnTimeAxisReconfigure:!0,getRectClass:null,getOutlineClass:e=>"",readOnly:!0,getBarTip:null,barTooltipTemplate:null,getBarText:null,getRectConfig:null,getBarTextRenderData:i,histogramWidgetClass:nf,histogramWidget:{cls:"b-hide-offscreen b-timelinehistogram-histogram",omitZeroHeightBars:!0,data:[]},fixedRowHeight:!0};static get properties(){return{histogramDataByRecord:new Map,collectingDataFor:new Map}}updateGetRecordData(e){this._getRecordData=e?this.resolveCallback(e):null}updateHardRefreshOnTimeAxisReconfigure(e){const t="hardRefreshOnTimeAxisReconfigure";e?this.timeAxis.ion({name:t,endReconfigure:"onTimeAxisEndReconfigure",thisObj:this}):this.detachListeners(t)}construct(e){super.construct(e);const t=this;t.scheduleRefreshRows=t.createOnFrame(t.refreshRows,[],t,!0),t.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",thisObj:t})}onDestroy(){var e;this.clearHistogramDataCache(),null===(e=this._histogramWidget)||void 0===e||e.destroy(),this.barTooltip=null}resolveTimeSpanRecord(e){}getScheduleMouseEventParams(e,t){return{record:this.store.getById(e.id)}}get currentOrientation(){return this._currentOrientation||(this._currentOrientation=new AE(this)),this._currentOrientation}updateSeries(e){const t=this;t.histogramWidget.series=e,t._series=t.histogramWidget.series,t.isPainted&&!t.isConfiguring&&t.scheduleRefreshRows()}getAsyncEventSuffixForStore(e){return e.isAbstractPartOfProjectStoreMixin?"PreCommit":""}scheduleRefreshRows(){}getRowHeight(){return this.rowHeight}onInternalPaint({firstPaint:e}){super.onInternalPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}updateGetBarTip(e){return e&&(this.barTooltipTemplate=null),e}changeBarTooltip(e,t){return null==t||t.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}async getTipHtml(e){if(this.showBarTip&&this.barTooltipTemplate){const{activeTarget:t}=e,n=parseInt(t.dataset.index,10),r=this.getRecordFromElement(t),i=await this.getRecordHistogramData(r);return this.barTooltipTemplate({...e,datum:this.extractHistogramDataArray(i,r)[n],record:r,index:n})}}collectTicksWidth(){const{ticks:e}=this.timeAxis,t=e[0].endDate-e[0].startDate,n={0:t};let r=t,i=!0;for(let s=1,{length:o}=e;s<o;s++){const o=e[s],a=o.endDate-o.startDate;t!==a&&(i=!1),r+=a,n[s]=a}if(i)this.ticksWidth=null;else{const t={};for(let i=0,{length:s}=e;i<s;i++)t[i]=n[i]/r;this.ticksWidth=t}}changeHistogramWidget(e){const t=this;var n;e&&!e.isHistogram&&(t.getBarTextRenderData&&!e.getBarTextRenderData&&(e.getBarTextRenderData=t.getBarTextRenderData),(e=t.histogramWidgetClass.new({owner:t,appendTo:t.element,height:t.rowHeight,width:(null===(n=t.timeAxisColumn)||void 0===n?void 0:n.width)||0,getBarTip:!t.barTooltipTemplate&&t.getBarTip||PE,getRectClass:t.getRectClass||t.getRectClassDefault,getBarText:t.getBarText||t.getBarTextDefault,getOutlineClass:t.getOutlineClass,getRectConfig:t.getRectConfig},e)).suspendRefresh(),t.getBarTextDefault=t.getBarTextDefault.bind(e));return e}getRectClassDefault(e,t,n){}getBarTextDefault(e,t){}updateShowBarTip(e){this.barTooltip=e}get columns(){return super.columns}set columns(e){const t=this;super.columns=e,t.isDestroying||(t.timeAxisColumn.renderer=t.histogramRenderer.bind(t),t.timeAxisColumn.cellCls=t.timeAxisColumnCellCls)}onHistogramDataCacheSet({record:e,data:t}){this.scheduleRecordRefresh(e)}onTimeAxisEndReconfigure(){this.hardRefreshOnTimeAxisReconfigure&&(this.clearHistogramDataCache(),this.scheduleRefreshRows())}onStoreUpdateRecord({record:e,changes:t}){const n=this;return!n.getRecordData&&n.dataModelField&&t[n.dataModelField]&&n.clearHistogramDataCache(e),super.onStoreUpdateRecord(...arguments)}onStoreRemove({records:e}){super.onStoreRemove(...arguments);for(const t of e)this.clearHistogramDataCache(t)}onBeforeRowHeight({height:e}){if(this._timeAxisColumn){const t=this._histogramWidget;t&&(t.height=e,t.onElementResize(t.element))}}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);const e=this._histogramWidget;e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element)),this.collectTicksWidth()}extractHistogramDataArray(e,t){return e}processRecordRenderData(e){return e}clearHistogramDataCache(e){e?this.histogramDataByRecord.delete(e):this.histogramDataByRecord.clear()}setHistogramDataCache(e,t){const n={record:e,data:t};this.trigger("beforeHistogramDataCacheSet",n),this.histogramDataByRecord.set(n.record,n.data),this.trigger("histogramDataCacheSet",n)}getHistogramDataCache(e){return e?this.histogramDataByRecord.get(e):this.histogramDataByRecord}hasHistogramDataCache(e){return this.histogramDataByRecord.has(e)}finalizeDataRetrievingInternal(e,t){return this.collectingDataFor.delete(e),this.setHistogramDataCache(e,t),t}finalizeDataRetrieving(e,t){return p.isPromise(t)?(this.collectingDataFor.set(e,t),t.then((t=>this.finalizeDataRetrievingInternal(e,t)))):this.finalizeDataRetrievingInternal(e,t)}getRecordHistogramData(e){const t=this,{getRecordData:n}=t;let r=t.collectingDataFor.get(e)||t.getHistogramDataCache(e);return r||t.hasHistogramDataCache(e)||(r=n?n.handler.call(n.thisObj,...arguments):e.get(t.dataModelField),r=t.finalizeDataRetrieving(e,r)),r}recordIsReadyForRendering(e){return!this.collectingDataFor.has(e)}beforeRenderRow(e){const t=this,n=t.getRecordHistogramData(e.record);if(!p.isPromise(n)){const r=n?t.extractHistogramDataArray(n,e.record):[];if(!r)return;if(t.ticksWidth)for(let e=0,{length:n}=r;e<n;e++)r[e].width=t.ticksWidth[e];const i=p.merge({topValue:null},t.initialConfig.histogramWidget,{data:r,series:{...t.series}});e={...e,histogramConfig:i,histogramData:n,histogramWidget:t.histogramWidget},t.trigger("beforeRenderHistogramRow",e),delete e.eventName,delete e.source,delete e.type,delete e.oldId,delete e.row,delete e.recordIndex,t._recordRenderData=t.processRecordRenderData(e)}super.beforeRenderRow(...arguments)}applyHistogramWidgetConfig(e=this.histogramWidget,t){Object.assign(e,FE,t)}renderRecordHistogram(e){const t=this,{histogramData:n,cellElement:r}=e;if(!n)return void(r.innerHTML="");t.trigger("beforeRenderRecordHistogram",e),delete e.eventName,delete e.type,delete e.source;const i=e.histogramWidget||t.histogramWidget;t.applyHistogramWidgetConfig(i,e.histogramConfig),i.refresh({args:[e]});const s=i.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(s)}histogramRenderer(e){const t=this,n=e.histogramData||t.getRecordHistogramData(e.record);return p.isPromise(n)?"":(Object.assign(e,t._recordRenderData),t.renderRecordHistogram(...arguments))}buildGroupHeader(e){return e.column===this.timeAxisColumn?this.histogramRenderer(e):this.features.group.buildGroupHeader(e)}get widgetClass(){}}OE.initClass(),OE._$name="TimelineHistogramBase";var LE=e=>class extends(e||OE){static $name="TimelineHistogramGrouping";static configurable={aggregateHistogramDataForGroups:!0,aggregateDataEntry:null,getDataEntryForAggregating:null,initAggregatedDataEntry:null,aggregateFunctions:{sum:{aliases:["add"],entry:(e,t,n)=>(t[e]=(t[e]||0)+n[e],t)},min:{entry(e,t,n){const r=n[e];return r<(t[e]||Number.MAX_VALUE)&&(t[e]=r),t}},max:{entry(e,t,n){const r=n[e];return r>(t[e]||Number.MIN_VALUE)&&(t[e]=r),t}},count:{init(e,t,n,r){t[e]=r.arrays.length}},avg:{entry:(e,t,n)=>(t[e]=(t[e]||0)+n[e],t),finalize(e,t,n,r,i){const s=i.arrays.length;t.forEach((t=>t[e]/=s))}}}};afterConfigure(){const e=this;e.internalAggregateDataEntry=e.internalAggregateDataEntry.bind(this),e.internalInitAggregatedDataEntry=e.internalInitAggregatedDataEntry.bind(this),super.afterConfigure(),e.features.treeGroup&&e.features.treeGroup.ion({beforeDataLoad:e.onTreeGroupBeforeDataLoad,thisObj:e})}updateAggregateFunctions(e){for(const[t,n]of Object.entries(e))if(n.id=t,n.aliases)for(const t of n.aliases)e[t]=n}updateStore(e){super.updateStore(...arguments),this.detachListeners("store"),e&&e.ion({name:"store",group:this.onStoreGroup,sort:this.onStoreSort,thisObj:this})}changeAggregateDataEntry(e){return this.bindCallback(e)}changeGetDataEntryForAggregating(e){return this.bindCallback(e)}changeInitAggregatedDataEntry(e){return this.bindCallback(e)}onHistogramDataCacheSet({record:e,data:t}){super.onHistogramDataCacheSet(...arguments),this.aggregateHistogramDataForGroups&&this.scheduleRecordParentsRefresh(e)}onTreeGroupBeforeDataLoad(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreGroup(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreSort({source:e}){this.aggregateHistogramDataForGroups&&e.isGrouped&&this.resetGeneratedRecordsHistogramDataCache()}getRecordHistogramData(e,t){const n=this;let r;return n.aggregateHistogramDataForGroups&&n.isGroupRecord(e)?(r=n.collectingDataFor.get(e)||n.getHistogramDataCache(e),r||n.hasHistogramDataCache(e)||(r=n.getGroupRecordHistogramData(e,t),r=n.finalizeDataRetrieving(e,r))):r=super.getRecordHistogramData(...arguments),r}internalAggregateDataEntry(e,...t){const{aggregateFunctions:n}=this;for(const{id:r,aggregate:i="sum"}of Object.values(this.series)){let s;!1!==i&&(s=n[i].entry)&&(e=s(r,e,...t))}return this.aggregateDataEntry?this.aggregateDataEntry(e,...t):e}internalInitAggregatedDataEntry(){const e=this.initAggregatedDataEntry?this.initAggregatedDataEntry(...arguments):{},{aggregateFunctions:t}=this;for(const{id:n,aggregate:r="sum"}of Object.values(this.series)){const i=t[r].init;i&&!1!==r&&i(n,e,...arguments)}return e}resetGeneratedRecordsHistogramDataCache(){const{store:e}=this;for(const t of this.getHistogramDataCache().keys())(t.isGroupHeader||t.generatedParent||t.isLinked&&!e.includes(t))&&this.clearHistogramDataCache(t)}setHistogramDataCache(e,t){if(super.setHistogramDataCache(e,t),e.isLinked)super.setHistogramDataCache(e.$original,t);else if(e.$links){const{store:n}=this;for(const r of e.$links)n.includes(r)&&super.setHistogramDataCache(r,t)}}getHistogramDataCache(e){let t=super.getHistogramDataCache(e);return!t&&e.isLinked&&(t=super.getHistogramDataCache(e.$original)),t}getGroupRecordHistogramData(e,t={}){t.parentRecord=e;const n=this.aggregateRecordsHistogramData(this.getGroupChildren(e),t);return p.isPromise(n)?n.then((e=>e)):n}aggregateRecordsHistogramData(e,t={}){const n=this,r=[],{parentRecord:i}=t;let s=!1;for(const i of e){const e=n.getRecordHistogramData(i,t);s=s||p.isPromise(e),e&&r.push(e)}return s?Promise.all(r).then((r=>(t.parentRecord=i,r=r.filter((e=>e)),n.aggregateHistogramData(r,e,t)))):n.aggregateHistogramData(r,e,t)}isGroupRecord(e){return e.isGroupHeader||this.isTreeGrouped&&e.generatedParent}getGroupChildren(e){return e.groupChildren||e.children}getRecordParent(e){const{groupParent:t}=e;return(null==t?void 0:t.get(this.store.id))||this.isTreeGrouped&&e.parent}scheduleRecordParentsRefresh(e,t=!0){const n=this;let r;for(;r=n.getRecordParent(e);)t&&n.clearHistogramDataCache(r),n.scheduleRecordRefresh(r),e=r}aggregateHistogramData(e,t,n={}){const r=this,{aggregateFunctions:i}=r;n.recordsData=e,n.records=t;const s=e.map(((e,n)=>r.extractHistogramDataArray(e,t[n]))),o=H.aggregate(s,r.getDataEntryForAggregating||(e=>e),r.internalAggregateDataEntry,r.internalInitAggregatedDataEntry,n);for(const{id:e,aggregate:t="sum"}of Object.values(r.series)){const n=i[t].finalize;n&&!1!==t&&n(e,o,...arguments)}return o}get widgetClass(){}},$E=e=>class extends e{static $name="TimelineHistogramScaleColumn";static configurable={scaleColumn:{},scalePoints:null,scalePointsModelField:"scalePoints",calculateTopValueByScalePoints:!0};updateScalePoints(e){const t=this,n=e[e.length-1];n&&(t.scaleUnit=n.unit,t.histogramWidget.topValue=t.getTopValueByScalePoints(e)),t.scaleColumn&&(t.scaleColumn.scalePoints=e)}changeColumns(e,t){const n=this.getConfig("scaleColumn");if(e&&n){var r;const t=Array.isArray(e);let i=e;t||(i=e.data);let s=null===(r=i)||void 0===r?void 0:r.length,o=n;i.some(((e,t)=>{if("scale"===e.type)return s=t,o=Xt.assign(e,o),!0})),i=i.slice(),i[s]={type:"scale",...o},t?e=i:e.data=i}return super.changeColumns(e,t)}updateColumns(e,t){super.updateColumns(e,t),e&&(this._scaleColumn=this.columns.find((e=>e.isScaleColumn)))}onColumnsChanged({action:e,changes:t,record:n,records:r}){const{scaleColumn:i,columns:s}=this;!i||"dataset"!==e&&"batch"!==e||s.includes(i)||s.add(i,!0),super.onColumnsChanged(...arguments)}convertUnitsToHistogramValue(e,t){return e}convertHistogramValueToUnits(e,t){return e}extractHistogramDataArray(e,t){return e}getTopValueByScalePoints(e){const t=this,{scaleColumn:n}=t,r=e[e.length-1],{value:i,unit:s}=r;let o=i;return n&&(o*=1+(n.scaleWidget.scaleMaxPadding||0)),t.convertUnitsToHistogramValue(o,s||t.scaleUnit)}processRecordRenderData(e){if(e=super.processRecordRenderData(...arguments),this.scaleColumn){var t;const n=this,{record:r,histogramData:i,histogramConfig:s={}}=e;let o=null===(t=n.initialConfig.histogramWidget)||void 0===t?void 0:t.topValue,a=n.scalePoints||r.get(n.scalePointsModelField);if(!o){if(a&&n.calculateTopValueByScalePoints&&(o=n.getTopValueByScalePoints(a)),!o&&i){const t=e.histogramWidget||n.histogramWidget;Xt.assign(t,s),o=t.getDataTopValue(i),a=[{value:n.convertHistogramValueToUnits(o,n.scaleUnit),text:n.convertHistogramValueToUnits(o,n.scaleUnit)}],o+=n.scaleColumn.scaleWidget.scaleMaxPadding*o}e.scaleWidgetConfig={scalePoints:a},e.histogramConfig={...s,topValue:o}}}return e}buildGroupHeader(e){return e.column===this.scaleColumn?this.scaleColumn.renderer(e):super.buildGroupHeader(...arguments)}beforeRenderCell(e){return this.scaleColumn&&e.column===this.scaleColumn&&(e.histogramData=this.getRecordHistogramData(e.record),Xt.isPromise(e.histogramData)||Object.assign(e,this._recordRenderData)),super.beforeRenderCell(...arguments)}renderRecordScale(e,t){if(this.scaleColumn){const t=this.getRowFor(e),n=null==t?void 0:t.getCell(this.scaleColumn.id);n&&t.renderCell(n)}}get widgetClass(){}};class _E extends(OE.mixin(LE,$E)){static $name="TimelineHistogram";static type="timelinehistogram"}_E.initClass(),_E._$name="TimelineHistogram";class jE extends Mc{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var t;null!==(t=e.transport.load)&&void 0!==t&&t.url&&(this.value=e.transport.load.url)}onChange({value:e,userAction:t}){t&&this.project&&(this.project.transport.load.url=e,this.project.load())}}jE.initClass(),jE._$name="ProjectCombo";class BE extends wc{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilters:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,collapsibleGroups:!0,itemTpl:e=>$.encodeHtml(e.name||""),masterFilter:e=>!0,filterResources:null}}itemIconTpl(e,t){const{eventColor:n}=e,r=Br.isNamedColor(n)?` b-sch-foreground-${n}`:"",i=!r&&n?` style="color:${n}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${r}"${i}></div>`:""}changeStore(e){if(this.eventStore)return super.changeStore(...arguments);this._storeConfig=e}changeEventStore(e){return this.getConfig("store"),e}updateEventStore(e){const t=this,n=t._storeConfig||{},{resourceStore:r}=e,i=t.store=r.chain(t.masterFilter,null,{...n,syncOrder:!0}),s={change:"onStoreChange",thisObj:t};i.un(s),r.ion(s),r.count?t.initFilter():r.project.ion({name:"project",refresh:"initFilter",thisObj:t})}changeMasterFilter(e){const t=this;if(!t.filterResources)return function(n){return t.callback(e,t,[n])}}initFilter(){const e=this;if(e.eventStore.resourceStore.count){const{selected:n}=e;var t;if(!n.count)0===(null===(t=e.initialConfig.selected)||void 0===t?void 0:t.length)?e.onInternalSelectionChange({source:n,added:[],removed:[]}):n.add(e.store.allRecords.filter((e=>!e.isGroupHeader)));e.detachListeners("project")}}onStoreRefresh({source:e,action:t}){if("filter"===t&&this.eventStoreFilter){const{eventStoreFilter:t}=this,{disabled:n}=t,r=!e.isFiltered&&this.allSelected;r!==n&&(t.disabled=r,this.applyFilters())}super.onStoreRefresh(...arguments)}onInternalSelectionChange({source:e,added:t,removed:n}){const r=this,i=!r.store.isFiltered&&r.allSelected;super.onInternalSelectionChange(...arguments);let s=!1;if(r.eventStoreFilter||(r.eventStoreFilter=r.eventStore.addFilter({id:`${r.id}-filter-instance`,filterBy:e=>!e.resource||r.selected.includes(e.resources),disabled:i},(null==t?void 0:t.length)===r.store.count),s=!0),r.filterResources&&!r.resourceStoreFilter&&(r.resourceStoreFilter=r.eventStore.resourceStore.addFilter({id:`${r.id}-filter-instance`,filterBy:e=>r.selected.includes(e),disabled:i},(null==t?void 0:t.length)===r.store.count),s=!0),!s&&(r.eventStoreFilter.disabled=i,r.resourceStoreFilter&&(r.resourceStoreFilter.disabled=i),r.applyFilters(),r.eventListeners.change)){const i=e.values,s=i.concat(n);H.remove(s,...t),r.triggerFieldChange({value:i,oldValue:s})}}get value(){return this.selected.values}applyFilters(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}doDestroy(){var e;null===(e=this.store)||void 0===e||e.destroy(),super.doDestroy()}}BE.initClass(),BE._$name="ResourceFilter";class VE extends Fm{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}}}construct(e){"events"in e&&(delete(e={...e,showEvents:e.events}).events,_.deprecate(_.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}changeEventFilter(e){if("string"==typeof e){const{handler:t,thisObj:n}=this.resolveCallback(e);e=t.bind(n)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,t){const n=this,{classList:r}=n.contentElement;let{eventStore:i}=n;if(n.requestAnimationFrame((()=>{var i;n.element.classList.toggle("b-datepicker-with-events",Boolean(e)),null===(i=n.owner)||void 0===i||i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&r.add(`b-show-events-${e}`),r.remove(`b-show-events-${t}`)})),e){if(!i){const e=n.up((e=>e.eventStore));if(!e)throw new Error("DatePicker configured with events but no eventStore");i=e.eventStore}}else n.eventsMap=null;n.isConfiguring||(n.updateEventStore(i),n.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap,filter:e.eventFilter}))}updateEventStore(e){var t;-1===e.findListener("change","refresh",this)&&(null==e||null===(t=e[this.showEvents?"on":"un"])||void 0===t||t.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:t}){var n,r;const{showEvents:i}=this,s=null===(n=this.eventCounts)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,Gt.makeKey(t)),o="count"===i;delete e.dataset.btip,s&&(!o&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),Br.createElement({dataset:{count:s},class:{[o?"b-cell-events-badge":"b-icon b-icon-circle"]:1,[VE.getEventCountClass(s)]:1},parent:e,[o?"text":""]:s}))}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}VE.initClass(),VE._$name="SchedulerDatePicker";const HE=e=>e.isProjectConsumer;class NE extends Sm{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(HE))}changeScheduler(e){return e.isProjectConsumer?e:NE.getById(e)}updateScheduler(e){const{crudManager:t}=e;e.ion({projectChange:"onProjectChanged",thisObj:this}),t?this.setupLoadListener(t):this.onLoad(),this.stm=e.project.stm}setupLoadListener(e){e.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}}NE.initClass(),NE._$name="UndoRedo";class zE extends Mc{static $name="ViewPresetCombo";static type="viewpresetcombo";static configurable={presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,useFixedDuration:!0,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"};construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up((e=>e.isTimelineBase))||ba.query((e=>e.isTimelineBase))}changeValue(e,t){return this.getConfig("presets"),super.changeValue(e,t)}updatePresets(e){this.store=this.scheduler.presets.chain((t=>e.includes(t.id))),this.store.sort(((t,n)=>e.indexOf(t.id)-e.indexOf(n.id)))}onClientPresetChange({preset:e}){const t=this;t._isSelecting||(t.isSettingValue=!0,t.store.includes(e.id)?t.value=e:t.clear(),t.isSettingValue=!1)}onSelect({record:e}){if(!this.isSettingValue){const{scheduler:t}=this,{mainUnit:n,start:r,defaultSpan:i}=e,s={};if(n&&i&&this.useFixedDuration){let e=n;r&&"string"==typeof r&&(e=Gt.parseTimeUnit(r)??r),s.startDate=Gt.startOf(t.viewportCenterDate,e),"number"==typeof r&&(s.startDate=Gt.add(s.startDate,r,n)),s.endDate=Gt.add(s.startDate,i,n)}t.zoomToLevel(e,s)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}}zE.initClass(),zE._$name="ViewPresetCombo";class WE extends Mc{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}}WE.initClass(),WE._$name="ModelCombo";class UE extends WE{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:(e,t)=>{var n,r,i;return(null===(i=e=e||(null===(n=t.store)||void 0===n||null===(r=n.project)||void 0===r?void 0:r.effectiveCalendar))||void 0===i?void 0:i.name)||this.L("L{Default calendar}")}}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}}UE.initClass(),UE._$name="CalendarField";class GE extends(td.mixin(ZS)){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:UE.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.ion({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:t}){const n=t[this.field];if(n){var r;if("string"==typeof n.oldValue&&(null===(r=n.value)||void 0===r?void 0:r.id)===n.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(null!=e&&e.id){const t=this.editor.store.getById(e.id);return(null==t?void 0:t.getValue(this.editor.displayField))||""}return""}}id.registerColumnType(GE),GE._$name="ResourceCalendarColumn";const YE=-Math.pow(2,30),qE=Math.pow(2,30)-1,KE=e=>e.slice(0,1).toUpperCase()+e.slice(1),XE=e=>Object(e)!==e,ZE=(e,t,n)=>(Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0}),n),JE=e=>function(t,n){t[n]=e},QE=e=>new Promise((t=>setTimeout(t,e)));let ex=null;const tx=function(e){return null===ex&&(ex="undefined"!=typeof regeneratorRuntime),!0===ex?regeneratorRuntime.isGeneratorFunction(e):"GeneratorFunction"===e.constructor.name},nx=function(e){return e&&"function"==typeof e.then};var rx=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const ix=Symbol("BreakCurrentStackExecution");class sx extends ky{}rx([JE(!0)],sx.prototype,"sync",void 0),rx([JE(!0)],sx.prototype,"pure",void 0);const ox=Symbol("ProposedOrPreviousSymbol"),ax=sx.new({handler:ox}),lx=Symbol("RejectSymbol");class cx extends sx{constructor(){super(...arguments),this.handler=lx}}rx([JE(!1)],cx.prototype,"pure",void 0);const dx=e=>cx.new({reason:e}),ux=Symbol("TransactionSymbol"),hx=sx.new({handler:ux}),gx=Symbol("OwnQuarkSymbol"),mx=sx.new({handler:gx}),px=Symbol("OwnIdentifierSymbol"),fx=sx.new({handler:px}),vx=Symbol("WriteSymbol");class yx extends sx{constructor(){super(...arguments),this.handler=vx}}rx([JE(!1)],yx.prototype,"pure",void 0);const bx=(e,t,...n)=>yx.new({identifier:e,proposedArgs:[t,...n]}),Cx=Symbol("WriteSeveralSymbol");class Sx extends sx{constructor(){super(...arguments),this.handler=Cx}}rx([JE(!1)],Sx.prototype,"pure",void 0);const Dx=e=>Sx.new({writes:e}),wx=Symbol("PreviousValueOfSymbol");class Ex extends sx{constructor(){super(...arguments),this.handler=wx}}const xx=e=>Ex.new({identifier:e}),Rx=Symbol("ProposedValueOfSymbol");class Tx extends sx{constructor(){super(...arguments),this.handler=Rx}}const Mx=e=>Tx.new({identifier:e}),kx=Symbol("HasProposedValueSymbol");class Ix extends sx{constructor(){super(...arguments),this.handler=kx}}const Ax=e=>Ix.new({identifier:e}),Fx=Symbol("HasProposedNotPreviousValueSymbol");class Px extends sx{constructor(){super(...arguments),this.handler=Fx}}const Ox=e=>Px.new({identifier:e}),Lx=Symbol("ProposedOrPreviousValueOfSymbol");class $x extends sx{constructor(){super(...arguments),this.handler=Lx}}const _x=e=>$x.new({identifier:e}),jx=Symbol("ProposedArgumentsOfSymbol");class Bx extends sx{constructor(){super(...arguments),this.handler=jx}}const Vx=e=>Bx.new({identifier:e}),Hx=Symbol("UnsafeProposedOrPreviousValueOfSymbol");class Nx extends sx{constructor(){super(...arguments),this.handler=Hx}}const zx=e=>Nx.new({identifier:e}),Wx=Symbol("UnsafePreviousValueOfSymbol");class Ux extends sx{constructor(){super(...arguments),this.handler=Wx}}var Gx;e.OnCycleAction=void 0,(Gx=e.OnCycleAction||(e.OnCycleAction={})).Cancel="Cancel",Gx.Resume="Resume";const Yx=Symbol("WalkSource"),qx=-1,Kx=-2;class Xx extends ky{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map((e=>({node:e,from:Yx,label:i})))),this.walkDepth()}onNode(e,t){}onTopologicalNode(e){}onCycle(t,n){return e.OnCycleAction.Cancel}forEachNext(e,t){throw new Error("Abstract method called")}collectNext(e,t,n){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,t,n){return n?(n.visitedAt=t,n.visitEpoch=this.currentEpoch):(n={visitedAt:t,visitEpoch:this.currentEpoch},this.visited.set(e,n)),n}walkDepth(){this.visited;const t=this.toVisit;let n;for(;n=t.length;){const r=t[n-1].node,i=this.getVisitedInfo(r);if(i&&i.visitedAt===Kx&&i.visitEpoch===this.currentEpoch)t.pop();else if(i&&i.visitEpoch===this.currentEpoch&&i.visitedAt!==qx){if(i.visitedAt<n){if(this.onCycle(r,t)!==e.OnCycleAction.Resume)break}else i.visitedAt=Kx,this.onTopologicalNode(r);t.pop()}else{if(!1===this.onNode(r,t[n-1]))break;const e=this.setVisitedInfo(r,n,i),s=t.length;this.collectNext(r,t,e),t.length===s&&(e.visitedAt=Kx,this.onTopologicalNode(r),t.pop())}}}}function Zx(e){const t=e.length;if(0===t)return[];const n=e[t-1].node,r=[n];let i=t-1,s=i;for(;i>=0&&e[i].from!==n;){for(;i>=0&&e[i].from===e[s].from;)i--;i>=0&&(r.push(e[i].node),s=i)}return i<0?[]:(r.push(n),r.reverse())}var Jx;e.EdgeType=void 0,(Jx=e.EdgeType||(e.EdgeType={}))[Jx.Normal=1]="Normal",Jx[Jx.Past=2]="Past";let Qx=0;class eR extends(My([Map],(t=>class extends t{constructor(){super(...arguments),this.identifier=i,this.value=i,this.proposedValue=i,this.proposedIsPrevious=!1,this.proposedArguments=i,this.usedProposedOrPrevious=!1,this.previous=i,this.origin=i,this.originId=YE,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=qx,this.visitEpoch=0,this.promise=i,this.$outgoingPast=i}static new(e){const t=new this;return e&&Object.assign(t,e),t}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=qE}cleanup(){this.cleanupCalculation()}isShadow(){return Boolean(this.origin&&this.origin!==this)}resetToEpoch(e){this.visitEpoch=e,this.visitedAt=qx,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=i,this.origin&&this.origin===this?(this.proposedArguments=i,this.value!==i&&(this.proposedValue=this.value),this.value=i):(this.origin=i,this.value=i),this.identifier.proposedValueIsBuilt&&this.proposedValue!==tR&&(this.needToBuildProposedValue=!0,this.proposedValue=i)}copyFrom(e){this.value=e.value,this.proposedValue=e.proposedValue,this.proposedArguments=e.proposedArguments,this.usedProposedOrPrevious=e.usedProposedOrPrevious}clearProperties(){this.value=i,this.proposedValue=i,this.proposedArguments=i}mergePreviousOrigin(e){const t=this.origin;if(t!==this.previous)throw new Error("Invalid state");this.copyFrom(t);const n=this.getOutgoing();for(const[r,i]of t.getOutgoing()){if(!n.get(r)){const t=e.get(r);t&&t.originId!==i.originId||n.set(r,t||i)}}if(t.$outgoingPast!==i){const n=this.getOutgoingPast();for(const[r,i]of t.getOutgoingPast()){if(!n.get(r)){const t=e.get(r);t&&t.originId!==i.originId||n.set(r,t||i)}}}this.origin=this,t.clearProperties(),t.clear()}setOrigin(e){this.origin=e,this.originId=e.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=Qx++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==i?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(t,n){(n===e.EdgeType.Normal?this:this.getOutgoingPast()).set(t.identifier,t)}clearOutgoing(){this.clear(),this.$outgoingPast!==i&&this.$outgoingPast.clear()}getValue(){const e=this.origin;return e===this?this.value:e?e.getValue():i}setValue(e){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=e}hasValue(){return this.getValue()!==i}hasProposedValue(){return!this.isShadow()&&this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==i}getProposedValue(e){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,e),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(e,t){let n=this;for(;n;){for(const r of n.getOutgoing().values())r.originId===e.getLatestEntryFor(r.identifier).originId&&t(r);n=n.isShadow()?n.previous:null}}outgoingInTheFutureAndPastCb(e,t){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const n=e.getLatestEntryFor(r.identifier);n&&r.originId===n.originId&&t(r)}if(n.$outgoingPast!==i)for(const r of n.$outgoingPast.values()){const n=e.getLatestEntryFor(r.identifier);n&&r.originId===n.originId&&t(r)}n=n.isShadow()?n.previous:null}}outgoingInTheFutureAndPastTransactionCb(e,t){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const n=e.getLatestStableEntryFor(r.identifier);n&&r.originId===n.originId&&t(r)}if(n.$outgoingPast!==i)for(const r of n.$outgoingPast.values()){const n=e.getLatestStableEntryFor(r.identifier);n&&r.originId===n.originId&&t(r)}n=n.isShadow()?n.previous:null}}outgoingInTheFutureTransactionCb(e,t){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const n=e.getLatestEntryFor(r.identifier);n&&r.originId===n.originId&&t(r)}n=n.isShadow()?n.previous:null}}}))){}const tR=Symbol("Tombstone"),nR=(...e)=>i,rR=e=>nR,iR=Symbol("ContextSync"),sR=Symbol("ContextGen");class oR extends(Ty([],(e=>class extends e{constructor(){super(...arguments),this.iterator=i,this.iterationResult=i}isCalculationStarted(){return Boolean(this.iterator||this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:i}startCalculation(e,...t){const n=this.iterator=this.calculation.call(this.context||this,e,...t);return this.iterationResult=n.next()}continueCalculation(e){return this.iterationResult=this.iterator.next(e)}cleanupCalculation(){this.iterationResult=i,this.iterator=i}*calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(e(this.iterationResult.value));return this.iterator=i,this.result}async runAsyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(await e(this.iterationResult.value));return this.iterator=i,this.result}}))){}const aR=Symbol("SynchronousCalculationStarted"),lR={value:aR};class cR extends(Ty([],(e=>class extends e{constructor(){super(...arguments),this.iterationResult=i}isCalculationStarted(){return Boolean(this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:i}startCalculation(e,...t){return this.iterationResult=lR,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,e,...t)}}continueCalculation(e){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=i}calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){return this.startCalculation(e,...t),this.result}async runAsyncWithEffect(e,...t){throw new Error("Can not run synchronous calculation asynchronously")}}))){}function dR(e,t,n,r){const i=t.apply(r||null,n);let s=i.next();for(;!s.done;)s=i.next(e(s.value));return s.value}async function uR(e,t,n,r){const i=t.apply(r||null,n);let s=i.next();for(;!s.done;){let t,n=!1;do{n=!1;try{t=e(s.value)}catch(t){if(t instanceof sx){if("Cancel"===await e(t))return void e(dx(t));n=!0}}}while(n);s=nx(t)?i.next(await t):i.next(t)}return s.value}var hR,gR=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};e.Levels=void 0,(hR=e.Levels||(e.Levels={}))[hR.UserInput=0]="UserInput",hR[hR.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",hR[hR.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",hR[hR.DependsOnSelfKind=3]="DependsOnSelfKind";class mR extends ky{constructor(){super(...arguments),this.name=i,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,t){return e===t}}gR([JE(e.Levels.DependsOnSelfKind)],mR.prototype,"level",void 0),gR([JE(!0)],mR.prototype,"sync",void 0);class pR extends mR{constructor(){super(...arguments),this.context=i,this.isWritingUndefined=!1}newQuark(e){const t=this.quarkClass.new();return t.identifier=this,t.needToBuildProposedValue=this.proposedValueIsBuilt,t}write(e,t,n,r,...s){(n=n||t.getWriteTarget(e)).proposedValue=r,n.proposedArguments=s.length>0?s:i,n.proposedIsPrevious=t.graph.isWritingPreviousData}writeToTransaction(e,t,...n){e.write(this,t,...n)}writeToGraph(e,t,...n){e.write(this,t,...n)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,t,n){return i}enterGraph(e){}leaveGraph(e){}}const fR=eR.mix(cR.mix(Map)),vR=eR.mix(oR.mix(Map));class yR extends pR{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,t,n,r,...s){(n=n||t.getWriteTarget(e)).value=r,n.proposedArguments=s.length>0?s:i}}function bR(...e){return yR.new(...e)}gR([JE(e.Levels.UserInput)],yR.prototype,"level",void 0),gR([JE(fR)],yR.prototype,"quarkClass",void 0);class CR extends pR{calculation(e){return e(ax)}}function SR(...e){return CR.new(...e)}gR([JE(fR)],CR.prototype,"quarkClass",void 0);class DR extends pR{*calculation(e){return yield ax}}function wR(...e){return DR.new(...e)}gR([JE(vR)],DR.prototype,"quarkClass",void 0);const ER=e=>{throw new Error(`Unknown identifier ${e}`)};let xR=0;class RR extends ky{constructor(){super(...arguments),this.createdAt=xR++,this.name="revision-"+this.createdAt,this.previous=i,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let t=this;for(;t;){const n=t.scope.get(e);if(n)return n;t=t.previous}return null}hasIdentifier(e){const t=this.getLatestEntryFor(e);return Boolean(t&&t.getValue()!==tR)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}}class TR{constructor(){this.length=0,this.levels=[],this.lowestLevel=qE}getLowestLevel(){for(let e=this.lowestLevel!==qE?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=qE}takeLowestLevel(){for(let e=this.lowestLevel!==qE?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(t)return this.length-=t.length,this.levels[e]=null,this.lowestLevel=e+1,t}}pop(){for(let e=this.lowestLevel!==qE?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(this.lowestLevel=e,t&&t.length>0)return this.length--,t.pop()}this.lowestLevel=qE}push(e){const t=e.level;let n=this.levels[t];if(!n){for(let e=this.levels.length;e<t;e++)this.levels[e]=null;n=this.levels[t]=[]}n.push(e),this.length++,t<this.lowestLevel&&(this.lowestLevel=t)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const t=this.levels[e];t&&(yield*t)}}}class MR extends ky{toString(){const e=[],t=[];return this.cycle.forEach((({name:n,context:r})=>{e.push(n),t[t.length-1]!==r&&t.push(r)})),"events: \n"+t.map((e=>"#"+e.id)).join(" => ")+"\n\nidentifiers: \n"+e.join("\n")}}class kR extends Xx{constructor(){super(...arguments),this.transaction=i}onCycle(t,n){return e.OnCycleAction.Cancel}doCollectNext(e,t,n){let r=this.visited.get(t);r||(r={visitedAt:qx,visitEpoch:this.currentEpoch},this.visited.set(t,r)),n.push({node:t,from:e,label:i})}collectNext(e,t){const n=this.transaction.getLatestEntryFor(e);n&&n.outgoingInTheFutureTransactionCb(this.transaction,(n=>{this.doCollectNext(e,n.identifier,t)}))}}class IR extends ky{constructor(){super(...arguments),this.visited=new Map,this.transaction=i,this.baseRevision=i,this.pushTo=i,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(t,n){t.lazy||t.level===e.Levels.UserInput||this.pushTo.push(n)}onCycle(t,n){return e.OnCycleAction.Resume}doCollectNext(e,t,n){let r=this.visited.get(t);r||(r=t.newQuark(this.baseRevision),r.visitEpoch=this.currentEpoch,this.visited.set(t,r)),n.push(t)}collectNext(e,t,n){const r=this.baseRevision.getLatestEntryFor(e);r&&(n.previous=r,r.outgoingInTheFutureAndPastTransactionCb(this.transaction,(n=>{this.doCollectNext(e,n.identifier,t)})));for(const r of n.getOutgoing().keys())this.doCollectNext(e,r,t);if(n.$outgoingPast!==i)for(const r of n.getOutgoingPast().keys())this.doCollectNext(e,r,t)}walkDepth(){const t=this.visited,n=this.toVisit;let r;for(;r=n.length;){const i=n[r-1];let s=t.get(i);if(s&&s.visitedAt===Kx&&s.visitEpoch===this.currentEpoch)s.edgesFlow++,n.pop();else if(s&&s.visitEpoch===this.currentEpoch&&s.visitedAt!==qx){if(s.visitedAt<r){if(this.onCycle(i,n)!==e.OnCycleAction.Resume)break;s.edgesFlow++}else s.visitedAt=Kx,this.onTopologicalNode(i,s);n.pop()}else{const e=n.length;s||(s=i.newQuark(this.baseRevision),s.visitEpoch=this.currentEpoch,t.set(i,s)),this.collectNext(i,n,s),s.visitEpoch<this.currentEpoch&&s.resetToEpoch(this.currentEpoch),s.visitedAt=r,s.edgesFlow++,n.length===e&&(s.visitedAt=Kx,this.onTopologicalNode(i,s),n.pop())}}}}const AR=e.EdgeType.Normal,FR=e.EdgeType.Past;class PR extends ky{constructor(){super(...arguments),this.baseRevision=i,this.candidateClass=RR,this.candidate=i,this.graph=i,this.isClosed=!1,this.walkContext=i,this.entries=new Map,this.stackGen=new TR,this.activeStack=[],this.onEffectSync=i,this.onEffectAsync=i,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=i,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=IR.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const t=this.entries.get(e);t&&t.getValue()===tR||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return nx(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(nx(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof pR))return this.yieldAsync(e);let t;const n=this.getActiveEntry();if(n)t=this.addEdge(e,n,AR);else if(t=this.entries.get(e),!t){const n=this.baseRevision.getLatestEntryFor(e);n||ER(e),t=n.hasValue()?n:this.touch(e)}return t.hasValue()?t.getValue():t.promise?t.promise:(t.previous&&t.previous.hasValue()||t.forceCalculation(),this.ongoing=t.promise=this.ongoing.then((()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await uR(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),t.getValue()===i)return uR(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})())).then((()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!t.hasValue())throw new Error("Computation cycle. Sync");return t.getValue()})))}get(e){if(!(e instanceof pR))return this.yieldSync(e);let t;const n=this.getActiveEntry();if(n)t=this.addEdge(e,n,AR);else if(t=this.entries.get(e),!t){const n=this.baseRevision.getLatestEntryFor(e);n||ER(e),t=n.hasValue()?n:this.touch(e)}const r=t.getValue();if(r===tR&&ER(e),r!==i&&t.hasValue())return r;if(t.promise)return t.promise;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[t]);const n=t.getValue();if(n===i)throw new Error("Cycle during synchronous computation");return n===tR&&ER(e),n}return this.ongoing=t.promise=this.ongoing.then((()=>{if(t.getValue()===i)return uR(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})).then((()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const n=t.getValue();if(n===i)throw new Error("Computation cycle. Async get");return n===tR&&ER(e),n}))}read(e){if(!(e instanceof pR))return this.yieldSync(e);let t;const n=this.getActiveEntry();if(n)t=this.addEdge(e,n,AR);else if(t=this.entries.get(e),!t){const n=this.baseRevision.getLatestEntryFor(e);n||ER(e),t=n.hasValue()?n:this.touch(e)}const r=t.getValue();if(r===tR&&ER(e),r!==i)return r;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[t]);const s=t.getValue();if(s===i)throw new Error("Cycle during synchronous computation");return s===tR&&ER(e),s}readCurrentOrProposedOrPrevious(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(e!==i)return e;if(t.proposedValue!==i)return t.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(e!==i)return e;if(t.proposedValue!==i)return t.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return i;const n=t.getValue();return n!==tR?n===i&&e.lazy?this.read(e):n:i}readPreviousAsync(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return i;const n=t.getValue();return n!==tR?n!==i?n:this.readAsync(e):i}readProposedOrPrevious(e){const t=this.entries.get(e);return t&&t.proposedValue!==i?t.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const t=this.entries.get(e);return t&&t.proposedValue!==i?t.proposedValue:this.readPreviousAsync(e)}write(t,n,...r){n===i&&(n=null),t.write.call(t.context||t,t,this,null,n,...r);const s=this.entries.get(t);this.hasVariableEntry=this.hasVariableEntry||!s.isShadow()&&t.level===e.Levels.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||s.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const t=this.entries.get(e);return t&&t.origin===t?t.origin:i}touch(e){const t=this.entries.get(e);(!t||t.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const n=t||this.entries.get(e);return n.forceCalculation(),n}hasIdentifier(e){const t=this.entries.get(e);return(!t||t.getValue()!==tR)&&Boolean(t||this.baseRevision.getLatestEntryFor(e))}addIdentifier(t,n,...r){let s=this.entries.get(t);const o=Boolean(s),a=t.level===e.Levels.UserInput;if(s||(s=t.newQuark(this.baseRevision),s.previous=this.baseRevision.getLatestEntryFor(t),s.forceCalculation(),this.entries.set(t,s),t.lazy||a||this.stackGen.push(s),this.hasVariableEntry=this.hasVariableEntry||!s.isShadow()&&a,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||s.hasProposedValue()),n!==i||a){s.startOrigin();o&&(s.proposedValue!==i||s.value!==i)&&s.proposedValue!==tR&&s.value!==tR||(t.isWritingUndefined=n===i,t.write.call(t.context||t,t,this,s,n===i&&a?null:n,...r),t.isWritingUndefined=!1)}return s.getValue()===tR&&(s.value=i),s.proposedValue===tR&&(s.proposedValue=i),t.enterGraph(this.graph),s}removeIdentifier(e){e.leaveGraph(this.graph);this.touch(e).startOrigin().setValue(tR),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,t){if(0===e.scope.size)e.scope=t;else for(const[n,r]of t)if(r.isShadow()){const t=e.getLatestEntryFor(n);r.getOutgoing().forEach(((e,n)=>t.getOutgoing().set(n,e)))}else e.scope.set(n,r)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=i,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=cx.new()){this.rejectedWith=e,this.walkContext=i}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then((()=>uR(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this))).then((()=>this.postCommit()))}getLatestEntryFor(e){let t=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);return t&&t.getValue()===tR?i:t}getLatestStableEntryFor(e){let t=this.entries.get(e);if(t){const n=t.getValue();return n===tR?i:n===i?this.baseRevision.getLatestEntryFor(e):t}return this.baseRevision.getLatestEntryFor(e)}addEdge(e,t,n){if(t.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let r=this.entries.get(e);if(!r){const t=this.baseRevision.getLatestEntryFor(e);t||ER(e),r=e.newQuark(this.baseRevision),r.setOrigin(t),r.previous=t,this.entries.set(e,r)}return r.addOutgoingTo(t,n),r}onQuarkCalculationCompleted(e,t){e.cleanup();const n=e.identifier,r=e.previous,s=Boolean(r&&r.hasValue()&&n.equality(t,r.getValue()));s?(r.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=this.entries.get(e.identifier);t&&t.edgesFlow--})),e.edgesFlow=qE,e.setOrigin(r.origin)):(e.startOrigin(),e.setValue(t));let o=!1;e.usedProposedOrPrevious&&(e.proposedValue!==i?n.equality(t,e.proposedValue)&&(o=!0):(s||!r&&null===t)&&(o=!0),o||this.candidate.selfDependent.add(n))}onReadIdentifier(t,n,r){const s=this.addEdge(t,n,AR);if(s.hasValue()||s.value!==i){const e=s.getValue();return e===tR&&ER(t),n.continueCalculation(e)}if(s.isShadow())return s.startOrigin(),s.forceCalculation(),r.push(s),i;if(s.isCalculationStarted()){let t;const r=kR.new({transaction:this,onCycle:(r,i)=>(t=MR.new({cycle:Zx(i),requestedEntry:s,activeEntry:n}),e.OnCycleAction.Cancel)});return r.startFrom([s.identifier]),t}return r.push(s),s.previous&&s.previous.hasValue()||s.forceCalculation(),i}*calculateTransitions(e){const t=this.stackGen;for(;t.length;)yield*this.calculateTransitionsStackGen(e,t.takeLowestLevel())}calculateTransitionsSync(e){const t=this.stackGen;for(;t.length;)this.calculateTransitionsStackSync(e,t.takeLowestLevel())}*calculateTransitionsStackGen(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const n=this.entries,r=this.propagationStartDate,s=!!this.graph&&this.graph.enableProgressNotifications;let o=0;const a=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){if(s&&!(o++%this.emitProgressNotificationsEveryCalculations)){const e=Date.now();if(e-r>this.startProgressNotificationsAfterMs){const n=this.lastProgressNotificationDate;(!n||e-n>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=e,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+t.length,phase:"propagating"}),this.activeStack=a,yield QE(0),this.activeStack=t)}}if(this.rejectedWith||this.stopped)break;const e=t[t.length-1],l=e.identifier;if(n.get(l)!==e){e.cleanup(),t.pop();continue}if(0==e.edgesFlow){e.edgesFlow--;const t=e.previous;t&&t.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=n.get(e.identifier);t&&t.edgesFlow--}))}if(e.edgesFlow<0&&e.previous&&e.previous.origin){e.setOrigin(e.previous.origin),0===e.size&&n.delete(l),e.cleanup(),t.pop();continue}if(e.hasValue()||e.proposedValue===tR){e.cleanup(),t.pop();continue}const c=e.visitEpoch;let d=e.isCalculationStarted()?e.iterationResult:e.startCalculation(this.onEffectSync);for(;d&&!this.rejectedWith&&!this.stopped;){const n=d.value===i?null:d.value;if(e.isCalculationCompleted()){e.visitEpoch==c&&this.onQuarkCalculationCompleted(e,n),t.pop();break}if(n instanceof pR){const r=this.onReadIdentifier(n,e,t);r instanceof MR?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(r),e.cleanupCalculation(),d=i):d=r}else{if(n===aR){t.pop();break}{const r=yield n;if(r===ix)break;if(e.visitEpoch!==c){t.pop();break}d=e.continueCalculation(r)}}}}this.activeStack=a}calculateTransitionsStackSync(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const n=this.entries,r=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){const r=t[t.length-1],s=r.identifier;if(n.get(s)!==r){r.cleanup(),t.pop();continue}if(0==r.edgesFlow){r.edgesFlow--;const e=r.previous;e&&e.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=n.get(e.identifier);t&&t.edgesFlow--}))}if(r.edgesFlow<0&&r.previous&&r.previous.origin){r.setOrigin(r.previous.origin),0===r.size&&n.delete(s),r.cleanup(),t.pop();continue}if(r.hasValue()||r.proposedValue===tR){r.cleanup(),t.pop();continue}const o=r.visitEpoch;let a=r.isCalculationStarted()?r.iterationResult:r.startCalculation(this.onEffectSync);for(;a&&!this.rejectedWith&&!this.stopped;){const n=a.value===i?null:a.value;if(r.isCalculationCompleted()){r.visitEpoch==o&&this.onQuarkCalculationCompleted(r,n),t.pop();break}if(n instanceof pR){const e=this.onReadIdentifier(n,r,t);e instanceof MR?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(e,this),r.cleanupCalculation(),a=i):a=e}else{if(n===aR){t.pop();break}{const i=e(n);if(nx(i))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(i===ix)break;if(r.visitEpoch!==o){t.pop();break}a=r.continueCalculation(i)}}}}this.activeStack=r}}const OR={rejectedWith:null};class LR extends ky{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let t=0;t<this.handlers.length;t++)this.handlers[t](e)}}class $R extends ky{constructor(){super(...arguments),this.baseRevisionStable=i,this.baseRevisionTentative=i,this.baseRevision=RR.new(),this.topRevision=i,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=i,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=PR,this.isJustCleared=!1,this.$followingRevision=i}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler="sync"===this.autoCommitMode?e=>this.commit(e):async e=>this.commitAsync(e)),this.markAndSweep()}hasPendingAutoCommit(){return null!==this.autoCommitTimeoutId}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=i,this.$activeTransaction=i,this.markAndSweep(),this.isJustCleared=!0}clearBranch(){this.reject(),this.unScheduleAutoCommit();for(const[e,t]of this.eachReachableRevision())t&&e.reachableCount--,e.referenceCount--;this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=i,this.$activeTransaction=i}*eachReachableRevision(){let e=!0,t=0;for(const n of this.topRevision.previousAxis())yield[n,e||t<this.historyLimit],n===this.baseRevision?e=!1:e||t++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const t=[];for(const[n,r]of this.eachReachableRevision())r?(n.reachableCount++,e=n):t.push(n),n.referenceCount++;t.unshift(e);for(let e=t.length-1;e>=1&&0===t[e].reachableCount;e--)this.compactRevisions(t[e-1],t[e])}compactRevisions(e,t){if(t.reachableCount>0||e.previous!==t)throw new Error("Invalid compact operation");if(t.referenceCount<=1){for(const[n,r]of e.scope)if(r.getValue()===tR)t.scope.delete(n);else{const s=t.scope.get(n);r.origin===r?s&&(s.clear(),s.clearProperties()):s&&r.origin===s?r.mergePreviousOrigin(e.scope):n.lazy&&!r.origin&&s&&s.origin&&(r.startOrigin().proposedValue=s.origin.value!==i?s.origin.value:s.origin.proposedValue),r.previous=i,t.scope.set(n,r)}((e,t)=>{for(const n of e)t.add(n)})(e.selfDependent,t.selfDependent),e.scope=t.scope,t.scope=null}else e.scope=new Map(dy(t.scope,e.scope)),e.selfDependent=new Set(dy(t.selfDependent,e.selfDependent)),t.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==i)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),t=[];for(let n=e.length-1;n>0;n--)t.push([e[n],e[n-1]]);return this.$followingRevision=new Map(t)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(cx.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=i,this.baseRevisionTentative=i,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=i)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=i;const n=this.finalizeCommit(t);return this.baseRevisionStable=i,this.isInitialCommit=!1,n}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){return this.isCommitting?this.ongoing:(this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision,this.ongoing=this.ongoing.then((()=>this.doCommitAsync(e))).then((e=>e)).finally((()=>{this.baseRevisionStable=i,this.baseRevisionTentative=i,this.isInitialCommit=!1,this.isCommitting=!1})))}async doCommitAsync(e){this.unScheduleAutoCommit();const t=this.activeTransaction,n=await t.commitAsync(e),r=Boolean(t.rejectedWith),s=this.baseRevisionTentative;if(r||(this.baseRevisionTentative=t.candidate),this.$activeTransaction=i,await this.finalizeCommitAsync(n),this.isJustCleared)return{rejectedWith:cx.new({reason:"Graph cleared"})};t.rejectedWith&&!r&&(this.baseRevisionTentative=s,this.$activeTransaction=i);const o=this.finalizeCommit(n);return t.rejectedWith&&t.clearRejected(),this.dirty&&!t.rejectedWith&&await this.doCommitAsync(e),o}finalizeCommit(e){const{revision:t,entries:n,transaction:r}=e;if(r.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=i,this.baseRevisionTentative=i;else{if(t.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[e,t]of this.eachReachableRevision())t&&e.reachableCount--,e.referenceCount--;this.baseRevision=this.topRevision=t;for(const[e,t]of n){if(t.cleanup(),t.isShadow()||!t.hasValue())continue;const n=this.listeners.get(e);n&&n.trigger(t.getValue())}this.$followingRevision=i,this.markAndSweep()}return{rejectedWith:r.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const t=new Error("Computation cycle:\n"+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:n,activeEntry:r}=e;return r.continueCalculation(n.proposedValue!==i?n.proposedValue:n.value);case"throw":throw t;case"reject":this.reject(t)}}onComputationCycleHandlerSync(e,t){const n=new Error("Computation cycle:\n"+e);switch(n.cycle=e,this.onComputationCycle){case"ignore":console.log(n.message);const{requestedEntry:t,activeEntry:r}=e;return r.continueCalculation(t.proposedValue!==i?t.proposedValue:t.value);case"throw":throw n;case"reject":this.reject(n)}}scheduleAutoCommit(){null!==this.autoCommitTimeoutId||this.isCommitting||(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){null!==this.autoCommitTimeoutId&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const t=bR();return this.addIdentifier(t,e===i?null:e)}variableNamed(e,t){const n=bR({name:e});return this.addIdentifier(n,t===i?null:t)}identifier(e,t){const n=tx(e)?wR({calculation:e,context:t}):SR({calculation:e,context:t});return this.addIdentifier(n)}identifierNamed(e,t,n){const r="GeneratorFunction"===t.constructor.name?wR({name:e,calculation:t,context:n}):SR({name:e,calculation:t,context:n});return this.addIdentifier(r)}addIdentifier(e,t,...n){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Adding identifier during commit");this.onWriteDuringCommit}return this.activeTransaction.addIdentifier(e,t,...n),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Removing identifier during commit");this.onWriteDuringCommit}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,t,...n){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Write during commit");this.onWriteDuringCommit}this.activeTransaction.write(e,t,...n),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,t){const n=this.addIdentifier(DR.new({lazy:!1,calculation:e}));return this.addListener(n,t),n}observeContext(e,t,n){const r=this.addIdentifier(DR.new({lazy:!1,calculation:e,context:t}));return this.addListener(r,n),r}addListener(e,t){let n=this.listeners.get(e);n||(n=LR.new(),this.listeners.set(e,n)),n.handlers.push(t)}undo(){const e=this.baseRevision.previous;return!!e&&(this.baseRevision=e,this.$activeTransaction=i,!0)}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const t=this.followingRevision.get(e);return this.baseRevision=t,this.$activeTransaction=i,!0}onPropagationProgressNotification(e){}[ox](e,t){const n=t.getActiveEntry();n.usedProposedOrPrevious=!0;const r=n.getProposedValue(t);if(r!==i)return r;if(!n.previous)return i;return n.identifier.lazy?n.previous.hasValue()?n.previous.getValue():n.previous.hasProposedValue()?n.previous.getProposedValue(t):null:t.readPrevious(n.identifier)}[lx](e,t){return this.reject(e.reason),ix}[ux](e,t){return t}[gx](e,t){return t.getActiveEntry()}[px](e,t){return t.getActiveEntry().identifier}[vx](e,t){const n=t.getActiveEntry();if(n.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const r=e.identifier.level>n.identifier.level;return r||t.walkContext.startNewEpoch(),t.write(e.identifier,...e.proposedArgs),r?i:ix}[Cx](e,t){const n=t.getActiveEntry();if(n.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let r=!0;return e.writes.forEach((e=>{e.identifier.level<=n.identifier.level&&r&&(t.walkContext.startNewEpoch(),r=!1),t.write(e.identifier,...e.proposedArgs)})),r?i:ix}[wx](e,t){const n=t.getActiveEntry(),r=e.identifier;return t.addEdge(r,n,FR),t.readPrevious(r)}[Rx](e,t){const n=t.getActiveEntry(),r=e.identifier;t.addEdge(r,n,FR);const s=t.entries.get(r);return s&&!s.isShadow()?s.getProposedValue(t):i}[kx](e,t){const n=t.getActiveEntry(),r=e.identifier;t.addEdge(r,n,FR);const i=t.entries.get(r);return!!i&&i.hasProposedValue()}[Fx](e,t){const n=t.getActiveEntry(),r=e.identifier;t.addEdge(r,n,FR);const i=t.entries.get(r);return!!i&&(i.hasProposedValue()&&!i.proposedIsPrevious)}[Lx](e,t){const n=t.getActiveEntry(),r=e.identifier;return t.addEdge(r,n,FR),t.readProposedOrPrevious(r)}[Hx](e,t){return t.readProposedOrPrevious(e.identifier)}[Wx](e,t){return t.readPrevious(e.identifier)}[jx](e,t){const n=t.getActiveEntry(),r=e.identifier;t.addEdge(r,n,FR);const s=t.entries.get(r);return s&&!s.isShadow()?s.proposedArguments:i}}class _R extends ky{constructor(){super(...arguments),this.name=i,this.ownFields=new Map,this.schema=i,this.$skeleton={},this.$allFields=i}hasField(e){return this.getField(e)!==i}getField(e){return this.allFields.get(e)}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.ownFields.has(t))throw new Error(`Field with name [${t}] already exists`);return e.entity=this,this.ownFields.set(t,e),e}forEachParent(e){let t=this;for(;t;)e(t),t=t.parentEntity}get allFields(){if(this.$allFields!==i)return this.$allFields;const e=new Map,t=new Set;return this.forEachParent((n=>{n.ownFields.forEach(((n,r)=>{t.has(r)||(t.add(r),e.set(r,n))}))})),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}}var jR;e.ReadMode=void 0,(jR=e.ReadMode||(e.ReadMode={}))[jR.Current=0]="Current",jR[jR.Previous=1]="Previous",jR[jR.ProposedOrPrevious=2]="ProposedOrPrevious",jR[jR.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious";class BR extends(Ty([$R],(t=>class extends t{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=e.ReadMode.Current}addEntity(e){e.enterGraph(this)}addEntities(e){e.forEach((e=>this.addEntity(e)))}removeEntity(e){e.leaveGraph(this)}removeEntities(e){e.forEach((e=>this.removeEntity(e)))}}))){}class VR extends(Ty([pR],(t=>class extends t{constructor(){super(...arguments),this.field=i,this.self=i,this.DATA=i}getFromGraph(t){return t?t.readMode===e.ReadMode.Current?t.get(this):t.readMode===e.ReadMode.Previous?t.activeTransaction.readPrevious(this):(t.readMode===e.ReadMode.ProposedOrPrevious&&t.activeTransaction.readProposedOrPrevious(this),t.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(e){return e?e.read(this):this.DATA}writeToGraph(e,t,...n){e?e.write(this,t,...n):this.DATA=t}leaveGraph(e){const t=e.activeTransaction.getLatestStableEntryFor(this);t&&(this.DATA=t.getValue()),super.leaveGraph(e)}toString(){return this.name}}))){}class HR extends(VR.mix(CR)){}class NR extends(VR.mix(DR)){}class zR extends(VR.mix(yR)){}class WR extends(Ty([pR],(e=>class extends e{constructor(){super(...arguments),this.entity=i,this.self=i}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}))){}class UR extends(WR.mix(DR)){}class GR extends mR{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?tx(e)?NR:HR:zR}}const YR=Symbol("isEntity");class qR extends(Ty([],(e=>class extends e{[YR](){}get $entity(){return KR(this.constructor.prototype)}get $(){const e={};return this.$entity.forEachField(((t,n)=>{e[n]=this.createFieldIdentifier(t)})),ZE(this,"$",e)}get $$(){return ZE(this,"$$",UR.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(e){const t=e.name,n=this.$entity,r=this.constructor,i=n.$skeleton;i[t]||(i[t]=r.getIdentifierTemplateClass(this,e));const s=new i[t];return s.context=this,s.self=this,s.name=`${this.$$.name}.$.${e.name}`,s}forEachFieldIdentifier(e){this.$entity.forEachField(((t,n)=>e(this.$[n],n,t)))}enterGraph(e){if(this.graph)throw new Error("Already entered replica");this.graph=e,e.addIdentifier(this.$$),this.$entity.forEachField(((t,n)=>{const r=this.$[n];e.addIdentifier(r,r.DATA),r.DATA=i}))}leaveGraph(e){const t=this.graph,n=e||t;n&&(this.$entity.forEachField(((e,t)=>n.removeIdentifier(this.$[t]))),n.removeIdentifier(this.$$),n===t&&(this.graph=i))}propagate(e){return this.commit(e)}commit(e){const t=this.graph;return t?t.commit(e):OR}async propagateAsync(){return this.commitAsync()}async commitAsync(e){const t=this.graph;return t?t.commitAsync(e):Promise.resolve(OR)}static get $entity(){return XR(this.prototype)}static getIdentifierTemplateClass(e,t){const n=t.name,r={name:`${e.$$.name}.$.${n}`,field:t};t.hasOwnProperty("sync")&&(r.sync=t.sync),t.hasOwnProperty("lazy")&&(r.lazy=t.lazy),t.hasOwnProperty("equality")&&(r.equality=t.equality);const i=e.$calculations&&e[e.$calculations[n]];i&&(r.calculation=i);const s=e.$writes&&e[e.$writes[n]];s&&(r.write=s);const o=e.$buildProposed&&e[e.$buildProposed[n]];o&&(r.buildProposedValue=o,r.proposedValueIsBuilt=!0);const a=t.getIdentifierClass(i).new(r),l=function(){};return l.prototype=a,l}run(e,...t){const n=this.graph.activeTransaction,r=n.activeStack;n.activeStack=[];const i=dR((e=>{if(e instanceof pR)return this.graph.read(e);throw new Error("Helper methods can not yield effects during computation")}),this[e],t,this);return n.activeStack=r,i}static createPropertyAccessorsFor(e){const t=e,n=this.prototype;Object.defineProperty(n,t,{get:function(){return this.$[t].getFromGraph(this.graph)},set:function(e){this.$[t].writeToGraph(this.graph,e)}})}static createMethodAccessorsFor(e){const t=e,n=this.prototype,r=`get${KE(t)}`,i=`set${KE(t)}`,s=`put${KE(t)}`;r in n||(n[r]=function(){return this.$[t].getFromGraph(this.graph)}),i in n||(n[i]=function(e,...n){return this.$[t].writeToGraph(this.graph,e,...n),this.graph?"sync"===this.graph.autoCommitMode?this.graph.commit():this.graph.commitAsync():Promise.resolve(OR)}),s in n||(n[s]=function(e,...n){this.$[t].writeToGraph(this.graph,e,...n)})}}))){}const KR=e=>{let t=Object.getPrototypeOf(e);return ZE(e,"$entity",_R.new({parentEntity:t.hasOwnProperty(YR)?null:t.$entity,name:e.constructor.name}))},XR=e=>(e.hasOwnProperty("$entity")||KR(e),e.$entity),ZR=(e,t=GR)=>function(n,r){XR(n).addField(t.new(Object.assign(e||{},{name:r})));const i=n.constructor;i.createPropertyAccessorsFor(r),i.createMethodAccessorsFor(r)},JR=ZR,QR=function(e){return function(t,n,r){let i;XR(t),i=t.$calculations?t.hasOwnProperty("$calculations")?t.$calculations:t.$calculations=Object.create(t.$calculations):t.$calculations={},i[e]=n}},eT=function(e){return function(t,n,r){let i;XR(t),i=t.$writes?t.hasOwnProperty("$writes")?t.$writes:t.$writes=Object.create(t.$writes):t.$writes={},i[e]=n}},tT=function(e){return function(t,n,r){let i;XR(t),i=t.$buildProposed?t.hasOwnProperty("$buildProposed")?t.$buildProposed:t.$buildProposed=Object.create(t.$buildProposed):t.$buildProposed={},i[e]=n}};var nT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class rT extends(Ty([GR],(e=>class extends e{constructor(){super(...arguments),this.identifierCls=sT}}))){}class iT extends(Ty([VR],(t=>{class n extends t{constructor(){super(...arguments),this.field=i,this.proposedValueIsBuilt=!0}hasBucket(){return Boolean(this.field.bucket)}getBucket(e){return e.$[this.field.bucket]}buildProposedValue(e,t,n){const r=t.proposedValue;if(null===r)return null;const i=Ry(r,qR)?r:e.resolve(r);return i&&e.hasBucket()&&e.getBucket(i).addToBucket(n,e.self),i}resolve(e){const t=this.field.resolver;return t?t.call(this.self,e):null}enterGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof qR&&this.getBucket(t).addToBucket(e.activeTransaction,this.self)}super.enterGraph(e)}leaveGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof qR&&this.getBucket(t).removeFromBucket(e.activeTransaction,this.self)}super.leaveGraph(e)}write(e,t,n,r,...i){const s=n||t.acquireQuarkIfExists(e);if(e.hasBucket())if(s){const n=s.getValue();n instanceof qR&&e.getBucket(n).removeFromBucket(t,e.self)}else if(t.baseRevision.hasIdentifier(e)){const n=t.readPrevious(e);n instanceof qR&&e.getBucket(n).removeFromBucket(t,e.self)}super.write(e,t,n,r)}}return nT([JE(e.Levels.DependsOnlyOnUserInput)],n.prototype,"level",void 0),nT([JE(fR)],n.prototype,"quarkClass",void 0),n}))){}class sT extends(iT.mix(VR.mix(CR))){}var oT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class aT extends(Ty([GR],(e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=gT}}))){}const lT=(e,t=aT)=>ZR(e,t);var cT;!function(e){e.Add="Add",e.Remove="Remove"}(cT||(cT={}));class dT extends(Ty([eR],(e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=i}hasProposedValueInner(){return this.mutations.length>0}}))){}const uT=dT.mix(fR);class hT extends(Ty([VR],(t=>{class n extends t{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(e,t){const n=e.getWriteTarget(this);n.mutations.push({type:cT.Add,entity:t});const r=e.baseRevision;!n.previousValue&&r.hasIdentifier(this)&&(n.previousValue=e.readPrevious(this))}removeFromBucket(e,t){const n=e.entries.get(this);if(n&&n.getValue()===tR)return;const r=e.getWriteTarget(this);r.mutations.push({type:cT.Remove,entity:t});const i=e.baseRevision;!r.previousValue&&i.hasIdentifier(this)&&(r.previousValue=e.readPrevious(this))}buildProposedValue(e,t,n){const r=t,i=new Set(r.previousValue);for(let e=0;e<r.mutations.length;e++){const{type:t,entity:n}=r.mutations[e];t===cT.Remove?i.delete(n):t===cT.Add&&i.add(n)}return i}leaveGraph(e){super.leaveGraph(e),this.DATA=i}}return oT([JE(e.Levels.DependsOnlyOnDependsOnlyOnUserInput)],n.prototype,"level",void 0),oT([JE(uT)],n.prototype,"quarkClass",void 0),n}))){}class gT extends(hT.mix(VR.mix(CR))){}var mT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const pT=function(e,t){return e===t||(null!=t&&t.isBase?this.serialize(t):t)===(null!=e&&e.isBase?this.serialize(e):e)};class fT extends GR{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?tx(e)?xT:ET:RT}}class vT extends(rT.mix(fT)){constructor(){super(...arguments),this.identifierCls=DT}}class yT extends(aT.mix(GR)){constructor(){super(...arguments),this.identifierCls=wT}}const bT=Symbol("IsChronoModelSymbol");class CT extends(Ty([VR],(t=>{const n=t.prototype;class r extends t{[bT](){}getFromGraph(t){if(t){if(t.readMode===e.ReadMode.CurrentOrProposedOrPrevious){var r;const e=t.isCommitting&&this.level>((null===(r=t.activeTransaction.getActiveEntry())||void 0===r?void 0:r.level)??Number.MAX_SAFE_INTEGER);return!this.sync||this.context.project.isDelayingCalculation||e?t.activeTransaction.readCurrentOrProposedOrPrevious(this):t.get(this)}return n.getFromGraph.call(this,t)}return this.DATA}writeToGraph(e,t,...r){e?n.writeToGraph.call(this,e,t,...r):(this.DATA=t,this.self.inSetting||this.self.isConstructing||this.field.ignore||this.self.set(this.field.name,t,!1,!1,!0))}write(e,t,r,i,...s){i=e.convert(i),n.write.call(this,e,t,r,i,...s)}convert(e){const t=this.field,n=this.self.getFieldDefinition(t.name);return null!=n&&n.convert?e=n.convert(e,this.context.data,this.context):t.converter&&(e=t.converter(e,t)),e}equality(e,t){return e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e===t}}return mT([JE(!1)],r.prototype,"sync",void 0),r}))){}class ST extends(Ty([fR],(e=>{const t=e.prototype;return class extends e{setValue(e){t.setValue.call(this,e),e!==tR&&(this.identifier.DATA=e)}}}))){}class DT extends(iT.mix(CT.mix(HR))){buildProposedValue(e,t,n){const r=t,s=r.proposedValue;if(null===s||s===i)return n.candidate.failedResolutionReferences.delete(r.identifier),null;if(Ry(s,qR)&&s.graph)return e.hasBucket()&&e.getBucket(s).addToBucket(n,e.self),n.candidate.failedResolutionReferences.delete(r.identifier),"parentEvent"===e.field.name&&e.self.updateParentEvent(s,e.DATA),s;const o=e.resolve(s);return Ry(o,qR)&&o.graph?(e.hasBucket()&&e.getBucket(o).addToBucket(n,e.self),n.candidate.failedResolutionReferences.delete(r.identifier),o):(n.candidate.failedResolutionReferences.set(r.identifier,s),null)}}mT([JE(!0)],DT.prototype,"sync",void 0),mT([JE(ST)],DT.prototype,"quarkClass",void 0);class wT extends(hT.mix(CT.mix(HR))){}mT([JE(!0)],wT.prototype,"sync",void 0);class ET extends(CT.mix(HR)){}class xT extends(CT.mix(NR)){}class RT extends(CT.mix(zR)){}const TT=function(e={},t={},n=fT){return function(r,i){ZR({modelFieldConfig:e,...t},n)(r,i),MT(r.constructor)}},MT=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return kT(this)}})},kT=e=>{const t=e.prototype,n=[];return t.hasOwnProperty("$entity")&&t.$entity.ownFields.forEach((e=>{if(e instanceof fT){const t=e.modelFieldConfig||{};!t.convert&&e.converter&&e.converter!==IT&&(t.convert=e.converter),n.push(Object.assign(t,{$chrono:e,name:e.name}))}})),n},IT=(e,t)=>{if(null===e)return null;var n,r;e instanceof Date||(e=Gt.parse(e,(null===(n=t.modelFieldConfig)||void 0===n?void 0:n.format)||(null===(r=t.modelFieldConfig)||void 0===r?void 0:r.dateFormat)||Gt.defaultParseFormat));return e||i};class AT extends(Ty([qR,ds],(e=>{const t=e.prototype;return class extends e{get isEntity(){return!0}construct(e,...n){this.constructor.exposeProperties(),this.originalData=e=e||{},t.construct.call(this,e,...n);for(const t in this.originalData)this.$[t]&&!this.getFieldDefinition(t)&&(this[t]=e[t])}*userProvidedValue(){return yield ax}copy(e=null,n=null){const r=t.copy.call(this,e,n),{creatingOccurrence:i}=n??{};return(Xt.isObject(n)&&!n.skipFieldIdentifiers||!Xt.isObject(n))&&this.forEachFieldIdentifier(((e,t,n)=>{var s;n.lazy||"store"===(null===(s=this.getFieldDefinition(t))||void 0===s?void 0:s.type)||(i||e instanceof wT)&&(!i||!(e instanceof wT||e instanceof DT))||(r[t]=this[t])})),r}applyValue(e,n,r,i,s){this.$entity.getField((null==s?void 0:s.name)||n)&&(e=!0),i&&(e=!1),t.applyValue.call(this,e,e?(null==s?void 0:s.name)??n:n,r,i,s)}get isInActiveTransaction(){var e;const t=null===(e=this.graph)||void 0===e?void 0:e.activeTransaction;return Boolean(null==t?void 0:t.getLatestEntryFor(this.$$))}get data(){return this._data}set data(e){this._data=e;const{fields:t,$:n,graph:r,generation:s}=this;for(let o=0;o<t.length;o++){const{name:a,dataSource:l,complexMapping:c}=t[o],d=n[a];if(d){const t=c?Xt.getPath(e,l):e[l];!c&&!(l in e)||null==s&&t===i||d.writeToGraph(r,t)}}}get $entityName(){const e=this.constructor.name||this.$entity.name,t=this.id;return`${e}${null!=t?"-"+String(t):""}`}}}))){}class FT extends(Ty([Iy],(e=>{e.prototype;return class extends e{getGraph(){const e=this.getProject();return null==e?void 0:e.getGraph()}getEventById(e){var t;return null===(t=this.getEventStore())||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.getDependencyStore())||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.getResourceStore())||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.getAssignmentStore())||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.getCalendarManagerStore())||void 0===t?void 0:t.getById(e)}}}))){}class PT extends(Ty([ao],(e=>class extends e{}))){}class OT extends(Ty([Fy,FT,PT],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(e){var n;null===(n=this.project)||void 0===n||n.repopulateStore(this),t.setStoreData.call(this,e)}register(e){var n,r;t.register.call(this,e),!e.isRoot&&(null===(n=this.project)||void 0===n||!n.graph)&&(null===(r=this.project)||void 0===r||r.scheduleDelayedCalculation())}onModelChange(e,t,n,r,i,s){var o;s||this.syncDataOnLoad&&this.isLoadingData||!Object.keys(n).some((t=>"intervals"!==t&&e.$entity.getField(t)))||null!==(o=this.project)&&void 0!==o&&o.applyingSyncResponse||(r=!0),super.onModelChange(e,t,n,r,i,s)}}}))){}class LT extends(Ty([Py,FT,AT],(e=>{const t=e.prototype;return class extends e{joinProject(){var e;null!==(e=this.project)&&void 0!==e&&e.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(e=!1){t.leaveProject.call(this,e);const n=this.getGraph();null==n||n.removeEntity(this),this.graph=null}getProject(){return t.getProject.call(this)}calculateProject(){const e=this.stores.find((e=>Ry(e,OT)&&!!e.getProject()));return null==e?void 0:e.getProject()}get graph(){var e;return null!==(e=this.project)&&void 0!==e&&e.delayEnteringReplica?null:this._graph}set graph(e){this._graph=e}}}))){}var $T=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class _T extends(Ty([LT],(e=>{e.prototype;class t extends e{}return $T([ZR({bucket:"assigned",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:pT,persist:!1}},vT)],t.prototype,"event",void 0),$T([ZR({bucket:"assigned",resolver:function(e){return this.getResourceById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:pT,persist:!1}},vT)],t.prototype,"resource",void 0),MT(t),t}))){}var jT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class BT extends(Ty([_T],(e=>{e.prototype;class t extends e{*calculateUnits(){const e=yield this.$.event;return e?yield*e.calculateAssignmentUnits(this):yield ax}*calculateEffort(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,n=yield e.$.endDate,r=yield e.$.effectiveCalendar;if(t&&n){const i=new Map;return i.set(r,[this]),yield*e.calculateProjectedEffort(t,n,i)}}return null}*calculateActualDate(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,n=yield e.$.duration,r=yield e.$.percentDone;return yield*e.calculateProjectedXDateWithDuration(t,!0,.01*n*r)}return null}*calculateActualEffort(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,n=yield e.$.effectiveCalendar,r=yield this.$.actualDate,i=new Map;return i.set(n,[this]),yield*e.calculateProjectedEffort(t,r,i)}return null}}return jT([TT({type:"number",defaultValue:100})],t.prototype,"units",void 0),jT([QR("units")],t.prototype,"calculateUnits",null),jT([JR({lazy:!0})],t.prototype,"effort",void 0),jT([JR({lazy:!0})],t.prototype,"actualDate",void 0),jT([JR({lazy:!0})],t.prototype,"actualEffort",void 0),jT([QR("effort")],t.prototype,"calculateEffort",null),jT([QR("actualDate")],t.prototype,"calculateActualDate",null),jT([QR("actualEffort")],t.prototype,"calculateActualEffort",null),t}))){}const VT=(e,t)=>{if(e!==t)throw new Error("Store set is prohibited for Scheduler Pro entity!")};var HT=e=>class extends(e||ye){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(e){this.eventStore=e}get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get leftProjectEventStore(){const e=this.leftProject;return(null==e?void 0:e.getEventStore())||null}set eventStore(e){VT(this.eventStore,e)}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}set dependencyStore(e){VT(this.dependencyStore,e)}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}set assignmentStore(e){VT(this.assignmentStore,e)}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}set resourceStore(e){VT(this.resourceStore,e)}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}set calendarManagerStore(e){VT(this.calendarManagerStore,e)}};class NT extends(HT(Vb(BT.derive(ds)))){static $name="AssignmentModel";static isProAssignmentModel=!0;get event(){const{project:e}=this,t=super.event;return null!=e&&e.isDelayingCalculation?e.eventStore.getById(t):t}set event(e){super.event=e}get resource(){var e;const{project:t}=this;let n=super.resource;return null!=t&&t.isDelayingCalculation&&(n=t.resourceStore.getById(n)),null===(e=n)||void 0===e?void 0:e.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}}NT._$name="AssignmentModel";class zT extends(Ty([Xb,OT],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:_T}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}}}))){}class WT extends(HT(Ub(zT.derive(ho)))){static $name="AssignmentStore";static get defaultConfig(){return{modelClass:NT}}}WT._$name="AssignmentStore";var UT,GT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};e.EffectResolutionResult=void 0,(UT=e.EffectResolutionResult||(e.EffectResolutionResult={})).Cancel="Cancel",UT.Resume="Resume";class YT extends ye{getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}}class qT extends sx{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}}GT([JE("schedulingIssueEffect")],qT.prototype,"type",void 0),GT([JE(!1)],qT.prototype,"sync",void 0);var KT=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const XT=Symbol("EmptyCalendarSymbol");class ZT extends(Ty([lS,LT],(e=>{class t extends e{constructor(){super(...arguments),this.version=1}leaveProject(){this.project.clearCombinationsWith(this),super.leaveProject()}}return KT([TT({},{persistent:!1})],t.prototype,"version",void 0),KT([TT({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),KT([TT()],t.prototype,"intervals",void 0),t}))){}class JT extends(rt(ye)){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const t=e.getCalendar();return Kb(this.L("L{descriptionTpl}"),t.name||t.id)}}class QT extends qT{constructor(){super(...arguments),this.handler=XT}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[tM.new({calendar:e}),nM.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((null==e?void 0:e.length)>1)for(const t of e){if(!(t.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return t}return e[0]}}KT([JE("emptyCalendar")],QT.prototype,"type",void 0),KT([JE(JT)],QT.prototype,"_descriptionBuilderClass",void 0);class eM extends(rt(YT)){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return Kb(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var t;e.clearIntervals(!0),Object.assign(e,this.calendarData),null!==(t=e.intervals)&&void 0!==t&&t.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}}class tM extends eM{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}}class nM extends eM{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}}class rM extends(HT(LC.derive(ds))){static get $name(){return"CalendarIntervalModel"}}rM._$name="CalendarIntervalModel";class iM extends(HT(ZT.derive(ds))){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0},"ignoreTimeZone"]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:rM}}}iM._$name="CalendarModel";class sM extends(Ty([dS,OT],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:ZT}}}}))){}class oM extends(HT(sM.derive(ho))){static get defaultConfig(){return{tree:!0,modelClass:iM,loadPriority:100,syncPriority:100,storeId:"calendars"}}}oM._$name="CalendarManagerStore";var aM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class lM extends(Ty([LT],(t=>{t.prototype;class n extends t{get isValid(){const{$:e,graph:t}=this;return!!(!t||t.hasIdentifier(e.fromEvent)&&t.hasIdentifier(e.toEvent))&&super.isValid}}return aM([ZR({bucket:"outgoingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:pT}},vT)],n.prototype,"fromEvent",void 0),aM([ZR({bucket:"incomingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:pT}},vT)],n.prototype,"toEvent",void 0),aM([TT({type:"int",defaultValue:e.DependencyType.EndToStart})],n.prototype,"type",void 0),aM([TT({type:"string"})],n.prototype,"fromSide",void 0),aM([TT({type:"string"})],n.prototype,"toSide",void 0),n}))){}var cM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class dM extends(Ty([lM],(t=>{t.prototype;class n extends t{*calculateCalendar(){const t=this.getProject();let n;switch(yield t.$.dependenciesCalendar){case e.DependenciesCalendar.Project:n=yield t.$.effectiveCalendar;break;case e.DependenciesCalendar.FromEvent:const r=yield this.$.fromEvent;n=r&&!XE(r)?yield r.$.effectiveCalendar:null;break;case e.DependenciesCalendar.ToEvent:const i=yield this.$.toEvent;n=i&&!XE(i)?yield i.$.effectiveCalendar:null}return n||(n=yield t.$.effectiveCalendar),n}async setLag(e,t){if(this.graph)return this.graph.write(this.$.lag,e,t),this.graph.commitAsync();this.$.lag.DATA=e,null!=t&&(this.$.lagUnit.DATA=t)}writeLag(e,t,n,r,s=i){e.constructor.prototype.write.call(this,e,t,n,r),null!=s&&t.write(this.$.lagUnit,s)}}return cM([TT({type:"number",defaultValue:0})],n.prototype,"lag",void 0),cM([TT({type:"string",defaultValue:e.TimeUnit.Day},{converter:Gt.normalizeUnit})],n.prototype,"lagUnit",void 0),cM([JR()],n.prototype,"calendar",void 0),cM([TT({type:"boolean",defaultValue:!0,persist:!0})],n.prototype,"active",void 0),cM([QR("calendar")],n.prototype,"calculateCalendar",null),cM([eT("lag")],n.prototype,"writeLag",null),n}))){}class uM extends(HT(dM.derive(nC))){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return null!==(e=this.project)&&void 0!==e&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return null!==(e=this.project)&&void 0!==e&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}}uM._$name="DependencyModel";class hM extends(Ty([aC,OT],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=200}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}}}))){}class gM extends(HT(oC(hM.derive(ho)))){static get defaultConfig(){return{modelClass:uM}}}gM._$name="DependencyStore";var mM=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const e=super.copy(...arguments);return e.percentDone=0,e.clearChanges(),e}get renderedPercentDone(){const e="number"!=typeof this.percentDone||isNaN(this.percentDone)?0:this.percentDone;return this.getFormattedPercentDone(e)}getFormattedPercentDone(e=0){return e<=99?Math.round(e):Math.floor(e)}set renderedPercentDone(e){this.percentDone=e}};const pM=rR(),fM=rR();var vM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let yM=0;const bM=yM++;class CM extends ky{constructor(){super(...arguments),this.formulaId=yM++,this.inputs=new Set}}class SM extends Xx{collectNext(e,t){if(e instanceof CM)t.push({node:e.output,from:e,label:i});else{const n=this.cache.formulasByInput.get(e);n&&n.forEach((n=>t.push({node:n,from:e,label:i})))}}}class DM extends(Ty([ky],(t=>class extends t{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=i,this.$formulasByOutput=i}get formulasByInput(){return this.$formulasByInput!==i||this.fillCache(),this.$formulasByInput}get formulasByOutput(){return this.$formulasByOutput!==i||this.fillCache(),this.$formulasByOutput}add(e){this.$formulasByInput=i,this.$formulasByOutput=i,this.formulas.add(e)}has(e){return this.formulas.has(e)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach((e=>{let t=this.$formulasByOutput.get(e.output);t||(t=new Set,this.$formulasByOutput.set(e.output,t)),t.add(e),e.inputs.forEach((t=>{let n=this.$formulasByInput.get(t);n||(n=new Set,this.$formulasByInput.set(t,n)),n.add(e)}))}))}allInputVariables(){return cy(uy(ly(this.formulas,(e=>e.inputs.values()))))}isCyclic(){let t=!1;return SM.new({cache:this,onCycle:()=>(t=!0,e.OnCycleAction.Cancel)}).startFrom(Array.from(this.allInputVariables())),t}}))){}class wM extends DM{}class EM extends ky{constructor(){super(...arguments),this.description=i,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const t=this.resolutionsByInputHash.get(e.hash);if(t!==i)return t;const n=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,n),n}buildResolution(e){const t=MM.new({context:this,input:e}),n=Array.from(t.next()).map((e=>({resolution:e.asResolution(),nbrOfDefaultFormulas:Array.from(e.activatedFormulas.formulas).reduce(((t,n)=>e.formulaIsDefault(n)?t+1:t),0),unCoveredInputWeight:e.unCoveredInputWeight()})));if(n.sort(((e,t)=>e.unCoveredInputWeight<t.unCoveredInputWeight?-1:e.unCoveredInputWeight>t.unCoveredInputWeight?1:t.nbrOfDefaultFormulas-e.nbrOfDefaultFormulas)),n.length>0)return n[0].resolution}}var xM,RM;e.VariableInputState=void 0,(xM=e.VariableInputState||(e.VariableInputState={}))[xM.NoInput=0]="NoInput",xM[xM.HasPreviousValue=1]="HasPreviousValue",xM[xM.HasProposedValue=2]="HasProposedValue",xM[xM.KeepIfPossible=4]="KeepIfPossible";class TM extends ky{constructor(){super(...arguments),this.context=i,this.input=i,this.$hash=""}get hash(){return""!==this.$hash?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...t){super.initialize(...t),this.input=new Map(gy(this.description.variables).map((t=>[t,e.VariableInputState.NoInput])))}buildHash(){return String.fromCharCode(...gy(this.description.variables).inBatchesBySize(5).map((e=>this.batchToCharCode(e))))}batchToCharCode(e){return e.reduceRight(((e,t,n)=>e|this.input.get(t)<<3*n),0)}addProposedValueFlag(t){const n=this.input.get(t);this.input.set(t,n|e.VariableInputState.HasProposedValue)}hasProposedValue(t){return Boolean(this.input.get(t)&e.VariableInputState.HasProposedValue)}hasProposedValueVars(){return gy(this.description.variables).filter((e=>this.hasProposedValue(e)))}addPreviousValueFlag(t){const n=this.input.get(t);this.input.set(t,n|e.VariableInputState.HasPreviousValue)}hasPreviousValue(t){return Boolean(this.input.get(t)&e.VariableInputState.HasPreviousValue)}hasPreviousValueVars(){return gy(this.description.variables).filter((e=>this.hasPreviousValue(e)))}addKeepIfPossibleFlag(t){const n=this.input.get(t);this.input.set(t,n|e.VariableInputState.KeepIfPossible)}keepIfPossible(t){return Boolean(this.input.get(t)&e.VariableInputState.KeepIfPossible)}keepIfPossibleVars(){return gy(this.description.variables).filter((e=>this.keepIfPossible(e)))}}vM([pM],TM.prototype,"context",void 0);class MM extends ky{constructor(){super(...arguments),this.context=i,this.input=i,this.previous=i,this.activatedFormula=i,this.$activatedFormulas=i}get activatedFormulas(){if(this.$activatedFormulas!==i)return this.$activatedFormulas;const e=DM.new({variables:this.description.variables,formulas:gy(this.thisAndPreviousStates()).map((e=>e.activatedFormula)).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some((e=>this.input.hasProposedValue(e)))}unCoveredInputWeight(){const e=ly(this.input.hasProposedValueVars(),(e=>({variable:e,isProposed:!0}))),t=ly(this.input.keepIfPossibleVars(),(e=>({variable:e,isProposed:!1})));return gy([e,t]).concat().uniqueOnlyBy((e=>e.variable)).reduce(((e,{variable:t,isProposed:n})=>{let r=0;const i=this.activatedFormulas.formulasByOutput.get(t);if(i){const e=1===i.size?Array.from(i)[0]:null;e&&this.formulaIsDefault(e)&&this.formulaHasProposedValueInInput(e)?r+=n?1e6:1e4:r+=n?1e7:1e5}const s=this.activatedFormulas.formulasByInput.get(t);return s&&s.size>0||(r+=n?1e3:100),e+r}),0)}preferFormula(e,t){const n=this.formulaAllInputsHasProposed(e),r=this.formulaAllInputsHasProposed(t);if(n&&!r)return-1;if(r&&!n)return 1;const i=this.formulaCountInputsWithProposedOrKeep(e),s=this.formulaCountInputsWithProposedOrKeep(t);return i>s?-1:i<s?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(t)?-1:this.formulaIsDefault(t)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let t=0;return Array.from(e.inputs).forEach((e=>{(this.input.hasProposedValue(e)||this.input.keepIfPossible(e))&&t++})),t}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.keepIfPossible(e)))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)))}formulaIsApplicable(e){const t=Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.hasPreviousValue(e)||this.activatedFormulas.formulasByOutput.has(e))),n=DM.new({formulas:new Set(this.activatedFormulas.formulas)});return n.add(e),t&&!n.isCyclic()}formulaIsInsignificant(e){const t=this.activatedFormulas.formulasByOutput.has(e.output),n=this.input.hasPreviousValue(e.output);return t||n&&Array.from(e.inputs).some((e=>!this.input.hasPreviousValue(e)&&!this.input.hasProposedValue(e)&&!this.activatedFormulas.formulasByOutput.has(e)))}unvisitedFormulas(){return Array.from(this.description.formulas).filter((e=>!this.activatedFormulas.has(e)))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let t=!0;for(const n of e){if(!this.formulaIsApplicable(n)||this.formulaIsInsignificant(n))continue;const e=MM.new({previous:this,context:this.context,input:this.input,activatedFormula:n});yield*e.next(),t=!1}t&&(yield this)}asResolution(){return new Map(gy(this.description.variables).map((e=>{const t=this.activatedFormulas.formulasByOutput.get(e);if(t)for(const n of t)return[e,n.formulaId];return[e,bM]})))}}class kM extends TM{collectInfo(e,t,n){null!=e(xx(t))&&this.addPreviousValueFlag(n),e(Ox(t))&&this.addProposedValueFlag(n)}}e.Instruction=void 0,(RM=e.Instruction||(e.Instruction={})).KeepDuration="KeepDuration",RM.KeepStartDate="KeepStartDate",RM.KeepEndDate="KeepEndDate";const IM=Symbol("StartDate"),AM=Symbol("EndDate"),FM=Symbol("Duration"),PM=CM.new({output:IM,inputs:new Set([FM,AM])}),OM=CM.new({output:AM,inputs:new Set([FM,IM])}),LM=CM.new({output:FM,inputs:new Set([IM,AM])}),$M=wM.new({variables:new Set([IM,AM,FM]),formulas:new Set([PM,OM,LM])}),_M=EM.new({description:$M,defaultResolutionFormulas:new Set([OM])}),jM=EM.new({description:$M,defaultResolutionFormulas:new Set([PM])});class BM extends kM{addInstruction(t){t===e.Instruction.KeepStartDate&&this.addKeepIfPossibleFlag(IM),t===e.Instruction.KeepEndDate&&this.addKeepIfPossibleFlag(AM),t===e.Instruction.KeepDuration&&this.addKeepIfPossibleFlag(FM)}}class VM extends(VR.mix(DR)){equality(e,t){const n=e.resolution,r=t.resolution;return n.get(IM)===r.get(IM)&&n.get(AM)===r.get(AM)&&n.get(FM)===r.get(FM)||n.get(IM)===bM&&n.get(AM)===bM&&n.get(FM)===bM}}class HM{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new HM({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,n]of this.getGroups())e.set(t,n[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach((([n,r])=>{let i=t.get(n);i||(e.push(n),i=[],t.set(n,i)),i.push.apply(i,r.intervals)})),t.forEach(((e,n)=>{const r=eS(e);r.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t.set(n,r)})),this.intervalsByCalendar=t}}class NM extends QC{constructor(e){super(e),this.calendarCaches=eS(this.calendarCaches),this.intervalCache=new sS({emptyInterval:new HM,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach((n=>{n.fillCache(e,t),this.includeWrappingRangeFrom(n,e,t)}))}}const zM=new Map;var WM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class UM extends(Ty([LT],(e=>{class t extends e{writeCalendar(e,t,n,r){const i=this.getCalendarManagerStore(),s=r;r&&i&&r instanceof ZT&&!i.includes(s)&&i.add(r),e.constructor.prototype.write.call(this,e,t,n,r)}resolveCalendar(e){var t;return null===(t=this.getCalendarManagerStore())||void 0===t?void 0:t.getById(e)}*calculateEffectiveDataOrVisualCalendar(e){let t=yield this.$.calendar;if(!t){const e=this.getProject();t=yield e.$.effectiveCalendar}return yield t.$.version,t}*calculateEffectiveCalendar(){return yield*this.calculateEffectiveDataOrVisualCalendar("data")}*calculateEffectiveVisualCalendar(){return yield*this.calculateEffectiveDataOrVisualCalendar("visual")}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;const{project:r}=this;if("calendar"===e&&r){const{calendarManagerStore:e}=r;return e.oldIdMap[t]!==e.getById(n)}return!0}}return WM([JR({equality:()=>!1})],t.prototype,"effectiveCalendar",void 0),WM([JR({equality:()=>!1})],t.prototype,"effectiveVisualCalendar",void 0),WM([ZR({modelFieldConfig:{persist:!0,serialize:e=>e===i?i:(null==e?void 0:e.id)||null,isEqual:pT},resolver:function(e){return this.resolveCalendar(e)},sync:!0},vT)],t.prototype,"calendar",void 0),WM([eT("calendar")],t.prototype,"writeCalendar",null),WM([QR("effectiveCalendar")],t.prototype,"calculateEffectiveCalendar",null),WM([QR("effectiveVisualCalendar")],t.prototype,"calculateEffectiveVisualCalendar",null),MT(t),t}))){}class GM extends(Ty([],(e=>class extends e{constructor(){super(...arguments),this.combinedCalendarsCache=new Map,this.combinationsByCalendar=new Map}combineCalendars(e){const t=eS(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const n=t.map((e=>e.internalId+"/")).join(""),r=t.map((e=>e.version+"/")).join(""),i=this.combinedCalendarsCache.get(n);let s;return i&&i.versionsHash===r?s=i.cache:(s=new NM({calendarCaches:t.map((e=>e.calendarCache))}),this.combinedCalendarsCache.set(n,{versionsHash:r,cache:s}),t.forEach((e=>{let t=this.combinationsByCalendar.get(e);t||(t=new Set,this.combinationsByCalendar.set(e,t)),t.add(n)}))),s}clearCombinationsWith(e){const t=this.combinationsByCalendar.get(e);if(t){for(const e of t){for(const t of this.combinedCalendarsCache.get(e).cache.calendarCaches){this.combinationsByCalendar.get(t.calendar).delete(e)}this.combinedCalendarsCache.delete(e)}this.combinationsByCalendar.delete(e)}}}))){}var YM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class qM extends(Ty([UM],(t=>{t.prototype;class n extends t{*calculateDispatcher(t){yield ax;const n=yield*this.prepareDispatcher(t),r=yield Vx(this.$.startDate),s=r?r[0]?e.Instruction.KeepDuration:e.Instruction.KeepEndDate:i;s&&n.addInstruction(s);const o=yield Vx(this.$.endDate),a=o?o[0]?e.Instruction.KeepDuration:e.Instruction.KeepStartDate:i;a&&n.addInstruction(a);const l=yield this.$.effectiveDirection,c=yield Vx(this.$.duration);let d;if(c)switch(c[0]){case!0:d=e.Instruction.KeepStartDate;break;case!1:d=e.Instruction.KeepEndDate}return!d&&n.hasProposedValue(FM)&&(d=l.direction===e.Direction.Forward||l.direction===e.Direction.None?e.Instruction.KeepStartDate:e.Instruction.KeepEndDate),d&&n.addInstruction(d),n}*prepareDispatcher(e){const t=this.dispatcherClass(e).new({context:this.cycleResolutionContext(e)});return t.collectInfo(e,this.$.startDate,IM),t.collectInfo(e,this.$.endDate,AM),t.collectInfo(e,this.$.duration,FM),t}cycleResolutionContext(t){const n=t(this.$.effectiveDirection);return n.direction===e.Direction.Forward||n.direction===e.Direction.None?_M:jM}dispatcherClass(e){return BM}buildProposedDispatcher(e,t,n){const r=this.dispatcherClass(n.onEffectSync).new({context:this.cycleResolutionContext(n.onEffectSync)});return r.addPreviousValueFlag(IM),r.addPreviousValueFlag(AM),r.addPreviousValueFlag(FM),r}*skipNonWorkingTime(t,n){const r=yield this.$.effectiveCalendar;if(!t)return null;const i=r.skipNonWorkingTime(t,n);if(i instanceof Date)return i;{const i=QT.new({calendars:[r],event:this,date:t,isForward:n});if((yield i)!==e.EffectResolutionResult.Cancel)return null;yield dx(i)}}*skipWorkingTime(e,t,n,r){const i=yield this.$.durationUnit;return r&&r!==i&&(n=yield*this.getProject().$convertDuration(n,r,i)),yield*this.calculateProjectedXDateWithDuration(e,t,n)}setStartDate(e,t=!0){const{graph:n,project:r}=this;return n?(n.write(this.$.startDate,e,t),n.commitAsync()):(this.$.startDate.DATA=e,null==r?void 0:r.delayedCalculationPromise)}writeStartDate(e,t,n,r,s=!0){(t.baseRevision.hasIdentifier(e)||null!=r)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,i,null==r),e.constructor.prototype.write.call(this,e,t,n,r,s))}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(IM);if(e===bM)return yield*this.calculateStartDateProposed();if(e===PM.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const e=this.getProject(),t=yield ax;return!(yield this.$.manuallyScheduled)||e.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(t,!0):t}*calculateProjectedXDateWithDuration(t,n,r){const s=yield this.$.durationUnit,o=yield this.$.effectiveCalendar,a=this.getProject();return!t||Gb(r)?null:(n=n===i||n)?o.calculateEndDate(t,yield*a.$convertDuration(r,s,e.TimeUnit.Millisecond)):o.calculateStartDate(t,yield*a.$convertDuration(r,s,e.TimeUnit.Millisecond))}setEndDate(e,t=!1){const{graph:n,project:r}=this;return n?(n.write(this.$.endDate,e,t),n.commitAsync()):(this.$.endDate.DATA=e,null==r?void 0:r.delayedCalculationPromise)}writeEndDate(e,t,n,r,s=!1){(t.baseRevision.hasIdentifier(e)||null!=r)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,i,null==r),e.constructor.prototype.write.call(this,e,t,n,r,s))}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(AM);if(e===bM)return yield*this.calculateEndDateProposed();if(e===OM.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const e=this.getProject(),t=yield ax;return!(yield this.$.manuallyScheduled)||e.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(t,!1):t}getDuration(e){const t=this.duration;return e!==i?this.getProject().convertDuration(t,this.durationUnit,e):t}setDuration(e,t,n){const{graph:r,project:s}=this;if(!r){const n={duration:e};return this.$.duration.DATA=e,null!=t&&(n.durationUnit=this.$.durationUnit.DATA=t),this.set(n),null==s?void 0:s.delayedCalculationPromise}if(e!==i)return r.write(this.$.duration,e,t,n),r.commitAsync()}setDurationUnit(e){throw new Error("Use `setDuration` instead")}writeDuration(e,t,n,r,s,o=i){r<0&&(r=0),(t.baseRevision.hasIdentifier(e)||null!=r)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,i,null==r),e.constructor.prototype.write.call(this,e,t,n,r,o),null!=s&&t.write(this.$.durationUnit,s))}*calculateDuration(){const e=(yield this.$.dispatcher).resolution.get(FM);if(e===bM)return yield*this.calculateDurationProposed();if(e===LM.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const e=yield this.$.startDate,t=yield this.$.endDate;return e&&t?e>t?void(yield bx(this.$.duration,0,null)):yield*this.calculateProjectedDuration(e,t):null}*calculateDurationProposed(){return yield ax}*calculateProjectedDuration(t,n,r){if(!t||!n)return null;r||(r=yield this.$.durationUnit);const i=yield this.$.effectiveCalendar,s=this.getProject();return yield*s.$convertDuration(i.calculateDurationMs(t,n),e.TimeUnit.Millisecond,r)}*calculateEffectiveDuration(){let e;const t=(yield this.$.dispatcher).resolution.get(FM);return t===bM?e=yield this.$.duration:t===LM.formulaId&&(e=yield*this.calculateProjectedDuration(yield _x(this.$.startDate),yield _x(this.$.endDate))),e}*calculateEffectiveDirection(){return{kind:"own",direction:(yield this.$.direction)||e.Direction.Forward}}*calculateStartDateDirection(){return yield this.$.effectiveDirection}*calculateEndDateDirection(){return yield this.$.effectiveDirection}*calculateEffectiveDataOrVisualCalendar(e){if("visual"===e)return yield*super.calculateEffectiveDataOrVisualCalendar("visual");{const e=yield this.$.manuallyScheduled,t=this.getProject();return e&&!t.skipNonWorkingTimeInDurationWhenSchedulingManually?t.defaultCalendar:yield*super.calculateEffectiveDataOrVisualCalendar("data")}}}return YM([TT({type:"date"},{converter:IT})],n.prototype,"startDate",void 0),YM([TT({type:"date"},{converter:IT})],n.prototype,"endDate",void 0),YM([TT({type:"number",allowNull:!0})],n.prototype,"duration",void 0),YM([TT({type:"string",defaultValue:e.TimeUnit.Day},{converter:t=>Gt.normalizeUnit(t)||e.TimeUnit.Day})],n.prototype,"durationUnit",void 0),YM([TT({type:"string"},{sync:!0})],n.prototype,"direction",void 0),YM([JR({sync:!0,equality:GC})],n.prototype,"startDateDirection",void 0),YM([JR({sync:!0,equality:GC})],n.prototype,"endDateDirection",void 0),YM([TT({persist:!1,isEqual:GC},{sync:!0,equality:GC})],n.prototype,"effectiveDirection",void 0),YM([JR({identifierCls:VM})],n.prototype,"dispatcher",void 0),YM([TT({type:"boolean",defaultValue:!1},{sync:!0})],n.prototype,"manuallyScheduled",void 0),YM([TT({type:"boolean",defaultValue:!1})],n.prototype,"unscheduled",void 0),YM([QR("dispatcher")],n.prototype,"calculateDispatcher",null),YM([tT("dispatcher")],n.prototype,"buildProposedDispatcher",null),YM([eT("startDate")],n.prototype,"writeStartDate",null),YM([QR("startDate")],n.prototype,"calculateStartDate",null),YM([eT("endDate")],n.prototype,"writeEndDate",null),YM([QR("endDate")],n.prototype,"calculateEndDate",null),YM([eT("duration")],n.prototype,"writeDuration",null),YM([QR("duration")],n.prototype,"calculateDuration",null),YM([QR("effectiveDirection")],n.prototype,"calculateEffectiveDirection",null),YM([QR("startDateDirection")],n.prototype,"calculateStartDateDirection",null),YM([QR("endDateDirection")],n.prototype,"calculateEndDateDirection",null),n}))){}var KM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class XM extends(Ty([qM,kb],(e=>{e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return KM([ZR({},yT)],t.prototype,"assigned",void 0),t}))){}var ZM=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class JM extends(Ty([qM],(e=>{const t=e.prototype;class n extends e{leaveProject(){if(this.isInActiveTransaction){const e=this.graph.activeTransaction,t=this.getDependencyStore(),n=[];for(const r of e.readCurrentOrProposedOrPrevious(this.$.outgoingDeps)??[])t.includes(r)&&n.push(r);for(const r of e.readCurrentOrProposedOrPrevious(this.$.incomingDeps)??[])t.includes(r)&&n.push(r);this.project.dependencyStore.remove(n)}t.leaveProject.call(this)}}return ZM([ZR({},yT)],n.prototype,"outgoingDeps",void 0),ZM([ZR({},yT)],n.prototype,"incomingDeps",void 0),n}))){}class QM extends(Ty([qM,XM,JM],(e=>{e.prototype;return class extends e{}}))){}qe.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24-hour calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8-hour calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},IgnoreProjectConstraintResolution:{descriptionTpl:"Ignore the project border and proceed with the change."},ProjectConstraintConflictEffectDescription:{startDescriptionTpl:'You moved "{0}" task to start on {1}. This is before the project start date {2}.',endDescriptionTpl:'You moved "{0}" task to finish on {1}. This is after the project end date {2}.'},HonorProjectConstraintResolution:{descriptionTpl:"Adjust the task to honor the project border."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}});class ek extends ky{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=qC),this.endDate||(this.endDate=KC)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===qC.getTime()&&this.endDate.getTime()===KC.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==qC.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==KC.getTime()}containsDate(t,n=e.EdgeInclusion.Left){return n===e.EdgeInclusion.Left&&t>=this.startDate&&t<this.endDate||n===e.EdgeInclusion.Right&&t>this.startDate&&t<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,n=e.endDate,r=this.startDate,i=this.endDate;if(i<t||r>n)return tk;const s=new Date(Math.max(r.getTime(),t.getTime())),o=new Date(Math.min(i.getTime(),n.getTime()));return this.constructor.new({startDate:s,endDate:o})}intersectMut(e,t=!1){const n=e.startDate,r=e.endDate,i=this.startDate,s=this.endDate;var o;t&&(this.intersectionOf||(this.intersectionOf=new Set),(null===(o=e.intersectionOf)||void 0===o?void 0:o.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e));if(!this.isIntervalEmpty()){if(s<n||i>r)return this.startDate=KC,this.endDate=qC,t&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(i.getTime(),n.getTime())),this.endDate=new Date(Math.min(s.getTime(),r.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const t=this.getCopyProperties(e);return this.constructor.new(t)}}const tk=ek.new({startDate:KC,endDate:qC}),nk=(e,t=!1)=>e.reduce(((e,n)=>e.intersectMut(n,t)),ek.new());var rk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const ik=Symbol("ConflictSymbol");class sk extends(rt(ye)){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return Kb(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}}class ok extends qT{constructor(){super(...arguments),this.handler=ik}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map((e=>e.getResolutions())))),this._resolutions}filterConflictingIntervals(e){const t=[],n=[...e].filter((e=>!e.isInfinite())),r=n.find((e=>e.isAffectedByTransaction()));if(r){const e=n.sort(((e,t)=>e===r?-1:0)),i=nk(e,!0).intersectedAsEmpty;t.push(i,r)}else t.push(nk(n,!0).intersectedAsEmpty,nk(n.reverse(),!0).intersectedAsEmpty);return t}}rk([JE("schedulingConflict")],ok.prototype,"type",void 0),rk([JE(sk)],ok.prototype,"_descriptionBuilderClass",void 0);class ak extends YT{resolve(){throw new Error("Abstract method")}}class lk extends(rt(ye)){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return Kb(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[Gt.format(e.startDate,this.L("L{dateFormat}")),Gt.format(e.endDate,this.L("L{dateFormat}"))]}}class ck extends ek{constructor(){super(...arguments),this.owner=i,this.reflectionOf=i,this.side=i,this.resolutions=i}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:t,reflectionOf:n,side:r}=this;return Object.assign({owner:t,reflectionOf:n,side:r},e)}}rk([JE(lk)],ck.prototype,"descriptionBuilderClass",void 0);class dk extends(Ty([qM],(e=>{const t=e.prototype;return class extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const e=yield this.$.manuallyScheduled,n=yield*this.hasSubEvents();return!e&&n?yield*this.calculateMinChildrenStartDate():yield*t.calculateStartDatePure.call(this)}*calculateEndDatePure(){const e=yield this.$.manuallyScheduled,n=yield*this.hasSubEvents();return!e&&n?yield*this.calculateMaxChildrenEndDate():yield*t.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const e=yield this.$.manuallyScheduled,n=yield*this.hasSubEvents();return!e&&n?yield*this.calculateStartDatePure():yield*t.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const e=yield this.$.manuallyScheduled,n=yield*this.hasSubEvents();return!e&&n?yield*this.calculateEndDatePure():yield*t.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const e=yield this.$.manuallyScheduled,n=yield*this.hasSubEvents();return!e&&n?yield*this.calculateDurationPure():yield*t.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(e){return!0}*calculateMinChildrenStartDate(){const e=yield*this.subEventsIterable();let t=KC.getTime();for(const n of e)if(yield*this.shouldRollupChildStartDate(n)){let e=yield n.$.startDate;if(e||(e=yield n.$.endDate),(yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())){const t=yield*n.calculateMinChildrenStartDate();(!e||t&&t.getTime()<e.getTime())&&(e=t)}e&&e.getTime()<t&&(t=e.getTime())}return t===qC.getTime()||t===KC.getTime()?null:new Date(t)}*shouldRollupChildEndDate(e){return!0}*calculateMaxChildrenEndDate(){const e=yield*this.subEventsIterable();let t=qC.getTime();for(const n of e)if(yield*this.shouldRollupChildEndDate(n)){let e=yield n.$.endDate;if(e||(e=yield n.$.startDate),(yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())){const t=yield*n.calculateMaxChildrenEndDate();(!e||t&&t.getTime()>e.getTime())&&(e=t)}e&&e.getTime()>t&&(t=e.getTime())}return t===qC.getTime()||t===KC.getTime()?null:new Date(t)}}}))){}var uk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const hk=function*(t,n,r,i,s){if(r.isIntervalEmpty())return r;if(s&&r.intersectionOf){const n=new Set;for(const s of r.intersectionOf)if(s.isInfinite())n.add(s);else{const r=s.startDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(s.startDate,!1,i):s.startDate,o=s.endDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(s.endDate,!1,i):s.endDate,a=s;n.add(a.copyWith({reflectionOf:a,side:a.side===e.ConstraintIntervalSide.Start?e.ConstraintIntervalSide.End:e.ConstraintIntervalSide.Start,startDate:r,endDate:o}))}r.intersectionOf=n}const o=r.startDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(r.startDate,!1,i):null,a=r.endDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(r.endDate,!1,i):null;return nk([n,ck.new({intersectionOf:r.intersectionOf,startDate:o,endDate:a})],s)},gk=function*(t,n,r,s,o){if(n.isIntervalEmpty())return n;if(o){const r=new Set;for(const i of n.intersectionOf)if(i.isInfinite())r.add(i);else{const n=i.startDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(i.startDate,!0,s):i.startDate,o=i.endDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(i.endDate,!0,s):i.endDate,a=i;r.add(a.copyWith({reflectionOf:a,side:a.side===e.ConstraintIntervalSide.Start?e.ConstraintIntervalSide.End:e.ConstraintIntervalSide.Start,startDate:n,endDate:o}))}n.intersectionOf=r}const a=n.startDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(n.startDate,!0,s):null,l=n.endDateIsFinite()?yield*t.calculateProjectedXDateWithDuration(n.endDate,!0,s):null;return nk([r,ck.new({reflectionOf:a||l?n:i,intersectionOf:a||l?n.intersectionOf:i,startDate:a,endDate:l})],o)},mk=!0;class pk extends(Ty([dk],(t=>{const n=t.prototype;class r extends t{*maybeSkipNonWorkingTime(e,t=!0){if(yield*this.hasSubEvents())return e;let n=yield*this.calculateEffectiveDuration();return e&&n>0?yield*this.skipNonWorkingTime(e,t):e}*calculateEffectiveConstraintInterval(e,t,n,r=!1){const i=yield*this.calculateEffectiveDuration();if(null==i)return null;const s=e?hk:gk;return yield*s(this,nk(t,r),nk(n,r),i,r)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(e=!1){const t=yield this.$.earlyStartDateConstraintIntervals,n=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,t.concat(yield this.$.startDateConstraintIntervals),n.concat(yield this.$.endDateConstraintIntervals),e)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(e=!1){const t=yield this.$.earlyStartDateConstraintIntervals,n=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,t.concat(yield this.$.startDateConstraintIntervals),n.concat(yield this.$.endDateConstraintIntervals),e)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(e){return!0}*calculateMinChildrenEarlyStartDate(){let e=KC;const t=yield*this.subEventsIterable();for(let n of t){let t;(yield*this.shouldRollupChildEarlyStartDate(n))&&((yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())&&(t=yield n.$.minChildrenEarlyStartDate),t=t||(yield n.$.earlyStartDate),t&&t<e&&(e=t))}return e.getTime()-KC.getTime()?e:null}*shouldRollupChildEarlyEndDate(e){return!0}*calculateMaxChildrenEarlyEndDate(){let e=qC;const t=yield*this.subEventsIterable();for(let n of t){let t;(yield*this.shouldRollupChildEarlyEndDate(n))&&((yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())&&(t=yield n.$.maxChildrenEarlyEndDate),t=t||(yield n.$.earlyEndDate),t&&t>e&&(e=t))}return e.getTime()-qC.getTime()?e:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let t=yield this.$.earlyEffectiveStartDateInterval;if(null===t)return null;if(t.isIntervalEmpty()){t=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const n=ok.new({intervals:[...t.intersectionOf]});if((yield n)!==e.EffectResolutionResult.Cancel)return null;yield dx(n)}return XC(t.startDate)?t.startDate:null}*calculateEarlyStartDate(){const e=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let t=yield this.$.earlyEffectiveEndDateInterval;if(null===t)return null;if(t.isIntervalEmpty()){t=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const n=ok.new({intervals:[...t.intersectionOf]});if((yield n)!==e.EffectResolutionResult.Cancel)return null;yield dx(n)}return XC(t.startDate)?t.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,n=yield this.$.earlyStartDateConstraintIntervals,r=yield this.$.earlyEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==n?void 0:n.length)||(null==r?void 0:r.length))}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===e.Direction.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.earlyStartDate)||(yield*n.calculateStartDatePure.call(this)):yield*n.calculateStartDatePure.call(this)}*calculateStartDateProposed(){if((yield this.$.effectiveDirection).direction===e.Direction.Forward){if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*n.calculateStartDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMinChildrenStartDate();const e=yield this.$.earlyStartDate;if(e){if(XC(e))return e;const t=yield*n.calculateStartDateProposed.call(this),r=yield this.$.earlyEffectiveStartDateInterval;return r.containsDate(t)?t:XC(r.endDate)?r.endDate:t}return yield*n.calculateStartDateProposed.call(this)}return yield*n.calculateStartDateProposed.call(this)}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===e.Direction.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.earlyEndDate)||(yield*n.calculateEndDatePure.call(this)):yield*n.calculateEndDatePure.call(this)}*calculateEndDateProposed(){if((yield this.$.effectiveDirection).direction===e.Direction.Forward){if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*n.calculateEndDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMaxChildrenEndDate();const e=yield this.$.earlyEndDate;if(e){if(XC(e))return e;const t=yield*n.calculateEndDateProposed.call(this),r=yield this.$.earlyEffectiveEndDateInterval;return r.containsDate(t)?t:XC(r.endDate)?r.endDate:t}return yield*n.calculateEndDateProposed.call(this)}return yield*n.calculateEndDateProposed.call(this)}}return uk([JR({lazy:mk})],r.prototype,"minChildrenEarlyStartDate",void 0),uk([JR({lazy:mk})],r.prototype,"earlyStartDateRaw",void 0),uk([TT({type:"date",persist:!1},{lazy:mk,converter:IT,persistent:!1})],r.prototype,"earlyStartDate",void 0),uk([JR({lazy:mk})],r.prototype,"maxChildrenEarlyEndDate",void 0),uk([JR({lazy:mk})],r.prototype,"earlyEndDateRaw",void 0),uk([TT({type:"date",persist:!1},{lazy:mk,converter:IT,persistent:!1})],r.prototype,"earlyEndDate",void 0),uk([JR()],r.prototype,"startDateConstraintIntervals",void 0),uk([JR()],r.prototype,"endDateConstraintIntervals",void 0),uk([JR({lazy:mk})],r.prototype,"earlyStartDateConstraintIntervals",void 0),uk([JR({lazy:mk})],r.prototype,"earlyEndDateConstraintIntervals",void 0),uk([JR()],r.prototype,"earlyEffectiveStartDateInterval",void 0),uk([JR()],r.prototype,"earlyEffectiveEndDateInterval",void 0),uk([QR("startDateConstraintIntervals")],r.prototype,"calculateStartDateConstraintIntervals",null),uk([QR("endDateConstraintIntervals")],r.prototype,"calculateEndDateConstraintIntervals",null),uk([QR("earlyStartDateConstraintIntervals")],r.prototype,"calculateEarlyStartDateConstraintIntervals",null),uk([QR("earlyEndDateConstraintIntervals")],r.prototype,"calculateEarlyEndDateConstraintIntervals",null),uk([QR("earlyEffectiveStartDateInterval")],r.prototype,"calculateEarlyEffectiveStartDateInterval",null),uk([QR("earlyEffectiveEndDateInterval")],r.prototype,"calculateEarlyEffectiveEndDateInterval",null),uk([QR("minChildrenEarlyStartDate")],r.prototype,"calculateMinChildrenEarlyStartDate",null),uk([QR("maxChildrenEarlyEndDate")],r.prototype,"calculateMaxChildrenEarlyEndDate",null),uk([QR("earlyStartDateRaw")],r.prototype,"calculateEarlyStartDateRaw",null),uk([QR("earlyStartDate")],r.prototype,"calculateEarlyStartDate",null),uk([QR("earlyEndDateRaw")],r.prototype,"calculateEarlyEndDateRaw",null),uk([QR("earlyEndDate")],r.prototype,"calculateEarlyEndDate",null),r}))){}var fk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class vk extends(Ty([dk],(e=>{e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(e){this._parent=e,this.parentEvent=e}*calculateEffectiveDirection(){const e=yield this.$.direction;if(e)return{kind:"own",direction:e};const t=yield this.$.parentEvent;if(t){const e=yield t.$.effectiveDirection;return{kind:"inherited",direction:e.direction,inheritedFrom:"own"===e.kind?t:"inherited"===e.kind?e.inheritedFrom:t}}return yield*super.calculateEffectiveDirection()}*calculateStartDateDirection(){const e=yield this.getProject().$.effectiveDirection;let t=null;if(!(yield this.$.manuallyScheduled)){const n=yield*this.subEventsIterable();for(const r of n){const n=yield r.$.startDateDirection;if(e.direction!==n.direction){t={kind:"enforced",direction:n.direction,enforcedBy:"own"===n.kind?r:"enforced"===n.kind?n.enforcedBy:n.inheritedFrom};break}}}return t??(yield*super.calculateStartDateDirection())}*calculateEndDateDirection(){const e=yield this.getProject().$.effectiveDirection;let t=null;if(!(yield this.$.manuallyScheduled)){const n=yield*this.subEventsIterable();for(const r of n){const n=yield r.$.endDateDirection;if(e.direction!==n.direction){t={kind:"enforced",direction:n.direction,enforcedBy:"own"===n.kind?r:"enforced"===n.kind?n.enforcedBy:n.inheritedFrom};break}}}return t??(yield*super.calculateStartDateDirection())}}return fk([ZR({bucket:"childEvents",resolver:function(e){return this.getEventById(e)},ignore:!0,modelFieldConfig:{persist:!1}},vT)],t.prototype,"parentEvent",void 0),fk([lT()],t.prototype,"childEvents",void 0),t}))){}var yk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class bk extends(Ty([pk,vk],(t=>{const n=t.prototype;class r extends t{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(e,t,r,i,s=!0){const o=this.getProject();if(null!=o&&o.addConstraintOnDateSet&&t.graph.hasIdentifier(this.$.effectiveDirection)&&(null==o||!o.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&(null==o||!o.getStm().isRestoring)){const e=this.getStartDatePinConstraintType();e&&(this.constraintDate=i,this.constraintType=e)}return n.writeStartDate.call(this,e,t,r,i,s)}writeEndDate(e,t,r,i,s=!1){const o=this.getProject();if(null!=o&&o.addConstraintOnDateSet&&t.graph.hasIdentifier(this.$.direction)&&s&&(null==o||!o.eventStore.isSyncingDataOnLoad)&&(null==o||!o.getStm().isRestoring)){const e=this.getEndDatePinConstraintType();e&&(this.constraintDate=i,this.constraintType=e)}return n.writeEndDate.call(this,e,t,r,i,s)}writeConstraintType(t,n,r,s,o=!1){const a=this.getProject();o||t.isWritingUndefined||!a.includeAsapAlapAsConstraints||(s!==e.ConstraintType.AsSoonAsPossible&&s!==e.ConstraintType.AsLateAsPossible?n.baseRevision.hasIdentifier(t)&&this.$.direction.write.call(this,this.$.direction,n,i,null,!0):(this.$.direction.write.call(this,this.$.direction,n,i,s===e.ConstraintType.AsSoonAsPossible?e.Direction.Forward:e.Direction.Backward,!0),this.$.constraintDate.write.call(this,this.$.constraintDate,n,i,null))),t.constructor.prototype.write.call(this,t,n,r,s)}writeDirection(t,n,r,s,o=!1){const a=this.getProject();o||t.isWritingUndefined||!a.includeAsapAlapAsConstraints||!s&&!n.baseRevision.hasIdentifier(t)||this.$.constraintType.write.call(this,this.$.constraintType,n,i,s===e.Direction.Forward?e.ConstraintType.AsSoonAsPossible:s===e.Direction.Backward?e.ConstraintType.AsLateAsPossible:null,!0),t.constructor.prototype.write.call(this,t,n,r,s)}*calculateConstraintType(){let e=yield ax;return(yield*this.isConstraintTypeApplicable(e))||(e=null),e}*calculateConstraintDate(e){let t=yield ax;const n=yield this.$.constraintType;return n?t||(t=this.getConstraintTypeDefaultDate(e,n)):t=null,t}getStartDatePinConstraintType(){const{effectiveDirection:t}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(t.direction){case e.Direction.Forward:return e.ConstraintType.StartNoEarlierThan;case e.Direction.Backward:return e.ConstraintType.StartNoLaterThan}}getEndDatePinConstraintType(){const{effectiveDirection:t}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(t.direction){case e.Direction.Forward:return e.ConstraintType.FinishNoEarlierThan;case e.Direction.Backward:return e.ConstraintType.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:t,ignorePinningConstraint:n,constraintType:r}=this;let i=!1;if(!t&&!n)if(r)switch(r){case e.ConstraintType.AsSoonAsPossible:case e.ConstraintType.AsLateAsPossible:case e.ConstraintType.StartNoEarlierThan:case e.ConstraintType.StartNoLaterThan:case e.ConstraintType.FinishNoEarlierThan:case e.ConstraintType.FinishNoLaterThan:i=!0}else i=!0;return i}applyChangeset(e,t,n){this.ignorePinningConstraint=n;const r=super.applyChangeset(e,t,n);return this.ignorePinningConstraint=!1,r}getConstraintTypeDefaultDate(t,n){switch(n){case e.ConstraintType.StartNoEarlierThan:case e.ConstraintType.StartNoLaterThan:case e.ConstraintType.MustStartOn:return t(_x(this.$.startDate));case e.ConstraintType.FinishNoEarlierThan:case e.ConstraintType.FinishNoLaterThan:case e.ConstraintType.MustFinishOn:return t(_x(this.$.endDate))}return null}*isConstraintTypeApplicable(t){const n=yield*this.hasSubEvents();switch(t){case e.ConstraintType.FinishNoEarlierThan:case e.ConstraintType.StartNoLaterThan:case e.ConstraintType.MustFinishOn:case e.ConstraintType.MustStartOn:return!n}return!0}async setConstraint(e,t){return this.constraintType=e,t!==i&&(this.constraintDate=t),this.commitAsync()}*calculateEndDateConstraintIntervals(){const t=yield*n.calculateEndDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,i=yield this.$.constraintType,s=yield this.$.constraintDate,o=this.project.dateConstraintIntervalClass;if(!r&&i&&s)switch(i){case e.ConstraintType.MustFinishOn:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.End,startDate:s,endDate:s}));break;case e.ConstraintType.FinishNoEarlierThan:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.End,startDate:s}));break;case e.ConstraintType.FinishNoLaterThan:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.End,endDate:s}))}return t}*calculateStartDateConstraintIntervals(){const t=yield*n.calculateStartDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,i=yield this.$.constraintType,s=yield this.$.constraintDate,o=this.project.dateConstraintIntervalClass;if(!r&&i&&s)switch(i){case e.ConstraintType.MustStartOn:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.Start,startDate:s,endDate:s}));break;case e.ConstraintType.StartNoEarlierThan:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.Start,startDate:s}));break;case e.ConstraintType.StartNoLaterThan:t.unshift(o.new({owner:this,side:e.ConstraintIntervalSide.Start,endDate:s}))}return t}}return yk([TT({type:"string"},{sync:!0})],r.prototype,"constraintType",void 0),yk([TT({type:"date"},{converter:IT,sync:!0})],r.prototype,"constraintDate",void 0),yk([eT("constraintType")],r.prototype,"writeConstraintType",null),yk([eT("direction")],r.prototype,"writeDirection",null),yk([QR("constraintType")],r.prototype,"calculateConstraintType",null),yk([QR("constraintDate")],r.prototype,"calculateConstraintDate",null),r}))){}class Ck extends(rt(ak)){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return Kb(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}}class Sk extends lk{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(t){let n;switch(t.owner.constraintType){case e.ConstraintType.StartNoEarlierThan:case e.ConstraintType.FinishNoEarlierThan:case e.ConstraintType.MustStartOn:case e.ConstraintType.MustFinishOn:n=this.L("L{startDateDescriptionTpl}");break;case e.ConstraintType.StartNoLaterThan:case e.ConstraintType.FinishNoLaterThan:n=this.L("L{endDateDescriptionTpl}")}return Kb(n,...this.getDescriptionParameters(t))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const t=e.owner;return[Gt.format(e.startDate,this.L("L{dateFormat}")),Gt.format(e.endDate,this.L("L{dateFormat}")),t.name||t.id,this.getConstraintName(t.constraintType)]}}class Dk extends ck{get isDateConstraintInterval(){return!0}getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const t=this.owner,n=(e=e||t.graph.activeTransaction).entries.get(t.$.constraintDate),r=e.entries.get(t.$.constraintType);return!e.baseRevision.hasIdentifier(t.$$)||n&&!n.isShadow()||r&&!r.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}}yk([JE(Ck)],Dk.prototype,"removeDateConstraintConflictResolutionClass",void 0),yk([JE(Sk)],Dk.prototype,"descriptionBuilderClass",void 0);var wk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Ek extends(Ty([vk],(t=>{t.prototype;class n extends t{*calculatePercentDone(){const e=yield this.$.childEvents,t=this.getProject(),n=yield t.$.autoCalculatePercentDoneForParentTasks;if(e.size&&n){const e=yield this.$.percentDoneSummaryData;return e.totalDuration>0?e.completedDuration/e.totalDuration:e.milestonesNum>0?e.milestonesTotalPercentDone/e.milestonesNum:null}return yield ax}*shouldRollupChildPercentDoneSummaryData(e){return!0}*calculatePercentDoneSummaryData(){const t=yield this.$.childEvents;if(t.size){let e={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const n of t){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(n)))continue;const t=yield n.$.percentDoneSummaryData;t&&(e.totalDuration+=t.totalDuration,e.completedDuration+=t.completedDuration,e.milestonesNum+=t.milestonesNum,e.milestonesTotalPercentDone+=t.milestonesTotalPercentDone)}return e}{const t=yield this.$.duration;if("number"==typeof t){const n=yield*this.getProject().$convertDuration(t,yield this.$.durationUnit,e.TimeUnit.Millisecond),r=yield this.$.percentDone;return{totalDuration:n,completedDuration:n*r,milestonesNum:0===n?1:0,milestonesTotalPercentDone:0===n?r:0}}return null}}}return wk([TT({type:"number",defaultValue:0})],n.prototype,"percentDone",void 0),wk([JR()],n.prototype,"percentDoneSummaryData",void 0),wk([QR("percentDone")],n.prototype,"calculatePercentDone",null),wk([QR("percentDoneSummaryData")],n.prototype,"calculatePercentDoneSummaryData",null),n}))){}var xk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Rk extends(Ty([pk,JM,vk,bk],(t=>{const n=t.prototype;class r extends t{*shouldPredecessorAffectScheduling(e){const t=yield e.$.fromEvent;return t&&!XE(t)&&(yield e.$.active)&&(!(yield t.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const t=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),r=this.getProject(),i=r.dependencyConstraintIntervalClass;for(const n of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(n)))continue;const s=yield n.$.fromEvent,o=yield s.$.manuallyScheduled;let a;switch(yield n.$.type){case e.DependencyType.EndToStart:a=o?yield s.$.endDate:yield s.$.earlyEndDateRaw;break;case e.DependencyType.StartToStart:a=o?yield s.$.startDate:yield s.$.earlyStartDateRaw}if(a){const s=yield n.$.lag,o=yield n.$.lagUnit,l=yield n.$.calendar;yield l.$.version;const c=i.new({owner:n,startDate:l.calculateEndDate(a,yield*r.$convertDuration(s,o,e.TimeUnit.Millisecond)),endDate:null});t.unshift(c)}}return t}*calculateEarlyEndDateConstraintIntervals(){const t=yield*n.calculateEarlyEndDateConstraintIntervals.call(this),r=this.getProject(),i=r.dependencyConstraintIntervalClass;for(const n of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(n)))continue;const s=yield n.$.fromEvent,o=yield s.$.manuallyScheduled;let a;switch(yield n.$.type){case e.DependencyType.EndToEnd:a=o?yield s.$.endDate:yield s.$.earlyEndDateRaw;break;case e.DependencyType.StartToEnd:a=o?yield s.$.startDate:yield s.$.earlyStartDateRaw}if(a){const s=yield n.$.lag,o=yield n.$.lagUnit,l=yield n.$.calendar;yield l.$.version;const c=i.new({owner:n,startDate:l.calculateEndDate(a,yield*r.$convertDuration(s,o,e.TimeUnit.Millisecond)),endDate:null});t.unshift(c)}}return t}*calculateEffectiveDirection(){const t=yield this.getProject().$.effectiveDirection,n=yield this.$.constraintType;if(t.direction===e.Direction.Forward&&!(yield this.$.manuallyScheduled)&&(n!==e.ConstraintType.MustStartOn&&n!==e.ConstraintType.MustFinishOn||!Boolean(yield this.$.constraintDate)))for(const t of yield this.$.incomingDeps){const n=yield t.$.fromEvent,r=null!=n&&!XE(n),s=r?yield n.$.constraintType:i;if(!r||!(yield t.$.active)||(yield n.$.manuallyScheduled)||(s===e.ConstraintType.MustStartOn||s===e.ConstraintType.MustFinishOn)&&Boolean(yield n.$.constraintDate))continue;const o=yield t.$.type,a=o===e.DependencyType.EndToEnd||o===e.DependencyType.EndToStart?yield n.$.endDateDirection:yield n.$.startDateDirection;if(a.direction===e.Direction.Backward)return{kind:"enforced",direction:e.Direction.Backward,enforcedBy:"enforced"===a.kind?a.enforcedBy:"own"===a.kind?n:a.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return xk([TT({type:"boolean"})],r.prototype,"inactive",void 0),r}))){}class Tk extends(rt(ak)){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:t,fromEvent:n,toEvent:r}=e;return Kb(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[t],n.name||n.id,r.name||r.id)}}class Mk extends Tk{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}}class kk extends Tk{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}}class Ik extends lk{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const t=e.owner;return[Gt.format(e.startDate,this.L("L{dateFormat}")),Gt.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[t.type],t.fromEvent.name,t.toEvent.name]}}class Ak extends ck{get isDependencyConstraintInterval(){return!0}isAffectedByTransaction(e){const t=this.owner;e=e||t.graph.activeTransaction;const{entries:n}=e,{fromEvent:r,toEvent:i,lag:s,lagUnit:o,type:a}=t.$,l=n.get(r),c=n.get(i),d=n.get(s),u=n.get(o),h=n.get(a);return!e.baseRevision.hasIdentifier(t.$$)||l&&!l.isShadow()||c&&!c.isShadow()||d&&!d.isShadow()||u&&!u.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}}xk([JE(Mk)],Ak.prototype,"removeDependencyConflictResolutionClass",void 0),xk([JE(kk)],Ak.prototype,"deactivateDependencyConflictResolutionClass",void 0),xk([JE(Ik)],Ak.prototype,"descriptionBuilderClass",void 0);var Fk=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Pk extends(Ty([XM],(t=>{const n=t.prototype;class r extends t{*hasProposedValueForUnits(){const e=yield this.$.assigned;for(const t of e){if((yield t.$.resource)&&(yield Ax(t.$.units)))return!0}return!1}async assign(e,t=100){const n=this.getProject().assignmentStore.modelClass;return this.addAssignment(new n({event:this,resource:e,units:t})),this.commitAsync()}*forEachAvailabilityInterval(e,t){const n=yield this.$.effectiveCalendar,r=yield this.$.assignmentsByCalendar,i=yield this.$.effectiveCalendarsCombination,s=(yield this.$.ignoreResourceCalendar)||e.ignoreResourceCalendar||!r.size,o=this.getProject().maxCalendarRange;return o&&(e=Object.assign({maxRange:o},e)),i.forEachAvailabilityInterval(e,((e,i,o)=>{const a=o.getCalendarsWorkStatus(),l=o.getCalendarsWorking();if(a.get(n)&&(s||l.some((e=>r.has(e)))))return t(e,i,o)}))}*calculateEffectiveCalendarsCombination(){const e=yield this.$.manuallyScheduled,t=this.getProject(),n=[yield this.$.effectiveCalendar];if(!e||t.skipNonWorkingTimeInDurationWhenSchedulingManually){const e=yield this.$.assignmentsByCalendar;n.push(...e.keys())}return this.getProject().combineCalendars(n)}*calculateAssignmentsByCalendar(){const e=yield this.$.assigned,t=new Map;for(const n of e){const e=yield n.$.resource;if(e){const r=yield e.$.effectiveCalendar;let i=t.get(r);i||(i=[],t.set(r,i)),i.push(n)}}return t}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(t,r=!0,i){if(!t)return null;const s=yield this.$.assignmentsByCalendar,o=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),r?{startDate:t,isForward:r}:{endDate:t,isForward:r},i);let a;const l=yield*this.forEachAvailabilityInterval(n,((e,t,n)=>(a=r?e:t,!1)));if(l===e.CalendarIteratorResult.MaxRangeReached||l===e.CalendarIteratorResult.FullRangeIterated){const i=[yield this.$.effectiveCalendar];n.ignoreResourceCalendar||o||i.push(...s.keys());const a=QT.new({event:this,calendars:i,date:t,isForward:r});if((yield a)!==e.EffectResolutionResult.Cancel)return null;yield dx(a)}return new Date(a)}return yield*n.skipNonWorkingTime.call(this,t,r)}*calculateProjectedDuration(t,r,i,s){if(!t||!r)return null;if(yield*this.useEventAvailabilityIterator()){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:t,endDate:r,isForward:!0},s),o=this.getProject().adjustDurationToDST;let a=0;return yield*this.forEachAvailabilityInterval(n,((e,t)=>{if(a+=t.getTime()-e.getTime(),o){const n=e.getTimezoneOffset()-t.getTimezoneOffset();a+=60*n*1e3}})),i||(i=yield this.$.durationUnit),yield*this.getProject().$convertDuration(a,e.TimeUnit.Millisecond,i)}return yield*n.calculateProjectedDuration.call(this,t,r,i)}*calculateProjectedXDateWithDuration(t,n=!0,r,i,s){if(null==r||isNaN(r)||null==t)return null;if(0==r)return t;i=i||(yield this.$.durationUnit);const o=yield*this.getProject().$convertDuration(r,i,e.TimeUnit.Millisecond);let a=t.getTime(),l=o;const c=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),n?{startDate:t,isForward:n}:{endDate:t,isForward:n},s),i=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(r,((e,t,r)=>{const s=e.getTime(),o=t.getTime(),c=o-s;if(c>=l){if(i){const r=n?e.getTimezoneOffset()-new Date(s+l).getTimezoneOffset():new Date(o-l).getTimezoneOffset()-t.getTimezoneOffset();l-=60*r*1e3}return a=n?s+l:o-l,!1}if(l-=c,i){const n=e.getTimezoneOffset()-t.getTimezoneOffset();l-=60*n*1e3}})))===e.CalendarIteratorResult.StoppedByIterator?new Date(a):null}return c.accumulateWorkingTime(t,o,n).finalDate}}return Fk([JR()],r.prototype,"effectiveCalendarsCombination",void 0),Fk([JR()],r.prototype,"assignmentsByCalendar",void 0),Fk([TT({type:"boolean"})],r.prototype,"ignoreResourceCalendar",void 0),Fk([QR("effectiveCalendarsCombination")],r.prototype,"calculateEffectiveCalendarsCombination",null),Fk([QR("assignmentsByCalendar")],r.prototype,"calculateAssignmentsByCalendar",null),r}))){}var Ok=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const Lk=Symbol("MasterStartDateVar"),$k=Symbol("MasterEndDateVar"),_k=Symbol("MasterDurationVar"),jk=Symbol("MasterTotalDurationVar"),Bk=Symbol("StartOffsetVar"),Vk=Symbol("EndOffsetVar"),Hk=CM.new({output:FM,inputs:new Set([Bk,Vk])}),Nk=CM.new({output:IM,inputs:new Set([Bk,Lk])}),zk=CM.new({output:AM,inputs:new Set([Vk,Lk])}),Wk=CM.new({output:Bk,inputs:new Set([IM,Lk])}),Uk=CM.new({output:Vk,inputs:new Set([AM,Lk])}),Gk=CM.new({output:Bk,inputs:new Set([Vk,FM])}),Yk=CM.new({output:Vk,inputs:new Set([Bk,FM])}),qk=CM.new({output:Vk,inputs:new Set([Bk,jk])}),Kk=CM.new({output:Vk,inputs:new Set([Bk,_k])}),Xk=CM.new({output:FM,inputs:new Set([Bk,$k])}),Zk=wM.new({variables:new Set([IM,AM,FM,Lk,$k,_k,jk,Bk,Vk]),formulas:new Set([Hk,Nk,zk,Gk,Wk,Yk,qk,Kk,Uk,Xk])}),Jk=EM.new({description:Zk,defaultResolutionFormulas:new Set([zk,Uk,Yk])});class Qk extends(VR.mix(DR)){equality(e,t){const n=e.resolution,r=t.resolution;return n.get(IM)===r.get(IM)&&n.get(AM)===r.get(AM)&&n.get(FM)===r.get(FM)&&n.get(Lk)===r.get(Lk)&&n.get($k)===r.get($k)&&n.get(_k)===r.get(_k)&&n.get(jk)===r.get(jk)&&n.get(Bk)===r.get(Bk)&&n.get(Vk)===r.get(Vk)}}class eI extends(Ty([qM],(t=>{class n extends t{get isEventSegment(){return!0}get stm(){var e;return null===(e=this.event)||void 0===e?void 0:e.stm}set stm(e){}writeStartDate(e,t,n,r,i=!0){const s=this.event,o=this.getProject();if(!s||this.previousSegment||!t.baseRevision.hasIdentifier(e)||o&&o.getStm().isRestoring?e.constructor.prototype.write.call(this,e,t,n,r,i):s.$.startDate.constructor.prototype.write.call(this,s.$.startDate,t,null,r,i),i&&this.nextSegment){const e=this.endOffset-this.nextSegment.startOffset;if(e>0){let t=this;for(;t=t.nextSegment;)t.startOffset+=e,t.endOffset+=e}}}shouldRecordFieldChange(e,t,n){return"startOffset"===e||"endOffset"===e||super.shouldRecordFieldChange(e,t,n)}*calculateStartOffset(){const t=(yield this.$.dispatcher).resolution.get(Bk);if(!this.event)return yield ax;let n;if(t===bM)n=yield ax;else if(t===Gk.formulaId)n=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(t===Wk.formulaId){const t=yield _x(this.event.$.startDate),r=yield _x(this.$.startDate);n=yield*this.event.calculateProjectedDuration(t,r,e.TimeUnit.Millisecond,{ignoreSegments:!0})}return n}*calculateEndOffset(){const t=(yield this.$.dispatcher).resolution.get(Vk);if(!this.event)return yield ax;let n;if(t===bM)n=yield ax;else if(t===Yk.formulaId)n=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(t===Uk.formulaId){const t=yield _x(this.event.$.startDate),r=yield _x(this.$.endDate);n=yield*this.event.calculateProjectedDuration(t,r,e.TimeUnit.Millisecond,{ignoreSegments:!0})}else t===Kk.formulaId?n=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():t===qk.formulaId&&(n=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return n}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(IM);if(!this.event)return yield ax;let t;return t=e===Nk.formulaId?yield*this.calculateStartDateByMasterStartAndStartOffset():yield*super.calculateStartDate(),t}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(AM);if(!this.event)return yield ax;let t;return t=e===zk.formulaId?yield*this.calculateEndDateByMasterStartAndEndOffset():yield*super.calculateEndDate(),t}*calculateDuration(){const e=(yield this.$.dispatcher).resolution.get(FM);if(!this.event)return yield ax;let t;return t=e===Hk.formulaId||e===Xk.formulaId?yield*this.calculateDurationByOffsets():yield*super.calculateDuration(),t}buildProposedDispatcher(e,t,n){const r=super.buildProposedDispatcher(e,t,n);return r.addPreviousValueFlag(Lk),r.addPreviousValueFlag(Bk),r.addPreviousValueFlag(Vk),r}*prepareDispatcher(e){const t=yield*super.prepareDispatcher(e);if(!this.event)return t;if(null!=e(xx(this.event.$.startDate))&&t.addPreviousValueFlag(Lk),e(Ax(this.event.$.startDate))&&t.addProposedValueFlag(Lk),!e(Ax(this.event.$.segments))){if(t.collectInfo(e,this.event.$.duration,_k),e(Ax(this.event.$.endDate))){const n=e(Vx(this.event.$.endDate));null!=n&&n[0]||t.addProposedValueFlag($k)}const n=e(this.event.$.dispatcher);n.resolution.get(IM)===bM&&n.resolution.get(AM)===bM&&t.addProposedValueFlag(jk)}return t.collectInfo(e,this.$.startOffset,Bk),t.collectInfo(e,this.$.endOffset,Vk),t}cycleResolutionContext(e){return Jk}*calculateEndOffsetByMasterDurationAndStartOffset(){const t=yield _x(this.event.$.duration),n=yield this.event.$.durationUnit,r=yield this.$.startOffset,i=this.nextSegment;let s,o=yield*this.getProject().$convertDuration(t,n,e.TimeUnit.Millisecond);const a=[];let l=this;for(;l=l.previousSegment;)a.push(l);for(let e=a.length-1;e>=0;e--){const t=a[e],n=yield _x(t.$.startOffset);o-=(yield _x(t.$.endOffset))-n}return s=o>0?i?r+Math.min(o,(yield _x(this.$.endOffset))-r):r+o:r,s}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const t=yield _x(this.event.$.startDate),n=yield _x(this.event.$.endDate),r=yield*this.event.calculateProjectedDuration(t,n,e.TimeUnit.Millisecond,{ignoreSegments:!0}),i=yield _x(this.$.startOffset);let s=yield _x(this.$.endOffset),o=this.nextSegment;return i<=r?s<=r?!o||(yield _x(o.$.startOffset))>=r?r:s:r:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const t=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(t,n,e.TimeUnit.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const t=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(t,n,e.TimeUnit.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const t=yield this.event.$.startDate,n=yield this.$.endOffset,r=yield*this.event.calculateProjectedXDateWithDuration(t,!0,n,e.TimeUnit.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?r:yield*this.event.skipNonWorkingTime(r,!1)}*calculateStartDateByMasterStartAndStartOffset(){const t=yield this.event.$.startDate,n=yield this.$.startOffset,r=yield*this.event.calculateProjectedXDateWithDuration(t,!0,n,e.TimeUnit.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?r:yield*this.event.skipNonWorkingTime(r)}*calculateDurationByOffsets(){const t=yield this.$.startOffset,n=yield this.$.endOffset,r=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(n-t,e.TimeUnit.Millisecond,r)}*calculatePercentDone(){if(!this.event)return yield ax;const t=yield this.event.$.segments;if(t){const n=yield this.event.$.percentDone,r=yield this.event.$.duration,i=yield this.event.$.durationUnit;let s=.01*n*(yield*this.getProject().$convertDuration(r,i,e.TimeUnit.Millisecond));for(const e of t){const t=e.startOffset,n=e.endOffset-t;if(e===this)return s>=n?100:s>0?100*s/n:0;s-=n}}return 0}*calculateMinPercent(){const e=this.previousSegment;return this.event?e?yield e.$.endPercentDone:0:yield ax}*calculateMaxPercent(){if(!this.event)return yield ax;const t=yield this.event.$.duration,n=yield this.event.$.durationUnit;let r=yield*this.getProject().$convertDuration(t,n,e.TimeUnit.Millisecond);const i=yield this.$.startOffset,s=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(s-i)/r}*calculateProjectedXDateWithDuration(e,t,n,r){return r||(r=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(e,t,n,r,{ignoreSegments:!0})}*calculateProjectedDuration(e,t,n){return n||(n=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(e,t,n,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield ax}}return Ok([JR({identifierCls:Qk})],n.prototype,"dispatcher",void 0),Ok([TT({persist:!1})],n.prototype,"startOffset",void 0),Ok([TT({persist:!1})],n.prototype,"endOffset",void 0),Ok([JR()],n.prototype,"percentDone",void 0),Ok([JR()],n.prototype,"startPercentDone",void 0),Ok([JR()],n.prototype,"endPercentDone",void 0),Ok([eT("startDate")],n.prototype,"writeStartDate",null),Ok([QR("startOffset")],n.prototype,"calculateStartOffset",null),Ok([QR("endOffset")],n.prototype,"calculateEndOffset",null),Ok([QR("percentDone")],n.prototype,"calculatePercentDone",null),Ok([QR("startPercentDone")],n.prototype,"calculateMinPercent",null),Ok([QR("endPercentDone")],n.prototype,"calculateMaxPercent",null),Ok([QR("manuallyScheduled")],n.prototype,"calculateManuallyScheduled",null),n}))){}var tI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const nI=Symbol("SegmentsVar"),rI=(e,t,n)=>n.processSegmentsValue(e),iI=CM.new({output:IM,inputs:new Set([AM,nI])}),sI=CM.new({output:AM,inputs:new Set([IM,nI])});CM.new({output:FM,inputs:new Set([IM,AM,nI])});const oI=wM.new({variables:new Set([IM,AM,FM,nI]),formulas:new Set([sI,iI,PM,OM,LM])}),aI=EM.new({description:oI,defaultResolutionFormulas:new Set([OM,sI])}),lI=EM.new({description:oI,defaultResolutionFormulas:new Set([PM,iI])});class cI extends(VR.mix(DR)){equality(e,t){const n=e.resolution,r=t.resolution;return n.get(IM)===r.get(IM)&&n.get(AM)===r.get(AM)&&n.get(FM)===r.get(FM)&&n.get(nI)===r.get(nI)}}function dI(e,t){return!e&&!t||!this._skipSegmentsIsEqual&&(!(!e&&t||e&&!t)&&(e.length===t.length&&e.every(((e,n)=>uI(e,t[n])))))}const uI=(e,t)=>{if(e===t)return!0;const n=(e.isModel?e:t).fieldMap,r=e.startDate instanceof Date?e.startDate.getTime():n.startDate.convert(e.startDate).getTime(),i=t.startDate instanceof Date?t.startDate.getTime():n.startDate.convert(t.startDate).getTime(),s=e.endDate instanceof Date?e.endDate.getTime():n.endDate.convert(e.endDate).getTime(),o=t.endDate instanceof Date?t.endDate.getTime():n.endDate.convert(t.endDate).getTime();return r===i&&s===o};class hI extends(Ty([Pk,Ek],(t=>{class n extends t{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let e=super.rawModifications;if(this.segments&&(!e||!("segments"in e)))for(const t of this.segments)if(t.rawModifications){e=e||{},e.segments=this.getFieldPersistentValue("segments");break}return e}clearChanges(e,t,n){for(const n of this.segments||[])n.clearChanges(e,t,null);super.clearChanges(e,t,n)}getDefaultSegmentModelClass(){return eI}*prepareDispatcher(e){const t=yield*super.prepareDispatcher(e);return(yield*this.hasSegmentChangesProposed())&&t.addProposedValueFlag(nI),t}cycleResolutionContext(t){const n=t(this.$.effectiveDirection);return n.direction===e.Direction.Forward||n.direction===e.Direction.None?aI:lI}*hasSegmentChangesProposed(){const e=yield Mx(this.$.segments);let t=!1;(yield Ax(this.$.segments))&&(t=Boolean(e));const n=yield _x(this.$.segments);if(!n)return!1;for(const e of n){const n=yield Ax(e.$.startDate),r=yield Ax(e.$.endDate),i=yield Ax(e.$.duration);(n||r||i)&&(t=!0)}return t}writeSegments(e,t,n,r){var i;const s=null===(i=t.getLatestEntryFor(e))||void 0===i?void 0:i.getValue(),o=s!==tR?s??[]:[],a=new Set(o),l=r??[],c=new Set(l);this.project.ion({commitFinalized:()=>u.removeEntities(o.filter((e=>!c.has(e)))),once:!0}),e.constructor.prototype.write.call(this,e,t,n,r),this.$.isSegmented.write.call(this,this.$.isSegmented,t,null,Boolean(null==r?void 0:r.length));const d=this.project,u=d.replica;for(const e of l)a.has(e)||e.graph===u||(e.setProject(d),u.addEntity(e))}*doWriteSegments(t,n){if(n=n||[],t.length<=1){const r=t.length?yield*this.getProject().$convertDuration(t[0].endOffset-t[0].startOffset,e.TimeUnit.Millisecond,yield this.$.durationUnit):0;n.push({identifier:this.$.duration,proposedArgs:[r,null]}),t=null}n.push({identifier:this.$.segments,proposedArgs:[t]}),yield Dx(n)}*calculateSegments(){var e;yield this.$.dispatcher;const{graph:t,project:n}=this,r=yield xx(this.$.segments);let i=yield ax;const s=[];let o=!1;if(i){const e=new Set;let n=null,r=!1;const{baseRevision:a}=t.$activeTransaction;for(const t of i){const i=yield t.$.startOffset,o=yield t.$.endOffset,l=a.hasIdentifier(t.$.startDate)&&(yield Vx(t.$.startDate)),c=a.hasIdentifier(t.$.endDate)&&(yield Vx(t.$.endDate));if(r=r||(null==l?void 0:l[0])||(null==c?void 0:c[0]),i===o)s.push(t);else if(n&&i<=n.endOffset){const e=n.endOffset;if(s.push(t),n.graph){s.push(n);const t=n.startOffset,a=r?o+e-i:Math.max(o,e),l=n.cls;n=this.segmentModelClass.new({event:this,cls:l,startOffset:t,endOffset:a})}else n.endOffset=r?o+n.endOffset-i:Math.max(o,n.endOffset)}else n&&e.add(n),n=t}n&&e.add(n),1===e.size&&s.push(...e),o=s.length>0,o&&(i=Array.from(e)),i.reduce(((e,t,n)=>(e&&(e.nextSegment=t),t.previousSegment=e,t.segmentIndex=n,t)),null),i.length&&(i[i.length-1].nextSegment=null)}else r&&s.push(...r);return s.length&&(s.forEach((e=>e.event=null)),n.ion({commitFinalized:()=>t.removeEntities(s),once:!0})),o&&(yield*this.doWriteSegments(i)),i=(null===(e=i)||void 0===e?void 0:e.length)>1?i:null,i}*calculateAdjustedSegments(){yield this.$.dispatcher;let t=yield this.$.segments;yield this.$.startDate;const n=yield this.$.endDate;yield this.$.duration;let r=yield ax;if(t){const r=this.project,i=this.graph,s=[],o=[];let a=-1;for(let i=t.length-1;i>=0;i--){const l=t[i],c=yield l.$.startDate,d=yield l.$.endDate;if(!(c>n)){if(d.getTime()!==n.getTime()){const t=l.endOffset+(n.getTime()-d.getTime())-l.startOffset,i=yield*r.$convertDuration(t,e.TimeUnit.Millisecond,yield l.$.durationUnit);o.push({identifier:l.$.duration,proposedArgs:[i,null]},{identifier:l.$.endDate,proposedArgs:[n,!1]},{identifier:l.$.endOffset,proposedArgs:[l.endOffset+(n.getTime()-d.getTime())]})}break}s.push(l),a=i}let l=!1;a>-1&&(l=!0,t.splice(a),t.length&&(t[t.length-1].nextSegment=null),r.ion({commitFinalized:()=>i.removeEntities(s),once:!0}));let c="";t&&(c=this.getSegmentsSnapshot(t)),c!==this._lastSegmentsSnapshot&&(l=!0,t=t?t.slice():t,this._lastSegmentsSnapshot=c),l&&(yield*this.doWriteSegments(t,o))}return r}getSegmentsSnapshot(e){var t;return null===(t=e=e||this.segments)||void 0===t?void 0:t.map((e=>{var t,n;return e.startOffset+"-"+(null===(t=e.startDate)||void 0===t?void 0:t.getTime())+"-"+e.endOffset+"-"+(null===(n=e.endDate)||void 0===n?void 0:n.getTime())})).join(";")}processSegmentsValue(e){let t=e;if(e)for(let t=0;t<e.length;t++){const n=e[t],r=n.isModel?n:this.segmentModelClass.new(n);r.event||(r.event=this),e[t]=r}return t}*calculateStartDate(){let e;return e=(yield this.$.dispatcher).resolution.get(IM)===iI.formulaId?yield*this.calculateStartDateBySegments():yield*super.calculateStartDate(),e}*calculateStartDateBySegments(){yield this.$.dispatcher;const t=yield this.$.segments,n=yield this.$.endDate;let r;if(t){const i=t[t.length-1],s=yield i.$.endOffset,o=yield*this.calculateProjectedXDateWithDuration(n,!1,s,e.TimeUnit.Millisecond,{ignoreSegments:!0});r=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?o:yield*this.skipNonWorkingTime(o,!0)}return r}*calculateEndDateBySegments(){yield this.$.dispatcher;const t=yield this.$.segments,n=yield this.$.startDate;let r;if(t){const i=t[t.length-1],s=yield i.$.endOffset,o=yield*this.calculateProjectedXDateWithDuration(n,!0,s,e.TimeUnit.Millisecond,{ignoreSegments:!0});r=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?o:yield*this.skipNonWorkingTime(o,!1)}return r}*calculateEndDate(){let e;return e=(yield this.$.dispatcher).resolution.get(AM)===sI.formulaId?yield*this.calculateEndDateBySegments():yield*super.calculateEndDate(),e}*calculateDurationProposed(){let e;return e=(yield*this.hasSegmentChangesProposed())?yield*this.calculateDurationBySegments():yield*super.calculateDurationProposed(),e}*skipNonWorkingTime(e,t=!0,n){return e?(n=Object.assign({ignoreSegments:!0},n),yield*super.skipNonWorkingTime(e,t,n)):null}*calculateDurationBySegments(){let t;yield this.$.dispatcher;const n=yield this.$.durationUnit,r=yield this.$.segments;if(r){let i=0;for(const e of r)i+=e.endOffset-e.startOffset;t=yield*this.getProject().$convertDuration(i,e.TimeUnit.Millisecond,n)}return t}*forEachAvailabilityInterval(e,t){const n=yield this.$.effectiveCalendar,r=yield this.$.assignmentsByCalendar,i=yield this.$.effectiveCalendarsCombination,s=!1!==e.isForward,o=(yield this.$.ignoreResourceCalendar)||e.ignoreResourceCalendar||!r.size,a=this.getProject().maxCalendarRange;let l,c,d,u,h,g=e.ignoreSegments,m=1;g||(u=yield this.$.segments,g=g||!u,g||(u=u.slice(),s?(l=u.shift(),c=0,m=1,h=l.nextSegment?l.endOffset:KC.getTime()):(l=u.pop(),c=l.endOffset,m=-1,h=l.endOffset),d=h-l.startOffset));const p=yield this.$.manuallyScheduled,f=this.getProject();return i.forEachAvailabilityInterval(Object.assign({maxRange:a},e),((e,i,a)=>{const v=a.getCalendarsWorkStatus(),y=a.getCalendarsWorking();if(v.get(n)&&(o||y.some((e=>r.has(e)))||p&&!f.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(g)return t(e,i,a);{const n=e.getTime();let r,o,g=i.getTime()-e.getTime();if(this.getProject().adjustDurationToDST){g+=60*(e.getTimezoneOffset()-i.getTimezoneOffset())*1e3}for(s?(r=c,o=c+g):(r=c-g,o=c);l&&r<=h&&o>l.startOffset;){const e=Math.max(r,l.startOffset),i=Math.min(o,h),c=new Date(n+e-r),g=new Date(n+i-r);if(!1===t(c,g,a))return!1;if(d-=g.getTime()-c.getTime(),d)break;l=s?u.shift():u.pop(),l&&(h=!s||l.nextSegment?l.endOffset:KC.getTime(),d=h-l.startOffset)}c+=m*g}}}))}*useEventAvailabilityIterator(){if(yield this.$.isSegmented)return!0;return!(yield this.$.manuallyScheduled)}getSegmentByDate(e,t){if(t=t||this.getSegments()){return t[this.getSegmentIndexByDate(e,t)]}}getSegmentIndexByDate(e,t){return(t=t||this.getSegments())?t.findIndex((t=>e>=t.startDate&&e<t.endDate)):-1}get firstSegment(){const e=this.getSegments();return e?e[0]:null}get lastSegment(){const e=this.getSegments();return e?e[e.length-1]:null}getSegment(e){const t=this.getSegments();return null==t?void 0:t[e]}async splitToSegments(t,n=1,r){var i;const s=this.getProject();await s.commitAsync();const o=this;if(!t||o.isHasSubEventsMixin&&null!==(i=o.childEvents)&&void 0!==i&&i.size)return;const a=o.duration,l=o.durationUnit,c=o.startDate,d=o.endDate;if(r=r?Gt.normalizeUnit(r):l,!c||!d||c>=t||t>=d||!a)return;const u=o.isSegmented;let h,g,m=o.segments||[];if(u&&(g=o.getSegmentIndexByDate(t,m),h=m[g],!h))return;const p=h||o,f=h?p.startDate:c,v=p.duration,y=p.durationUnit,b=o.run("calculateProjectedDuration",f,t,y,{ignoreSegments:!0}),C=v-b,S=s.run("$convertDuration",n,r,e.TimeUnit.Millisecond),D=S+o.run("calculateProjectedDuration",c,t,e.TimeUnit.Millisecond,{ignoreSegments:!0});if(h){h.duration=b;const e=this.segmentModelClass.new({duration:C,durationUnit:y,startOffset:D});m=m.slice(0),m.splice(g+1,0,e),o.segments=m,o.duration=a;for(let e=g+2,t=m.length;e<t;e++){const t=m[e];t&&(t.startOffset+=S,t.endOffset+=S)}}else{const e=this.segmentModelClass.new({duration:b,durationUnit:y,startOffset:0}),t=this.segmentModelClass.new({duration:a-b,durationUnit:y,startOffset:D});o.duration=a,o.segments=[e,t]}return s.commitAsync()}async mergeSegments(e,t){if(this.isSegmented){if(e=e||this.firstSegment,t=t||this.lastSegment,e.startOffset>t.startOffset){let n=t;t=e,e=n}return e.endDate=t.startDate,this.getProject().commitAsync()}}storeFieldChange(e,t){if("segments"===e&&t){const e=[];for(const n of t){const t=n.toJSON();(!this._segmentGeneration[n.internalId]||n.generation>this._segmentGeneration[n.internalId])&&Object.assign(t,n.meta.modified),e.push(t),this._segmentGeneration[n.internalId]=n.generation}t=e}super.storeFieldChange(e,t)}leaveProject(){const e=this.segments;e&&this.graph.removeEntities(e),super.leaveProject()}endBatch(...e){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...e),this.fieldMap.segments._skipSegmentsIsEqual--}copy(e=null,t=null){const n=super.copy(e,t);return n.data.segments=i,n.segments&&(n.segments=n.segments.map((e=>Object.assign(e.copy(),{event:n})))),n}toJSON(){const e=super.toJSON(),t=this.getFieldDefinition("segments"),{persist:n,dataSource:r,complexMapping:i}=t;if(n){let t=Xt.getPath(e,r);t&&(t=t.map((e=>e.toJSON())),Xt.setPath(e,r,t))}return e}}return tI([JR({identifierCls:cI})],n.prototype,"dispatcher",void 0),tI([TT({type:"array",isEqual:dI,convert:rI,_skipSegmentsIsEqual:0})],n.prototype,"segments",void 0),tI([JR()],n.prototype,"adjustedSegments",void 0),tI([JR()],n.prototype,"isSegmented",void 0),tI([eT("segments")],n.prototype,"writeSegments",null),tI([QR("segments")],n.prototype,"calculateSegments",null),tI([QR("adjustedSegments")],n.prototype,"calculateAdjustedSegments",null),n}))){}var gI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class mI extends(Ty([Pk,vk],(t=>{t.prototype;class n extends t{getEffort(e){const t=this.effort;return e?this.getProject().convertDuration(t,this.effortUnit,e):t}writeEffort(e,t,n,r,i){r<0&&(r=0),(t.baseRevision.hasIdentifier(e)||null!=r)&&(null!=i&&i!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,t,null,i),e.constructor.prototype.write(e,t,n,r))}setEffortUnit(e){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(e){return!0}*calculateTotalChildrenEffort(){const t=yield this.$.childEvents,n=this.getProject();let r=0;for(const i of t){if(!(yield*this.shouldRollupChildEffort(i)))continue;const t=yield i.$.effortUnit;r+=(yield*n.$convertDuration(yield i.$.effort,t,e.TimeUnit.Millisecond))}return yield*n.$convertDuration(r,e.TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const e=yield ax;return e!==i?e:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield ax}*calculateAssignmentUnits(e){return yield*this.calculateAssignmentUnitsProposed(e)}*calculateAssignmentUnitsPure(e){return yield*this.calculateUnitsByStartEndAndEffort(e)}*calculateAssignmentUnitsProposed(e){return yield ax}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(t,n,r){if(null==t||null==n||t>n)return null;r||(r=yield this.$.assignmentsByCalendar);const i=new Map;for(const[e,t]of r){let n=0;for(const e of t)n+=(yield e.$.units);i.set(e,n)}let s=0;const o=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:t,endDate:n});return 0===i.size&&(i.set(yield this.$.effectiveCalendar,100),o.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(o,((e,t,n)=>{const r=n.getCalendarsWorking(),o=e.getTime(),a=t.getTime()-o;let l=0;for(const e of r)l+=i.get(e)||0;s+=l*a*.01})),yield*this.getProject().$convertDuration(s,e.TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(t){const n=yield this.$.effort,r=yield this.$.effortUnit,i=yield*this.getProject().$convertDuration(n,r,e.TimeUnit.Millisecond);let s=0;const o=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),a=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(o,((e,t,n)=>{const r=n.getCalendarsWorking(),i=e.getTime(),o=t.getTime()-i;for(const e of r)s+=(a.has(e)?a.get(e).length:0)*o})),s?100*i/s:100}*calculateProjectedXDateByEffort(t,n=!0,r,s){r=r!==i?r:yield this.$.effort,s=s!==i?s:yield this.$.effortUnit;const o=yield*this.getProject().$convertDuration(r,s,e.TimeUnit.Millisecond);if(null==t||null==r)return null;let a=t.getTime(),l=o;if(0===l)return new Date(a);const c=yield this.$.effectiveCalendar,d=yield this.$.assignmentsByCalendar,u=new Map;let h=!1;for(const[e,t]of d){let n=0;for(const e of t)n+=(yield e.$.units);u.set(e,n),n>0&&(h=!0)}if(h&&(yield*this.useEventAvailabilityIterator())){const e=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),n?{startDate:t,isForward:n}:{endDate:t,isForward:n});return yield*this.forEachAvailabilityInterval(e,((e,t,r)=>{const i=r.getCalendarsWorking(),s=e.getTime(),o=t.getTime(),c=o-s;let d=0;for(const e of i)d+=u.get(e)||0;const h=d*c*.01;if(h>=l)return a=n?s+l/(.01*d):o-l/(.01*d),!1;l-=h})),new Date(a)}return c.accumulateWorkingTime(t,o,n).finalDate}}return gI([TT({type:"number"})],n.prototype,"effort",void 0),gI([TT({type:"string",defaultValue:e.TimeUnit.Hour},{converter:t=>Gt.normalizeUnit(t)||e.TimeUnit.Hour})],n.prototype,"effortUnit",void 0),gI([eT("effort")],n.prototype,"writeEffort",null),gI([QR("effort")],n.prototype,"calculateEffort",null),n}))){}const pI=Symbol("EffortVar"),fI=Symbol("UnitsVar"),vI=CM.new({output:pI,inputs:new Set([IM,AM,fI])}),yI=CM.new({output:fI,inputs:new Set([IM,AM,pI])}),bI=CM.new({output:AM,inputs:new Set([IM,pI,fI])}),CI=CM.new({output:IM,inputs:new Set([AM,pI,fI])});class SI extends BM{}class DI extends VM{equality(e,t){const n=e.resolution,r=t.resolution;return(e!==tR||t===tR)&&(e===tR||t!==tR)&&n.get(pI)===r.get(pI)&&n.get(fI)===r.get(fI)&&super.equality(e,t)}}var wI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class EI extends(Ty([mI],(t=>{const n=t.prototype;class r extends t{*calculateSchedulingMode(){return(yield ax)||e.SchedulingMode.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:e.SchedulingMode.Normal}effectiveSchedulingModeSync(t){return t(this.$.assignmentsByCalendar).size>0?t(this.$.schedulingMode):e.SchedulingMode.Normal}*prepareDispatcher(t){if((yield*this.effectiveSchedulingMode())!==e.SchedulingMode.Normal){const e=yield*n.prepareDispatcher.call(this,t);return e.collectInfo(t,this.$.effort,pI),(yield*this.hasProposedValueForUnits())&&e.addProposedValueFlag(fI),e.addPreviousValueFlag(fI),e}return yield*n.prepareDispatcher.call(this,t)}dispatcherClass(t){return this.effectiveSchedulingModeSync(t)!==e.SchedulingMode.Normal?SI:n.dispatcherClass.call(this,t)}buildProposedDispatcher(e,t,r){const i=n.buildProposedDispatcher.call(this,e,t,r);return i.addPreviousValueFlag(pI),i.addPreviousValueFlag(fI),i}*calculateAssignmentUnits(t){if((yield*this.effectiveSchedulingMode())!==e.SchedulingMode.Normal){const e=(yield this.$.dispatcher).resolution.get(fI);if(e===bM)return yield*this.calculateAssignmentUnitsProposed(t);if(e===yI.formulaId)return yield*this.calculateAssignmentUnitsPure(t);throw new Error("Unknown formula for `units`")}return yield*n.calculateAssignmentUnits.call(this,t)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==e.SchedulingMode.Normal){const e=(yield this.$.dispatcher).resolution.get(pI);if(e===bM)return yield*this.calculateEffortProposed();if(e===vI.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}return yield*n.calculateEffort.call(this)}*calculateStartDate(){if((yield*this.effectiveSchedulingMode())!==e.SchedulingMode.Normal){return(yield this.$.dispatcher).resolution.get(IM)===CI.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*n.calculateStartDate.call(this)}return yield*n.calculateStartDate.call(this)}*calculateEndDate(){if((yield*this.effectiveSchedulingMode())!==e.SchedulingMode.Normal){return(yield this.$.dispatcher).resolution.get(AM)===bI.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*n.calculateEndDate.call(this)}return yield*n.calculateEndDate.call(this)}*calculateEffectiveDuration(){const t=yield this.$.dispatcher,r=yield*this.effectiveSchedulingMode(),i=t.resolution.get(FM);let s;if(t.resolution.get(pI),i===LM.formulaId&&r!=e.SchedulingMode.Normal){const e=yield _x(this.$.startDate),r=yield _x(this.$.endDate),i=t.resolution.get(IM),o=t.resolution.get(AM);yield this.$.effortDriven,r&&i===CI.formulaId?s=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(r,!1),r):e&&o===bI.formulaId?s=yield*this.calculateProjectedDuration(e,yield*this.calculateProjectedXDateByEffort(e,!0)):(e&&r||!e&&!r)&&(s=yield*n.calculateEffectiveDuration.call(this))}else s=yield*n.calculateEffectiveDuration.call(this);return s}}return wI([TT({type:"boolean",defaultValue:!1})],r.prototype,"effortDriven",void 0),wI([TT({type:"string",defaultValue:e.SchedulingMode.Normal},{sync:!0})],r.prototype,"schedulingMode",void 0),wI([JR({identifierCls:DI})],r.prototype,"dispatcher",void 0),wI([QR("schedulingMode")],r.prototype,"calculateSchedulingMode",null),wI([QR("effort")],r.prototype,"calculateEffort",null),wI([QR("startDate")],r.prototype,"calculateStartDate",null),wI([QR("endDate")],r.prototype,"calculateEndDate",null),r}))){}const xI=wM.new({variables:new Set([IM,AM,FM,pI,fI]),formulas:new Set([PM,OM,LM,yI,vI])}),RI=wM.new({variables:new Set([IM,AM,FM,pI,fI]),formulas:new Set([PM,OM,LM,yI])}),TI=EM.new({description:xI,defaultResolutionFormulas:new Set([OM,vI])}),MI=EM.new({description:RI,defaultResolutionFormulas:new Set([OM,yI])}),kI=EM.new({description:xI,defaultResolutionFormulas:new Set([PM,vI])}),II=EM.new({description:RI,defaultResolutionFormulas:new Set([PM,yI])});class AI extends(Ty([EI],(t=>{const n=t.prototype;return class extends t{*prepareDispatcher(t){if((yield*this.effectiveSchedulingMode())===e.SchedulingMode.FixedDuration){const e=yield*n.prepareDispatcher.call(this,t),r=yield this.$.effortDriven;return r&&e.addKeepIfPossibleFlag(pI),(yield Ax(this.$.assigned))&&(r?e.addProposedValueFlag(pI):e.addProposedValueFlag(fI)),e}return yield*n.prepareDispatcher.call(this,t)}cycleResolutionContext(t){if(this.effectiveSchedulingModeSync(t)===e.SchedulingMode.FixedDuration){const n=t(this.$.effectiveDirection),r=t(this.$.effortDriven);return n.direction===e.Direction.Forward||n.direction===e.Direction.None?r?MI:TI:r?II:kI}return n.cycleResolutionContext.call(this,t)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===e.SchedulingMode.FixedDuration?{ignoreResourceCalendar:!0}:yield*n.getBaseOptionsForDurationCalculations.call(this)}}}))){}var FI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class PI extends(Ty([vk,dk,bk],(t=>{const n=t.prototype;class r extends t{get usesDelayFromParent(){return this.constructor.usesDelayFromParent}isTaskPinnableWithConstraint(){return!(this.usesDelayFromParent&&this.parent&&!this.parent.isRoot)&&n.isTaskPinnableWithConstraint.call(this)}updateDelaysAfterShrinkWrap(){const e=Math.min(...this.children.map((e=>e.delayFromParent||0)));if(0!==e)for(const t of this.children)this.graph.write(t.$.delayFromParent,t.delayFromParent-e)}updateParentEvent(e,t){if(t&&this.usesDelayFromParent&&e.usesDelayFromParent){t.usesDelayFromParent&&t.updateDelaysAfterShrinkWrap();for(const t of e.children)this.graph.write(t.$.delayFromParent,null)}}*calculateDelayFromParent(){let e=yield ax;const t=yield this.$.parentEvent;if(this.usesDelayFromParent&&t&&!t.isRoot&&null==e){let n=yield _x(t.$.startDate);if(!n){const e=t.children.flatMap((e=>{var t;return(null===(t=e.getData("startDate"))||void 0===t?void 0:t.getTime())??[]}));n=new Date(Math.min(...e))}const r=yield _x(this.$.startDate);e=yield*this.calculateProjectedDuration(n,r)}return e}writeStartDate(t,r,i,s,o=!0){const{parent:a,children:l}=this;if(this.usesDelayFromParent&&!this.project.isInitialTransaction){if(a&&!a.isRoot&&a.graph){const e=a.run("calculateProjectedDuration",a.startDate,s);this.graph.write(this.$.delayFromParent,e),!a.manuallyScheduled&&a.updateDelaysAfterShrinkWrap()}if(!o&&null!=l&&l.length&&this.manuallyScheduled){const t=this.startDate,n=this.project.convertDuration(s.getTime()-t.getTime(),e.TimeUnit.Millisecond,this.durationUnit);for(const e of l)this.graph.write(e.$.delayFromParent,e.delayFromParent-n)}}return n.writeStartDate.call(this,t,r,i,s,o)}*calculateStartDateConstraintIntervals(){const t=yield*n.calculateStartDateConstraintIntervals.call(this);let r=yield this.$.delayFromParent;if(null!=r){let n,i=yield this.$.parentEvent;const s=yield i.$.earlyStartDateConstraintIntervals,o=yield i.$.startDateConstraintIntervals;if(s.length||o.length){n=nk([...s,...o]).startDate}else n=yield Mx(i.$.startDate);n||!i.parent||i.parent.isRoot||(n=yield xx(i.$.startDate)),n&&t.push(Dk.new({owner:this,side:e.ConstraintIntervalSide.Start,startDate:yield*this.skipWorkingTime(n,!0,r),endDate:null}))}return t}*calculateEarlyEndDateConstraintIntervals(){const e=yield*n.calculateEarlyEndDateConstraintIntervals.call(this);if(null!==this.delayFromParent){const t=yield this.$.parentEvent,n=yield t.$.earlyEndDateConstraintIntervals;e.push(...n)}return e}*calculateStartDate(){const e=yield*n.calculateStartDate.call(this);if(this.usesDelayFromParent){var t;if(null!==(t=this.children)&&void 0!==t&&t.length)for(const e of this.children)yield e.$.startDateConstraintIntervals;if(yield this.$.manuallyScheduled){const e=yield this.$.startDateConstraintIntervals;if(e.length)return e[e.length-1].startDate}}return e}}return r.usesDelayFromParent=!0,FI([TT({type:"number"})],r.prototype,"delayFromParent",void 0),FI([QR("delayFromParent")],r.prototype,"calculateDelayFromParent",null),r}))){}class OI extends(Ty([QM,bk,Ek,Pk,mI,EI,AI,pk,Rk,hI],(e=>class extends e{}))){}class LI extends(Ty([OI,PI],(e=>{e.prototype;return class extends e{}}))){}class $I extends(eI.derive(Iv).mixin(Tb,mM)){static get $name(){return"EventSegmentModel"}get task(){return this.event}}$I._$name="EventSegmentModel";class _I extends(LI.derive(Iv).mixin(Rb,HT,Tb,mM)){static get $name(){return"EventModel"}static isProEventModel=!0;static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new us(e):null,serialize:e=>null!=e&&e.magnitude?e:null},{name:"postamble",convert:e=>e?new us(e):null,serialize:e=>null!=e&&e.magnitude?e:null}]}getDefaultSegmentModelClass(){return $I}updateWrapDate(e,t,n=!0){return t=new us(t),new Date(e.getTime()+(n?1:-1)*t.milliseconds)}get startDate(){let e;return e=this.isOccurrence?this.get("startDate"):this._startDate??super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){const t=this;t.batching?(t._startDate=e,t.set({startDate:e})):(super.startDate=e,t.preamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get endDate(){let e;return e=this.isOccurrence?this.get("endDate"):this._endDate??super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){const t=this;t.batching?(t._endDate=e,t.set({endDate:e})):(super.endDate=e,t.postamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get fullEffort(){return new us({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:t,startDate:n}=e,r=e._wrapStartDate;let i;return r?i=r:t?(i=e.updateWrapDate(n,t,!1),e._wrapStartDate=i):i=n,i}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:t,endDate:n}=e,r=e._wrapEndDate;let i;return r?i=r:t?(i=e.updateWrapDate(n,t,!0),e._wrapEndDate=i):i=n,i}set wrapEndDate(e){this._wrapEndDate=e}set(e){const t="object"==typeof e;return("preamble"===e||t&&"preamble"in e)&&(this.wrapStartDate=null),("postamble"===e||t&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"delayFromParent":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}getFieldPersistentValue(e){var t;const n="string"==typeof e?this.getFieldDefinition(e):e;if("delayFromParent"!==((null==n?void 0:n.name)||e)||null===(t=this.parent)||void 0===t||!t.isRoot)return super.getFieldPersistentValue(e)}get stm(){var e;return(null===(e=this.recurringEvent)||void 0===e?void 0:e.stm)??super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,t=super.assigned;return null!=e&&e.isDelayingCalculation&&!t?e.assignmentStore.storage.findItem("event",this):t}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:t}=this,n=super.getCurrentConfig(e);return n&&t&&(n.segments=t.map((t=>t.getCurrentConfig(e)))),n}endBatch(e,t,n){const r=this,{meta:{batchChanges:i}}=r;super.endBatch(e,t,n),i&&("endDate"in i&&(delete r._endDate,r.postamble&&(r.wrapEndDate=null)),"startDate"in i&&(delete r._startDate,r.preamble&&(r.wrapStartDate=null)))}}_I._$name="EventModel";class jI extends(Ty([$b,OT],(e=>class extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:QM}}buildRootNode(){return this.getProject()||{}}set data(e){super.data=e,this.afterEventRemoval()}}))){}class BI extends(Ty([jI],(e=>class extends e{static get defaultConfig(){return{tree:!0}}}))){}class VI extends(HT(rb(Gy(eb(Wy(jI.derive(ho))))))){static $name="EventStore";static get defaultConfig(){return{modelClass:_I}}}VI._$name="EventStore";class HI extends oh{get type(){return"EventUpdateAction"}construct(e){let{model:t,newData:n,oldData:r}=e;if(n.segments&&r.segments){r={...r},n={...n};const e=r.segments.slice(),t=n.segments.slice();let i=!1;r.segments.forEach(((r,s)=>{const o=n.segments.indexOf(r);o>-1&&(e[s]=t[o]=r,i=!0)})),i&&(r.segments=e,n.segments=t)}return super.construct({model:t,newData:n,oldData:r})}}HI._$name="EventUpdateAction";var NI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class zI extends(Ty([UM,LT],(e=>{const t=e.prototype;class n extends e{get assignments(){return[...this.assigned]}leaveProject(e=!1){if(!this.isStmRestoring&&this.assigned&&!e){const e=this.getResourceStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return NI([ZR({},yT)],n.prototype,"assigned",void 0),n}))){}var WI=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class UI extends LC{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}}class GI extends $C{static get defaultConfig(){return{modelClass:UI}}}class YI extends ZT{get intervalStoreClass(){return GI}}WI([TT({type:"boolean",defaultValue:!1})],YI.prototype,"unspecifiedTimeIsWorking",void 0);class qI extends ky{constructor(){super(...arguments),this.effort=0,this.units=0}}class KI extends qI{constructor(){super(...arguments),this.inEventTimeSpan=!1}}class XI extends qI{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.inEventTimeSpan=!1,this.assignments=null,this.assignmentIntervals=null}}class ZI extends(qR.mix(ky)){getDefaultAllocationIntervalClass(){return qI}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}}WI([JR()],ZI.prototype,"includeInactiveEvents",void 0),WI([JR()],ZI.prototype,"allocation",void 0);class JI extends ZI{enterGraph(e){super.enterGraph(e)}leaveGraph(e){var t,n;this.eventRangesCalendar&&(null===(n=this.resource)||void 0===n||n.getProject().clearCombinationsWith(this.eventRangesCalendar));super.leaveGraph(e),null===(t=this.resource)||void 0===t||t.entities.delete(this)}getDefaultAllocationIntervalClass(){return XI}*shouldIncludeAssignmentInAllocation(e){const t=yield e.$.event,n=yield this.$.includeInactiveEvents,r=t&&(yield t.$.inactive),i=t&&(yield t.$.startDate),s=t&&(yield t.$.endDate);return Boolean(t&&i&&s&&(n||!r))}*calculateAllocation(){const e=[],t=yield this.ticks,n=yield this.$.resource;yield this.$.includeInactiveEvents;const r=yield n.$.assigned,i=yield n.$.effectiveCalendar,s=new Map,o=[],a=new Map,l=new Map;let c,d,u,h=!1;for(const e of r){if(!(yield*this.shouldIncludeAssignmentInAllocation(e)))continue;yield e.$.units;const t=yield e.$.event,n=yield t.$.ignoreResourceCalendar,r=yield t.$.startDate,i=yield t.$.endDate,c=yield t.$.segments,d=yield t.$.effectiveCalendar;if(h=h||n,c)for(const t of c){const n=yield t.$.startDate,r=yield t.$.endDate;o.push({startDate:n,endDate:r,assignment:e})}else o.push({startDate:r,endDate:i,assignment:e});let u=s.get(d);u||(u=[],s.set(d,u)),a.set(e,new Map),l.set(e,[]),u.push(e)}var g;this.eventRangesCalendar&&(null===(g=this.resource)||void 0===g||g.getProject().clearCombinationsWith(this.eventRangesCalendar));const m=this.eventRangesCalendar=new YI({intervals:o}),p=[t,m,...s.keys()],f=new Map;t.intervalStore.forEach((t=>{const r=XI.new({tick:t,resource:n});f.set(t,r),e.push(r),a.forEach(((e,n)=>{const r=KI.new({tick:t,assignment:n});e.set(t,r),l.get(n).push(r)}))}));const v=e[0].tick.startDate,y=e[e.length-1].tick.endDate,b={startDate:v,endDate:y,calendars:p,includeNonWorkingIntervals:h},C=y.getTime()-v.getTime();if(C>n.getProject().maxCalendarRange&&(b.maxRange=C),yield*n.forEachAvailabilityInterval(b,((e,n,r)=>{const s=r.getCalendarsWorkStatus();if(s.get(t)){const o=r.intervalsByCalendar.get(t)[0],l=n.getTime()-e.getTime(),h=f.get(o),g=h.assignments||new Set,p=h.assignmentIntervals||new Map;if(u&&u!==o){const e=f.get(u);e.isUnderallocated=e.isUnderallocated||e.effort&&e.effort<e.maxEffort}u=o,h.assignments||(c=0,d=0);let v,y=0,b=!1,C=0;r.intervalsByCalendar.get(m).forEach((t=>{const r=t.assignment,l=null==r?void 0:r.event;if(l&&s.get(l.effectiveCalendar)&&(l.ignoreResourceCalendar||s.get(i))){const t=Math.max(e.getTime(),r.event.startDate.getTime()),i=Math.min(n.getTime(),r.event.endDate.getTime());b=!0,v=i-t;const s=a.get(r).get(o),l=v*r.units/100;s.effort+=l,s.units=r.units,s.inEventTimeSpan=!0,C+=l,y+=r.units,g.add(r),p.set(r,s)}})),h.inEventTimeSpan=h.inEventTimeSpan||b,s.get(i)&&(h.maxEffort+=l),y&&(v?(c+=v*y,d+=v,h.units=c/d):c||(h.units=y)),b&&(h.effort+=C,h.assignments=g,h.assignmentIntervals=p,h.isOverallocated=h.isOverallocated||h.effort>h.maxEffort||h.units>100,h.isUnderallocated=h.isUnderallocated||C<l||h.units<100)}})),u){const e=f.get(u);e.isUnderallocated=e.isUnderallocated||e.effort&&e.effort<e.maxEffort}return{owner:this,resource:n,total:e,byAssignments:l}}}WI([JR()],JI.prototype,"resource",void 0),WI([QR("allocation")],JI.prototype,"calculateAllocation",null);class QI extends(Ty([zI],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(e){this.graph.addIdentifier(e),this.observers.add(e)}removeObserver(e){this.graph&&this.graph.removeIdentifier(e),this.observers.delete(e)}addEntity(e){this.graph.addEntity(e),this.entities.add(e)}removeEntity(e){this.graph&&this.graph.removeEntity(e),this.entities.delete(e)}leaveGraph(e){for(const e of this.observers)this.removeObserver(e);for(const e of this.entities)this.removeEntity(e);t.leaveGraph.call(this,e)}*forEachAvailabilityInterval(e,t){const n=this.getProject(),r=yield this.$.effectiveCalendar,i=n.combineCalendars([r].concat(e.calendars||[])),s=n.maxCalendarRange,o=e.includeNonWorkingIntervals;return s&&(e=Object.assign({maxRange:s},e)),i.forEachAvailabilityInterval(e,((e,n,i)=>{const s=i.getCalendarsWorkStatus();if(o||s.get(r))return t(e,n,i)}))}}}))){}class eA extends(HT(oy(QI.derive(sd)))){static get $name(){return"ResourceModel"}get assigned(){var e;const{project:t}=this;return null!=t&&null!==(e=t.assignmentStore.storage._indices)&&void 0!==e&&e.resource?t.assignmentStore.storage.findItem("resource",this)??new Set:super.assigned}set assigned(e){super.assigned=e}}eA._$name="ResourceModel";class tA extends(Ty([Vy,OT],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:zI}}}}))){}class nA extends(HT(iy(tA.derive(ho)))){static get defaultConfig(){return{modelClass:eA}}}nA._$name="ResourceStore";class rA extends ds{static $name="ResourceUtilizationModel";static fields=["name","iconCls"];construct(e,...t){this._childrenIndex=new Map,e.origin&&Object.assign(e,this.mapOriginValues(e.origin)),super.construct(e,...t),this.origin&&!this.generatedParent&&this.fillChildren()}mapOriginValues(e){const t={};if(e.isResourceModel)t.name=e.name;else if(e.isAssignmentModel){var n,r;t.name=null===(n=e.event)||void 0===n?void 0:n.name,t.iconCls=null===(r=e.event)||void 0===r?void 0:r.iconCls}return t}fillChildren(){var e;const t=this,{children:n}=t,r=new Set(n),i=[];if(null!==(e=t.origin)&&void 0!==e&&e.isResourceModel){const{assigned:e}=t.origin;for(const n of e)t._childrenIndex.has(n)?r.delete(t._childrenIndex.get(n)):i.push(t.constructor.new({origin:n}))}r.size&&this.removeChild([...r]),i.length&&this.appendChild(i)}afterRemoveChild(e){e.forEach((e=>this._childrenIndex.delete(e.origin)))}insertChild(...e){let t=super.insertChild(...e);if(t){var n;const{stores:e}=this;if(Array.isArray(t)||(t=[t]),null!==(n=this.origin)&&void 0!==n&&n.isResourceModel)for(const e of t)e.origin&&!this._childrenIndex.has(e.origin)&&this._childrenIndex.set(e.origin,e);if(null!=e&&e.length)for(const n of e)for(const e of t)e.traverse((e=>e.origin&&n.setModelByOrigin(e.origin,e)))}return t}getChildByOrigin(e){return this._childrenIndex.get(e)}}rA.convertEmptyParentToLeaf=!0,rA.exposeProperties(),rA._$name="ResourceUtilizationModel";class iA extends(Fy.derive(ho)){static $name="ResourceUtilizationStore";static configurable={modelClass:rA,project:null,tree:!0};static get properties(){return{_modelByOrigin:new Map}}updateProject(e){this.setResourceStore(null==e?void 0:e.resourceStore),this.setAssignmentStore(null==e?void 0:e.assignmentStore),this.setEventStore(null==e?void 0:e.eventStore),this.fillStoreFromProject()}setResourceStore(e){this.detachListeners("resourceStore"),null==e||e.ion({name:"resourceStore",change:this.onResourceStoreDataChanged,thisObj:this})}setEventStore(e){this.detachListeners("eventStore"),null==e||e.ion({name:"eventStore",update:this.onEventUpdate,thisObj:this})}setAssignmentStore(e){this.detachListeners("assignmentStore"),null==e||e.ion({name:"assignmentStore",change:this.onAssignmentsChange,refresh:this.onAssignmentsRefresh,add:this.onAssignmentsAdd,update:this.onAssignmentUpdate,remove:this.onAssignmentsRemove,thisObj:this})}onResourceStoreDataChanged(e){e.isMove&&"remove"===e.action||this.fillStoreFromProject()}onAssignmentsChange(){this.forEach((e=>e.fillChildren()))}onAssignmentsRefresh(e){"batch"===e.action&&this.forEach((e=>e.fillChildren()))}onAssignmentsAdd({records:e}){e.forEach((e=>{const t=this.getModelByOrigin(null==e?void 0:e.resource);null==t||t.fillChildren()}))}onAssignmentUpdate({record:e,changes:t}){if("resource"in t){const t=this.getModelByOrigin(e),n=this.getModelByOrigin(null==e?void 0:e.resource);t&&n&&n.appendChild(t)}}onAssignmentsRemove({records:e}){this.remove(e.map((e=>this.getModelByOrigin(e))))}onEventUpdate({record:e,changes:t}){if("name"in t)for(const t of e.assigned){this.getModelByOrigin(t).set("name",e.name)}}fillStoreFromProject(){var e;const t=[];null===(e=this._project)||void 0===e||e.resourceStore.forEach((e=>{e.isSpecialRow||t.push(this.modelClass.new({origin:e}))})),this.removeAll(),this.add(t),this.trigger("fillFromProject")}remove(){const e=super.remove(...arguments);return null==e||e.forEach((e=>{this._modelByOrigin.delete(e.origin)})),e}removeAll(){super.removeAll(...arguments),this._modelByOrigin.clear()}getModelByOrigin(e){return this._modelByOrigin.get(e)}setModelByOrigin(e,t){return this._modelByOrigin.set(e,t)}}iA._$name="ResourceUtilizationStore";const sA=(e,t,n)=>e.isSplitEventMixin?new HI({model:e,newData:t,oldData:n}):new oh({model:e,newData:t,oldData:n});class oA extends Bh{static get defaultConfig(){return{makeModelUpdateAction:sA}}}oA._$name="StateTrackingManager";class aA extends(rt(ds)){static get $name(){return"VersionModel"}static fields=[{name:"name",type:"string"},{name:"isAutosave",type:"boolean"},{name:"content",type:"object"},{name:"savedAt",type:"date"}];onBeforeSave(){}get description(){return this.name??this.defaultDescription}get defaultDescription(){return`${this.isAutosave?"Auto-saved":"Saved"} at ${Gt.format(this.savedAt,this.L("L{Versions.versionDateFormat}"))}`}}aA.exposeProperties(),aA._$name="VersionModel";class lA extends(ao.mixin(HT)){static $name="VersionStore";static configurable={modelClass:aA,storeId:"versions"}}lA._$name="VersionStore";class cA extends(rt(ds)){static $name="ChangeLogTransactionModel";static fields=[{name:"versionId"},{name:"actions",type:"array"},{name:"occurredAt",type:"date"},{name:"description",type:"string"}];get description(){return this.get("description")??this.defaultDescription}get actions(){return this.get("actions")??[]}get defaultDescription(){if(0===this.actions.length)return this.L("L{Versions.noChanges}");const e=this,t=H.unique(e.actions.map((({actionType:e})=>e.startsWith("add")?"add":e.startsWith("remove")?"remove":e.startsWith("update")?"update":e))),n=H.unique(e.actions.map((({entity:e})=>e.type))),r=H.unique(e.actions.map((({entity:e})=>`${e.type}.${e.id}`))).length,i=e.L("L{Versions.transactionDescriptions}"),s=e.L("L{Versions.entityNames}"),o=e.L("L{Versions.entityNamesPlural}"),a=n[0],l=n.length>1;return i[t.length>1?"mixed":t[0]].replace("{n}",r).replace("{entities}",r>1?o[l?"other":a]??o.other:s[a]??s.other)}}cA.exposeProperties(),cA._$name="ChangeLogTransactionModel";class dA extends(ao.mixin(HT)){static $name="ChangeLogStore";static configurable={modelClass:cA,storeId:"changelogs"}}dA._$name="ChangeLogStore";var uA=e=>class extends((e||ye).mixin(SC)){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...e){const t=this;super.construct(...e),t.addPrioritizedStore(t.calendarManagerStore),t.addPrioritizedStore(t.assignmentStore),t.addPrioritizedStore(t.dependencyStore),t.addPrioritizedStore(t.resourceStore),t.addPrioritizedStore(t.eventStore),t.timeRangeStore&&t.addPrioritizedStore(t.timeRangeStore),t.resourceTimeRangeStore&&t.addPrioritizedStore(t.resourceTimeRangeStore)}get project(){return this}set project(e){super.project=e}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...e){!this.delayCalculation||this.isDelayingCalculation||this.usingSyncDataOnLoad()||this.scheduleDelayedCalculation(),super.loadCrudManagerData(...e)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,i,!0)}crudStoreHasChanges(e){const t=this.getCrudStore(e);let n;return n=t?super.crudStoreHasChanges(t):this.hasPersistableChanges||super.crudStoreHasChanges(),n}get changes(){let e=super.changes;if(this.trackProjectModelChanges){const t=this.modificationDataToWrite;t&&(e=e||{},e.project=t)}return e}shouldClearRecordFieldChange(e,t,n){return e.isCalendarModel&&"intervals"===t?!e.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}};const hA=(e,t)=>e<t?-1:e>t?1:0;var gA=e=>class extends(e||ye){static get configurable(){return{type:null,weights:null,groupBy:null,groupByThisObj:null,layoutFn:null}}get grouped(){return Boolean(this.groupBy)}getGroupValue(e){let t;if(null!=e.group)t=e.group;else{const{groupBy:n,weights:r,groupByThisObj:i=this}=this,{eventRecord:s}=e;"function"==typeof n?t=n.call(i,s):(t=s.getValue(n),r&&(t=r[t]??1/0)),e.group=t}return t}getEventGroups(e){if(this.grouped){const t=new Set;return e.sort(((e,n)=>{const r=this.getGroupValue(e),i=this.getGroupValue(n);return t.add(r),t.add(i),hA(r,i)})),Array.from(t).sort(hA)}return[]}};class mA extends(kS.mixin(gA)){static get $name(){return"ProHorizontalLayoutStack"}layoutEventsInBands(e,t=!1){return this.getEventGroups(e),super.layoutEventsInBands(e,t)}}mA._$name="ProHorizontalLayoutStack";class pA extends(FS.mixin(gA)){static get $name(){return"ProHorizontalLayoutPack"}layoutEventsInBands(e){const t=this.getEventGroups(e),n=t.length||1,r=this.packEventsInBands(e,((e,r,i,s)=>{const o=s/n,a=(1===n?0:t.indexOf(e.group))/n;e.height=o,e.top=a+i.start/n+r*o,e.inBandHeight=s,e.inBandTop=i.start+r*s}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),r}}pA._$name="ProHorizontalLayoutPack";let fA=0;class vA extends EC{static get $name(){return"CalendarHighlightModel"}static domIdPrefix="calendarhighlight";static generateId(){return++fA}}class yA extends VD{static get $name(){return"CalendarHighlight"}static get configurable(){return{calendar:"event",unhighlightOnDrop:null,collectAvailableResources:null,rangeCls:"b-sch-highlighted-calendar-range",resourceTimeRangeModelClass:vA,inflate:3}}static get pluginConfig(){const e=super.pluginConfig;return e.assign=["highlightEventCalendars","highlightResourceCalendars","unhighlightCalendars"],e}afterConstruct(){super.afterConstruct(),this.client.ion({eventDragStart:"onEventDragStart",eventDragReset:"unhighlightCalendars",eventResizeStart:"onEventResizeStart",eventResizeEnd:"unhighlightCalendars",dragCreateStart:"onDragCreateStart",afterDragCreate:"unhighlightCalendars",thisObj:this})}highlightCalendar(e,t){e=H.asArray(e),t=H.asArray(t),"event"===this.calendar?this.highlightEventCalendars(e,t):this.highlightResourceCalendars(t)}highlightEventCalendars(e,t,n=!0){var r;const i=this,{client:s}=i,{startDate:o,endDate:a}=s;i.disabled||(n&&i.unhighlightCalendars(),e=H.asArray(e),t||(t=e.flatMap((e=>e.$linkedResources))),i.highlight=new Map,t=H.asArray(t),e.forEach((e=>{var n;if(!e.calendar)return;const r=null===(n=e.calendar)||void 0===n?void 0:n.getWorkingTimeRanges(o,a).map((e=>new vA(e)));if(r){for(const e of t)i.highlight.set(e,r),s.currentOrientation.refreshEventsForResource(e,!0,!1);t.length>0&&s.currentOrientation.onRenderDone()}})),null===(r=s.syncSplits)||void 0===r||r.call(s,(r=>r.highlightEventCalendars(e,t,n))))}highlightResourceCalendars(e,t=!0){var n,r;const i=this,{startDate:s,endDate:o,currentOrientation:a}=i.client;if(!i.disabled){t&&i.unhighlightCalendars(),i.highlight=new Map;for(const t of e){var l;const e=null===(l=t.calendar)||void 0===l?void 0:l.getWorkingTimeRanges(s,o).map((e=>new vA(e)));e&&(i.highlight.set(t,e),a.refreshEventsForResource(t,!0,!1))}e.length>0&&a.onRenderDone(),null===(n=(r=i.client).syncSplits)||void 0===n||n.call(r,(n=>n.highlightResourceCalendars(e,t)))}}unhighlightCalendars(){var e,t;const n=this;if(!n.highlight)return;const{currentOrientation:r}=n.client,i=n.highlight.keys();n.highlight=null;for(const e of i)r.refreshEventsForResource(e,!0,!1);r.onRenderDone(),null===(e=(t=n.client).syncSplits)||void 0===e||e.call(t,(e=>e.unhighlightCalendars()))}onEventDragStart({context:e}){var t;if(this.disabled)return;const n=this,{client:r}=n,{eventRecords:i}=e,s=e.availableResources=r.features.eventDrag.constrainDragToResource?[e.resourceRecord]:(null===(t=n.collectAvailableResources)||void 0===t?void 0:t.call(n,{scheduler:r,eventRecords:i}))??r.resourceStore.records;n.highlightCalendar(i,s)}onEventResizeStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}onDragCreateStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}getEventsToRender(e,t){var n;const r=null===(n=this.highlight)||void 0===n?void 0:n.get(e);return r&&t.push(...r),t}onEventDataGenerated(e){const{eventRecord:t}=e;if(t.isCalendarHighlightModel){const{inflate:n}=this;e.fillSize=this.client.isVertical,e.wrapperCls["b-sch-highlighted-calendar-range"]=1,e.children.push({className:"b-sch-event-content",html:t.name,dataset:{taskBarFeature:"content"}}),e.width+=2*n,e.height+=2*n,e.left-=n,e.top-=n,e.eventId=`${this.generateElementId(t)}-resource-${e.resourceRecord.id}`}}updateDisabled(e,t){super.updateDisabled(e,t),e&&this.unhighlightCalendars()}shouldInclude(e){return e.isCalendarHighlightModel}get featureClass(){}}yA._$name="CalendarHighlight",Ed.registerFeature(yA,!1,"SchedulerPro");class bA extends(AD(Ef)){static get $name(){return"CellEdit"}async startEditing(e={}){const t=await super.startEditing(e);return t&&await this.startFeatureTransaction(),t}async finishEditing(){const e=await super.finishEditing();var t;e&&await(null===(t=this.finishFeatureTransaction)||void 0===t?void 0:t.call(this));return e}cancelEditing(e=!1,t){this.rejectFeatureTransaction(),super.cancelEditing(e,t)}}bA._$name="CellEdit",Ed.registerFeature(bA,!0,"SchedulerPro");class CA extends(AD(cw)){static $name="Dependencies";onRequestDragCreate(e){const t=super.onRequestDragCreate(e);return!1!==t&&this.startFeatureTransaction().then(),t}doAfterDependencyDrop(e){const{dependency:t}=e,{taskStore:n,dependencyStore:r}=this.client;t?this.finishFeatureTransaction((()=>{n.includes(t.fromEvent)&&n.includes(t.toEvent)||r.remove(t)})):this.rejectFeatureTransaction(),super.doAfterDependencyDrop(e)}}CA._$name="Dependencies",Ed.registerFeature(CA,!0,"SchedulerPro");class SA extends(AD(uw)){static get $name(){return"DependencyEdit"}static get configurable(){return{showLagField:!0,editorConfig:{items:{activeField:{type:"checkbox",name:"active",label:"L{Active}"}}}}}async editDependency(e){await super.editDependency(e)&&await this.startFeatureTransaction()}afterSave(){this.finishFeatureTransaction().then((()=>{super.afterSave()}))}afterDelete(){this.finishFeatureTransaction().then((()=>{super.afterDelete()}))}afterCancel(){this.rejectFeatureTransaction(),super.afterCancel()}}SA._$name="DependencyEdit",Ed.registerFeature(SA,!1);class DA extends fi{static get $name(){return"EventBuffer"}static get configurable(){return{showDuration:!0,tooltipTemplate:{value:null,$config:"nullify"}}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}updateTooltipTemplate(e){const t=this;var n;e?t.tooltip=lc.new({forElement:t.client.timeAxisSubGridElement,forSelector:".b-sch-event-buffer-before,.b-sch-event-buffer-after",align:{align:"b-t",offset:[0,10]},getHtml({activeTarget:e}){const n=t.client.resolveEventRecord(e),r=e.matches(".b-sch-event-buffer-before"),i=r?n.preamble:n.postamble;return t.tooltipTemplate({eventRecord:n,duration:i,before:r})}}):null===(n=t.tooltip)||void 0===n||n.destroy()}onEventDataGenerated({useEventBuffer:e,bufferBeforeWidth:t,bufferAfterWidth:n,eventRecord:r,wrapperChildren:s}){if(this.enabled&&e){var o,a,l;const{isHorizontal:e}=this.client,{showDuration:c}=this,d=e?"width":"height",u={},h={};let{preamble:g,postamble:m}=r;null===(o=this.renderer)||void 0===o||o.call(this,{eventRecord:r,preambleConfig:u,postambleConfig:h}),null!==(a=g)&&void 0!==a&&a.magnitude||(g=null),null!==(l=m)&&void 0!==l&&l.magnitude||(m=null),s.push({className:{"b-sch-event-buffer":1,"b-sch-event-buffer-before":1,"b-buffer-thin":!t,[u.cls]:u.cls},style:{[`${d}`]:`${t}px`},children:c&&g?[u.icon?{tag:"i",className:u.icon}:i,{tag:"span",className:"b-buffer-label",text:u.text??g.toString(!0)}]:i},{className:{"b-sch-event-buffer":1,"b-sch-event-buffer-after":1,"b-buffer-thin":!n,[h.cls]:h.cls},style:{[`${d}`]:`${n}px`},children:c&&m?[{tag:"span",className:"b-buffer-label",text:h.text??m.toString(!0)},h.icon?{tag:"i",className:h.icon}:i]:i})}}updateShowDuration(){this.isConfiguring||this.client.refreshWithTransition()}doDisable(e){super.doDisable(e);const{client:t}=this;!t.isConfiguring&&t.isPainted&&(t.element.classList.add("b-eventbuffer-transition"),t.refreshWithTransition(),t.waitForAnimations().then((()=>{t.element.classList.remove("b-eventbuffer-transition")})))}}DA._$name="EventBuffer",Ed.registerFeature(DA,!1,"SchedulerPro");class wA extends MD{static $name="EventResize";render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=this.client.eventSelector+":not(.b-sch-event-segment)"}}wA._$name="EventResize",Ed.registerFeature(wA,!0,"SchedulerPro");class EA extends Tu{static $name="EventSegmentDrag";static get defaultConfig(){return{constrainDragToResource:!0}}static get configurable(){return{capitalizedEventName:"EventSegment"}}static get pluginConfig(){return{chain:["onInternalPaint","isEventElementDraggable"]}}getTriggerParams(e){const{assignmentRecords:t,eventRecords:n,resourceRecord:r,browserEvent:i}=e;return{context:e,eventRecords:n,resourceRecord:r,assignmentRecords:t,event:i}}triggerEventDrag(e,t){this.scheduler.trigger("eventSegmentDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate}))}triggerDragStart(e){this.scheduler.navigator.skipNextClick=!0,this.scheduler.trigger("eventSegmentDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventSegmentDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.scheduler.trigger("eventSegmentDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){if(this.scheduler.trigger("afterEventSegmentDrop",Object.assign(this.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=this.client;this.dragData.initialAssignmentsState.find((({resource:n,assignment:r},i)=>{var s;return!e.includes(r)||!t.includes(r.event)||n.id!==(null===(s=this.dragData.assignmentRecords[i])||void 0===s?void 0:s.resourceId)}))&&this.client.refresh()}}async updateRecords(e){const t=this,{client:n}=t;let r;return e.externalDropTarget||(n.eventStore.suspendAutoCommit(),r=await t.updateSegment(n,e,false),n.eventStore.resumeAutoCommit()),n.trigger("eventSegmentDrop",Object.assign(t.getTriggerParams(e),{isCopy:false,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),r}async updateSegment(e,t){const n=this,r="vertical"===e.mode,{eventRecords:i,assignmentRecords:s,timeDiff:o}=t;e.suspendRefresh();let a=!1;r&&i.forEach(((n,r)=>{const i=t.eventBarEls[r];delete n.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const l=t.eventBarEls.slice(),c=t.eventRecord,d=n.adjustStartDate(t.origStart,o);var u;Gt.isEqual(c.startDate,d)||(e.endListeningForBatchedUpdates(),n.cancelBatchUpdate(c),c.startDate=d,a=!0,await e.project.commitAsync(),null===(u=n.endBatchUpdate)||void 0===u||u.call(n,c));e.resumeRefresh(!1),s.length>0&&(a?(e.fillTicks&&l.forEach((e=>delete e.lastDomConfig)),e.refreshWithTransition()):t.valid=!1)}isEventElementDraggable(e,t,n,r){return!(!this.disabled&&(t.isEventSegment||t.segments))||!n.closest(this.drag.targetSelector)}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getMinimalDragData(e){const{client:t}=this,n=this.getElementFromContext(e),r=t.resolveEventRecord(n),i=t.resolveResourceRecord(n),s=t.resolveAssignmentRecord(n);return{eventRecord:r,resourceRecord:i,assignmentRecord:s,eventRecords:[r],assignmentRecords:s?[s]:[]}}beginBatchUpdate(e){e.event.beginBatch(),e.beginBatch()}endBatchUpdate(e){var t;null===(t=e.event)||void 0===t||t.endBatch(),e.endBatch()}cancelBatchUpdate(e){var t;null===(t=e.event)||void 0===t||t.cancelBatch(),e.cancelBatch()}setupProductDragData(e){var t;const n=this,{client:r}=n,i=n.getElementFromContext(e),{eventRecord:s,resourceRecord:o}=n.getMinimalDragData(e),a=[],l=r.getElementsFromEventRecord(s.event,o,!0)[0];if(n.constrainDragToResource&&!o)throw new Error("Resource could not be resolved for event: "+s.id);n.drag.ignoreSamePositionDrop=!r.rtl||s.nextSegment,r.listenToBatchedUpdates||r.beginListeningForBatchedUpdates(),n.beginBatchUpdate(s);const c=null===(t=n.getDateConstraints)||void 0===t?void 0:t.call(n,o,s),d=n.constrainRectangle=n.getConstrainingRectangle(c,o,s),u=wn.from(i,r.foregroundCanvas,!0),h=wn.from(l,r.foregroundCanvas,!0);return d.translate(-h.x),super.setupConstraints(d,u,r.timeAxisViewModel.snapPixelAmount,Boolean(c.start)),a.push(i),{record:s,draggedEntities:[s],dateConstraints:null!=c&&c.start?c:null,eventBarEls:a,mainEventElement:l}}suspendRecordElementRedrawing(){}suspendElementRedrawing(){}getDateConstraints(e,t){let{minDate:n,maxDate:r}=super.getDateConstraints(e,t);return t.previousSegment&&(!n||n<t.previousSegment.endDate)&&(n=t.previousSegment.endDate),t.nextSegment&&(!r||r<t.nextSegment.startDate)&&(r=t.nextSegment.startDate),{start:n,end:r}}get tipId(){return`${this.client.id}-segment-drag-tip`}internalSnapToPosition(e){super.internalSnapToPosition(),this.client.rtl&&!this.dragData.eventRecord.nextSegment&&(e.x=0)}updateDragContext(e,t){super.updateDragContext(...arguments);const{client:n}=this,{dirty:r,eventRecord:i,endDate:s}=this.dragData;if(r&&!i.nextSegment){var o;const{enableEventAnimations:e}=n;n.enableEventAnimations=!1,i.event.set("endDate",s),null!==(o=n.features.eventBuffer)&&void 0!==o&&o.enabled&&(i.event.wrapEndDate=s),n.enableEventAnimations=e}}}EA._$name="EventSegmentDrag",Ed.registerFeature(EA,!0,"SchedulerPro"),Ed.registerFeature(EA,!1,"ResourceHistogram");class xA extends wA{static $name="EventSegmentResize";static get pluginConfig(){return{chain:[...super.pluginConfig.chain,"isEventSegmentElementDraggable"]}}render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=".b-sch-event-segment"}isEventSegmentElementDraggable(e,t,n,r){return this.isEventElementDraggable(...arguments)}isEventElementDraggable(e,t,n,r){const i=this,s=null==t?void 0:t.resizable;if(i.disabled||!s||t.isMilestone)return!0;if(t.segments){const n=i.client.scheduledEventName;return t.segments.every(((t,s)=>{const o=t.resizable,a=To.getChild(e,`${n}.segments.${s}`);return!o||(!0!==o&&"start"!==o||!i.isOverStartHandle(r,a))&&(!0!==o&&"end"!==o||!i.isOverEndHandle(r,a))}))}return super.isEventElementDraggable(...arguments)}get tipId(){return`${this.client.id}-event-segment-resize-tip`}dragStart(e){return this._segmentsSlices=null,this._segmentsSlicesIndex=0,super.dragStart(...arguments)}beginEventRecordBatch(e){super.beginEventRecordBatch(e),e.isEventSegment&&e.event.beginBatch()}triggerBeforeResize(e){const{client:t}=this,n=t.scheduledEventName,r=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}SegmentResize`,{[n+"Record"]:r,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t){const{client:n}=this;n.trigger(`${n.scheduledEventName}SegmentResizeStart`,t)}triggerEventResizeEnd(e,t){const{client:n}=this;n.trigger(`${n.scheduledEventName}SegmentResizeEnd`,t)}triggerEventPartialResize(e,t){const{client:n}=this;n.trigger(`${n.scheduledEventName}SegmentPartialResize`,t)}triggerBeforeEventResizeFinalize(e,t){const{client:n}=this;n.trigger(`before${n.capitalizedEventName}SegmentResizeFinalize`,t)}applyDateConstraints(e,t,n){var r,i;let s=null===(r=n.dateConstraints)||void 0===r?void 0:r.start,o=null===(i=n.dateConstraints)||void 0===i?void 0:i.end;if(t.isEventSegment){const{previousSegment:e,nextSegment:n}=t;e&&(s=s?Gt.max(e.endDate,s):e.endDate),n&&(o=o?Gt.min(n.startDate,o):n.startDate)}return(s||o)&&(e=Gt.constrain(e,s,o),n.snappedDate=Gt.constrain(n.snappedDate,s,o)),e}resizeEventPartiallyInternal(e,t){const{toSet:n}=t;if(super.resizeEventPartiallyInternal(...arguments),e.isEventSegment){const{event:r}=e;if(e.nextSegment||"endDate"!==n)if(e.previousSegment||"startDate"!==n){const e=r.fieldMap.segments;e._skipSegmentsIsEqual++,r.set("segments",r.get("segments")),e._skipSegmentsIsEqual--}else r.set("startDate",t[n]);else r.set("endDate",t[n])}}cancelEventRecordBatch(e){super.cancelEventRecordBatch(e),e.isEventSegment&&e.event.cancelBatch()}highlightHandle(){const{overItem:e}=this;e.classList.add("b-resize-handle","b-over-resize-handle")}unHighlightHandle(e=this.overItem){null==e||e.classList.remove("b-resize-handle",this.resizingItemInnerCls,"b-over-resize-handle",this.draggingItemCls)}}xA._$name="EventSegmentResize",Ed.registerFeature(xA,!0,"SchedulerPro"),Ed.registerFeature(xA,!1,"ResourceHistogram");class RA extends fi{static $name="EventSegments";static configurable={splitDuration:0,maxSplitDuration:{magnitude:1,unit:"day"},minSplitDuration:0};static pluginConfig={override:["getElementsFromEventRecord","resolveEventRecord","resolveTaskRecord","onElementMouseOut"],chain:["populateTaskMenu","populateEventMenu","onTaskDataGenerated","onEventDataGenerated"]};onElementMouseOut(e){const{client:t}=this,{target:n,relatedTarget:r}=e,i=n.closest(t.eventSelector),s=t.resolveTimeSpanRecord(n);null!=s&&s.isEventSegment&&i&&t.hoveredEvents.has(i)&&r&&Br.isDescendant(i,r)||this.overridden.onElementMouseOut(...arguments)}getElementsFromEventRecord(e,t){if(null!=e&&e.isEventSegment){const n=this.overridden.getElementsFromEventRecord(e.event,t)[0];return[To.getChild(n,"segments."+e.segmentIndex)]}return this.overridden.getElementsFromEventRecord(...arguments)}resolveEventRecord(e){var t;const n=e instanceof Event?e.target:e,r=null==n?void 0:n.closest(".b-sch-event-segment");let i=this.overridden.resolveEventRecord(e);return null!==(t=i)&&void 0!==t&&t.segments&&r&&(i=i.segments[r.dataset.segment]),i}resolveTaskRecord(e){var t;const n=null==e?void 0:e.closest(".b-sch-event-segment");let r=this.overridden.resolveTaskRecord(e);return null!==(t=r)&&void 0!==t&&t.segments&&n&&(r=r.segments[n.dataset.segment]),r}populateTaskMenu(e){var t;e.eventRecord=e.taskRecord,null!==(t=e.domEvent)&&void 0!==t&&t.target.closest(e.feature.client.eventInnerSelector)&&this.populateEventMenu(e)}populateEventMenu({eventRecord:e,taskRecord:t,items:n,domEvent:r}){const i=this;if(!(i.client.readOnly||e.isParent||e.milestone||i.disabled)){n["split"+(t?"Task":"Event")]={localeClass:i,text:`L{split${t?"Task":"Event"}}`,icon:"b-icon b-icon-cut",disabled:e.readOnly,weight:650,separator:!0,onItem(e){i.splitEvent(e)}};const s=r.target.closest(".b-sch-event-segment");if(s){const t=i.client.resolveEventRecord(s);n.renameSegment={localeClass:i,text:"L{renameSegment}",icon:"b-icon b-icon-rename",disabled:e.readOnly||t.readOnly,weight:660,onItem(){i.rename(t,s)}}}}}getSplitDate(e){const{eventRecord:t,date:n,timeAxis:r}=e;return r.roundDate(n,t.startDate)}getSplitDuration(e){const{splitDuration:t,minSplitDuration:n,maxSplitDuration:r}=this;if(null!=t&&t.magnitude)return t.magnitude;const{eventRecord:i,tick:s}=e;if(s){const t=this.getSplitDurationUnit(e),{project:o}=i;let a=s.endDate-s.startDate;if(r){const e=o.run("$convertDuration",r.magnitude,r.unit||t,"millisecond");a=Math.min(a,e)}if(n){const e=o.run("$convertDuration",n.magnitude,n.unit||t,"millisecond");a=Math.max(a,e)}return o.run("$convertDuration",a,"millisecond",t)}}getSplitDurationUnit(e){const{splitDuration:t}=this;return(null==t?void 0:t.unit)||e.eventRecord.durationUnit}splitEvent(e){const{client:t}=e.feature,{timeAxis:n}=t;e.date=t.getDateFromXY(e.point,i,!1),e.tick=n.getSnappedTickFromDate(e.date),e.timeAxis=n,e.eventRecord.splitToSegments(this.getSplitDate(e),this.getSplitDuration(e),this.getSplitDurationUnit(e))}rename(e,t){const{client:n}=this;new zm({owner:n,appendTo:n.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-event-segment-renamer",internalListeners:{complete(){n.refresh()},thisObj:this}}).startEdit({target:t,record:e,field:"name"})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}generateSegmentRenderData(e,t){const{client:n}=this;let r,i;if(n.isGantt){const r=n.currentOrientation,s=r.getTaskBox(e),o={taskRecord:e,task:e,row:t.row,children:[]};s&&Object.assign(o,{isTask:!0,top:s.top,left:s.left,width:s.width,height:s.height}),r.internalPopulateTaskRenderData(o,e),i=o}else i=n.generateRenderData(e,t.resourceRecord,!0);if(i){var s;const n=i.eventColor||t.eventColor,o=Br.isNamedColor(n);r={segmentRecord:e,eventContent:i.eventContent||i.taskContent,cls:i.cls||(null===(s=e.cls)||void 0===s?void 0:s.clone())||new Tn,top:t.top,left:i.left-t.left,width:i.width,height:t.height,style:""},n&&!o&&(r.style={"background-color":n},t.eventColor&&t._customColorStyle&&(t.style=t.style.replace(t._customColorStyle,""))),Object.assign(r.cls,{[`b-sch-color-${n}`]:o,"b-sch-color-none":!n,"b-sch-event-segment":!0,"b-first":!e.previousSegment,"b-last":!e.nextSegment},i.cls),Br.isNamedColor(n)?r.cls[`b-sch-color-${n}`]=n:n?(r.style=`background-color:${n};`+r.style,r.cls["b-sch-custom-color"]=1):t.wrapperCls["b-sch-color-none"]=1}return r}appendDOMConfig(e){const t=e.eventRecord||e.taskRecord;if(t.segments&&!this.disabled){const n=e.eventContent||e.taskContent,r=e.children.indexOf(n);r>-1&&e.children.splice(r,1),delete e.eventContent,delete e.taskContent,e.cls["b-segmented"]=!0,e.segments=t.segments.map((t=>this.generateSegmentRenderData(t,e))),e.segmentsDOMConfig=e.segments.map(this.getSegmentDOMConfig.bind(this)),e.children.unshift({syncOptions:{syncIdField:"segment",releaseThreshold:0},className:"b-sch-event-segments",dataset:{taskBarFeature:"segments"},children:e.segmentsDOMConfig})}}getSegmentDOMConfig(e,t){return{className:e.cls,style:{style:e.style,left:e.left,height:e.height,width:e.width,...e.style},dataset:{segment:t},syncOptions:{syncIdField:"taskBarFeature"},children:[e.eventContent]}}onEventDataGenerated(e){this.appendDOMConfig(e)}onTaskDataGenerated(e){this.appendDOMConfig(e)}get featureClass(){}}RA._$name="EventSegments",Ed.registerFeature(RA,!0,"SchedulerPro"),Ed.registerFeature(RA,!0,"Gantt");const TA={border:1,hollow:2};class MA extends(fi.mixin(ZS,mi)){static $name="NestedEvents";static configurable={eventLayout:"pack",barMargin:5,resourceMargin:0,eventHeight:30,headerHeight:20,constrainDragToParent:!1,allowNestingOnDrop:!0,allowDeNestingOnDrop:!0,constrainResizeToParent:!0,maxNesting:1};static pluginConfig={before:["onEventStoreBatchedUpdate"],chain:["getEventsToRender","processEventDrop","processCrossSchedulerEventDrop","beforeEventDragStart","afterEventDragStart","afterEventDragAbortFinalized","checkEventDragValidity","afterEventResizeStart","afterRenderEvent"],override:["getResourceMarginObject","getBarMargin","getAppliedResourceHeight","getResourceWidth","getEventLayout","getElementFromAssignmentRecord","scheduleEvent"]};static delayable={refreshClient:"raf"};construct(e,t){super.construct(e,t),this.client.eventStore.tree=!0}refreshClient(){this.client.refreshWithTransition()}possiblyRefreshClient(){!this.client.isConfiguring&&this.refreshClient()}doDisable(){this.possiblyRefreshClient()}updateEventLayout(e){"stack"===e&&this.client.isVertical&&console.warn("Stacked nested events are not supported in vertical mode"),this.possiblyRefreshClient()}updateBarMargin(){this.possiblyRefreshClient()}updateResourceMargin(){this.possiblyRefreshClient()}changeEventHeight(e){return this._eventHeights=H.asArray(e),e}updateEventHeight(){this.possiblyRefreshClient()}updateHeaderHeight(e){this.client.element.style.setProperty("--schedulerpro-nested-event-header-height",`${e}px`),this.possiblyRefreshClient()}getEventLayout(e,t){return t?{type:this.eventLayout}:this.overridden.getEventLayout(e)}getResourceMarginObject(e,t){if(t&&!t.isRoot){const e=this.resourceMargin;return"number"==typeof e?{start:e,end:e,total:2*e}:(e.total=e.start+e.end,e)}return this.overridden.getResourceMarginObject(e)}getBarMargin(e,t){return t&&!t.isRoot?this.barMargin:this.overridden.getBarMargin(e)}getAppliedResourceHeight(e,t){const n=this;if(t&&!t.isRoot){if("stack"===n.eventLayout){const r=n._eventHeights[t.childLevel],{total:i}=n.getResourceMarginObject(e,t);return r+i}{const r=TA[n.client.getEventStyle(t,e)]??0;return n.currentParentsHeight-n.headerHeight-r}}return n.overridden.getAppliedResourceHeight(e)}getResourceWidth(e,t){return t&&!t.isRoot?this.currentParentsWidth-this.headerHeight:this.overridden.getResourceWidth(e)}attachToEventStore(e){null==e||e.ion({name:"eventStore",change:"onEventStoreChange",thisObj:this})}onEventStoreChange({records:e}){var t;null!==(t=this.client.features)&&void 0!==t&&t.eventDrag.isDragging||null==e||!e.some((e=>e.parent&&!e.parent.isRoot))||this.refreshClient()}onEventStoreBatchedUpdate({records:e}){if(this.client.listenToBatchedUpdates&&null!=e&&e.some((e=>e.parent&&!e.parent.isRoot)))return this.refreshClient(),!1}beforeEventDragStart(e,t){const n=this,{client:r}=n,{eventRecord:i,assignmentRecords:s}=t,{parentElement:o}=e.element;if(i.parent&&o!==r.foregroundCanvas){n.isDraggingNestedEvent=!0,e.originalParentElement=o,e.originalBounds=[];for(const t of s){const{event:s}=t;if(s.parent===i.parent){const i=r.getElementFromAssignmentRecord(t,!0);if(e.originalBounds.push({element:i,bounds:wn.from(i,o)}),!n.constrainDragToParent&&r.features.eventDrag.constrainDragToTimeline){const e=wn.from(i,r.timeAxisSubGridElement);i.style.top=`${e.top}px`,i.style.left=`${e.left}px`,To.addChild(r.foregroundCanvas,i,t.id)}}}}else n.isDraggingNestedEvent=!1}afterEventDragStart(e,t){if(this.isDraggingNestedEvent&&this.constrainDragToParent){const{eventDrag:n}=this.client.features,{parent:r}=t.eventRecord,i=e.originalParentElement.getBoundingClientRect();n.setYConstraint(0,i.height-e.originalBounds[0].bounds.height),n.setXConstraint(0,i.width-e.originalBounds[0].bounds.width),t.dateConstraints={start:r.startDate,end:r.endDate}}}checkEventDragValidity({targetEventRecord:e,eventRecord:t,timeDiff:n,newResource:r,resourceRecord:i}){const s=this;if(s.isDraggingNestedEvent&&!s.allowDeNestingOnDrop&&!e&&(n||r!==i))return{valid:!1,message:s.L("L{deNestingNotAllowed}")};if(!s.allowNestingOnDrop&&e&&e!==t.parent)return{valid:!1,message:s.L("L{nestingNotAllowed}")};if(e&&e!==t.parent){const n=s.maxNesting;if((e.isParent?e.childLevel:e.parent.childLevel)+(Math.max(...t.allChildren.map((e=>e.childLevel)))-t.childLevel)>=n)return{valid:!1,message:s.L("L{nestingNotAllowed}")}}}processEventDrop({context:e,toScheduler:t,eventRecord:n,resourceRecord:r,reassignedFrom:i,element:s,eventsToAdd:o,addedEvents:a,draggedAssignment:l}){const{parent:c}=n,{targetEventRecord:d}=e;let u=c;if(c!==d&&!this.constrainDragToParent){if(d&&this.allowNestingOnDrop){u=d.isParent||d.parent.isRoot?d:d.parent;const t=this.client.resolveResourceRecord(e.browserEvent);t!==r&&(r=l.resource=t)}else u=t.eventStore.rootNode;u&&u!==c&&(a.push(u.appendChild(n)),H.remove(o,n))}if(n.isParent&&i&&i!==r)for(const e of n.allChildren){const t=e.assignments.find((e=>e.resource===i));t&&(t.resource=r)}if(u&&!u.isRoot){const t=this.client.getElementFromEventRecord(u,r).syncIdMap.nestedEventsContainer;if(t){const n=wn.from(t,this.client.foregroundCanvas),r=wn.from(s,t);e.context.elementStartX-=n.x,e.context.elementStartY-=n.y,s.style.top=`${r.top}px`,s.style.left=`${r.left}px`,s.lastDomConfig=null,To.addChild(t,s,s.dataset.syncId)}}}processCrossSchedulerEventDrop({eventRecord:e}){if(e.isParent)for(const t of e.allChildren)t.resource=e.resource}async afterEventDragAbortFinalized({originalParentElement:e,originalBounds:t}){if(this.isDraggingNestedEvent){for(const e of t[0].element.getAnimations())"top"!==e.transitionProperty&&"left"!==e.transitionProperty||await e.finished;for(const{element:n,bounds:r}of t)n.style.top=`${r.top}px`,n.style.left=`${r.left}px`,e.appendChild(n)}}afterEventResizeStart(e){if(this.constrainResizeToParent){const{parent:t}=e.timespanRecord;if(t&&!t.isRoot){let{startDate:n,endDate:r}=t;e.dateConstraints&&(n=Gt.max(n,e.dateConstraints.start),r=Gt.min(r,e.dateConstraints.end)),e.dateConstraints={start:n,end:r}}}}getElementFromAssignmentRecord(e,t){var n;if(null!=e&&null!==(n=e.event)&&void 0!==n&&n.parent&&!e.event.parent.isRoot){const n=this.client.getElementFromEventRecord(e.event.parent,e.resource);return n&&To.getChild(n,`nestedEventsContainer.${e.id}${t?"":".event"}`)}return this.overridden.getElementFromAssignmentRecord(e,t)}async scheduleEvent({eventRecord:e,parentEventRecord:t,startDate:n,element:r}){if(!t)return this.overridden.scheduleEvent(...arguments);if(e.startDate=n,(e=t.appendChild(e)).assign(t.resource),r){const n=this.client.getElementFromEventRecord(t).syncIdMap.nestedEventsContainer,i=wn.from(r,n);Br.setTranslateXY(r,0,0),Br.setTopLeft(r,i.y,i.x),To.addChild(n,r,e.assignments[0].id)}await this.client.project.commitAsync()}getEventsToRender(e,t){return this.disabled||H.remove(t,...t.filter((e=>e.isEventModel&&!e.parent.isRoot))),t}afterRenderEvent({renderData:e}){const{eventRecord:t}=e,{childLevel:n}=t;if(t.isParent){const r=this,{resourceRecord:i,width:s,height:o,left:a,top:l,wrapperCls:c}=e;c.add("b-nested-events-parent"),r.currentParentsHeight=o,r.currentParentsWidth=s;const{currentOrientation:d,isVertical:u}=r.client,h=t.children.filter((e=>{var t;return null===(t=e.$linkedResources)||void 0===t?void 0:t.includes(i)})),g=d.layoutEvents(i,h,{viewport:!0},t,r.overlappingEventSorter),m=[];let p;if(u){p=[];for(const e of Object.values(g))p.push(e.renderData)}else p=null==g?void 0:g.eventsData;if(p)for(const s of p){u?(s.left-=a,s.top-=l,s.absoluteTop=s.top):("none"===r.eventLayout?(s.top=0,s.height=r.getAppliedResourceHeight(i,t)):"stack"===r.eventLayout&&(s.height=r._eventHeights[n]),s.absoluteLeft=s.left,s.left-=e.absoluteLeft??a,s.absoluteTop=s.top);const c=d.renderEvent(u?{renderData:s}:s,o);c.className["b-nested-event"]=1,m.push(c)}const f={className:{"b-nested-events-container":1,[`b-nested-events-layout-${r.eventLayout}`]:1},dataset:{taskBarFeature:"nestedEventsContainer"},children:m,syncOptions:{syncIdField:"syncId",releaseThreshold:0}},{children:v}=e,y=v.findIndex((e=>"nestedEventsContainer"===e.dataset.taskBarFeature));-1===y?v.push(f):v.splice(y,1,f)}e.elementConfig.dataset.level=n}}function kA(e){return"b-task-percent-bar"+(e[0]?`-${e[0]}`:"")}MA._$name="NestedEvents",Ed.registerFeature(MA,!1,"SchedulerPro");class IA extends(fi.mixin(AD,kD)){static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0,instantUpdate:!0,valueField:"percentDone",displayField:"renderedPercentDone"}}static get pluginConfig(){return{chain:["onInternalPaint",{fn:"onTaskDataGenerated",prio:-1e4},{fn:"onEventDataGenerated",prio:-1e4}]}}get project(){return this.client.project}onInternalPaint({firstPaint:e}){if(e){const e=this,{client:t}=e;e.drag=new Hc({name:"percentBarHandle",lockX:t.isVertical,lockY:t.isHorizontal,targetSelector:`${t.eventSelector} .b-task-percent-bar-handle`,dragThreshold:1,outerElement:t.timeAxisSubGridElement,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:e}}),e.detachListeners("view"),e.client.ion({name:"view",[`${t.scheduledEventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.scheduledEventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:e})}}get sizeProp(){return this.client.isVertical?"height":"width"}get offsetSizeProp(){return this.client.isVertical?"offsetHeight":"offsetWidth"}get positionProp(){return this.client.isVertical?"top":this.client.rtl?"right":"left"}get offsetPositionProp(){return this.client.isVertical?"offsetTop":this.client.rtl?"offsetRight":"offsetLeft"}updateAllowResize(e){this.client.element.classList.toggle(kA`drag-disabled`,!e)}updateShowPercentage(e){this.client.element.classList.toggle(kA`show-percentage`,Boolean(e))}doDestroy(){var e;null===(e=this.drag)||void 0===e||e.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}reset(e){const t=this,{client:n}=t,{project:r}=n;n.element.classList.remove(kA`resizing-task`),t.isMouseInsideEvent||(t.handle.remove(),t.handle=null),n.transactionalFeaturesEnabled&&(e.valid?t.finishFeatureTransaction():t.rejectFeatureTransaction()),t.instantUpdate&&(r.resumeAutoSync(),n.eventStore.resumeAutoCommit())}getPercentBarDOMConfig(e){return{className:kA`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:kA``,dataset:{percent:e.getValue(this.displayField)},style:{[this.sizeProp]:e.getValue(this.valueField)+"%"}}]}}appendDOMConfig(e,t,n){if((e.isEvent||e.isTask)&&!e.isMilestone&&!this.disabled){const{eventSegments:r}=this.client.features;e.isSegmented&&null!=r&&r.enabled?e.segments.forEach(((e,t)=>{n.segmentsDOMConfig[t].children.unshift(this.getPercentBarDOMConfig(e))})):t.unshift(this.getPercentBarDOMConfig(e))}}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children,e)}onTaskDataGenerated(e){this.appendDOMConfig(e.taskRecord,e.children,e)}getHoverSegment(e){const t=(e.toElement||e.target).closest(".b-sch-event-segment");if(t){const n=wn.from(t);if(null!=n&&n.contains(Zn.getPagePoint(e)))return t}}isOverSegment(e){return Boolean(this.getHoverSegment(e))}onTimeSpanMouseEnter(e){const t=this,{client:n,sizeProp:r}=t,i=e[`${n.scheduledEventName}Record`];if(!(i.isMilestone||i.readOnly||t.disabled)&&i.isEditable(t.valueField))if(t.drag.context)i===t.drag.context.taskRecord&&(t.isMouseInsideEvent=!0);else{const s=e[`${n.scheduledEventName}Element`],o=To.getChild(s,n.scheduledEventName);if(!t.handle){const e={percent:i.getValue(t.valueField)};let s=i.getValue(t.valueField)+"%";const{eventSegments:a}=n.features;if(i.isSegmented&&null!=a&&a.enabled){e.segment=0;const a=wn.from(o);let l,c;i.segments.some(((n,r)=>{if(!n[t.valueField]&&100!==l)return!0;l=n[t.valueField],e.segment=r;const i=To.getChild(o,`segments.${r}.percentBar`).firstChild;c=wn.from(i)})),s=n.isVertical?c?c.top+c[r]-a.top:0:n.rtl?c?c.right+c[r]-a.right:0:c?c.left+c[r]-a.left:0}t.handle=Br.createElement({parent:o,className:kA`handle`,style:{[t.positionProp]:s},dataset:e})}t.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(e){const t=this;!t.drag.context&&t.handle&&e.event.toElement!==t.handle&&(t.handle.remove(),t.handle=null),t.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:t,event:n}){const{client:r,offsetPositionProp:i,offsetSizeProp:s}=this,{eventSegments:o}=r.features,{element:a}=t,l=r.resolveEventRecord(a);let c,d,u,h;if(l.isSegmented&&null!=o&&o.enabled){const e=a.dataset.segment;c=To.getChild(a.parentElement,`segments.${e}.percentBar`),d=c.firstElementChild,h=a.parentElement[s],u=To.getChild(a.parentElement,`segments.${e}`)[i]+d[s]}else c=To.getChild(a.parentElement,"percentBar"),d=c.firstElementChild,h=c[s],u=d[s];r.isVertical?(e.minY=-u,e.maxY=h-u):r.rtl?(e.maxX=u,e.minX=-(h-u)):(e.minX=-u,e.maxX=h-u),Object.assign(t,{percentBar:d,initialPos:u,size:h,taskRecord:l,initialValue:l.getValue(this.valueField),domEvent:n})}async onDragStart({context:e,event:t}){const n=this,{client:r}=n,{project:i}=r;r.element.classList.add(kA`resizing-task`),e.element.retainElement=!0,e.domEvent=t,r.trigger("percentBarDragStart",e),r.transactionalFeaturesEnabled?await n.startFeatureTransaction():n.captureStm(!0),n.instantUpdate&&(i.suspendAutoSync(),r.eventStore.suspendAutoCommit())}onDrag({context:e,event:t}){const n=this,{sizeProp:r,offsetSizeProp:i,client:s}=n,o=s.isHorizontal?Math.round((e.initialPos+e.newX*(s.rtl?-1:1))/e.size*100):Math.round((e.initialPos+e.newY)/e.size*100),{eventSegments:a}=s.features;n.instantUpdate&&e.taskRecord.set(n.valueField,o),e.domEvent=t,e.percent=e.element.dataset.percent=o,e.taskRecord.isSegmented&&null!=a&&a.enabled&&e.taskRecord.segments.forEach(((t,n)=>{const s=To.getChild(e.element.parentElement,`segments.${n}.percentBar`).firstChild,a=To.getChild(e.element.parentElement,`segments.${n}`);if(e.percent>=t.endPercentDone)s.style[r]=a[i]+"px";else if(e.percent<=t.startPercentDone)s.style[r]="0";else if(e.percent>=t.startPercentDone&&e.percent<=t.endPercentDone){const e=t.endPercentDone-t.startPercentDone;s.style[r]=(o-t.startPercentDone)*a[i]/e+"px"}})),s.trigger("percentBarDrag",e)}onDragAbort({context:e,event:t}){e.taskRecord.isSegmented&&(e.percentBar.style[this.sizeProp]=e.taskRecord.segments[e.element.dataset.segment][this.valueField]+"%"),e.taskRecord.set(this.valueField,e.initialValue),e.domEvent=t,this.client.transactionalFeaturesEnabled||this.freeStm(!1),this.reset(e),this.client.trigger("percentBarDragAbort",e)}async onDrop({context:e}){const t=this,{taskRecord:n}=e,{eventSegments:r}=t.client.features;n.set(t.valueField,e.percent),n.isSegmented&&null!=r&&r.enabled?n.segments.some(((n,r)=>{if(e.percent>=n.startPercentDone&&e.percent<=n.endPercentDone){const i=n.endPercentDone-n.startPercentDone,s=To.getChild(e.element.parentElement,`segments.${r}`),o=parseInt(s.style[t.sizeProp])+(e.percent-n.startPercentDone)*s[t.offsetSizeProp]/i;return e.element.style.cssText=`${t.positionProp}: ${o}px`,e.element.dataset.segment=r,!0}})):e.element.style.cssText=`${t.positionProp}: ${t.client.rtl?100-e.percent:e.percent}%`,await this.project.commitAsync(),t.client.transactionalFeaturesEnabled||this.freeStm(!0),t.reset(e),t.client.trigger("percentBarDrop",e)}get featureClass(){}}IA._$name="PercentBar",Ed.registerFeature(IA,!1,"SchedulerPro"),Ed.registerFeature(IA,!0,"Gantt");class AA extends VD{static $name="ResourceNonWorkingTime";static configurable={rangeCls:"b-sch-resourcenonworkingtime",maxTimeAxisUnit:"hour",enableMouseEvents:!1,resourceTimeRangeModelClass:EC,entityName:"resourceNonWorkingTime"};static get properties(){return{resourceMap:new Map}}construct(){super.construct(...arguments),this.resourceTimeRangeModelClass=class extends this.resourceTimeRangeModelClass{static $name="ResourceNonWorkingTimeModel";static domIdPrefix="resourcenonworkingtimemodel"},this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),null==e||e.ion({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:t,record:n,changes:r}){const i=this;if("update"===e){var s;const e=r.calendar;!e||"string"==typeof e.oldValue&&(null===(s=e.value)||void 0===s?void 0:s.id)===e.oldValue||(i.resourceMap.delete(n.id),i.client.runWithTransition((()=>{i.client.currentOrientation.refreshEventsForResource(n)})))}"remove"===e&&t.forEach((e=>i.resourceMap.delete(e.id))),"removeall"===e&&i.resourceMap.clear()}onCalendarChange({action:e,records:t,record:n,changes:r}){this.resourceMap.clear(),this.client.refresh()}getEventsToRender(e,t){const n=this,{resourceMap:r,client:i}=n,{timeAxis:s}=i,o=!n.maxTimeAxisUnit||Gt.compareUnits(s.unit,n.maxTimeAxisUnit)<=0;if(!n.disabled&&o&&e.effectiveCalendar){if(!r.has(e.id)){const t=e.effectiveCalendar.getNonWorkingTimeRanges(i.startDate,i.endDate).map(((t,r)=>new n.resourceTimeRangeModelClass({id:`r${e.id}i${r}`,iconCls:t.iconCls||e.effectiveCalendar.iconCls||"",cls:`${e.effectiveCalendar.cls||""} ${t.cls||""}`,startDate:t.startDate,endDate:t.endDate,name:t.name||"",resourceId:e.id,isNonWorking:!0})));r.set(e.id,t)}t.push(...r.get(e.id))}return t}shouldInclude({isNonWorking:e}){return e}resolveResourceNonWorkingTimeInterval(e){var t;return null==e||null===(t=e.closest(".b-sch-resourcenonworkingtime"))||void 0===t?void 0:t.elementData.eventRecord}}AA.featureClass="",AA._$name="ResourceNonWorkingTime",Ed.registerFeature(AA,!1,"SchedulerPro");var FA=e=>class extends(e||Ge(ye)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}};qe.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ConstraintTypePicker:{none:"None",assoonaspossible:"As soon as possible",aslateaspossible:"As late as possible",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},SchedulingDirectionPicker:{Forward:"Forward",Backward:"Backward",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",calculateMask:"Calculating...",saveError:"Can't save, please correct errors first",repeatingInfo:"Viewing a repeating event",editRepeating:"Edit"},TaskEdit:{"Edit task":"Edit task",ConfirmDeletionTitle:"Confirm deletion",ConfirmDeletionMessage:"Are you sure you want to delete the event?"},GanttTaskEditor:{editorWidth:"44em"},SchedulerTaskEditor:{editorWidth:"34em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Preamble:"Preamble",Postamble:"Postamble"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar","Scheduling direction":"Scheduling direction",projectBorder:"Project border",ignore:"Ignore",honor:"Honor",askUser:"Ask user"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:e})=>`${e}%`,Resources:"Resources",Resource:"Resource",Units:"Units"},RecurrenceTab:{title:"Repeat"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:'<b>{resource}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',barTipOnDate:'<b>{resource}</b> on {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',groupBarTipAssignment:'<b>{resource}</b> - <span class="{cls}">{allocated} of {available}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more"},ResourceUtilization:{barTipInRange:'<b>{event}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated}</span> allocated',barTipOnDate:'<b>{event}</b> on {startDate}<br><span class="{cls}">{allocated}</span> allocated',groupBarTipAssignment:'<b>{event}</b> - <span class="{cls}">{allocated}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more",nameColumnText:"Resource / Event"},SchedulingIssueResolutionPopup:{"Cancel changes":"Cancel the change and do nothing",schedulingConflict:"Scheduling conflict",emptyCalendar:"Calendar configuration error",cycle:"Scheduling cycle",Apply:"Apply"},CycleResolutionPopup:{dependencyLabel:"Please select a dependency:",invalidDependencyLabel:"There are invalid dependencies involved that need to be addressed:"},DependencyEdit:{Active:"Active"},SchedulerProBase:{propagating:"Calculating project",storePopulation:"Loading data",finalizing:"Finalizing results"},EventSegments:{splitEvent:"Split event",renameSegment:"Rename"},NestedEvents:{deNestingNotAllowed:"De-nesting not allowed",nestingNotAllowed:"Nesting not allowed"},VersionGrid:{compare:"Compare",description:"Description",occurredAt:"Occurred At",rename:"Rename",restore:"Restore",stopComparing:"Stop Comparing"},Versions:{entityNames:{TaskModel:"task",AssignmentModel:"assignment",DependencyModel:"link",ProjectModel:"project",ResourceModel:"resource",other:"object"},entityNamesPlural:{TaskModel:"tasks",AssignmentModel:"assignments",DependencyModel:"links",ProjectModel:"projects",ResourceModel:"resources",other:"objects"},transactionDescriptions:{update:"Changed {n} {entities}",add:"Added {n} {entities}",remove:"Removed {n} {entities}",move:"Moved {n} {entities}",mixed:"Changed {n} {entities}"},addEntity:"Added {type} **{name}**",removeEntity:"Removed {type} **{name}**",updateEntity:"Changed {type} **{name}**",moveEntity:"Moved {type} **{name}** from {from} to {to}",addDependency:"Added link from **{from}** to **{to}**",removeDependency:"Removed link from **{from}** to **{to}**",updateDependency:"Edited link from **{from}** to **{to}**",addAssignment:"Assigned **{resource}** to **{event}**",removeAssignment:"Removed assignment of **{resource}** from **{event}**",updateAssignment:"Edited assignment of **{resource}** to **{event}**",noChanges:"No changes",nullValue:"none",versionDateFormat:"M/D/YYYY h:mm a",undid:"Undid changes",redid:"Redid changes",editedTask:"Edited task properties",deletedTask:"Deleted a task",movedTask:"Moved a task",movedTasks:"Moved tasks"}});class PA extends(ic.mixin(FA)){static get $name(){return"TaskEditorBase"}static get type(){return"taskeditorbase"}static get configurable(){return{localizableProperties:["width"],title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,layout:"fit",draggable:{handleSelector:":not(button,.b-field-inner)"},items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-blue",cls:"b-raised",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}},strips:{occurrenceInfoToolbar:{cls:"occurrence-info-toolbar",hidden:!0,ignoreParentReadOnly:!0,items:[{type:"widget",tag:"i",cls:"b-icon b-icon-locked"},{ref:"occurrenceInfoText",type:"label",localeClass:this,text:"L{repeatingInfo}"},"->",{ref:"editOccurrenceButton",localeClass:this,text:"L{editRepeating}",onClick:"up.onEditOccurrenceClick"}]}},width:{$config:{localeKey:"L{editorWidth}"}},maximizeOnMobile:!0,includeAsapAlapAsConstraints:!0}}static get defaultConfig(){return{axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,blurAction:"cancel",scrollAction:"realign",durationDisplayPrecision:1,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null,dependencyIdField:null}}processWidgetConfig(e){var t;if(null!==(t=e.type)&&void 0!==t&&t.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"tabs"===e.ref&&this.extraItems){const t={};for(const e in this.extraItems){t[e.replace("tab","Tab")]={items:Array.isArray(this.extraItems[e])?Xt.transformArrayToNamedObject(this.extraItems[e]):this.extraItems[e]}}Xt.merge(e.items,t)}return e}changeItems(e){var t;const{tabPanelItems:n={}}=this,r=Xt.clone(e),i=(null===(t=r.find)||void 0===t?void 0:t.call(r,(e=>"tabs"===e.ref)))||r.tabs;return this.cleanItemsConfig(n),Xt.merge(i.items,n),super.changeItems(r)}cleanItemsConfig(e){for(const t in e){const n=e[t];!0===n?delete e[t]:null!=n&&n.items&&this.cleanItemsConfig(n.items)}}afterConfigure(){var e;const t=this,{widgetMap:n}=t,{tabs:r}=n,{cancelButton:i,deleteButton:s,saveButton:o}=(null===(e=t.bbar)||void 0===e?void 0:e.widgetMap)||{};null==o||o.ion({click:"onSaveClick",thisObj:t}),null==i||i.ion({click:"onCancelClick",thisObj:t}),null==s||s.ion({click:"onDeleteClick",thisObj:t}),Object.values(n).forEach((e=>{e.isDurationField?e.decimalPrecision=this.durationDisplayPrecision:"startDate"===e.ref||"endDate"===e.ref?e.project=this.project:"predecessorsTab"!==e.ref&&"successorsTab"!==e.ref||(e.grid.durationDisplayPrecision=this.durationDisplayPrecision,e.dependencyIdField=e.dependencyIdField||t.dependencyIdField),e.isReadyStatePropagator&&e.ion({readyStateChange:"onReadyStateChange",thisObj:t})})),r.onFieldChange=({source:e})=>{const{name:n,isValid:r,value:i}=e;t.loadedRecord&&n&&r&&!t.isLoadingEvent&&!e.up("recurrenceeditorpanel")&&t.loadedRecord.setValue(n,i)}}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach((t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)})),e}async hide(){const e=this;e.detachListeners("project"),e.detachListeners("eventStore"),e._delayedAction=null;const t=await super.hide(this.element.matches(":focus-within"));return e.isDestroyed||e.trigger(e.blurAction),t}toggleFieldsDisabled(e){this.eachWidget((t=>{if(t.isField&&t.name&&!t.disabled&&!t.up("recurrenceeditorpanel")){const n=e.isEditable(t.name);n!==i&&(t.disabled=!n)}}))}loadEvent(e,t=!1){const n=this,r=n.project??e.project;n.isLoadingEvent=!0,n.includeAsapAlapAsConstraints=r.includeAsapAlapAsConstraints,n.widgetMap.occurrenceInfoToolbar.hidden=!e.isOccurrence&&!e.isRecurring||n.editingRecurring,n.toggleFieldsDisabled(e),n.callWidgetHook("loadEvent",e,t),n.detachListeners("project"),n.loadedRecord=e,r.ion({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:n}),n.detachListeners("eventStore"),r.eventStore.ion({name:"eventStore",remove:"onTaskRemove",thisObj:n}),n.isLoadingEvent=!1,n.trigger("loadEvent")}callWidgetHook(e,...t){this.eachWidget((n=>{"function"==typeof n[e]&&n[e](...t)}))}onDocumentMouseDown(e){const t=this;let n=null;if(Object.values(t.widgetMap).some((e=>e._activeCellEdit))){const{event:r}=e,{saveButton:i,cancelButton:s,deleteButton:o}=t.widgetMap,a=r.target.closest("button");if(a)switch(a){case null==i?void 0:i.element:n=t.onSaveClick;break;case null==s?void 0:s.element:n=t.onCancelClick;break;case null==o?void 0:o.element:n=t.onDeleteClick}}t._delayedAction=n,super.onDocumentMouseDown(e)}onSaveClick(){const e=this;e._delayedAction=null,e.canSave?e.trigger("save"):$d.show({rootElement:e.rootElement,html:e.L("L{saveError}")})}onCancelClick(){this.close()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.tab.element.classList.remove("b-invalid"),e.tab.icon=null,e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.tab.element.classList.add("b-invalid"),e.tab.icon="b-icon-warning",e.title=e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){var t;const n=this;n.calculateMask&&n.unmask(),e.has(n.loadedRecord)&&n.callWidgetHook("afterProjectChange"),null===(t=n._delayedAction)||void 0===t||t.call(n)}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.loadedRecord=i,this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.loadedRecord=i,this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.loadedRecord=i,this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if(!e.handled&&"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()){if(e.target.matches("input")){const t=ba.fromElement(e.target);null==t||!t.internalOnChange||t.isCheckbox||t.isSlider||t.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onEditOccurrenceClick(){const e=this;ba.create({type:"recurrenceconfirmation",owner:e}).confirm({actionType:"update",eventRecord:e.loadedRecord,changerFn:t=>{const n=t.recurringTimeSpan??t;e.resetRecurrenceData={recurringTimeSpan:n,originalExceptionDates:{...n.exceptionDates}},t.isRecurring||(t.convertToRealEvent({startDate:t.startDate}),t.constraintDate=null)},finalizerFn:t=>{t.isRecurring&&(e.editingRecurring=!0,e.readOnly=!1),e.loadEvent(t)}})}updateReadOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r,tabs:i}=this.widgetMap,{items:s}=i;super.updateReadOnly(e),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e);for(let t=0,{length:n}=s;t<n;t++)s[t].readOnly=e}updateIncludeAsapAlapAsConstraints(){this.eachWidget((e=>{e.includeAsapAlapAsConstraints=this.includeAsapAlapAsConstraints}))}}PA.initClass(),PA._$name="TaskEditorBase";var OA=e=>class extends(e||Fa){get project(){var e,t;return(null===(e=this.up((e=>e.isTaskEditorBase)))||void 0===e?void 0:e.project)??(null===(t=this.record)||void 0===t?void 0:t.project)}loadEvent(e,t){this.setRecord(e,t)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}};class LA extends(Fa.mixin(OA,FA)){static get $name(){return"EditorTab"}static get type(){return"editortab"}static get configurable(){return{title:null,strictRecordMapping:!0}}}LA._$name="EditorTab";class $A extends LA{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},scrollable:{overflowY:!0},autoUpdateRecord:!0}}onFieldChange({source:e,valid:t,userAction:n}){n&&(t=t!==i?t:"function"==typeof e.isValid?e.isValid():e.isValid)&&super.onFieldChange(...arguments)}}$A.initClass(),$A._$name="FormTab";const _A=new Date(2300,0,1);class jA extends Om{static $name="StartDateField";static type="startdatefield";static alias="startdate";static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0,minDateDelta:"-10 years",maxDateDelta:"200 years"}}get calendarProvider(){var e;return((null===(e=this.eventRecord)||void 0===e?void 0:e.recurringEvent)??this.eventRecord)||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!0),t}transformTimeValue(e){const{calendarProvider:t,keepTime:n}=this;if(t&&"entered"!==n&&!0!==n){const n=Gt.clearTime(e),r=t.run("skipNonWorkingTime",n);if(Gt.isValidDate(r)&&Gt.isEqual(r,n,"day"))return Gt.copyTimeValues(n,r)}return super.transformTimeValue(e)}get min(){var e;return super.min||(null!==(e=this.project)&&void 0!==e&&e.startDate?Gt.add(this.project.startDate,this.minDateDelta):null)}set min(e){super.min=e}get max(){var e;return super.max||(null!==(e=this.project)&&void 0!==e&&e.startDate?Gt.add(this.project.startDate,this.maxDateDelta):_A)}set max(e){super.max=e}}jA.initClass(),jA._$name="StartDateField";const BA=new Date(2300,0,1);class VA extends Om{static $name="EndDateField";static type="enddatefield";static alias="enddate";static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get min(){var e;let t=this._min;const n=null===(e=this.eventRecord)||void 0===e?void 0:e.startDate;return n&&(t=Gt.max(t||n,n)),t}set min(e){super.min=e}get max(){var e;return super.max||null!==(e=this.project)&&void 0!==e&&e.startDate?Gt.add(this.project.startDate,200,"year"):BA}set max(e){super.max=e}get calendarProvider(){var e;return((null===(e=this.eventRecord)||void 0===e?void 0:e.recurringEvent)??this.eventRecord)||this.project}get backShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!1),t}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:t,keepTime:n}=this;if(t&&"entered"!==n&&!0!==n){const n=Gt.clearTime(e),r=Gt.add(n,1,"day"),i=t.run("skipNonWorkingTime",r,!1);if(Gt.isValidDate(i)&&Gt.isEqual(i,n,"day"))return Gt.copyTimeValues(n,i)}return!n&&e&&this.min&&Gt.clearTime(e,!1)<this.min?this.min:super.transformTimeValue(e)}}VA.initClass(),VA._$name="EndDateField";class HA extends Hm{static $name="EffortField";static type="effort";static alias="effortfield"}HA.initClass(),HA._$name="EffortField";class NA extends $A{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-half-width",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",cls:"b-half-width"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-half-width"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date b-half-width"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:800,label:"L{SchedulerBase.color}",name:"eventColor",cls:"b-half-width"}}}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{startDate:n,endDate:r,effort:i}=this.widgetMap;n&&(n.step=t,n.eventRecord=e),r&&(r.step=t,r.eventRecord=e),i&&(i.unit=e.effortUnit),super.loadEvent(e)}}NA.initClass(),NA._$name="GeneralTab";const zA=e=>e.map(((e,t)=>[t,e]));class WA extends Mc{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),Xe.ion({locale:()=>{this.items=zA(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=zA(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}}WA.initClass(),WA._$name="DependencyTypePicker";const UA=(e,t)=>{e.instanceMeta(t).valid=!0},GA=(e,t)=>!1!==e.instanceMeta(t).valid;class YA extends LA{static get $name(){return"DependencyTab"}static get type(){return"dependencytab"}static get configurable(){return{dependencyIdField:null,layoutStyle:{flexFlow:"column nowrap"},sortField:null,taskComboSortField:"name",items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",asyncEventSuffix:"PreCommit",disableGridRowModelWarning:!0,features:{group:!1,cellEdit:{validateTapOut(e,t){const{target:n}=e,{grid:r}=this,i=r.up((e=>e.isTaskEditorBase)),{inputField:s}=t.editor,o=s.L("L{DependencyTab.invalidDependency}"),{direction:a}=r.parent;if(t.column.field===a&&(s.value?s.clearError(o):s.setError(o)),!s.isValid){if(r.owner.widgetMap.remove.element.contains(n)||i.widgetMap.deleteButton.element.contains(n)||i.widgetMap.cancelButton.element.contains(n))return"cancel";n.closest("button")&&(e.preventDefault(),Zn.on({element:n,thisObj:r,click:e=>e.stopImmediatePropagation(),capture:!0,expires:500,once:!0}))}}}},columns:{data:{id:{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,sortable(e,t){var n,r;const{dependencyIdField:i,direction:s}=this.grid.parent,o=null===(n=e[s])||void 0===n?void 0:n[i],a=null===(r=t[s])||void 0===r?void 0:r[i];return o===a?0:o<a?-1:1},renderer:({record:e,row:t,grid:n,column:r})=>{let i;const{direction:s}=n.parent,o=e[s];if(o&&GA(e,n)){const e=n.parent.dependencyIdField,t=o[e];i="id"===e?!o||o.hasGeneratedId?"*":o.id:t}else t.addCls("b-invalid"),i='<div class="b-icon b-icon-warning"></div>';return i}},name:{localeClass:this,text:"L{Name}",flex:5,renderer:({value:e,grid:t,cellElement:n})=>{if(e){n.classList.toggle("b-inactive",e.inactive);const r=e[t.parent.dependencyIdField];return e.name+(null==r||e.hasGeneratedId?"":` (${r})`)}return""},finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",displayField:"name",valueField:"id",filterOperator:"*",allowInvalid:!0,listItemTpl(e){const t=this,n=t._dependencyTab||(t._dependencyTab=t.up("dependencytab",!0)),{dependencyIdField:r}=n,i=e.hasGeneratedId&&"id"===r?null:e[r];return $.xss`${e.name}${null!=i?` (${i})`:""}`}}},type:{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},lag:{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}}}},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add",onAction:"up.onAddClick"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,onAction:"up.onRemoveClick"}}}}}}async finalizeLinkedTaskCellEdit({grid:t,value:n,record:r}){const{project:i}=t.store.masterStore,s="toEvent"===this.direction,o=s?r.fromEvent:n,a=s?n:r.toEvent;switch(await i.validateDependency(o,a,r.type,r)){case e.DependencyValidationResult.NoError:return!0;case e.DependencyValidationResult.CyclicDependency:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct();(this.grid=this.widgetMap.grid).ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:this})}get taskCombo(){const{grid:e}=this,t=null==e?void 0:e.columns.get(this.direction);return null==t?void 0:t.editor}loadEvent(e){const t=this,{grid:n,taskCombo:r,record:i}=t;super.loadEvent(e);const{dependencyStore:s,eventStore:o}=t.project,a=n.store.masterStore!==s,l=!a&&e!==i;if(a){t.depStoreGeneration=s.storage.generation,t.eventStoreGeneration=o.storage.generation,t.detachListeners("taskCombo"),n.store=s.chain((e=>e[t.negDirection]===t.record),null);const e=r.store=o.chain((e=>e!==t.record),null,{doRelayToMaster:[],excludeCollapsedRecords:!1});e.sort(t.taskComboSortField),e.filterBy((e=>!n.store.find((n=>{const r=n[t.direction],i=t._activeCellEdit,s=(null==i?void 0:i.record)&&r===i.record[t.direction];return r===e&&!s})))),r.ion({name:"taskCombo",change:"onGridCellEditChange",thisObj:t})}else n.store.resumeChain(),l||s.storage.generation!==t.depStoreGeneration?(n.store.fillFromMaster(),t.depStoreGeneration=s.storage.generation):n.refreshRows(),(l||o.storage.generation!==t.eventStoreGeneration)&&(r.store.fillFromMaster(),t.eventStoreGeneration=o.storage.generation);l&&n.store.sort(t.sortField),t.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:t}=e,{cellEdit:n}=t.features;n.isEditing&&!n.editor.isValid&&n.cancelEditing();const[r]=t.store.insert(0,{[e.negDirection]:e.record});return e.depStoreGeneration=e.project.dependencyStore.storage.generation,await t.features.cellEdit.startEditing({field:e.direction,id:r.id}),((e,t)=>{e.instanceMeta(t).valid=!1})(r,t),r}beforeSave(){this.grid.store.suspendChain()}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,{grid:t}=e,n=t.selectedRecords;t.features.cellEdit.cancelEditing(!0),e.project.dependencyStore.remove(n),t.selectedRecord=t.store.getNext(n[0]),e.taskCombo.store.fillFromMaster()}onGridSelectionChange({selection:e}){const t=this.widgetMap.remove;if(t){const n=Boolean(!(null!=e&&e.length)||this.up((e=>e.readOnly)));t.containsFocus&&n&&this.grid.focusCell({rowIndex:-1,columnIndex:0}),t.disabled=n}}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const t=this,n=t._editingDependency=e.record,{grid:r,direction:i}=t;t._activeCellEdit=e,e.column.field===i&&(GA(n,r)?t.clearActiveEditorErrors():n[i]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const t=this,{record:n,column:r}=e,{grid:i,direction:s}=t;r.field===s?(UA(n,i),t.taskCombo.store.fillFromMaster()):t.redrawDependencyRow(n),t._activeCellEdit=t._editingDependency=null,t.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing(!0)}onGridCancelCellEdit(){const e=this,t=e._editingDependency;t&&(UA(t,e.grid),t[e.direction]||e.redrawDependencyRow(t),e._activeCellEdit=e._editingDependency=null),e.requestReadyStateChange()}redrawDependencyRow(e){const{grid:t}=this,n=t.rowManager.getRowById(e);if(n){t.store.indexOf(e)>=0&&n.render(t.store.indexOf(e),e)}}get canSave(){const{grid:e}=this;return e.store.every((t=>GA(t,e)))}updateReadOnly(e){const{add:t,remove:n}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=n.hidden=e}}YA._$name="DependencyTab";class qA extends YA{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get configurable(){return{cls:"b-successors-tab",direction:"toEvent",negDirection:"fromEvent",title:"L{DependencyTab.Successors}",sortField:"toEventName",items:{grid:{columns:{data:{name:{field:"toEvent"}}}}}}}}qA.initClass(),qA._$name="SuccessorsTab";class KA extends YA{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get configurable(){return{cls:"b-predecessors-tab",direction:"fromEvent",negDirection:"toEvent",title:"L{DependencyTab.Predecessors}",sortField:"fromEventName",items:{grid:{columns:{data:{name:{field:"fromEvent"}}}}}}}}KA.initClass(),KA._$name="PredecessorsTab";class XA extends LA{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get configurable(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},showUnits:null,items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:{data:{resource:{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(null==e?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id"}},units:{type:"number",localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),min:0,max:100,step:10}}},disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap.add,n=e.removeButton=e.widgetMap.remove,r=e.grid=e.widgetMap.grid;null==t||t.ion({click:"onAddClick",thisObj:e}),null==n||n.ion({click:"onRemoveClick",thisObj:e}),r.ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:t,remove:n}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=n.hidden=e}get resourceCombo(){var e;const t=null===(e=this.grid)||void 0===e?void 0:e.columns.get("resource");return null==t?void 0:t.editor}updateShowUnits(e){const t=this.widgetMap.grid.columns.get("units");t&&(t.hidden=!e)}loadEvent(e){const t=this,{resourceCombo:n,grid:r,record:i}=t;super.loadEvent(e);const{assignmentStore:s,resourceStore:o}=t.project,a=r.store.masterStore!==s,l=!a&&e!==i;if("boolean"!=typeof this.showUnits){const t=r.columns.get("units");t&&(t.hidden=!e.isTask)}a?(t.assignmentStoreGeneration=s.storage.generation,t.resourceStoreGeneration=o.storage.generation,r.store=s.chain((e=>t.record&&e.event===t.record),null),n.store=o.chain((e=>!e.isSpecialRow&&t.record&&!t.record.isAssignedTo(e)||!t.activeAssignment||t.activeAssignment.resource===e),null,{groupers:o.groupers})):(r.store.resumeChain(),(l||s.storage.generation!==t.assignmentStoreGeneration)&&r.store.fillFromMaster(),(l||o.storage.generation!==t.resourceStoreGeneration)&&n.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:t,grid:n}=e,r=t.assignmentStore,[i]=r.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=r.storage.generation,await n.features.cellEdit.startEditing({field:"resource",id:i.id}),i}beforeSave(){this.pruneInvalidAssignments(),this.grid.store.suspendChain()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const{grid:e}=this;e.store.remove(e.selectedRecords),e.selectedRecords=null,this.removeButton.disable()}onGridSelectionChange({selection:e}){const{removeButton:t}=this;if(t){const n=!(null!=e&&e.length)||this.up((e=>e.readOnly));t.containsFocus&&n&&this.grid.focus(),t.disabled=n}}onGridStartCellEdit({editorContext:e}){"resource"===e.column.field&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query((e=>!e.isValid)))}}XA.initClass(),XA._$name="ResourcesTab";const ZA={assoonaspossible:1,aslateaspossible:1};class JA extends Mc{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id",store:{data:[{id:"none"},{id:"assoonaspossible"},{id:"aslateaspossible"},{id:"muststarton"},{id:"mustfinishon"},{id:"startnoearlierthan"},{id:"startnolaterthan"},{id:"finishnoearlierthan"},{id:"finishnolaterthan"}]},primaryFilter(e){return JA.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},includeAsapAlapAsConstraints:!0,nullValue:"none"}}loadEvent(e){this.taskRecord=e,this.store.filter()}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get inputValue(){var e;return this.L((null===(e=this.selected)||void 0===e?void 0:e.id)||this.nullValue)}listItemTpl(e){return JA.localize(e.id)}changeStore(e){return super.changeStore({...e,filters:{filterBy:e=>{var t,n;return ZA[e.id]?this._includeAsapAlapAsConstraints:null===(t=(null===(n=this.taskRecord)||void 0===n?void 0:n.recurringEvent)||this.taskRecord)||void 0===t?void 0:t.run("isConstraintTypeApplicable",e.id)}}})}updateIncludeAsapAlapAsConstraints(){this.store.filter()}}JA.initClass(),JA._$name="ConstraintTypePicker";class QA extends Mc{static get $name(){return"SchedulingDirectionPicker"}static get type(){return"schedulingdirectionpicker"}static get configurable(){return{store:{data:[{id:"Forward"},{id:"Backward"}]},primaryFilter(e){return QA.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},hasEnforcedBadge:!1,clearable:!1,nullValue:"Forward"}}get inputValue(){return this.L(this.value||"")}listItemTpl(e){return QA.localize(e.id)}changeHasEnforcedBadge(e){this.element.classList.toggle("b-enforced-sch-direction",Boolean(e))}getEnforcedName(e){return e.name||(e.isRoot?"Project":`Task #${e.id}`)}assignFieldValue(e){const t=this,n=null==e?void 0:e.effectiveDirection;t.taskRecord=e,n?(t.value=n.direction,"enforced"===n.kind?(t.hasEnforcedBadge=!0,t.tooltip=t.L("L{enforcedBy}")+` "${this.getEnforcedName(n.enforcedBy)}"`,t.disable()):"inherited"===n.kind?(t.hasEnforcedBadge=!0,t.tooltip=t.L("L{inheritedFrom}")+` "${this.getEnforcedName(n.inheritedFrom)}"`,t.enable()):(t.hasEnforcedBadge=!1,t.tooltip=i,t.enable())):(t.clear(),t.disable())}}QA.initClass(),QA._$name="SchedulingDirectionPicker";class eF extends Mc{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}static get configurable(){return{allowedModes:null,store:{data:this.defaultStoreData}}}static get defaultStoreData(){return[{id:e.SchedulingMode.Normal,text:this.L("L{Normal}")},{id:e.SchedulingMode.FixedDuration,text:this.L("L{Fixed Duration}")},{id:e.SchedulingMode.FixedUnits,text:this.L("L{Fixed Units}")},{id:e.SchedulingMode.FixedEffort,text:this.L("L{Fixed Effort}")}]}changeAllowedModes(e){return"string"==typeof e?e.split(","):e}updateAllowedModes(e){this._allowedModes=e,e?this.store.addFilter({id:"allowed-mode-filter",filterBy:e=>this._allowedModes.includes(e.id)}):this.store.removeFilter("allowed-mode-filter")}updateLocalization(){super.updateLocalization(),this.store.data=this.constructor.defaultStoreData}}eF.initClass(),eF._$name="SchedulingModePicker";class tF extends $A{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){const e={flex:"0 0 calc(64% - var(--autocontainer-gap) / 2)",labelWidth:"30%"},t={flex:"0 0 calc(34% - var(--autocontainer-gap) / 2)",labelWidth:"80%"};return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",...e},ignoreResourceCalendarField:{type:"checkbox",weight:100,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-ignore-resource-calendar",...t},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",...e},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",...t},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",clearable:!0,...e},rollupField:{type:"checkbox",weight:700,name:"rollup",label:"L{Rollup}",...t},constraintDateField:{type:"date",weight:800,name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",...e},schedulingDirectionField:{type:"schedulingdirectionpicker",weight:850,name:"direction",label:"L{Scheduling direction}",...e},inactiveField:{type:"checkbox",weight:900,name:"inactive",label:"L{Inactive}",...t},projectConstraintResolutionField:{type:"combo",weight:1e3,name:"projectConstraintResolution",label:"L{projectBorder}",localizeDisplayFields:!0,items:[{value:"ignore",text:"L{ignore}"},{value:"honor",text:"L{honor}"},{value:"conflict",text:"L{askUser}"}],...e},manuallyScheduledField:{type:"checkbox",weight:1100,name:"manuallyScheduled",label:"L{Manually scheduled}",cls:"b-last-row",style:"margin-left:auto",...t}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}get schedulingDirectionField(){return this.widgetMap.schedulingDirectionField}loadEvent(e){var t;const{calendarField:n,constraintTypeField:r,includeAsapAlapAsConstraints:s,schedulingDirectionField:o}=this,{calendarManagerStore:a}=e.project,l=(null==n||null===(t=n.store)||void 0===t?void 0:t.masterStore)!==a;n&&(l?n.store=a.chain(i,i,{excludeCollapsedRecords:!1}):n.store.resumeChain()),r&&(r.taskRecord=e,r.includeAsapAlapAsConstraints=s),o&&(o.hidden=s),super.loadEvent(e)}beforeSave(){const{calendarField:e}=this.widgetMap;e&&e.store.suspendChain()}}tF.initClass(),tF._$name="AdvancedTab";class nF extends $A{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get configurable(){return{cls:"b-notes-tab",title:this.L("L{Notes}"),tab:{icon:"b-icon-note",titleProperty:"tooltip"},layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textfield",inputAttributes:{tag:"textarea"},cls:"b-taskeditor-notes-field",name:"note"}}}}}nF.initClass(),nF._$name="NotesTab";class rF extends PA{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}static configurable={items:{tabs:{type:"tabpanel",defaultType:"formtab",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}}}}rF.initClass(),rF._$name="GanttTaskEditor";class iF extends $A{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",cls:"b-half-width",min:0,weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",cls:"b-half-width",min:0,max:100,weight:600},effortField:{type:"durationfield",label:"L{Effort}",name:"fullEffort",weight:620},preambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:650,label:"L{SchedulerGeneralTab.Preamble}",name:"preamble",cls:"b-half-width"},postambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:660,label:"L{SchedulerGeneralTab.Postamble}",name:"postamble",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:700,label:"L{SchedulerBase.color}",name:"eventColor"}}}}loadEvent(e){const{project:t}=this,n={unit:e.durationUnit,magnitude:1},{startDateField:r,endDateField:i,resourcesField:s}=this.widgetMap,o=(null==s?void 0:s.store.masterStore)!==t.resourceStore;r&&(r.dateField.eventRecord=e,Gt.compareUnits(n.unit,"hour")>0?r.dateField.step=n:r.timeField.step=n),i&&(i.dateField.eventRecord=e,Gt.compareUnits(n.unit,"hour")>0?i.dateField.step=n:i.timeField.step=n),s&&(s.multiSelect=s.config.multiSelect??!t.eventStore.usesSingleAssignment,o?s.store=t.resourceStore.chain((e=>!e.isSpecialRow)):s.store.resumeChain()),super.loadEvent(...arguments)}onFieldChange({source:e,valid:t,userAction:n,value:r}){if(n&&t){const{eventStore:t}=this.record,n="resources"===e.name&&0===r.length&&this.autoUpdateRecord&&t.removeUnassignedEvent;n&&(t.removeUnassignedEvent=!1),super.onFieldChange(...arguments),n&&(t.removeUnassignedEvent=!0)}}beforeSave(){var e;0===this.record.resources.length&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),null===(e=this.widgetMap.resourcesField)||void 0===e||e.store.suspendChain(),super.beforeSave()}}iF.initClass(),iF._$name="SchedulerGeneralTab";class sF extends LA{static $name="RecurrenceTab";static type="recurrencetab";static configurable={title:"L{title}",cls:"b-recurrence-tab",scrollable:!0,items:{recurrenceEditor:{type:"recurrenceeditorpanel",addNone:!0}}};get recurrenceEditor(){return this.widgetMap.recurrenceEditor}loadEvent(e){this.recurrenceEditor&&(this.loadingRecord=!0,this.recurrenceEditor.record=e.recurrence??null,this.loadingRecord=!1),super.loadEvent(e)}onFieldChange({source:e,value:t}){const n=this;if(!n.isConfiguring&&!n.recurrenceEditor.assigningValues&&!n.loadingRecord){const{record:r}=n;r.recurrence?e===n.recurrenceEditor.widgetMap.frequencyField&&"NONE"===t?r.recurrence=null:n.recurrenceEditor.syncEventRecord(r.recurrence):r.recurrence=new r.recurrenceModel({}),n.up((e=>e.isTaskEditorBase)).editingRecurring=!0}}}sF.initClass(),sF._$name="RecurrenceTab";class oF extends $A{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get configurable(){return{cls:"b-advanced-tab",tab:{icon:"b-icon-advanced",tooltip:"L{SchedulerAdvancedTab.Advanced}"},defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200,includeAsapAlapAsConstraints:!1},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400},schedulingModeField:{type:"schedulingmodecombo",name:"schedulingMode",label:"L{Scheduling mode}",hidden:!0,weight:450,allowedModes:`${e.SchedulingMode.Normal},${e.SchedulingMode.FixedDuration}`},effortDrivenField:{type:"checkbox",weight:460,name:"effortDriven",label:"L{Effort driven}",hidden:!0,cls:"b-half-width"},inactiveField:{type:"checkbox",weight:500,name:"inactive",label:"L{Inactive}"},ignoreResourceCalendarField:{type:"checkbox",weight:600,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-half-width"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const t=this,{project:n}=t;t.record;const{calendarField:r,constraintTypeField:i}=t;i&&(i.taskRecord=e),r&&(r.store=n.calendarManagerStore,r.hidden=!n.calendarManagerStore.count),super.loadEvent(...arguments)}}oF.initClass(),oF._$name="SchedulerAdvancedTab";const aF=/(pre|post)amble/;class lF extends PA{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{enableEventSpanBuffer:!1,items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},defaults:{scrollable:{overflowY:!0}},items:{generalTab:{type:"schedulergeneraltab",weight:100},recurrenceTab:{type:"recurrencetab",weight:150},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){var t,n;(null!==(t=e.ref)&&void 0!==t&&t.match(aF)&&(e.hidden=!this.enableEventSpanBuffer),"recurrenceTab"===e.ref)&&(e.hidden=!(null!==(n=this.owner)&&void 0!==n&&n.enableRecurringEvents));return super.processWidgetConfig(e)}onFocusOut({relatedTarget:e}){var t;const n=null==e||null===(t=e.closest(".b-sch-event-wrap"))||void 0===t?void 0:t.elementData.eventRecord;if(!n||n!==this.loadedRecord)return super.onFocusOut(...arguments);this.setTimeout((()=>this.focus()),100)}}lF.initClass(),lF._$name="SchedulerTaskEditor";class cF extends(fi.mixin(mi,kD,AD,ID)){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[e.ProjectType.SchedulerBasic]:"schedulertaskeditor",[e.ProjectType.SchedulerPro]:"schedulertaskeditor",[e.ProjectType.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,confirmDelete:!0,saveAndCloseOnEnter:!0,blurAction:"cancel",weekStartDay:null,scrollIntoView:!0}}static get configurable(){return{items:null,suspendHasChangesEvent:!1}}construct(e,t){var n;e.taskEdit=this,super.construct(e,Xt.assign({weekStartDay:e.weekStartDay,enableEventSpanBuffer:null===(n=e.features.eventBuffer)||void 0===n?void 0:n.enabled},t)),e.ion({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",afterEventDrop:"onEventDropped",eventResizeEnd:"onEventResized",thisObj:this})}doDestroy(){var e;this.cleanupProjectListener(),null===(e=this.editor)||void 0===e||e.destroy(),this.deleteConfirmationPromise&&vp.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,t){return this.client.getElementFromEventRecord(e,t)}scrollEventIntoView(e,t){this.client.scrollResourceEventIntoView(t,e)}get isValid(){return this.editor.eachWidget((e=>!!(!0===e.isValid||e.hidden||e.disabled||e.isField&&!e.name)||!1!==e.isValid),!0)}get project(){return this.scheduler.project}setupProjectListener(){this.cleanupProjectListener(),this.project.ion({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}cleanupProjectListener(){this.detachListeners("project")}onDataReady(){let{record:e}=this;e&&(e=this.scheduler.taskStore.getById(e.id),e&&this.load(e,!0)),e||this.editor.close()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:n}){e===this.record&&this.isEditing||this.editEvent(e,t,n)}async editEvent(e,t=null,n=null,r=null){var i;const s=this,{scheduler:o,suspendHasChangesEvent:a}=s,{project:l}=o,c=async()=>{l.resumeAutoSync(),await s.freeStm(!0),s.isDestroyed||(a&&!l.isDestroying&&l.resumeChangeTracking(),s._editing=!1)};e=e.isEventSegment?e.event:e;const d=!s.disabled&&!e.readOnly&&!l.isDelayingCalculation&&(e.project||!o.usesDisplayStore);var u;(d&&r&&(r.transferred=!0),s.isEditing&&await s.cancel(),null!==(i=o.features.cellEdit)&&void 0!==i&&i.isEditing&&o.cancelEditing(),await Promise.all([s._cancelling,s._hiding]).catch((()=>{})),o.isGanttBase||t)||(t=e.resource||(null===(u=e.resources)||void 0===u?void 0:u[0]));if(d){const{taskStore:i}=o;if(s._editing=!0,r?(s.applyStmCapture(r),s.hasStmCapture=!0,s.stmCapture=r):s.hasStmCapture||await s.captureStm(!0),l.suspendAutoSync(),"function"==typeof e&&(e=e()),!(e=e.$original).isOccurrence&&!i.includes(e)&&!e.isCreating&&(e.isCreating=!0,i.add(e),t&&o.assignmentStore.assignEventToResource(e,t),await l.commitAsync(),s.isDestroyed))return;if(s.scrollIntoView&&!o.timeAxisSubGrid.collapsed&&!n&&i.includes(e)&&(t||o.isGantt)&&(await s.scrollEventIntoView(e,t),s.isDestroyed))return;const a=n||Br.down(s.getElementFromTaskRecord(e,t),o.eventInnerSelector),d=s.getEditor(e);if(!1!==await s.triggerOnClient("beforeTaskEdit",{taskEdit:s,taskRecord:e,resourceRecord:t,taskElement:a})){if(s.suspendHasChangesEvent&&o.project.suspendChangeTracking(),o.element.classList.add("b-taskeditor-editing"),await l.commitAsync(),!e.isOccurrence){if(!o.eventStore.includes(e))return void await c();e=o.eventStore.getById(e.id)}if(s.isDestroyed)return;s.load(e),s.triggerOnClient("beforeTaskEditShow",{taskEdit:s,taskRecord:e,taskElement:a,editor:d});const{widgetMap:t}=d,n=e.parent&&!e.parent.isRoot;t.deleteButton&&(t.deleteButton.hidden=o.readOnly||e.isCreating||d.readOnly),o.features.nestedEvents&&(t.predecessorsTab&&(t.predecessorsTab.disabled=n),t.successorsTab&&(t.successorsTab.disabled=n),t.resourcesField&&(t.resourcesField.disabled=n)),s.setupProjectListener(),d.centered?await d.show():o.timeAxisSubGrid.collapsed||!a||o.isGanttBase&&!s.scrollIntoView&&!wn.from(a).intersect(wn.from(o.timeAxisSubGridElement))?await d.showBy({target:o.element,anchor:!1,align:"c-c"}):await d.showBy({target:a,anchor:!0,offset:-5})}else await c()}}prepareEditorConfig(e){return e}getEditor(e=this.record){const t=this,{client:n}=t;let{editor:r}=t;if(!r){var i,s;const o=t.prepareEditorConfig(Xt.merge({eventEditFeature:t,weekStartDay:t.weekStartDay,enableEventSpanBuffer:t.enableEventSpanBuffer,saveAndCloseOnEnter:t.saveAndCloseOnEnter,blurAction:t.blurAction,owner:n,dependencyIdField:(null===(i=t.editorConfig)||void 0===i?void 0:i.dependencyIdField)||n.dependencyIdField,project:t.project,durationDisplayPrecision:n.durationDisplayPrecision,tabPanelItems:t.items,internalListeners:{beforeHide:{fn:"onBeforeHide",prio:-1e3},cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:t},tabsConfig:t.tabsConfig},t.editorConfig));if(n.showTaskColorPickers||!1===(null===(s=o.tabPanelItems)||void 0===s?void 0:s.generalTab)||(o.tabPanelItems=Xt.merge(o.tabPanelItems||{},{generalTab:{items:{colorField:!1}}})),t.editorClass&&!o.type)r=t.editor=t.editorClass.new(o);else{const n=((null==e?void 0:e.project)||t.project).getType();r=t.editor=ba.create(Object.assign({type:t.editorClassMap[n]||"schedulertaskeditor"},o))}}return r.readOnly=(n.readOnly||(null==e?void 0:e.isOccurrence)||(null==e?void 0:e.isRecurring))&&!r.editingRecurring,r.project=t.project,r}load(e,t){const n=this,r=n.getEditor(e);n._loading=!0,e.isEventSegment&&(e=e.event),n.record=e,r.loadEvent(e,t),n._loading=!1}async save(){const e=this,{scheduler:t,record:n}=e;if(e.isEditing){const r=e.getEditor();if(!e.isValid||!1===await e.triggerOnClient("beforeTaskSave",{taskRecord:n,editor:r}))return;e.cleanupProjectListener(),r.beforeSave(),n.isCreating=!1,r.resetRecurrenceData=r.editingRecurring=null;let i=!0;const s=e.freeStm(!0);if(Xt.isPromise(s)&&s.then((()=>i=!1)),e._editing=!1,await r.close(),Xt.isPromise(s)&&(await s,e.isDestroying))return;t.project.resumeAutoSync(!0),t.element.classList.remove("b-taskeditor-editing"),e.triggerOnClient("afterTaskSave",{taskRecord:n,editor:r}),r.afterSave(),e.suspendHasChangesEvent&&t.project.resumeChangeTracking(i),e.triggerOnClient("afterTaskEdit",{taskRecord:n,editor:r})}}async doCancel(){const e=this,{scheduler:t,record:n}=e;if(e.isEditing){e._editing=!1,e.cleanupProjectListener();const{project:a}=e,l=e.getEditor();var r,i,s,o;if(l.editingRecurring=null,l.beforeCancel(),e.isDestroyed)return void(null===(r=a.resumeAutoSync)||void 0===r||r.call(a,!1));if(await e.rejectStmTransaction(),null!=n&&n.isCreating&&n.remove(),e.isDestroyed)return void(null===(i=a.resumeAutoSync)||void 0===i||i.call(a,!1));if(await a.commitAsync(),e.isDestroyed)return void(null===(s=a.resumeAutoSync)||void 0===s||s.call(a,!1));if(e.isDestroyed)return void(null===(o=a.resumeAutoSync)||void 0===o||o.call(a,!1));e.freeStm(),l.afterCancel(),a.resumeAutoSync(!1),t.element.classList.remove("b-taskeditor-editing"),e.trigger("afterTaskEdit"),e.triggerOnClient("taskEditCanceled",{taskRecord:n,editor:l}),e.suspendHasChangesEvent&&a.resumeChangeTracking(),e.triggerOnClient("afterTaskEdit",{taskRecord:n,editor:l})}}async cancel(){const e=this,{editor:t}=e,{resetRecurrenceData:n}=t;return n&&(n.recurringTimeSpan.exceptionDates=n.originalExceptionDates,t.resetRecurrenceData=null),e._cancelling||(e._cancelling=e.doCancel().finally((()=>e._cancelling=i)))}async delete(){const e=this,{editor:t,scheduler:n,record:r,project:i}=e;var s;(r.isCreating||!1!==await e.triggerOnClient("beforeTaskDelete",{taskRecord:r,editor:t}))&&(e.cleanupProjectListener(),t.beforeDelete(),r.remove(),await e.commitStmTransaction(),e.isDestroyed?null===(s=i.resumeAutoSync)||void 0===s||s.call(i,!1):(e.freeStm(),await i.commitAsync(),e.isDestroyed||(i.resumeAutoSync(!r.isCreating),e._editing=!1,t.close(),t.afterDelete(),n.element.classList.remove("b-taskeditor-editing"),e.suspendHasChangesEvent&&n.project.resumeChangeTracking(),e.triggerOnClient("afterTaskEdit",{editor:t,taskRecord:r}))))}onSave(){this.requestAnimationFrame((()=>this.save()))}onCancel(){this.cancel().then()}async onDelete(){const e=this;if(e.confirmDelete){const{editor:t}=e,n=t.autoClose;t.autoClose=!1,e.deleteConfirmationPromise=vp.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}",okButton:"L{TaskEditorBase.Delete}",rootElement:e.rootElement});const r=await e.deleteConfirmationPromise;t.autoClose=n,e.deleteConfirmationPromise=null,r===vp.yesButton&&e.delete()}else e.requestAnimationFrame((()=>e.delete()))}onBeforeHide({source:e,animate:t}){e.hideAnimation&&!1!==t&&(this._hiding=new Promise((t=>{e.ion({hideAnimationEnd:t,expires:{delay:500,alt:t}})})).finally((()=>this._hiding=i)))}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n,stmCapture:r}){this.isDestroyed||this.disabled||!e.isCreating||this.editEvent(e,t,null,r)}populateEventMenu({eventRecord:e,resourceRecord:t,items:n}){this.scheduler.readOnly||(n.editEvent={text:"L{Edit task}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled||e.readOnly,onItem:()=>this.editEvent(e,t)})}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}async triggerOnClient(e,t){const n=e.replace(/task/,"event").replace(/Task/,"Event"),r=await this.scheduler.trigger(...arguments);t.eventRecord=t.taskRecord,t.eventRecords=[t.taskRecord];const i=await this.scheduler.trigger(n,t);return r&&i}onEventDropped({eventRecords:e}){var t;const n=(null===(t=this.editor)||void 0===t?void 0:t.loadedRecord)&&e.find((e=>e===this.editor.loadedRecord));n&&this.onEventResized({eventRecord:n})}onEventResized({eventRecord:e}){const{editor:t}=this;null!=t&&t.isVisible&&e===t.loadedRecord&&t.realign()}}cF._$name="TaskEdit",Ed.registerFeature(cF,!0,"SchedulerPro"),Ed.registerFeature(cF,!1,"ResourceHistogram");const dF={isHighlightConfig:!0,clearExisting:!1},uF={};class hF extends fi{domConfigs=[];configs=[];static get $name(){return"TimeSpanHighlight"}static get configurable(){return{padding:0}}static get pluginConfig(){return{assign:["highlightTimeSpan","highlightTimeSpans","unhighlightTimeSpans"],chain:["onTimeAxisViewModelUpdate"]}}construct(){super.construct(...arguments),this.client.rowManager.ion({renderDone:this.onViewChanged,thisObj:this})}highlightTimeSpan(e,t=!0){var n;const r=this,{startDate:i,endDate:s,name:o,surround:a,padding:l=r.padding,clearExisting:c=!0}=e,{client:d}=r,u=e.isTimeSpan?e:e.taskRecord;let h=e.resourceRecord||e.resource;const{animationId:g}=e;if(g&&Br.addTemporaryClass(d.element,"b-transition-highlight",500,d),c&&(r.domConfigs.length=r.configs.length=0),r.disabled)return;if(a)return void r.surroundTimeSpan(e);let m;r.configs.push(e),d.isGanttBase?m=d.getScheduleRegion(u,!0,{start:i,end:s}):(h&&(h=d.store.getById(h)),m=d.getScheduleRegion(h,null,!0,{start:i,end:s},!h)),m&&(l&&(d.isHorizontal?m.inflate(l,0,l,0):m.inflate(0,l,0,l)),r.domConfigs.push(m.visualize({children:[{class:"b-sch-highlighted-range-name",html:o}],dataset:g?{syncId:g}:uF,class:{"b-sch-highlighted-range":1,[e.cls]:e.cls,[e.class||"b-sch-highlighted-range-default"]:1}},!0)),t&&r.draw(),null===(n=d.syncSplits)||void 0===n||n.call(d,(n=>n.highlightTimeSpan(e,t))))}draw(){To.sync({targetElement:this.containerEl,domConfig:{onlyChildren:!0,children:this.domConfigs}})}surroundTimeSpan(e){this.highlightTimeSpans([Object.assign({},e,{animationId:(e.animationId||"")+"Before",class:"b-unavailable",surround:!1,startDate:this.client.startDate,endDate:e.startDate}),Object.assign({},e,{animationId:(e.animationId||"")+"After",class:"b-unavailable",surround:!1,startDate:e.endDate,endDate:this.client.endDate})],{clearExisting:e.clearExisting})}highlightTimeSpans(e,t={}){const n=this,{clearExisting:r=!0}=t;r&&(e=e.slice(),n.domConfigs.length=n.configs.length=0),n.disabled||(e.forEach((e=>{n.highlightTimeSpan(e.isHighlightConfig?e:Object.setPrototypeOf(e,dF),!1)})),n.draw())}async unhighlightTimeSpans(e=!1){var t;const n=this,{client:r}=n;e&&Br.addTemporaryClass(r.element,"b-transition-highlight",500,r),Array.from(n.containerEl.children).forEach((t=>{e?(t.style.opacity=0,n.fadeOutDetacher=Zn.onTransitionEnd({element:t,property:"opacity",thisObj:r,handler:()=>{n.domConfigs.length=n.configs.length=0,n.draw()}})):(n.domConfigs.length=n.configs.length=0,n.draw())})),null===(t=r.syncSplits)||void 0===t||t.call(r,(t=>t.unhighlightTimeSpans(e)))}get containerEl(){return this._containerEl||(this._containerEl=Br.createElement({parent:this.client.foregroundCanvas,retainElement:!0,class:"b-sch-highlight-container"})),this._containerEl}onTimeAxisViewModelUpdate(){this.onViewChanged()}onViewChanged(){this.configs.length>0&&this.highlightTimeSpans(this.configs)}updateDisabled(e,t){e&&this.unhighlightTimeSpans(),super.updateDisabled(e,t)}get featureClass(){}}hF._$name="TimeSpanHighlight",Ed.registerFeature(hF,!1,["SchedulerPro","Gantt"]);class gF{static $name="ChangeLogEntity";constructor({model:e,type:t}){Object.assign(this,{id:e.id??e.$entityName,type:(null==t?void 0:t.$$name)??e.constructor.name,name:e.name??e.$entityName}),new.target===gF&&Object.freeze(this)}}gF._$name="ChangeLogEntity";class mF extends gF{static $name="ChangeLogDependencyEntity";constructor({model:e,fromTask:t,toTask:n}){super({model:e,type:uM}),Object.assign(this,{fromTask:t,toTask:n}),Object.freeze(this)}}mF._$name="ChangeLogDependencyEntity";class pF extends gF{static $name="ChangeLogAssignmentEntity";constructor({model:e,event:t,resource:n}){super({model:e,type:NT}),Object.assign(this,{event:t,resource:n}),Object.freeze(this)}}pF._$name="ChangeLogAssignmentEntity";class fF{static $name="ChangeLogAction";constructor({entity:e,actionType:t}){Object.assign(this,{entity:e,actionType:t}),this.constructor===fF&&Object.freeze(this)}}fF._$name="ChangeLogAction";class vF extends fF{static get $name(){return"ChangeLogMoveAction"}constructor({entity:e,from:t,to:n}){super({entity:e,actionType:"move"}),Object.assign(this,{from:t,to:n}),Object.freeze(this)}}vF._$name="ChangeLogMoveAction";class yF extends fF{static get $name(){return"ChangeLogUpdateAction"}constructor({entity:e,propertyUpdates:t,isInitialUserAction:n}){super({entity:e,actionType:"update"}),Object.assign(this,{propertyUpdates:t,isUser:n}),Object.freeze(this)}}yF._$name="ChangeLogUpdateAction";class bF extends(fi.mixin(ZS)){static $name="Versions";static configurable={versionModelClass:aA,transactionModelClass:cA,autoSaveInterval:"hourly",knownBaseTypes:[NT,uM,eA],versionContentLoadTimeout:6e4};_remoteActionRanges=[];_comparingVersionId;construct(e,t){super.construct(e,t);const n=this;n.versionStore=new lA({modelClass:n.versionModelClass,internalListeners:{change:n.onStoreChangeExternal,thisObj:n},id:lA.configurable.storeId}),n.changeStore=new dA({modelClass:n.transactionModelClass,internalListeners:{change:n.onStoreChangeExternal,thisObj:n},id:dA.configurable.storeId}),n._currentChanges=[],n.client.ion({beforeTaskDelete:n.onBeforeTaskDelete,beforeTaskSave:n.onBeforeTaskSave,gridRowBeforeDropFinalize:n.onGridRowBeforeDropFinalize,thisObj:n})}attachToProject(e){const t=this;super.attachToProject(e),e.addCrudStore([t.versionStore,t.changeStore]),e.ion({name:"project",load:t.onProjectLoad,once:!0,thisObj:t}),t.detachProjectListeners(),t.attachProjectListeners(e)}onBeforeTaskDelete(){this.transactionDescription=this.L("L{Versions.deletedTask}")}onBeforeTaskSave(){this.transactionDescription=this.L("L{Versions.editedTask}")}onGridRowBeforeDropFinalize({context:{valid:e,records:t}}){e&&(this.transactionDescription=1===t.length?this.L("L{Versions.movedTask}"):this.L("L{Versions.movedTasks}"))}attachProjectListeners(e){var t;const n=this;null==e||null===(t=e.stm)||void 0===t||t.ion({recordingStart:n.onStmRecordingStart,recordingStop:n.handleTransactionStop,restoringStop:n.onStmRestoringStop,thisObj:n,name:"stmListeners"}),null==e||e.ion({wsBeforeReceiveChanges:n.onBeforeApplyRemoteChanges,wsReceiveChanges:n.onAfterApplyRemoteChanges,thisObj:n,name:"stmListeners"})}detachProjectListeners(){this.detachListeners("stmListeners")}updateVersionModelClass(e){if(!e.isVersionModel)throw new Error("versionModelClass config must be a subclass of SchedulerPro.model.VersionModel.")}updateTransactionModelClass(e){if(!e.isChangeLogTransactionModel)throw new Error("transactionModelClass config must be a subclass of SchedulerPro.model.changelog.ChangeLogTransactionModel.")}onStoreChangeExternal(){this.triggerVersionChange()}tryAutoSave(){const e=this,{project:t}=e.client;e.changeStore.find((({versionId:e})=>!e))&&(null!=t&&t.wsSend?(t.wsSend("requestVersionAutoSave",{project:t.wsProjectId}),e.detachListeners("autoSave"),t.ion({name:"autoSave",wsVersionAutoSaveOK:e.autoSave,thisObj:e,once:!0})):e.saveVersionWithConfig({isAutosave:!0}))}autoSave(){this.saveVersionWithConfig({isAutosave:!0})}autoSaveHourly(){0===(new Date).getMinutes()&&this.tryAutoSave()}updateAutoSaveInterval(e){const t=this,{client:n}=t;t._autoSaveInterval&&n.clearInterval(t._autosaveInterval),"hourly"===e?t._autoSaveInterval=n.setInterval(t.autoSaveHourly.bind(t),1e4):e&&(t._autoSaveInterval=n.setInterval(t.tryAutoSave.bind(t),60*e*1e3))}saveVersion(e=null){return this.saveVersionWithConfig({name:e})}saveVersionWithConfig(e){const t=this,n=t.captureVersionContent(),r=new t.versionModelClass({savedAt:new Date,content:n,...e});return r.onBeforeSave(),t.versionStore.add(r),t.changeStore.query((e=>null==e.versionId)).forEach((e=>e.versionId=r.id)),t.triggerVersionChange(),t.triggerTransactionChange(),r}async loadVersionContent(e){const t=this,{client:n}=t,{project:r}=n,i={version:e,content:null};if(await t.trigger("beforeLoadVersionContent",{context:i})){if(null!=r&&r.wsSend){r.wsSend("loadVersionContent",{project:r.wsProjectId,versionId:e.id});const n=await new Promise(((n,i)=>{const s=Date.now();r.ion({name:"loadVersionContent",loadVersionContent({project:t,versionId:i,content:s}){if(t===r.wsProjectId&&i===e.id)return r.detachListeners("loadVersionContent"),n(s)},thisObj:t,expires:{delay:t.versionContentLoadTimeout-(Date.now()-s),alt:()=>i(`Failed to receive version content within ${this.versionContentLoadTimeout} ms`)}})}));return n&&t._versionContentCache.set(e.id,n),n}}else if(i.content)return i.content}async getVersionContent(e){return e.content??await this.loadVersionContent(e)}triggerTransactionChange(){this.client.trigger("transactionChange",{hasUnattachedTransactions:this.hasUnattachedTransactions})}triggerVersionChange(){this.client.trigger("versionChange",{versions:this.versionStore.records})}captureVersionContent(){return this.client.project.toJSON()}async restoreVersion(e){var t,n,r;const i=await this.getVersionContent(e),{project:s}=this.client,o=null===(t=s.stm)||void 0===t?void 0:t.enabled;var a;(null===(n=s.stm)||void 0===n||n.disable(),s.json=i,await s.commitAsync(),o)&&(null===(a=s.stm)||void 0===a||a.enable());null===(r=s.stm)||void 0===r||r.resetQueue()}async compareVersion(e){var t,n;const r=await this.getVersionContent(e),i={},{project:s}=this.client,o=null===(t=s.stm)||void 0===t?void 0:t.enabled;null===(n=s.stm)||void 0===n||n.disable();for(const e of r.eventsData)eo.preWalk(e,(e=>e.children),(({id:e,startDate:t,endDate:n})=>{i[e]={startDate:t,endDate:n}}));var a;(s.taskStore.traverse((e=>{i[e.id]&&(e.baselines.removeAll(),e.baselines.loadData([{task:e,...i[e.id]}]))})),o)&&(null===(a=s.stm)||void 0===a||a.enable());this._comparingVersionId=e.id}stopComparing(){var e,t;if(!this._comparingVersionId)return;const{project:n}=this.client,r=null===(e=n.stm)||void 0===e?void 0:e.enabled;var i;(null===(t=n.stm)||void 0===t||t.disable(),n.taskStore.traverse((e=>{e.baselines.removeAll()})),r)&&(null===(i=n.stm)||void 0===i||i.enable());this._comparingVersionId=null}doDisable(e){super.doDisable(e),e?this.detachProjectListeners():this.attachProjectListeners(this.client.project),this.client.refresh()}getEntityDescriptor(e){const t=this.knownBaseTypes.find((t=>e instanceof t))??e.constructor;return e.isDependencyModel?new mF({model:e,fromTask:this.getEntityDescriptor(e.fromTask),toTask:this.getEntityDescriptor(e.toTask)}):e.isAssignmentModel?new pF({model:e,event:this.getEntityDescriptor(e.event),resource:this.getEntityDescriptor(e.resource)}):new gF({model:e,type:t})}getUpdateAction(e){const t=e[0].model,n=e.flatMap((({newData:e,oldData:n})=>Object.entries(e).map((([e,t])=>({property:e,value:t,oldValue:n[e]}))).filter((({property:e,value:n,oldValue:r})=>{var i;return!Xt.isEqual(n,r)&&(null===(i=t.getFieldDefinition(e))||void 0===i?void 0:i.persist)})))),r=H.groupBy(n,"property"),i=Object.entries(r).map((([e,t])=>({property:e,before:t[0].oldValue,after:t[t.length-1].value}))),s=e.some((({isInitialUserAction:e})=>e));return new yF({actionType:"update",entity:this.getEntityDescriptor(t),propertyUpdates:i,isInitialUserAction:s})}onProjectLoad(){this._currentStmTransaction=null,this.stopTransaction()}onStmRecordingStart({transaction:e}){this._transactionStart=new Date,this._currentStmTransaction=e,this.triggerTransactionChange()}stopTransaction(){var e,t;null!==(e=this.client.project)&&void 0!==e&&e.stm.isRecording&&(null===(t=this.client.project)||void 0===t||t.stm.stopTransaction());this.handleTransactionStop()}async onStmRestoringStop({cause:e,transactions:t}){const n=this;"undo"===e?n.transactionDescription=n.L("L{undid}"):"redo"===e&&(n.transactionDescription=n.L("L{redid}")),await n.client.project.commitAsync(),n._transactionStart=new Date,n.finalizeTransaction({queue:t.flatMap((e=>e.queue))})}onBeforeApplyRemoteChanges(){var e;null==this._remoteChangesStartPos&&(this._remoteChangesStartPos=(null===(e=this._currentStmTransaction)||void 0===e?void 0:e.queue.length)??0)}async onAfterApplyRemoteChanges(){this.endCurrentRemoteActionRange(),await this.client.project.commitAsync()}endCurrentRemoteActionRange(){const e=this;if(null!=e._remoteChangesStartPos){var t;const n=(null===(t=e._currentStmTransaction)||void 0===t?void 0:t.queue.length)??0;n!==e._remoteChangesStartPos&&e._remoteActionRanges.push({start:e._remoteChangesStartPos,end:n}),e._remoteChangesStartPos=null}}handleTransactionStop(){const e=this;e.hasChanges&&e.finalizeTransaction(e._currentStmTransaction),e._currentTransactionDescription=null,e._currentStmTransaction=null,e._remoteActionRanges=[],e.triggerTransactionChange()}excludeRanges(e,t){let n=[],r=0;for(const{start:i,end:s}of t)n=n.concat(e.slice(r,i)),r=s;return n.concat(e.slice(r))}finalizeTransaction(e){const t=this;t.endCurrentRemoteActionRange();const n=t.excludeRanges(e.queue,t._remoteActionRanges);if(0===n.length)return;const r=({model:e})=>e.$entityName,s=H.groupBy(n,"type"),o=[];for(const e of["UpdateAction","EventUpdateAction"]){const n=H.groupBy(s[e]||[],r);for(const e of Object.values(n))o.push(t.getUpdateAction(e))}for(const{modelList:e,isInitialUserAction:n}of s.RemoveAction||[])for(const r of e)o.push(new fF({actionType:"remove",entity:t.getEntityDescriptor(r),isInitialUserAction:n}));for(const{childModels:e}of s.RemoveChildAction||[])for(const n of e)o.push(new fF({actionType:"remove",entity:t.getEntityDescriptor(n)}));for(const{modelList:e}of s.AddAction||[])for(const n of e)o.push(new fF({actionType:"add",entity:t.getEntityDescriptor(n)}));for(const{childModels:e,parentModel:n,context:r,insertIndex:a}of s.InsertChildAction||[])for(const s of e){const e=r.get(s);e!=i?o.push(new vF({actionType:"move",entity:t.getEntityDescriptor(s),from:{parent:t.getEntityDescriptor(e.parent),index:e.index},to:{parent:t.getEntityDescriptor(n),index:a}})):o.push(new fF({actionType:"add",entity:t.getEntityDescriptor(s)}))}const a=new t.transactionModelClass({description:t._currentTransactionDescription,actions:o,occurredAt:t._transactionStart});t.changeStore.add(a)}set transactionDescription(e){this._currentTransactionDescription=e}get hasChanges(){var e,t;return(null===(e=this._currentStmTransaction)||void 0===e||null===(t=e.queue)||void 0===t?void 0:t.length)>0}get hasUnattachedTransactions(){return this.changeStore.find((e=>null==e.versionId))}get isComparing(){return null!=this._comparingVersionId}}bF._$name="Versions",Ed.registerFeature(bF,!1,"SchedulerPro");class CF{static $name="ChangeLogPropertyUpdate";constructor({property:e,before:t,after:n}){Object.assign(this,{property:e,before:t,after:n}),Object.freeze(this)}}CF._$name="ChangeLogPropertyUpdate";var SF=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const DF=Symbol("CycleSymbol");class wF extends RR{constructor(){super(...arguments),this.failedResolutionReferences=new Map}}class EF extends PR{constructor(){super(...arguments),this.candidateClass=wF}initialize(e){var t;null!==(t=e.graph.project)&&void 0!==t&&t.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,t,...n){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach(((e,t)=>{this.write(t,e)})),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,t,...n)}}class xF extends(Ty([BR],(t=>{const n=t.prototype;return class extends t{constructor(){super(...arguments),this.baseRevision=wF.new(),this.transactionClass=EF,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=MF,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1,this.transactionChainEntries=new Set}get dirty(){const e=this.activeTransaction;return e.entries.size>0&&(e.hasVariableEntry||e.hasEntryWithProposedValue)}onPropagationProgressNotification(e){var t,n;this.enableProgressNotifications&&this.project&&(null===(t=(n=this.project).trigger)||void 0===t||t.call(n,"progress",e))}async commitAsync(e){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const t=this.project.beforeCommitAsync();return t||n.commitAsync.call(this,e)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(e){super.isInitialCommit=e}write(e,t,...r){var i;const s=null===(i=e.field)||void 0===i?void 0:i.name,o=e.self;if(s&&o){var a,l;const i=null===(a=o.beforeChronoFieldSet)||void 0===a?void 0:a.call(o,s,t);n.write.call(this,e,t,...r),null===(l=o.afterChronoFieldSet)||void 0===l||l.call(o,s,t,i)}else n.write.call(this,e,t,...r)}async finalizeCommitAsync(e){const{project:t}=this;if(!t||t.isDestroyed)return;const{entries:n,transaction:i}=e,s=new Set;r.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:o,silenceInitialCommit:a}=this;if(!0===t.finalizeCommitHook(o)){for(const e of n.values())this.transactionChainEntries.add(e);return}const l=o&&a;if(o&&(t.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),t.isWritingData=!0,t.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&t.trigger("progress",{total:n.size,remaining:0,phase:"finalizing"}),i.rejectedWith&&t.trigger("commitRejected",{transactionResult:e,isInitialCommit:o,silenceCommit:l}),t.trigger("refresh",{isInitialCommit:o,isCalculated:!0}),await QE(0),!t.isDestroyed){if(e.transaction.rejectedWith)t.isWritingData=!1;else{var c,d;null===(c=t.suspendChangeTracking)||void 0===c||c.call(t),r.DEBUG&&console.time("Finalize propagation");const i=new Set,a=this.transactionChainEntries.size?this.transactionChainEntries:n.values();for(const e of a){const t=e.identifier,n=e.getValue(),{field:r}=t;if(e.isShadow()||!t[bT]||n===tR||r instanceof yT||r.ignore)continue;const o=t.self,a=o.firstStore;i.has(o)||(o.beginBatch(!0),i.add(o)),null!=a&&a.autoCommit&&!s.has(a)&&(a.suspendAutoCommit(),s.add(a)),o.meta.batchChanges[r.name]=n}let u=!1;for(const e of i)if(!e.triggerBeforeUpdate({...e.meta.batchChanges})){u=!0;break}if(u){for(const e of i)e.cancelBatch();e.transaction.reject(),t.trigger("commitRejected",{transactionResult:e,isInitialCommit:o,silenceCommit:l}),t.trigger("refresh",{isInitialCommit:o,isCalculated:!0})}else for(const e of i)e.ignoreBag=l||t.ignoreRecordChanges,e.generation++,e.endBatch(l,!0,!0),e.ignoreBag=!1;t.ignoreRecordChanges=!1,r.DEBUG&&console.timeEnd("Finalize propagation"),t.isWritingData=!1,u||t.trigger("dataReady",{records:i,isInitialCommit:o}),null===(d=t.resumeChangeTracking)||void 0===d||d.call(t,l),s.forEach((e=>e.resumeAutoCommit())),l&&(t.eventStore.acceptChanges(),t.dependencyStore.acceptChanges(),t.resourceStore.acceptChanges(),t.assignmentStore.acceptChanges(),t.calendarManagerStore.acceptChanges(),t.acceptChanges())}this.transactionChainEntries.clear(),t.trigger("commitFinalized",{isInitialCommit:o,transactionResult:e})}}*onComputationCycleHandler(t){if("effect"!==this.onComputationCycle)return yield*super.onComputationCycleHandler(t);{const n=this.project.cycleEffectClass.new({cycle:t});(yield n)===e.EffectResolutionResult.Cancel&&(yield dx(n))}}onComputationCycleHandlerSync(e,t){if("effect"===this.onComputationCycle){throw this.project.cycleEffectClass.new({cycle:e})}return super.onComputationCycleHandlerSync(e,t)}async[DF](e,t){return this.project.onCycleSchedulingIssue(e,t)}async[XT](e,t){return t.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(e,t)}async[ik](e,t){return t.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(e,t)}[lx](e,t){return super[lx](e,t)}}}))){}class RF extends(rt(YT)){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}}class TF extends(rt(ye)){static get $name(){return"CycleEffectDescription"}static getDescription(e){return Kb(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const t=e.getEvents().slice();return t.push(t[0]),'"'+t.map((e=>e.name||"#"+e.id)).join('" -> "')+'"'}}class MF extends qT{constructor(){super(...arguments),this.handler=DF}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach((({context:t})=>e.add(t))),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,t,n){return e.fromEvent===t&&e.toEvent===n}getDependencyForSourceAndTargetEvents(e,t){return this.getEvents()[0].project.getDependencyStore().find((n=>this.matchDependencyBySourceAndTargetEvent(n,e,t)))}getDependencies(){if(!this._dependencies){const e=new Set,t=this.getEvents(),n=t.length;let r,i=t[0];if(1===n)(r=this.getDependencyForSourceAndTargetEvents(i,i))&&e.add(r);else for(const n of t)for(const i of t)(r=this.getDependencyForSourceAndTargetEvents(n,i))&&e.add(r),(r=this.getDependencyForSourceAndTargetEvents(i,n))&&e.add(r);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}}SF([JE("cycle")],MF.prototype,"type",void 0),SF([JE(TF)],MF.prototype,"_descriptionBuilderClass",void 0),SF([JE(RF)],MF.prototype,"removeDependencyCycleEffectResolutionClass",void 0);class kF extends ky{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error(`Entity with name [${String(t)}] already exists`);return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=IF(e);return this.addEntity(t),e}}}const IF=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return XR(e.prototype)};var AF=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class FF extends(Ty([AT],(e=>{e.prototype;class t extends e{*calculateUnitsInMs(){const e=yield this.$.hoursPerDay,t=yield this.$.daysPerWeek,n=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:60*e*60*1e3,week:t*e*60*60*1e3,month:n*e*60*60*1e3,quarter:3*n*e*60*60*1e3,year:12*n*e*60*60*1e3}}convertDuration(e,t,n){let r=e;return t!==n&&(r=e*this.unitsInMs[t]/this.unitsInMs[n]),r}*$convertDuration(e,t,n){if(!t||!n)throw new Error("Conversion unit not provided");const r=yield this.$.unitsInMs;let i=e;return t!==n&&(i=e*r[t]/r[n]),i}}return AF([JR()],t.prototype,"unitsInMs",void 0),AF([TT({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),AF([TT({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),AF([TT({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),AF([QR("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}))){}class PF extends(Ty([AT,mS],(t=>{t.prototype;return class extends t{get isDelayingCalculation(){return Boolean(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(e){}acceptChanges(){}finalizeCommitHook(e){return!1}async commitAsync(){var e;return this.delayedCalculationPromise||(null===(e=this.replica)||void 0===e?void 0:e.commitAsync())}getSchedulingIssueEventArguments(e,t,n,r){const i=[e.type,{continueWithResolutionResult:n,schedulingIssue:e}];return e instanceof ok&&(i[1].conflict=e),i}async onSchedulingIssueCall(t,n){return t.type&&this.hasListener(t.type)?new Promise(((e,r)=>{this.trigger(...this.getSchedulingIssueEventArguments(t,n,e,r))})):e.EffectResolutionResult.Cancel}async onCycleSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}async onEmptyCalendarSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}async onConflictSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}setModelCalculations(e,t){if(!t)return;const n={};for(const r in t)n[r]=e.prototype.$calculations[r];return Object.assign(e.prototype.$calculations,t),n}setRecordCalculations(e,t){const n=this.setModelCalculations(e.constructor,t),r=e.$entity.$skeleton;return Object.keys(t).forEach((n=>{r[n].prototype.calculation=e[t[n]]})),n}setStoreCalculations(e,t){if(!t)return;const n=e.first;return n?this.setRecordCalculations(n,t):this.setModelCalculations(e.modelClass,t)}async setCalculations(e){this.replica&&await this.commitAsync();const t={},n={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(n).forEach((r=>{e[r]&&(t[r]=this.setStoreCalculations(n[r],e[r]))}));let r=e.project;return r&&(t.project=this.setRecordCalculations(this,r)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),t}}}))){}class OF{constructor(){this.ongoing=Promise.resolve(),this.handleReject=()=>{}}queue(e,t=this.handleReject){const n=this.ongoing.then(e);return this.ongoing=n.catch(t),n}}OF._$name="Queue";var LF=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class $F extends(My([PF,qM,dk,UM,FF,GM],(t=>{const n=t.prototype;class s extends t{construct(e={}){this.delayCalculation=!1!==e.delayCalculation,this.enableProgressNotifications=e.enableProgressNotifications||!1!==e.delayCalculation,this._queue=new OF,"expanded"in e||(e.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in e||(e.skipNonWorkingTimeWhenSchedulingManually=!1),n.construct.call(this,e),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in e&&e.ignoreInitialCommitComputationCycles,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore);Boolean(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some((e=>e.allCount>0))}enterReplica(e){const t=this;t.replica||(t.replica=t.createReplica(),t.replica.addEntity(t),t.replica.addEntity(t.defaultCalendar),t.trigger("graphReady")),e&&!t.isRepopulatingStores&&(t.calendarManagerStore.forEach((e=>{!e.graph&&e.joinProject()}),i,{includeFilteredOutRecords:!0}),t.eventStore.forEach((e=>{!e.graph&&e.joinProject()}),i,{includeFilteredOutRecords:!0}),t.resourceStore.forEach((e=>{!e.graph&&e.joinProject()}),i,{includeFilteredOutRecords:!0}),t.dependencyStore.forEach((e=>{!e.graph&&e.joinProject()}),i,{includeFilteredOutRecords:!0}),t.assignmentStore.forEach((e=>{!e.graph&&e.joinProject()}),i,{includeFilteredOutRecords:!0}))}resetStmQueue(){const e=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),e||this.stm.enable()}doDestroy(){var e,t,r,i,s,o,a,l;const c=this;null===(e=c.eventStore)||void 0===e||e.destroy(),null===(t=c.dependencyStore)||void 0===t||t.destroy(),null===(r=c.assignmentStore)||void 0===r||r.destroy(),null===(i=c.resourceStore)||void 0===i||i.destroy(),null===(s=c.calendarManagerStore)||void 0===s||s.destroy(),null===(o=c.defaultCalendar)||void 0===o||o.destroy(),null===(a=c.replica)||void 0===a||a.clear(),null===(l=c.stm)||void 0===l||l.destroy(),n.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:kF.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:e.ReadMode.CurrentOrProposedOrPrevious}}createReplica(){return xF.mix(BR).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return e.ProjectType.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(e){this._enableProgressNotifications=e,this.replica&&(this.replica.enableProgressNotifications=e)}getDefaultCycleEffectClass(){return MF}getDefaultEventModelClass(){return QM}getDefaultEventStoreClass(){return jI}getDefaultDependencyModelClass(){return lM}getDefaultDependencyStoreClass(){return hM}getDefaultResourceModelClass(){return zI}getDefaultResourceStoreClass(){return tA}getDefaultAssignmentModelClass(){return _T}getDefaultAssignmentStoreClass(){return zT}getDefaultCalendarModelClass(){return ZT}getDefaultCalendarManagerStoreClass(){return sM}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some((e=>e.syncDataOnLoad))}async loadInlineData(e){const{calendarManagerStore:t,eventStore:n,dependencyStore:i,assignmentStore:s,resourceStore:o,replica:a}=this;if(this.isInitialCommitPerformed)for(;this.replica.isCommitting;)await this.commitAsync();else null==a||a.unScheduleAutoCommit();null!=a&&a.enableProgressNotifications&&!this.delayCalculation&&(await QE(0),await this.commitAsync(),a.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await QE(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,r.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),!this.delayCalculation||this.delayedCalculationPromise||this.usingSyncDataOnLoad()||this.scheduleDelayedCalculation(),e.calendarsData&&(this.repopulateStore(t),t.data=e.calendarsData),(e.eventsData||e.tasksData)&&(this.repopulateStore(n),n.data=e.eventsData||e.tasksData),e.dependenciesData&&(this.repopulateStore(i),i.data=e.dependenciesData),e.resourcesData&&(this.repopulateStore(o),o.data=e.resourcesData),e.assignmentsData&&(this.repopulateStore(s),s.data=e.assignmentsData),e.project&&this.applyProjectResponse(e.project),r.DEBUG&&console.timeEnd("Populating project");const l=await this.commitLoad();return this.isLoadingInlineData=!1,l}setupTemporaryIndices(){const{storage:e}=this.assignmentStore||{};e&&(e.addIndex({property:"event",unique:!1}),e.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:e}=this.assignmentStore;e.removeIndex("event"),e.removeIndex("resource")}async internalDelayCalculation(e){const t=this;if(t.delayEnteringReplica=!0,t.setupTemporaryIndices(),await QE(0),t.isDestroyed)return void e();if(t.trigger("delayCalculationStart"),t.trigger("refresh",{isCalculated:!1}),await QE(0),t.isDestroyed)return void e();t.delayEnteringReplica=!1,t.isRepopulatingStores?t.repopulateReplica.now():(t.trigger("recordsUnlinked"),t.enterReplica(!0));const n=await t.replica.commitAsync();t.isDestroyed?e():(e(n),t.delayedCalculationPromise=null,t.trigger("delayCalculationEnd"),t.removeTemporaryIndices())}scheduleDelayedCalculation(){return this.delayedCalculationPromise?this.delayedCalculationPromise:!1!==this.delayCalculation?this.delayedCalculationPromise=new Promise((e=>this.internalDelayCalculation(e).then())):void 0}async commitLoad(){const e=await this.commitAsync();return this.isDestroyed||this.trigger("load"),e}initializeStm(){const e=this.stmClass||Bh;this.stm instanceof Bh||this.setStm(e.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:e,silenceCommit:t}){var n,r;const i=new Map;for(const t of e.entries.values()){var s;const n=t.identifier,{field:r}=n;if(t.isShadow()||!n[bT]||r instanceof yT)continue;const o=n.self,a=o.firstStore;!a||t.previous||null!==(s=e.transaction.getLatestStableEntryFor(o.$$))&&void 0!==s&&s.previous||(i.has(a)?i.get(a).has(o)||i.get(a).add(o):i.set(a,new Set([o])))}null===(n=this.suspendChangeTracking)||void 0===n||n.call(this);Array.from(i.keys()).sort(((e,t)=>e.removalOrder-t.removalOrder)).forEach((e=>e.remove(i.get(e)))),null===(r=this.resumeChangeTracking)||void 0===r||r.call(this,t),t&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(e){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(e),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:e}=this;this._stmDisabled=e.disabled,e.isRecording&&e.autoRecord&&(this._stmAutoRecord=!0,e.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:e}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:e}){this.replica&&(this.replica.isWritingPreviousData=!1);const t=e;t.disable(),await this.commitAsync(),this.isDestroyed||(t.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(e,t,n){this.isRepopulatingStores?(this.detachListeners(e),this.ion({name:e,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||t(...n)},once:!0}})):t(...n)}get isRepopulatingStores(){var e;return Boolean(null===(e=this.repopulateStores)||void 0===e?void 0:e.size)}repopulateStore(e){const t=this;var n;t.repopulateOnDataset&&e.allCount&&!e.syncDataOnLoad&&(null===(n=t.replica)||void 0===n||n.activeTransaction.stop(),t.repopulateStores||(t.repopulateStores=new Set),t.repopulateStores.add(e),t.repopulateReplica())}repopulateReplica(){const e=this;if(e.delayEnteringReplica)return;const{calendarManagerStore:t,eventStore:n,dependencyStore:r,assignmentStore:i,resourceStore:s,replica:o}=e;o?(e.unlinkStoreRecords(t,n,r,s,i),e.unlinkRecord(e),e.unlinkRecord(e.defaultCalendar),e.trigger("recordsUnlinked"),o.clear()):e.trigger("recordsUnlinked");const a=e.replica=e.createReplica();a.addEntity(e),a.addEntity(e.defaultCalendar),e.joinStoreRecords(t,!0),e.joinStoreRecords(n,!0),e.joinStoreRecords(r,!0),e.joinStoreRecords(s,!0),e.joinStoreRecords(i,!0),e.repopulateStores.clear(),e.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(e){if(null!=e&&e.graph){const{activeTransaction:n}=this.replica,{$:r}=e,s=Object.keys(r);for(let e=0;e<s.length;e++){const o=r[s[e]],a=n.getLatestEntryFor(o);if(a){let e=a.getValue();var t;if(e===i&&(e=a.proposedValue),e!==i)o.DATA=o.field instanceof vT?(null===(t=e)||void 0===t?void 0:t.id)??e:e}}e.graph=null}}unlinkStoreRecords(...e){e.forEach((e=>{this.repopulateStores.has(e)&&!e.syncDataOnLoad||e.traverse((e=>{this.unlinkRecord(e)}),!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}))}getGraph(){return this.replica}async addEvents(e){return this.eventStore.add(e),this.commitAsync()}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}includeEvent(e){this.eventStore.add(e)}async removeEvents(e){return this.eventStore.remove(e),this.commitAsync()}excludeEvent(e){this.eventStore.remove(e)}async removeEvent(e){return this.eventStore.remove(e),this.commitAsync()}getStm(){return this.stm}setStm(e){this.stm=e,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveDataOrVisualCalendar(e){let t=yield this.$.calendar;return t?yield t.$.version:t=this.defaultCalendar,t}joinStoreRecords(e,t=!1){const n=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(n,t,!0):e.forEach(n,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((n=>{n!==e.rootNode&&t(n)}),!1,!0):e.forEach(t,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(e){const t=this.eventStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t);const n=t.assignmentsForRemoval;n.forEach((t=>{const r=t.event;if(r){const i=e.getById(r.id);i&&(t.event=i,n.delete(t))}})),t.afterEventRemoval()}if(e&&e instanceof ao)this.eventStore=e,e.setProject(this),this.stm.addStore(e),e.tree&&e.rootNode!==this?(this.appendChild(e.rootNode.children||[]),e.rootNode=this):this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.eventStoreClass;this.eventStore=new t(Xt.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(e){const t=this.dependencyStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.detachStore(t)),e&&e instanceof ao)this.dependencyStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.dependencyStoreClass;this.dependencyStore=new t(Xt.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(e){const t=this.resourceStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t);const n=t.assignmentsForRemoval;n.forEach((t=>{const r=t.resource;if(r){const i=e.getById(r.id);i&&(t.resource=i,n.delete(t))}})),t.afterResourceRemoval()}if(e&&e instanceof ao)this.resourceStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.resourceStoreClass;this.resourceStore=new t(Xt.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(e){const t=this.assignmentStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t)),e&&e instanceof ao)this.assignmentStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.assignmentStoreClass;this.assignmentStore=new t(Xt.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},e||{}))}this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(e){const t=this.calendarManagerStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.detachStore(t)),e&&e instanceof ao)this.calendarManagerStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e));else{const t=(null==e?void 0:e.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new t(Xt.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...e){return!0}rejectStmTransaction(e){(e=e||this.stm).transaction&&(e.transaction.length?(e.forEachStore((e=>e.beginBatch())),e.rejectTransaction(),e.forEachStore((e=>e.endBatch()))):e.stopTransaction())}async tryPropagateWithChanges(e){const t=this.stm,n=t.disabled,r=t.autoRecord;return this.queue((async()=>{n?t.enable():(r&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction()),t.startTransaction(),e();let i=!0;try{i=!(await this.commitAsync()).rejectedWith}catch(e){if(!/cycle/i.test(e))throw e;i=!1}return i?(t.stopTransaction(),n&&t.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(t)),t.disabled=n,t.autoRecord=r,i}))}queue(e,t){return this._queue.queue((function(){return e()}),t)}isEngineReady(){const{replica:e}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(!e||!(e.dirty&&(e.hasPendingAutoCommit()||e.isCommitting)))}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return s.applyConfigs=!0,LF([TT({type:"boolean",defaultValue:!0})],s.prototype,"unspecifiedTimeIsWorking",void 0),LF([TT({type:"boolean",defaultValue:!1})],s.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),LF([TT({type:"boolean",defaultValue:!0})],s.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),LF([TT({type:"string",defaultValue:e.Direction.Forward},{sync:!0})],s.prototype,"direction",void 0),s}))){}var _F=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class jF extends(Ty([$F,pk,vk],(t=>{const n=t.prototype;class r extends t{constructor(){super(...arguments),this.isInitialTransaction=!0}construct(e={}){this.eventSegmentModelClass=e.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),n.construct.call(this,e),this.includeAsapAlapAsConstraints=e.includeAsapAlapAsConstraints??!0,this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}finalizeCommitHook(e){return this.isInitialTransaction=!1,!1}getDefaultEventStoreClass(){return jI}getDefaultEventSegmentModelClass(){return eI}getDefaultResourceAllocationInfoClass(){return JI}afterConfigure(){n.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||Dk,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||Ak}getType(){return e.ProjectType.SchedulerPro}getDefaultCycleEffectClass(){return VF}getDefaultEventModelClass(){return LI}getDefaultDependencyModelClass(){return dM}getDefaultAssignmentModelClass(){return BT}getDefaultResourceModelClass(){return QI}async validateDependency(t,n,r,i){let s;i&&(s=Array.isArray(i)?i:[i]);return gy(t.outgoingDeps).some((e=>{var t;return e.toEvent===n&&!(null!==(t=s)&&void 0!==t&&t.includes(e))}))?e.DependencyValidationResult.DuplicatingDependency:await this.isDependencyCyclic(t,n,r,s)?e.DependencyValidationResult.CyclicDependency:e.DependencyValidationResult.NoError}*calculateDurationPure(){const e=yield this.$.startDate,t=yield this.$.endDate;return e&&t?e>t?0:yield*super.calculateDurationPure():null}async isValidDependency(t,n,r,i){return await this.validateDependency(t,n,r,i)===e.DependencyValidationResult.NoError}getDependencyCycleDetectionIdentifiers(e,t){return[t.$.earlyStartDateConstraintIntervals,t.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(e,t,n,r){const i=new(0,this.getDependencyStore().modelClass)({fromEvent:e,toEvent:t,type:n}),s=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});r&&(Array.isArray(r)||(r=[r]),r.forEach((e=>s.removeEntity(e)))),s.addEntity(i),i.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(e,t).map((e=>s.readAsync(e)))),!1}catch(e){if(/cycle/i.test(e))return!0;if(!/conflict/i.test(e))throw e}finally{s.clearBranch()}}async isValidDependencyModel(e,t){return this.isValidDependency(e.fromEvent,e.toEvent,e.type,t)}}return _F([TT({type:"string",defaultValue:e.DependenciesCalendar.ToEvent})],r.prototype,"dependenciesCalendar",void 0),_F([TT({type:"boolean",defaultValue:!0})],r.prototype,"autoCalculatePercentDoneForParentTasks",void 0),_F([TT({type:"boolean",defaultValue:!0})],r.prototype,"addConstraintOnDateSet",void 0),r}))){}class BF extends(rt(YT)){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}}class VF extends MF{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter((e=>e.fromEvent===e.toEvent||e.fromEvent.contains(e.toEvent)||e.toEvent.contains(e.fromEvent)))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,t,n){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,t,n)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),t=[];for(const n of e)t.push(...this.buildInvalidDependencyResolutions({dependency:n}));e.length||t.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=t}return this._resolutions}}_F([JE(BF)],VF.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),_F([JE(Mk)],VF.prototype,"removeDependencyConflictResolutionClass",void 0),_F([JE(kk)],VF.prototype,"deactivateDependencyConflictResolutionClass",void 0);const HF=(e,t,n)=>{const r=n.getFieldDefinition(e===n.constructor.idField?"id":e),{dataSource:i}=r,s=n.constructor.processField(e,t[i],n);return i in t&&!r.isEqual(s,n.getValue(e))};var NF=e=>class extends(e||ye){startConfigure(e){this.getConfig("project"),super.startConfigure(e)}beforeApplyProjectChanges(){const{stm:e}=this;let t=!1,n=null;return this.suspendChangeTracking(),e.enabled&&(t=!0,e.isRecording&&(n=e.stash()),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),{shouldResume:t,transactionId:n}}async applyProjectChanges(e){const t=this,{shouldResume:n,transactionId:r}=t.beforeApplyProjectChanges();t.trigger("startApplyChangeset"),t.applyingChangeset=!0,e.project&&t.applyProjectResponse(e.project),t.applyChangeset(Xt.clone(e),((e,t)=>{if("tasks"===t.id||"events"===t.id){const{modelClass:n}=t,r=n.getFieldDataSource("startDate"),i=n.getFieldDataSource("endDate");if(e.updated)for(const s of e.updated){const e=t.getById(s[n.idField]);HF("constraintType",s,e)||HF("constraintDate",s,e)||(delete s[r],delete s[i])}}})),await t.commitAsync(),t.commitRespondedChanges();for(const n in e){const r=t.getStoreDescriptor(n);if(r){const{store:t}=r,i=e[n],s=[...i.updated??[],...i.added??[]];if(t)for(const e of s){const n=t.getById(e[t.modelClass.idField]);if(n)for(const t in n.modifications)HF(t,e,n)||delete n.meta.modified[t]}}}t.afterApplyProjectChanges(n,r),t.applyingChangeset=!1,await t.commitAsync(),t.trigger("endApplyChangeset")}afterApplyProjectChanges(e,t){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash(t)}this.resumeChangeTracking()}};class zF extends(NF(uA(IC(jF)))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:iM,dependencyModelClass:uM,eventModelClass:_I,assignmentModelClass:NT,resourceModelClass:eA,calendarManagerStoreClass:oM,dependencyStoreClass:gM,eventStoreClass:VI,assignmentStoreClass:WT,resourceStoreClass:nA,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:oA}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}}zF._$name="ProjectModel";var WF=e=>class extends(e||ye){static configurable={wsAddress:null,wsUserName:"",wsAutoLoad:!0,wsAutoSync:!0,wsConnectionTimeout:6e4,wsProjectId:null};doDestroy(){var e;null===(e=this.websocketManager)||void 0===e||e.destroy(),super.doDestroy()}updateWsAddress(e){var t;const n=this;null===(t=n.websocketManager)||void 0===t||t.destroy(),e&&(n.websocketManager=new Cg({address:e,userName:n.wsUserName,internalListeners:{message:"handleWebsocketMessage",close:"handleWebsocketClose",error:"handleWebsocketError",thisObj:n}}),n.wsAutoLoad&&n.wsLoad()),n.toggleAutoSyncListener()}toggleAutoSyncListener(){const e=this;e.detachListeners("websocketlisteners"),e._wsAutoSync&&e._wsAddress&&e.ion({name:"websocketlisteners",hasChanges:"scheduleWebsocketMessage"})}updateWsAutoSync(){this.toggleAutoSyncListener()}updateWsProjectId(e){null!=e&&this.wsAutoLoad&&this.wsLoad()}scheduleWebsocketMessage(){const e=this;e.hasTimeout("wsAutoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"wsAutoSync",fn:()=>{e.wsSync()},delay:e.autoSyncTimeout})}resumeAutoSync(e=!0){super.resumeAutoSync(e),this.websocketManager&&!this.isAutoSyncSuspended&&this.changes&&this.wsSync()}async wsSend(e,t,n=!1){return!!await this.wsOpen()&&(this.websocketManager.send(e,t),n||this.trigger("wsSendMessage",{command:e,data:t}),!0)}wsReceive(e){}handleWebsocketClose(){this.trigger("wsClose")}handleWebsocketError({error:e}){this.trigger("wsError",{error:e})}async handleWebsocketMessage({data:e}){const t=this,{wsProjectId:n}=t,{project:r}=e;if(t.trigger("wsMessage",{data:e}),r===n&&"projectChange"===e.command)t.trigger("wsBeforeReceiveChanges"),await t.queue((()=>t.applyProjectChanges(e.changes))),t.trigger("wsReceiveChanges");else if(r===n&&"dataset"===e.command)await t.loadInlineData(e.dataset),t.trigger("wsReceiveDataset");else if(r===n&&"versionAutoSaveOK"===e.command)t.trigger("wsVersionAutoSaveOK");else if(r===n&&"loadVersionContent"===e.command){const{versionId:n,project:r,content:i}=e;t.trigger("loadVersionContent",{versionId:n,project:r,content:i})}else t.wsReceive(e)}async wsOpen(){const{websocketManager:e}=this;if(e){return!e.isOpened&&await e.open()&&this.trigger("wsOpen"),e.isOpened}return!1}async wsLoad(){const e=this;null!=e.wsProjectId&&(await e.wsSend("dataset",{project:e.wsProjectId}),await new Promise((t=>{const n=e.ion({wsReceiveDataset(){n(),t(!0)},expires:{delay:e.wsConnectionTimeout,alt:()=>{n(),t(!1)}}})})),await e.commitAsync(),e.trigger("wsLoad"))}async wsSync(){const e=this,{wsProjectId:t}=e;if(null==t)return;await this.commitAsync();const{changes:n}=this;if(n&&e.wsAutoSync&&!e.autoSyncSuspendCounter){e.acceptChanges();await e.wsSend("projectChange",{project:t,changes:n})&&e.trigger("wsSendChanges")}}wsClose(){var e;null===(e=this.websocketManager)||void 0===e||e.close()}},UF=e=>class extends(e||ye){static get $name(){return"ProjectProgressMixin"}static configurable={projectProgressReporting:"auto",projectProgressThreshold:5e3};updateProject(e,t){super.updateProject(e,t),this.setupProgressListener(),this.detachListeners("delayedCalculation"),null!=e&&e.delayCalculation&&e.ion({name:"delayedCalculation",delayCalculationStart:"internalOnProjectDelayCalculationStart",delayCalculationEnd:"internalOnProjectDelayCalculationEnd",thisObj:this})}setupProgressListener(){const e=this;var t;(e.detachListeners("projectProgress"),e.projectProgressReporting)&&(null===(t=e.project)||void 0===t||t.ion({name:"projectProgress",progress:"onProjectProgress",thisObj:e}))}updateProjectProgressReporting(){this.isConfiguring||this.setupProgressListener()}onProjectProgress({total:e,remaining:t,phase:n="propagating"}){const r=this;if(!r.isPainted)return;if(e<r.projectProgressThreshold)return;let i=r.projectProgressReporting;if("auto"===i&&(i=r.project.delayCalculation?"progressbar":"mask"),"progressbar"===i){let n=r.calculationProgressElement;n||(n=r.calculationProgressElement=Br.createElement({parent:r.timeAxisSubGrid.header.element,retainElement:!0,className:"b-calculation-progress-wrap",children:[{className:"b-calculation-progress"}]})),n.firstElementChild.style.width=(e-t)/e*100+"%",e>0&&0===t?r.calculationProgressTimeout=r.setTimeout((()=>{var e;null===(e=n)||void 0===e||e.remove(),r.calculationProgressElement=null}),50):r.clearTimeout(r.calculationProgressTimeout)}else{const i=r.L(`L{SchedulerProBase.${n}}`),s=e?`${i} ${Math.round(100*(e-t)/e)}%`:i;r.masked||r.mask({maxProgress:e,useTransition:!1,text:s}),r.masked.text=s,e&&(r.masked.maxProgress=e,r.masked.progress=e-t),e>0&&0===t&&r.unmask()}}internalOnProjectDelayCalculationStart(){this.readOnly||(this.$delayCalculationReadOnly=this.readOnly=!0)}internalOnProjectDelayCalculationEnd(){this.$delayCalculationReadOnly&&(this.$delayCalculationReadOnly=this.readOnly=!1)}get widgetClass(){}},GF=e=>class extends(e||ye){static get $name(){return"SchedulerProEventRendering"}static get configurable(){return{eventLayout:"stack",horizontalLayoutPackClass:pA,horizontalLayoutStackClass:mA}}updateInternalEventLayout(e,t){const n=this;n.isConfiguring||n.clearLayouts(),super.updateInternalEventLayout(e,t)}getEventLayout(e){return"layoutFn"in(e=super.getEventLayout(e))&&(e.type="layoutFn"),e}clearLayouts(){const e=this;if(e.layouts)for(const t in e.layouts)e.layouts[t].destroy(),delete e.layouts[t]}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:r}=t;t.layouts||(t.layouts={});const{layouts:i}=t;switch(e.type){case"stack":return i.horizontalStack||(i.horizontalStack=t.horizontalLayoutStackClass.new({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r,groupByThisObj:t},e)),i.horizontalStack;case"pack":return i.horizontalPack||(i.horizontalPack=t.horizontalLayoutPackClass.new({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r,groupByThisObj:t},e)),i.horizontalPack;case"layoutFn":return{type:"layoutFn",scheduler:t,applyLayout:e.layoutFn,layoutEventsInBands:e.layoutFn};default:return null}}get widgetClass(){}};class YF extends ic{static get $name(){return"SchedulingIssueResolutionPopup"}static get type(){return"schedulingissueresolutionpopup"}static get configurable(){return{localizableProperties:[],schedulingIssue:null,align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onCloseButtonClick",modal:!0,centered:!0,scrollAction:"realign",constrainTo:r,draggable:!1,closable:!0,floating:!0,cls:"b-schedulerpro-issueresolutionpopup",layout:"vbox",resolutionsGroup:{type:"radiogroup",name:"resolutions"},items:{description:{type:"widget",cls:"b-error-description",weight:-100}},bbar:{defaults:{localeClass:this},items:{applyButton:{weight:100,color:"b-raised b-blue",text:"L{Apply}",onClick:"up.onApplyButtonClick",disabled:!0},cancelButton:{weight:200,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get selectedResolutions(){var e,t;const n=new Set,r=null===(e=this.resolutionsGroup)||void 0===e||null===(t=e.selected)||void 0===t?void 0:t.resolution;return r&&n.add(r),n}changeResolutionsGroup(e,t){return xp.reconfigure(t,e,this)}updateResolutionsGroup(e){e&&this.add(e)}getResolutionParameters(e){return[]}onApplyButtonClick(){const t=this,{selectedResolutions:n}=t;n.size?(n.forEach((e=>e.resolve(...t.getResolutionParameters(e)))),t.continueWithResolutionResult(e.EffectResolutionResult.Resume),t.doResolve(n)):t.onCancelButtonClick()}onCancelButtonClick(){this.continueWithResolutionResult(e.EffectResolutionResult.Cancel),this.doResolve()}onCloseButtonClick(){this.canCancel&&this.onCancelButtonClick()}get isResolving(){return Boolean(this.resolving)}async resolve({source:e,schedulingIssue:t,continueWithResolutionResult:n}){const r=this;return r.project=e,r.schedulingIssue=t,r.continueWithResolutionResult=n,r.updatePopupContent(t,n),r.onResolutionChange({}),r.show(),r.resolving=new zo,r.resolving.promise}doResolve(e){const t=this,{resolving:n}=t;n&&(t.resolving.resolve(e),t.resolving=null,t.schedulingIssue=null,t.hide())}getResolutionWidgetConfig(e){return{text:$.encodeHtml(e.getDescription()),cls:"b-resolution",checkedValue:e.$$name,localeClass:this,name:"resolutions",internalListeners:{change:"up.onResolutionChange"},resolution:e}}getResolutions(){var e;return null===(e=this.schedulingIssue)||void 0===e?void 0:e.getResolutions()}updatePopupContent(e,t){var n,r;const i=this,{resolutionsGroup:s}=i;t&&(i.continueWithResolutionResult=t),e?i.schedulingIssue=e:e=i.schedulingIssue,i.title=null!==(n=e)&&void 0!==n&&n.type?i.optionalL(e.type):"Unknown error",i.widgetMap.description.content=e&&$.encodeHtml(e.getDescription());const o=i.getResolutions(),a=(null==o?void 0:o.map((e=>i.getResolutionWidgetConfig(e))))||[],l=(null===(r=a[0])||void 0===r?void 0:r.name)||"resolutions";s.removeAll(),s.name=l,s.add(...a,{ref:"cancelResolution",text:"L{Cancel changes}",name:l,checkedValue:"cancel",localeClass:this,cls:"b-resolution",internalListeners:{change:"up.onResolutionChange"}}),i.toggleControlsState()}get canApply(){return null!=this.resolutionsGroup.value}get canCancel(){var e;return!(null!==(e=this.project)&&void 0!==e&&e.isInitialCommit)}get cancelResolution(){return this.resolutionsGroup.widgetMap.cancelResolution}onResolutionChange(){this.toggleControlsState()}toggleControlsState(){const e=this,{applyButton:t,cancelButton:n}=e.widgetMap;t.disabled=!e.canApply,e.cancelResolution.hidden=n.hidden=!e.canCancel}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}YF.initClass(),YF._$name="SchedulingIssueResolutionPopup";class qF extends YF{static get $name(){return"CycleResolutionPopup"}static get type(){return"cycleresolutionpopup"}getDependencyTitle(e){return`"${$.encodeHtml(e.fromEvent.name)}" -> "${$.encodeHtml(e.toEvent.name)}"`}getResolutionWidgetConfig(e){const{dependency:t}=e,n=this.schedulingIssue.getInvalidDependencies(),r=super.getResolutionWidgetConfig(e);return n.includes(t)&&Object.assign(r,{name:"dependency-resolution",checked:!this._dependencyResolutionsChecked++}),r}getResolutions(){const{schedulingIssue:e}=this,t=null==e?void 0:e.getInvalidDependencies();let n=null==e?void 0:e.getResolutions();return n&&t.length&&(n=n.filter((e=>e.dependency&&t.includes(e.dependency)))),n}updatePopupContent(e,t){const n=this,{invalidDependenciesDescription:r,dependencyField:i}=n.widgetMap;if(n._dependencyResolutionsChecked=0,super.updatePopupContent(...arguments),null==r||r.hide(),null==i||i.hide(),e=n.schedulingIssue){const t=e.getDependencies(),s=e.getInvalidDependencies(),o=t.filter((e=>!s.includes(e)));if(s.length)r?r.show():n.add({type:"widget",ref:"invalidDependenciesDescription",weight:-50,width:"100%",cls:"b-invalid-dependencies-description",html:n.L("L{invalidDependencyLabel}")});else{const e=null==o?void 0:o.map((e=>({value:e.id,text:n.getDependencyTitle(e)})));i?(i.value=null,i.items=e,i.show()):n.add({type:"combo",ref:"dependencyField",weight:50,width:"100%",name:"dependency",label:n.L("L{dependencyLabel}"),labelPosition:"above",cls:"b-dependency-field",items:e,internalListeners:{change:"up.onDependencyChange"}})}}}get canApply(){const{widgetMap:e}=this;return super.canApply&&(e.cancelResolution.checked||!e.dependencyField||e.dependencyField.value)}onDependencyChange(){this.toggleControlsState()}getResolutionParameters(e){if(e.isRemoveDependencyCycleEffectResolution||e.isDeactivateDependencyCycleEffectResolution){const e=this.widgetMap.dependencyField.value;return[this.project.dependencyStore.getById(e)]}return super.getResolutionParameters(e)}}qF.initClass(),qF._$name="CycleResolutionPopup";var KF=e=>class extends(e||ye){static get $name(){return"SchedulingIssueResolution"}static get configurable(){return{schedulingIssueResolutionPopupClass:YF,cycleResolutionPopupClass:qF,displaySchedulingIssueResolutionPopup:!0}}updateProject(e,t){super.updateProject(e,t),this.unbindSchedulingIssueResolutionFromProject(t),this.displaySchedulingIssueResolutionPopup&&e&&this.bindSchedulingIssueResolutionToProject(e)}bindSchedulingIssueResolutionToProject(e){e.ion({name:"schedulingIssueResolution",schedulingConflict:"onProjectSchedulingIssueEvent",emptyCalendar:"onProjectSchedulingIssueEvent",cycle:"onProjectSchedulingIssueEvent",thisObj:this})}get isResolving(){var e;return null===(e=this._lastSchedulingIssueResolutionPopup)||void 0===e?void 0:e.isResolving}get activeSchedulingIssueResolutionPopup(){return this.isResolving&&this._lastSchedulingIssueResolutionPopup}unbindSchedulingIssueResolutionFromProject(e){this.detachListeners("schedulingIssueResolution")}getSchedulingIssueResolutionPopup(e){return"cycle"===e.type?this._cycleResolutionPopup||(this._cycleResolutionPopup=new this.cycleResolutionPopupClass({rootElement:this.rootElement})):this._schedulingIssueResolutionPopup||(this._schedulingIssueResolutionPopup=new this.schedulingIssueResolutionPopupClass({rootElement:this.rootElement}))}onProjectSchedulingIssueEvent({schedulingIssue:e}){const t=this.getSchedulingIssueResolutionPopup(e);this._lastSchedulingIssueResolutionPopup=t,t.resolve(...arguments)}get widgetClass(){}};function XF(e){return{allocation:{total:e}}}class ZF extends(_E.mixin(_S,PS,XS)){static $name="ResourceHistogram";static type="resourcehistogram";static configurable={projectModelClass:zF,sortFeatureStore:"store",timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourcehistogram-cell",effortFormat:"0.#",getRecordData:"getRecordAllocationData",aggregateDataEntry:"aggregateAllocationEntry",initAggregatedDataEntry:"initAggregatedAllocationEntry",hardRefreshOnTimeAxisReconfigure:!1,showEffortUnit:!0,useProjectTimeUnitsForScale:!1,effortUnit:e.TimeUnit.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},barTooltipTemplate({datum:e}){let t="";const{inEventTimeSpan:n,isGroup:r}=e;return n&&(t=r?this.getGroupBarTip(...arguments):this.getResourceBarTip(...arguments)),t},showBarText:!1,groupBarTipAssignmentLimit:5,includeInactiveEvents:!1,histogramWidget:{cls:"b-hide-offscreen b-resourcehistogram-histogram"},fixedRowHeight:!0};get timeAxis(){return super.timeAxis}set timeAxis(e){const t=this._timeAxis;super.timeAxis=e,this.partner&&!e||t&&t===e||this._timeAxis.ion({name:"timeAxis",endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}afterConfigure(){super.afterConfigure();const e=this;e.onRecordAllocationCalculated=e.onRecordAllocationCalculated.bind(e),e.onCommitAsyncCompletion=e.onCommitAsyncCompletion.bind(e)}onDestroy(){var e,t;super.onDestroy(...arguments);const n=null===(e=(t=this.project).getGraph)||void 0===e?void 0:e.call(t);n&&this.ticksIdentifier&&n.removeIdentifier(this.ticksIdentifier)}clearHistogramDataCache(e){if(!e)for(const[e,r]of null===(t=this.getHistogramDataCache())||void 0===t?void 0:t.entries()){var t,n;null===(n=e.removeEntity)||void 0===n||n.call(e,r)}super.clearHistogramDataCache(...arguments)}bindProject(e){this.detachListeners("resourceHistogramProject"),e.ion({name:"resourceHistogramProject",refresh:"internalOnProjectRefresh",delayCalculationStart:"onProjectDelayCalculationStart",delayCalculationEnd:"onProjectDelayCalculationEnd",repopulateReplica:"onRepopulateReplica",thisObj:this})}updateProject(e){this.bindProject(e),this.crudManager=e,this.store=e.resourceStore}getRowHeight(){return this.rowHeight}convertEffortUnit(e,t,n){return this.project.run("$convertDuration",e,t,n)}updateUseProjectTimeUnitsForScale(){const e=this;if(e.isPainted){const t={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",t),e._generatedScalePoints=e.scalePoints=t.scalePoints,e.scheduleRefreshRows()}}updateShowBarText(e){this.scheduleRefreshRows()}get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}set eventStore(e){super.eventStore=e}convertUnitsToHistogramValue(t,n){return this.useProjectTimeUnitsForScale?this.convertEffortUnit(t,n,e.TimeUnit.Millisecond):Gt.asMilliseconds(t,n)}convertHistogramValueToUnits(t,n){return this.useProjectTimeUnitsForScale?this.convertEffortUnit(t,e.TimeUnit.Millisecond,n):Gt.as(n,t)}buildScalePointText(e){return`${e.value}${Gt.getShortNameOfUnit(e.unit)}`}generateScalePoints(e,t){var n;if(null===(n=this.project)||void 0===n||!n.graph)return;const{timeAxis:r}=this,i=[];let s;e=e||r.increment,t=t||r.unit,1===e&&(t=Gt.getSmallerUnit(t),e=Math.round(this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,r.unit,t):Gt.as(t,e,r.unit)));for(const t of[7,5,4,3,2])if(!(e%t)){s=e/t;break}s||(s=e);for(let t=s;t<=e;t+=s)i.push({value:t});const o=i[i.length-1];return o.unit=t,o.text=this.buildScalePointText(o),i}updateViewPreset(e){const t=this;t._updatingViewPreset=!0,super.updateViewPreset(...arguments),t._updatingViewPreset=!1,t.project.isInitialCommitPerformed&&t.isPainted&&t.onTimeAxisEndReconfigure()}onRepopulateReplica(){this.ticksIdentifier=null,this.clearHistogramDataCache()}buildTicksIdentifier(){const e=this,t=e.project.getGraph();if(e.ticksIdentifier){const n=t.read(e.ticksIdentifier);e.project.clearCombinationsWith(n)}else e.ticksIdentifier=t.addIdentifier(DR.new());return e.ticksIdentifier.writeToGraph(t,new ZT({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map((e=>({startDate:e.startDate,endDate:e.endDate,isWorking:!0})))})),e.collectTicksWidth(),e.ticksIdentifier}onProjectDelayCalculationStart(){this.suspendRefresh()}onProjectDelayCalculationEnd(){this.resumeRefresh(!1)}projectUnitsHasChanged(){const{project:e}=this;return e.daysPerMonth!==this._projectDaysPerMonth||e.daysPerWeek!==this._projectDaysPerWeek||e.hoursPerDay!==this._projectHoursPerDay}internalOnProjectRefresh({source:e,isInitialCommit:t,isCalculated:n}){if(n){const n=this;if(n.ticksIdentifier||n.onTimeAxisEndReconfigure(),n.useProjectTimeUnitsForScale&&n.projectUnitsHasChanged()){n._projectDaysPerMonth=e.daysPerMonth,n._projectDaysPerWeek=e.daysPerWeek,n._projectHoursPerDay=e.hoursPerDay;const t={scalePoints:n.generateScalePoints()};n.trigger("generateScalePoints",t),n._generatedScalePoints=n.scalePoints=t.scalePoints}n.rowManager.topRow&&null!=n.rowManager.topRow.id?t&&n.refreshRows():n.rowManager.reinitialize()}}relayStoreDataChange(e){super.relayStoreDataChange(e),0===this.store.count&&(this.histogramWidget.data=[],this.histogramWidget.refresh())}changeHistogramWidget(e,t){const n=this;if(!t){const{series:t}=n;!n.showMaxEffort&&t.maxEffort&&(t.maxEffort=!1),e=super.changeHistogramWidget(...arguments)}return e}getRectConfig(e,t,n,r){if(t.inEventTimeSpan){const{topValue:n}=this,i=t[r.field],s=r.stretch?1:t.height;return e.height=s||(i>n?n:i)/n,e.y=1-e.height,e}}getRectClassDefault(e,t,n){if("effort"===e.id)switch(!0){case n.isOverallocated:return"b-overallocated";case n.isUnderallocated:return"b-underallocated"}return""}get effortFormatter(){const e=this,t=e.effortFormat;let n=e._effortFormatter;return n&&e._effortFormat===t||(n=bg.get(e._lastFormat=t),e._effortFormatter=n),n}getEffortText(e,t,n=this.showEffortUnit){var r;if(null===(r=this.project)||void 0===r||!r.graph)return;const{scaleUnit:i,effortFormatter:s}=this;t=t||i;const o=Gt.getShortNameOfUnit(t),a=this.convertHistogramValueToUnits(e,t);return s.format(a)+(n?o:"")}getBarTipEffortUnit(){const{effortUnit:e,barTipEffortUnit:t,timeAxis:n}=this,r=t||e;return Gt.compareUnits(n.unit,r)<0?n.unit:r}getGroupBarTip({datum:t}){const n=this,{timeAxis:r}=n;let i="";if(t.inEventTimeSpan){const s=n.getBarTipEffortUnit(...arguments),o=n.getEffortText(t.effort,s),a=n.getEffortText(t.maxEffort,s),l=n.L("L{groupBarTipAssignment}");let c="L",d=n.L("L{groupBarTipInRange}"),u="";0===Gt.compareUnits(r.unit,e.TimeUnit.Day)?d=n.L("L{groupBarTipOnDate}"):Gt.compareUnits(r.unit,e.TimeUnit.Second)<=0?c="HH:mm:ss A":Gt.compareUnits(r.unit,e.TimeUnit.Hour)<=0&&(c="LT");let h=[...t.resourceAllocation.entries()].filter((([e,t])=>t.effort)).sort((([e,t],[n,r])=>t.effort>r.effort?-1:1));h.length>n.groupBarTipAssignmentLimit&&(u="<br>"+n.L("L{plusMore}").replace("{value}",h.length-n.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const g=h.map((([e,t])=>l.replace("{resource}",$.encodeHtml(e.name)).replace("{allocated}",n.getEffortText(t.effort,s)).replace("{available}",n.getEffortText(t.maxEffort,s)).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""))).join("<br>")+u;i=d.replace("{assignments}",g).replace("{startDate}",Gt.format(t.tick.startDate,c)).replace("{endDate}",Gt.format(t.tick.endDate,c)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""),i=`<div class="b-histogram-bar-tooltip">${i}</div>`}return i}getResourceBarTip({datum:t}){const n=this,{timeAxis:r}=n;let i="";if(t.inEventTimeSpan){const s=n.getBarTipEffortUnit(),o=n.getEffortText(t.effort,s),a=n.getEffortText(t.maxEffort,s);let l="L",c=n.L("L{barTipInRange}");0===Gt.compareUnits(r.unit,e.TimeUnit.Day)?c=n.L("L{barTipOnDate}"):Gt.compareUnits(r.unit,e.TimeUnit.Second)<=0?l="HH:mm:ss A":Gt.compareUnits(r.unit,e.TimeUnit.Hour)<=0&&(l="LT"),i=c.replace("{startDate}",Gt.format(t.tick.startDate,l)).replace("{endDate}",Gt.format(t.tick.endDate,l)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""),t.resource&&(i=i.replace("{resource}",$.encodeHtml(t.resource.name))),i=`<div class="b-histogram-bar-tooltip">${i}</div>`}return i}getBarTextEffortUnit(){const{effortUnit:e,barTextEffortUnit:t,timeAxis:n}=this,r=t||e;return Gt.compareUnits(n.unit,r)<0?n.unit:r}getBarTextDefault(e,t){const n=this.owner,{showBarText:r}=n;let i="";if(r&&e.inEventTimeSpan){const t=n.getBarTextEffortUnit();i=n.getEffortText(e.effort,t)}return i}updateShowMaxEffort(e){const t=this;t._showMaxEffort=e;if(!t._histogramWidget)return;const{series:n}=t;e?"object"==typeof e?n.maxEffort=e:"object"==typeof t._seriesMaxEffort?n.maxEffort=t._seriesMaxEffort:n.maxEffort={id:"maxEffort",type:"outline",field:"maxEffort"}:n.maxEffort&&(t._seriesMaxEffort=n.maxEffort,n.maxEffort=!1),t.scheduleRefreshRows()}updateIncludeInactiveEvents(e){var t;null===(t=this.getHistogramDataCache())||void 0===t||t.forEach((t=>t.includeInactiveEvents=e))}onTimeAxisEndReconfigureInternal(){const e=this;if(!e._updatingViewPreset){const{unit:t,increment:n}=e.timeAxis;if(t!==e._lastTimeAxisUnit||n!==e._lastTimeAxisIncrement){e._lastTimeAxisUnit=t,e._lastTimeAxisIncrement=n;const r={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",r),e._generatedScalePoints=e.scalePoints=r.scalePoints}e.buildTicksIdentifier()}}calculateRowHeights(){}onTimeAxisEndReconfigure(){const e=this;e._updatingViewPreset||(e.project.graph?e.onTimeAxisEndReconfigureInternal():e.project.ion({graphReady(){e.onTimeAxisEndReconfigureInternal()},thisObj:e,once:!0}))}extractHistogramDataArray(e,t){return e.allocation.total}renderRows(){const e=this;return!e.ticksIdentifier&&e.project.isInitialCommitPerformed&&(e.onTimeAxisEndReconfigure(),e.timeView.startDate&&e.timeView.endDate||(e.timeView.range={startDate:e.startDate,endDate:e.endDate})),super.renderRows(...arguments)}async shiftPrevious(){super.shiftPrevious(...arguments),await this.project.commitAsync()}async shiftNext(){super.shiftNext(...arguments),await this.project.commitAsync()}onCommitAsyncCompletion(){this.renderScheduledRecords(),this._renderOnCommitPromise=null}onRecordAllocationCalculated(e){this.isDestroying||this.setHistogramDataCache(e.resource,e.owner)}buildResourceAllocationReport(e){return this.project.resourceAllocationInfoClass.new({includeInactiveEvents:this.includeInactiveEvents,ticks:this.ticksIdentifier,resource:e})}async getRecordAllocationData(e){const t=this,{project:n}=t;for(;!t.ticksIdentifier||!n.isInitialCommitPerformed;)await n.await("commitFinalized");if(e.graph){const r=n.getGraph(),i=t.buildResourceAllocationReport(e);return e.addEntity(i),await r.readAsync(i.$.allocation),r.ongoing.then((()=>{r.addListener(i.$.allocation,t.onRecordAllocationCalculated)})),i}}onHistogramDataCacheSet(){super.onHistogramDataCacheSet(...arguments);const e=this;e._renderOnCommitPromise||(e._renderOnCommitPromise=e.project.graph.ongoing.then(e.onCommitAsyncCompletion))}aggregateRecordsHistogramData(e,t){const n=super.aggregateRecordsHistogramData(e,t);return p.isPromise(n)?n.then(XF):XF(n)}initAggregatedAllocationEntry(){return{tick:null,effort:0,maxEffort:0,units:0,isGroup:!0,inEventTimeSpan:!1,resourceAllocation:new Map}}aggregateAllocationEntry(e,t,n,r,i){return e.resourceAllocation.set(t.resource,t),e.tick=t.tick,e.isOverallocated=e.isOverallocated||t.isOverallocated,e.isUnderallocated=e.isUnderallocated||t.isUnderallocated,e.inEventTimeSpan=e.inEventTimeSpan||t.inEventTimeSpan,t.assignments&&(e.assignments?t.assignments.forEach((t=>e.assignments.add(t))):e.assignments=new Set(t.assignments)),e}generateGroupScalePoints(e){const t=this,n=t.getGroupChildren(e),r={scalePoints:t.generateScalePoints(t.timeAxis.increment*n.length),groupParent:e};return t.trigger("generateScalePoints",r),r.scalePoints}processRecordRenderData(e){if(this.isGroupRecord(e.record)){const t=this.generateGroupScalePoints(e.record),n=this.getTopValueByScalePoints(t);e.scaleWidgetConfig={scalePoints:t},e.histogramConfig={...e.histogramConfig,topValue:n}}else e=super.processRecordRenderData(e);return e}updateLocalization(){const e=this;e._generatedScalePoints===e.scalePoints&&e.scalePoints&&e.scalePoints.forEach((t=>{t.text&&t.unit&&(t.text=e.buildScalePointText(t))})),super.updateLocalization(...arguments)}}ZF.initClass(),ZF._$name="ResourceHistogram";class JF extends ZF{static $name="ResourceUtilization";static type="resourceutilization";static configurable={scaleColumn:null,timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourceutilization-cell",rowHeight:30,showEffortUnit:!1,showMaxEffort:!1,showBarText:!0,barTooltipTemplate({datum:e}){let t="";const{inEventTimeSpan:n,isGroup:r,resource:i,assignment:s}=e;return n&&(r?t=this.getGroupBarTip(...arguments):s?t=this.getAssignmentBarTip(...arguments):i&&(t=this.getResourceBarTip(...arguments))),t},series:{effort:{stretch:!0}},readOnly:!0,columns:[{type:"tree",field:"name",text:"L{nameColumnText}",localeClass:this}],histogramWidget:{cls:"b-hide-offscreen b-resourceutilization-histogram"}};construct(){super.construct(...arguments),this.rowManager.ion({renderRow:"onRowManagerRenderRow",thisObj:this})}updateProject(e){const t=this.store;super.updateProject(e),this.store=t||this.buildStore(e)}updateResourceStore(e){this._resourceStore=e}buildStore(e){return e=this.project,iA.new({project:e})}async getTipHtml(e){const t=e.activeTarget.dataset.index,n=this.getRecordFromElement(e.activeTarget),r=await this.getRecordHistogramData(n),i=this.extractHistogramDataArray(r,n)[parseInt(t,10)];return this.barTooltipTemplate({...e,record:n,index:t,datum:i})}getRecordAllocationData(e,...t){return(e=this.resolveRecordToOrigin(e)).isResourceModel?super.getRecordAllocationData(e,...t):e.isAssignmentModel?this.getRecordHistogramData(e.resource,...t):void 0}onDestroy(){var e;this.destroyStores&&(null===(e=this.store)||void 0===e||e.destroy());super.onDestroy()}onRecordAllocationCalculated(e){const t=this;if(!t.isDestroying){const n=e.owner,r=[...e.byAssignments.keys()].reduce(((e,n)=>{const r=t.resolveOriginToRecord(n);return r&&e.push(r),e}),[]),i=t.resolveOriginToRecord(e.resource);i&&t.setHistogramDataCache(i,n);for(const e of r)t.setHistogramDataCache(e,n);t._renderOnCommitPromise||(t._renderOnCommitPromise=t.project.graph.ongoing.then(t.onCommitAsyncCompletion.bind(t)))}}onRowManagerRenderRow({row:e,record:t}){const n=this.isGroupRecord(t);t=this.resolveRecordToOrigin(t),e.assignCls({"b-resource-row":t.isResourceModel||n,"b-assignment-row":!n&&t.isAssignmentModel})}resolveRecordToOrigin(e){return e.origin||e.$original||e}resolveOriginToRecord(e){let t=e;if(this.store.isResourceUtilizationStore)t=this.store.getModelByOrigin(e)||t;else if(e.hasLinks)for(const t of e.$links)if(this.store.includes(t))return t;return t}getHistogramDataCache(e){return e&&(e=this.resolveRecordToOrigin(e)),super.getHistogramDataCache(e)}setHistogramDataCache(e,t){return e=this.resolveRecordToOrigin(e),super.setHistogramDataCache(e,t)}scheduleRecordRefresh(e){return e=this.resolveOriginToRecord(e),super.scheduleRecordRefresh(e)}scheduleRecordParentsRefresh(e){return e=this.resolveOriginToRecord(e),super.scheduleRecordParentsRefresh(e)}getCell(e){var t,n;return(null!==(t=e.record)&&void 0!==t&&t.isResourceModel||null!==(n=e.record)&&void 0!==n&&n.isAssignmentModel)&&(e.record=this.resolveOriginToRecord(e.record)),super.getCell(e)}changeHistogramWidget(e){return e&&!e.isHistogram&&(this.getBarTextRenderData||null!=e&&e.getBarTextRenderData||(e.getBarTextRenderData=this.getBarTextRenderDataDefault),e.height=this.rowHeight),super.changeHistogramWidget(e)}getBarTextRenderDataDefault(e,t,n){return e.y="50%",e}extractHistogramDataArray(e,t){let n;const r=this.resolveRecordToOrigin(t);return this.isGroupRecord(t)||r.isResourceModel?n=e.allocation.total:r.isAssignmentModel&&(n=e.allocation.byAssignments.get(r)||[]),n}initAggregatedAllocationEntry(e,t){return t.targetArray.$resources||(t.targetArray.$resources=new Set),{tick:null,effort:0,maxEffort:0,units:0,isGroup:!0,inEventTimeSpan:!1,members:new Map,resources:new Set}}aggregateAllocationEntry(e,t,n,r,i){const{targetArray:s}=i,o=i.arrays[n];if(e.tick=t.tick,e.isOverallocated=e.isOverallocated||t.isOverallocated,e.isUnderallocated=e.isUnderallocated||t.isUnderallocated,e.inEventTimeSpan=e.inEventTimeSpan||t.inEventTimeSpan,t.members?e.members=new Map([...e.members,...t.members]):e.members.set(t.resource||t.assignment,t),o.$resources)s.$resources=new Set([...s.$resources,...o.$resources]);else if(t.assignment||t.resource){const n=t.resource||t.assignment.resource;s.$resources.add(n);const i=this.getHistogramDataCache(n).allocation.total[r];e.isOverallocated=e.isOverallocated||i.isOverallocated,e.isUnderallocated=e.isUnderallocated||i.isUnderallocated}return e}aggregateHistogramData(){const e=super.aggregateHistogramData(...arguments);for(let t=0,n=e.length;t<n;t++){const n=e[t];n.maxEffort=0;for(const r of e.$resources){const e=this.getHistogramDataCache(r).allocation.total[t];n.maxEffort+=e.maxEffort}}return e}getResourceBarTip({datum:t}){const n=this,{showBarTip:r,timeAxis:i}=n;let s="";if(r&&t.inEventTimeSpan){const r=n.getBarTipEffortUnit(...arguments),o=n.getEffortText(t.effort,r,!0),a=n.getEffortText(t.maxEffort,r,!0),l=n.L("L{groupBarTipAssignment}");let c="L",d=n.L("L{groupBarTipInRange}"),u="";0===Gt.compareUnits(i.unit,e.TimeUnit.Day)?d=n.L("L{groupBarTipOnDate}"):Gt.compareUnits(i.unit,e.TimeUnit.Second)<=0?c="HH:mm:ss A":Gt.compareUnits(i.unit,e.TimeUnit.Hour)<=0&&(c="LT");let h=[...t.assignmentIntervals.entries()].filter((([e,t])=>t.effort)).sort((([e,t],[n,r])=>t.effort>r.effort?-1:1));h.length>n.groupBarTipAssignmentLimit&&(u="<br>"+n.L("L{plusMore}").replace("{value}",h.length-n.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const g=h.map((([e,t])=>l.replace("{event}",$.encodeHtml(e.event.name)).replace("{allocated}",n.getEffortText(t.effort,r,!0)).replace("{available}",n.getEffortText(t.maxEffort,r,!0)).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""))).join("<br>")+u;s=d.replace("{assignments}",g).replace("{startDate}",Gt.format(t.tick.startDate,c)).replace("{endDate}",Gt.format(t.tick.endDate,c)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""),s=`<div class="b-histogram-bar-tooltip">${s}</div>`}return s}getGroupBarTip({datum:t}){const n=this,{showBarTip:r,timeAxis:i}=n;let s="";if(r&&t.inEventTimeSpan){const r=n.getBarTipEffortUnit(...arguments),o=n.getEffortText(t.effort,r),a=n.getEffortText(t.maxEffort,r),l=n.L("L{groupBarTipAssignment}");let c="L",d=n.L("L{groupBarTipInRange}"),u="";0===Gt.compareUnits(i.unit,e.TimeUnit.Day)?d=n.L("L{groupBarTipOnDate}"):Gt.compareUnits(i.unit,e.TimeUnit.Second)<=0?c="HH:mm:ss A":Gt.compareUnits(i.unit,e.TimeUnit.Hour)<=0&&(c="LT");let h=[...t.members.entries()].filter((([e,t])=>t.effort)).sort((([e,t],[n,r])=>t.effort>r.effort?-1:1));h.length>n.groupBarTipAssignmentLimit&&(u="<br>"+n.L("L{plusMore}").replace("{value}",h.length-n.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const g=h.map((([e,t])=>{var i,s;return l.replace("{resource}",$.encodeHtml((null===(i=e.resource)||void 0===i?void 0:i.name)||e.name)).replace("{event}",$.encodeHtml((null===(s=e.event)||void 0===s?void 0:s.name)||e.name)).replace("{allocated}",n.getEffortText(t.effort,r)).replace("{available}",n.getEffortText(t.maxEffort,r)).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":"")})).join("<br>")+u;s=d.replace("{assignments}",g).replace("{startDate}",Gt.format(t.tick.startDate,c)).replace("{endDate}",Gt.format(t.tick.endDate,c)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",t.isOverallocated?"b-overallocated":t.isUnderallocated?"b-underallocated":""),s=`<div class="b-histogram-bar-tooltip">${s}</div>`}return s}getAssignmentBarTip({datum:t}){const n=this,{showBarTip:r,timeAxis:i}=n;let s="";if(r&&t.inEventTimeSpan){const r=n.getBarTipEffortUnit(...arguments),o=n.getEffortText(t.effort,r,!0),a=n.getEffortText(t.maxEffort,r,!0);let l="L",c=n.L("L{barTipInRange}");0===Gt.compareUnits(i.unit,e.TimeUnit.Day)?c=n.L("L{barTipOnDate}"):Gt.compareUnits(i.unit,e.TimeUnit.Second)<=0?l="HH:mm:ss A":Gt.compareUnits(i.unit,e.TimeUnit.Hour)<=0&&(l="LT"),s=c.replace("{startDate}",Gt.format(t.tick.startDate,l)).replace("{endDate}",Gt.format(t.tick.endDate,l)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",t.cls||""),t.assignment&&(s=s.replace("{event}",$.encodeHtml(t.assignment.event.name))),s=`<div class="b-histogram-bar-tooltip">${s}</div>`}return s}}JF.initClass(),JF._$name="ResourceUtilization",Ed.registerFeature(pv,!0,"ResourceUtilization");class QF extends iD{static $name="ProHorizontalRendering";fillInnerSpanHorizontalPosition(e){const{eventRecord:t}=e,{startMS:n,endMS:r,durationMS:i}=this.calculateMS(t,"startDate","endDate"),s=this.calculateHorizontalPosition(e,n,r,i);if(s){const{left:t,width:o}=s;return Object.assign(e,{innerStartMS:n,innerEndMS:r,innerDurationMS:i,bufferBeforeWidth:Math.max(t-e.left,0),bufferAfterWidth:Math.max(Math.floor(e.left+e.width-t-o),0)}),!0}return!1}getTimeSpanRenderData(e,t,n=!1){const r=super.getTimeSpanRenderData(e,t,n);return null!=r&&r.useEventBuffer&&!this.fillInnerSpanHorizontalPosition(r)?null:r}}QF._$name="ProHorizontalRendering";class eP extends dD{static $name="ProVerticalRendering";fillInnerSpanVerticalPosition(e){const{scheduler:t}=this,{eventRecord:n}=e,{isBatchUpdating:r}=n,i=r?n.get("startDate"):n.startDate,s=r?n.get("endDate"):n.endDate,o=t.getCoordinateFromDate(i),a=i.getTime(),l=s.getTime(),c=l-a;let d=t.getCoordinateFromDate(s),u=d-o;return-1===d&&(u=Math.round(c*t.timeAxisViewModel.getSingleUnitInPixels("millisecond")),d=o+u),Object.assign(e,{innerStartMS:a,innerEndMS:l,innerDurationMS:c,bufferBeforeWidth:o-e.top,bufferAfterWidth:e.top+e.height-o-u}),!0}getTimeSpanRenderData(e,t,n=!1){const r=super.getTimeSpanRenderData(e,t,n);return null!=r&&r.useEventBuffer&&!this.fillInnerSpanVerticalPosition(r)?null:r}}eP._$name="ProVerticalRendering";class tP extends(CD.mixin(UF,GF,KF)){static $name="SchedulerProBase";static type="schedulerprobase";static configurable={projectModelClass:zF,dependencyIdField:"id",showTaskColorPickers:!1};static isSchedulerPro=!0;onPaintOverride(){}set calendars(e){this.project.calendars=e}get calendars(){return this.project.calendars}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),"horizontal"===e?(t.horizontal=new QF(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new eP(t),t.rendered&&t.vertical.init()))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&Br.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}createEvent(e,t,n){if(t.isWorkingTime(e))return this.taskEdit&&this.taskEdit.isEditing?void this.ion({aftertaskedit:()=>super.createEvent(e,t,n),once:!0}):super.createEvent(e,t,n)}}tP.initClass(),_.setVersion("schedulerpro","5.6.2"),tP._$name="SchedulerProBase";class nP extends tP{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}}nP.initClass(),nP._$name="SchedulerPro";class rP extends CD{static get $name(){return"Timeline"}static get type(){return"timeline"}static get configurable(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,rowHeight:48,displayDateFormat:"L",resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e={}){const t=this;t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate";let n=!0;if("project"in e){if(!e.project)throw new Error("You need to configure the Timeline with a Project");e.project instanceof jF&&(t.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||(n=!1,e.project.ion({name:"initialCommit",refresh({isInitialCommit:e}){e&&(t.fillFromTaskStore(),t.detachListeners("initialCommit"))},thisObj:t})),delete e.project)}e.features=Xt.assign({cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:!1},e.features),super.construct(e),t.features.timeRanges&&(t.features.timeRanges.store=new ao),n&&t.fillFromTaskStore.now(),t.taskStore.ion({refreshPreCommit:t.fillFromTaskStore,changePreCommit:t.onTaskStoreChange,thisObj:t}),t.ion({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel)}onSizeChanged({width:e,oldWidth:t}){const n=this,r=e!==t;r&&n.suspendRefresh(),n.syncRowHeight(),r&&(n.resumeRefresh(!1),n.fitTimeline())}syncRowHeight(){this.bodyContainer.isConnected&&(this.rowHeight=this.bodyContainer.offsetHeight)}fitTimeline(){this.eventStore.count>0&&(this.forceFit=!1,this.zoomToFit({leftMargin:50,rightMargin:50}),this.forceFit=!0),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:t,records:n,changes:r,isCollapse:i}){const s=this,o=s.eventStore;let a;switch(e){case"add":n.forEach((e=>{e.showInTimeline&&(o.add(s.cloneTask(e)),a=!0)}));break;case"remove":i||n.forEach((e=>{e.showInTimeline&&(o.remove(e.id),a=!0)}));break;case"removeall":s.fillFromTaskStore.now();break;case"update":{const e=t;if(r.showInTimeline){if(e.showInTimeline)o.add(s.cloneTask(e));else{const t=o.getById(e.id);t&&o.remove(t)}a=!0}else if(e.showInTimeline){const t=o.getById(e.id);t&&(t.set(s.cloneTask(e)),a=!0)}break}}a&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,name:e.name,startDate:e.startDate,endDate:e.endDate,cls:e.cls}}render(){super.render(...arguments),this.syncRowHeight()}async fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse((n=>{n.showInTimeline&&n.isScheduled&&t.push(e.cloneTask(n))})),e.events=t,await e.project.commitAsync(),e.isDestroyed||e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels(),super.onLocaleChange()}}rP.initClass(),rP._$name="Timeline";const iP=[],sP={remove:1,add:2,update:3},oP={TaskModel:1,DependencyModel:2,AssignmentModel:3,ProjectModel:4},aP=({parent:e,index:t})=>`${e.name}[${t}]`,lP={AssignmentModel:"Assignment",DependencyModel:"Dependency"};class cP extends sd{static fields=[{name:"description",type:"string"},{name:"occurredAt",type:"date"},{name:"versionModel"},{name:"transactionModel"},{name:"propertyUpdate"},{name:"action"}]}class dP extends Ev{static $name="VersionGrid";static type="versiongrid";static configurable={store:{tree:!0,modelClass:cP,sorters:[{field:"occurredAt",ascending:!1},dP.sortActionRows],reapplySortersOnAdd:!0},project:null,showUnattachedTransactions:!0,showNamedVersionsOnly:!1,showVersions:!0,comparingVersionId:null,flex:0,features:{group:{field:"id"},cellEdit:{continueEditingOnCellClick:!1,editNextOnEnterPress:!1},cellMenu:{items:{removeRow:!1,cut:!1,copy:!1,paste:!1,renameButton:{text:"L{VersionGrid.rename}",icon:"b-icon b-icon-edit",onItem:({record:e,source:t})=>{t.startEditing({id:e.id,column:t.columns.get("description")})}},restoreButton:{text:"L{VersionGrid.restore}",icon:"b-icon b-icon-undo",onItem:({record:e,source:t})=>{t.triggerRestore(e.versionModel)}},compareButton:{text:"L{VersionGrid.compare}",icon:"b-icon b-icon-compare",onItem:({record:e,source:t})=>{t.triggerCompare(e.versionModel)}},stopComparingButton:{text:"L{VersionGrid.stopComparing}",onItem:({record:e,source:t})=>{t.triggerStopCompare()}}}},rowCopyPaste:!1},columns:[{type:"tree",text:"L{VersionGrid.description}",field:"description",flex:4,groupable:!1,renderer:({grid:e,...t})=>e.renderDescription({grid:e,...t}),autoHeight:!0},{text:"L{VersionGrid.occurredAt}",field:"occurredAt",type:"date",flex:1,groupable:!1}],dateFormat:"M/D/YY h:mm a",internalListeners:{beforeCellEditStart({editorContext:{column:e,record:t}}){if("description"!==e.field||!t.versionModel)return!1},finishCellEdit({editorContext:{record:e,value:t}}){e.versionModel.name=null!=t&&t.trim()?t:null},cellMenuBeforeShow:({source:e,record:t,items:n})=>(n.stopComparingButton.disabled=!e.comparingVersionId,Boolean(t.versionModel)),toggleNode({record:e,collapse:t}){this._expandedById.set(e.id,!t)}}};static delayable={processUpdates:{type:"raf",cancelOutstanding:!0}};static get properties(){return{_rowsByUnderlyingRecord:new WeakMap,_expandedById:new Map}}_transactionChanges=[];_versionChanges=[];comparingRowCls=`b-${dP.type}-comparing`;construct(e){super.construct({...e,features:Xt.merge({},dP.configurable.features,e.features)})}afterConstruct(){if(!this.project)throw new Error(`${dP.$name} requires the project config.`);this.refreshGrid()}updateDateFormat(e){const t=this.columns.get("occurredAt");t&&(t.format=e)}updateProject(e){const t=this;t.detachListeners("storeChange"),t._versionStore=e.getCrudStore("versions"),t._transactionStore=e.getCrudStore("changelogs"),t._versionStore.ion({name:"storeChange",change:t.onVersionStoreChange,thisObj:t}),t._transactionStore.ion({name:"storeChange",change:t.onTransactionStoreChange,thisObj:t})}updateShowNamedVersionsOnly(){this.isPainted&&this.refreshGrid()}updateShowUnattachedTransactions(){this.isPainted&&this.refreshGrid()}updateShowVersions(){this.isPainted&&this.refreshGrid()}updateComparingVersionId(e,t){const[n,r]=[t,e].map((e=>this.store.getById(`v-${e}`)));n&&(n.cls="",n.iconCls="b-icon b-icon-version"),r&&(r.cls=this.comparingRowCls,r.iconCls="b-icon b-icon-compare")}onVersionStoreChange({action:e,records:t}){this._versionChanges.push({action:e,records:t}),this.processUpdates()}onTransactionStoreChange({action:e,records:t}){this._transactionChanges.push({action:e,records:t}),this.processUpdates()}processUpdates(){const e=this,t=H.unique(e._versionChanges.flatMap((({records:e})=>e))),n=new Set(t.map((e=>String(e.id)))),r=H.unique(e._transactionChanges.flatMap((({records:e})=>e)).concat(0===t.length?[]:e._transactionStore.query((e=>n.has(e.versionId)))));for(const i of r)i.versionId&&!n.has(i.versionId)&&(t.push(e._versionStore.getById(i.versionId)),n.add(i.versionId));e.replaceRows(H.unique(t),r),e._transactionChanges=[],e._versionChanges=[]}replaceRows(e,t){const n=this,{showNamedVersionsOnly:r,showUnattachedTransactions:i,store:s}=n,o=new Set,a=H.groupBy(t,"versionId"),l=t.concat(e),c=r?e.filter((e=>null!=e.name)):e;for(const e of l)for(const t of n._rowsByUnderlyingRecord.get(e)??iP)o.add(t);n.suspendRefresh(),s.remove(Array.from(o));for(const e of c){const t=s.add(n.getGridRows(e,a[e.id]));n._rowsByUnderlyingRecord.set(e,t)}if(i)for(const e of t.filter((e=>null==e.versionId))){const t=s.add(n.getGridRows(null,[e]));n._rowsByUnderlyingRecord.set(e,t)}n.resumeRefresh(!1),s.sort(s.sorters)}refreshGrid(){this.replaceRows(this._versionStore.records,this._transactionStore.records)}getGridRows(e,t){const n=this,{showVersions:r,comparingVersionId:i}=n,s=(null==t?void 0:t.map((t=>{var r;const i=`t-${t.id}`;return{id:i,expanded:Boolean(null===(r=n._expandedById)||void 0===r?void 0:r.get(i)),description:t.description,occurredAt:t.occurredAt,transactionModel:t,rootVersionModel:e,children:t.actions.map(((r,i)=>{var s,o;const a=`a-${t.id}-${i}`;return{id:a,expanded:Boolean(null===(s=n._expandedById)||void 0===s?void 0:s.get(a)),action:r,rootVersionModel:e,children:(null===(o=r.propertyUpdates)||void 0===o?void 0:o.map((t=>({rootVersionModel:e,propertyUpdate:t}))))??[]}}))}})))||[],o=`v-${null==e?void 0:e.id}`;return e&&r?{id:o,expanded:Boolean(n._expandedById.get(o)),description:e.description,occurredAt:e.savedAt,children:s,versionModel:e,iconCls:"b-icon-version",cls:e.id===i?n.comparingRowCls:null}:s}renderDescription(e){const{record:t}=e;return t.propertyUpdate?this.renderPropertyUpdate(t.propertyUpdate):t.action?this.renderActionDescription(t.action):t.description}renderPropertyUpdate(e){const t=dP.type,{property:n,before:r,after:i}=e;return{children:[{tag:"div",class:`b-${t}-property-update-desc`,children:[{tag:"span",class:`b-${t}-property-name`,html:`${this.formatPropertyName(n)}`},this.renderPropertyValue(r,"before"),{tag:"i",class:"b-icon b-icon-right"},this.renderPropertyValue(i,"after")]}]}}renderPropertyValue(e,t){return{tag:"span",class:[`b-${dP.type}-property-${t}`,null==e&&`b-${dP.type}-empty-value`],html:null==e?this.L("L{Versions.nullValue}"):this.formatValueString(e)??""}}formatValueString(e){return Gt.isDate(e)?Gt.format(e,this.dateFormat):"number"==typeof e?e.toFixed(2):e}formatPropertyName(e){return $.separate(e)}getAssignmentTextTokens(e){return{event:e.event.name,resource:e.resource.name}}getDependencyTextTokens(e){return{from:e.fromTask.name,to:e.toTask.name}}renderActionDescription(e){const t=this,{actionType:n,entity:r}=e;let i,s={type:t.L("L{Versions.entityNames}")[r.type],name:r.name};return"move"===n&&(s.from=aP(e.from),s.to=aP(e.to)),i=t.L(`L{Versions.${n}${lP[r.type]??"Entity"}}`),"DependencyModel"===r.type?s=t.getDependencyTextTokens(r):"AssignmentModel"===r.type&&(s=t.getAssignmentTextTokens(r)),i=i.replace(/\{(\w+)\}/g,((e,t)=>s[t]??t)),e.isUser&&(i=`[!] ${i}`),t.renderHighlightedTextElements($.capitalize(i),s)}static sortActionRows(e,t){if(e.parent===t.parent&&e.action&&t.action){const n=Boolean(e.action.isUser),r=Boolean(t.action.isUser),{actionType:i,entity:{type:s}}=e.action,{actionType:o,entity:{type:a}}=t.action;return n!==r?n?-1:1:Math.sign(sP[i]-sP[o])||Math.sign(oP[s]-oP[a])||0}return 0}triggerRestore(e){this.trigger("restore",{version:e})}triggerCompare(e){this.trigger("compare",{version:e})}triggerStopCompare(e){this.trigger("stopCompare")}renderHighlightedTextElements(e){const t=this.constructor.type;return{children:[{tag:"span",class:`b-${t}-highlighted-text`,children:e.split(/\*\*/g).reduce(((e,n)=>(e.children.push({tag:"span",text:n,class:e.isEntity?`b-${t}-highlighted-entity`:null}),e.isEntity=!e.isEntity,e)),{children:[],isEntity:!1}).children}]}}}dP.initClass(),dP._$name="VersionGrid";var uP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class hP extends(Ty([qM,vk,pk],(t=>{const n=t.prototype;return class extends t{*maybeSkipNonWorkingTime(e,t=!0){return(yield this.$.childEvents).size>0?e:yield*n.maybeSkipNonWorkingTime.call(this,e,t)}*calculateStartDateConstraintIntervals(){const e=yield*n.calculateStartDateConstraintIntervals.call(this),t=yield this.$.parentEvent;if(null!=t&&t.graph){const n=yield t.$.startDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateEndDateConstraintIntervals(){const e=yield*n.calculateEndDateConstraintIntervals.call(this),t=yield this.$.parentEvent;if(null!=t&&t.graph){const n=yield t.$.endDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateEarlyStartDateConstraintIntervals(){const t=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(null!=r&&r.graph){const n=yield r.$.earlyStartDateConstraintIntervals;t.push.apply(t,n),(yield r.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Forward&&t.push(pP.new({owner:r,side:e.ConstraintIntervalSide.Start,startDate:yield r.$.startDate}))}return t}*calculateEarlyEndDateConstraintIntervals(){const e=yield*n.calculateEarlyEndDateConstraintIntervals.call(this),t=yield this.$.parentEvent;if(null!=t&&t.graph){const n=yield t.$.earlyEndDateConstraintIntervals;e.push.apply(e,n)}return e}}}))){}class gP extends(rt(ak)){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return Kb(this.L("L{descriptionTpl}"),e.name||e.id)}resolve(){this.event.manuallyScheduled=!1}}class mP extends lk{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(t){let n;switch(t.side){case e.ConstraintIntervalSide.Start:n=this.L("L{startDescriptionTpl}");break;case e.ConstraintIntervalSide.End:n=this.L("L{endDescriptionTpl}")}return Kb(n,...this.getDescriptionParameters(t))}static getDescriptionParameters(e){const t=e.owner;return[Gt.format(e.startDate,this.L("L{dateFormat}")),Gt.format(e.endDate,this.L("L{dateFormat}")),t.name||t.id]}}class pP extends ck{get isManuallyScheduledParentConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const t=this.owner,n=(e=e||t.graph.activeTransaction).entries.get(t.$.manuallyScheduled);return!e.baseRevision.hasIdentifier(t.$$)||n&&!n.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}}uP([JE(gP)],pP.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),uP([JE(mP)],pP.prototype,"descriptionBuilderClass",void 0);var fP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class vP extends(Ty([pk,vk],(t=>{const n=t.prototype;class r extends t{*calculateLateStartDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const n=yield t.$.lateStartDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateLateEndDateConstraintIntervals(){const t=[],n=yield this.$.parentEvent;if(n){const r=yield n.$.lateEndDateConstraintIntervals;t.push.apply(t,r),(yield n.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Backward&&t.push(pP.new({side:e.ConstraintIntervalSide.End,endDate:yield n.$.endDate}))}return t}*shouldRollupChildLateStartDate(e){return!0}*calculateMinChildrenLateStartDate(){let e=KC;const t=yield*this.subEventsIterable();for(let n of t){if(!(yield*this.shouldRollupChildLateStartDate(n)))continue;let t;(yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())&&(t=yield n.$.minChildrenLateStartDate),t=t||(yield n.$.lateStartDate),t&&t<e&&(e=t)}return e.getTime()-KC.getTime()?e:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const t=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),n=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let r=yield*this.calculateEffectiveConstraintInterval(!0,t,n);if(null===r)return null;if(r.isIntervalEmpty()){r=yield*this.calculateEffectiveConstraintInterval(!0,t,n,!0);const i=ok.new({intervals:[...r.intersectionOf]});if((yield i)!==e.EffectResolutionResult.Cancel)return null;yield dx(i)}return XC(r.endDate)?r.endDate:null}*shouldRollupChildLateEndDate(e){return!0}*calculateMaxChildrenLateEndDate(){let e=qC;const t=yield*this.subEventsIterable();for(let n of t){if(!(yield*this.shouldRollupChildLateEndDate(n)))continue;let t;(yield n.$.manuallyScheduled)&&(yield*n.hasSubEvents())&&(t=yield n.$.maxChildrenLateEndDate),t=t||(yield n.$.lateEndDate),t&&t>e&&(e=t)}return e.getTime()-qC.getTime()?e:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===e.Direction.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const t=yield this.$.lateStartDateConstraintIntervals,n=yield this.$.lateEndDateConstraintIntervals;let r=yield*this.calculateEffectiveConstraintInterval(!1,t.concat(yield this.$.startDateConstraintIntervals),n.concat(yield this.$.endDateConstraintIntervals));if(null===r)return null;if(r.isIntervalEmpty()){r=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const t=ok.new({intervals:[...r.intersectionOf]});if((yield t)!==e.EffectResolutionResult.Cancel)return null;yield dx(t)}return XC(r.endDate)?r.endDate:null}*calculateLateEndDate(){const e=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateTotalSlack(){const e=yield this.$.earlyStartDateRaw,t=yield this.$.lateStartDateRaw,n=yield this.$.earlyEndDateRaw,r=yield this.$.lateEndDateRaw,i=yield this.$.slackUnit;let s,o;return(e&&t||n&&r)&&(e&&t?(o=yield*this.calculateProjectedDuration(e,t,i),n&&r&&(s=yield*this.calculateProjectedDuration(n,r,i),s<o&&(o=s))):n&&r&&(o=yield*this.calculateProjectedDuration(n,r,i))),o}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,n=yield this.$.lateStartDateConstraintIntervals,r=yield this.$.lateEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==n?void 0:n.length)||(null==r?void 0:r.length))}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===e.Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield this.$.lateStartDate:yield*n.calculateStartDatePure.call(this)}*calculateStartDateProposed(){return(yield this.$.effectiveDirection).direction===e.Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.lateStartDate)||(yield*n.calculateStartDateProposed.call(this)):yield*n.calculateStartDateProposed.call(this)}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===e.Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield this.$.lateEndDate:yield*n.calculateEndDatePure.call(this)}*calculateEndDateProposed(){return(yield this.$.effectiveDirection).direction===e.Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.lateEndDate)||(yield*n.calculateEndDateProposed.call(this)):yield*n.calculateEndDateProposed.call(this)}}return fP([JR({lazy:mk})],r.prototype,"minChildrenLateStartDate",void 0),fP([JR({lazy:mk})],r.prototype,"lateStartDateRaw",void 0),fP([TT({type:"date",persist:!1},{lazy:mk,converter:IT,persistent:!1})],r.prototype,"lateStartDate",void 0),fP([JR({lazy:mk})],r.prototype,"maxChildrenLateEndDate",void 0),fP([JR({lazy:mk})],r.prototype,"lateEndDateRaw",void 0),fP([TT({type:"date",persist:!1},{lazy:mk,converter:IT,persistent:!1})],r.prototype,"lateEndDate",void 0),fP([JR({lazy:mk})],r.prototype,"lateStartDateConstraintIntervals",void 0),fP([JR({lazy:mk})],r.prototype,"lateEndDateConstraintIntervals",void 0),fP([TT({type:"number",persist:!1},{lazy:mk,persistent:!1})],r.prototype,"totalSlack",void 0),fP([TT({type:"string",defaultValue:e.TimeUnit.Day,persist:!1},{lazy:mk,converter:Gt.normalizeUnit,persistent:!1})],r.prototype,"slackUnit",void 0),fP([TT({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:mk})],r.prototype,"critical",void 0),fP([QR("lateStartDateConstraintIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),fP([QR("lateEndDateConstraintIntervals")],r.prototype,"calculateLateEndDateConstraintIntervals",null),fP([QR("minChildrenLateStartDate")],r.prototype,"calculateMinChildrenLateStartDate",null),fP([QR("lateStartDateRaw")],r.prototype,"calculateLateStartDateRaw",null),fP([QR("maxChildrenLateEndDate")],r.prototype,"calculateMaxChildrenLateEndDate",null),fP([QR("lateStartDate")],r.prototype,"calculateLateStartDate",null),fP([QR("lateEndDateRaw")],r.prototype,"calculateLateEndDateRaw",null),fP([QR("lateEndDate")],r.prototype,"calculateLateEndDate",null),fP([QR("totalSlack")],r.prototype,"calculateTotalSlack",null),fP([QR("critical")],r.prototype,"calculateCritical",null),r}))){}var yP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class bP extends(Ty([Rk,vP],(t=>{const n=t.prototype;class r extends t{*shouldSuccessorAffectScheduling(e){const t=yield e.$.toEvent;return t&&!XE(t)&&(yield e.$.active)&&(!(yield t.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const t=yield*n.calculateLateStartDateConstraintIntervals.call(this),r=this.getProject(),i=r.dependencyConstraintIntervalClass;let s;for(s of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(s)))continue;const n=yield s.$.toEvent,o=yield n.$.manuallyScheduled;let a;switch(yield s.$.type){case e.DependencyType.StartToStart:a=o?yield n.$.startDate:yield n.$.lateStartDateRaw;break;case e.DependencyType.StartToEnd:a=o?yield n.$.endDate:yield n.$.lateEndDateRaw}if(a){const n=yield s.$.lag,o=yield s.$.lagUnit,l=yield*r.$convertDuration(n,o,e.TimeUnit.Millisecond),c=yield s.$.calendar;yield c.$.version;let d=a;l&&(d=c.skipNonWorkingTime(c.calculateStartDate(a,l)));const u=i.new({owner:s,startDate:null,endDate:d});t.unshift(u)}}return t}*calculateLateEndDateConstraintIntervals(){const t=yield*n.calculateLateEndDateConstraintIntervals.call(this),r=this.getProject(),i=r.dependencyConstraintIntervalClass;let s;for(s of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(s)))continue;const n=yield s.$.toEvent,o=yield n.$.manuallyScheduled;let a;switch(yield s.$.type){case e.DependencyType.EndToEnd:a=o?yield n.$.endDate:yield n.$.lateEndDateRaw;break;case e.DependencyType.EndToStart:a=o?yield n.$.startDate:yield n.$.lateStartDateRaw}if(a){const n=yield s.$.lag,o=yield s.$.lagUnit,l=yield*r.$convertDuration(n,o,e.TimeUnit.Millisecond),c=yield s.$.calendar;yield c.$.version;let d=a;l&&(d=c.skipNonWorkingTime(c.calculateStartDate(a,l)));const u=i.new({owner:s,startDate:null,endDate:d});t.unshift(u)}}return t}*calculateEffectiveDirection(){const t=yield this.getProject().$.effectiveDirection,n=yield this.$.constraintType;if(t.direction===e.Direction.Backward&&!(yield this.$.manuallyScheduled)&&(n!==e.ConstraintType.MustStartOn&&n!==e.ConstraintType.MustFinishOn||!Boolean(yield this.$.constraintDate)))for(const t of yield this.$.outgoingDeps){const n=yield t.$.toEvent,r=null!=n&&!XE(n),s=r?yield n.$.constraintType:i;if(!r||!(yield t.$.active)||(yield n.$.manuallyScheduled)||(s===e.ConstraintType.MustStartOn||s===e.ConstraintType.MustFinishOn)&&Boolean(yield n.$.constraintDate))continue;const o=yield t.$.type,a=o===e.DependencyType.EndToEnd||o===e.DependencyType.StartToEnd?yield n.$.endDateDirection:yield n.$.startDateDirection;if(a.direction===e.Direction.Forward)return{kind:"enforced",direction:e.Direction.Forward,enforcedBy:"enforced"===a.kind?a.enforcedBy:"own"===a.kind?n:a.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return yP([QR("lateStartDateIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),r}))){}var CP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class SP extends(Ty([bP],(e=>{e.prototype;class t extends e{writeInactive(e,t,n,r){var i;const s=!t.baseRevision.hasIdentifier(e);if(e.constructor.prototype.write.call(this,e,t,n,r),!s&&this.children&&(null===(i=this.stm)||void 0===i||!i.isRestoring))for(const e of this.children)e.inactive=r}*calculateInactive(){const e=yield ax;if(yield*this.hasSubEvents()){const e=yield*this.subEventsIterable();let t=0;for(const n of e)(yield n.$.inactive)||t++;return!t}return e}*shouldRollupChildEffort(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}}return CP([eT("inactive")],t.prototype,"writeInactive",null),CP([QR("inactive")],t.prototype,"calculateInactive",null),t}))){}const DP=wM.new({variables:new Set([IM,AM,FM,pI,fI]),formulas:new Set([bI,LM,yI,vI,CI,PM,OM])}),wP=EM.new({description:DP,defaultResolutionFormulas:new Set([bI,LM])}),EP=EM.new({description:DP,defaultResolutionFormulas:new Set([CI,LM])});class xP extends(Ty([EI],(t=>{const n=t.prototype;return class extends t{*prepareDispatcher(t){if((yield*this.effectiveSchedulingMode())===e.SchedulingMode.FixedEffort){const e=yield*n.prepareDispatcher.call(this,t);return(yield Ax(this.$.assigned))&&e.addProposedValueFlag(fI),e.addKeepIfPossibleFlag(pI),e}return yield*n.prepareDispatcher.call(this,t)}cycleResolutionContext(t){if(this.effectiveSchedulingModeSync(t)===e.SchedulingMode.FixedEffort){const n=t(this.$.effectiveDirection);return n.direction===e.Direction.Forward||n.direction===e.Direction.None?wP:EP}return n.cycleResolutionContext.call(this,t)}}}))){}const RP=wM.new({variables:new Set([IM,AM,FM,pI,fI]),formulas:new Set([bI,LM,vI,yI,CI,PM,OM])}),TP=EM.new({description:RP,defaultResolutionFormulas:new Set([bI,OM,vI])}),MP=EM.new({description:RP,defaultResolutionFormulas:new Set([bI,OM,LM])}),kP=EM.new({description:RP,defaultResolutionFormulas:new Set([CI,PM,vI])}),IP=EM.new({description:RP,defaultResolutionFormulas:new Set([CI,PM,LM])});class AP extends(Ty([EI],(t=>{const n=t.prototype;return class extends t{*prepareDispatcher(t){if((yield*this.effectiveSchedulingMode())===e.SchedulingMode.FixedUnits){const e=yield*n.prepareDispatcher.call(this,t);return(yield Ax(this.$.assigned))&&e.addProposedValueFlag(fI),(yield this.$.effortDriven)&&e.addKeepIfPossibleFlag(pI),e.addKeepIfPossibleFlag(fI),e}return yield*n.prepareDispatcher.call(this,t)}cycleResolutionContext(t){if(this.effectiveSchedulingModeSync(t)===e.SchedulingMode.FixedUnits){const n=t(this.$.effectiveDirection),r=t(this.$.effortDriven);return n.direction===e.Direction.Forward||n.direction===e.Direction.None?r?MP:TP:r?IP:kP}return n.cycleResolutionContext.call(this,t)}}}))){}var FP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class PP extends(My([LI,hP,vP,bP,xP,AP,SP],(t=>{class n extends t{*calculateCheckProjectConstraint(){let e=yield ax;return e&&(yield*this.validateProjectConstraint(),e=!1),e}*calculateStartDate(){return yield this.$.checkProjectConstraint,yield*super.calculateStartDate()}*calculateEndDate(){return yield this.$.checkProjectConstraint,yield*super.calculateEndDate()}writeStartDate(t,n,r,i,s=!0){var o;const a=this.constructor.getFieldDataSource("projectConstraintResolution");return!i||null!==(o=this.stm)&&void 0!==o&&o.isRestoring||!n.graph.hasIdentifier(this.$.effectiveDirection)&&(this.projectConstraintResolution||this.data[a])!==e.ProjectConstraintResolution.Conflict||(this.checkProjectConstraint=!0),super.writeStartDate(t,n,r,i,s)}writeEndDate(t,n,r,i,s=!1){var o;const a=this.constructor.getFieldDataSource("projectConstraintResolution");return!i||null!==(o=this.stm)&&void 0!==o&&o.isRestoring||!n.graph.hasIdentifier(this.$.effectiveDirection)&&(this.projectConstraintResolution||this.data[a])!==e.ProjectConstraintResolution.Conflict||(this.checkProjectConstraint=!0),super.writeEndDate(t,n,r,i,s)}*calculateEarlyStartDateConstraintIntervals(){const t=yield*super.calculateEarlyStartDateConstraintIntervals();return(yield this.$.projectConstraintResolution)===e.ProjectConstraintResolution.Ignore?t.filter((e=>!e.isProjectConstraintInterval)):t}*calculateLateEndDateConstraintIntervals(){const t=yield*super.calculateLateEndDateConstraintIntervals();return(yield this.$.projectConstraintResolution)===e.ProjectConstraintResolution.Ignore?t.filter((e=>!e.isProjectConstraintInterval)):t}*validateProjectConstraint(){const t=this.getProject(),n=yield t.$.effectiveDirection,r=yield this.$.projectConstraintResolution,i=yield this.$.manuallyScheduled;if(r===e.ProjectConstraintResolution.Conflict&&!i){const r=yield this.$.dispatcher,i=r.resolution.get(IM),s=r.resolution.get(AM),o=r.resolution.get(FM),a=yield _x(this.$.startDate),l=yield _x(this.$.endDate);if(l||a){let r,c,d,u;if(n.direction===e.Direction.Forward){if(i===bM)c=a;else{let e=yield*o===bM?this.calculateDurationProposed():this.calculateDurationPure();null!=e&&(c=yield*this.calculateProjectedXDateWithDuration(l,!1,e))}r=yield t.$.startDate,d=!r||!c||c>=r,u=e.ConstraintIntervalSide.Start}else if(n.direction===e.Direction.Backward){if(s===bM)c=l;else{let e=yield*o===bM?this.calculateDurationProposed():this.calculateDurationPure();null!=e&&(c=yield*this.calculateProjectedXDateWithDuration(a,!0,e))}r=yield t.$.endDate,d=!r||!c||c<=r,u=e.ConstraintIntervalSide.End}if(!d){const t=_P.new({event:this,projectDate:r,eventDate:c,side:u});(yield t)===e.EffectResolutionResult.Cancel&&(yield dx(t))}}}}}return n.usesDelayFromParent=!1,FP([TT({defaultValue:e.ProjectConstraintResolution.Honor})],n.prototype,"projectConstraintResolution",void 0),FP([JR()],n.prototype,"checkProjectConstraint",void 0),FP([QR("checkProjectConstraint")],n.prototype,"calculateCheckProjectConstraint",null),n}))){}class OP extends(rt(ak)){static get $name(){return"IgnoreProjectConstraintResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(){this.event.projectConstraintResolution=e.ProjectConstraintResolution.Ignore}}class LP extends(rt(ak)){static get $name(){return"HonorProjectConstraintResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(){this.event.projectConstraintResolution=e.ProjectConstraintResolution.Honor}}class $P extends(rt(ye)){static get $name(){return"ProjectConstraintConflictEffectDescription"}static getDescription(t){const n=this.dateFormat||Gt.defaultFormat;return Kb(this.L(t.side===e.ConstraintIntervalSide.Start?"L{startDescriptionTpl}":"L{endDescriptionTpl}"),t.event.name,Gt.format(t.eventDate,n),Gt.format(t.projectDate,n))}}$P.dateFormat="lll";class _P extends ok{filterConflictingIntervals(e){}getResolutions(){return this._resolutions||(this._resolutions=[this.ignoreProjectConstraintConflictResolutionClass.new({event:this.event}),this.honorProjectConstraintConflictResolutionClass.new({event:this.event})]),this._resolutions}}FP([JE(OP)],_P.prototype,"ignoreProjectConstraintConflictResolutionClass",void 0),FP([JE(LP)],_P.prototype,"honorProjectConstraintConflictResolutionClass",void 0),FP([JE($P)],_P.prototype,"_descriptionBuilderClass",void 0);var jP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class BP extends(Ty([vk],(e=>{e.prototype;class t extends e{*calculateCriticalPaths(){const e=[],t=[],n=[...yield this.$.childEvents],r=yield this.$.endDate;let i,s;for(;i=n.shift();){const e=yield i.$.childEvents,s=yield i.$.critical,o=!(yield i.$.inactive),a=yield i.$.endDate;o&&a&&a.getTime()-r.getTime()==0&&s&&t.push([{event:i}]),n.push(...e)}for(;s=t.shift();){let n,r=s.length-1;for(;n=s[r];){const e=[];for(const t of yield n.event.$.incomingDeps){const n=yield t.$.fromEvent;n&&(yield t.$.active)&&!(yield n.$.inactive)&&(yield n.$.critical)&&e.push({event:n,dependency:t})}if(e.length){const n=s.slice();s.push(e[0]);for(let r=1;r<e.length;r++)t.push(n.concat(e[r]));r++}else r=-1}e.push(s.reverse())}return e}}return jP([JR({lazy:!0})],t.prototype,"criticalPaths",void 0),jP([QR("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}))){}var VP=i&&i.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class HP extends(Ty([jF,mI,vP,BP],(t=>{const n=t.prototype;class r extends t{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield ax)}get isGanttProjectMixin(){return!0}afterConfigure(){n.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||zP}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDate(){const t=yield this.$.effectiveDirection;if(t.direction===e.Direction.Forward){let e=yield ax;return e||(e=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),e||(yield this.$.nonEqual)),e}if(t.direction===e.Direction.Backward){const e=yield*this.calculateMinChildrenStartDate(),t=yield this.$.endDate;return e&&t>e?e:t}}*calculateEndDate(){const t=yield this.$.effectiveDirection;if(t.direction===e.Direction.Forward){const e=yield this.$.startDate,t=yield*this.calculateMaxChildrenEndDate();return t&&t>e?t:e}if(t.direction===e.Direction.Backward){let e=yield ax;return e||(e=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),e||(yield this.$.nonEqual)),e}}*shouldRollupChildStartDate(e){return!(yield e.$.inactive)}*shouldRollupChildEndDate(e){return!(yield e.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const t=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.effectiveDirection;if(r.direction===e.Direction.Forward){const n=yield this.$.startDate;n&&t.push(this.projectConstraintIntervalClass.new({owner:this,side:e.ConstraintIntervalSide.Start,startDate:n}))}else if(r.direction===e.Direction.Backward){const n=yield this.$.lateStartDate;n&&t.push(this.projectConstraintIntervalClass.new({owner:this,side:e.ConstraintIntervalSide.Start,startDate:n}))}return t}*calculateLateEndDateConstraintIntervals(){const t=yield*n.calculateLateEndDateConstraintIntervals.call(this),r=yield this.$.effectiveDirection;if(r.direction===e.Direction.Forward){const n=yield this.$.earlyEndDate;n&&t.push(this.projectConstraintIntervalClass.new({owner:this,side:e.ConstraintIntervalSide.End,endDate:n}))}else if(r.direction===e.Direction.Backward){const n=yield this.$.endDate;n&&t.push(this.projectConstraintIntervalClass.new({owner:this,side:e.ConstraintIntervalSide.End,endDate:n}))}return t}getDefaultEventModelClass(){return PP}getDefaultAssignmentModelClass(){return BT}getDefaultResourceModelClass(){return QI}getDefaultEventStoreClass(){return BI}getType(){return e.ProjectType.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield zx(this.$.startDate);let t,n=KC;const r=[...e];for(;t=r.shift();){let e=yield zx(t.$.startDate);e||(e=yield zx(t.$.endDate)),e&&e<n&&(n=e),r.push(...yield t.$.childEvents)}return n.getTime()!==qC.getTime()&&n.getTime()!==KC.getTime()?n:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield zx(this.$.endDate);let t,n=qC;const r=[...e];for(;t=r.shift();){let e=yield zx(t.$.endDate);e||(e=yield zx(t.$.startDate)),e&&e>n&&(n=e),r.push(...yield t.$.childEvents)}return n.getTime()!==qC.getTime()&&n.getTime()!==KC.getTime()?n:null}getDependencyCycleDetectionIdentifiers(e,t){return[t.$.earlyStartDateConstraintIntervals,t.$.earlyEndDateConstraintIntervals,t.$.lateEndDateConstraintIntervals,t.$.lateStartDateConstraintIntervals]}}return VP([JR({equality:()=>!1})],r.prototype,"nonEqual",void 0),VP([QR("nonEqual")],r.prototype,"calculateNonEqual",null),r}))){}class NP extends lk{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(e){return Kb(e.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(e))}}class zP extends ck{get isProjectConstraintInterval(){return!0}isAffectedByTransaction(e){const t=this.owner,n=(e=e||t.graph.activeTransaction).entries.get(this.startDate?t.$.startDate:t.$.endDate);return n&&!n.isShadow()}}VP([JE(NP)],zP.prototype,"descriptionBuilderClass",void 0);class WP extends td{static get $name(){return"AddNewColumn"}static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}doDestroy(){var e;null===(e=this._combo)||void 0===e||e.destroy(),super.doDestroy()}get combo(){const e=this,t=e.grid.columns;return e._combo||(e._combo=new Mc({owner:e.grid,cls:"b-new-column-combo",placeholder:e.L("L{New Column}"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:{align:"t0-b0",axisLock:!0},minWidth:200,onItem({record:n}){const r=new n.value({region:e.region},t);t.insert(t.indexOf(e),r),r.element.focus()},onBeforeShow(){this.forElement=e.element}},syncInputFieldValue(){this.input.value=""},internalListeners:{keydown({event:e}){e.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new ao({data:Object.values(id.columnTypes).reduce(((e,t)=>(t.$meta.fields.exposedData||t.exposeProperties({}),t.isGanttColumn&&t.text&&e.push({id:t.type,text:t.optionalL(t.text),value:t}),e)),[]),filters:[e=>!this.grid.columns.some((t=>t.constructor===e.value))],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:t}){e.combo.render(t)}onKeyDown(e){"Enter"===e.key&&this.combo.focus()}updateLocalization(){this._combo&&(this._combo.destroy(),this._combo=null),super.updateLocalization()}}id.registerColumnType(WP),WP._$name="AddNewColumn";class UP extends hf{static $name="GanttDateColumn";static isGanttColumn=!0;static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(e,t){const n=this;n.gantt=t.grid,super.construct(e,t),n.format?n.explicitFormat=!0:n.gantt.ion({displayDateFormatChange({format:e}){n.explicitFormat||n.set("format",e)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}get defaultEditor(){const e=super.defaultEditor;return e.project=this.gantt.project,e}}UP._$name="GanttDateColumn";class GP extends UP{static $name="BaselineStartDateColumn";static type="baselinestartdate";static defaults={text:"L{baselineStart}",field:"baselines[0].startDate"}}id.registerColumnType(GP),GP._$name="BaselineStartDateColumn";class YP extends UP{static $name="BaselineEndDateColumn";static type="baselineenddate";static defaults={text:"L{baselineEnd}",field:"baselines[0].endDate"}}id.registerColumnType(YP),YP._$name="BaselineEndDateColumn";class qP extends Tv{static $name="BaselineDurationColumn";static type="baselineduration";static defaults={text:"L{baselineDuration}",field:"baselines[0].fullDuration"}}id.registerColumnType(qP),qP._$name="BaselineDurationColumn";class KP extends Tv{static $name="BaselineDurationVarianceColumn";static type="baselinedurationvariance";static defaults={editor:!1,text:"L{durationVariance}",field:"baselines[0].durationVariance"}}id.registerColumnType(KP),KP._$name="BaselineDurationVarianceColumn";class XP extends Tv{static $name="BaselineStartVarianceColumn";static type="baselinestartvariance";static defaults={editor:!1,text:"L{startVariance}",field:"baselines[0].startVariance"}}id.registerColumnType(XP),XP._$name="BaselineStartVarianceColumn";class ZP extends Tv{static $name="BaselineEndVarianceColumn";static type="baselineendvariance";static defaults={editor:!1,text:"L{endVariance}",field:"baselines[0].endVariance"}}id.registerColumnType(ZP),ZP._$name="BaselineEndVarianceColumn";class JP extends Mc{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map((e=>({id:e.id,text:e.name})))}get store(){return this._store||(this.store=new ao),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}}JP.initClass(),JP._$name="CalendarPicker";class QP extends td{static get $name(){return"CalendarColumn"}static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:JP.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){super.afterConstruct();const e=this,t=e.grid.project;e.defaultCalendar=t.defaultCalendar,e.refreshCalendars(),t.calendarManagerStore.ion({changePreCommit:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){if(this.editor){const e=this.grid.project;this.editor.refreshCalendars(e.calendarManagerStore.allRecords)}}renderer({value:e}){if(e!==this.defaultCalendar&&null!=(null==e?void 0:e.id)){const t=this.grid.project.calendarManagerStore.getById(e.id);return(null==t?void 0:t.name)??""}return""}fromClipboardString({string:e,record:t}){return this.grid.project.calendarManagerStore.find((t=>t.name===e))}}id.registerColumnType(QP),QP._$name="CalendarColumn";class eO extends UP{static get $name(){return"ConstraintDateColumn"}static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}}id.registerColumnType(eO),eO._$name="ConstraintDateColumn";const tO={Forward:"assoonaspossible",Backward:"aslateaspossible"};class nO extends td{static get $name(){return"ConstraintTypeColumn"}static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:"constrainttypepicker",clearable:!0,allowInvalid:!1},filterable:{filterField:{type:"constrainttypepicker"}}}}get editor(){const e=super.editor;return e.includeAsapAlapAsConstraints=this.grid.project.includeAsapAlapAsConstraints,e}renderer({record:e,value:t}){return JA.localize(this.grid.project.includeAsapAlapAsConstraints&&tO[e.direction]||t)||""}}id.registerColumnType(nO),nO._$name="ConstraintTypeColumn";class rO extends UP{static get $name(){return"DeadlineDateColumn"}static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}}id.registerColumnType(rO),rO._$name="DeadlineDateColumn";class iO extends UP{static get $name(){return"EarlyEndDateColumn"}static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}}id.registerColumnType(iO),iO._$name="EarlyEndDateColumn";class sO extends UP{static get $name(){return"EarlyStartDateColumn"}static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}}id.registerColumnType(sO),sO._$name="EarlyStartDateColumn";class oO extends Tv{static get $name(){return"EffortColumn"}static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:HA.type,name:this.field}}}id.registerColumnType(oO),oO._$name="EffortColumn";class aO extends UP{static get $name(){return"EndDateColumn"}static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="enddate",e}}id.registerColumnType(aO),aO._$name="EndDateColumn";class lO extends df{static $name="IgnoreResourceCalendarColumn";static type="ignoreresourcecalendar";static isGanttColumn=!0;static get defaults(){return{field:"ignoreResourceCalendar",text:"L{Ignore resource calendar}"}}}id.registerColumnType(lO),lO._$name="IgnoreResourceCalendarColumn";class cO extends df{static get $name(){return"InactiveColumn"}static get type(){return"inactive"}static get isGanttColumn(){return!0}static get defaults(){return{field:"inactive",text:"L{Inactive}"}}}id.registerColumnType(cO),cO._$name="InactiveColumn";class dO extends UP{static get $name(){return"LateEndDateColumn"}static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}}id.registerColumnType(dO),dO._$name="LateEndDateColumn";class uO extends UP{static get $name(){return"LateStartDateColumn"}static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}}id.registerColumnType(uO),uO._$name="LateStartDateColumn";class hO extends df{static get $name(){return"ManuallyScheduledColumn"}static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}}id.registerColumnType(hO),hO._$name="ManuallyScheduledColumn";class gO extends df{static suppressNoModelFieldWarning=!0;static get $name(){return"MilestoneColumn"}static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}}id.registerColumnType(gO),gO._$name="MilestoneColumn";class mO extends yf{static get $name(){return"NameColumn"}static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{width:200,field:"name",text:"L{Name}"}}}id.registerColumnType(mO),mO._$name="NameColumn";class pO extends td{static get $name(){return"NoteColumn"}static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareapickerfield"}}}renderer({value:e}){return(e||"").trim()}}id.registerColumnType(pO),pO._$name="NoteColumn";class fO extends af{circleHeightPercentage=.75;static get $name(){return"PercentDoneColumn"}static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{% Done}",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e,isExport:t,value:n}){return n=e.getFormattedPercentDone(n),t?n:this.showCircle?{tabIndex:0,role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":n,"aria-label":`${e.name} ${n}${this.L("% Done")}`,className:{"b-percentdone-circle":1,"b-full":100===n,"b-empty":0===n},style:{height:Math.round(this.circleHeightPercentage*this.grid.rowHeight)+"px",width:Math.round(this.circleHeightPercentage*this.grid.rowHeight)+"px","--gantt-percentdone-angle":n/100+"turn"},dataset:{value:n}}:n+this.unit}}id.registerColumnType(fO),fO._$name="PercentDoneColumn";const vO={from:[2,3,0,1],to:[1,0,3,2]},yO=()=>new RegExp(`(${bO.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i");let bO=["SS","SF","FS","FF"],CO=yO();class SO extends Mc{static $name="DependencyField";static type="dependencyfield";static configurable={listCls:"b-predecessor-list",displayField:"name",valueField:"name",validateFilter:!1,minChars:0,clearTextOnPickerHide:!1,picker:{floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},delimiter:";",dependencyStore:null,otherSide:null,ourSide:null,multiSelect:!0,chipView:null,validateOnInput:!1,dependencyIdField:null,eventRecord:null,sorters:[{field:"name"}]};construct(e){const t=this,{ourSide:n,otherSide:r}=e;t.dependencies=new Ms({extraKeys:r}),t.startCollection=new Ms({extraKeys:r}),super.construct(e),t.delimiterRegEx=new RegExp(`\\s*${t.delimiter}\\s*`);const i=()=>{bO=t.L("L{DependencyType.short}"),CO=yO(),t.syncInputFieldValue()};Xe.ion({locale:i,thisObj:t}),i()}internalOnInput(){this.clearError(i,!0),this.isValid&&fc.prototype.internalOnInput.call(this)}get invalidValueError(){return"L{invalidDependencyFormat}"}onInternalKeyDown(e){const{key:t}=e;var n;"Enter"===t?this.syncInvalid():null===(n=super.onInternalKeyDown)||void 0===n||n.call(this,e);this.pickerVisible&&"ArrowDown"===t&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick(...arguments):this.doFilter(this.filterInput?this.filterInput.value:null)}changeStore(e){return e=e.chain((e=>!this.eventRecord||e.id!==this.eventRecord.id),null,{excludeCollapsedRecords:!1,sorters:this.sorters}),super.changeStore(e)}changePicker(e,t){const n=this,r=n.filterField||(n.filterField=new fc({cls:"b-dependency-list-filter",clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},internalListeners:{input({event:e}){n.filterOnInput(e)},clear({event:e}){Object.defineProperty(e,"target",{configurable:!0,value:i}),n.filterOnInput.now(e)}}})),i=n.filterInput=r.input,s=SO.reconfigure(t,e?p.merge({owner:n,store:n.store,cls:`b-dependency-list ${n.listCls}`,itemTpl:n.listItemTpl,forElement:n[n.pickerAlignElement],align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement],minHeight:n.inlinePicker?null:40*Math.min(3,n.store.count)},navigator:{keyEventTarget:i,processEvent:e=>{if("Escape"!==e.key)return e;n.hidePicker()}},onItem:n.onPredecessorClick.bind(n),getItemClasses:function(e){const t=wc.prototype.getItemClasses.call(this,e),r=n.dependencies.getBy(n.otherSide+"Event",e);return t+(r?` b-selected b-${r.getConnectorString(1).toLowerCase()}`:"")}},e):null,n);return s?(s.ion({show(){Object.defineProperty(s.scrollable,"viewport",{get(){return wn.client(this.element).deflate(r.height,0,0,0)}})},once:!0,thisObj:n}),r.owner=s,r.render(s.contentElement)):n.destroyProperties("filterField"),s}updateEventRecord(){this.store.fillFromMaster()}onPickerShow({source:e}){const t=this,{element:n}=t.filterField,{contentElement:r}=e;e.minWidth=t[t.pickerAlignElement].offsetWidth,r.firstChild!==n&&r.insertBefore(n,r.firstChild),super.onPickerShow(...arguments)}listItemTpl(e){const t=$.encodeHtml(e.name),{dependencyIdField:n}=this.owner,r=n&&n!==e.constructor.idField?n:e.constructor.idField,i=e.isPhantom?"":String(e[r]);return`<div class="b-predecessor-item-text">${t} ${i.length?`(${i})`:""}</div>\n            <div class="b-sch-box b-from" data-side="from"></div>\n            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return Boolean(!this.task||this.parseDependencies(this.input.value))&&super.isValid}set value(e){const t=this,n=t.dependencies;if("string"==typeof e){if(t.input.value=e,!(e=t.parseDependencies(e)))return void t.syncInvalid();e=e.map((e=>new t.dependencyStore.modelClass(e)))}else t.startCollection.clear(),null!==e&&(t.startCollection.values=e);n.clear(),null!==e&&(n.values=e),t.inputting||t.syncInputFieldValue()}get value(){return this.dependencies.values}get inputValue(){const e=this,{value:t}=e;return null==t?"":e.constructor.dependenciesToString(t,e.otherSide,e.delimiter,e.dependencyIdField)}onPredecessorClick({source:e,item:t,record:n,event:r}){const i=this,{dependencies:s}=i,o=r.target.closest(".b-sch-box"),a=null==o?void 0:o.dataset.side;let l=s.getBy(i.otherSide+"Event",n);if(t.dataset.noselect=!0,i.trigger("change",{value:i.value,event:r,userAction:!0}),l&&!o)s.remove(l);else if(l){const{id:e,type:t}=l;l=l.copy({id:e,type:vO[a][t]},{skipFieldIdentifiers:!0}),l[`${i.otherSide}Event`]=n,l[`${i.ourSide}Event`]=i.task,s.add(l)}else s.add(i.dependencyStore.createRecord({[`${i.otherSide}Event`]:n,[`${i.ourSide}Event`]:i.task},!0));i.syncInputFieldValue(),e.refresh()}static dependenciesToString(e,t,n=";",r="id"){const i=`${t}Event`,s=e=>{const t=e[i];return null!=t&&t.isModel?t[r]:t||""};if(null!=e&&e.length){return e.sort(((e,t)=>s(e)-s(t))).map((e=>`${s(e)}${cw.getLocalizedDependencyType(e.getConnectorString())}${e.getLag()}`)).join(n)}return""}get task(){var e;return null===(e=this.owner)||void 0===e?void 0:e.record}parseDependencies(e){const t=this;return t.constructor.parseDependencies({value:e,taskStore:t.store,task:t.task,dependencyStore:t.dependencyStore,delimiterRegEx:t.delimiterRegEx,dependencyIdField:t.dependencyIdField,ourSide:t.ourSide,otherSide:t.otherSide})}static parseDependencies({value:e,taskStore:t,task:n,dependencyStore:r,delimiterRegEx:i,dependencyIdField:s,ourSide:o,otherSide:a}){const l=e.split(i),c=r.modelClass,d=[];for(let e=0;e<l.length;e++){const r=l[e];if(r){let e,i=r.length+1,l=null;for(;i&&!l;i--)e=r.substr(0,i),l=t.find((t=>String(t[s])===e),!0);if(!l)return null;const u=r.substr(i+1),h={[`${a}Event`]:l,[`${o}Event`]:n,type:c.Type.EndToStart};if(u.length){const e=CO.exec(u);if(!e||!e[1]&&!e[2])return null;if(e[1]&&(h.type=bO.indexOf(e[1].toUpperCase())),e[2]){const t=Gt.parseDuration(e[2],!0,n.durationUnit);h.lag=t.magnitude,h.lagUnit=t.unit}}d.push(h)}}return d}get needsInputSync(){return super.needsInputSync||!this.isValid&&this.inputValue!==this.input.value}doDestroy(){this.dependencies.destroy(),this.startCollection.destroy(),super.doDestroy()}}SO.initClass(),SO._$name="DependencyField";const DO=e=>!e.project,wO=e=>e;class EO extends(mi(td)){static get $name(){return"DependencyColumn"}static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"},{name:"dependencyIdField",defaultValue:null}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e,grid:t}){const n=this.dependencyIdField||t.dependencyIdField;return SO.dependenciesToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter,n)},filterable({value:e,record:t,column:n}){const r=n.dependencyIdField||n.grid.dependencyIdField;return e=e.toLowerCase(),t[""+("predecessors"===n.field?"predecessorTasks":"successorTasks")].some((t=>{var n;return t&&e.includes(null===(n=t[r])||void 0===n?void 0:n.toString().toLowerCase())}))}}}afterConstruct(){super.afterConstruct()}getFilterableValue(e){return this.renderer({record:e,grid:this.grid})}async finalizeCellEdit({grid:e,record:t,inputField:n,value:r,oldValue:i,editorContext:s}){if(n.clearError(),t&&r){const n=r.filter(DO),i=e.dependencyStore.getProject(),o=t[this.field];if(await i.commitAsync(),i.isDestroyed)return;return!!(await Promise.all(n.map((e=>i.isValidDependencyModel(e,o))))).every(wO)||s.column.L("L{Invalid dependency}")}}get defaultEditor(){const e=this,{grid:t}=e,n="predecessors"===e.field;return{type:"dependencyfield",grid:t,name:e.field,delimiter:e.delimiter,dependencyIdField:e.dependencyIdField||t.dependencyIdField,ourSide:n?"to":"from",otherSide:n?"from":"to",store:t.eventStore||t.taskStore,dependencyStore:t.dependencyStore}}toClipboardString({record:e,grid:t}){if(null!=e&&e[this.field]){const n=this.dependencyIdField||t.dependencyIdField;return SO.dependenciesToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter,n)}}fromClipboardString({string:e,record:t}){const{editor:n}=this;if(n)return SO.parseDependencies({value:e,taskStore:this.grid.taskStore,task:t,dependencyStore:this.grid.dependencyStore,delimiterRegEx:/\s*,\s*/,ourSide:n.ourSide,otherSide:n.otherSide,dependencyIdField:n.dependencyIdField})||[]}}id.registerColumnType(EO),EO._$name="DependencyColumn";class xO extends EO{static get $name(){return"PredecessorColumn"}static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}canFillValue=()=>!1}id.registerColumnType(xO),xO._$name="PredecessorColumn";class RO extends WT{static get defaultConfig(){return{storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){const e=this;super.afterConfigure(),e.addSorter({fn:e.defaultSort.bind(e)})}get projectEvent(){return this._projectEvent}set projectEvent(e){var t;const n=this;var r;(e!=n._projectEvent||e&&e.generation!==n._projectEventGeneration||(null==e||null===(t=e.getProject())||void 0===t?void 0:t.assignmentStore.storage.generation)!==n._assignmentStoreGeneration)&&(n._projectEvent=e,n._projectEventGeneration=null==e?void 0:e.generation,n._assignmentStoreGeneration=null==e||null===(r=e.getProject())||void 0===r?void 0:r.assignmentStore.storage.generation,e?(n.fillFromMaster(),n.sort()):n.removeAll())}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){const t=this;e!==t.floatAssignedResources&&(t._floatAssignedResources=e,t.sort())}fillFromMaster(){const e=this,{projectEvent:t}=e;if(t){const{assignmentStore:n,resourceStore:r}=t,i=n.modelClass.getFieldDefinition("resource").dataSource,s=n.modelClass.getFieldDefinition("event").dataSource,o=[];r.forEach((e=>{const r=n.getAssignmentForEventAndResource(t,e),a=Object.assign({units:0},null==r?void 0:r.data);delete a.id,delete a.eventId,delete a.resourceId,delete a[i],delete a[s],Object.assign(a,{resource:e,event:t}),o.push(a)}),this,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}),e.data=o}}toValue(){return this.query((e=>e.units>0))}toValueString(){return this.toValue().join(", ")}defaultSort(e,t){let n=0;return n=this.floatAssignedResources?!t.units&&e.units?-1:!e.units&&t.units?1:e.resourceName.localeCompare(t.resourceName):e.resourceName.localeCompare(t.resourceName),n}onUpdate({changes:e}){const t=this;t.isConfiguring||Object.hasOwnProperty.call(e,"event")&&t.floatAssignedResources&&t.liveFloatAssignedResources&&t.sort()}}RO._$name="AssignmentsManipulationStore";class TO extends NT{static get fields(){return[{name:"event",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:pT},{name:"resource",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:pT},"eventId","resourceId"]}}TO._$name="AssignmentModel";qe.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Save:"Save"},IgnoreResourceCalendarColumn:{"Ignore resource calendar":"Ignore resource calendar"},InactiveColumn:{Inactive:"Inactive"},AddNewColumn:{"New Column":"New Column"},BaselineStartDateColumn:{baselineStart:"Baseline Start"},BaselineEndDateColumn:{baselineEnd:"Baseline Finish"},BaselineDurationColumn:{baselineDuration:"Baseline Duration"},BaselineStartVarianceColumn:{startVariance:"Start Variance"},BaselineEndVarianceColumn:{endVariance:"Finish Variance"},BaselineDurationVarianceColumn:{durationVariance:"Duration Variance"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DeadlineDateColumn:{Deadline:"Deadline"},DependencyColumn:{"Invalid dependency":"Invalid dependency"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources","more resources":"more resources"},RollupColumn:{Rollup:"Rollup"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SchedulingDirectionColumn:{schedulingDirection:"Scheduling direction",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},TaskCopyPaste:{copyTask:"Copy",cutTask:"Cut",pasteTask:"Paste"},WBSColumn:{WBS:"WBS",renumber:"Renumber"},DependencyField:{invalidDependencyFormat:"Invalid dependency format"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units",unitsTpl:({value:e})=>e?e+"%":""},Gantt:{Edit:"Edit",Indent:"Indent",Outdent:"Outdent","Convert to milestone":"Convert to milestone",Add:"Add...","New task":"New task","New milestone":"New milestone","Task above":"Task above","Task below":"Task below","Delete task":"Delete",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor",changeRejected:"Scheduling engine rejected the changes",linkTasks:"Add dependencies",unlinkTasks:"Remove dependencies",color:"Color"},EventSegments:{splitTask:"Split task"},Indicators:{earlyDates:"Early start/end",lateDates:"Late start/end",Start:"Start",End:"End",deadlineDate:"Deadline"},Versions:{indented:"Indented",outdented:"Outdented",cut:"Cut",pasted:"Pasted",deletedTasks:"Deleted tasks"}});class MO extends ED{static get $name(){return"ResourceAssignmentGridResourceColumn"}static get type(){return"assignmentResource"}static get defaults(){return{showEventCount:!1,cls:"b-assignmentgrid-resource-column",field:"resourceName",flex:1,editor:null,useNameAsImageName:!1,filterable:{filterField:{placeholder:"L{AssignmentGrid.Name}",triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}}}}}defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i}){return t.isSpecialRow||(t=t.resource),super.defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i})}}id.registerColumnType(MO),MO._$name="ResourceAssignmentGridResourceColumn";class kO extends wv{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get configurable(){return{resourceImageExtension:".jpg",minHeight:200,resourceColumn:{type:"assignmentResource"},unitsColumn:{field:"units",type:af.type,text:"L{Units}",localeClass:this,width:70,min:0,max:100,step:10,unit:"%",renderer:({value:e})=>this.L("L{unitsTpl}",{value:Math.round(e)}),filterable:!1}}}static get defaultConfig(){return{selectionMode:{checkboxOnly:!0,multiSelect:!0,showCheckAll:!0},features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.ion({selectionChange:({selected:e,deselected:t})=>{e.forEach((e=>e.units=e.units||e.getFieldDefinition("units").defaultValue)),t.forEach((e=>{this.store.includes(e)&&(e.units=0)}))}})}get projectEvent(){const e=this,t=e.store;let n=e._projectEvent;return t&&n!==t.projectEvent&&(n=e._projectEvent=t.projectEvent),n}set projectEvent(e){const t=this;t._projectEvent=e,t.store.projectEvent=e,e&&(t.selectedRecords=t.store.query((t=>e.assignments.find((e=>e.resource===t.resource)))))}get store(){return super.store}set store(e){const t=this,n=t.store;if(e&&n!==e){var r,i;if(!(e instanceof RO))e=RO.new({modelClass:(null===(i=t._projectEvent)||void 0===i?void 0:i.assignmentStore.modelClass)||TO,projectEvent:t._projectEvent},e);super.store=e,null===(r=t.storeDetacher)||void 0===r||r.call(t),t.storeDetacher=e.ion({update:"onAssignmentUpdate",thisObj:t})}}set columns(e){e&&e.unshift(p.clone(this.resourceColumn),p.clone(this.unitsColumn)),super.columns=e}get columns(){return super.columns}onAssignmentUpdate({record:e,changes:t}){const{units:n}=t;n&&(n.value?0===n.oldValue&&this.selectRow({record:e,scrollIntoView:!1,addToSelection:this.selectionMode.multiSelect}):this.deselectRow(e))}}kO.initClass(),kO._$name="AssignmentGrid";class IO extends kO{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{trapFocus:!0,height:"20em",minWidth:"25em",bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}configure(e){e.selectedRecordCollection=e.assignments,super.configure(e)}show(){return this.originalSelected=this.selectedRecords.map((e=>e.copy())),super.show(...arguments)}afterConfigure(){var e,t;const n=this;super.afterConfigure(),null===(e=n.bbar.widgetMap.saveBtn)||void 0===e||e.ion({click:"onSaveClick",thisObj:n}),null===(t=n.bbar.widgetMap.cancelBtn)||void 0===t||t.ion({click:"onCancelClick",thisObj:n})}onSaveClick(){this.hide()}onCancelClick(){this.hide()}}IO.initClass(),IO._$name="AssignmentPicker";class AO extends Mc{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get configurable(){return{editingRecords:!0,chipView:{cls:"b-assignment-chipview",itemTpl:e=>$.xss`${e.resourceName} ${Math.round(e.units)}%`,scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,picker:{type:IO.type,floating:!0,scrollAction:"realign"},pickerWidth:null,projectEvent:null,store:{},tooltipTemplate(){return $.encodeHtml(this.store.toValueString())}}}onChipClose(e){this.showPicker(),this.picker.deselectRows(e)}syncInputFieldValue(){super.syncInputFieldValue();const{store:e}=this;e&&this.tooltipTemplate&&(this.tooltip=this.tooltipTemplate({taskRecord:e.projectEvent,assignmentRecords:e.toValue()}))}onTriggerClick(e){this.pickerVisible?this.hidePicker():vc.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}changePicker(e,t){const n=this;return super.changePicker(e&&Xt.assign({projectEvent:n.projectEvent,store:n.store,readOnly:n.readOnly,resourceImagePath:n.resourceImageFolderPath,assignments:n.valueCollection,onCancelClick(){n.value=this.originalSelected,this.hide()},align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]}},e)||null,t)}changeProjectEvent(e){const{picker:t,store:n}=this;return this._projectEvent=e,n&&(n.projectEvent=e),t&&(t.projectEvent=e),e}changeStore(e){return!e||e instanceof RO||(e=new RO(e)),e}updateStore(e){const t=this;if(t.detachListeners("storeMutation"),e instanceof RO){const{projectEvent:n}=e;n?t.projectEvent=n:e.projectEvent=t.projectEvent}e.ion({name:"storeMutation",change:"syncInputFieldValue",thisObj:t})}get value(){return super.value}set value(e){var t;e=null===(t=e)||void 0===t?void 0:t.map((e=>{const t=this.store.find((t=>t.resource===e.resource),!0);return null==t||t.copyData(e),t})),super.value=e}hasChanged(e,t){return!Xt.isEqual(e,t)}onPickerKeyDown(e){const t=this.picker;"ArrowDown"===e.key&&e.target.compareDocumentPosition(t.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING?t.element.focus():"Escape"!==e.key||t.focusedCell.isActionable||this.hidePicker()}cacheCurrentValue(e){return Array.isArray(e)?this._value=e.map((e=>e.copy(e.id))):super.cacheCurrentValue(e)}}AO.initClass(),AO._$name="AssignmentField";const FO=e=>e.resourceName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");class PO extends td{internalCellCls="b-resourceassignment-cell";static get $name(){return"ResourceAssignmentColumn"}static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin",{name:"itemTpl",defaultValue:(e,t,n=!0)=>n?$.encodeHtml(e.toString()):e.toString()},"avatarTooltipTemplate",{name:"showAllNames",type:"boolean",defaultValue:!0},{name:"enableResourceDragging"},"avatarTooltip",{name:"avatarMaxSize",defaultValue:50}]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,showAvatars:!1,sideMargin:20,sortable(e,t){const n=e.assignments.join(""),r=t.assignments.join("");return n===r?0:n<r?-1:1},filterable({value:e,record:t}){if(Array.isArray(e)){if(!e.length)return Boolean(!t.assignments.length);e=e.map(FO).join("|")}const n=new RegExp(e,"gi");return t.assignments.some((e=>n.test(e.resourceName)))},alwaysClearCell:!1}}construct(){super.construct(...arguments);const e=this,{grid:t}=e;e.showAvatars&&Object.assign(e,{repaintOnResize:!0,htmlEncode:!1,renderer:e.rendererWithAvatars,avatarRendering:new of({element:t.element,tooltip:Xt.assign({forSelector:".b-resourceassignment-cell .b-resource-avatar",internalListeners:{beforeShow({source:t}){var n;const{taskRecord:r,resourceRecord:i,assignmentRecord:s,overflowCount:o,overflowAssignments:a}=t.activeTarget.elementData,l=null===(n=e.avatarTooltipTemplate)||void 0===n?void 0:n.call(e,{taskRecord:r,resourceRecord:i,assignmentRecord:s,overflowCount:o,tooltip:t,overflowAssignments:a});if(0===t.items.length){const n=e.showAllNames?`${$.encodeHtml(s)}<br />${a.join("<br />")}`:$.xss`${s}${o?` (+${o} ${e.L("L{more resources}")})`:""}`;t.html=l??n}}}},e.avatarTooltip)})}),e.enableResourceDragging&&e.grid.ion({paint:e.setupDragging,thisObj:e,once:!0}),t.ion({beforeCellEditStart:e.onBeforeCellEditStart,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.showAvatars&&(t.ion({beforeRenderRows:e.calculateAvatarSize,once:!0,thisObj:e}),t.rowManager.ion({beforeRowHeight:e.calculateAvatarSize,thisObj:e})),t.resourceStore.ion({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}calculateAvatarSize({height:e}){const{grid:t}=this,n=e||t.rowHeight,{cellElement:i}=t.beginGridMeasuring();i.classList.add(this.internalCellCls);const s=r.getComputedStyle(i),o=parseInt(s.paddingTop,10);this.avatarRendering.size=Math.min(this.avatarMaxSize,n-2*o),i.classList.remove(this.internalCellCls),t.endGridMeasuring()}doDestroy(){var e,t;super.doDestroy(),null===(e=this.avatarRendering)||void 0===e||e.destroy(),null===(t=this.dragHelper)||void 0===t||t.destroy()}get defaultEditor(){return{type:AO.type,store:{modelClass:this.grid.project.assignmentStore.modelClass}}}onBeforeCellEditStart({editorContext:{record:e,column:t}}){const n=this;if(t===n){const{editor:t}=n;t.resourceImageFolderPath=n.grid.resourceImageFolderPath,t.projectEvent=e,n.detachListeners("editorStore"),t.store.ion({name:"editorStore",changesApplied:n.onEditorChangesApplied,thisObj:n})}}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,t=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});t&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:t})}onResourceUpdate({source:e}){var t;null!==(t=e.project)&&void 0!==t&&t.propagatingLoadChanges||this.grid.refreshColumn(this)}get chipView(){const e=this;return e._chipView||(e._chipView=new Ec({parent:e,cls:"b-assignment-chipview",navigator:null,itemsFocusable:!1,closable:!1,itemTpl:e.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(e.chipView,"isVisible",{get:()=>!0}),e.chipView.triggerPaint()),e._chipView}renderer({cellElement:e,value:t,isExport:n}){if(t=t.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName))),n)return t.map(((e,t)=>this.itemTpl(e,t,!1))).join(",");{const{chipView:n}=this,r=e.querySelector(".b-assignment-chipview-wrap")||Br.createElement({parent:e,className:"b-assignment-chipview-wrap"});n.store.storage.replaceValues({values:t,silent:!0}),n.refresh();const i=n.element.cloneNode(!0);i.removeAttribute("id"),r.innerHTML="",r.appendChild(i)}}rendererWithAvatars({record:e,value:t,isExport:n}){t=t.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName)));const r=this,{size:i}=r.avatarRendering,s=Math.floor((r.width-r.sideMargin)/(i+2)),o=t.length>s?t.length-s:0,a=t.length>s?t.filter((e=>t.indexOf(e)>=s)):[];return n?t.map(((e,t)=>this.itemTpl(e,t,!1))).join(","):{className:"b-resource-avatar-container",children:t.map(((t,n)=>{const{resource:l}=t;if(n<s){const c=o>0&&n===s-1,d=r.renderAvatar({taskRecord:e,resourceRecord:l,assignmentRecord:t,overflowCount:c?o:0,overflowAssignments:c?a:[]});return c?{className:"b-overflow-img b-resource-avatar",style:{height:i+"px",width:i+"px"},children:[d,{tag:"span",className:"b-overflow-count",html:`+${o}`}]}:d}}))}}renderAvatar({taskRecord:e,resourceRecord:t,assignmentRecord:n,overflowCount:r,overflowAssignments:i}){const{resourceImageFolderPath:s}=this.grid,o=t.imageUrl||t.image&&s&&s+t.image,a=this.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:this.defaultAvatar,imageUrl:o});return a.elementData||(a.elementData={}),Object.assign(a.elementData,{taskRecord:e,resourceRecord:t,assignmentRecord:n,overflowCount:r,overflowAssignments:i}),a}get defaultAvatar(){const{grid:e}=this;return e.defaultResourceImageName?e.resourceImageFolderPath+e.defaultResourceImageName:""}toClipboardString({record:e}){return $.safeJsonStringify(e[this.field])}fromClipboardString({string:e,record:t}){const n=$.safeJsonParse(e),r=[];if(null!=n&&n.length)for(const e of n)delete e.id,delete e.event,delete e.resource,e.eventId=t.id,r.push(new TO(e));return r}canFillValue({range:e}){return e.every((e=>e.column===this))}calculateFillValue({record:e,value:t}){const n=JSON.stringify(t);return this.fromClipboardString({string:n,record:e})}setupDragging(){const e=this,{grid:t}=e;t.features.rowReorder&&(t.features.rowReorder.dragHelper.targetSelector+=" .b-grid-cell:not(.b-resourceassignment-cell)"),e.subGrid.element.classList.add("b-draggable-resource-avatars"),e.dragHelper=new Hc({callOnFunctions:!0,cloneTarget:!0,targetSelector:".b-resource-avatar-container > .b-resource-avatar",onDragStart({context:e}){const{grabbed:n}=e;e.resourceRecord=n.elementData.resourceRecord,t.enableScrollingCloseToEdges()},onDrag({context:e,event:n}){const r=e.targetTask=t.resolveTaskRecord(n.target);e.valid=Boolean(r&&!r.resources.includes(e.resourceRecord))},async onDrop({context:n,event:r}){const{targetTask:i,resourceRecord:s,valid:o,grabbed:a,element:l}=n,{assignmentRecord:c,taskRecord:d}=a.elementData,u=r.target.closest(".b-resourceassignment-cell");if(o&&(a.style.display="none"),u){if(o){const n=t.getCell({column:e,record:i}),r=null==n?void 0:n.querySelector(".b-resource-avatar-container");r&&await this.animateProxyTo(r,{align:"l0-r0"}),i.resources.includes(s)||(c.event=i)}}else l.style.display="none",d.unassign(s);t.disableScrollingCloseToEdges()}})}}id.registerColumnType(PO),PO._$name="ResourceAssignmentColumn";class OO extends df{static get $name(){return"RollupColumn"}static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}}id.registerColumnType(OO),OO._$name="RollupColumn";class LO extends td{static $name="SchedulingDirectionColumn";static type="schedulingdirection";static isGanttColumn=!0;static get defaults(){return{field:"direction",text:"L{schedulingDirection}",width:146,editor:{type:"schedulingdirectionpicker",allowInvalid:!1},filterable:{filterField:{type:"schedulingdirectionpicker"}}}}getEnforcedName(e){return e.name||(e.isRoot?"Project":`Task #${e.id}`)}get tooltipRenderer(){return this._tooltipRenderer!==i?this._tooltipRenderer:this._tooltipRenderer=({record:e})=>{const{effectiveDirection:t}=e;return!!t&&("enforced"===t.kind?this.L("L{enforcedBy}")+` "${this.getEnforcedName(t.enforcedBy)}"`:"inherited"===t.kind?this.L("L{inheritedFrom}")+` "${this.getEnforcedName(t.inheritedFrom)}"`:i)}}renderer({record:e}){const{effectiveDirection:t}=e;if(!t)return"";let n;return n="enforced"===t.kind||"inherited"===t.kind?t.direction:e.direction,QA.localize(n)||""}}id.registerColumnType(LO),LO._$name="SchedulingDirectionColumn";class $O extends td{static get $name(){return"SchedulingModeColumn"}static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:eF.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){const e=this;let t;super.afterConstruct(),t=e.editor?e.editor.store:(new eF).store,this.store=t}renderer({value:e}){const t=this.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}canFillValue({range:e}){return e.every((e=>e.column===this))}}id.registerColumnType($O),$O._$name="SchedulingModeColumn";class _O extends td{static get $name(){return"SequenceColumn"}static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}}id.registerColumnType(_O),_O._$name="SequenceColumn";class jO extends df{static get $name(){return"ShowInTimelineColumn"}static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}}id.registerColumnType(jO),jO._$name="ShowInTimelineColumn";class BO extends UP{static get $name(){return"StartDateColumn"}static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="startdate",e}}id.registerColumnType(BO),BO._$name="StartDateColumn";class VO extends EO{static get $name(){return"SuccessorColumn"}static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}canFillValue=()=>!1}id.registerColumnType(VO),VO._$name="SuccessorColumn";class HO extends Tv{static get $name(){return"TotalSlackColumn"}static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}",filterable({value:e,record:t,operator:n,column:r}){const i=Gt.asMilliseconds(r.roundValue(t.totalSlack),t.slackUnit),s=e.milliseconds;switch(n){case"=":return i===s;case"<":return i<s;case"<=":return i<=s;case">":return i>s;case">=":return i>=s;default:throw new Error("Invalid operator "+n)}}}}getFilterableValue(e){return new us({magnitude:e.totalSlack,unit:e.slackUnit})}}id.registerColumnType(HO),HO._$name="TotalSlackColumn";class NO extends td{static get $name(){return"WBSColumn"}static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsValue",text:"L{WBS}",width:70,editor:null,filterable:({value:e,record:t})=>t.wbsValue.match(String(e)),headerMenuItems:{renumber:{text:"L{WBSColumn.renumber}",icon:"b-icon-renumber",onItem({source:e}){e.taskStore.rootNode.refreshWbs()}}},renderer:({value:e})=>String(e)}}canFillValue=()=>!1}id.registerColumnType(NO),NO._$name="WBSColumn";var zO={AddNewColumn:WP,BaselineStartDateColumn:GP,BaselineEndDateColumn:YP,BaselineDurationColumn:qP,BaselineStartVarianceColumn:XP,BaselineEndVarianceColumn:ZP,BaselineDurationVarianceColumn:KP,CalendarColumn:QP,ConstraintDateColumn:eO,ConstraintTypeColumn:nO,DeadlineDateColumn:rO,DurationColumn:Tv,EarlyEndDateColumn:iO,EarlyStartDateColumn:sO,EffortColumn:oO,EndDateColumn:aO,IgnoreResourceCalendarColumn:lO,InactiveColumn:cO,LateEndDateColumn:dO,LateStartDateColumn:uO,ManuallyScheduledColumn:hO,MilestoneColumn:gO,NameColumn:mO,NoteColumn:pO,PercentDoneColumn:fO,PredecessorColumn:xO,ResourceAssignmentColumn:PO,RollupColumn:OO,SchedulingDirectionColumn:LO,SchedulingModeColumn:$O,SequenceColumn:_O,ShowInTimelineColumn:jO,StartDateColumn:BO,SuccessorColumn:VO,TotalSlackColumn:HO,WBSColumn:NO};class WO extends df{static get $name(){return"EventModeColumn"}static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"L{Event mode}"}}internalRenderer({value:e,cellElement:t,column:n,isExport:r}){if(super.internalRenderer(...arguments),r)return this.renderText(e);t.widget&&(t.widget.text=this.renderText(e))}onCheckboxChange({source:e,checked:t}){super.onCheckboxChange(...arguments),e.text=this.renderText(t)}renderText(e){return e?this.L("L{Manual}"):this.L("L{Auto}")}}id.registerColumnType(WO),WO._$name="EventModeColumn";class UO extends fD{static get defaults(){return{enableCellContextMenu:!0}}}id.registerColumnType(UO),UO._$name="TimeAxisColumn";class GO extends WT{static get defaultConfig(){return{modelClass:TO,loadPriority:500,syncPriority:400}}}GO._$name="AssignmentStore";class YO extends iM{}YO._$name="CalendarModel";class qO extends oM{static get defaultConfig(){return{modelClass:YO}}}qO._$name="CalendarManagerStore";class KO extends uM{constructor(...e){const[t]=e;null!=t&&t.fromTask&&(t.fromEvent=t.fromTask),null!=t&&t.toTask&&(t.toEvent=t.toTask),super(...e)}get from(){var e;return null===(e=this.fromEvent)||void 0===e?void 0:e.id}set from(e){super.from=e}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return null===(e=this.toEvent)||void 0===e?void 0:e.id}set to(e){super.to=e}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}get persistableData(){const e=super.persistableData,{fromTask:t,toTask:n}=e;return t&&(e.fromTask=t.id),n&&(e.toTask=n.id),e}shouldRecordFieldChange(e,t,n){return"from"!==e&&"to"!==e&&super.shouldRecordFieldChange(e,t,n)}}KO._$name="DependencyModel";class XO extends gM{static get defaultConfig(){return{modelClass:KO,loadPriority:300,syncPriority:500}}}XO._$name="DependencyStore";class ZO extends eA{}ZO._$name="ResourceModel";class JO extends nA{static get defaultConfig(){return{modelClass:ZO,loadPriority:400,syncPriority:200}}}JO._$name="ResourceStore";class QO extends Iv{static fields=[{name:"task",persist:!1}];isBaseline=!0;get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}internalCalculateStartDate(e,t,n=this.durationUnit){return this.task.graph?this.task.run("calculateProjectedXDateWithDuration",e,!1,t):super.internalCalculateStartDate(e,t,n)}internalCalculateEndDate(e,t,n=this.durationUnit){return this.task.graph?this.task.run("calculateProjectedXDateWithDuration",e,!0,t):super.internalCalculateEndDate(e,t,n)}internalCalculateDuration(e,t,n=this.durationUnit){return this.task.graph?this.task.run("calculateProjectedDuration",e,t):super.internalCalculateDuration(e,t,n)}normalize(){const{task:e,startDate:t,endDate:n,duration:r}=this;var i;e.graph||(null===(i=e.project)||void 0===i||i.once("dataReady",(()=>this.internalNormalize(t,n,r))));super.normalize()}get startVariance(){const{task:e}=this,t=Gt.getDurationInUnit(this.startDate,e.startDate,e.durationUnit);return new us({magnitude:t,unit:e.durationUnit})}get endVariance(){const{task:e}=this,t=Gt.getDurationInUnit(this.endDate,e.endDate,e.durationUnit);return new us({magnitude:t,unit:e.durationUnit})}get durationVariance(){return this.fullDuration&&this.task.fullDuration.diff(this.fullDuration)}}QO._$name="Baseline";class eL extends Wi{static get type(){return"wbs"}convert(e){return Xs.from(e)}serialize(e){return String(e)}}eL.prototype.compare=Xs.compare,eL.initClass(),eL._$name="WbsField";const tL=(e,t)=>{const{startDate:n,durationUnit:r,endDate:i}=e;return t?t.map((t=>{const s=+("startDate"in t)+("endDate"in t)+("duration"in t)>1,o={task:e,...t};return s||Object.assign(o,{startDate:n,endDate:i,durationUnit:r}),o})):[]},nL=e=>"wbsValue"===e.field&&!e.ascending,rL={deep:!0},iL={deep:!0,silent:!0};class sL extends(PP.derive(Iv).mixin(HT,mM)){static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:QO,storeClass:ao,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventColor"]}$manuallyScheduled=null;getDefaultSegmentModelClass(){return $I}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach((e=>{e.stores.forEach((t=>{t.updateModifiedBagForRecord(e)}))}))}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=Xs.from(e)}copy(...e){const t=super.copy(...e);return t.setData("wbsValue",null),t}processBaselinesStoreData(e){return tL(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;if(!e.$initializedBaselines){e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0}return e.meta.baselinesStore}get hasBaselines(){var e;const t=this.fieldMap.baselines;return Boolean((null===(e=this.baselines)||void 0===e?void 0:e.count)??this.originalData[t.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:t}=this,n=e-t.count;n>0?t.add(tL(this,new Array(n).fill({}))):t.getAt(e-1).set(tL(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.replaceDependencies(e,!0)}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,t){const n=this,{dependencyStore:r}=n.project,i=new Set,s=new Set,o=[],a=t?n.outgoingDeps:n.incomingDeps,l=Array.from(a);return e.forEach((e=>{const n=l.find(t?t=>t.toEvent===e.toEvent:t=>t.fromEvent===e.fromEvent);n?(i.add(n),n.copyData(e)):s.add(e)})),a.forEach((e=>{i.has(e)||o.push(e)})),o.forEach((e=>r.remove(e))),s.forEach((e=>{t?e.fromEvent=n:e.toEvent=n,r.add(e)})),n.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){return this.replaceDependencies(e,!1)}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const{assignmentStore:t}=this.project,n=[],r=this.assignments.filter((t=>!(null!=e&&e.find((e=>e.resource===t.resource)))));e.forEach((e=>{const r=t.getAssignmentForEventAndResource(this,e.resource);r?r.copyData(e):(e.remove(),n.push(e))})),t.remove(r),t.add(n)}get assigned(){const{project:e}=this;return null!=e&&e.isDelayingCalculation?e.assignmentStore.storage.findItem("event",this)??new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.milestone}isEditable(e){var t;const n=this;switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":return n.isLeaf;case"percentDone":case"renderedPercentDone":return n.isLeaf||!(null!==(t=n.project)&&void 0!==t&&t.autoCalculatePercentDoneForParentTasks);case"endDate":case"duration":case"fullDuration":return n.isLeaf||n.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return"fullEffort"===e?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return null!==(e=this.project)&&void 0!==e&&e.isDelayingCalculation?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const t=this,n=[],r=[];null==e||e.forEach((e=>{e.fromEvent===t||e.fromEvent===t.id?r.push(e):e.toEvent!==t&&e.toEvent!==t.id||n.push(e)})),t.setPredecessors(n),t.setSuccessors(r)}get predecessorTasks(){return[...this.incomingDeps||[]].map((e=>e.fromEvent))}get successorTasks(){return[...this.outgoingDeps||[]].map((e=>e.toEvent))}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let t=null;return e.isProject?t=e:e.bubbleWhile((e=>(e.isProject&&(t=e),!t))),t}get fullEffort(){return new us({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}get $linkedResources(){var e;return(null===(e=this.resources)||void 0===e?void 0:e.flatMap((e=>[e,...e.$links])))??[]}normalize(){}inSetNormalize(e){}joinStore(e){const t=this,n=(t.firstStore||e).useOrderedTreeForWbs;var r,i;t.wbsValue||t.generatedParent||((t.taskStore||e).isLoadingData||!(null!==(r=t.nextSibling)&&void 0!==r&&r.wbsValue||null!==(i=t.previousSibling)&&void 0!==i&&i.wbsValue)?t.refreshWbs({useOrderedTree:n,...iL}):t.parent.refreshWbs(rL,-1));super.joinStore(e)}refreshWbs(e,t){const n=this,{parent:r}=n,i=n.firstStore||null,{useOrderedTree:s=(null==i?void 0:i.useOrderedTreeForWbs)??!1,refreshed:o}=e||{};if(r&&-1!==t&&n.fieldMap.wbsValue){t=s?n.orderedParentIndex:t??n.unfilteredIndex??n.parentIndex,t++;const i=r.isRoot?new Xs(t):r.wbsValue.append(t);null!=e&&e.silent?n.setData("wbsValue",i):n.set("wbsValue",i,!1,!1,!1,!1,!1)}if(null==o||o.add(n),(null==e?void 0:e.deep)??1)if(s)for(const t of n.orderedChildren??[])t.refreshWbs(e);else{const t=n.unfilteredChildren??n.children,r=(null==t?void 0:t.length)||0;if(r){var a;const n=(e=>{for(let t,n,r=0,i=e.length;r<i;++r)if(n=e[r].wbsValue,n){if(t)return n<t;t=n}return!1})(t)&&0===(null==i||null===(a=i.sorters)||void 0===a?void 0:a.findIndex(nL));for(let i=0;i<r;++i)t[i].refreshWbs(e,n?r-i-1:i)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}updateDependencies(e,t){this.outgoingDeps.forEach((n=>{if(n.toEvent.isScheduled){const{type:r,calendar:i,toEvent:s}=n;e&&(r===nC.Type.StartToStart?n.setLag(Gt.as("hour",i.calculateDurationMs(e,s.startDate,!0)),"hour"):r===nC.Type.StartToEnd&&n.setLag(Gt.as("hour",i.calculateDurationMs(e,s.endDate,!0)),"hour")),t&&(r===nC.Type.EndToStart?n.setLag(Gt.as("hour",i.calculateDurationMs(t,s.startDate,!0)),"hour"):r===nC.Type.EndToEnd&&n.setLag(Gt.as("hour",i.calculateDurationMs(t,s.endDate,!0)),"hour"))}}))}async moveTaskPinningSuccessors(e){const t=this;return t.startDate=e,t.bubble((e=>{if(!e.isRoot){const t=e.run("calculateStartDate"),n=e.run("calculateEndDate");e.updateDependencies(t,n)}})),t.project.commitAsync()}async setStartDatePinningSuccessors(e){const t=this.setStartDate(e,!1);return this.bubble((e=>{if(!e.isRoot){const t=e.run("calculateStartDate");e.updateDependencies(t,null)}})),t}async setEndDatePinningSuccessors(e){const t=this;return t.endDate=e,t.bubble((e=>{if(!e.isRoot){const t=e.run("calculateEndDate");e.updateDependencies(null,t)}})),t.project.commitAsync()}getCurrentConfig(e){const{segments:t}=this,n=super.getCurrentConfig(e);return n&&t&&(n.segments=t.map((t=>t.getCurrentConfig(e)))),n}}sL.convertEmptyParentToLeaf=!0,sL._$name="TaskModel";const oL={deep:!0},aL=Object.freeze({add:!0,remove:!0,sort:!0}),lL=Object.freeze({add:!1,remove:!1,sort:!1}),cL=(e,t)=>Xs.compare(null==e?void 0:e.wbsCode,null==t?void 0:t.wbsCode);class dL extends(BI.derive(ho).mixin(HT,eb,Gy)){static $name="TaskStore";static get defaultConfig(){return{modelClass:sL,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1,forceWbsOrderForChanges:!1}}changeWbsMode(e){return"auto"===e?aL:e&&"object"==typeof e?(Xt.values(e).every((e=>!e))&&(e=Xt.assign({},aL,e)),e):lL}setBaseline(e){const t=this.storage.values;this.forEach((t=>t.setBaseline(e))),this.trigger("refresh",{action:"batch",records:t,data:t})}async indent(e){const t=this,{taskStore:n,project:r}=t;let i=!1;if(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel))).filter((t=>{let n;for(n=Boolean(t.previousSibling);n&&!t.isRoot;)n=!e.includes(t.parent),t=t.parent;return n})),e.length&&!1!==n.trigger("beforeIndent",{records:e})){if(e.sort(((e,n)=>Math.max(0,t.indexOf(e))-Math.max(0,t.indexOf(n)))),n.beginBatch(),i=await r.tryPropagateWithChanges((()=>{for(const n of e){const e=n.previousSibling;e.appendChild(n),t.toggleCollapse(e,!1)}})),t.isDestroyed)return;n.endBatch(),i&&(t.refreshWbsForChildren({up:2,nodes:e}),t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e}))}return i}async outdent(e){const t=this,{taskStore:n,project:r}=t;let i=!1;if(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel))).filter((t=>{let n;for(n=t.parent&&!t.parent.isRoot;n&&!t.isRoot;)n=!e.includes(t.parent),t=t.parent;return n})),e.length&&!1!==n.trigger("beforeOutdent",{records:e})){if(e.sort(((e,t)=>Xs.compare(t.wbsCode,e.wbsCode))),n.beginBatch(),i=await r.tryPropagateWithChanges((()=>{for(const n of e){const e=!this.outdentIgnoringSiblings&&n.parent.children.slice(n.parent.children.indexOf(n)+1);n.parent.parent.insertChild(n,n.parent.nextSibling,!1,{orderedBeforeNode:n.parent.nextOrderedSibling}),e.length&&n.appendChild(e),t.toggleCollapse(n,!1)}})),t.isDestroyed)return;n.endBatch(),i&&(t.refreshWbsForChildren({up:1,nodes:e}),t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e}))}return i}onNodeAddChild(e,t,n,r,i=!1){if(super.onNodeAddChild(e,t,n,r,i),!this.isLoadingData&&this.wbsMode.add){e.refreshWbs(oL);const n=new Set;t.forEach((t=>{const r=this.getById(t.meta.oldParentId);r&&e!==r&&!n.has(r)&&(n.add(r),r.refreshWbs(oL,-1))}))}}onNodeRemoveChild(e,t,n,r={isMove:!1,silent:!1,unfiltered:!1}){const i=super.onNodeRemoveChild(e,t,n,r);return this.wbsMode.remove&&!r.isMove&&e.refreshWbs(oL),i}applyChangeset(e,t=null,...n){const r=this,{updated:s,modified:o}=(null==t?void 0:t(e,r))??e,a=s??o??[],l=r.forceWbsOrderForChanges&&r.tree&&!r.isSorted&&!r.isGrouped?a.reduce(((e,{id:t,parentId:n})=>{if(n!==i){var s;const i=r.getById(t);n===(null==i||null===(s=i.parent)||void 0===s?void 0:s.parentId)&&e.push({node:i,originalNodeAbove:i.previousSibling??i.parent})}return e}),[]):[],c=super.applyChangeset(e,t,...n);if(l.length>0)for(const{node:e,originalNodeAbove:t}of l){var d;const{parent:n}=e,r=t.parent===n?t.parentIndex:(null===(d=t.parent)||void 0===d?void 0:d.parent)===n?t.parent.parentIndex:i;r!==i&&n.children.includes(e)&&n.insertChild(e,r+1,!1,{orderedParentIndex:{skip:!0}})}return c}afterChangesetApplied(e){super.afterChangesetApplied(e);const t=e.slice().sort(((e,t)=>e.childLevel-t.childLevel)),n=new Set;t.forEach((e=>{n.has(e)||e.refreshWbs({deep:!0,refreshed:n})}))}afterPerformSort(e){this.wbsMode.sort&&this.rootNode.refreshWbs(oL),super.afterPerformSort(e)}refreshWbsForChildren(e){const t=e.nodes,n={...oL,...e},r=new Set,i=n.up||0;let s,o;for(o of(t.forEach((e=>{for(o=e,s=i;o&&s;--s)o=o.parent;r.add(o)})),r))o.refreshWbs(n)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(e){const t=this.resourceStore.getById(e),n=(null==t?void 0:t.assignments.filter((e=>e.isPartOfStore(this.assignmentStore))))||[],r=[];return n.forEach((({event:e})=>e&&r.push(e))),r}isDateRangeAvailable(e,t,n,r){const i=new Set(this.getEventsForResource(r));if(null!=n&&n.isAssignment){n.event.resources.forEach((e=>{e.id!==n.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(n){const e=n.isAssignment?n.event:n;i.delete(e)}return!Array.from(i).some((n=>n.isScheduled&&Gt.intersectSpans(e,t,n.startDate,n.endDate)))}linkTasks(e){for(let t=1;t<e.length;t++){const n=e[t-1],r=e[t];this.dependencyStore.getEventsLinkingDependency(n,r)||this.dependencyStore.add({from:n,to:r})}}unlinkTasks(e){this.dependencyStore.remove(this.dependencyStore.query((({fromTask:t,toTask:n})=>e.includes(t)||e.includes(n))))}get changes(){const e=super.changes;return e&&this.forceWbsOrderForChanges&&(e.added.sort(cL),e.modified.sort(cL),e.removed.sort(cL)),e}}dL._$name="TaskStore";const uL=".b-task-baseline";class hL extends ND{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:uL,recordType:"baseline"}}static configurable={renderer:null};static get pluginConfig(){return{chain:["onTaskDataGenerated","onInternalPaint"]}}updateRenderer(){this.gantt.refresh()}construct(e,t){this.tipId=`${e.id}-baselines-tip`,this.gantt=e,super.construct(e,t)}doDisable(e){this.client.refreshWithTransition(),super.doDisable(e)}resolveTimeSpanRecord(e){const t=e.closest(uL);return null==t?void 0:t.elementData.baseline}template(e){const t=this,{baseline:n}=e,{task:r}=n,i=t.client.formatDuration(n.duration);return`\n            <div class="b-gantt-task-title">${$.encodeHtml(r.name)} (baseline ${n.parentIndex+1})</div>\n            <table>\n            <tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${e.startClockHtml}</td></tr>\n            ${n.milestone?"":`\n                <tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.endClockHtml}</td></tr>\n                <tr><td>${t.L("L{TaskTooltip.Duration}")}:</td><td class="b-right">${i+" "+Gt.getLocalizedNameOfUnit(n.durationUnit,1!==n.duration)}</td></tr>\n            `}\n            </table>\n            `}getTaskDOMConfig(e,t){const n=this,r=e.baselines.allRecords,{rtl:i}=n.client,s=i?"right":"left";return{className:{"b-baseline-wrap":!0},style:{transform:`translateY(${t}px)`},dataset:{taskId:`baselinesFor${e.id}`},children:r.map(((t,r)=>{const o=n.gantt.taskRendering.getTaskBox(t),a=o?i?n.client.timeAxisSubGrid.totalFixedWidth-o.left:o.left:0;if(o){const i={className:{[t.cls]:t.cls,"b-task-baseline":1,"b-task-baseline-milestone":t.milestone},style:{width:o.width,[s]:a,style:t.style},dataset:{index:r},elementData:{baseline:t}},l=n.renderer?n.renderer({baselineRecord:t,taskRecord:e,renderData:i}):"";return"string"==typeof l?i.html=l:i.children=[l].flat(),i}return null})),syncOptions:{syncIdField:"index",strict:!0}}}onTaskDataGenerated({taskRecord:e,top:t,extraConfigs:n,wrapperCls:r}){!this.disabled&&e.hasBaselines&&(r["b-has-baselines"]=1,n.push(this.getTaskDOMConfig(e,t)))}}hL._$name="Baselines",Ed.registerFeature(hL,!1,"Gantt");const gL={element:document,capture:!0,keydown:e=>"Tab"===e.key&&(e.preventDefault(),e.stopImmediatePropagation())};class mL extends bA{static get $name(){return"CellEdit"}static get defaultConfig(){return{addNewAtEnd:{duration:1}}}static get pluginConfig(){const e=super.pluginConfig;return e.chain=[...e.chain,"onProjectChange"],e}onProjectChange(){this.cancelEditing(!0)}getEditorForCell({record:e}){var t;const n=super.getEditorForCell(...arguments),{inputField:r}=n;return r.project=e.project,r.eventRecord=e,null===(t=r.loadEvent)||void 0===t||t.call(r,e,!1),n}doAddNewAtEnd(){const e=this,t=e.grid,{addNewAtEnd:n,addToCurrentParent:r}=e,{project:i,newTaskDefaults:s}=t,o=Zn.on(gL);return i.queue((async()=>{if(await(!i.isDestroying&&i.commitAsync()),t.isDestroyed||t.store!==t.taskStore)return null;const a=Xt.assign({name:e.L("L{Gantt.New task}"),startDate:i.startDate},n,s);let l;return l=r?t.addTaskBelow(t.taskStore.last,{data:a}):t.taskStore.rootNode.appendChild(a),await i.commitAsync(),t.isDestroyed?null:(t.rowManager.getRowFor(l)||t.rowManager.displayRecordAtBottom(),e.setTimeout(o,100),l)}))}onCellEditStart(){this.client.project.suspendAutoSync()}afterCellEdit(){this.client.project.resumeAutoSync()}}mL._$name="CellEdit",Ed.registerFeature(mL,!0,"Gantt");class pL extends(mi(fi)){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}doDisable(e){const t=this;e?t.unhighlightCriticalPaths():t.client.project.graph?t.highlightCriticalPaths():t.client.project.ion({graphReady(){t.highlightCriticalPaths()},thisObj:t,once:!0}),super.doDisable(e)}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}setupObserver(){const e=this,{project:t}=e.client;let n;e.destroyObserver(),e.criticalPathObserver=t.getGraph().observe((function*(){return yield t.$.criticalPaths}),(t=>{if(!e.disabled){if(e.removeCriticalCls(),n=n||e.getDependenciesFeature())for(const r of t)for(const t of r)t.dependency&&n.highlight(t.dependency,e.criticalDependencyCls);e.client.trigger("criticalPathsHighlighted")}}))}destroyObserver(){var e,t;this.criticalPathObserver&&(null===(e=this.client.project)||void 0===e||null===(t=e.getGraph)||void 0===t||t.call(e).removeIdentifier(this.criticalPathObserver),this.criticalPathObserver=null)}doDestroy(){this.destroyObserver(),super.doDestroy()}highlightCriticalPaths(){const e=this,{element:t}=e.client;t.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),e.setupObserver(),t.classList.add(e.cls)}removeCriticalCls(){const e=this.client.project,t=this.getDependenciesFeature();t&&e.dependencyStore.forEach((e=>t.unhighlight(e,this.criticalDependencyCls)))}unhighlightCriticalPaths(){const e=this,t=e.client;e.destroyObserver(),e.removeCriticalCls(),t.element.classList.remove(e.cls),t.trigger("criticalPathsUnhighlighted")}onTaskDataGenerated(e){this.disabled||(e.cls["b-critical"]=e.taskRecord.critical)}}pL._$name="CriticalPaths",Ed.registerFeature(pL,!0,"Gantt");const fL=["start","start","end","end"],vL=["start","end","start","end"],yL=({fromTask:e},{fromTask:t})=>(null==e?void 0:e.critical)===(null==t?void 0:t.critical)?0:null!=e&&e.critical?1:-1,bL=e=>Math.round(2*e)/2;class CL extends CA{static $name="Dependencies";static configurable={terminalSides:["left","right"],highlightDependenciesOnEventHover:!0,tooltipTemplate(e){if(!e)return null;const t=this,{dependencyIdField:n}=t.client,{fromEvent:r,toEvent:i}=e;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:t.L("L{from}")},{text:`${r.name} ${r[n]}`},{className:`b-sch-box b-${e.fromSide||fL[e.type]}`},{tag:"label",text:t.L("L{to}")},{text:`${i.name} ${i[n]}`},{className:`b-sch-box b-${e.toSide||vL[e.type]}`},e.lag?{tag:"label",text:t.L("L{DependencyEdit.Lag}")}:null,e.lag?{text:e.fullLag}:null]}]}},pathFinderConfig:{otherHorizontalMargin:0,otherVerticalMargin:0}};construct(e,t={}){e.isGantt&&(this.gantt=e),super.construct(e,t)}createMarkers(){super.createMarkers();const e=this.endMarker.cloneNode(!0);e.setAttribute("id","arrowEndCritical"),e.retainElement=!0,this.client.svgCanvas.appendChild(e)}get rowStore(){return this.client.store}attachToResourceStore(...e){this.gantt||super.attachToResourceStore(...e)}getDependencyKey(e,...t){return this.gantt||super.getDependencyKey(e,...t),e.id}getAssignmentElement(e){return this.gantt?this.client.getElementFromTaskRecord(e):super.getAssignmentElement(e)}getAssignmentBounds(e){if(!this.gantt)return super.getAssignmentBounds(e);const{client:t}=this,n=t.getElementFromTaskRecord(e);return n&&!t.isExporting?wn.from(n,this.relativeTo):t.isEngineReady&&t.getTaskBox(e,!0,!0)}isDependencyVisible(e){var t,n;return this.gantt?(null===(t=e.fromEvent)||void 0===t?void 0:t.isScheduled)&&(null===(n=e.toEvent)||void 0===n?void 0:n.isScheduled):super.isDependencyVisible(e)}drawDependency(e,t=!1,n=null){if(!this.gantt)return super.drawDependency(e,t,n);const r=this,{domConfigs:i,client:s}=r,{store:o}=s,a=s.firstVisibleRow.dataIndex,l=s.lastVisibleRow.dataIndex,{startMS:c,endMS:d}=s.visibleDateRange,{fromEvent:u,toEvent:h}=e;if(o.isAvailable(u)&&o.isAvailable(h)){const t=o.indexOf(u),g=o.indexOf(h),m=Math.min(u.startDateMS,h.startDateMS),p=Math.max(u.endDateMS,h.endDateMS);if(s.isExporting||null!=t&&null!=g&&!(t<a&&g<a||t>l&&g>l||m<c&&p<c||m>d&&p>d)){const t=r.getDomConfigs(e,u,h,n);t?i.set(e.id,t):i.delete(e.id)}r.afterDrawDependency(e,t,g,m,p)}t||r.domSync()}getDependenciesToConsider(e,t,n,r){var i;const s=null===(i=super.getDependenciesToConsider)||void 0===i?void 0:i.call(this,e,t,n,r),o=this.client.features.criticalPaths;return s&&null!=o&&o.enabled?Array.from(s).sort(yL):s}adjustLineDef(t,n){const r=this;if(!r.gantt)return n;const{rtl:i}=r.gantt,{startBox:s,endBox:o}=n,a=r.pathFinder.startArrowMargin,l=r.client.getRecordCoords(t.fromEvent,!0),c=r.client.getRecordCoords(t.toEvent,!0),d=bL(s.getEnd(i)),u=bL(o.getStart(i)),h=bL(o.getEnd(i)),g=i?u<=d&&h<=d+a:u>=d&&h>=d+a;return t.type===e.DependencyType.EndToStart&&s.bottom<o.y&&g&&(n.endSide="top",t.toEvent.milestone||(i?o.x=o.right-2*a:o.width=2*a)),{...n,startBox:o,endBox:s,endSide:n.startSide,startSide:n.endSide,boxesReversed:!0,otherBoxes:[{start:s.x,end:s.right,top:l.y,bottom:l.bottom},{start:o.x,end:o.right,top:c.y,bottom:c.bottom}]}}drawForTask(){_.deprecate("Gantt","6.0.0","Dependencies.drawForTask() is no longer needed"),this.refresh()}getHoverTipHtml({activeTarget:e}){const t=this.resolveDependencyRecord(e);return this.tooltipTemplate(t)}async createDependency(e){const{source:t,target:n,fromSide:r,toSide:i}=e,s=("start"===r?0:2)+("end"===i?1:0),o=this.dependencyStore.add({fromEvent:t,toEvent:n,type:s})[0];return await this.dependencyStore.project.commitAsync(),o}}CL._$name="Dependencies",Ed.registerFeature(CL,!0,"Gantt");class SL extends ND{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,layoutStyle:{flexDirection:"column"},defaultIndicators:{earlyDates:e=>e.earlyStartDate&&!e.isMilestone?{startDate:e.earlyStartDate,endDate:e.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:e=>e.lateStartDate&&!e.isMilestone?{startDate:e.lateStartDate,endDate:e.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:e=>e.constraintDate?{startDate:e.constraintDate,cls:`b-bottom b-constraint-date b-constraint-type-${e.constraintType}`,name:this.L(`L{ConstraintTypePicker.${e.constraintType}}`)}:null,deadlineDate:e=>e.deadlineDate?{startDate:e.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:null,tooltipTemplate:e=>{const{indicator:t}=e,n=$.encodeHtml(t.name);return e.endDate?`\n                        ${t.name?`<div class="b-gantt-task-title">${n}</div>`:""}\n                        <table>\n                            <tr><td>${this.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                            <tr><td>${this.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                        </table>\n                    `:`\n                    ${t.name?`<div class="b-gantt-task-title">${n}</div>`:""}\n                    ${e.startText}\n                `}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onInternalPaint"]}}construct(e,t={}){this.tipId=`${e.id}-indicators-tip`,t=Object.assign({},t);const{items:n}=t;super.construct(e,t),this.items=n}template(...e){return this.tooltipTemplate(...e)}set items(e){const t=this;t._indicators=Xt.assign({},t.defaultIndicators,e),t._indicatorAccessors={},t._indicatorStatus={};for(const e in t._indicators)t._indicatorStatus[e]=Boolean(t._indicators[e]),"function"!=typeof t._indicators[e]&&(t._indicators[e]=t.defaultIndicators[e]),Object.defineProperty(t._indicatorAccessors,e,{enumerable:!0,get:()=>!!t._indicatorStatus[e]&&t._indicators[e],set(n){t._indicatorStatus[e]=n,t.client.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(e,t){const{gantt:n,renderData:r}=this,{taskRecord:i}=r,{cls:s,iconCls:o}=e,{rtl:a,timeAxis:l,timeAxisViewModel:c}=n;let{startDate:d,endDate:u}=e;if(u&&(u=Math.min(u,c.endDate)),n.fillTicks){if(d=l.getSnappedTickFromDate(d).startDate,u){u=l.getSnappedTickFromDate(u).endDate}}const h=c.getPositionFromDate(d),g=u?Math.abs(c.getPositionFromDate(u-h)):null,m=null!=s&&s.isDomClassList?s:new Tn(s),{start:p,total:f}=n.resourceMarginObject,v=r.top||n.store.indexOf(i)*n.rowManager.rowOffsetHeight+p,y=r.height||n.rowHeight-f;return e.taskRecord=i,{className:Object.assign(m,{"b-indicator":1,"b-has-icon":e.iconCls}),style:{[a?"right":"left"]:h,top:v,height:y,width:g,style:e.style},dataset:{taskId:`${r.taskId}-indicator-${t}`,taskRecordId:r.taskId},children:[o?{tag:"i",className:o}:null],elementData:e}}onTaskDataGenerated(e){if(this.disabled)return;const{items:t}=this,n=[];for(const r in t){const i=t[r];if(this._indicatorStatus[r]&&"function"==typeof i){const t=i(e.taskRecord);t&&this.client.timeAxis.timeSpanInAxis(t.startDate,t.endDate)&&n.push(t)}}e.extraConfigs.push(...n.map(this.createIndicatorDOMConfig,{gantt:this.client,renderData:e}))}resolveTimeSpanRecord(e){return e.lastDomConfig.elementData}}SL._$name="Indicators",Ed.registerFeature(SL,!1);class DL extends Xw{static get $name(){return"Labels"}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(e){this.onEventDataGenerated(e)}}DL._$name="Labels",Ed.registerFeature(DL,!1,"Gantt");class wL extends fi{static $name="ParentArea";static pluginConfig={chain:["onBeforeTaskSync"]};highlighted=new Map;highlightParent(e){const{highlighted:t}=this;if(e&&!e.isProjectModel&&!t.has(e)){const{client:n}=this,{rowOffsetHeight:r}=n.rowManager,i=e.visibleDescendantCount,s=n.getTaskBox(e);if(!s)return;const o={className:{"b-parent-area":1},style:{top:s.top,height:(i+1)*r-s.top%r,left:s.left,width:s.width},dataset:{taskId:`parent-area-${e.id}`}};t.set(e,o),this.highlightParent(e.parent)}}onBeforeTaskSync(e){if(!this.disabled){const{highlighted:t,client:n}=this;t.clear();for(const e of n.rowManager){const t=n.store.getById(e.id);t&&this.highlightParent(t.parent)}e.push(...t.values())}}doDisable(e){super.doDisable(e),this.client.refresh()}}wL._$name="ParentArea",Ed.registerFeature(wL,!1,"Gantt");class EL extends(zD.mixin(ZS)){static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:this.onProjectRefresh,thisObj:this})}startConfigure(){}updateLocalization(){this.renderRanges()}onProjectRefresh(){this.renderRanges()}shouldRenderRange(e){const{client:t}=this;return t.timeAxis.dateInAxis(e.startDate)}get timeRanges(){const{startDate:e,endDate:t}=this.client.project;return e&&t?[{name:this.L("L{Project Start}"),startDate:e},{name:this.L("L{Project End}"),startDate:t}]:[]}}EL._$name="ProjectLines",Ed.registerFeature(EL,!0,"Gantt");const xL="b-task-rollup",RL=`.${xL}`;class TL extends ND{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:RL}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onInternalPaint"]}}construct(e,t){this.tipId=`${e.id}-rollups-tip`,super.construct(e,t)}attachToTaskStore(e){this.detachListeners("taskStore"),null==e||e.ion({name:"taskStore",update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.attachToTaskStore(null),super.doDestroy()}doDisable(e){const t=this;t.tooltip&&(t.tooltip.disabled=e),t.attachToTaskStore(e?null:t.client.taskStore),t.client.refresh(),super.doDisable(e)}getTipHtml({activeTarget:e,event:t}){const{client:n}=this,i=n.resolveTaskRecord(e),s=document.elementsFromPoint(t.pageX+r.pageXOffset,t.pageY+r.pageYOffset).filter((e=>e.classList.contains(xL))).sort(((e,t)=>parseInt(e.dataset.index,10)-parseInt(t.dataset.index,10))).map((e=>i.children[parseInt(e.dataset.index,10)]));return this.template({task:i,children:s})}template({children:e}){const t=this,{client:n}=t,r=[];return e.map(((e,i)=>{const{startDate:s,endDate:o}=e,a=n.getFormattedDate(s),l=n.getDisplayEndDate(o,s),c=n.getFormattedDate(l);r.push(`<div class="b-gantt-task-title ${i?"b-follow-on":""}">${$.encodeHtml(e.name)}</div><table>`,`<tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${t.clockTemplate.template({date:s,text:a,cls:"b-sch-tooltip-startdate"})}</td></tr>`,`<tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.isMilestone?"":t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})}</td></tr></table>`)})),r.join("")}onStoreUpdateRecord({record:e,changes:t}){this.client.project.propagatingLoadChanges||e.parent&&(t.rollup||t.startDate||t.endDate)&&this.client.taskRendering.redraw(e.parent)}onTaskDataGenerated({taskRecord:e,left:t,wrapperChildren:n,style:r}){if(!this.disabled&&Array.isArray(e.children)){const i=e.children.slice().sort(((e,t)=>t.durationMS-e.durationMS));n.push({className:`${xL}-wrap`,dataset:{taskFeature:"rollups"},children:i.map((n=>{if(n.rollup&&n.isScheduled&&(!n.inactive||e.inactive)){const e=this.client.getSizeAndPosition(n);if(!e)return null;const{position:i,width:s}=e;return{dataset:{index:n.parentIndex,rollupTaskId:n.id},className:{[xL]:xL,[n.cls]:n.cls,"b-milestone":n.isMilestone,"b-inactive":n.inactive},style:{style:r,width:n.isMilestone?null:s,left:i-t}}}return null})),syncOptions:{syncIdField:"rollupTaskId"}})}}}TL._$name="Rollups",Ed.registerFeature(TL,!1,"Gantt");class ML extends fi{static $name="ScrollButtons";static configurable={backwardIconCls:"b-icon-previous",forwardIconCls:"b-icon-next",labelRenderer:null,scrollOptions:{animate:{duration:600,easing:"easeTo"},y:!1,edgeOffset:100}};static pluginConfig={chain:["onPaint","onElementClick"]};doDisable(e){this.client.refresh(),super.doDisable(e)}onPaint({firstPaint:e}){if(e){const{client:e}=this,{timeAxisColumn:t}=e;this.client.timeAxisSubGrid.scrollable.ion({scrollend:()=>e.refreshColumn(t)}),t.externalRenderer=this.renderer.bind(this)}}renderer({record:e,grid:t}){var n;const r=e.endDate<t.visibleDateRange.startDate,i=e.startDate>t.visibleDateRange.endDate;return{class:"b-scroll-buttons-container",children:[{class:"b-scroll-buttons-content",children:[this.labelRenderer?{tag:"label",html:null===(n=this.labelRenderer)||void 0===n?void 0:n.call(this,{taskRecord:e})}:null,e.isScheduled?{tag:"i",className:{"b-icon":1,"b-scroll-button":1,[this.backwardIconCls]:r,[this.forwardIconCls]:i,"b-task-visible":!r&&!i}}:null]}]}}onElementClick({target:e}){if(e.matches(".b-scroll-button")){const{client:t}=this,n=t.getRecordFromElement(e);t.scrollTaskIntoView(n,Object.assign(this.scrollOptions,{block:e.classList.contains(this.forwardIconCls)?"end":"start"}))}}}ML._$name="ScrollButtons",Ed.registerFeature(ML,!1,"Gantt");class kL extends uE{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("updateTaskStore","bindStore"),e}construct(e,t){super.construct(e,t),e.isGanttBase&&this.updateTaskStore(e.taskStore)}bindStore(){this.updateTimelineSummaries()}updateTaskStore(e){this.detachListeners("summaryTaskStore"),e.ion({name:"summaryTaskStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t,summaries:n}=e,{timeAxis:r}=t,i=e.summaryBarElement;i&&t.isEngineReady&&Array.from(i.children).forEach(((i,s)=>{const o=r.getAt(s);let a="",l=`<header>${e.L("L{Summary for}",t.getFormattedDate(o.startDate))}</header>`;n.forEach((e=>{const r=e.renderer({startDate:o.startDate,endDate:o.endDate,taskStore:t.taskStore,store:t.store,resourceStore:t.resourceStore,gantt:t,element:i}),s=`<div class="b-timeaxis-summary-value">${r??"&nbsp;"}</div>`;(n.length>1||""!==r)&&(a+=s),l+=`<label>${e.label||""}</label>`+s})),i.innerHTML=a,i._tipHtml=l}))}}kL._$name="Summary",Ed.registerFeature(kL,!1,"Gantt");class IL extends(AD(ev)){static $name="TaskCopyPaste";static type="taskCopyPaste";static configurable={copyRecordText:"L{copyTask}",cutRecordText:"L{cutTask}",pasteRecordText:"L{pasteTask}"};construct(e,t){super.construct(e,t),e.ion({beforeRenderTask:"onBeforeRenderTask",thisObj:this})}entityName="task";populateCellMenu({record:e,items:t}){super.populateCellMenu(...arguments),this.client.usesDisplayStore&&(t.cut&&(t.cut.disabled=!0),t.copy&&(t.copy.disabled=!0),t.paste&&(t.paste.disabled=!0))}isActionAvailable({key:e,action:t,event:n}){const r=super.isActionAvailable({key:e,action:t,event:n});if(r!==i)return r&&this.client.usesDisplayStore}setIsCut(e){super.setIsCut(...arguments),this.client.taskRendering.redraw(e)}onBeforeRenderTask({renderData:e}){e.cls["b-cut-row"]=e.row.cls["b-cut-row"]}extractParents(e,t,n=!0){const r=super.extractParents(e,t,n);return this.isCut||(this.depsToCopy=this.extractDependencies(e,t)),r}async insertCopiedRecords(e,t){const n=this;await n.startFeatureTransaction();const r=await super.insertCopiedRecords(e,t);return e.forEach((e=>e.refreshWbs({deep:!0,useOrderedTree:!0}))),n.client.dependencyStore.add(n.depsToCopy),delete n.depsToCopy,await n.finishFeatureTransaction(),r}extractDependencies(e,t){const n={};return e.reduce(((r,s)=>(s.predecessors.forEach((o=>{const a=o.id;!(a in n)&&e.includes(o.fromEvent)&&(n[a]=!0,r.push(Object.assign({},o.data,{id:i,to:i,toEvent:t[s.id].id,toTask:i,from:i,fromEvent:t[o.fromEvent.id].id,fromTask:i})))})),s.successors.forEach((o=>{const a=o.id;!(a in n)&&e.includes(o.toEvent)&&(n[a]=!0,r.push(Object.assign({},o.data,{id:i,to:i,toEvent:t[o.toEvent.id].id,toTask:i,from:i,fromEvent:t[s.id].id,fromTask:i})))})),r)),[])}}IL._$name="TaskCopyPaste",Ed.registerFeature(IL,!0,"Gantt");class AL extends(AD(Ru)){static get $name(){return"TaskDrag"}static get configurable(){return{validatorFn:(e,t,n,r)=>!0,validatorFnThisObj:null,pinSuccessors:!1,tooltipCls:"b-gantt-taskdrag-tooltip",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changePinSuccessors(e){return Zn.toSpecialKey(e)}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.store}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveTaskRecord(e)}isElementDraggable(e,t){var n;const r=this,{client:i}=r,s=r.getDraggableElement(e);if(!s||r.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const o=r.resolveEventRecord(s,i);if(!o||!o.isDraggable||o.readOnly||!o.project)return!1;return!(!1===(null===(n=i[`is${r.capitalizedEventName}ElementDraggable`])||void 0===n?void 0:n.call(i,s,o,e,t)))}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("taskDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}triggerDragStart(e){return this.client.trigger("taskDragStart",{taskRecords:e.draggedEntities,dragData:e}),this.startFeatureTransaction()}triggerDragAbort(e){this.client.trigger("taskDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.rejectFeatureTransaction(),this.client.trigger("taskDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,t){this.finishFeatureTransaction(),this.currentOverClient.trigger("afterTaskDrop",{taskRecords:e.draggedEntities,context:e,valid:t})}getProductDragContext(e){return{valid:!0}}getMinimalDragData(e){const t=this.getElementFromContext(e);return{taskRecord:this.client.resolveTaskRecord(t)}}getTaskScheduleRegion(e,t){return this.client.getScheduleRegion(e,!0,t)}getDateConstraints(e){var t,n;return null===(t=(n=this.client).getDateConstraints)||void 0===t?void 0:t.call(n,e)}setupProductDragData(e){const t=this,{client:n}=t,r=e.element,i=n.resolveTaskRecord(r),s=wn.from(r),o=t.getRelatedRecords(i)||[],a=t.getDateConstraints(i),l=[r],c=t.getTaskScheduleRegion(i,a);t.setupConstraints(c,s,n.timeAxisViewModel.snapPixelAmount,Boolean(a)),o.forEach((e=>{H.include(l,n.getElementFromTaskRecord(e,!1))}));const d=[i,...o];return{record:i,dateConstraints:a,eventBarEls:l,draggedEntities:d,taskRecords:d}}getCoordinate(e,t,n){return n[0]}checkDragValidity(e,t){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedEntities,e.startDate,e.duration,t)}isValidDrop(e){return!0}async updateRecords(e){const{startDate:t,browserEvent:n,draggedEntities:[r]}=e,i=r.startDate;this.pinSuccessors&&n[this.pinSuccessors]?await r.moveTaskPinningSuccessors(t):await r.setStartDate(t,!0),r.startDate-i?this.client.trigger("taskDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1}getRecordElement(e){return this.client.getElementFromTaskRecord(e,!0)}get tipId(){return`${this.client.id}-task-drag-tip`}}AL._$name="TaskDrag",Ed.registerFeature(AL,!0,"Gantt");class FL extends PD{static get $name(){return"TaskDragCreate"}static get configurable(){return{preventMultiple:!0}}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.store}setupDragContext(e){var t,n;const{client:r}=this;if(null!==(t=(n=e.target).closest)&&void 0!==t&&t.call(n,`.${r.timeAxisColumn.cellCls}`)){const t=r.getRecordFromElement(e.target);if(t){const n=Ag().prototype.setupDragContext.call(this,e);return n.scrollManager=r.scrollManager,n.taskRecord=n.rowRecord=t,n}}}startDrag(e){const t=this.draggingEnd=e.event.pageX>e.startEvent.pageX,{client:n}=this,{timeAxis:r}=n,{mousedownDate:s,taskRecord:o,date:a}=e;return n.beginListeningForBatchedUpdates(),o.beginBatch(),o.set("startDate",Gt.floor(t?s:a,r.resolution,i,n.weekStartDay)),o.set("endDate",Gt.ceil(t?a:s,r.resolution,i,n.weekStartDay)),!1===this.handleBeforeDragCreate(e,o,e.event)?(this.onAborted(e),!1):(e.itemElement=e.element=n.getElementFromTaskRecord(e.taskRecord),super.startDrag.call(this,e))}handleBeforeDragCreate(e,t,n){var r,i;const s=this,o=s.gantt.trigger("beforeDragCreate",{taskRecord:t,date:e.mousedownDate,event:n});return s.dateConstraints=null===(r=(i=s.gantt).getDateConstraints)||void 0===r?void 0:r.call(i,t),o}checkValidity(e,t){const n=this;return e.taskRecord=n.dragging.taskRecord,n.createValidatorFn.call(n.validatorFnThisObj||n,e,t)}isRowEmpty(e){return!e.startDate||!e.endDate}onAborted({taskRecord:e}){e.cancelBatch(),this.client.endListeningForBatchedUpdates()}}FL._$name="TaskDragCreate",Ed.registerFeature(FL,!0,"Gantt");class PL extends rF{static get type(){return"taskeditor"}static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}}PL.initClass(),PL._$name="TaskEditor";class OL extends cF{static get $name(){return"TaskEdit"}static configurable={triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,editorClass:PL};static get pluginConfig(){return{chain:["populateTaskMenu","onTaskEnterKey"],assign:["editTask"]}}editTask(e,t){return this.editEvent(e,null,t)}onActivateEditor({taskRecord:e,taskElement:t}){this.editTask(e,t)}getElementFromTaskRecord(e){return this.client.getElementFromTaskRecord(e)}onTaskEnterKey({taskRecord:e}){this.editTask(e)}populateTaskMenu({taskRecord:e,selection:t,items:n}){!this.client.readOnly&&t.length<=1&&e.project&&(n.editTask={text:"L{Gantt.Edit}",localeClass:this.client,cls:"b-separator",icon:"b-icon b-icon-edit",weight:100,disabled:this.disabled||e.readOnly,onItem:()=>this.editTask(e)})}onEventEnterKey({taskRecord:e,target:t}){this.editTask(e)}scrollTaskIntoView(e){return this.scrollEventIntoView(e)}scrollEventIntoView(e){return this.client.scrollTaskIntoView(e)}}OL._$name="TaskEdit",Ed.registerFeature(OL,!0,"Gantt");class LL extends Lw{static get $name(){return"TaskMenu"}static get defaultConfig(){return{type:"task",processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTaskMenu"),e}construct(e,t={}){super.construct(...arguments),this.gantt=e,e.features.cellMenu&&(console.warn("`CellMenu` feature is ignored, when `TaskMenu` feature is enabled. If you need cell specific menu items, please configure `TaskMenu` feature items instead."),e.features.cellMenu.disabled=!0)}getDataFromEvent(e){const{client:t}=this,n=this.getTargetElementFromEvent(e),r=t.resolveTaskRecord(n)||t.getRecordFromElement(n),i=r&&t.getElementFromTaskRecord(r,!1);return p.assign({event:e,targetElement:n,taskElement:i,taskRecord:r},t.getCellDataFromEvent(e))}callChainablePopulateMenuMethod(e){e.cellData&&this.client.populateCellMenu&&this.client.populateCellMenu(e),super.callChainablePopulateMenuMethod(...arguments)}shouldShowMenu(e){const{column:t}=e;return e.taskRecord&&(!t||!1!==t.enableCellContextMenu)}getElementFromRecord(e){return this.client.getElementFromTaskRecord(e)}populateTaskMenu({items:e,column:t,selection:n,taskRecord:r}){const{client:i}=this,{isTreeGrouped:s,usesDisplayStore:o}=i,a=n.includes(r)&&n.length>1;e.add={disabled:i.readOnly||s||o,hidden:a},e.convertToMilestone={disabled:i.readOnly||r.readOnly,hidden:r.isParent||r.milestone},e.indent={disabled:i.readOnly||!r.previousSibling||r.readOnly||s||o},e.outdent={disabled:i.readOnly||r.parent===i.taskStore.rootNode||r.readOnly||s||o},e.deleteTask={disabled:i.readOnly||r.readOnly},e.linkTasks={disabled:!a},e.unlinkTasks={disabled:e.linkTasks.disabled},null!=t&&t.cellMenuItems&&p.merge(e,t.cellMenuItems),i.showTaskColorPickers?e.taskColor={disabled:i.readOnly||r.readOnly}:e.taskColor={hidden:!0}}populateItemsWithData({items:e,taskRecord:t}){var n;super.populateItemsWithData(...arguments),this.client.showTaskColorPickers&&null!==(n=e.taskColor)&&void 0!==n&&n.menu&&p.merge(e.taskColor.menu.colorMenu,{value:t.eventColor,record:t})}changeItems(e){const{client:t}=this;return p.merge({add:{text:"L{Gantt.Add}",cls:"b-separator",icon:"b-icon-add",weight:500,menu:{addTaskAbove:{text:"L{Gantt.Task above}",weight:510,icon:"b-icon-up",onItem({taskRecord:e}){t.addTaskAbove(e)}},addTaskBelow:{text:"L{Gantt.Task below}",weight:520,icon:"b-icon-down",onItem({taskRecord:e}){t.addTaskBelow(e)}},milestone:{text:"L{Gantt.Milestone}",weight:530,icon:"b-icon-milestone",onItem({taskRecord:e}){t.addMilestoneBelow(e)}},subtask:{text:"L{Gantt.Sub-task}",weight:540,icon:"b-icon-subtask",at:"start",onItem({taskRecord:e}){t.addSubtask(e,{at:this.at})}},successor:{text:"L{Gantt.Successor}",weight:550,icon:"b-icon-successor",onItem({taskRecord:e}){t.addSuccessor(e)}},predecessor:{text:"L{Gantt.Predecessor}",weight:560,icon:"b-icon-predecessor",onItem({taskRecord:e}){t.addPredecessor(e)}}}},convertToMilestone:{icon:"b-icon-milestone",text:"L{Gantt.Convert to milestone}",weight:600,onItem({taskRecord:e}){e.convertToMilestone()}},indent:{text:"L{Gantt.Indent}",icon:"b-icon-indent",weight:700,separator:!0,onItem({selection:e,taskRecord:n}){t.indent(e.includes(n)?e:n)}},outdent:{text:"L{Gantt.Outdent}",icon:"b-icon-outdent",weight:800,onItem({selection:e,taskRecord:n}){t.outdent(e.includes(n)?e:n)}},deleteTask:{text:"L{Gantt.Delete task}",icon:"b-icon-trash",cls:"b-separator",weight:900,onItem({selection:e,taskRecord:n}){t.store.remove(e.includes(n)?e:n)}},linkTasks:{text:"L{Gantt.linkTasks}",icon:"b-icon-link",cls:"b-separator",weight:1e3,onItem({selection:e}){t.store.linkTasks(e)}},unlinkTasks:{text:"L{Gantt.unlinkTasks}",icon:"b-icon-unlink",weight:1010,onItem({selection:e}){t.store.unlinkTasks(e)}},taskColor:{text:"L{Gantt.color}",icon:"b-icon-palette",menu:{colorMenu:{type:"eventcolorpicker"}},separator:!0,weight:1100}},e)}}LL.featureClass="",LL._$name="TaskMenu",Ed.registerFeature(LL,!0,"Gantt");const $L={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"};class _L extends(fi.mixin(ZS)){static $name="TaskNonWorkingTime";static configurable={idPrefix:"TaskNonWorkingTime",maxTimeAxisUnit:"week",tooltipTemplate:null,tooltip:{},mode:"row"};static get properties(){return{rowMap:new Map,taskMap:new Map}}static pluginConfig={chain:["onTaskDataGenerated","onInternalPaint"]};static featureClass="";construct(){super.construct(...arguments);const e=this,{client:t}=e;t.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:e}),t.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisReconfigure",prio:100,thisObj:e}),t.ion({beforeToggleNode:"clear",thisObj:e})}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:"onProjectRefresh",prio:100,thisObj:this})}attachToEventStore(e){super.attachToEventStore(e),e.ion({name:"eventStore",filter:"clear",thisObj:this})}onProjectRefresh(){this.clear()}onInternalPaint({firstPaint:e}){e&&(this.mouseEventsDetacher=Zn.on({element:this.client.foregroundCanvas,delegate:".b-tasknonworkingtime",click:"handleMouseEvent",dblclick:"handleMouseEvent",contextmenu:"handleMouseEvent",thisObj:this}))}doDisable(e){super.doDisable(e),this.clear(),this.client.refresh()}updateMode(){this.isConfiguring||(this.clear(),this.client.refresh())}clear(){this.taskMap.clear(),this.rowMap.clear()}onTimeAxisReconfigure(){this.clear()}onTaskDataGenerated(e){if(e.task.effectiveVisualCalendar){if("bar"!==this.mode){const t=this.getCalendarIntervalsToRender(e,!1);e.extraConfigs.push(...t)}if("row"!==this.mode){const t=this.getCalendarIntervalsToRender(e,!0);e.children.push(...t)}}}getCalendarIntervalsToRender(e,t=!1){const n=this,{rowMap:r,taskMap:i,client:s}=n,{timeAxis:o}=s,{task:a}=e,l=[],c=!n.maxTimeAxisUnit||Gt.compareUnits(o.unit,n.maxTimeAxisUnit)<=0,d=t?i:r;if(!n.disabled&&c){const r=o.first.durationMS;if(!d.has(a.id)){const i=a.effectiveVisualCalendar,o=!t||a.isScheduled?i.getNonWorkingTimeRanges(t?a.startDate:s.startDate,t?a.endDate:s.endDate):[],l=[];for(let s=0;s<o.length;s++){const c=o[s];c.endDate-c.startDate>=r&&l.push(n.createIntervalDOMConfig({id:`r${a.id}i${s}`,iconCls:c.iconCls||i.iconCls||"",cls:`${i.cls?`${i.cls} `:""}${c.cls||""}`,startDate:c.startDate,endDate:c.endDate,name:c.name,isNonWorking:!0},e,t))}d.set(a.id,l)}l.push(...Xt.clone(d.get(a.id)))}return l}createIntervalDOMConfig(e,t,n=!1){const{client:r}=this,{taskRecord:i}=t,{cls:s,iconCls:o,name:a,startDate:l,endDate:c}=e,d=r.getCoordinateFromDate(l)-(n?t.left:0),u=r.getCoordinateFromDate(c)-d-(n?t.left:0);return{className:{"b-tasknonworkingtime":1,[s]:1},style:{left:d,top:n?null:r.store.indexOf(i)*r.rowManager.rowOffsetHeight,height:n?null:r.rowHeight,width:n&&u+d>t.width?t.width-d:u},children:[o?{tag:"i",className:o}:null,a],dataset:{taskId:e.id},elementData:{taskRecord:i,interval:e}}}changeTooltip(e,t){const n=this;return null==t||t.destroy(),n.tooltipTemplate&&e?lc.new({align:"b-t",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .b-sch-foreground-canvas > .b-tasknonworkingtime",forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hideDelay:0,anchorToTarget:!0,trackMouse:!1,getHtml:({activeTarget:e})=>{const{taskRecord:t,interval:r}=e.elementData;return n.tooltipTemplate({taskRecord:t,...r})}},e):null}handleMouseEvent(e){const t=e.target.closest(".b-tasknonworkingtime"),{taskRecord:n,interval:r}=t.elementData;this.client.trigger("taskNonWorkingTime"+$L[e.type],{feature:this,taskRecord:n,interval:r,domEvent:e})}}_L._$name="TaskNonWorkingTime",Ed.registerFeature(_L,!1,"Gantt");class jL extends(AD(wA)){static get $name(){return"TaskResize"}static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,pinSuccessors:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable"]}}onDragItemMouseMove(){this[(this.client.rtl?"right":"left")+"Handle"]=!1,super.onDragItemMouseMove(...arguments)}changePinSuccessors(e){return Zn.toSpecialKey(e)}isTaskElementDraggable(e,t,n,r){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,t){var n;const r=this.client,i=r.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:i,eventRecord:i,dateConstraints:null===(n=r.getDateConstraints)||void 0===n?void 0:n.call(r,i)})}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t,{startDate:i,endDate:s}=e,o={endDate:s};e.duration=o.duration=t.run("calculateProjectedDuration",i,s);const a=o[e.toSet]=t.run("calculateProjectedXDateWithDuration",i,!0,e.duration);return t.set(o),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),this.pinSuccessors&&e.event[this.pinSuccessors]?await t.setEndDatePinningSuccessors(a):await t.setEndDate(a,!1),t.endBatch(),t.generation!==r}triggerEventResizeStart(e,t,n){return super.triggerEventResizeStart(e,t,n),this.startFeatureTransaction()}triggerEventResizeEnd(e,t){super.triggerEventResizeEnd(e,t),t.changed?this.finishFeatureTransaction():this.rejectFeatureTransaction()}}jL._$name="TaskResize",Ed.registerFeature(jL,!0,"Gantt");class BL extends AL{static $name="TaskSegmentDrag";static get configurable(){return{capitalizedEventName:"TaskSegment"}}static get pluginConfig(){return{chain:["onInternalPaint","isTaskElementDraggable"]}}isTaskElementDraggable(e,t,n,r){return!(!this.disabled&&(t.isEventSegment||t.isSegmented))||!n.closest(this.drag.targetSelector)}triggerBeforeEventDrag(e,t){return this.client.trigger("beforeTaskSegmentDrag",t)}triggerBeforeEventDropFinalize(e,t,n){n.trigger(`before${this.capitalizedEventName}DropFinalize`,t)}triggerEventDrag(e,t){this.client.trigger("taskSegmentDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}triggerDragStart(e){this.client.trigger("taskSegmentDragStart",{taskRecords:e.draggedEntities,dragData:e})}triggerDragAbort(e){this.client.trigger("taskSegmentDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.client.trigger("taskSegmentDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterTaskSegmentDrop",{taskRecords:e.draggedEntities,context:e,valid:t})}onInternalInvalidDrop(e){super.onInternalInvalidDrop(...arguments),this.dragData.mainTaskElement.style.width=this.dragData.initialMainTaskElementWidth+"px"}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getTaskScheduleRegion(e,t){const{client:n}=this,r=n.getElementFromTaskRecord(e.event),i=wn.from(r,n.timeAxisSubGridElement),s=this.client.getScheduleRegion(e.event,!0,t);return s.translate(-i.x),s}setupProductDragData(e){const t=super.setupProductDragData(e);return t.mainTaskElement=this.client.getElementFromTaskRecord(t.record.event,!1),t.initialMainTaskElementWidth=parseFloat(t.mainTaskElement.style.width),t}updateDragContext(e,t){super.updateDragContext(...arguments);const{dirty:n,record:r,mainTaskElement:i,initialMainTaskElementWidth:s}=this.dragData;n&&!r.nextSegment&&(i.style.width=s+e.clientX-e.startClientX+"px")}get tipId(){return`${this.client.id}-task-segment-drag-tip`}async updateRecords(e){const{startDate:t,draggedEntities:[n]}=e,r=n.startDate;n.isEventSegment&&(await n.setStartDate(t,!0),n.startDate-r?this.client.trigger("taskSegmentDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1)}getDateConstraints(e){const t=super.getDateConstraints(e)||{};let{minDate:n,maxDate:r}=t;return e.previousSegment&&(!n||n<e.previousSegment.endDate)&&(n=e.previousSegment.endDate),e.nextSegment&&(!r||r<e.nextSegment.startDate)&&(r=e.nextSegment.startDate),(n||r)&&{start:n,end:r}}}BL._$name="TaskSegmentDrag",Ed.registerFeature(BL,!0,"Gantt");class VL extends xA{static $name="TaskSegmentResize";static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,leftHandle:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable","isTaskSegmentElementDraggable"]}}isTaskElementDraggable(e,t,n,r){return this.isEventElementDraggable(...arguments)}isTaskSegmentElementDraggable(e,t,n,r){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,t){var n;const r=this.client,i=r.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:i,eventRecord:i,dateConstraints:null===(n=r.getDateConstraints)||void 0===n?void 0:n.call(r,i)})}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t,{startDate:i,endDate:s}=e,o={endDate:s};e.duration=o.duration=t.run("calculateProjectedDuration",i,s);const a=o[e.toSet]=t.run("calculateProjectedXDateWithDuration",i,!0,e.duration);return t.set(o),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),this.pinSuccessors&&e.event[this.pinSuccessors]?await t.setEndDatePinningSuccessors(a):await t.setEndDate(a,!1),t.endBatch(),t.generation!==r}get tipId(){return`${this.client.id}-task-segment-resize-tip`}}VL._$name="TaskSegmentResize",Ed.registerFeature(VL,!0,"Gantt");class HL extends ND{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(e){const t=this,{taskRecord:n}=e,r=t.client.formatDuration(n.duration,t.decimalPrecision);return`\n                    ${n.name?`<div class="b-gantt-task-title">${$.encodeHtml(n.name)}</div>`:""}\n                    <table>\n                    <tr><td>${t.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                    ${n.milestone?"":`\n                        <tr><td>${t.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                        <tr><td>${t.L("L{Duration}")}:</td><td class="b-right">${r} ${Gt.getLocalizedNameOfUnit(n.durationUnit,1!==n.duration)}</td></tr>\n                        <tr><td>${t.L("L{Complete}")}:</td><td class="b-right">${n.renderedPercentDone}%</td></tr>\n                    `}\n                    </table>                 \n                `},decimalPrecision:null,cls:"b-gantt-task-tooltip",monitorRecordUpdate:!0}}}HL._$name="TaskTooltip",Ed.registerFeature(HL,!0,"Gantt");class NL extends(fv.mixin(ZS,mi)){static $name="TreeGroup";static delayable={refresh:"raf"};updateParents(e){var t;(null===(t=e.children)||void 0===t?void 0:t.length)&&eo.postWalk(e,(e=>{var t;return!(null!==(t=e.children)&&void 0!==t&&t[0].isLeaf)&&e.children}),(e=>{const{children:t}=e;let n=t[0].startDate,r=t[0].endDate,i=0;for(const e of t)e.startDate&&(n=Math.min(e.startDate,n||Number.MAX_SAFE_INTEGER)),e.endDate&&(r=Math.max(e.endDate,r)),i+=e.percentDone;e.startDate=new Date(n),e.endDate=new Date(r),e.duration=this.client.project.taskStore.rootNode.run("calculateProjectedDuration",e.startDate,e.endDate),e.percentDone=i/t.length}))}processTransformedData(e){this.updateParents(e)}onTaskStoreChange({action:e,records:t}){const{client:n}=this;n.isTreeGrouped&&t.some((e=>e.isLeaf))&&"dataset"!==e&&(n.suspendRefresh(),this.updateParents(n.store.rootNode),n.resumeRefresh(!1),this.refresh())}refresh(){this.client.refreshWithTransition()}async applyLevels(e){this.detachListeners("taskStore"),await super.applyLevels(e),this.isDestroyed||(null==e?void 0:e.length)>0&&(this.detachListeners("taskStore"),this.client.taskStore.ion({name:"taskStore",change:"onTaskStoreChange",thisObj:this}))}}NL._$name="TreeGroup",Ed.registerFeature(NL,!1,"Gantt");class zL extends bF{static $name="Versions";static configurable={knownBaseTypes:[sL,...bF.configurable.knownBaseTypes]};construct(e,t){super.construct(e,t),e.ion({taskMenuItem:({item:e,selection:t})=>{const n=this,r=t.length>1;"deleteTask"===e.ref?n.transactionDescription=r?n.L("L{Versions.deletedTasks}"):n.L("L{Versions.deletedTask}"):"indent"===e.ref?n.transactionDescription=n.L("L{Versions.indented}"):"outdent"===e.ref?n.transactionDescription=n.L("L{Versions.outdented}"):"cut"===e.ref?n.transactionDescription=n.L("L{Versions.cut}"):"paste"===e.ref&&(n.transactionDescription=n.L("L{Versions.pasted}"))}})}}zL._$name="GanttVersions",Ed.registerFeature(zL,!1,"Gantt");var WL=e=>class extends e{async prepareComponent(e){await super.prepareComponent(e);const t=this.element.querySelector(".b-sch-foreground-canvas");Br.removeEachSelector(t,".b-gantt-task-wrap"),Br.removeEachSelector(t,".b-released")}collectEvents(e,t){const n=e.length,{client:r}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{const s=i[i.length-n+t],o=r.store.getAt(e.dataIndex),a=s[3];if(o.isScheduled){const e=r.getElementFromTaskRecord(o,!1);e&&!a.has(o.id)&&a.set(o.id,[e.outerHTML,wn.from(e.firstChild,e.offsetParent)])}}))}renderEvents(e,t){const{client:n}=e,r=n.hasActiveFeature("baselines"),i=this.exportMeta.subGrids.normal.rows,s=this.exportMeta.topRowOffset=t[0].top-t[0].dataIndex*t[0].offsetHeight;t.forEach(((e,t)=>{const o=i[t][3],a=n.store.getAt(e.dataIndex),l=n.currentOrientation.getTaskRenderData(e,a),{taskId:c}=l;if(l.top+=s,l.isTask){const e=n.currentOrientation.getTaskDOMConfig(l),t=document.createElement("div"),{isMilestone:i}=a,s=a.baselines.count;To.sync({targetElement:t,domConfig:e});let{left:d,top:u,width:h,height:g}=l;i&&(d-=g/2,h=g),o.set(c,[t.outerHTML,new wn(d,u,h,g*(r&&s?.4:1)),[]])}if(l.extraConfigs.length){const e=document.createElement("div"),t=[];for(const n of l.extraConfigs)To.sync({targetElement:e,domConfig:n}),t.push(e.outerHTML);o.has(c)||o.set(c,["",null,[]]),o.get(c)[2]=t}}))}getEventBox(e){if(!e)return;let t=this.exportMeta.eventsBoxes.get(String(e.id));if(!t){const{client:n}=this.exportMeta,r=n.getCoordinateFromDate(e.startDate),i=n.getCoordinateFromDate(e.endDate),{rows:s}=this.exportMeta.subGrids.normal,[o,a,l]=s[0],[,c]=s[s.length-1],d=parseInt(o.match(/data-index="(\d+)?"/)[1]),u=n.taskStore.indexOf(e);t=new wn(r,u<d?a-2*l:c+2*l,i-r,l)}return t}};class UL extends(WL(CE)){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}}UL._$name="MultiPageExporter";class GL extends(WL(SE)){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}}GL._$name="MultiPageVerticalExporter";class YL extends(WL(EE)){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}}YL._$name="SinglePageExporter";class qL extends xE{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[YL,UL,GL]}}}qL._$name="PdfExport",Ed.registerFeature(qL,!1,"Gantt");class KL extends(vv(qL)){static $name="Print"}KL._$name="Print",Ed.registerFeature(KL,!1,"Gantt");class XL extends rM{}XL._$name="CalendarIntervalModel";class ZL extends(HP.derive(ds).mixin(NF,AC,uA,TC,wC)){static $name="ProjectModel";static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:zP,dateConstraintIntervalClass:Dk,dependencyConstraintIntervalClass:Ak,taskModelClass:sL,dependencyModelClass:KO,resourceModelClass:ZO,assignmentModelClass:TO,calendarModelClass:YO,taskStoreClass:dL,eventStoreClass:dL,dependencyStoreClass:XO,resourceStoreClass:JO,assignmentStoreClass:GO,calendarManagerStoreClass:qO,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{},resetUndoRedoQueuesAfterLoad:!1,convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/gantt/docs/api/Gantt/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},includeAsapAlapAsConstraints:!0,stmClass:oA}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...e){const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...e)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&this.detachListeners(e.$$name),super.detachStore(e)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}get defaultEventModelClass(){return sL}get defaultEventStoreClass(){return dL}set taskStore(e){this.eventStore=e}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const t=this;t.detachStore(t._timeRangeStore),t._timeRangeStore=ao.getStore(e,kC),t._timeRangeStore.storeId||(t._timeRangeStore.storeId="timeRanges"),t.attachStore(t._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){"string"==typeof e&&(e=$.safeJsonParse(e)),this.loadInlineData(e)}get tasks(){return this.taskStore.allRecords}updateTasks(e){this.taskStore.data=e}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}updateTimeRangesData(e){this.timeRangeStore.data=e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}refreshWbs(e){const t=this,n=t.unfilteredChildren??t.children;var r;null!=n&&n.length&&(null===(r=n[0].refreshWbs)||void 0===r||r.call(t,e,-1))}}ZL.applyConfigs=!0,ZL._$name="ProjectModel";class JL extends(WF(ZL)){static $name="WebSocketProjectModel"}JL._$name="WebSocketProjectModel";const QL=(new Date).getFullYear(),e$=Gt.add(Gt.startOf(new Date(QL,0,5),"week"),1-Gt.weekStartDay,"day"),t$=new og;function n$(e,t){return parseInt(""+e+t)}class r${static async generateAsync(e,t,n=null,r=e$,i=!0){const s={startDate:r,tasksData:[],dependenciesData:[]},o=Math.ceil(e/10),a=Math.ceil(t/10),l=this.generateBlocks(o,a,s.startDate);let c=0,d=0,u=0,h=0;i&&console.time("generate");for(const e of l)s.tasksData.push(...e.tasksData),s.dependenciesData.push(...e.dependenciesData),e.projectDuration&&(d=Math.max(e.projectDuration,d)),u+=e.taskCount,h+=e.dependencyCount,++c%1e3==0&&(null==n||n(u,h,!1),await N.animationFrame());return null==n||n(u,h,!0),s.endDate=Gt.add(s.startDate,Math.max(d,30),"days"),i&&console.timeEnd("generate"),s}static*generateBlocks(e,t,n){let r=1,i=1,s=0,o=0,a=0,l=0,c=n,d=0;function u(e=!0,t=!1){const n=t$.nextRandom(5)+2;return e&&(o+=n),t&&(a=0),a+=n,l=n,n}function h(e=l){return c=Gt.add(c,e,"days"),c}function g(){return Gt.add(c,l,"days")}function m(e){d=0;for(const t of e)d+=t.duration*t.percentDone;return e}for(let n=0;n<e;n++){const e=r,c={tasksData:[{id:r++,name:"Parent "+e,startDate:h(n>0?l:0),expanded:!0,inactive:!1,children:[{id:r++,name:"Sub-parent "+n$(e,1),startDate:h(0),expanded:!0,inactive:!1,children:m([{id:r++,name:"Task "+n$(e,11),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1},{id:r++,name:"Task "+n$(e,12),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1},{id:r++,name:"Task "+n$(e,13),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1},{id:r++,name:"Task "+n$(e,14),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1}]),duration:a,effort:a,effortUnit:"day",percentDone:d/a,endDate:g()},{id:r++,name:"Sub-parent "+n$(e,2),startDate:h(),expanded:!0,inactive:!1,children:m([{id:r++,name:"Task "+n$(e,21),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1},{id:r++,name:"Task "+n$(e,22),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1},{id:r++,name:"Task "+n$(e,23),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:t$.nextRandom(100),inactive:!1}]),duration:a,effort:a,effortUnit:"day",percentDone:d/a,endDate:g()}],duration:o,effort:o,effortUnit:"day",endDate:g()}],dependenciesData:[{id:i++,fromEvent:e+2,toEvent:e+3},{id:i++,fromEvent:e+3,toEvent:e+4},{id:i++,fromEvent:e+4,toEvent:e+5},{id:i++,fromEvent:e+5,toEvent:e+7},{id:i++,fromEvent:e+7,toEvent:e+8},{id:i++,fromEvent:e+8,toEvent:e+9}],taskCount:10,dependencyCount:5},p=c.tasksData[0],f=p.children[0],v=p.children[1];p.percentDone=(f.duration*f.percentDone+v.duration*v.percentDone)/p.duration,s+=o,o=0,c.projectDuration=s,n%t!=0?(c.dependenciesData.push({id:i++,fromEvent:e-2,toEvent:e+2,type:2,lag:0,lagUnit:"d"}),c.dependencyCount++):s=0,r++,yield c}}}r$._$name="ProjectGenerator";const{defineParser:i$,alt:s$,seq:o$,string:a$,regexp:l$,succeed:c$,red:d$,isSuccess:u$}=bm,h$=i$(d$(l$("[^\\[\\,]+"),(e=>({resourceName:e.trim(),units:100,match:e})))),g$=i$(d$(l$("[0-9\\s]+"),(e=>({value:e.split(/\s*/).join(""),match:e})))),m$=i$(d$(s$(a$("."),a$(",")),(e=>({value:e,match:e})))),p$=i$(s$(d$(o$((()=>g$),(()=>m$),(()=>g$)),((e,t,n)=>({value:Number(`${e.value}.${n.value}`),match:[e.match,t.match,n.match].join("")}))),d$(o$((()=>m$),(()=>g$)),((e,t)=>({value:Number(`0.${t.value}`),match:[e.match,t.match].join("")}))),d$((()=>g$),(e=>({value:Number(`${e.value}`),match:e.match}))))),f$=i$(s$(d$(o$((()=>p$),l$("\\s*\\%")),((e,t)=>({value:e.value,match:[e.match,t].join("")}))),d$((()=>p$),(e=>({value:e.value,match:e.match}))))),v$=i$(d$(o$(l$("\\s*\\[\\s*"),(()=>f$),l$("\\s*\\]")),((e,t,n)=>({units:t.value,match:[e,t.match,n].join("")})))),y$=i$(d$(l$("\\s*,\\s*"),(e=>({value:e,match:e})))),b$=i$(s$(o$((()=>h$),(()=>v$),s$(o$((()=>y$),(()=>b$)),c$(""))),o$((()=>h$),s$(o$((()=>y$),(()=>b$)),c$(""))))),C$=e=>{let t=!1,n=[],r="";b$(e,(e=>{if(u$(e)){const[,i,s]=e;i.length>n.length&&(n=i,r=s,t=!0)}}));let i=0;return!!t&&{rest:r,assignments:n.reduce(((e,t)=>{let n;return"object"==typeof t&&(Object.prototype.hasOwnProperty.call(t,"resourceName")?(n=Object.assign({position:i},t),e.push(n)):(n=e[e.length-1],Object.prototype.hasOwnProperty.call(t,"units")&&(n.units=t.units),n.match+=t.match),i+=t.match.length),e}),[])}},S$=(e,t=!1)=>{let n="";return e.assignments&&(n+=e.assignments.reduce(((e,{resourceName:n,units:r,match:i})=>e+=i&&t?i:(e.length?", ":"")+`${n} [${r}%]`),n)),e.rest&&(n+=e.rest),t||(n=n.trim()),n};var D$={parse:C$,compose:S$,normalize:e=>S$(C$(e))};const w$=Gt.clearTime(new Date(1900,5,15)),E$={minute:3,hour:5,day:7,week:9,month:11},x$={minute:1,hour:2,day:3,week:4,month:5},R$={finishnoearlierthan:6,finishnolaterthan:7,mustfinishon:3,muststarton:2,startnoearlierthan:4,startnolaterthan:5},T$={FixedDuration:1,FixedUnits:0,FixedEffort:2,Normal:0},M$={0:3,1:2,2:1,3:0};class k$ extends fi{static $name="MspExport";resourceCalendar=new Map;static configurable={filename:null,dateFormat:"YYYY-MM-DDTHH:mm:ss",timeFormat:"HH:mm:ss",msProjectVersion:2019};generateExportData(){const e=this;return e.tasks=e.collectProjectTasks(),{...e.getMsProjectConfig(),Calendars:{Calendar:e.getCalendarsData()},Tasks:{Task:e.getTasksData()},Resources:{Resource:e.getResourcesData()},Assignments:{Assignment:e.getAssignmentsData()}}}export(e={}){const t=this;if(!t.disabled&&(t.resourceCalendar.clear(),(e=Xt.assign({},t.config,e)).filename||(e.filename=`${t.client.$$name}.xml`),!1!==t.client.trigger("beforeMspExport",{config:e}))){const n=t.generateExportData(e);t.trigger("dataCollected",{config:e,data:n});const r={config:e,data:n,fileContent:t.convertToXml(n)};t.client.trigger("mspExport",r),o.download(e.filename,`data:text/xml;charset=utf-8,${encodeURIComponent(r.fileContent)}`)}}convertToXml(e){return sg.convertFromObject(e,{rootName:"Project",elementName:"",xmlns:"http://schemas.microsoft.com/project",rootElementForArray:!1})}getMsProjectConfig(){const e=this,t=e.dateFormat,{project:n}=e.client,r=e.filename||e.client.$$name;return{CalendarUID:e.getCalendarUID(n.effectiveCalendar),CreationDate:Gt.format(new Date,t),SplitsInProgressTasks:0,MoveCompletedEndsBack:0,MoveRemainingStartsBack:0,MoveRemainingStartsForward:0,MoveCompletedEndsForward:0,NewTaskStartDate:0,DaysPerMonth:n.daysPerMonth,FinishDate:Gt.format(n.endDate,t),MinutesPerDay:60*n.hoursPerDay,MinutesPerWeek:n.daysPerWeek*n.hoursPerDay*60,Name:r,ScheduleFromStart:"Forward"===n.direction?1:0,StartDate:Gt.format(n.startDate,t),Title:r,WorkFormat:x$[n.effortUnit],ProjectExternallyEdited:0}}getCalendarsData(){const e=this,{calendarManagerStore:t,project:n}=e.client,{effectiveCalendar:r}=n,i=t.allRecords||[];return t.getByInternalId(r.internalId)||i.push(r),e.client.resources.forEach((t=>{const n=new t.effectiveCalendar.constructor({name:t.name});n.parent=t.effectiveCalendar,n.isResourceCalendar=!0,e.resourceCalendar.set(t,n),i.push(n)})),i.map((t=>{const n=e.getCalendarUID(t);let r=t.name||t.internalId,i=0,s=0;return t.isResourceCalendar?i=e.getCalendarUID(t.parent,0):(r+=" - imported",s=1),{ID:n,UID:n,BaseCalendarUID:i,IsBaseCalendar:s,Name:r,WeekDays:{WeekDay:e.formatWeekDays(t)}}}))}formatWeekDays(e){const{timeFormat:t}=this,n=[],r={};let i,s=w$;for(let e=0;e<7;e++){const e=s.getDay();r[e]={DayType:e+1,DayWorking:0},i=Gt.clearTime(Gt.add(s,1,"day")),n.push({startDate:s,endDate:i}),s=i}const o=new((e=e.copy()).constructor)({intervals:n});return this.client.project.combineCalendars([e,o]).forEachAvailabilityInterval({startDate:w$,endDate:i},((n,i,s)=>{const o=s.getCalendarsWorkStatus(),a=r[n.getDay()];o.get(e)&&(a.DayWorking=1,a.WorkingTimes=a.WorkingTimes||{WorkingTime:[]},a.WorkingTimes.WorkingTime.push({FromTime:Gt.format(n,t),ToTime:Gt.format(i,t)}))})),Object.values(r)}collectProjectTasks(){const e=[];return this.client.store.rootNode.traverse((t=>e.push(t)),!0),e}getTasksData(){const e=this,{project:t}=e.client,n="Forward"==t.direction,{dateFormat:r,tasks:i}=e;return i.map((i=>{const{startDate:s,endDate:o,wbsCode:a}=i,l=i.predecessors.filter((({fromEvent:e})=>e)),c=t.convertDuration(i.duration,i.durationUnit,"millisecond"),d=t.convertDuration(i.effort,i.effortUnit,"millisecond"),u=.01*i.percentDone*c,h=Gt.format(s,r),g=Gt.format(o,r),m=k$.convertDurationToMspDuration(c,"ms"),p={UID:e.getTaskUID(i),Name:i.name,Active:e.inactive?0:1,Manual:i.manuallyScheduled?1:0,Type:i.isLeaf?T$[i.schedulingMode]:1,IsNull:s&&o?0:1,WBS:a,OutlineNumber:a,OutlineLevel:a.split(".").length,Start:h,Finish:g,Duration:m,ManualStart:h,ManualFinish:g,ManualDuration:m,DurationFormat:E$[i.durationUnit],Work:k$.convertDurationToMspDuration(d,"ms"),EffortDriven:i.effortDriven?1:0,Estimated:0,Milestone:i.isMilestone?1:0,Summary:i.isLeaf?0:1,PercentComplete:Math.round(i.percentDone),ActualStart:h,ActualDuration:k$.convertDurationToMspDuration(u,"ms"),RemainingDuration:k$.convertDurationToMspDuration(c-u,"ms"),PredecessorLink:l.map((n=>({LagFormat:E$[n.lagUnit],LinkLag:10*t.convertDuration(n.lag,n.lagUnit,"minute"),PredecessorUID:e.getTaskUID(n.fromEvent),Type:M$[n.type]}))),Baseline:i.baselines.map(((e,t)=>({Number:t,Finish:Gt.format(e.endDate,r),Start:Gt.format(e.startDate,r),Duration:k$.convertDurationToMspDuration(e.duration,e.durationUnit)}))),IgnoreResourceCalendar:i.ignoreResourceCalendar?1:0,Rollup:i.rollup?1:0,ConstraintType:i.constraintType?R$[i.constraintType]:n?0:1,CalendarUID:e.getCalendarUID(i.calendar)};return i.constraintDate&&(p.ConstraintDate=Gt.format(i.constraintDate,r)),i.deadlineDate&&(p.Deadline=Gt.format(i.deadlineDate,r)),i.note&&(p.Notes=i.note),p}))}getTaskUID(e){return e.internalId}getCalendarUID(e,t=-1){return e&&!e.isRoot?e.internalId:t}getResourcesData(){return this.client.resources.map((e=>({UID:e.internalId,Name:e.name,Type:1,MaxUnits:"1.00",PeakUnits:"1.00",CalendarUID:2013===this.msProjectVersion?null:this.getCalendarUID(this.resourceCalendar.get(e))})))}getAssignmentsData(){const e=[];if(2013===this.msProjectVersion)return e;const{project:t}=this.client;for(const n of this.tasks){const r=n.assigned,i=this.getTaskUID(n),s=Math.round(n.percentDone),o=Gt.format(n.startDate,this.dateFormat),a=Gt.format(n.endDate,this.dateFormat);if(r.size)for(const l of r){const r=t.convertDuration(l.effort,n.effortUnit,"millisecond"),c=t.convertDuration(l.actualEffort,n.effortUnit,"millisecond"),d=r-c;e.push({UpdateNeeded:0,UID:l.internalId,TaskUID:i,ResourceUID:l.resource.internalId,PercentWorkComplete:s,Work:k$.convertDurationToMspDuration(r,"ms"),ActualWork:k$.convertDurationToMspDuration(c,"ms"),RemainingWork:k$.convertDurationToMspDuration(d,"ms"),Start:o,Finish:a,Units:l.units/100})}else{const r=t.convertDuration(n.effort,n.effortUnit,"millisecond"),l=r*s*.01,c=k$.convertDurationToMspDuration(r,"ms");e.push({UID:ds._internalIdCounter++,TaskUID:i,ResourceUID:-65535,PercentWorkComplete:s,ActualWork:k$.convertDurationToMspDuration(l,"ms"),RemainingWork:k$.convertDurationToMspDuration(r-l,"ms"),Start:o,Finish:a,Units:1,Work:c})}}return e}static convertDurationToMspDuration(e,t){if(null==e)return"";const n=Gt.getDelta(Gt.as("ms",e,t),{ignoreLocale:!0,maxUnit:"hour"}),{hour:r=0,minute:i=0,second:s=0}=n;return`PT${r}H${i}M${s}S`}}k$._$name="MspExport",Ed.registerFeature(k$,!1,"Gantt");const I$=/-/g;var A$=e=>class extends(e||ye){static get $name(){return"GanttDom"}resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){const t=e.closest(this.eventSelector);return t?this.store.getById(t.dataset.taskId):this.getRecordFromElement(e)}resolveRowRecord(e){return this.resolveTaskRecord(e)}onElementKeyDown(e){const t=this.resolveTaskRecord(e.target);super.onElementKeyDown(e),t&&this.trigger("taskKeyDown",{taskRecord:t,event:e})}onElementKeyUp(e){const t=this.resolveTaskRecord(e.target);super.onElementKeyUp(e),t&&this.trigger("taskKeyUp",{taskRecord:t,event:e})}getElementFromTaskRecord(e,t=!0){return this.taskRendering.getElementFromTaskRecord(e,t)}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return`${this.id.toString().replace(I$,"_")}-${e.id}`}getEventData(e){const t=this,n=t.resolveTimeSpanRecord(e.target);if(n){const e=t.getCell({record:n,column:t.timeAxisColumn}),r=qc.get(e),i=r.id,s=r.columnId;return{cellElement:e,cellData:r,columnId:s,id:i,record:n,cellSelector:{id:i,columnId:s}}}return super.getEventData(e)}get widgetClass(){}},F$=e=>class extends(e||ye){static get $name(){return"GanttRegions"}getScheduleRegion(e,t=!0,n){const r=this,{timeAxisSubGridElement:i,timeAxis:s}=r;let o;if(e){const t=r.getElementFromTaskRecord(e),n=r.getRowById(e.id);if(!n)return null;if(o=wn.from(n.getElement("normal"),i),t){const e=wn.from(t,i);o.y=e.y,o.bottom=e.bottom}else o.y+=r.barMargin,o.bottom-=r.barMargin}else o=wn.from(i).moveTo(null,0),o.width=i.scrollWidth,o.y=o.y+r.barMargin,o.bottom=o.bottom-r.barMargin;const a=s.startDate,l=s.endDate,{start:c,end:d}=n||{};if(c&&d&&!s.timeSpanInAxis(c,d))return null;var u;c||d||(n=(null===(u=r.getDateConstraints)||void 0===u?void 0:u.call(r,e))||{start:a,end:l});let h=r.getCoordinateFromDate(n.start?Gt.max(a,n.start):a),g=r.getCoordinateFromDate(n.end?Gt.min(l,n.end):l);return t||(h=r.translateToPageCoordinate(h),g=r.translateToPageCoordinate(g)),o.x=Math.min(h,g),o.width=Math.max(h,g)-Math.min(h,g),o}translateToPageCoordinate(e){const t=this.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,t=!1,n=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}};const P$={block:"nearest",edgeOffset:20};var O$=e=>class extends(e||ye){static get $name(){return"GanttScroll"}async scrollTaskIntoView(e,t=P$){const n=this;let r=e.startDate,i=e.endDate,{startDate:s,endDate:o}=n.timeAxis;if(null==t.edgeOffset&&(t.edgeOffset=20),!e.isScheduled)return this.scrollRowIntoView(e,t);if(n.timeAxisSubGrid.collapsed)return;if(n.infiniteScroll){const e=n.timelineScroller,{clientSize:t}=e,r=t*n.bufferCoef*n.bufferThreshold,i=n.timeAxisViewModel.getDateFromPosition(r)-s;s=new Date(s.valueOf()+i),o=new Date(o.valueOf()-i)}r=r||i,i=i||r;const a=r<s|(i>o)<<1;if(a&&!1!==t.extendTimeAxis){const e=n.timeAxis.endDate-n.timeAxis.startDate;let t,s;if(3===a)await n.timeAxis.setTimeSpan(new Date(r.valueOf()-e/2),new Date(i.getTime()+e/2));else if(n.infiniteScroll){const{visibleDateRange:t}=n,s=t.endMS-t.startMS,o=1&a?1:-1;await n.setTimeSpan(new Date(r.valueOf()-e/2),new Date(r.valueOf()+e/2),{visibleDate:new Date(i.valueOf()+o*s)})}else t=n.getCoordinateFromDate(1&a?i:r),1&a?await n.timeAxis.setTimeSpan(new Date(r),new Date(r.valueOf()+e)):await n.timeAxis.setTimeSpan(new Date(i.valueOf()-e),new Date(i)),s=1&a?n.getCoordinateFromDate(i):n.getCoordinateFromDate(r),await n.timeAxisSubGrid.scrollable.scrollBy(s-t)}const l=n.getElementFromTaskRecord(e);if(l){const e=n.timeAxisSubGrid.scrollable;await e.scrollIntoView(l,t)}else await n.scrollUnrenderedTaskIntoView(e,t)}async scrollUnrenderedTaskIntoView(e,t=P$){null==t.edgeOffset&&(t.edgeOffset=20);const n=this;await n.expandTo(e);const r=n.timeAxisSubGrid.scrollable,i=n.getTaskBox(e),s=r.viewport,o=i.translate(s.x-r.x,s.y-r.y);if(await r.scrollIntoView(o,Object.assign({},t,{highlight:!1})),t.highlight){const t=n.getElementFromTaskRecord(e);t&&Br.highlight(t)}}get widgetClass(){}},L$=e=>class extends(e||ye){static get $name(){return"GanttState"}updateProject(e,t){super.updateProject(e,t),this.detachListeners("suspendStateDuringDelayedCalculation"),null!=e&&e.delayCalculation&&e.ion({name:"suspendStateDuringDelayedCalculation",delayCalculationStart:{fn:"suspendStateListener",prio:10},delayCalculationEnd:{fn:"resumeStateListener",prio:-10},thisObj:this})}suspendStateListener(){this.stateListenerSuspended=(this.stateListenerSuspended||0)+1}resumeStateListener(){const e=this;e.stateListenerSuspended=(e.stateListenerSuspended||1)-1,!e.stateListenerSuspended&&e.isSaveStatePending&&e.saveState({immediate:!0})}saveState(...e){if(!this.stateListenerSuspended)return super.saveState(...e)}applyState(e){var t,n;const r=this;if(!r.project.isInitialCommitPerformed&&(null!==(t=e.store)&&void 0!==t&&t.sorters||null!==(n=e.store)&&void 0!==n&&n.filters)){const t=e.store;r.project.commitAsync().then((()=>{r.isDestroyed||(r.suspendRefresh(),r.store.state=t,r.resumeRefresh(!0))})),delete e.store}const i=["selectedCell","selectedRecords"];if(i.some((t=>t in e))){const t={};i.forEach((n=>{n in e&&(t[n]=e[n],delete e[n])})),r._applyStateAfterPaint=()=>{r._applyStateAfterPaint=null,r.suspendRefresh(),Object.keys(t).forEach((e=>r[e]=t[e])),r.resumeRefresh(!0)}}super.applyState(e)}get widgetClass(){}onInternalPaint(...e){super.onInternalPaint(...e);const t=this;t._applyStateAfterPaint&&(t.project.isInitialCommitPerformed?t._applyStateAfterPaint():t.project.ion({commitFinalized(){t._applyStateAfterPaint()},thisObj:t,once:!0}))}},$$=e=>class extends($S(e||ye)){static get $name(){return"GanttStores"}static get projectStores(){return{calendarManagerStore:{},resourceStore:{dataName:"resources"},eventStore:{dataName:"events"},assignmentStore:{dataName:"assignments"},dependencyStore:{dataName:"dependencies"}}}static get configurable(){return{projectModelClass:ZL,tasks:null,taskStore:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("ganttStores"),this.bindCrudManager(e),null==e||e.ion({name:"ganttStores",refresh:"internalOnProjectRefresh",startApplyChangeset:"internalOnProjectStartApplyChangeset",endApplyChangeset:"internalOnProjectEndApplyChangeset",thisObj:this})}get replica(){return this.project.replica}internalOnProjectStartApplyChangeset(){this.captureScrollTargetRow()}internalOnProjectEndApplyChangeset(){this.restoreScrollTargetRow()}internalOnProjectRefresh({isInitialCommit:e,isCalculated:t}){const n=this,{project:r,visibleDate:i={}}=n;if(n.isPainted){if(!n.appliedViewStartDate&&!("startDate"in n.initialConfig)&&r.startDate&&r.endDate){const e=null==i?void 0:i.date,{startDate:t,endDate:s}=r,o=e?Gt.min(t,e):t,a=e?s?Gt.max(s,e):Gt.add(o,n.visibleDateRange.endDate-n.visibleDateRange.startDate):s;o&&a&&(n.setTimeSpan(o,a,{...i,visibleDate:e}),n.appliedViewStartDate=!0)}!e&&t?n.refreshWithTransition():n.refresh(),n.trigger("projectRefresh",{isInitialCommit:e,isCalculated:t})}}get timeRanges(){return this.project.timeRanges}set timeRanges(e){this.project.timeRanges=e}get calendars(){return this.project.calendars}set calendars(e){this.project.calendars=e}get usesDisplayStore(){return this.store!==this.taskStore}get tasks(){return this.project.eventStore.allRecords}changeTasks(e){const{project:t}=this;this.buildingProjectConfig?t.eventsData=e:t.eventStore.data=e}changeTaskStore(e){const{project:t}=this;if(!this.buildingProjectConfig)return this.initializingProject||t.eventStore!==e&&(t.setEventStore(e),e=t.eventStore),e;t.eventStore=e}updateEventStore(e){const t=this;e.metaMapId=t.id,t.taskStore=t.store=e}bindStore(e){super.bindStore(e),this.timeAxisViewModel.store=e,this.detachListeners("storeBatchedUpdateListener"),e.ion({name:"storeBatchedUpdateListener",batchedUpdate:"onEventStoreBatchedUpdate",thisObj:this})}onEventStoreBatchedUpdate(e){const t=this;if(t.listenToBatchedUpdates){const n=t.enableEventAnimations;t.enableEventAnimations=!1,t.onStoreUpdateRecord(e),t.enableEventAnimations=n}}get widgetClass(){}},_$=e=>class extends(e||ye){static get $name(){return"GanttTimelineDateMapper"}getDisplayEndDate(e,t){return e}get widgetClass(){}};const j$={animate:100};var B$=e=>class extends(e||ye){static get $name(){return"TaskNavigation"}static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{Enter:"onTaskEnterKey"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:0,ArrowRight:0}}}processEvent(e){const t=this,n=e.target.closest(t.eventSelector);return!t.navigator.disabled&&n&&(e.taskRecord=e.eventRecord=t.resolveTaskRecord(n)),e}normalizeTarget(e){return e.taskRecord}onElementMouseDown(e){const t=this,{_focusedCell:n}=t,r=e.target.closest(t.navigator.itemSelector),i=r&&r===(null==n?void 0:n.target);var s;(super.onElementMouseDown(e),i&&t.lastNavigationEvent!==e)&&(null===(s=t.onCellNavigate)||void 0===s||s.call(t,t,n,n,!0),t.lastNavigationEvent=e)}selectEvent(e,t=!1){this.isSelected(e)||this.selectRow({record:e.id,column:!1,addToSelection:t})}deselectEvent(e){this.deselectRow(e.id)}getNext(e){const t=this,{store:n}=t;for(let r=n.indexOf(e)+1;r<n.count;r++){const e=n.getAt(r);if(t.isInTimeAxis(e))return e}}getPrevious(e){const t=this,{store:n}=t;for(let r=n.indexOf(e)-1;r>=0;r--){const e=n.getAt(r);if(t.isInTimeAxis(e))return e}}set activeEvent(e){this.navigator.activeItem=this.getElementFromTaskRecord(e,!1)}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveTaskRecord(e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:n={}}){const r=this,{navigator:i}=r,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await r.scrollTaskIntoView(e,j$),i.disabled=!1):i.skipScrollIntoView=!0,r.isDestroyed||(r.activeEvent=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:n,item:r.getElementFromTaskRecord(e,!1)})))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}onDeleteKey(e){const t=e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeEvents([t])}onGridBodyFocusIn(e){if(this.timeAxisSubGridElement.contains(e.target)){const n=this,{navigationEvent:r}=n,{target:i}=e,s=i.closest(n.navigator.itemSelector),o=s?n.resolveTaskRecord(i):n.getRecordFromElement(i),a=n.normalizeCellContext({rowIndex:n.store.indexOf(o),column:n.timeAxisColumn,target:i});if(s){if(n.lastNavigationEvent!==r){var t;const{_focusedCell:e}=n;n._focusedCell=a,null===(t=n.onCellNavigate)||void 0===t||t.call(n,n,e,a,!0),n.lastNavigationEvent=r}return}n.navigateTo(o,{scrollIntoView:Boolean("mousedown"!==(null==r?void 0:r.type)),uiEvent:r})}else super.onGridBodyFocusIn(e)}get widgetClass(){}};const V$={releaseElement:1,reuseElement:1},H$={newElement:1,reuseOwnElement:1,reuseElement:1};class N$ extends ye{static get properties(){return{rowMap:new Map}}construct(e){this.gantt=e,e.rowManager.ion({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:this}),super.construct({})}init(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(e){const{gantt:t}=this,{total:n}=t.resourceMarginObject;t.foregroundCanvas&&(t.foregroundCanvas.style.fontSize=((null==e?void 0:e.height)??t.rowHeight)-n+"px")}get visibleDateRange(){return this._visibleDateRange}getTaskBox(e,t=!1,n=!1){const{gantt:r}=this,{start:i,total:s}=r.resourceMarginObject,{isBatchUpdating:o}=e,{store:a}=r,l=o?e.get("startDate"):e.startDate,c=o?e.get("endDate"):e.endDate;if(n){const t=this.getElementFromTaskRecord(e);if(t)return wn.from(t,r.timeAxisSubGridElement)}if(!l||!c||e.isTask&&(a.isDestroyed||!a.isAvailable(e)))return null;const d=this.getSizeAndPosition(e,t,n);if(!d)return null;const{position:u,width:h}=d,g=r.rowManager.calculateTop(a.indexOf(e.isBaseline?e.task:e))+i,m=r.rowHeight-s,p=new wn(u,g,h,m);return p.layout=!0,p}getSizeAndPosition(e,t,n){var r;const{gantt:i}=this,{total:s}=i.resourceMarginObject,{timeAxis:o}=i,a=o.startDate,l=o.endDate,c=e.milestone,d=c?null===(r=i.features.dependencies.pathFinder)||void 0===r?void 0:r.startArrowMargin:0;let u,h,g=e.isBatchUpdating?e.get("startDate"):e.startDate,m=e.isBatchUpdating?e.get("endDate"):e.endDate||(null!=e.duration?Gt.add(g,e.duration,e.durationUnit):null);if(!t&&(m<a||g>l))return null;if(t&&g<a)u=i.getCoordinateFromDate(a)-d;else if(t&&g>l)u=i.getCoordinateFromDate(l)+d;else if(g<a){const t=i.timeAxisViewModel.getSingleUnitInPixels("second"),n=(o.startMS-e.startDateMS)/1e3*t;u=i.getCoordinateFromDate(a)-n}else{if(i.fillTicks&&!c&&(!e.isBatchUpdating||i.snap)){g=o.getSnappedTickFromDate(g).startDate}u=i.getCoordinateFromDate(g)}if(!c)if(t&&m<a)h=i.getCoordinateFromDate(a);else if(t&&m>l)h=i.getCoordinateFromDate(l);else if(m>l){const t=i.timeAxisViewModel.getSingleUnitInPixels("second"),n=(e.endDateMS-o.endMS)/1e3*t;h=i.getCoordinateFromDate(l)+n}else{if(i.fillTicks&&(!e.isBatchUpdating||i.snap)){const e=Math.ceil(i.timeAxis.getTickFromDate(m))-1;m=i.timeAxis.getAt(e).endDate}h=i.getCoordinateFromDate(m)}let p=c?0:Math.abs(u-h);return n&&c&&g>a&&g<l&&(p=i.rowHeight-s,u-=p/2),!t&&u+p<0?null:{position:u,width:p}}getRowRegion(e,t,n){const{gantt:r}=this,i=r.getRowFor(e);if(!i)return null;const s=i.getElement(r.timeAxisSubGrid.region),o=r.timeAxis.startDate,a=r.timeAxis.endDate,l=t?Gt.max(o,t):o,c=n?Gt.min(a,n):a,d=r.getCoordinateFromDate(l),u=r.getCoordinateFromDate(c,!0,!0),h=i.top+r.scrollTop,g=Math.min(d,u),m=h+s.offsetHeight;return new wn(g,h,Math.max(d,u)-g,m-h)}getDateFromXY(e,t,n){let r=e[0];return n||(r=this.translateToScheduleCoordinate(r)),this.gantt.timeAxisViewModel.getDateFromPosition(r,t)}translateToScheduleCoordinate(e){return e-Math.floor(this.gantt.timeAxisSubGridElement.getBoundingClientRect().left)+this.gantt.scrollLeft}translateToPageCoordinate(e){const t=this.gantt,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}getElementFromTaskRecord(e,t=!0){var n;const{syncIdMap:r}=this.gantt.foregroundCanvas;let i=null==r?void 0:r[e.id];return!i&&e.hasLinks&&r&&e.forEachLinked(((e,t)=>{r[t.id]&&(i=r[t.id])})),t?null===(n=i)||void 0===n?void 0:n.syncIdMap.task:i}getConnectorStartSide(e){return this.gantt.rtl?"right":"left"}getConnectorEndSide(e){return this.gantt.rtl?"left":"right"}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),!this.gantt.refreshSuspended&&this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{gantt:n}=t,{timeAxisSubGrid:r,timeAxis:i,rtl:s}=n,{width:o}=r,{totalSize:a}=n.timeAxisViewModel,l=e,c=0!==r.scrollable.maxX&&Math.abs(r.scrollable.maxX)<=Math.round(l)+5,d=n.getDateFromCoord({coord:Math.max(0,l),ignoreRTL:!0}),u=c?i.endDate:n.getDateFromCoord({coord:l+o,ignoreRTL:!0})||i.endDate;if(d&&!n._viewPresetChanging){t._visibleDateRange={startDate:d,endDate:u,startMS:d.getTime(),endMS:u.getTime()},t.viewportCoords=s?{left:a-e-o,right:a-e}:{left:e,right:e+o};const r=n.timeView.range={startDate:d,endDate:u};n.internalOnVisibleDateRangeChange(r)}}internalPopulateTaskRenderData(e,t){const{gantt:n}=this,r={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(e){var s;let o=t.isResizable===i||t.isResizable;e.startsOutsideView&&(!0===o?o="end":"start"===o&&(o=!1)),e.endsOutsideView&&(!0===o?o="start":"end"===o&&(o=!1)),Object.assign(e,{iconCls:new Tn(t.taskIconCls),id:n.getEventRenderId(t),style:t.style||"",taskId:t.id,wrapperCls:new Tn({[n.eventCls+"-wrap"]:1,[`${n.eventCls}-parent`]:t.isParent,"b-milestone-wrap":t.milestone,"b-inactive":t.inactive,"b-expanded":t.isExpanded(n.store),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks,"b-temporary":!t.project}),cls:t.isResourceTimeRange?new Tn:t.cls.clone(),extraConfigs:[]}),Object.assign(e.cls,{[n.eventCls]:1,[n.generatedIdCls]:t.hasGeneratedId,[n.dirtyCls]:t.modifications,[n.committingCls]:t.isCommitting,[n.endsOutsideViewCls]:e.endsOutsideView,[n.startsOutsideViewCls]:e.startsOutsideView,[n.fixedEventCls]:!1===t.isDraggable,[`b-sch-event-resizable-${o}`]:1,"b-milestone":t.milestone,"b-task-started":t.isStarted,"b-task-finished":t.isCompleted,"b-task-selected":n.selectedRecords.includes(t)});const a=t.eventStyle||n.eventStyle,l=t.eventColor||n.eventColor;if(e.eventColor=l,e.eventStyle=a,n.taskRenderer){const i=n.taskRenderer.call(n.taskRendererThisObj||n,{taskRecord:t,renderData:e});"string"==typeof e.cls&&(e.cls=new Tn(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new Tn(e.iconCls)),"string"==typeof e.wrapperCls&&(e.wrapperCls=new Tn(e.wrapperCls));let s=null;$.isHtml(i)?s={tag:"span",html:i}:"string"==typeof i||"object"==typeof i?s=i:null!=i&&(s=String(i)),s&&(Array.isArray(s)?r.children.push(...s):r.children.push(s),e.cls.add("b-has-content"))}if(e.cls["b-sch-event-withicon"]=e.iconCls.length,e.wrapperCls[`b-sch-style-${e.eventStyle}`]=e.eventStyle,Br.isNamedColor(e.eventColor))e.wrapperCls[`b-sch-color-${e.eventColor}`]=e.eventColor;else if(e.eventColor){const t=`background-color:${e.eventColor};`;e.style=t+e.style,e.wrapperCls["b-sch-custom-color"]=1,e._customColorStyle=t}else e.wrapperCls["b-sch-color-none"]=1;e.style&&t.isMilestone&&r&&(r.style=e.style,delete e.style),null!==(s=e.iconCls)&&void 0!==s&&s.length&&r.children.unshift({tag:"i",className:e.iconCls}),(r.children.length||t.milestone)&&e.children.push(r)}e.taskContent=r,e.wrapperChildren=[]}populateTaskRenderData(e,t){this.internalPopulateTaskRenderData(...arguments),this.gantt.onTaskDataGenerated(e)}getTaskRenderData(e,t){const n=this,{gantt:r}=n,{start:i}=r.resourceMarginObject,s=n.getTaskBox(t,!1,!1,e),o={taskRecord:t,task:t,row:e,children:[]};return s?Object.assign(o,{isTask:!0,top:s.top,left:s.left,width:s.width,height:s.height}):o.top=e.top+i,n.populateTaskRenderData(o,t),o}getTaskDOMConfig(e){return{className:e.wrapperCls,tabIndex:"0",children:[{className:e.cls,style:(e.internalStyle||"")+(e.style||""),children:e.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{top:e.top,left:e.left-(this.gantt.rtl?e.width:0),width:e.width,zIndex:e.zIndex},dataset:{taskId:e.taskId},elementData:e,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}}}renderer({row:e,record:t}){const n=this,r=n.getTaskRenderData(e,t);let i;if(r.isTask)i=n.getTaskDOMConfig(r),n.gantt.trigger("beforeRenderTask",{renderData:r,domConfig:i});else if(0===r.extraConfigs.length)return void n.rowMap.delete(e);n.rowMap.set(e,[i,...r.extraConfigs])}onRenderDone(){const{gantt:e}=this,t=Array.from(this.rowMap.values()).flat();e.onBeforeTaskSync(t),To.sync({domConfig:{onlyChildren:!0,children:t},targetElement:e.foregroundCanvas,syncIdField:"taskId",callback({action:t,domConfig:n,lastDomConfig:r,targetElement:i}){if("none"!==t&&n&&n.className&&n.className[e.eventCls+"-wrap"]){var s,o;const a=H$[t];if(V$[t]&&null!=r&&null!==(s=r.elementData)&&void 0!==s&&s.isTask){const t={renderData:r.elementData,taskRecord:r.elementData.taskRecord,element:i};e.trigger("releaseTask",t)}if(a&&null!=n&&null!==(o=n.elementData)&&void 0!==o&&o.isTask){const r={renderData:n.elementData,taskRecord:n.elementData.taskRecord,reusingElement:"reuseElement"===t,element:i};e.trigger("renderTask",r)}}}})}redraw(e){this.gantt.rowManager.refreshCell(e,this.gantt.timeAxisColumn.id)&&this.onRenderDone()}}N$._$name="NewTaskRendering";const z$=Object.freeze({});let W$=0;class U$ extends(ry.mixin(XS,A$,F$,O$,$$,L$,_$,qS,B$,UF,KF,KS,DS)){static $name="GanttBase";static get type(){return"ganttbase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,toggleParentTasksOnClick:!0,scrollTaskIntoViewOnCellClick:null,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",fixedRowHeight:!0,timeCellCls:"b-sch-timeaxis-cell",focusCls:"b-active",taskRenderer:null,newTaskDefaults:{},dependencyIdField:"id",getDateConstraints:null,showTaskColorPickers:null}}static configurable={keyMap:{"Alt+Shift+ArrowLeft":"outdent","Alt+Shift+ArrowRight":"indent"}};static bindStoreChangeset=!1;timeCellSelector=".b-sch-timeaxis-cell";get isGantt(){return!0}construct(e={}){const t=this,n=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),r=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);if(!e.features){const n=t.getDefaultConfiguration().features;e.features=n&&"object"==typeof n?n:{}}"tree"in e.features||(e.features.tree=!0),"group"in e.features||(e.features.group=!1);const{project:i}=e;if(i&&(n||r))throw new Error("Providing both project and inline data is not supported");null!=i&&i.isModel||(e.project=Xt.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},i),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),super.construct(e),t.ion({taskclick:"onTaskBarClick",cellClick:"onNonTimeAxisCellClick",toggleNode:"onToggleParentNode"})}changeColumns(e,t){if(e){let t=e;Array.isArray(e)||(t=e.data,this._thisIsAUsedExpression(this.taskStore)),t.some((e=>{const t=e instanceof td?e.constructor:id.getColumnClass(e.type)||td;return t===mO||t.prototype instanceof mO}))||t.unshift({type:"name"})}return super.changeColumns(e,t)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.store&&(this.timeAxisViewModel.store=this.store)}get timeAxisViewModel(){return super.timeAxisViewModel}onPaintOverride(){}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&this.isPainted&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}onStoreUpdateRecord(e){if(!this.project.isChangeTrackingSuspended){let t;return this.runWithTransition((()=>{t=super.onStoreUpdateRecord(e)}),!this.refreshSuspended),t}}onStoreDataChange(e){this.runWithTransition((()=>{super.onStoreDataChange(e)}),"batch"===e.action)}onTaskDataGenerated(){}onBeforeTaskSync(){}onTaskBarClick({taskRecord:e}){this.toggleParentTasksOnClick&&!e.isLeaf&&this.toggleCollapse(e)}onNonTimeAxisCellClick({record:e,column:t}){const{scrollTaskIntoViewOnCellClick:n}=this;"timeAxis"!==t.type&&n&&e.isScheduled&&this.scrollTaskIntoView(e,!0===n?{animate:!0,block:"center",y:!1}:n)}onToggleParentNode({record:e}){e.parent.isExpanded(this.taskStore)&&this.taskRendering.redraw(e)}afterSelectionChange({selectedRecords:e,deselectedRecords:t}){const n=this;function r(e,t){const r=n.getElementFromTaskRecord(e);r&&To[t?"addCls":"removeCls"]("b-task-selected",r)}null==e||e.map((e=>r(e,!0))),null==t||t.map((e=>r(e,!1)))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&Br.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new N$(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,t){const n=this.resolveTaskRecord(e);return n?{taskRecord:n,taskElement:e,event:t}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}get visibleResources(){var e,t;return{first:this.store.getById(null===(e=this.firstVisibleRow)||void 0===e?void 0:e.id),last:this.store.getById(null===(t=this.lastVisibleRow)||void 0===t?void 0:t.id)}}populateTaskMenu(){}async addTask(t,n=z$){const r=this,{milestone:i,asPredecessor:s,asSuccessor:o}=n,a=r.project,l=t.parent,c="function"==typeof r.newTaskDefaults?r.newTaskDefaults(t):r.newTaskDefaults,d=r.taskStore.modelClass.new({startDate:t.startDate,duration:t.duration,durationUnit:t.durationUnit},c,n.data);return r.trigger("beforeTaskAdd",{taskRecord:d}),d.name||(d.name=`${r.L(i?"L{Gantt.New milestone}":"L{Gantt.New task}")} ${++W$}`),a.suspendChangeTracking(),n.asChild?t.insertChild(d,"end"===n.at?null:t.firstChild):n.above?l.insertChild(d,t):l.insertChild(d,t.nextSibling,!1,r.taskStore.useOrderedTreeForWbs?{orderedBeforeNode:t.nextOrderedSibling}:{}),a.resumeChangeTracking(!0),i?(await a.commitAsync(),await d.convertToMilestone()):await a.commitAsync(),o?r.dependencyStore.add({fromEvent:t,toEvent:d,type:e.DependencyType.EndToStart,fromSide:"right",toSide:"left"}):s&&r.dependencyStore.add({fromEvent:d,toEvent:t,type:e.DependencyType.EndToStart,fromSide:"right",toSide:"left"}),(o||s)&&await a.commitAsync(),d}addTaskAbove(e,t){return this.addTask(e,{...t,above:!0})}addTaskBelow(e,t){return this.addTask(e,t)}addMilestoneBelow(e,t){return this.addTask(e,{...t,milestone:!0})}addSubtask(e,t){const n=this.addTask(e,{...t,asChild:!0});return this.toggleCollapse(e,!1),n}addSuccessor(e,t){return this.addTask(e,{...t,asSuccessor:!0})}addPredecessor(e,t){return this.addTask(e,{...t,above:!0,asPredecessor:!0})}async indent(e){const t=this;if(t.isTreeGrouped)return;(!e||e instanceof Event)&&(e=t.selectedRecords),await this.project.commitAsync();const n=await t.taskStore.indent(e);return n||$d.show({rootElement:t.rootElement,html:t.L("L{Gantt.changeRejected}")}),n}async outdent(e){const t=this;if(t.isTreeGrouped)return;(!e||e instanceof Event)&&(e=t.selectedRecords),await this.project.commitAsync();const n=await t.taskStore.outdent(e);return n||$d.show({rootElement:t.rootElement,html:t.L("L{Gantt.changeRejected}")}),n}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}onStoreAdd(){Br.addTemporaryClass(this.element,"b-no-transitions",200,this),super.onStoreAdd(...arguments)}beforeRenderRow(e){super.beforeRenderRow(e),e.cls["b-inactive"]=e.record.inactive}}U$.initClass(),_.setVersion("gantt","5.6.2"),U$._$name="GanttBase";class G$ extends U${static get $name(){return"Gantt"}static get type(){return"gantt"}}G$.initClass(),G$._$name="Gantt",e.AbstractAssignmentStoreMixin=Xb,e.AbstractCalendarManagerStoreMixin=dS,e.AbstractCalendarMixin=lS,e.AbstractCrudManager=DC,e.AbstractCrudManagerMixin=yC,e.AbstractCrudManagerValidation=hC,e.AbstractDependencyStoreMixin=aC,e.AbstractEventStoreMixin=$b,e.AbstractHasAssignmentsMixin=kb,e.AbstractPartOfProjectGenericMixin=Iy,e.AbstractPartOfProjectModelMixin=Py,e.AbstractPartOfProjectStoreMixin=Fy,e.AbstractRecurrenceIterator=hb,e.AbstractResourceStoreMixin=Vy,e.AbstractTimeRanges=zD,e.ActionBase=nh,e.ActionColumn=Su,e.AddAction=yh,e.AddNewColumn=WP,e.AdvancedTab=tF,e.AggregateColumn=lf,e.AjaxHelper=Se,e.AjaxStore=ho,e.AjaxTransport=bC,e.AllColumns=zO,e.Animator=za,e.ArrayDataField=Ui,e.ArrayHelper=H,e.AssignmentAllocationInterval=KI,e.AssignmentField=AO,e.AssignmentGrid=kO,e.AssignmentModel=TO,e.AssignmentModelMixin=Vb,e.AssignmentPicker=IO,e.AssignmentStore=GO,e.AssignmentStoreMixin=Ub,e.AssignmentsManipulationStore=RO,e.AsyncHelper=N,e.AttachToProjectMixin=ZS,e.AvatarRendering=of,e.Badge=Il,e.Bag=As,e.Bar=ud,e.Base=ye,e.BaseAllocationInfo=ZI,e.BaseAllocationInterval=qI,e.BaseAssignmentMixin=_T,e.BaseCalendarMixin=ZT,e.BaseDependencyMixin=lM,e.BaseDependencyResolution=Tk,e.BaseEmptyCalendarEffectResolution=eM,e.BaseEventMixin=qM,e.BaseHasAssignmentsMixin=XM,e.BaseResourceMixin=zI,e.Baseline=QO,e.BaselineDurationColumn=qP,e.BaselineDurationVarianceColumn=KP,e.BaselineEndDateColumn=YP,e.BaselineEndVarianceColumn=ZP,e.BaselineStartDateColumn=GP,e.BaselineStartVarianceColumn=XP,e.Baselines=hL,e.BooleanCombo=Dm,e.BooleanDataField=Gi,e.BreakCurrentStackExecution=ix,e.BrowserHelper=o,e.Button=$l,e.ButtonGroup=wm,e.CI=gy,e.CIFromSetOrArrayOrValue=Yb,e.CSSHelper=go,e.CalculateProposed=bM,e.CalculatedValueGen=DR,e.CalculatedValueGenC=wR,e.CalculatedValueSync=CR,e.CalculatedValueSyncC=SR,e.CalculationGen=oR,e.CalculationSync=cR,e.CalendarCache=QC,e.CalendarCacheInterval=tS,e.CalendarCacheIntervalMultiple=HM,e.CalendarCacheMultiple=NM,e.CalendarCacheSingle=oS,e.CalendarColumn=QP,e.CalendarField=UE,e.CalendarHighlight=yA,e.CalendarIntervalMixin=LC,e.CalendarIntervalModel=XL,e.CalendarIntervalStore=$C,e.CalendarManagerStore=qO,e.CalendarModel=YO,e.CalendarPanel=Em,e.CalendarPicker=JP,e.CanCombineCalendarsMixin=GM,e.CellCopyPaste=Sf,e.CellEdit=mL,e.CellMenu=xf,e.CellTooltip=Rf,e.ChangeLogAction=fF,e.ChangeLogAssignmentEntity=pF,e.ChangeLogDependencyEntity=mF,e.ChangeLogEntity=gF,e.ChangeLogPropertyUpdate=CF,e.ChangeLogStore=dA,e.ChangeLogTransactionModel=cA,e.CheckColumn=df,e.Checkbox=vu,e.ChipView=Ec,e.ChronoAbstractProjectMixin=PF,e.ChronoAssignmentStoreMixin=zT,e.ChronoCalendarManagerStoreMixin=sM,e.ChronoDependencyStoreMixin=hM,e.ChronoEventStoreMixin=jI,e.ChronoEventTreeStoreMixin=BI,e.ChronoField=GR,e.ChronoGraph=$R,e.ChronoMixinBase=ky,e.ChronoModelFieldIdentifier=CT,e.ChronoModelMixin=AT,e.ChronoModelReferenceBucketFieldIdentifier=wT,e.ChronoModelReferenceFieldIdentifier=DT,e.ChronoModelReferenceFieldQuark=ST,e.ChronoPartOfProjectGenericMixin=FT,e.ChronoPartOfProjectModelMixin=LT,e.ChronoPartOfProjectStoreMixin=OT,e.ChronoResourceStoreMixin=tA,e.ChronoStoreMixin=PT,e.ChronoTransaction=PR,e.ClickRepeater=pi,e.Clipboardable=Dg,e.ClockTemplate=xu,e.CollapseTool=Za,e.Collection=Ms,e.CollectionFilter=ps,e.CollectionSorter=ys,e.ColorColumn=uf,e.ColorField=Rm,e.ColorPicker=xm,e.Column=td,e.ColumnAutoWidth=Mf,e.ColumnDragToolbar=kf,e.ColumnLines=UD,e.ColumnPicker=If,e.ColumnRename=Af,e.ColumnReorder=Ff,e.ColumnResize=Pf,e.ColumnStore=id,e.Combo=Mc,e.CommitZero=OR,e.ComputationCycle=MR,e.Config=Q,e.ConflictEffect=ok,e.ConflictEffectDescription=sk,e.ConflictResolution=ak,e.ConflictSymbol=ik,e.ConstrainedByParentMixin=hP,e.ConstrainedEarlyEventMixin=pk,e.ConstrainedLateEventMixin=vP,e.ConstraintDateColumn=eO,e.ConstraintInterval=ck,e.ConstraintIntervalDescription=lk,e.ConstraintTypeColumn=nO,e.ConstraintTypePicker=JA,e.Container=Fa,e.ContextGen=sR,e.ContextMenuBase=Gh,e.ContextSync=iR,e.CopyPasteBase=bf,e.CoreAssignmentMixin=Nb,e.CoreAssignmentStoreMixin=Jb,e.CoreCalendarManagerStoreMixin=uS,e.CoreCalendarMixin=cS,e.CoreDependencyMixin=rC,e.CoreDependencyStoreMixin=cC,e.CoreEventMixin=Mb,e.CoreEventStoreMixin=_b,e.CoreHasAssignmentsMixin=Ib,e.CoreHasDependenciesMixin=Ab,e.CorePartOfProjectGenericMixin=Ay,e.CorePartOfProjectModelMixin=Oy,e.CorePartOfProjectStoreMixin=jy,e.CoreResourceMixin=Ly,e.CoreResourceStoreMixin=Hy,e.CoreStateTrackingManager=Bh,e.CriticalPaths=pL,e.CrudManager=bS,e.CrudManagerView=XS,e.CycleDescription=wM,e.CycleEffect=MF,e.CycleEffectDescription=TF,e.CycleResolution=EM,e.CycleResolutionInput=TM,e.CycleResolutionInputChrono=kM,e.CycleResolutionPopup=qF,e.CycleSymbol=DF,e.DailyRecurrenceIterator=gb,e.DataField=Wi,e.DataGenerator=lg,e.DateColumn=hf,e.DateConstraintInterval=Dk,e.DateConstraintIntervalDescription=Sk,e.DateDataField=Yi,e.DateField=Om,e.DateHelper=Gt,e.DateInterval=ek,e.DatePicker=Fm,e.DateTimeField=Vm,e.DayTime=Jg,e.DeactivateDependencyCycleEffectResolution=BF,e.DeactivateDependencyResolution=kk,e.DeadlineDateColumn=rO,e.Delayable=mi,e.DelayableWrapper=pS,e.DelayedRecordsRendering=IE,e.DemoBot=dg,e.Dependencies=CL,e.DependencyBaseModel=nC,e.DependencyColumn=EO,e.DependencyConstraintInterval=Ak,e.DependencyConstraintIntervalDescription=Ik,e.DependencyCreation=GD,e.DependencyEdit=SA,e.DependencyField=SO,e.DependencyModel=KO,e.DependencyStore=XO,e.DependencyStoreMixin=oC,e.DependencyTab=YA,e.DependencyTooltip=sw,e.DependencyTypePicker=WA,e.Describable=xS,e.DisableManuallyScheduledConflictResolution=gP,e.DisplayField=Mm,e.DomClassList=Tn,e.DomDataStore=qc,e.DomHelper=Br,e.DomSync=To,e.DragBase=Ru,e.DragContext=kg,e.DragCreateBase=PD,e.DragHelper=Hc,e.DragProxy=Ig,e.DragTipProxy=Cm,e.Draggable=Ag,e.Droppable=Fg,e.Duration=us,e.DurationColumn=Tv,e.DurationConverterMixin=FF,e.DurationField=Hm,e.DurationVar=FM,e.DynamicObject=vl,e.EMPTY_INTERVAL=tk,e.EarlyEndDateColumn=iO,e.EarlyLateLazyness=mk,e.EarlyStartDateColumn=sO,e.EdgeTypeNormal=AR,e.EdgeTypePast=FR,e.EditBase=BD,e.Editor=zm,e.EditorTab=LA,e.Effect=sx,e.EffortColumn=oO,e.EffortField=HA,e.EffortVar=pI,e.EmptyCalendarEffect=QT,e.EmptyCalendarEffectDescription=JT,e.EmptyCalendarSymbol=XT,e.EndDateColumn=aO,e.EndDateField=VA,e.EndDateVar=AM,e.EngineReplica=xF,e.EngineRevision=wF,e.EngineTransaction=EF,e.Entity=qR,e.EntityIdentifier=WR,e.EntityMeta=_R,e.EventBuffer=DA,e.EventColorColumn=DD,e.EventColorField=Aw,e.EventColorPicker=SD,e.EventCopyPaste=mw,e.EventDayIndex=Zy,e.EventDrag=Tu,e.EventDragCreate=pw,e.EventDragSelect=fw,e.EventEdit=Pw,e.EventEditor=vw,e.EventFilter=Ow,e.EventHelper=Zn,e.EventLoader=OA,e.EventMenu=Lw,e.EventModeColumn=WO,e.EventModel=_I,e.EventModelMixin=Tb,e.EventNavigation=qS,e.EventNonWorkingTime=_w,e.EventResize=wA,e.EventSegmentDrag=EA,e.EventSegmentModel=$I,e.EventSegmentResize=xA,e.EventSegments=RA,e.EventSelection=zS,e.EventStore=VI,e.EventStoreMixin=Wy,e.EventTooltip=Vw,e.EventUpdateAction=HI,e.Events=Ge,e.ExcelExporter=ME,e.ExportDialog=bu,e.ExportOrientationCombo=pu,e.ExportRowsCombo=mu,e.Exporter=du,e.Factoryable=Ni,e.Featureable=e=>class extends(e||ye){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t={ownerName:"client",...e.featureable};t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>t})}doDestroy(){const e=this.features;super.doDestroy();for(const n in e){var t;const r=e[n];null===(t=r.destroy)||void 0===t||t.call(r)}}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const n=this,{featureable:r}=n.constructor,i=n.$features||(n.$features=new vl({configName:"features",factory:r.factory,owner:n,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}getCurrentConfig(e){const t=super.getCurrentConfig(e),{features:n}=t;if(n)for(const e in n)0===Object.keys(n[e]).length&&(n[e]=!0);return t}},e.Fencible=Yg,e.Field=pc,e.FieldContainer=dc,e.FieldFilterPicker=lp,e.FieldFilterPickerGroup=dp,e.FieldIdentifier=VR,e.FieldSet=up,e.FileDrop=Dv,e.FileField=hp,e.FileFormat=lu,e.FilePicker=gp,e.FillHandle=Of,e.Filter=Hf,e.FilterBar=zf,e.FilterField=mp,e.Finalizable=wg,e.FixedDurationMixin=AI,e.FixedEffortMixin=xP,e.FixedUnitsMixin=AP,e.Footer=gd,e.FormTab=$A,e.Formatter=mg,e.Formula=CM,e.FormulasCache=DM,e.Fullscreen=Mo,e.FunctionHelper=Me,e.Gantt=G$,e.GanttBase=U$,e.GanttDateColumn=UP,e.GanttDom=A$,e.GanttEvent=PP,e.GanttProjectMixin=HP,e.GanttRegions=F$,e.GanttScroll=O$,e.GanttState=L$,e.GanttStores=$$,e.GanttTaskEditor=rF,e.GanttTimelineDateMapper=_$,e.GeneralTab=NA,e.GetEventsMixin=Gy,e.GetTransaction=hx,e.GlobalEvents=An,e.Grid=wv,e.GridBase=ru,e.GridCellEdit=Ef,e.GridElementEvents=yd,e.GridExcelExporter=Sv,e.GridFeatureManager=Ed,e.GridFeatures=Rd,e.GridFieldFilterPicker=Lf,e.GridFieldFilterPickerGroup=$f,e.GridGroupSummary=Gf,e.GridMultiPageExporter=uu,e.GridMultiPageVerticalExporter=hu,e.GridPdfExport=Cu,e.GridPrint=yv,e.GridResponsive=Ad,e.GridRowModel=sd,e.GridRowReorder=tv,e.GridRowResize=nv,e.GridSelection=Ld,e.GridSinglePageExporter=gu,e.GridSplit=hv,e.GridState=Nd,e.GridSubGrids=qd,e.GridSummary=gv,e.GridTreeGroup=fv,e.Group=Wf,e.GroupBar=xv,e.GroupSummary=zw,e.HasCalendarMixin=UM,e.HasChildrenMixin=vk,e.HasCriticalPathsMixin=BP,e.HasDateConstraintMixin=bk,e.HasDependenciesMixin=JM,e.HasEffortMixin=mI,e.HasPercentDoneMixin=Ek,e.HasProposedNotPreviousValue=Ox,e.HasProposedNotPreviousValueEffect=Px,e.HasProposedNotPreviousValueSymbol=Fx,e.HasProposedValue=Ax,e.HasProposedValueEffect=Ix,e.HasProposedValueSymbol=kx,e.HasSchedulingModeMixin=EI,e.HasSubEventsMixin=dk,e.Header=hd,e.HeaderMenu=Yf,e.HeaderZoom=Ww,e.Histogram=nf,e.HonorProjectConstraintResolution=LP,e.HorizontalLayoutPack=FS,e.HorizontalLayoutStack=kS,e.HorizontalRendering=iD,e.HorizontalTimeAxis=mD,e.Hoverable=e=>class extends(e.mixin(mi)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:n,hoverEdgeSize:r,hoverTarget:i}=t;if(i){if(n){const{top:s,left:o,width:a,height:l,right:c,bottom:d}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=o+a/2,m=s+l/2,p=h<(r?s+r:m),f=u>=(r?c-r:g),v=p||h>=(r?d-r:m)?p?"t":"b":"",y=f||u<(r?o+r:g)?f?"r":"l":"";t.hoverZone=(n.includes(v)?v:"")+(n.includes(y)?y:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var n;t&&(e=null===(n=e)||void 0===n?void 0:n.closest(t));this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:n}=this;n&&(null==t||t.classList.remove(n),null==e||e.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const n=this,{hoverCls:r,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:o}=n;s&&(null==o||o.classList[e?"add":"remove"](s)),t&&(r&&t.classList.remove(r),i&&t.classList.remove(i),n.hoverLeave(t)),e&&(r&&e.classList.add(r),n.hoverEnter(t),n.hoverTrack&&n.hoverMove(n.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:n}=this;if(n){const{className:r}=n,i=Tn.change(r,e?Bg[e]:null,jg);r!==i&&(n.className=i,e&&t&&(n.classList.remove(t),n.getBoundingClientRect(),n.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,n=t.hoverRootElement,r={element:n,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(r.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=n&&Zn.on(r)}},e.IdHelper=vs,e.Identifiable=ki,e.Identifier=pR,e.IdentifierC=e=>pR.new(e),e.IgnoreProjectConstraintResolution=OP,e.IgnoreResourceCalendarColumn=lO,e.InactiveColumn=cO,e.Indicators=SL,e.InsertAction=wh,e.InsertChildAction=uh,e.InstancePlugin=fi,e.IntegerDataField=Xi,e.IntervalCache=sS,e.IsChronoModelSymbol=bT,e.JsonEncoder=CC,e.KeyMap=Yo,e.Label=cp,e.Labelable=cc,e.Labels=DL,e.LateEndDateColumn=dO,e.LateStartDateColumn=uO,e.Layout=Sa,e.List=wc,e.Listener=LR,e.LoadMaskable=Kd,e.LocaleHelper=qe,e.LocaleManager=Xe,e.Localizable=rt,e.Location=Kc,e.MAX_DATE=KC,e.MI=py,e.MIN_DATE=qC,e.ManuallyScheduledColumn=hO,e.ManuallyScheduledParentConstraintInterval=pP,e.ManuallyScheduledParentConstraintIntervalDescription=mP,e.Mask=Go,e.Menu=Wh,e.MenuItem=Nh,e.MergeCells=Kf,e.MessageDialog=vp,e.Meta=mR,e.MilestoneColumn=gO,e.Minifiable=e=>class extends(e||ye){static $name="Minifiable";static configurable={minifiable:!0,minified:null};compose(){const{minified:e}=this;return{class:{"b-minified":e}}}get widgetClass(){}},e.MinimalChronoModelFieldIdentifierGen=xT,e.MinimalChronoModelFieldIdentifierSync=ET,e.MinimalChronoModelFieldVariable=RT,e.MinimalEntityIdentifier=UR,e.MinimalFieldIdentifierGen=NR,e.MinimalFieldIdentifierSync=HR,e.MinimalFieldVariable=zR,e.MinimalReferenceBucketIdentifier=gT,e.MinimalReferenceBucketQuark=uT,e.MinimalReferenceIdentifier=sT,e.Model=ds,e.ModelBucketField=yT,e.ModelCombo=WE,e.ModelDataField=Zi,e.ModelField=fT,e.ModelLink=ji,e.ModelReferenceField=vT,e.ModelStm=Fi,e.Month=Qg,e.MonthlyRecurrenceIterator=pb,e.MspExport=k$,e.MultiPageExporter=UL,e.MultiPageVerticalExporter=GL,e.NOT_VISITED=qx,e.NameColumn=mO,e.Navigator=Sc,e.NestedEvents=MA,e.NewTaskRendering=N$,e.NonWorkingTime=Zw,e.NonWorkingTimeMixin=$w,e.NoteColumn=pO,e.NotesTab=nF,e.NumberColumn=af,e.NumberDataField=Ji,e.NumberField=$m,e.NumberFormat=bg,e.ObjectDataField=Qi,e.ObjectHelper=Xt,e.Objects=p,e.Orientation=au,e.Override=V,e.OwnIdentifier=fx,e.OwnIdentifierSymbol=px,e.OwnQuark=mx,e.OwnQuarkSymbol=gx,e.PackMixin=AS,e.PagingToolbar=yp,e.Pan=Jw,e.Panel=rc,e.PanelCollapser=pl,e.PanelCollapserOverlay=Dp,e.PaperFormat=su,e.ParentArea=wL,e.Parser=bm,e.PartOfBaseProject=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},e.PartOfProject=HT,e.PasswordField=wp,e.PdfExport=qL,e.PercentBar=IA,e.PercentColumn=gf,e.PercentDoneColumn=fO,e.PercentDoneMixin=mM,e.PickerField=vc,e.Pluggable=vi,e.Point=En,e.Popup=ic,e.PredecessorColumn=xO,e.PredecessorsTab=KA,e.PresetManager=Pv,e.PresetStore=Fv,e.PreviousValueOf=xx,e.PreviousValueOfEffect=Ex,e.PreviousValueOfSymbol=wx,e.Print=KL,e.PrintMixin=vv,e.ProHorizontalLayout=gA,e.ProHorizontalLayoutPack=pA,e.ProHorizontalLayoutStack=mA,e.ProgressLine=Mu,e.ProjectChangeHandlerMixin=NF,e.ProjectCombo=jE,e.ProjectConstraintConflictEffect=_P,e.ProjectConstraintConflictEffectDescription=$P,e.ProjectConstraintInterval=zP,e.ProjectConstraintIntervalDescription=NP,e.ProjectConsumer=$S,e.ProjectCrudManager=uA,e.ProjectGenerator=r$,e.ProjectLines=EL,e.ProjectModel=ZL,e.ProjectModelCommon=wC,e.ProjectModelMixin=IC,e.ProjectModelTimeZoneMixin=TC,e.ProjectProgressMixin=UF,e.ProjectWebSocketHandlerMixin=WF,e.Promissory=zo,e.ProposedArgumentsOf=Vx,e.ProposedArgumentsOfEffect=Bx,e.ProposedArgumentsOfSymbol=jx,e.ProposedOrPrevious=ax,e.ProposedOrPreviousSymbol=ox,e.ProposedOrPreviousValueOf=_x,e.ProposedOrPreviousValueOfEffect=$x,e.ProposedOrPreviousValueOfSymbol=Lx,e.ProposedValueOf=Mx,e.ProposedValueOfEffect=Tx,e.ProposedValueOfSymbol=Rx,e.Quark=eR,e.QuarkGen=vR,e.QuarkSync=fR,e.QuickFind=Zf,e.RTL=qo,e.Radio=Ep,e.RadioGroup=xp,e.RandomGenerator=og,e.RatingColumn=mf,e.ReadyStatePropagator=FA,e.Rectangle=wn,e.RectangularPathFinder=ZD,e.RecurrenceCombo=bw,e.RecurrenceConfirmationPopup=zv,e.RecurrenceDayRuleEncoder=ob,e.RecurrenceDaysButtonGroup=Dw,e.RecurrenceDaysCombo=Sw,e.RecurrenceEditor=Mw,e.RecurrenceEditorPanel=Tw,e.RecurrenceFrequencyCombo=yw,e.RecurrenceLegend=RD,e.RecurrenceLegendButton=Cw,e.RecurrenceModel=Db,e.RecurrenceMonthDaysButtonGroup=ww,e.RecurrenceMonthsButtonGroup=Ew,e.RecurrencePositionsCombo=Rw,e.RecurrenceStopConditionCombo=xw,e.RecurrenceTab=sF,e.RecurringEventEdit=kw,e.RecurringEvents=Wv,e.RecurringEventsMixin=rb,e.RecurringTimeSpan=Rb,e.RecurringTimeSpansMixin=nb,e.ReferenceBucketField=aT,e.ReferenceBucketIdentifier=hT,e.ReferenceBucketQuark=dT,e.ReferenceField=rT,e.ReferenceIdentifier=iT,e.RegionResize=Jf,e.Reject=dx,e.RejectEffect=cx,e.RejectSymbol=lx,e.RemoveAction=Th,e.RemoveAllAction=Ih,e.RemoveChildAction=ph,e.RemoveDateConstraintConflictResolution=Ck,e.RemoveDependencyCycleEffectResolution=RF,e.RemoveDependencyResolution=Mk,e.Renderable=Uo,e.Replica=BR,e.ResizeHelper=qh,e.ResizeMonitor=Fo,e.ResourceAllocationEventRangeCalendar=YI,e.ResourceAllocationEventRangeCalendarIntervalMixin=UI,e.ResourceAllocationEventRangeCalendarIntervalStore=GI,e.ResourceAllocationInfo=JI,e.ResourceAllocationInterval=XI,e.ResourceAssignmentColumn=PO,e.ResourceAssignmentGridResourceColumn=MO,e.ResourceAssignmentParser=D$,e.ResourceCalendarColumn=GE,e.ResourceCollapseColumn=wD,e.ResourceCombo=Iw,e.ResourceFilter=BE,e.ResourceHeader=pD,e.ResourceHistogram=ZF,e.ResourceInfoColumn=ED,e.ResourceMenu=Qw,e.ResourceModel=ZO,e.ResourceModelMixin=oy,e.ResourceNonWorkingTime=AA,e.ResourceStore=JO,e.ResourceStoreMixin=iy,e.ResourceTimeRangeModel=EC,e.ResourceTimeRangeStore=xC,e.ResourceTimeRanges=eE,e.ResourceTimeRangesBase=VD,e.ResourceUtilization=JF,e.ResourceUtilizationModel=rA,e.ResourceUtilizationStore=iA,e.ResourcesTab=XA,e.Responsive=e=>class extends((e||ye).mixin(mi,Yg)){static $name="Responsive";static configurable={responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null};static delayable={responsiveUpdate:"raf"};static fenced={syncResponsiveWidget:!0};static prototypeProperties={responsiveStateChanges:0,responsiveUpdateCount:0};get isResponsivePending(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}get isResponsiveUpdating(){var e;return this._responsiveUpdating||(null===(e=this.responsiveWidget)||void 0===e?void 0:e._responsiveUpdating)}updateResponsive(e){const t=this,n=t.constructor,{responsiveDefaults:r}=t,i=Array.from(new Set(Xt.keys(e).concat(Xt.keys(r)))).filter(zp);let s,o,a,l,c=null;if(e)for(o of(c={"*":qp(n,r["*"],e["*"])},i)){var d;if(a=e[o],null!==a&&!1!==a)s=s||a&&"when"in a,c[o]=qp(n,r["*"],r[o],e["*"],a),l=c[o].when,c[o].when=(null===(d=Gp[typeof l])||void 0===d?void 0:d.call(Gp,l))||l}t.$responsiveStates=c,t.$responsiveWhen=s,t.syncResponsiveWidget()}updateResponsiveState(e,t){var n;const r=this,{$responsiveStates:i}=r,s=1==++r.responsiveStateChanges,o=null===(n=r.element)||void 0===n?void 0:n.classList,a=i["*"],l=i[e]||a,c=s&&(l.once||a.once),d=s&&r.isStateful,u=r.responsiveWidget;let h=l.configs,g=null==c?void 0:c.configs;g&&(h=h?r.constructor.mergeConfigs(h,g):g),t&&(null==o||o.remove(`b-responsive-${t.toLowerCase()}`)),e&&(null==o||o.add(`b-responsive-${e.toLowerCase()}`)),d&&(g=r.loadStatefulData(),g&&(h=h?r.constructor.mergeConfigs(h,g):g),r.suspendStateful()),r._responsiveUpdating=!0;try{var m,p,f,v;null===(m=r.trigger)||void 0===m||m.call(r,"beforeResponsiveStateChange",{state:e,oldState:t,target:u}),h&&r.setConfig(h),null===(p=l.callback)||void 0===p||p.call(l,{source:r,state:e,oldState:t,target:u,initial:s}),null==c||null===(f=c.callback)||void 0===f||f.call(c,{source:r,state:e,oldState:t,target:u,initial:s}),null===(v=r.trigger)||void 0===v||v.call(r,"responsiveStateChange",{state:e,oldState:t,target:u})}finally{r._responsiveUpdating=!1,d&&r.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(e){var t;const n=this,r=e&&n.responsiveUpdate;null===(t=n.$responsiveWrapper)||void 0===t||t.destroy(),n.$responsiveWrapper=e&&((e,t)=>{let n,r=Proxy.revocable(e,{get:(t,r)=>(n&&(n[r]=!0),e[r])}),i=Me.after(e,"onConfigChange",((e,{name:r})=>{var i;null!==(i=n)&&void 0!==i&&i[r]&&t()})),s=e.ion({resize:()=>{t()}});return e.monitorResize=!0,{widget:e,get object(){var e;return null===(e=r)||void 0===e?void 0:e.proxy},destroy(){r&&(r.revoke(),i(),s(),r=i=s=null)},reset(){n=Object.create(null)}}})(e,r),null==r||r.now()}responsiveUpdate(){const e=this,{$responsiveStates:t,$responsiveWrapper:n}=e,r=null==n?void 0:n.widget;if(t&&n){let i,s,a=null,l=0,c=t;for(s in r&&r!==e&&!e.$responsiveWhen&&(r.getConfig("responsive"),c=r.$responsiveStates||c),n.reset(),t)"*"!==s&&(i=c[s].when(n.object,o),null!=i&&!1!==i&&(!a||i<l)&&(a=s,l=i));++e.responsiveUpdateCount,e.responsiveState=a}}syncResponsiveWidget(){const e=this;let t,n=null;if(!e.isDestroying&&e.responsive){var r;if(t=e.responsiveTarget,n=t){if("string"==typeof t&&(n="@"===t?e:"@"===t[0]?e[t.substring(1)]:e.up(t),!n))throw new Error(`No match for responsiveTarget="${t}"`)}else n=!e.responsiveRoot&&(null===(r=e.up)||void 0===r?void 0:r.call(e,Up))||e;if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return e.responsiveWidget=n,n}changeBreakpoints(e){return Xt.assertObject(e,"breakpoints"),null!=e&&e.width&&Object.keys(e.width).forEach((t=>{e.width[t].maxWidth=t})),null!=e&&e.height&&Object.keys(e.height).forEach((t=>{e.height[t].maxHeight=t})),e}updateBreakpoints(e){e&&(this.monitorResize=!0)}getBreakpoint(e,t){return e[Object.keys(e).map((e=>parseInt(e))).sort().find((e=>t<=e))??(e["*"]&&"*")]}activateBreakpoint(e,t){const n=this,r=n[`current${e}Breakpoint`];var i,s;t!==r&&(n[`current${e}Breakpoint`]=t,n.setConfig(t.configs),r&&n.element.classList.remove(`b-breakpoint-${r.name.toLowerCase()}`),n.element.classList.add(`b-breakpoint-${t.name.toLowerCase()}`),n.trigger(`responsive${e}Change`,{breakpoint:t,prevBreakpoint:r}),null===(i=t.callback)||void 0===i||i.call(t,{source:n,breakpoint:t,prevBreakpoint:r}),null===(s=n.recompose)||void 0===s||s.call(n))}applyResponsiveBreakpoints(e,t){const n=this,{width:r,height:i}=n.breakpoints??{};if(r){const t=n.getBreakpoint(r,e);n.activateBreakpoint("Width",t)}if(i){const e=n.getBreakpoint(i,t);n.activateBreakpoint("Height",e)}}onInternalResize(e,t,n,r,i){super.onInternalResize(e,t,n,r,i),this.applyResponsiveBreakpoints(t,n)}},e.Revision=RR,e.Ripple=Ea,e.RollupColumn=OO,e.Rollups=TL,e.Rotatable=Ya,e.Row=Zc,e.RowCopyPaste=ev,e.RowExpander=Eu,e.RowManager=ad,e.RowNumberColumn=Fd,e.RowReorder=tE,e.RowResize=nE,e.RowsRange=iu,e.SEDBackwardCycleResolutionContext=jM,e.SEDDispatcher=BM,e.SEDDispatcherIdentifier=VM,e.SEDForwardCycleResolutionContext=_M,e.SEDGraphDescription=$M,e.SEDWUDispatcher=SI,e.SEDWUDispatcherIdentifier=DI,e.Scale=sf,e.ScaleColumn=xD,e.ScheduleContext=hw,e.ScheduleMenu=rE,e.ScheduleRange=vE,e.ScheduleRangeCombo=DE,e.ScheduleTableExporter=TE,e.ScheduleTooltip=iE,e.ScheduledByDependenciesEarlyEventMixin=Rk,e.ScheduledByDependenciesLateEventMixin=bP,e.Scheduler=kE,e.SchedulerAdvancedTab=oF,e.SchedulerAssignmentModel=Wb,e.SchedulerAssignmentStore=eC,e.SchedulerBase=CD,e.SchedulerBasicEvent=QM,e.SchedulerBasicProjectMixin=$F,e.SchedulerCoreEvent=Fb,e.SchedulerCoreProjectMixin=fS,e.SchedulerDatePicker=VE,e.SchedulerDependencies=cw,e.SchedulerDependencyEdit=uw,e.SchedulerDependencyModel=sC,e.SchedulerDependencyStore=uC,e.SchedulerDom=RS,e.SchedulerDomEvents=TS,e.SchedulerEventModel=Ob,e.SchedulerEventRendering=OS,e.SchedulerEventResize=MD,e.SchedulerEventStore=Bb,e.SchedulerExportDialog=wE,e.SchedulerGeneralTab=iF,e.SchedulerLabels=Xw,e.SchedulerMultiPageExporter=CE,e.SchedulerMultiPageVerticalExporter=SE,e.SchedulerPartOfProject=sy,e.SchedulerPdfExport=xE,e.SchedulerPrint=RE,e.SchedulerPro=nP,e.SchedulerProAssignmentMixin=BT,e.SchedulerProAssignmentModel=NT,e.SchedulerProAssignmentStore=WT,e.SchedulerProBase=tP,e.SchedulerProCalendarIntervalModel=rM,e.SchedulerProCalendarManagerStore=oM,e.SchedulerProCalendarModel=iM,e.SchedulerProCellEdit=bA,e.SchedulerProCycleEffect=VF,e.SchedulerProDependencies=CA,e.SchedulerProDependencyMixin=dM,e.SchedulerProDependencyModel=uM,e.SchedulerProDependencyStore=gM,e.SchedulerProEvent=LI,e.SchedulerProEventRendering=GF,e.SchedulerProHasAssignmentsMixin=Pk,e.SchedulerProProjectMixin=jF,e.SchedulerProProjectModel=zF,e.SchedulerProResourceMixin=QI,e.SchedulerProResourceModel=eA,e.SchedulerProResourceStore=nA,e.SchedulerProTaskEdit=cF,e.SchedulerProVersions=bF,e.SchedulerProjectCrudManager=SC,e.SchedulerProjectModel=yS,e.SchedulerRegions=VS,e.SchedulerResourceModel=_y,e.SchedulerResourceRendering=PS,e.SchedulerResourceStore=zy,e.SchedulerScroll=BS,e.SchedulerSinglePageExporter=EE,e.SchedulerState=NS,e.SchedulerStores=_S,e.SchedulerSummary=hE,e.SchedulerTaskEditor=lF,e.SchedulerTimeAxisColumn=fD,e.SchedulingDirectionColumn=LO,e.SchedulingDirectionPicker=QA,e.SchedulingIssueEffectResolution=YT,e.SchedulingIssueResolution=KF,e.SchedulingIssueResolutionPopup=YF,e.SchedulingModeColumn=$O,e.SchedulingModePicker=eF,e.Schema=kF,e.ScrollButtons=ML,e.ScrollManager=Jc,e.Scroller=No,e.Search=iv,e.SequenceColumn=_O,e.ShowInTimelineColumn=jO,e.SimpleEventEdit=sE,e.SinglePageExporter=YL,e.SlideToggle=Mp,e.Slider=Tp,e.Sort=ov,e.SortedMap=iS,e.Split=lE,e.Splitter=Fp,e.StartDateColumn=BO,e.StartDateField=jA,e.StartDateVar=IM,e.State=Ri,e.StateBase=Au,e.StateProvider=wi,e.StateStorage=yi,e.StateTrackingManager=oA,e.StickyCells=av,e.StickyEvents=dE,e.Store=ao,e.StoreCRUD=Ps,e.StoreChained=Ys,e.StoreChanges=Os,e.StoreDataField=es,e.StoreFilter=Ls,e.StoreGroup=js,e.StoreProxy=Bs,e.StoreRelation=Vs,e.StoreSearch=Ws,e.StoreSort=Us,e.StoreState=qs,e.StoreStm=ro,e.StoreSum=Hs,e.StoreSync=to,e.StoreTimeZonePlugin=RC,e.StoreTree=Qs,e.StringDataField=qi,e.StringHelper=$,e.Stripe=lv,e.Styleable=e=>class extends(e||ye){static $name="Styleable";static configurable={cssVarPrefix:"",css:{}};changeCssVarPrefix(e){return Xt.assertString(e,"prefix"),e&&!e.endsWith("-")&&(e+="-"),e||""}changeCss(e){Xt.assertObject(e,"css");const t=this;if(!r.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(e,n){var r;return null===(r=getComputedStyle(t.element||document.documentElement).getPropertyValue(`--${t.cssVarPrefix}${$.hyphenate(n)}`))||void 0===r?void 0:r.trim()},set:(e,n,r)=>((t.element||document.documentElement).style.setProperty(`--${t.cssVarPrefix}${$.hyphenate(n)}`,r),!0)});return e&&(t._element?Xt.assign(n,e):t.$initialCSS=e),n}updateElement(e,...t){super.updateElement(e,...t),this.$initialCSS&&Xt.assign(this.css,this.$initialCSS)}get widgetClass(){}},e.SubGrid=Yd,e.SuccessorColumn=VO,e.SuccessorsTab=qA,e.Summary=kL,e.SynchronousCalculationStarted=aR,e.Tab=Pp,e.TabBar=Lp,e.TabPanel=Bp,e.TableExporter=bv,e.TaskCopyPaste=IL;e.TaskDrag=AL,e.TaskDragCreate=FL,e.TaskEdit=OL,e.TaskEditStm=kD,e.TaskEditTransactional=ID,e.TaskEditor=PL,e.TaskEditorBase=PA,e.TaskMenu=LL,e.TaskModel=sL,e.TaskNavigation=B$,e.TaskNonWorkingTime=_L,e.TaskResize=jL,e.TaskSegmentDrag=BL,e.TaskSegmentResize=VL,e.TaskStore=dL,e.TaskTooltip=HL,e.TemplateColumn=pf,e.TemplateHelper=Cc,e.TextAreaField=Vp,e.TextAreaPickerField=Hp,e.TextField=fc,e.TimeAxis=Lv,e.TimeAxisColumn=UO,e.TimeAxisHeaderMenu=mE,e.TimeAxisSubGrid=Qv,e.TimeAxisViewModel=$v,e.TimeColumn=ff,e.TimeField=jm,e.TimePicker=_m,e.TimeRangeModel=MC,e.TimeRangeStore=kC,e.TimeRanges=pE,e.TimeSelection=fE,e.TimeSpan=Iv,e.TimeSpanHighlight=hF,e.TimeSpanMenuBase=HD,e.TimeZoneHelper=ig,e.TimeZonedDatesMixin=kv,e.Timeline=rP,e.TimelineBase=ry,e.TimelineDateMapper=jv,e.TimelineDomEvents=Vv,e.TimelineEventRendering=Uv,e.TimelineHistogram=_E,e.TimelineHistogramBase=OE,e.TimelineHistogramGrouping=LE,e.TimelineHistogramScaleColumn=$E,e.TimelineScroll=qv,e.TimelineState=Zv,e.TimelineSummary=uE,e.TimelineViewPresets=Hv,e.TimelineZoomable=Nv,e.Toast=$d,e.TombStone=tR,e.Tool=qa,e.Toolable=Sl,e.Toolbar=Gl,e.Tooltip=lc,e.TooltipBase=ND,e.TotalSlackColumn=HO,e.Transaction=Gu,e.TransactionCycleDetectionWalkContext=kR,e.TransactionSymbol=ux,e.TransactionWalkDepth=IR,e.TransactionalFeature=AD,e.TransactionalFeatureMixin=KS,e.Tree=pv,e.TreeColumn=yf,e.TreeCombo=Rv,e.TreeGrid=Ev,e.TreeGroup=NL,e.TreeNode=Li,e.UndoRedo=NE,e.UndoRedoBase=Sm,e.UnitsVar=fI,e.UnsafePreviousValueOf=e=>Ux.new({identifier:e}),e.UnsafePreviousValueOfEffect=Ux,e.UnsafePreviousValueOfSymbol=Wx,e.UnsafeProposedOrPreviousValueOf=zx,e.UnsafeProposedOrPreviousValueOfEffect=Nx,e.UnsafeProposedOrPreviousValueOfSymbol=Hx,e.UnspecifiedTimeIntervalModel=aS,e.UpdateAction=oh,e.Use24hrsEmptyCalendarEffectResolution=tM,e.Use8hrsEmptyCalendarEffectResolution=nM,e.VISITED_TOPOLOGICALLY=Kx,e.Variable=yR,e.VariableC=bR,e.VariableWalkContext=SM,e.VersionGrid=dP,e.VersionHelper=_,e.VersionModel=aA,e.VersionStore=lA,e.Versions=zL,e.VerticalRendering=dD,e.VerticalTimeAxisColumn=yD,e.ViewPreset=Av,e.ViewPresetCombo=zE,e.WBSColumn=NO,e.WalkContext=Xx,e.WalkHelper=eo,e.WalkSource=Yx,e.WalkState=MM,e.Wbs=Xs,e.WbsField=eL,e.WebSocketManager=Cg,e.WebSocketProjectModel=JL,e.WeeklyRecurrenceIterator=mb,e.Widget=ba,e.WidgetColumn=cf,e.WidgetHelper=_d,e.Write=bx,e.WriteEffect=yx,e.WriteSeveral=Dx,e.WriteSeveralEffect=Sx,e.WriteSeveralSymbol=Cx,e.WriteSymbol=vx,e.XMLHelper=sg,e.YearPicker=Tm,e.YearlyRecurrenceIterator=fb,e.binarySearch=nS,e.bucket=lT,e.build_proposed=tT,e.calculate=QR,e.calculateEffectiveEndDateConstraintInterval=gk,e.calculateEffectiveStartDateConstraintInterval=hk,e.combineCalendars=e=>{const t=eS(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const n=t.map((e=>e.internalId+"/")).join(""),r=t.map((e=>e.version+"/")).join("");let i,s=zM.get(n);return i=s&&s.versionsHash===r?s.cache:new NM({calendarCaches:t.map((e=>e.calendarCache))}),i},e.createEntityOnPrototype=KR,e.cycleInfo=Zx,e.dateConverter=IT,e.delay=qb,e.durationFormula=LM,e.effortFormula=vI,e.endDateByEffortFormula=bI,e.endDateFormula=OM,e.ensureEntityOnPrototype=XR,e.entity=()=>e=>(IF(e),e),e.entityDecoratorBody=IF,e.field=JR,e.fixedDurationAndEffortSEDWUGraphDescription=RI,e.fixedDurationSEDWUBackwardEffortDriven=II,e.fixedDurationSEDWUBackwardNonEffortDriven=kI,e.fixedDurationSEDWUForwardEffortDriven=MI,e.fixedDurationSEDWUForwardNonEffortDriven=TI,e.fixedDurationSEDWUGraphDescription=xI,e.fixedEffortSEDWUBackward=EP,e.fixedEffortSEDWUForward=wP,e.fixedEffortSEDWUGraphDescription=DP,e.fixedUnitsSEDWUBackwardEffortDriven=IP,e.fixedUnitsSEDWUBackwardNonEffortDriven=kP,e.fixedUnitsSEDWUForwardEffortDriven=MP,e.fixedUnitsSEDWUForwardNonEffortDriven=TP,e.fixedUnitsSEDWUGraphDescription=RP,e.format=Kb,e.generic_field=ZR,e.getDecoratedModelFields=kT,e.injectStaticFieldsProperty=MT,e.intersectIntervals=nk,e.isAtomicValue=XE,e.isDateFinite=XC,e.isEqualEffectiveDirection=GC,e.isNotNumber=Gb,e.isSerializableEqual=pT,e.later=OC,e.model_field=TT,e.prototypeValue=JE,e.reference=(e,t=rT)=>ZR(e,t),e.required=pM,e.runGeneratorAsyncWithEffect=uR,e.runGeneratorSyncWithEffect=dR,e.startDateByEffortFormula=CI,e.startDateFormula=PM,e.stripDuplicates=eS,e.throwUnknownIdentifier=ER,e.unitMagnitudes=zt,e.unitsFormula=yI,e.validateRequiredProperties=fM,e.write=eT,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gantt.lwc.module.min.js.map