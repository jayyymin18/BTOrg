<aura:component controller="SingleProjResourceScheduleDashnoardCls"
    implements="lightning:isUrlAddressable,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
    access="global">

    <ltng:require styles="{!$Resource.ResourceScheduleDashboiardIcons}" />

    <ltng:require styles="{!join(',',

                          $Resource.FaFaFont + '/css2.css',
                          $Resource.ResourceScheduleTabContent + '/ResourceScheduleTab/Fontawesome/css/all.min.css',
                          $Resource.ResourceScheduleTabContent + '/ResourceScheduleTab/custom.css',
                          $Resource.ResourceScheduleTabContent + '/ResourceScheduleTab/monthly.css',
                          $Resource.ResourceScheduleTabContent + '/ResourceScheduleTab/sidebars.css',
                          $Resource.Jquery + '/jquery/css/ui-smoothness/jquer-datePicker.css')}" />

    <!-- by sai -->
    <ltng:require scripts="{!join(',',
                           $Resource.Jquery + '/jquery/lightning/js/jquery-3.7.1.min.js',
                           $Resource.Jquery + '/jquery/lightning/js/jquery-ui-1.12.1.min.js')}"
        afterScriptsLoaded="{!c.handleAfterLoadscript}" />
    <!--  Changes for BUIL-3936 -->
    <aura:attribute name="isDatePickerLoaded" type="Boolean" default="false" />
    <aura:attribute name="isDisplayDatePicker" type="Boolean" default="false" />
    <aura:attribute name="isBackShadow" type="Boolean" default="false" />
    <aura:attribute name="SelectedDate" type="String" />
    <aura:attribute name="viewType" type="String" default="monthView" />

    <!--  Changes for BUIL-3932 -->
    <aura:attribute name="areInternalResource" type="Boolean" default="false" />
    <aura:attribute name="areExternalResource" type="Boolean" default="false" />



    <lightning:workspaceAPI aura:id="workspace" />

    <aura:attribute name="recordId" type="String" access="public" />
    <aura:attribute name="selectedProjColor" type="String" default="" />
    <aura:attribute name="projectColorMap" type="Map" />
    <aura:attribute name="projSelectResourceColorMap" type="Map" />
    <aura:attribute name="calendarEvents" type="object" default="{}" />
    <aura:attribute name="dateval" type="list" />
    <aura:attribute name="datevalString" type="String" />
    <aura:attribute name="currentDateValString" type="String" />
    <aura:attribute name="todayDate" type="String" />
    <aura:attribute name="todayDateHeader" type="String" />
    <aura:attribute name="dateValForDateView" type="String" />
    <aura:attribute name="NextMonth" type="list" />
    <aura:attribute name="BaseURLs" type="String" />
    <aura:attribute name="monthnames" type="List"
        default='["Jan", "Feb", "Mar", "Apr", "May", "June", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]' />
    <aura:attribute name="dayNames" type="List"
        default='["SUNDAY", "MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY"]' />
    <aura:attribute name="projectColors" type="List"
        default='[ "#BFCE80","#43A6EE","#9CC4E8","#3BBF65", "#FFBC00", "#62D0CB", "#6997FD", "#FD6D00", "#C3DD2E","#8058D6","#E98FC3"]' />

    <aura:attribute name="resourceColors" type="List"
        default='["#E98FC3", "#8058D6", "#C3DD2E", "#FD6D00", "#6997FD", "#62D0CB", "#FFBC00","#3BBF65","#9CC4E8","#43A6EE","#BFCE80"]' />

    <aura:attribute name="isFirst" type="Boolean" />

    <!--** object type for project **-->
    <aura:attribute name="project" type="object" default="{}"/>
    <aura:attribute name="isDisable" type="Boolean" />


    <aura:attribute name="newSelectedProjectId" type="String" default="" />
    <aura:attribute name="newSelectedProjectIdClone" type="String" default="" />
    <aura:attribute name="newContractResource" type="String" default="" />
    <aura:attribute name="selectedContractResourceIndex" type="Integer" default="-1" />
    <aura:attribute name="contractResourceListIds" type="List" default="[]" />
    <aura:attribute name="currentCalendarView" type="String" default="monthView" />
    <aura:attribute name="calendarViewTypeList" type="List" default="['dayView,'weekView','monthView']" />
    <aura:attribute name="weekIndex" type="Integer" default="0" />
    <aura:attribute name="resourcesList" type="List" />
    <aura:attribute name="dateEventList" type="List" />
    <aura:attribute name="conflictEventList" type="List" />
    <aura:attribute name="standardEventList" type="List" />
    <aura:attribute name="startDt" type="Date" />
    <aura:attribute name="endDt" type="Date" />
    <!-- search -->

    <aura:attribute name="searchResourceFilter" type="String" default="" />
    <aura:attribute name="allFilter" type="String" default="" />

    <aura:handler name="change" value="{!v.searchResourceFilter}" action="{!c.doTaskResourceSearch}" />
    <aura:handler name="change" value="{!v.allFilter}" action="{!c.doTaskAllFilterSearch}" />

    <!--search end -->

    <lightning:workspaceAPI aura:id="workspaceresource" />
    <aura:attribute name="rerendermonthly" type="Boolean" default="true" />
    <aura:attribute type="String" name="isConflictview" default="Standard" />
    <aura:attribute type="String" name="calendarView" default="Dayview" />
    <aura:attribute name="showSpinner" type="boolean" default="false" />
    <aura:attribute type="String" name="displayView" default="project" />
    <!-- <aura:handler name="init" value="{!this}" action="{!c.doInit}" /> -->
    <aura:attribute name="type" type="String" default="info" />
    <aura:attribute name="color" type="String" default="white" />
    <aura:attribute name="index" type="String" default="" />
    <aura:attribute name="contactList" type="contact[]" />

    <aura:attribute type="String" name="headerDate" />
    <aura:attribute type="String" name="ColorName1" />
    <aura:attribute type="String" name="ColorName2" />
    <aura:attribute name="weekDates" type="list" />
    <aura:attribute name="beforeweekDate" type="list" />
    <aura:attribute name="weekfirstDate" type="list" />
    <aura:attribute name="weeklastDate" type="list" />
    <aura:attribute name="currentDate" type="list" />
    <aura:attribute name="nextDate" type="list" />
    <aura:attribute name="previousDate" type="list" />
    <aura:attribute type="String" name="weekName" default="Monday" />
    <aura:attribute name="eventList" type="list" />
    <aura:attribute name="projectList" type="list" />
    <aura:attribute type="boolean" name="NoSchedules" />

    <aura:attribute name="currentYear" type="list" />
    <aura:attribute name="fristMonth" type="list" />
    <aura:attribute name="secondMonth" type="list" />


    <aura:attribute name="ResourceCollapseText" type="String" default="[+]" />
    <aura:attribute name="projectCollapseText" type="String" default="[+]" />
    <aura:attribute name="projectTaskCollapseText" type="String" default="[+]" />
    <aura:attribute name="projecttaskcontactlist" type="list" />
    <aura:attribute name="SelectedOptions" type="list" default="[]" />
    <aura:attribute name="childslectedOptions" type="list" default="[]" />
    <aura:attribute name="ResslectedOptions" type="list" default="[]" />
    <aura:attribute name="selectedLocations" type="list" />
    <aura:attribute name="selectedContact" type="sObject" default="{}" />
    <aura:attribute name="selectedproject" type="sObject" default="{}" />
    <aura:attribute name="selectedTradetype" type="sObject" default="{}" />

    <aura:attribute name="showModal" type="Boolean" default="fasle" />
    <aura:attribute name="showModal1" type="Boolean" default="fasle" />
    <aura:attribute name="contactScheduleItemList" type="List" default="" />

    <aura:attribute name="tradeTypeScheduleItemList" type="List" default="" />

    <aura:handler name="oSelectedRecordEvent" event="c:selectedsObjectRecordEvent" action="{!c.handleComponentEvent}" />

    <aura:handler event="c:ClearLookupvalueEvent" action="{!c.ClearhandleComponentEvent}" />


    <aura:handler name="render" value="{!this}" action="{!c.onRender}" />

    <aura:method name="drawTablebyweek" action="{!c.drawTablebyweek}" description="">
        <aura:attribute name="index" type="String" default="" />
    </aura:method>

    <aura:method name="reloadPrevCalendar" action="{!c.previousMonth}" description="">
        <aura:attribute name="index" type="String" default="" />
    </aura:method>

    <aura:method name="reloadNextCalendar" action="{!c.nextMonth}" description="">
        <aura:attribute name="index" type="String" default="" />
    </aura:method>

    <aura:method name="reloadCurrentDateCalendar" action="{!c.currentDateMonth}" description="">
    </aura:method>

    <aura:method name="reloadPrevWeekCalendar" action="{!c.previousWeekClone}" description=""> <!--  previousWeek-->
    </aura:method>

    <aura:method name="reloadNextWeekCalendar" action="{!c.nextWeekClone}" description=""> <!--  nextWeek-->
    </aura:method>

    <aura:method name="reloadCurrentWeekCalendar" action="{!c.currentWeekClone}" description=""> <!--   currentWeek-->
    </aura:method>

    <aura:method name="resetEventListeners" action="{!c.resetPreNextTodayListeners}" description="">
    </aura:method>

    <aura:method name="conflictData" action="{!c.setConflictData}" description="">
    </aura:method>

    <aura:method name="setDayView" action="{!c.calendarDayView}" description="">
    </aura:method>

    <aura:method name="setWeekView" action="{!c.calendarWeekView}" description="">
    </aura:method>

    <aura:method name="monthlyFunMethod" action="{!c.getmonthlyfunc}">
        <aura:attribute name="monthlyFunc" type="Function" />
    </aura:method>

    <body style="font-family: 'Poppins', sans-serif;">
        <div class="projectResourceContainer wrapper" style="background-color:white;font-size:0.95rem;"
            aura:id="projectResourceContainer">
            <div class="main">
                <div class="d-flex flex-column flex-shrink-0 p-3 pt-2 left-nav-main"
                    style="padding-top:0.09rem !important;">
                    <a href="#" class="d-flex align-items-center mb-3 me-md-auto link-dark text-decoration-none">
                        <span class="fs-6 fw-semibold">Project</span>
                    </a>
                    <div class="scrollarea">
                        <ul class="nav nav-pills flex-column mb-auto left-nav">
                            <aura:if isTrue="{!v.project.Id}">
                                    <li id="{!v.project.Id}">
                                        <a href="javascript:void(0);" class="nav-link active" aria-current="true" onclick="{!c.handleSelectedProject}" data-projid="{!v.project.Id}" style="justify-content: space-between;">
                                            <div style="display: flex; align-items: center;justify-content: space-between;">
                                                <div class="Proj_profile_name " style="margin-right:1rem !important"> <!-- prof_bg1 -->
                                                    <i class="marColor far fa-building"></i>
                                                </div>
                                                <div class="lh-sm">
                                                    <label>{!v.project.Name}</label>
                                                    <span class="menu-sub-text">Account: {!v.project.AccountName}</span>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right ms-2"></i>
                                        </a>
                                    </li>
                                <aura:set attribute="else">
                                    No Projects Found
                                </aura:set>
                            </aura:if>
                        </ul>
                    </div>
                </div>

                <div class="d-flex flex-column flex-shrink-0 align-items-stretch bg-white left-nav2">
                    <div class="input-group px-3 py-2">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control brd-l-0"
                            aria-label="Dollar amount (with dot and two decimal places)" placeholder="Search Name"
                            onchange="{!c.FilterResourceTasks}" disabled="{!v.isDisable}"/>
                    </div>
                    <div class="list-group list-group-flush scrollarea p-2 pt-0">
                        <aura:if isTrue="{!v.resourcesList.length}">
                            <!-- External Reosurces View -->
                            <div class="resourceHeader" style="margin-block: 0rem 0.25rem;"> {!v.isDisable} External Resources</div>
                            <aura:if isTrue="{!v.areExternalResource}">
                                <aura:iteration items="{!v.resourcesList}" var="resourceListItem" indexVar="idx">
                                    <aura:if isTrue="{!resourceListItem.resourceType == 'external'}">
                                        <aura:if isTrue="{!resourceListItem.ContractresourceId == v.newContractResource}">
                                            <a href="javascript:void(0);" class="list-group-item list-group-item-action py-2 lh-tight activeResource" aria-current="true" onclick="{!c.selectedResource}" data-contractresourceid="{!resourceListItem.ContractresourceId}" data-resourceindex="{!idx}">
                                                <div class="d-flex w-100 align-items-center">
                                                    <div class="profile_name me-3">
                                                        <span
                                                            style="width: 5rem;text-align: center;">{!resourceListItem.FirstLetterofContractresourceName}</span>
                                                    </div>
                                                    <div>
                                                        <strong
                                                            class="mb-1">{!resourceListItem.ContractresourceName}</strong>
                                                        <br />
                                                        <small>{!resourceListItem.Companyname} -
                                                            {!resourceListItem.TradeType}</small>
                                                    </div>
                                                </div>
                                            </a>
                                            <aura:set attribute="else">
                                                <a href="javascript:void(0);" class="list-group-item list-group-item-action py-2 lh-tight" aria-current="true" onclick="{!c.selectedResource}" data-contractresourceid="{!resourceListItem.ContractresourceId}" data-resourceindex="{!idx}">
                                                    <div class="d-flex w-100 align-items-center">
                                                        <div class="profile_name me-3"> <!-- prof_bg1 -->
                                                            <span style="width:5rem;text-align: center;">{!resourceListItem.FirstLetterofContractresourceName}</span>
                                                        </div>
                                                        <div>
                                                            <strong class="mb-1">{!resourceListItem.ContractresourceName}</strong>
                                                            <br />
                                                            <small>{!resourceListItem.Companyname} - {!resourceListItem.TradeType}</small>
                                                        </div>
                                                    </div>
                                                </a>
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                </aura:iteration>
                                <aura:set attribute="else">
                                    <div class="nodata"> No External Resources Found</div>
                                </aura:set>
                            </aura:if>
                            <!-- Internal Reosurces View -->
                            <div class="resourceHeader" style="margin-block: 0.5rem 0.25rem;"> Internal Resources</div>
                            <aura:if isTrue="{!v.areInternalResource}">
                                <aura:iteration items="{!v.resourcesList}" var="resourceListItem" indexVar="idx">
                                    <aura:if isTrue="{!resourceListItem.resourceType == 'internal'}">
                                        <aura:if
                                            isTrue="{!resourceListItem.ContractresourceId == v.newContractResource}">
                                            <a href="javascript:void(0);"
                                                class="list-group-item list-group-item-action py-2 lh-tight activeResource"
                                                aria-current="true" onclick="{!c.selectedResource}"
                                                data-contractresourceid="{!resourceListItem.ContractresourceId}"
                                                data-resourceindex="{!idx}">
                                                <div class="d-flex w-100 align-items-center">
                                                    <div class="profile_name me-3">
                                                        <span style="width: 5rem;text-align: center;">{!resourceListItem.FirstLetterofContractresourceName}</span>
                                                    </div>
                                                    <div>
                                                        <strong class="mb-1">{!resourceListItem.ContractresourceName}</strong>
                                                        <br />
                                                        <small>{!resourceListItem.Companyname} - {!resourceListItem.TradeType}</small>
                                                    </div>
                                                </div>
                                            </a>
                                            <aura:set attribute="else">
                                                <a href="javascript:void(0);" class="list-group-item list-group-item-action py-2 lh-tight" aria-current="true" onclick="{!c.selectedResource}" data-contractresourceid="{!resourceListItem.ContractresourceId}" data-resourceindex="{!idx}">
                                                    <div class="d-flex w-100 align-items-center">
                                                        <div class="profile_name me-3"> <!-- prof_bg1 -->
                                                            <span style="width:5rem;text-align: center;">{!resourceListItem.FirstLetterofContractresourceName}</span>
                                                        </div>
                                                        <div>
                                                            <strong class="mb-1">{!resourceListItem.ContractresourceName}</strong>
                                                            <br />
                                                            <small>{!resourceListItem.Companyname} - {!resourceListItem.TradeType}</small>
                                                        </div>
                                                    </div>
                                                </a>
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                </aura:iteration>
                                <aura:set attribute="else">
                                    <div class="nodata"> No Internal Resources Found</div>
                                </aura:set>
                            </aura:if>

                            <aura:set attribute="else">
                                No Resources Found
                            </aura:set>
                        </aura:if>
                    </div>
                </div>

                <div class="container py-1">
                    <div class="row pb-2">
                        <div class="col-md-6 col-xl-7 col-xxl-8">
                            <div class="input-group pt-1">
                                <input type="text" class="form-control brd-r-0"
                                    aria-label="Dollar amount (with dot and two decimal places)"
                                    placeholder="Search by Trade Type, Resource"
                                    onchange="{!c.FilterTradeTypeTasks}" disabled="{!v.isDisable}" />
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                            </div>
                        </div>
                    </div>

                    <div class="cal_header">
                        <div class="row">
                            <div class="col-md-6 col-xl-4" id="selectedResourceContainer">
                                <div class="d-flex w-100 align-items-center">
                                    <div class="profile_name me-3 prof_bg2" id="profileBgSymbol">
                                        <span id="resourceInitials">R</span>
                                    </div>
                                    <div>
                                        <strong class="mb-1" id="selectedContractResource">Resource</strong> <br />
                                        <small class="text-black-50" id="selectedContractResourceTradeType">Trade Type</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-4">
                                <ul class="cal_filt">
                                    <li><a href="javascript:void(0);" class="viewChange" data-name="dayView"
                                            onclick="{!c.calendarDayView}">Day</a></li>
                                    <li><a href="javascript:void(0);" class="viewChange" data-name="weekView"
                                            onclick="{!c.calendarWeekView}">Week</a></li>
                                    <li><a href="javascript:void(0);" class="viewChange active" data-name="monthView"
                                            onclick="{!c.calendarMonthView}">Month</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="datepickerPlaceholder" class="datePickerDiv">
                        <aura:if isTrue="{!v.isBackShadow}">
                            <div class="backShadow" onclick="{!c.openDatePicker}"></div>
                        </aura:if>
                    </div>
                    <div class="row" style="overflow-y : scroll; height: 80%;">
                        <div class="col-12">
                            <!-- Month View -->
                            <div class="monthly" id="mycalendar">

                            </div>
                            <!-- day view -->
                            <div class="monthly" id="mycalendar2" style="display:none;padding:5px;">
                                <div class="daily-header">
                                    <div class="daily-header-title">
                                        <a class="daily-header-title-date"
                                            href="javascript:void(0);">{!v.todayDateHeader}</a>
                                        <a class="daily-header-title-datee" id="datepickerAnchor"
                                            onclick="{!c.openDatePicker}" data-name="datepickerPlaceholder_day"
                                            style="position: relative !important;" href="javascript:void(0);">Select
                                            Date
                                        </a>
                                        <aura:if isTrue="{!v.currentDateValString != v.todayDate}">
                                            <a class="monthly-day-reset" href="javascript:void(0);"
                                                onclick="{!c.dayReset}"></a>
                                        </aura:if>
                                    </div>
                                    <a class="daily-prev" href="javascript:void(0);" onclick="{!c.prevDayDate}"></a>
                                    <a class="daily-next" href="javascript:void(0);" onclick="{!c.nextDayDate}"></a>
                                </div>
                                <aura:if isTrue="{!v.dateEventList.length > 0}">
                                    <aura:iteration items="{!v.dateEventList}" var="eventItem" indexVar="">
                                        <div class="d-flex mb-3" style="padding: 0 1rem 0 .3rem;">
                                            <div class="selected_date" style="width:7%;">
                                                <label class="text">{!eventItem.weekSubStr}</label>
                                                <h5 class="number">{!eventItem.startdateNum}</h5>
                                            </div>
                                            <div class="event event_blue">
                                                <label class="event_title">{!eventItem.projectId}</label>
                                                <div class="row mb-4">
                                                    <div class="col-sm-3"> <!-- col-sm-4 -->
                                                        <h5 class="event_head">Resource</h5>
                                                        <aura:if isTrue="{!eventItem.contractresourceId}">
                                                            <label class="event_cont">{!eventItem.contractresourceId}
                                                            </label>
                                                            <aura:set attribute="else">
                                                                <aura:if isTrue="{!eventItem.UnitId}">
                                                                    <label class="event_cont">{!eventItem.UnitId}
                                                                    </label>
                                                                    <aura:set attribute="else">
                                                                        No Resource
                                                                    </aura:set>
                                                                </aura:if>
                                                            </aura:set>
                                                        </aura:if>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">Description</h5>
                                                        <label class="event_cont">{!eventItem.title} </label>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">Schedule Name</h5>
                                                        <label class="event_cont">{!eventItem.Model}</label>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">Duration</h5>
                                                        <label class="event_cont">{!eventItem.taskdays}</label>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">Start Date</h5>
                                                        <label
                                                            class="event_cont">{!eventItem.startdateFormatted}</label>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">End Date</h5>
                                                        <label class="event_cont">{!eventItem.enddateFormatted}</label>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <h5 class="event_head">Completion</h5>
                                                        <aura:if isTrue="{!eventItem.Completion}">
                                                            <label class="event_cont">{!eventItem.Completion}</label>
                                                            <aura:set attribute="else">
                                                                <label class="event_cont">0%</label>
                                                            </aura:set>
                                                        </aura:if>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </aura:iteration>
                                    <aura:set attribute="else">
                                        <div style="text-align:center;padding:4rem; min-height: 30vh;">No Events </div>
                                    </aura:set>
                                </aura:if>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <aura:if isTrue="{!v.showSpinner}">
            <div aura:id="spinnerId" class="slds-spinner_container" style="position:fixed;">
                <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                    <span class="slds-assistive-text">Loading</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                    <div class="custom-loading-text">
                        <b>Processing, Please Wait</b>
                    </div>
                </div>
            </div>
        </aura:if>
    </body>
    <ltng:require scripts="{!$Resource.ResourceScheduleTabContent + '/ResourceScheduleTab/sidebars.js'}" />
    <ltng:require scripts="{!$Resource.ResourceScheduleDashboardMonthly}" afterScriptsLoaded="{!c.handleAfterLoad}" />
</aura:component>