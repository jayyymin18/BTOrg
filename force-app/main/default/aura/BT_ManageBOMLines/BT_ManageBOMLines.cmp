<aura:component controller="ManageBOMlinesController"
    implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader,lightning:isUrlAddressable"
    access="global">

    <aura:attribute name="Spinner" type="Boolean" />
    <aura:attribute name="fieldmaptype" type="Object" />
    <aura:attribute name="islocked" type="boolean" default="false" />

    <aura:attribute name="PageNumber" type="integer" default="1" />
    <aura:attribute name="pageSize" type="integer" default="10" />
    <aura:attribute name="TotalPages" type="integer" default="0" />
    <aura:attribute name="TotalRecords" type="integer" default="0" />
    <aura:attribute name="RecordStart" type="integer" default="0" />
    <aura:attribute name="RecordEnd" type="integer" default="0" />

    <aura:attribute name="recordsList" type="List" default="[]" />
    <aura:attribute name="orgData" type="Object" />
    <aura:attribute name="data" type="Object" />

    <aura:attribute name="dataByGroup" type="Object" />
    <aura:attribute name="Init_dataByGroup" type="Object" />
    <aura:attribute name="cloneDataByGroup" type="Map" />

    <!-- dynamic BOM Line filed -->
    <aura:attribute name="bomLineFieldsSettings" type="List" default="[]" />
    <aura:attribute name="bomLineselectedFields" type="String" />

    <aura:attribute name="groupByPhasetoggle" type="Boolean" default="true" />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:attribute name="BOMName" type="String" default="" />

    <!-- mass update -->
    <aura:attribute name="fieldValues" type="List" />
    <aura:attribute name="isLoading" type="Boolean" default="false" />
    <lightning:workspaceAPI aura:id="workspace" />
    <aura:attribute name="sObjectRecords" type="List" default="[]" />

    <aura:attribute name="bomLineFieldsSettingsClone" type="List" default="[]" />
    <aura:attribute name="countryoptions" type="List" default="[]" />
    <aura:attribute name="selectedCountry" type="String" />
    <aura:attribute name="selectedCountryDB" type="String" default="Please Select a Country" />
    <aura:attribute name="showProductCodeModal" type="Boolean" default="false" />
    <aura:attribute type="String" name="fieldAPINameToPass" />
    <aura:attribute type="String" name="fieldLabelToShow" />
    <aura:attribute type="object" name="fabInstallExtndCost" />
    <aura:attribute type="object" name="installOnlyExtndCost" />
    <aura:attribute type="object" name="nonSlabExtndCost" />
    <aura:attribute type="object" name="fabOnlyExtndCost" />
    <aura:attribute type="object" name="miscExtndCost" />
    <aura:attribute type="object" name="edgeCost" />
    <aura:attribute type="object" name="slabDiscountRate" />
    <aura:attribute type="object" name="fabLaborMarkupRate" />
    <aura:attribute type="object" name="OptionsExtndCost" />
    <aura:attribute type="String" name="generalLiabilityCost" />
    <aura:attribute type="String" name="workersCompCost" />
    <aura:attribute type="String" name="texturaFeeCost" />
    <aura:attribute type="String" name="recordId" />
    <aura:attribute name="openCreateProposalModal" type="Boolean" default="false" />
    <aura:attribute name="adjustCostUpdated" type="Boolean" default="false" />
    <aura:attribute name="servCatVsExtendedCostMap" type="List" />
    <aura:attribute name="totalInstallCost" type="String" />
    <aura:attribute name="totalProposalAmount" type="String" />
    <aura:attribute name="buildPhaseName" type="String" />

    <aura:attribute name="EditRecordId" type="String" />
    <aura:attribute name="OpenEditPopup" type="Boolean" default="false" />
    <aura:attribute name="listOfFields" type="List" />

    <aura:attribute name="record" type="Object" />
    <aura:attribute name="BTBOMtype" type="Object" />
    <aura:attribute name="totalBOMlines" type="Integer" />
    <aura:attribute name="massupdateIndex" type="List" />

    <!-- BUIL-3754, 3765, 3766 START -->
    <aura:handler name="onSelectEvt" event="c:BT_LookupEvent" action="{!c.handleLookUpEvent}" />
    <aura:handler name="oSelectedRecordEvent" event="c:BT_LightningLookupEvent" action="{!c.ProductSelectHandler}" />
    <aura:handler name="oClearRecordEvent" event="c:BT_LightningLookupEvent" action="{!c.clearSelectedHandler}" />
    <aura:handler name="changedValueEvent" event="c:BT_FieldSetMassUpdateEvent"
        action="{!c.valueChnagedInFildsetMassUpdate}" />

    <aura:attribute name="indexvalue" type="Integer" />
    <aura:attribute name="pricebookId" type="String" />
    <aura:attribute name="productfamily" type="String" default="All Families" />
    <aura:attribute name="totalCost" type="Integer" default="0" />
    <aura:attribute name="totalSalesPrice" type="Integer" default="0" />
    <aura:attribute name="UOMpickListValues" type="List" />
    <aura:html tag="style">
        .slds-dropdown {
        z-index: 90 !important;
        top: 100% !important;
        }

        .UOMPicklist .slds-form-element__label{
        display: none !important;
        }

        .vendorlookup lightning-helptext{
        display : none !important;
        }
    </aura:html>

    <lightning:navigation aura:id="goToPrevious" />

    <force:recordData aura:id="recordLoader" recordId="{!v.recordId}" fields="Name" targetRecord="{!v.record}"
        targetFields="{!v.BTBOMtype}" targetError="{!v.recordError}" recordUpdated="{! c.handleRecordLoaded }" />

    <div>
        <div class="slds-card">
            <div class="slds-grid slds-gutters cardCss slds-wrap">
                <div class="slds-col slds-size_6-of-8">
                    <div style="display: flex; justify-content: flex-start; gap: 2rem;">
                        <div>
                            <span>
                                <span style=" color: #6b6d70;">BOM</span>
                                <h2 class="slds-card__header-title">
                                    <span onclick="{!c.redirect}" style="color:#0176d3;cursor:pointer;"><!-- #0176d3 -->
                                        {!v.BOMName}
                                    </span>
                                </h2>
                            </span>
                        </div>
                        <div>
                            <span>
                                <span style=" color: #6b6d70;">Total Cost</span>
                                <h2 class="slds-card__header-title">
                                    <aura:if isTrue="{!and(v.totalCost != null,v.totalCost != undefined)}">
                                        <span style="color:#0176d3;cursor:pointer;">
                                            <lightning:formattedNumber value="{!v.totalCost}" style="currency"
                                                currencyCode="USD" currencyDisplayAs="code" />
                                        </span>
                                    </aura:if>
                                </h2>
                            </span>
                        </div>
                        <div>
                            <span>
                                <span style=" color: #6b6d70;">Total Sales Price</span>
                                <h2 class="slds-card__header-title">
                                    <aura:if isTrue="{!and(v.totalSalesPrice != null,v.totalSalesPrice != undefined)}">
                                        <span style="color:#0176d3;cursor:pointer;">
                                            <lightning:formattedNumber value="{!v.totalSalesPrice}" style="currency"
                                                currencyCode="USD" currencyDisplayAs="code" />
                                        </span>
                                    </aura:if>
                                </h2>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="slds-col slds-size_2-of-8" style="text-align: right;">
                    <lightning:button iconName="utility:back" iconPosition="left" onclick="{!c.redirect}" label="Back"
                        class="" />
                </div>

            </div>
        </div>

        <div class="searchCointainer"
            style="background: var(--lwc-pageHeaderColorBackground, rgb(243, 242, 242));padding: 2rem 1rem;overflow-x: auto;white-space: nowrap; margin-top: 8px; border-radius: 4px;">
            <aura:iteration items="{!v.dataByGroup}" var="groupItem" indexVar="phaseIndex">
                <div class="slds-grid slds-gutters slds-wrap"
                    style="border-block: 6px solid #2d2d2d; margin: 60px 0px 8px 0px!important; padding-block: 4px; background-color: white">
                    <div class="slds-modal__header slds-p-around_xx-small GroupHeader slds-col slds-size_6-of-8"
                        style="font-size:20px; border-block: 0px !important; font-weight:bold; display: flex; align-items: center;">
                        <div style="flex: 1; text-align: left; color:#0176d3">
                            {!groupItem.groupName}
                        </div>
                    </div>
                    <div class="slds-col slds-size_2-of-8" style="text-align: right; margin-top:3px;">
                        <lightning:button iconName="utility:save" title="{!phaseIndex}" iconPosition="left"
                            onclick="{!c.massUpdateLines}" label="{!groupItem.massUpdate==true?'Save':'Update'}"
                            class="" />
                        <aura:if isTrue="{!groupItem.massUpdate}">
                            <lightning:button iconName="utility:close" title="{!phaseIndex}" iconPosition="left"
                                onclick="{!c.onMassUpdateCancel}" label="Cancel" />
                        </aura:if>
                    </div>
                </div>
                <aura:if isTrue="{!groupItem.massUpdate}">
                    <div id="{!groupItem.groupName+'_'+phaseIndex}" class="customDataTable"
                        style="overflow-x: auto;overflow-y: scroll; background: white;">
                        <!-- aura:id = "tableByGroup" aura:id="poTable"-->
                        <div style="background-color:white;">
                            <aura:iteration items="{!groupItem.sObjectListWithCostCodeGroup}" var="outerRow"
                                indexVar="subHeaderIndex">

                                <div class="slds-grid slds-gutters slds-wrap"
                                    style="border-block: 2px solid #44484d71; margin: 8px 0px!important; padding-block: 0px; background: white;font-weight:650">
                                    <div class="slds-modal__header slds-p-around_xx-small GroupHeader slds-col slds-size_6-of-8"
                                        style="font-size:12px; border-block: 0px !important;">
                                        <div style="flex: 1; text-align: left;margin-left: 20px;">
                                            {!outerRow.costCode}
                                        </div>
                                    </div>
                                </div>
                                <div style="overflow: auto;">
                                    <table class="slds-table slds-table--bordered"
                                        style="width: max-content; max-width: 200%; margin-bottom: 7rem;">
                                        <thead>
                                            <tr style="{!groupItem.massUpdate ? '':''}">
                                                <th scope="col" tabindex="-1" aria-label="Row Number"
                                                    style="background-color: #164486; color: white; padding: 0.5rem 0.5rem; border-left : 1px solid #c7c7c7"
                                                    class="slds-is-resizable slds-is-sortable">
                                                    <div class="slds-cell-fixed"
                                                        style="width: 52px; outline: none; display: none;">
                                                        <span class="slds-th__action"><span title="Row Number"
                                                                class="slds-truncate">
                                                            </span></span>
                                                    </div>
                                                </th>
                                                <aura:iteration items="{!v.bomLineFieldsSettings}" var="rec"
                                                    indexVar="SettingsIndex">
                                                    <aura:if
                                                        isTrue="{!or(rec.label == 'Build Phase',rec.label == 'List Price')}">
                                                        <th style="background-color: #164486; color: white; padding: 0.5rem 0.5rem; border-left : 1px solid #c7c7c7"
                                                            class="slds-is-resizable slds-is-sortable">
                                                            &nbsp;{!rec.label}
                                                        </th>
                                                        <aura:set attribute="else">
                                                            <th style="background-color: #164486; color: white; padding: 0.5rem 0.5rem; border-left : 1px solid #c7c7c7"
                                                                class="slds-is-resizable slds-is-sortable">
                                                                &nbsp;{!rec.label}</th>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:iteration>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <aura:iteration items="{!outerRow.records}" var="row" indexVar="index">
                                                <tr>
                                                    <td role="gridcell" tabindex="-1">
                                                        <span class="slds-grid slds-grid_align-spread">
                                                            <div class="slds-truncate">
                                                                {!index+1}
                                                            </div>
                                                        </span>
                                                    </td>
                                                    <aura:iteration items="{!v.fieldValues}" var="field">
                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__BT_Price_Book__c'}">
                                                            <td
                                                                style="padding-right:5px; min-width: 13rem; max-width : 13rem;">
                                                                <c:BT_LookupFields
                                                                    selectedRecordId="{!row.buildertek__BT_Price_Book__c}"
                                                                    childObjectName="buildertek__Select_Sheet__c"
                                                                    phaseIndex="{!phaseIndex}" index="{!index}"
                                                                    phaseIndexValue="{!subHeaderIndex}"
                                                                    fieldName="{!field.name}" record="{!row}"
                                                                    callingCmpName="BT_ManageBOMLines" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'buildertek__Product__c'}">
                                                            <td
                                                                style="padding-right:5px; max-width: 13rem; min-width: 13rem;">
                                                                <c:BT_LightningLookup objectAPIName="Product2"
                                                                    IconName="standard:product"
                                                                    selectedRecord="{!row.buildertek__Product__r}"
                                                                    aura:id="productId"
                                                                    parentId="{!row.buildertek__BT_Price_Book__c}"
                                                                    prodctfamly="{!v.productfamily}"
                                                                    phaseIndex="{!phaseIndex}" index="{!index}"
                                                                    phaseIndexValue="{!subHeaderIndex}" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__Takeoff_Line__c'}">
                                                            <td
                                                                style="padding-right:5px; max-width: 13rem; min-width: 13rem;">
                                                                <lightning:recordEditForm
                                                                    objectApiName="buildertek__Select_Sheet__c">
                                                                    <lightning:inputField aura:id="lookupField"
                                                                        fieldName="{!field.name}"
                                                                        name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                        value="{!row.buildertek__Takeoff_Line__c}"
                                                                        class="slds-size--1-of-1 vendorlookup"
                                                                        variant="label-hidden" />
                                                                </lightning:recordEditForm>
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'buildertek__Vendor__c'}">
                                                            <td
                                                                style="padding-right:5px; max-width: 13rem; min-width: 13rem;">
                                                                <lightning:recordEditForm
                                                                    objectApiName="buildertek__Select_Sheet__c">
                                                                    <lightning:inputField aura:id="lookupField"
                                                                        fieldName="{!field.name}"
                                                                        name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                        value="{!row.buildertek__Vendor__c}"
                                                                        class="slds-size--1-of-1 vendorlookup"
                                                                        variant="label-hidden" />
                                                                </lightning:recordEditForm>
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'Name'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input value="{!row.Name}"
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    data-fieldapi="{!field.name}"
                                                                    onchange="{!c.onInputChange}" width="500%"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'buildertek__Quantity__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input value="{!row.buildertek__Quantity__c}"
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    data-fieldapi="{!field.name}"
                                                                    onchange="{!c.onInputChange}" width="500%"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__BL_UNIT_COST__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    data-fieldapi="{!field.name}"
                                                                    value="{!row.buildertek__BL_UNIT_COST__c}"
                                                                    type="number" formatter="currency"
                                                                    onchange="{!c.onInputChange}" step="0.01"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__UOM_Picklist__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:select aura:id="select" class="UOMPicklist"
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    variant="label-hidden"
                                                                    onchange="{!c.onInputChange}">
                                                                    <option value="None">None</option>
                                                                    <aura:iteration items="{!v.UOMpickListValues}"
                                                                        var="item" indexVar="i">
                                                                        <option value="{!item}"
                                                                            selected="{!row.buildertek__UOM_Picklist__c == item}">
                                                                            {!item}</option>
                                                                    </aura:iteration>
                                                                </lightning:select>
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'buildertek__Tax_Percent__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input
                                                                    value="{!row.buildertek__Tax_Percent__c}"
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    data-fieldapi="{!field.name}"
                                                                    onchange="{!c.onInputChange}" width="500%"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{!field.name == 'buildertek__BL_MARKUP__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input value="{!row.buildertek__BL_MARKUP__c}"
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    data-fieldapi="{!field.name}"
                                                                    onchange="{!c.onInputChange}" width="500%"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__Extended_Cost__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    disabled="true" data-fieldapi="{!field.name}"
                                                                    value="{!row.buildertek__Extended_Cost__c}"
                                                                    type="number" formatter="currency"
                                                                    onchange="{!c.onInputChange}" step="0.01"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__BL_LIST_PRICE_F__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    disabled="true" data-fieldapi="{!field.name}"
                                                                    value="{!row.buildertek__BL_LIST_PRICE_F__c}"
                                                                    type="number" formatter="currency"
                                                                    onchange="{!c.onInputChange}" step="0.01"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                        <aura:if
                                                            isTrue="{!field.name == 'buildertek__Total_Sales_Price__c'}">
                                                            <td style="padding-right:5px; width: 7rem;">
                                                                <lightning:input
                                                                    name="{!index+'-'+subHeaderIndex+'-'+field.name}"
                                                                    disabled="true" data-fieldapi="{!field.name}"
                                                                    value="{!row.buildertek__Total_Sales_Price__c}"
                                                                    type="number" formatter="currency"
                                                                    onchange="{!c.onInputChange}" step="0.01"
                                                                    variant="label-hidden" />
                                                            </td>
                                                        </aura:if>

                                                    </aura:iteration>

                                                    <td>
                                                    </td>
                                                </tr>
                                            </aura:iteration>
                                        </tbody>
                                    </table>
                                </div>
                            </aura:iteration>
                        </div>
                    </div>
                    <aura:set attribute="else">
                        <div id="{!groupItem.groupName+'_'+phaseIndex}" class="customDataTable"
                            style="overflow-x: auto;overflow-y: hidden; background: white;">
                            <!-- aura:id = "tableByGroup" aura:id="poTable"-->
                            <div style="background-color:white;">
                                <aura:iteration items="{!groupItem.sObjectListWithCostCodeGroup}" var="outerRow"
                                    indexVar="subHeaderIndex">

                                    <div class="slds-grid slds-gutters slds-wrap"
                                        style="border-block: 2px solid #44484d71; margin: 8px 0px!important; padding-block: 0px; background: white;font-weight:650">
                                        <div class="slds-modal__header slds-p-around_xx-small GroupHeader slds-col slds-size_6-of-8"
                                            style="font-size:12px; border-block: 0px !important;">
                                            <div style="flex: 1; text-align: left;margin-left: 20px;">
                                                {!outerRow.costCode}
                                            </div>
                                        </div>
                                    </div>

                                    <div style="overflow-x: auto;overflow-y:hidden;">
                                        <table class="slds-table slds-table--bordered">
                                            <thead>
                                                <tr class="slds-line-height_reset">
                                                    <th scope="col" tabindex="-1" aria-label="Row Number"
                                                        style="background-color: #164486; color: white; padding: 0.5rem 0.5rem; border-left : 1px solid #c7c7c7"
                                                        class="slds-is-resizable slds-is-sortable">
                                                        <div class="slds-cell-fixed"
                                                            style="width: 52px; outline: none; display: none;">
                                                            <span><span title="Row Number" class="slds-truncate">
                                                                </span></span>
                                                        </div>
                                                    </th>
                                                    <aura:iteration items="{!v.bomLineFieldsSettings}" var="rec"
                                                        indexVar="SettingsIndex">
                                                        <th aria-label="Name" aria-sort="none"
                                                            style="background-color: #164486; color: white; padding: 0.5rem 0.5rem; border-left : 1px solid #c7c7c7"
                                                            class="slds-is-resizable slds-is-sortable" scope="col"
                                                            data-sortBy="{!rec.value}" name="{!rec.value}"
                                                            data-sortGroupIndex="{!SettingsIndex}"
                                                            onclick="{!c.handleSort}" title="{!rec.value}">
                                                            <div data-sortBy="{!rec.value}" name="{!rec.value}"
                                                                style="display: none;">{!rec.label}</div>
                                                            <a data-sortBy="{!rec.value}"
                                                                style="display: flex; justify-content: start; padding-block: 6px;"
                                                                name="{!rec.value}" class="slds-text-link_reset"
                                                                href="#" role="button" tabindex="0">
                                                                <span class="slds-assistive-text">Sort by: </span>
                                                                <div class="slds-grid slds-grid_vertical-align-center"
                                                                    style="">
                                                                    <span class="slds-truncate"
                                                                        title="{!rec.label}">{!rec.label}</span>
                                                                    <aura:if
                                                                        isTrue="{!SettingsIndex == v.sortingGroupIndex}">
                                                                        <aura:if
                                                                            isTrue="{!and(v.sortDirection == 'asc',v.sortedBy == rec.value)}">
                                                                            <span
                                                                                class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                                <lightning:icon
                                                                                    iconName="utility:arrowdown"
                                                                                    alternativeText="arrowDown"
                                                                                    size="xx-small"
                                                                                    title="xx-small size" />
                                                                            </span>
                                                                        </aura:if>
                                                                        <aura:if
                                                                            isTrue="{!and(v.sortDirection == 'desc',v.sortedBy == rec.value)}">
                                                                            <span
                                                                                class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowup">
                                                                                <lightning:icon
                                                                                    iconName="utility:arrowup"
                                                                                    alternativeText="arrowup"
                                                                                    size="xx-small"
                                                                                    title="xx-small size" />
                                                                            </span>
                                                                        </aura:if>
                                                                        <aura:if isTrue="{!v.sortedBy != rec.value}">
                                                                            <span
                                                                                class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                                <lightning:icon
                                                                                    iconName="utility:arrowup"
                                                                                    alternativeText="arrowup"
                                                                                    size="xx-small"
                                                                                    title="xx-small size" />
                                                                            </span>
                                                                        </aura:if>
                                                                        <aura:set attribute="else">
                                                                            <span
                                                                                class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                                <lightning:icon
                                                                                    iconName="utility:arrowup"
                                                                                    alternativeText="arrowup"
                                                                                    size="xx-small"
                                                                                    title="xx-small size" />
                                                                            </span>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </div>
                                                            </a>
                                                            <div class="slds-resizable">
                                                                <input type="range" aria-label="Name column width"
                                                                    class="slds-resizable__input slds-assistive-text"
                                                                    id="cell-resize-handle-533" max="1000" min="20"
                                                                    tabindex="0" />
                                                                <span class="slds-resizable__handle">
                                                                    <span class="slds-resizable__divider"></span>
                                                                </span>
                                                            </div>
                                                        </th>
                                                    </aura:iteration>
                                                </tr>

                                            </thead>
                                            <tbody>
                                                <aura:iteration items="{!outerRow.records}" var="row"
                                                    indexVar="dataIndex">

                                                    <tr>
                                                        <td role="gridcell" tabindex="-1">
                                                            <span class="slds-grid slds-grid_align-spread">
                                                                <div class="slds-truncate">
                                                                    {!dataIndex+1}
                                                                </div>
                                                            </span>
                                                        </td>

                                                        <aura:iteration items="{!v.fieldValues}" var="field"
                                                            indexVar="columnIndex">
                                                            <aura:if isTrue="{!field.name == 'Name'}">
                                                                <td
                                                                    style="max-width: 16rem; overflow: hidden; text-overflow: ellipsis;">
                                                                    <ui:outputURL
                                                                        value="{!'/one/one.app?#/sObject/'+ row.Id + '/view'}"
                                                                        label="{!row.Name}" target="_blank" />
                                                                </td>
                                                                <aura:set attribute="else">
                                                                    <aura:if isTrue="{!(field.label == 'Standard?')}">
                                                                        <td>

                                                                            <c:BT_FieldSetMassUpdate record="{!row}"
                                                                                index="{!index}" field="{!field}"
                                                                                isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                childObjectName="buildertek__Select_Sheet__c"
                                                                                ObjectName="buildertek__Select_Sheet__c"
                                                                                callingCmpName="BT_ManageBOMLines" />
                                                                        </td>
                                                                        <aura:set attribute="else">
                                                                            <aura:if
                                                                                isTrue="{! or( or(field.type == 'DOUBLE',field.type == 'CURRENCY'), field.type == 'PERCENT') }">

                                                                                <td
                                                                                    style="padding-right:5px; padding-left: 16px;">
                                                                                    <c:BT_FieldSetMassUpdate
                                                                                        record="{!row}" index="{!index}"
                                                                                        field="{!field}"
                                                                                        isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                        childObjectName="buildertek__Select_Sheet__c"
                                                                                        ObjectName="buildertek__Select_Sheet__c"
                                                                                        callingCmpName="BT_ManageBOMLines" />
                                                                                </td>
                                                                                <aura:set attribute="else">
                                                                                    <td
                                                                                        style="max-width: 16rem; overflow: hidden; text-overflow: ellipsis;">
                                                                                        <c:BT_FieldSetMassUpdate
                                                                                            record="{!row}"
                                                                                            index="{!index}"
                                                                                            field="{!field}"
                                                                                            isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                            childObjectName="buildertek__Select_Sheet__c"
                                                                                            ObjectName="buildertek__Select_Sheet__c"
                                                                                            callingCmpName="BT_ManageBOMLines" />
                                                                                    </td>
                                                                                </aura:set>
                                                                            </aura:if>


                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:set>
                                                            </aura:if>
                                                        </aura:iteration>
                                                    </tr>
                                                </aura:iteration>
                                            </tbody>
                                        </table>
                                    </div>
                                </aura:iteration>
                            </div>
                        </div>
                    </aura:set>
                </aura:if>

            </aura:iteration>
        </div>
    </div>


    <aura:if isTrue="{!v.isLoading}">
        <div aura:id="spinnerId" class="slds-spinner_container" style="position:fixed;">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
                <div class="custom-loading-text">
                    <b>Processing, Please Wait</b>
                </div>
            </div>
        </div>
    </aura:if>

</aura:component>